[{"data":1,"prerenderedAt":4093},["ShallowReactive",2],{"navigation":3,"/articles/micro-templating":158,"/articles/micro-templating-surround":4088},[4,35,89,95,122,128,152],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29,32],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🚝 四十二篇系列","/flows/fourty-two",{"title":15,"_path":16},"🌃 长夜梦","/flows/long-night-dream",{"title":18,"_path":19},"🌌 万物联结与幸福感","/flows/everything",{"title":21,"_path":22},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":24,"_path":25},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":27,"_path":28},"🌧️ 我的腼腆","/flows/shy",{"title":30,"_path":31},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":33,"_path":34},"📝 心流归档","/flows/archive",{"title":36,"_path":37,"children":38},"技术博客 / Coder","/articles",[39,41,44,47,50,53,56,59,62,65,68,71,74,77,80,83,86],{"title":40,"_path":37},"🦁 欢迎",{"title":42,"_path":43},"🌪️ tailwind4 如何兼容预处理器","/articles/tailwind4-with-sass",{"title":45,"_path":46},"🥞 在 tailwind 中使用现代化 CSS Layers","/articles/tailwind-sass-and-css-layer",{"title":48,"_path":49},"💻 本地部署 Qwen 翻译网页","/articles/local-translator",{"title":51,"_path":52},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":54,"_path":55},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":57,"_path":58},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":60,"_path":61},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":63,"_path":64},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":66,"_path":67},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":69,"_path":70},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":72,"_path":73},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":75,"_path":76},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":78,"_path":79},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":81,"_path":82},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":84,"_path":85},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":87,"_path":88},"📝 技术博客归档","/articles/archive",{"title":90,"_path":91,"children":92},"读书笔记 / Notes","/books",[93],{"title":94,"_path":91},"📕 读书笔记",{"title":96,"_path":97,"children":98},"吉他剧场 / Music","/music",[99,101,104,107,110,113,116,119],{"title":100,"_path":97},"🎸 FingerStyle！",{"title":102,"_path":103},"🌬️ 等待的风","/music/wind",{"title":105,"_path":106},"💕 约定的海洋","/music/ocean",{"title":108,"_path":109},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":111,"_path":112},"🌏 残酷天使的行动纲领","/music/eva",{"title":114,"_path":115},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":117,"_path":118},"🍷 Wu Wei","/music/wu-wei",{"title":120,"_path":121},"🌅 无题","/music/untitled",{"title":123,"_path":124,"children":125},"知识地图 / Maps","/maps",[126],{"title":127,"_path":124},"🏁 知识地图",{"title":129,"_path":130,"children":131},"造物 / Make","/tools",[132,134,137,140,143,146,149],{"title":133,"_path":130},"🧰 工具收集",{"title":135,"_path":136},"📕 博客","/tools/blog",{"title":138,"_path":139},"🥥 Coconut","/tools/coconut",{"title":141,"_path":142},"🧶 网易云音乐歌单排序","/tools/netease-sorter",{"title":144,"_path":145},"🌐 AnySort","/tools/anysort",{"title":147,"_path":148},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":150,"_path":151},"👓 Crapto","/tools/crypto-inline",{"title":153,"_path":154,"children":155},"我 / About","/hire",[156],{"title":157,"_path":154},"📬 技术简历",{"_path":52,"_dir":159,"_draft":160,"_partial":160,"_locale":161,"title":51,"description":162,"body":163,"_type":4082,"_id":4083,"_source":4084,"_file":4085,"_stem":4086,"_extension":4087},"articles",false,"","忍者秘籍中提到的模板解析器，很短但支持变量和 if 等语句，还是 15 年前的代码！",{"type":164,"children":165,"toc":4077},"root",[166,191,203,208,385,397,517,522,528,533,1641,1646,1651,1656,1767,1780,2241,2547,2558,2657,2670,2841,2846,2865,2904,2909,2976,2981,3034,3694,3741,3746,3820,3833,3838,3843,4004,4009,4030,4053,4058,4071],{"type":167,"tag":168,"props":169,"children":170},"element","p",{},[171,174,180,182,189],{"type":172,"value":173},"text","上回我借着解决 CSS 嵌套解析问题聊到 micro-app 中实现的一个非常精简的 ",{"type":167,"tag":175,"props":176,"children":177},"a",{"href":55},[178],{"type":172,"value":179},"CSS 解析器",{"type":172,"value":181},"，还没过瘾。今天整理笔记的时候发现了角落里的这个模板解析器，那就赶紧擦擦灰尘拉出来聊一聊。这个模板解析器可是有年头了，它是 John Resig 佬 2008 年写的，叫 ",{"type":167,"tag":183,"props":184,"children":186},"code",{"className":185},[],[187],{"type":172,"value":188},"micro-templating",{"type":172,"value":190},"，距今十五年哩。（John Resig 就是写《JavaScript 忍者秘籍》那位）",{"type":167,"tag":168,"props":192,"children":193},{},[194,196,201],{"type":172,"value":195},"令人惊叹的地方是，",{"type":167,"tag":183,"props":197,"children":199},{"className":198},[],[200],{"type":172,"value":188},{"type":172,"value":202}," 的代码和它的名字一样 micro，它能用仅仅 30 行代码完成对模板的处理，并且还有读取 html 模板、缓存、柯里化等额外的高级功能！",{"type":167,"tag":168,"props":204,"children":205},{},[206],{"type":172,"value":207},"可能有些佬没接触过模板解析器，这里给出一个简单的示例。",{"type":167,"tag":209,"props":210,"children":214},"pre",{"className":211,"code":212,"language":213,"meta":161,"style":161},"language-js shiki shiki-themes material-theme-lighter github-light github-dark monokai","parse(`\n  \u003C% if (shouldCount) { %>\n    \u003C% for (var i = 1; i \u003C= 3; i++) { %>\n      \u003Cdiv>hello - \u003C%= i + count %>\u003C/div>\n    \u003C% } %>\n  \u003C% } else { %>\n    \u003Cdiv>noop\u003C/div>\n  \u003C% } %>\n`, {\n  shouldCount: true,\n  count: 1\n})\n","js",[215],{"type":167,"tag":183,"props":216,"children":217},{"__ignoreMap":161},[218,242,252,261,270,279,288,297,306,326,352,371],{"type":167,"tag":219,"props":220,"children":223},"span",{"class":221,"line":222},"line",1,[224,230,236],{"type":167,"tag":219,"props":225,"children":227},{"style":226},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[228],{"type":172,"value":229},"parse",{"type":167,"tag":219,"props":231,"children":233},{"style":232},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[234],{"type":172,"value":235},"(",{"type":167,"tag":219,"props":237,"children":239},{"style":238},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[240],{"type":172,"value":241},"`\n",{"type":167,"tag":219,"props":243,"children":245},{"class":221,"line":244},2,[246],{"type":167,"tag":219,"props":247,"children":249},{"style":248},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[250],{"type":172,"value":251},"  \u003C% if (shouldCount) { %>\n",{"type":167,"tag":219,"props":253,"children":255},{"class":221,"line":254},3,[256],{"type":167,"tag":219,"props":257,"children":258},{"style":248},[259],{"type":172,"value":260},"    \u003C% for (var i = 1; i \u003C= 3; i++) { %>\n",{"type":167,"tag":219,"props":262,"children":264},{"class":221,"line":263},4,[265],{"type":167,"tag":219,"props":266,"children":267},{"style":248},[268],{"type":172,"value":269},"      \u003Cdiv>hello - \u003C%= i + count %>\u003C/div>\n",{"type":167,"tag":219,"props":271,"children":273},{"class":221,"line":272},5,[274],{"type":167,"tag":219,"props":275,"children":276},{"style":248},[277],{"type":172,"value":278},"    \u003C% } %>\n",{"type":167,"tag":219,"props":280,"children":282},{"class":221,"line":281},6,[283],{"type":167,"tag":219,"props":284,"children":285},{"style":248},[286],{"type":172,"value":287},"  \u003C% } else { %>\n",{"type":167,"tag":219,"props":289,"children":291},{"class":221,"line":290},7,[292],{"type":167,"tag":219,"props":293,"children":294},{"style":248},[295],{"type":172,"value":296},"    \u003Cdiv>noop\u003C/div>\n",{"type":167,"tag":219,"props":298,"children":300},{"class":221,"line":299},8,[301],{"type":167,"tag":219,"props":302,"children":303},{"style":248},[304],{"type":172,"value":305},"  \u003C% } %>\n",{"type":167,"tag":219,"props":307,"children":309},{"class":221,"line":308},9,[310,315,321],{"type":167,"tag":219,"props":311,"children":312},{"style":238},[313],{"type":172,"value":314},"`",{"type":167,"tag":219,"props":316,"children":318},{"style":317},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[319],{"type":172,"value":320},",",{"type":167,"tag":219,"props":322,"children":323},{"style":317},[324],{"type":172,"value":325}," {\n",{"type":167,"tag":219,"props":327,"children":329},{"class":221,"line":328},10,[330,336,341,347],{"type":167,"tag":219,"props":331,"children":333},{"style":332},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[334],{"type":172,"value":335},"  shouldCount",{"type":167,"tag":219,"props":337,"children":338},{"style":317},[339],{"type":172,"value":340},":",{"type":167,"tag":219,"props":342,"children":344},{"style":343},"--shiki-light:#FF5370;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[345],{"type":172,"value":346}," true",{"type":167,"tag":219,"props":348,"children":349},{"style":317},[350],{"type":172,"value":351},",\n",{"type":167,"tag":219,"props":353,"children":355},{"class":221,"line":354},11,[356,361,365],{"type":167,"tag":219,"props":357,"children":358},{"style":332},[359],{"type":172,"value":360},"  count",{"type":167,"tag":219,"props":362,"children":363},{"style":317},[364],{"type":172,"value":340},{"type":167,"tag":219,"props":366,"children":368},{"style":367},"--shiki-light:#F76D47;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[369],{"type":172,"value":370}," 1\n",{"type":167,"tag":219,"props":372,"children":374},{"class":221,"line":373},12,[375,380],{"type":167,"tag":219,"props":376,"children":377},{"style":317},[378],{"type":172,"value":379},"}",{"type":167,"tag":219,"props":381,"children":382},{"style":232},[383],{"type":172,"value":384},")\n",{"type":167,"tag":168,"props":386,"children":387},{},[388,390,395],{"type":172,"value":389},"给 ",{"type":167,"tag":183,"props":391,"children":393},{"className":392},[],[394],{"type":172,"value":229},{"type":172,"value":396}," 函数传入模板字符串和数据后，自然也是输出字符串啦：",{"type":167,"tag":209,"props":398,"children":402},{"className":399,"code":400,"language":401,"meta":161,"style":161},"language-html shiki shiki-themes material-theme-lighter github-light github-dark monokai","\u003C!-- 以下经过格式化 -->\n\u003Cdiv>hello - 2\u003C/div>\n\u003Cdiv>hello - 3\u003C/div>\n\u003Cdiv>hello - 4\u003C/div>\n","html",[403],{"type":167,"tag":183,"props":404,"children":405},{"__ignoreMap":161},[406,415,453,485],{"type":167,"tag":219,"props":407,"children":408},{"class":221,"line":222},[409],{"type":167,"tag":219,"props":410,"children":412},{"style":411},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit",[413],{"type":172,"value":414},"\u003C!-- 以下经过格式化 -->\n",{"type":167,"tag":219,"props":416,"children":417},{"class":221,"line":244},[418,423,429,434,439,444,448],{"type":167,"tag":219,"props":419,"children":420},{"style":317},[421],{"type":172,"value":422},"\u003C",{"type":167,"tag":219,"props":424,"children":426},{"style":425},"--shiki-light:#E53935;--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672",[427],{"type":172,"value":428},"div",{"type":167,"tag":219,"props":430,"children":431},{"style":317},[432],{"type":172,"value":433},">",{"type":167,"tag":219,"props":435,"children":436},{"style":232},[437],{"type":172,"value":438},"hello - 2",{"type":167,"tag":219,"props":440,"children":441},{"style":317},[442],{"type":172,"value":443},"\u003C/",{"type":167,"tag":219,"props":445,"children":446},{"style":425},[447],{"type":172,"value":428},{"type":167,"tag":219,"props":449,"children":450},{"style":317},[451],{"type":172,"value":452},">\n",{"type":167,"tag":219,"props":454,"children":455},{"class":221,"line":254},[456,460,464,468,473,477,481],{"type":167,"tag":219,"props":457,"children":458},{"style":317},[459],{"type":172,"value":422},{"type":167,"tag":219,"props":461,"children":462},{"style":425},[463],{"type":172,"value":428},{"type":167,"tag":219,"props":465,"children":466},{"style":317},[467],{"type":172,"value":433},{"type":167,"tag":219,"props":469,"children":470},{"style":232},[471],{"type":172,"value":472},"hello - 3",{"type":167,"tag":219,"props":474,"children":475},{"style":317},[476],{"type":172,"value":443},{"type":167,"tag":219,"props":478,"children":479},{"style":425},[480],{"type":172,"value":428},{"type":167,"tag":219,"props":482,"children":483},{"style":317},[484],{"type":172,"value":452},{"type":167,"tag":219,"props":486,"children":487},{"class":221,"line":263},[488,492,496,500,505,509,513],{"type":167,"tag":219,"props":489,"children":490},{"style":317},[491],{"type":172,"value":422},{"type":167,"tag":219,"props":493,"children":494},{"style":425},[495],{"type":172,"value":428},{"type":167,"tag":219,"props":497,"children":498},{"style":317},[499],{"type":172,"value":433},{"type":167,"tag":219,"props":501,"children":502},{"style":232},[503],{"type":172,"value":504},"hello - 4",{"type":167,"tag":219,"props":506,"children":507},{"style":317},[508],{"type":172,"value":443},{"type":167,"tag":219,"props":510,"children":511},{"style":425},[512],{"type":172,"value":428},{"type":167,"tag":219,"props":514,"children":515},{"style":317},[516],{"type":172,"value":452},{"type":167,"tag":168,"props":518,"children":519},{},[520],{"type":172,"value":521},"相比生态里现在动则 30kb 甚至 300kb 的库，仅 30 行代码完成这个功能，简直不可思议。",{"type":167,"tag":523,"props":524,"children":526},"h2",{"id":525},"完整实现",[527],{"type":172,"value":525},{"type":167,"tag":168,"props":529,"children":530},{},[531],{"type":172,"value":532},"因为代码真的非常短，先直接看一遍，这是带注释版本的。如果你能在第一遍 review 这段代码后脑袋还保持清醒的话，留下评论，我拜你为大哥。",{"type":167,"tag":209,"props":534,"children":536},{"className":211,"code":535,"language":213,"meta":161,"style":161},"// Simple JavaScript Templating\n// John Resig - https://johnresig.com/ - MIT Licensed\n(function () {\n  var cache = {};\n\n  this.tmpl = function tmpl(str, data) {\n    // Figure out if we're getting a template, or if we need to\n    // load the template - and be sure to cache the result.\n    var fn = !/\\W/.test(str)\n      ? (cache[str] =\n          cache[str] || tmpl(document.getElementById(str).innerHTML))\n      : // Generate a reusable function that will serve as a template\n        // generator (and which will be cached).\n        new Function(\n          \"obj\",\n          \"var p=[],print=function(){p.push.apply(p,arguments);};\" +\n            // Introduce the data as local variables using with(){}\n            \"with(obj){p.push('\" +\n            // Convert the template into pure JavaScript\n            str\n              .replace(/[\\r\\t\\n]/g, \" \")\n              .split(\"\u003C%\")\n              .join(\"\\t\")\n              .replace(/((^|%>)[^\\t]*)'/g, \"$1\\r\")\n              .replace(/\\t=(.*?)%>/g, \"',$1,'\")\n              .split(\"\\t\")\n              .join(\"');\")\n              .split(\"%>\")\n              .join(\"p.push('\")\n              .split(\"\\r\")\n              .join(\"\\\\'\") +\n            \"');}return p.join('');\"\n        );\n\n    // Provide some basic currying to the user\n    return data ? fn(data) : fn;\n  };\n})();\n",[537],{"type":167,"tag":183,"props":538,"children":539},{"__ignoreMap":161},[540,548,556,578,602,611,672,680,688,746,783,856,869,878,897,920,942,951,973,982,991,1055,1089,1124,1235,1314,1346,1379,1411,1444,1476,1519,1537,1551,1559,1568,1615,1624],{"type":167,"tag":219,"props":541,"children":542},{"class":221,"line":222},[543],{"type":167,"tag":219,"props":544,"children":545},{"style":411},[546],{"type":172,"value":547},"// Simple JavaScript Templating\n",{"type":167,"tag":219,"props":549,"children":550},{"class":221,"line":244},[551],{"type":167,"tag":219,"props":552,"children":553},{"style":411},[554],{"type":172,"value":555},"// John Resig - https://johnresig.com/ - MIT Licensed\n",{"type":167,"tag":219,"props":557,"children":558},{"class":221,"line":254},[559,563,569,574],{"type":167,"tag":219,"props":560,"children":561},{"style":232},[562],{"type":172,"value":235},{"type":167,"tag":219,"props":564,"children":566},{"style":565},"--shiki-light:#9C3EDA;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic",[567],{"type":172,"value":568},"function",{"type":167,"tag":219,"props":570,"children":571},{"style":317},[572],{"type":172,"value":573}," ()",{"type":167,"tag":219,"props":575,"children":576},{"style":317},[577],{"type":172,"value":325},{"type":167,"tag":219,"props":579,"children":580},{"class":221,"line":263},[581,586,591,597],{"type":167,"tag":219,"props":582,"children":583},{"style":565},[584],{"type":172,"value":585},"  var",{"type":167,"tag":219,"props":587,"children":588},{"style":232},[589],{"type":172,"value":590}," cache",{"type":167,"tag":219,"props":592,"children":594},{"style":593},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[595],{"type":172,"value":596}," =",{"type":167,"tag":219,"props":598,"children":599},{"style":317},[600],{"type":172,"value":601}," {};\n",{"type":167,"tag":219,"props":603,"children":604},{"class":221,"line":272},[605],{"type":167,"tag":219,"props":606,"children":608},{"emptyLinePlaceholder":607},true,[609],{"type":172,"value":610},"\n",{"type":167,"tag":219,"props":612,"children":613},{"class":221,"line":281},[614,620,625,630,634,639,644,648,654,658,663,668],{"type":167,"tag":219,"props":615,"children":617},{"style":616},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[618],{"type":172,"value":619},"  this",{"type":167,"tag":219,"props":621,"children":622},{"style":317},[623],{"type":172,"value":624},".",{"type":167,"tag":219,"props":626,"children":627},{"style":226},[628],{"type":172,"value":629},"tmpl",{"type":167,"tag":219,"props":631,"children":632},{"style":593},[633],{"type":172,"value":596},{"type":167,"tag":219,"props":635,"children":636},{"style":565},[637],{"type":172,"value":638}," function",{"type":167,"tag":219,"props":640,"children":641},{"style":226},[642],{"type":172,"value":643}," tmpl",{"type":167,"tag":219,"props":645,"children":646},{"style":317},[647],{"type":172,"value":235},{"type":167,"tag":219,"props":649,"children":651},{"style":650},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#E36209;--shiki-default-font-style:inherit;--shiki-dark:#FFAB70;--shiki-dark-font-style:inherit;--shiki-sepia:#FD971F;--shiki-sepia-font-style:italic",[652],{"type":172,"value":653},"str",{"type":167,"tag":219,"props":655,"children":656},{"style":317},[657],{"type":172,"value":320},{"type":167,"tag":219,"props":659,"children":660},{"style":650},[661],{"type":172,"value":662}," data",{"type":167,"tag":219,"props":664,"children":665},{"style":317},[666],{"type":172,"value":667},")",{"type":167,"tag":219,"props":669,"children":670},{"style":317},[671],{"type":172,"value":325},{"type":167,"tag":219,"props":673,"children":674},{"class":221,"line":290},[675],{"type":167,"tag":219,"props":676,"children":677},{"style":411},[678],{"type":172,"value":679},"    // Figure out if we're getting a template, or if we need to\n",{"type":167,"tag":219,"props":681,"children":682},{"class":221,"line":299},[683],{"type":167,"tag":219,"props":684,"children":685},{"style":411},[686],{"type":172,"value":687},"    // load the template - and be sure to cache the result.\n",{"type":167,"tag":219,"props":689,"children":690},{"class":221,"line":308},[691,696,701,705,710,715,721,725,729,734,738,742],{"type":167,"tag":219,"props":692,"children":693},{"style":565},[694],{"type":172,"value":695},"    var",{"type":167,"tag":219,"props":697,"children":698},{"style":232},[699],{"type":172,"value":700}," fn",{"type":167,"tag":219,"props":702,"children":703},{"style":593},[704],{"type":172,"value":596},{"type":167,"tag":219,"props":706,"children":707},{"style":593},[708],{"type":172,"value":709}," !",{"type":167,"tag":219,"props":711,"children":712},{"style":238},[713],{"type":172,"value":714},"/",{"type":167,"tag":219,"props":716,"children":718},{"style":717},"--shiki-light:#91B859;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[719],{"type":172,"value":720},"\\W",{"type":167,"tag":219,"props":722,"children":723},{"style":238},[724],{"type":172,"value":714},{"type":167,"tag":219,"props":726,"children":727},{"style":317},[728],{"type":172,"value":624},{"type":167,"tag":219,"props":730,"children":731},{"style":226},[732],{"type":172,"value":733},"test",{"type":167,"tag":219,"props":735,"children":736},{"style":332},[737],{"type":172,"value":235},{"type":167,"tag":219,"props":739,"children":740},{"style":232},[741],{"type":172,"value":653},{"type":167,"tag":219,"props":743,"children":744},{"style":332},[745],{"type":172,"value":384},{"type":167,"tag":219,"props":747,"children":748},{"class":221,"line":328},[749,754,759,764,769,773,778],{"type":167,"tag":219,"props":750,"children":751},{"style":593},[752],{"type":172,"value":753},"      ?",{"type":167,"tag":219,"props":755,"children":756},{"style":332},[757],{"type":172,"value":758}," (",{"type":167,"tag":219,"props":760,"children":761},{"style":232},[762],{"type":172,"value":763},"cache",{"type":167,"tag":219,"props":765,"children":766},{"style":332},[767],{"type":172,"value":768},"[",{"type":167,"tag":219,"props":770,"children":771},{"style":232},[772],{"type":172,"value":653},{"type":167,"tag":219,"props":774,"children":775},{"style":332},[776],{"type":172,"value":777},"] ",{"type":167,"tag":219,"props":779,"children":780},{"style":593},[781],{"type":172,"value":782},"=\n",{"type":167,"tag":219,"props":784,"children":785},{"class":221,"line":354},[786,791,795,799,803,808,812,816,821,825,830,834,838,842,846,851],{"type":167,"tag":219,"props":787,"children":788},{"style":232},[789],{"type":172,"value":790},"          cache",{"type":167,"tag":219,"props":792,"children":793},{"style":332},[794],{"type":172,"value":768},{"type":167,"tag":219,"props":796,"children":797},{"style":232},[798],{"type":172,"value":653},{"type":167,"tag":219,"props":800,"children":801},{"style":332},[802],{"type":172,"value":777},{"type":167,"tag":219,"props":804,"children":805},{"style":593},[806],{"type":172,"value":807},"||",{"type":167,"tag":219,"props":809,"children":810},{"style":226},[811],{"type":172,"value":643},{"type":167,"tag":219,"props":813,"children":814},{"style":332},[815],{"type":172,"value":235},{"type":167,"tag":219,"props":817,"children":818},{"style":232},[819],{"type":172,"value":820},"document",{"type":167,"tag":219,"props":822,"children":823},{"style":317},[824],{"type":172,"value":624},{"type":167,"tag":219,"props":826,"children":827},{"style":226},[828],{"type":172,"value":829},"getElementById",{"type":167,"tag":219,"props":831,"children":832},{"style":332},[833],{"type":172,"value":235},{"type":167,"tag":219,"props":835,"children":836},{"style":232},[837],{"type":172,"value":653},{"type":167,"tag":219,"props":839,"children":840},{"style":332},[841],{"type":172,"value":667},{"type":167,"tag":219,"props":843,"children":844},{"style":317},[845],{"type":172,"value":624},{"type":167,"tag":219,"props":847,"children":848},{"style":232},[849],{"type":172,"value":850},"innerHTML",{"type":167,"tag":219,"props":852,"children":853},{"style":332},[854],{"type":172,"value":855},"))\n",{"type":167,"tag":219,"props":857,"children":858},{"class":221,"line":373},[859,864],{"type":167,"tag":219,"props":860,"children":861},{"style":593},[862],{"type":172,"value":863},"      :",{"type":167,"tag":219,"props":865,"children":866},{"style":411},[867],{"type":172,"value":868}," // Generate a reusable function that will serve as a template\n",{"type":167,"tag":219,"props":870,"children":872},{"class":221,"line":871},13,[873],{"type":167,"tag":219,"props":874,"children":875},{"style":411},[876],{"type":172,"value":877},"        // generator (and which will be cached).\n",{"type":167,"tag":219,"props":879,"children":881},{"class":221,"line":880},14,[882,887,892],{"type":167,"tag":219,"props":883,"children":884},{"style":593},[885],{"type":172,"value":886},"        new",{"type":167,"tag":219,"props":888,"children":889},{"style":226},[890],{"type":172,"value":891}," Function",{"type":167,"tag":219,"props":893,"children":894},{"style":332},[895],{"type":172,"value":896},"(\n",{"type":167,"tag":219,"props":898,"children":900},{"class":221,"line":899},15,[901,906,911,916],{"type":167,"tag":219,"props":902,"children":903},{"style":238},[904],{"type":172,"value":905},"          \"",{"type":167,"tag":219,"props":907,"children":908},{"style":248},[909],{"type":172,"value":910},"obj",{"type":167,"tag":219,"props":912,"children":913},{"style":238},[914],{"type":172,"value":915},"\"",{"type":167,"tag":219,"props":917,"children":918},{"style":317},[919],{"type":172,"value":351},{"type":167,"tag":219,"props":921,"children":923},{"class":221,"line":922},16,[924,928,933,937],{"type":167,"tag":219,"props":925,"children":926},{"style":238},[927],{"type":172,"value":905},{"type":167,"tag":219,"props":929,"children":930},{"style":248},[931],{"type":172,"value":932},"var p=[],print=function(){p.push.apply(p,arguments);};",{"type":167,"tag":219,"props":934,"children":935},{"style":238},[936],{"type":172,"value":915},{"type":167,"tag":219,"props":938,"children":939},{"style":593},[940],{"type":172,"value":941}," +\n",{"type":167,"tag":219,"props":943,"children":945},{"class":221,"line":944},17,[946],{"type":167,"tag":219,"props":947,"children":948},{"style":411},[949],{"type":172,"value":950},"            // Introduce the data as local variables using with(){}\n",{"type":167,"tag":219,"props":952,"children":954},{"class":221,"line":953},18,[955,960,965,969],{"type":167,"tag":219,"props":956,"children":957},{"style":238},[958],{"type":172,"value":959},"            \"",{"type":167,"tag":219,"props":961,"children":962},{"style":248},[963],{"type":172,"value":964},"with(obj){p.push('",{"type":167,"tag":219,"props":966,"children":967},{"style":238},[968],{"type":172,"value":915},{"type":167,"tag":219,"props":970,"children":971},{"style":593},[972],{"type":172,"value":941},{"type":167,"tag":219,"props":974,"children":976},{"class":221,"line":975},19,[977],{"type":167,"tag":219,"props":978,"children":979},{"style":411},[980],{"type":172,"value":981},"            // Convert the template into pure JavaScript\n",{"type":167,"tag":219,"props":983,"children":985},{"class":221,"line":984},20,[986],{"type":167,"tag":219,"props":987,"children":988},{"style":232},[989],{"type":172,"value":990},"            str\n",{"type":167,"tag":219,"props":992,"children":994},{"class":221,"line":993},21,[995,1000,1005,1009,1013,1018,1023,1028,1032,1038,1042,1047,1051],{"type":167,"tag":219,"props":996,"children":997},{"style":317},[998],{"type":172,"value":999},"              .",{"type":167,"tag":219,"props":1001,"children":1002},{"style":226},[1003],{"type":172,"value":1004},"replace",{"type":167,"tag":219,"props":1006,"children":1007},{"style":332},[1008],{"type":172,"value":235},{"type":167,"tag":219,"props":1010,"children":1011},{"style":238},[1012],{"type":172,"value":714},{"type":167,"tag":219,"props":1014,"children":1016},{"style":1015},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[1017],{"type":172,"value":768},{"type":167,"tag":219,"props":1019,"children":1020},{"style":717},[1021],{"type":172,"value":1022},"\\r\\t\\n",{"type":167,"tag":219,"props":1024,"children":1025},{"style":1015},[1026],{"type":172,"value":1027},"]",{"type":167,"tag":219,"props":1029,"children":1030},{"style":238},[1031],{"type":172,"value":714},{"type":167,"tag":219,"props":1033,"children":1035},{"style":1034},"--shiki-light:#F76D47;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[1036],{"type":172,"value":1037},"g",{"type":167,"tag":219,"props":1039,"children":1040},{"style":317},[1041],{"type":172,"value":320},{"type":167,"tag":219,"props":1043,"children":1044},{"style":238},[1045],{"type":172,"value":1046}," \"",{"type":167,"tag":219,"props":1048,"children":1049},{"style":238},[1050],{"type":172,"value":1046},{"type":167,"tag":219,"props":1052,"children":1053},{"style":332},[1054],{"type":172,"value":384},{"type":167,"tag":219,"props":1056,"children":1058},{"class":221,"line":1057},22,[1059,1063,1068,1072,1076,1081,1085],{"type":167,"tag":219,"props":1060,"children":1061},{"style":317},[1062],{"type":172,"value":999},{"type":167,"tag":219,"props":1064,"children":1065},{"style":226},[1066],{"type":172,"value":1067},"split",{"type":167,"tag":219,"props":1069,"children":1070},{"style":332},[1071],{"type":172,"value":235},{"type":167,"tag":219,"props":1073,"children":1074},{"style":238},[1075],{"type":172,"value":915},{"type":167,"tag":219,"props":1077,"children":1078},{"style":248},[1079],{"type":172,"value":1080},"\u003C%",{"type":167,"tag":219,"props":1082,"children":1083},{"style":238},[1084],{"type":172,"value":915},{"type":167,"tag":219,"props":1086,"children":1087},{"style":332},[1088],{"type":172,"value":384},{"type":167,"tag":219,"props":1090,"children":1092},{"class":221,"line":1091},23,[1093,1097,1102,1106,1110,1116,1120],{"type":167,"tag":219,"props":1094,"children":1095},{"style":317},[1096],{"type":172,"value":999},{"type":167,"tag":219,"props":1098,"children":1099},{"style":226},[1100],{"type":172,"value":1101},"join",{"type":167,"tag":219,"props":1103,"children":1104},{"style":332},[1105],{"type":172,"value":235},{"type":167,"tag":219,"props":1107,"children":1108},{"style":238},[1109],{"type":172,"value":915},{"type":167,"tag":219,"props":1111,"children":1113},{"style":1112},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[1114],{"type":172,"value":1115},"\\t",{"type":167,"tag":219,"props":1117,"children":1118},{"style":238},[1119],{"type":172,"value":915},{"type":167,"tag":219,"props":1121,"children":1122},{"style":332},[1123],{"type":172,"value":384},{"type":167,"tag":219,"props":1125,"children":1127},{"class":221,"line":1126},24,[1128,1132,1136,1140,1144,1150,1156,1161,1167,1171,1175,1179,1183,1187,1192,1196,1201,1205,1209,1213,1217,1222,1227,1231],{"type":167,"tag":219,"props":1129,"children":1130},{"style":317},[1131],{"type":172,"value":999},{"type":167,"tag":219,"props":1133,"children":1134},{"style":226},[1135],{"type":172,"value":1004},{"type":167,"tag":219,"props":1137,"children":1138},{"style":332},[1139],{"type":172,"value":235},{"type":167,"tag":219,"props":1141,"children":1142},{"style":238},[1143],{"type":172,"value":714},{"type":167,"tag":219,"props":1145,"children":1147},{"style":1146},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#DBEDFF;--shiki-sepia:#E6DB74",[1148],{"type":172,"value":1149},"((",{"type":167,"tag":219,"props":1151,"children":1153},{"style":1152},"--shiki-light:#39ADB5;--shiki-light-font-style:italic;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#F92672;--shiki-sepia-font-style:inherit",[1154],{"type":172,"value":1155},"^",{"type":167,"tag":219,"props":1157,"children":1158},{"style":593},[1159],{"type":172,"value":1160},"|",{"type":167,"tag":219,"props":1162,"children":1164},{"style":1163},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#DBEDFF;--shiki-sepia:#E6DB74",[1165],{"type":172,"value":1166},"%>",{"type":167,"tag":219,"props":1168,"children":1169},{"style":1146},[1170],{"type":172,"value":667},{"type":167,"tag":219,"props":1172,"children":1173},{"style":1015},[1174],{"type":172,"value":768},{"type":167,"tag":219,"props":1176,"children":1177},{"style":593},[1178],{"type":172,"value":1155},{"type":167,"tag":219,"props":1180,"children":1181},{"style":717},[1182],{"type":172,"value":1115},{"type":167,"tag":219,"props":1184,"children":1185},{"style":1015},[1186],{"type":172,"value":1027},{"type":167,"tag":219,"props":1188,"children":1189},{"style":593},[1190],{"type":172,"value":1191},"*",{"type":167,"tag":219,"props":1193,"children":1194},{"style":1146},[1195],{"type":172,"value":667},{"type":167,"tag":219,"props":1197,"children":1198},{"style":1163},[1199],{"type":172,"value":1200},"'",{"type":167,"tag":219,"props":1202,"children":1203},{"style":238},[1204],{"type":172,"value":714},{"type":167,"tag":219,"props":1206,"children":1207},{"style":1034},[1208],{"type":172,"value":1037},{"type":167,"tag":219,"props":1210,"children":1211},{"style":317},[1212],{"type":172,"value":320},{"type":167,"tag":219,"props":1214,"children":1215},{"style":238},[1216],{"type":172,"value":1046},{"type":167,"tag":219,"props":1218,"children":1219},{"style":248},[1220],{"type":172,"value":1221},"$1",{"type":167,"tag":219,"props":1223,"children":1224},{"style":1112},[1225],{"type":172,"value":1226},"\\r",{"type":167,"tag":219,"props":1228,"children":1229},{"style":238},[1230],{"type":172,"value":915},{"type":167,"tag":219,"props":1232,"children":1233},{"style":332},[1234],{"type":172,"value":384},{"type":167,"tag":219,"props":1236,"children":1238},{"class":221,"line":1237},25,[1239,1243,1247,1251,1255,1259,1264,1268,1272,1277,1281,1285,1289,1293,1297,1301,1306,1310],{"type":167,"tag":219,"props":1240,"children":1241},{"style":317},[1242],{"type":172,"value":999},{"type":167,"tag":219,"props":1244,"children":1245},{"style":226},[1246],{"type":172,"value":1004},{"type":167,"tag":219,"props":1248,"children":1249},{"style":332},[1250],{"type":172,"value":235},{"type":167,"tag":219,"props":1252,"children":1253},{"style":238},[1254],{"type":172,"value":714},{"type":167,"tag":219,"props":1256,"children":1257},{"style":717},[1258],{"type":172,"value":1115},{"type":167,"tag":219,"props":1260,"children":1261},{"style":1163},[1262],{"type":172,"value":1263},"=",{"type":167,"tag":219,"props":1265,"children":1266},{"style":1146},[1267],{"type":172,"value":235},{"type":167,"tag":219,"props":1269,"children":1270},{"style":717},[1271],{"type":172,"value":624},{"type":167,"tag":219,"props":1273,"children":1274},{"style":593},[1275],{"type":172,"value":1276},"*?",{"type":167,"tag":219,"props":1278,"children":1279},{"style":1146},[1280],{"type":172,"value":667},{"type":167,"tag":219,"props":1282,"children":1283},{"style":1163},[1284],{"type":172,"value":1166},{"type":167,"tag":219,"props":1286,"children":1287},{"style":238},[1288],{"type":172,"value":714},{"type":167,"tag":219,"props":1290,"children":1291},{"style":1034},[1292],{"type":172,"value":1037},{"type":167,"tag":219,"props":1294,"children":1295},{"style":317},[1296],{"type":172,"value":320},{"type":167,"tag":219,"props":1298,"children":1299},{"style":238},[1300],{"type":172,"value":1046},{"type":167,"tag":219,"props":1302,"children":1303},{"style":248},[1304],{"type":172,"value":1305},"',$1,'",{"type":167,"tag":219,"props":1307,"children":1308},{"style":238},[1309],{"type":172,"value":915},{"type":167,"tag":219,"props":1311,"children":1312},{"style":332},[1313],{"type":172,"value":384},{"type":167,"tag":219,"props":1315,"children":1317},{"class":221,"line":1316},26,[1318,1322,1326,1330,1334,1338,1342],{"type":167,"tag":219,"props":1319,"children":1320},{"style":317},[1321],{"type":172,"value":999},{"type":167,"tag":219,"props":1323,"children":1324},{"style":226},[1325],{"type":172,"value":1067},{"type":167,"tag":219,"props":1327,"children":1328},{"style":332},[1329],{"type":172,"value":235},{"type":167,"tag":219,"props":1331,"children":1332},{"style":238},[1333],{"type":172,"value":915},{"type":167,"tag":219,"props":1335,"children":1336},{"style":1112},[1337],{"type":172,"value":1115},{"type":167,"tag":219,"props":1339,"children":1340},{"style":238},[1341],{"type":172,"value":915},{"type":167,"tag":219,"props":1343,"children":1344},{"style":332},[1345],{"type":172,"value":384},{"type":167,"tag":219,"props":1347,"children":1349},{"class":221,"line":1348},27,[1350,1354,1358,1362,1366,1371,1375],{"type":167,"tag":219,"props":1351,"children":1352},{"style":317},[1353],{"type":172,"value":999},{"type":167,"tag":219,"props":1355,"children":1356},{"style":226},[1357],{"type":172,"value":1101},{"type":167,"tag":219,"props":1359,"children":1360},{"style":332},[1361],{"type":172,"value":235},{"type":167,"tag":219,"props":1363,"children":1364},{"style":238},[1365],{"type":172,"value":915},{"type":167,"tag":219,"props":1367,"children":1368},{"style":248},[1369],{"type":172,"value":1370},"');",{"type":167,"tag":219,"props":1372,"children":1373},{"style":238},[1374],{"type":172,"value":915},{"type":167,"tag":219,"props":1376,"children":1377},{"style":332},[1378],{"type":172,"value":384},{"type":167,"tag":219,"props":1380,"children":1382},{"class":221,"line":1381},28,[1383,1387,1391,1395,1399,1403,1407],{"type":167,"tag":219,"props":1384,"children":1385},{"style":317},[1386],{"type":172,"value":999},{"type":167,"tag":219,"props":1388,"children":1389},{"style":226},[1390],{"type":172,"value":1067},{"type":167,"tag":219,"props":1392,"children":1393},{"style":332},[1394],{"type":172,"value":235},{"type":167,"tag":219,"props":1396,"children":1397},{"style":238},[1398],{"type":172,"value":915},{"type":167,"tag":219,"props":1400,"children":1401},{"style":248},[1402],{"type":172,"value":1166},{"type":167,"tag":219,"props":1404,"children":1405},{"style":238},[1406],{"type":172,"value":915},{"type":167,"tag":219,"props":1408,"children":1409},{"style":332},[1410],{"type":172,"value":384},{"type":167,"tag":219,"props":1412,"children":1414},{"class":221,"line":1413},29,[1415,1419,1423,1427,1431,1436,1440],{"type":167,"tag":219,"props":1416,"children":1417},{"style":317},[1418],{"type":172,"value":999},{"type":167,"tag":219,"props":1420,"children":1421},{"style":226},[1422],{"type":172,"value":1101},{"type":167,"tag":219,"props":1424,"children":1425},{"style":332},[1426],{"type":172,"value":235},{"type":167,"tag":219,"props":1428,"children":1429},{"style":238},[1430],{"type":172,"value":915},{"type":167,"tag":219,"props":1432,"children":1433},{"style":248},[1434],{"type":172,"value":1435},"p.push('",{"type":167,"tag":219,"props":1437,"children":1438},{"style":238},[1439],{"type":172,"value":915},{"type":167,"tag":219,"props":1441,"children":1442},{"style":332},[1443],{"type":172,"value":384},{"type":167,"tag":219,"props":1445,"children":1447},{"class":221,"line":1446},30,[1448,1452,1456,1460,1464,1468,1472],{"type":167,"tag":219,"props":1449,"children":1450},{"style":317},[1451],{"type":172,"value":999},{"type":167,"tag":219,"props":1453,"children":1454},{"style":226},[1455],{"type":172,"value":1067},{"type":167,"tag":219,"props":1457,"children":1458},{"style":332},[1459],{"type":172,"value":235},{"type":167,"tag":219,"props":1461,"children":1462},{"style":238},[1463],{"type":172,"value":915},{"type":167,"tag":219,"props":1465,"children":1466},{"style":1112},[1467],{"type":172,"value":1226},{"type":167,"tag":219,"props":1469,"children":1470},{"style":238},[1471],{"type":172,"value":915},{"type":167,"tag":219,"props":1473,"children":1474},{"style":332},[1475],{"type":172,"value":384},{"type":167,"tag":219,"props":1477,"children":1479},{"class":221,"line":1478},31,[1480,1484,1488,1492,1496,1501,1505,1509,1514],{"type":167,"tag":219,"props":1481,"children":1482},{"style":317},[1483],{"type":172,"value":999},{"type":167,"tag":219,"props":1485,"children":1486},{"style":226},[1487],{"type":172,"value":1101},{"type":167,"tag":219,"props":1489,"children":1490},{"style":332},[1491],{"type":172,"value":235},{"type":167,"tag":219,"props":1493,"children":1494},{"style":238},[1495],{"type":172,"value":915},{"type":167,"tag":219,"props":1497,"children":1498},{"style":1112},[1499],{"type":172,"value":1500},"\\\\",{"type":167,"tag":219,"props":1502,"children":1503},{"style":248},[1504],{"type":172,"value":1200},{"type":167,"tag":219,"props":1506,"children":1507},{"style":238},[1508],{"type":172,"value":915},{"type":167,"tag":219,"props":1510,"children":1511},{"style":332},[1512],{"type":172,"value":1513},") ",{"type":167,"tag":219,"props":1515,"children":1516},{"style":593},[1517],{"type":172,"value":1518},"+\n",{"type":167,"tag":219,"props":1520,"children":1522},{"class":221,"line":1521},32,[1523,1527,1532],{"type":167,"tag":219,"props":1524,"children":1525},{"style":238},[1526],{"type":172,"value":959},{"type":167,"tag":219,"props":1528,"children":1529},{"style":248},[1530],{"type":172,"value":1531},"');}return p.join('');",{"type":167,"tag":219,"props":1533,"children":1534},{"style":238},[1535],{"type":172,"value":1536},"\"\n",{"type":167,"tag":219,"props":1538,"children":1540},{"class":221,"line":1539},33,[1541,1546],{"type":167,"tag":219,"props":1542,"children":1543},{"style":332},[1544],{"type":172,"value":1545},"        )",{"type":167,"tag":219,"props":1547,"children":1548},{"style":317},[1549],{"type":172,"value":1550},";\n",{"type":167,"tag":219,"props":1552,"children":1554},{"class":221,"line":1553},34,[1555],{"type":167,"tag":219,"props":1556,"children":1557},{"emptyLinePlaceholder":607},[1558],{"type":172,"value":610},{"type":167,"tag":219,"props":1560,"children":1562},{"class":221,"line":1561},35,[1563],{"type":167,"tag":219,"props":1564,"children":1565},{"style":411},[1566],{"type":172,"value":1567},"    // Provide some basic currying to the user\n",{"type":167,"tag":219,"props":1569,"children":1571},{"class":221,"line":1570},36,[1572,1577,1581,1586,1590,1594,1599,1603,1607,1611],{"type":167,"tag":219,"props":1573,"children":1574},{"style":1152},[1575],{"type":172,"value":1576},"    return",{"type":167,"tag":219,"props":1578,"children":1579},{"style":232},[1580],{"type":172,"value":662},{"type":167,"tag":219,"props":1582,"children":1583},{"style":593},[1584],{"type":172,"value":1585}," ?",{"type":167,"tag":219,"props":1587,"children":1588},{"style":226},[1589],{"type":172,"value":700},{"type":167,"tag":219,"props":1591,"children":1592},{"style":332},[1593],{"type":172,"value":235},{"type":167,"tag":219,"props":1595,"children":1596},{"style":232},[1597],{"type":172,"value":1598},"data",{"type":167,"tag":219,"props":1600,"children":1601},{"style":332},[1602],{"type":172,"value":1513},{"type":167,"tag":219,"props":1604,"children":1605},{"style":593},[1606],{"type":172,"value":340},{"type":167,"tag":219,"props":1608,"children":1609},{"style":232},[1610],{"type":172,"value":700},{"type":167,"tag":219,"props":1612,"children":1613},{"style":317},[1614],{"type":172,"value":1550},{"type":167,"tag":219,"props":1616,"children":1618},{"class":221,"line":1617},37,[1619],{"type":167,"tag":219,"props":1620,"children":1621},{"style":317},[1622],{"type":172,"value":1623},"  };\n",{"type":167,"tag":219,"props":1625,"children":1627},{"class":221,"line":1626},38,[1628,1632,1637],{"type":167,"tag":219,"props":1629,"children":1630},{"style":317},[1631],{"type":172,"value":379},{"type":167,"tag":219,"props":1633,"children":1634},{"style":232},[1635],{"type":172,"value":1636},")()",{"type":167,"tag":219,"props":1638,"children":1639},{"style":317},[1640],{"type":172,"value":1550},{"type":167,"tag":168,"props":1642,"children":1643},{},[1644],{"type":172,"value":1645},"代码看完了，我知道你没看懂，因为曾经我也是。好了，留下三连，解析开始。",{"type":167,"tag":523,"props":1647,"children":1649},{"id":1648},"解析",[1650],{"type":172,"value":1648},{"type":167,"tag":168,"props":1652,"children":1653},{},[1654],{"type":172,"value":1655},"首先，代码最外层是一个 IIFE，给 this 对象挂载了 tmpl 函数，直接执行的话就是 window。内部通过局部变量保存了模板解析的缓存：",{"type":167,"tag":209,"props":1657,"children":1659},{"className":211,"code":1658,"language":213,"meta":161,"style":161},"(function () {\n  var cache = {};\n  this.tmpl = function tmpl(str, data) {};\n})();\n",[1660],{"type":167,"tag":183,"props":1661,"children":1662},{"__ignoreMap":161},[1663,1682,1701,1752],{"type":167,"tag":219,"props":1664,"children":1665},{"class":221,"line":222},[1666,1670,1674,1678],{"type":167,"tag":219,"props":1667,"children":1668},{"style":232},[1669],{"type":172,"value":235},{"type":167,"tag":219,"props":1671,"children":1672},{"style":565},[1673],{"type":172,"value":568},{"type":167,"tag":219,"props":1675,"children":1676},{"style":317},[1677],{"type":172,"value":573},{"type":167,"tag":219,"props":1679,"children":1680},{"style":317},[1681],{"type":172,"value":325},{"type":167,"tag":219,"props":1683,"children":1684},{"class":221,"line":244},[1685,1689,1693,1697],{"type":167,"tag":219,"props":1686,"children":1687},{"style":565},[1688],{"type":172,"value":585},{"type":167,"tag":219,"props":1690,"children":1691},{"style":232},[1692],{"type":172,"value":590},{"type":167,"tag":219,"props":1694,"children":1695},{"style":593},[1696],{"type":172,"value":596},{"type":167,"tag":219,"props":1698,"children":1699},{"style":317},[1700],{"type":172,"value":601},{"type":167,"tag":219,"props":1702,"children":1703},{"class":221,"line":254},[1704,1708,1712,1716,1720,1724,1728,1732,1736,1740,1744,1748],{"type":167,"tag":219,"props":1705,"children":1706},{"style":616},[1707],{"type":172,"value":619},{"type":167,"tag":219,"props":1709,"children":1710},{"style":317},[1711],{"type":172,"value":624},{"type":167,"tag":219,"props":1713,"children":1714},{"style":226},[1715],{"type":172,"value":629},{"type":167,"tag":219,"props":1717,"children":1718},{"style":593},[1719],{"type":172,"value":596},{"type":167,"tag":219,"props":1721,"children":1722},{"style":565},[1723],{"type":172,"value":638},{"type":167,"tag":219,"props":1725,"children":1726},{"style":226},[1727],{"type":172,"value":643},{"type":167,"tag":219,"props":1729,"children":1730},{"style":317},[1731],{"type":172,"value":235},{"type":167,"tag":219,"props":1733,"children":1734},{"style":650},[1735],{"type":172,"value":653},{"type":167,"tag":219,"props":1737,"children":1738},{"style":317},[1739],{"type":172,"value":320},{"type":167,"tag":219,"props":1741,"children":1742},{"style":650},[1743],{"type":172,"value":662},{"type":167,"tag":219,"props":1745,"children":1746},{"style":317},[1747],{"type":172,"value":667},{"type":167,"tag":219,"props":1749,"children":1750},{"style":317},[1751],{"type":172,"value":601},{"type":167,"tag":219,"props":1753,"children":1754},{"class":221,"line":263},[1755,1759,1763],{"type":167,"tag":219,"props":1756,"children":1757},{"style":317},[1758],{"type":172,"value":379},{"type":167,"tag":219,"props":1760,"children":1761},{"style":232},[1762],{"type":172,"value":1636},{"type":167,"tag":219,"props":1764,"children":1765},{"style":317},[1766],{"type":172,"value":1550},{"type":167,"tag":168,"props":1768,"children":1769},{},[1770,1772,1778],{"type":172,"value":1771},"str 参数有两种两种用途，",{"type":167,"tag":183,"props":1773,"children":1775},{"className":1774},[],[1776],{"type":172,"value":1777},"/\\W/.test(str)",{"type":172,"value":1779}," 用来判断字符串中包不包含模板分隔符，如果不含分隔符，即普通字符串，那就当作 ID，从页面对应 ID 的节点中获取内容作为模板。比如，如果 str 为 'user_tmpl'，那么模板函数将会读取页面的以下脚本的内容作为输入：",{"type":167,"tag":209,"props":1781,"children":1783},{"className":399,"code":1782,"language":401,"meta":161,"style":161},"\u003C!-- type=\"text/html\"，所以浏览器并不会执行这串脚本。它只能由 tmpl 来读取... -->\n\u003Cscript type=\"text/html\" id=\"item_tmpl\">\n  \u003Cdiv id=\"\u003C%=id%>\" class=\"\u003C%=(i % 2 == 1 ? \" even\" : \"\")%>\">\n    \u003Cdiv class=\"grid_1 alpha right\">\n      \u003Cimg class=\"righted\" src=\"\u003C%=profile_image_url%>\"/>\n    \u003C/div>\n    \u003Cdiv class=\"grid_6 omega contents\">\n      \u003Cp>\u003Cb>\u003Ca href=\"/\u003C%=from_user%>\">\u003C%=from_user%>\u003C/a>:\u003C/b> \u003C%=text%>\u003C/p>\n    \u003C/div>\n  \u003C/div>\n\u003C/script>\n",[1784],{"type":167,"tag":183,"props":1785,"children":1786},{"__ignoreMap":161},[1787,1795,1856,1940,1977,2038,2054,2090,2195,2210,2226],{"type":167,"tag":219,"props":1788,"children":1789},{"class":221,"line":222},[1790],{"type":167,"tag":219,"props":1791,"children":1792},{"style":411},[1793],{"type":172,"value":1794},"\u003C!-- type=\"text/html\"，所以浏览器并不会执行这串脚本。它只能由 tmpl 来读取... -->\n",{"type":167,"tag":219,"props":1796,"children":1797},{"class":221,"line":244},[1798,1802,1807,1813,1817,1821,1826,1830,1835,1839,1843,1848,1852],{"type":167,"tag":219,"props":1799,"children":1800},{"style":317},[1801],{"type":172,"value":422},{"type":167,"tag":219,"props":1803,"children":1804},{"style":425},[1805],{"type":172,"value":1806},"script",{"type":167,"tag":219,"props":1808,"children":1810},{"style":1809},"--shiki-light:#9C3EDA;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[1811],{"type":172,"value":1812}," type",{"type":167,"tag":219,"props":1814,"children":1815},{"style":317},[1816],{"type":172,"value":1263},{"type":167,"tag":219,"props":1818,"children":1819},{"style":238},[1820],{"type":172,"value":915},{"type":167,"tag":219,"props":1822,"children":1823},{"style":248},[1824],{"type":172,"value":1825},"text/html",{"type":167,"tag":219,"props":1827,"children":1828},{"style":238},[1829],{"type":172,"value":915},{"type":167,"tag":219,"props":1831,"children":1832},{"style":1809},[1833],{"type":172,"value":1834}," id",{"type":167,"tag":219,"props":1836,"children":1837},{"style":317},[1838],{"type":172,"value":1263},{"type":167,"tag":219,"props":1840,"children":1841},{"style":238},[1842],{"type":172,"value":915},{"type":167,"tag":219,"props":1844,"children":1845},{"style":248},[1846],{"type":172,"value":1847},"item_tmpl",{"type":167,"tag":219,"props":1849,"children":1850},{"style":238},[1851],{"type":172,"value":915},{"type":167,"tag":219,"props":1853,"children":1854},{"style":317},[1855],{"type":172,"value":452},{"type":167,"tag":219,"props":1857,"children":1858},{"class":221,"line":254},[1859,1864,1868,1872,1876,1880,1885,1889,1894,1898,1902,1907,1911,1916,1921,1926,1931,1935],{"type":167,"tag":219,"props":1860,"children":1861},{"style":317},[1862],{"type":172,"value":1863},"  \u003C",{"type":167,"tag":219,"props":1865,"children":1866},{"style":425},[1867],{"type":172,"value":428},{"type":167,"tag":219,"props":1869,"children":1870},{"style":1809},[1871],{"type":172,"value":1834},{"type":167,"tag":219,"props":1873,"children":1874},{"style":317},[1875],{"type":172,"value":1263},{"type":167,"tag":219,"props":1877,"children":1878},{"style":238},[1879],{"type":172,"value":915},{"type":167,"tag":219,"props":1881,"children":1882},{"style":248},[1883],{"type":172,"value":1884},"\u003C%=id%>",{"type":167,"tag":219,"props":1886,"children":1887},{"style":238},[1888],{"type":172,"value":915},{"type":167,"tag":219,"props":1890,"children":1891},{"style":1809},[1892],{"type":172,"value":1893}," class",{"type":167,"tag":219,"props":1895,"children":1896},{"style":317},[1897],{"type":172,"value":1263},{"type":167,"tag":219,"props":1899,"children":1900},{"style":238},[1901],{"type":172,"value":915},{"type":167,"tag":219,"props":1903,"children":1904},{"style":248},[1905],{"type":172,"value":1906},"\u003C%=(i % 2 == 1 ? ",{"type":167,"tag":219,"props":1908,"children":1909},{"style":238},[1910],{"type":172,"value":915},{"type":167,"tag":219,"props":1912,"children":1913},{"style":1809},[1914],{"type":172,"value":1915}," even",{"type":167,"tag":219,"props":1917,"children":1919},{"style":1918},"--shiki-light:#39ADB5;--shiki-light-font-style:inherit;--shiki-default:#B31D28;--shiki-default-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;--shiki-sepia:#F44747;--shiki-sepia-font-style:inherit",[1920],{"type":172,"value":915},{"type":167,"tag":219,"props":1922,"children":1923},{"style":1809},[1924],{"type":172,"value":1925}," :",{"type":167,"tag":219,"props":1927,"children":1928},{"style":1918},[1929],{"type":172,"value":1930}," \"\")%",{"type":167,"tag":219,"props":1932,"children":1933},{"style":317},[1934],{"type":172,"value":433},{"type":167,"tag":219,"props":1936,"children":1937},{"style":232},[1938],{"type":172,"value":1939},"\">\n",{"type":167,"tag":219,"props":1941,"children":1942},{"class":221,"line":263},[1943,1948,1952,1956,1960,1964,1969,1973],{"type":167,"tag":219,"props":1944,"children":1945},{"style":317},[1946],{"type":172,"value":1947},"    \u003C",{"type":167,"tag":219,"props":1949,"children":1950},{"style":425},[1951],{"type":172,"value":428},{"type":167,"tag":219,"props":1953,"children":1954},{"style":1809},[1955],{"type":172,"value":1893},{"type":167,"tag":219,"props":1957,"children":1958},{"style":317},[1959],{"type":172,"value":1263},{"type":167,"tag":219,"props":1961,"children":1962},{"style":238},[1963],{"type":172,"value":915},{"type":167,"tag":219,"props":1965,"children":1966},{"style":248},[1967],{"type":172,"value":1968},"grid_1 alpha right",{"type":167,"tag":219,"props":1970,"children":1971},{"style":238},[1972],{"type":172,"value":915},{"type":167,"tag":219,"props":1974,"children":1975},{"style":317},[1976],{"type":172,"value":452},{"type":167,"tag":219,"props":1978,"children":1979},{"class":221,"line":272},[1980,1985,1990,1994,1998,2002,2007,2011,2016,2020,2024,2029,2033],{"type":167,"tag":219,"props":1981,"children":1982},{"style":317},[1983],{"type":172,"value":1984},"      \u003C",{"type":167,"tag":219,"props":1986,"children":1987},{"style":425},[1988],{"type":172,"value":1989},"img",{"type":167,"tag":219,"props":1991,"children":1992},{"style":1809},[1993],{"type":172,"value":1893},{"type":167,"tag":219,"props":1995,"children":1996},{"style":317},[1997],{"type":172,"value":1263},{"type":167,"tag":219,"props":1999,"children":2000},{"style":238},[2001],{"type":172,"value":915},{"type":167,"tag":219,"props":2003,"children":2004},{"style":248},[2005],{"type":172,"value":2006},"righted",{"type":167,"tag":219,"props":2008,"children":2009},{"style":238},[2010],{"type":172,"value":915},{"type":167,"tag":219,"props":2012,"children":2013},{"style":1809},[2014],{"type":172,"value":2015}," src",{"type":167,"tag":219,"props":2017,"children":2018},{"style":317},[2019],{"type":172,"value":1263},{"type":167,"tag":219,"props":2021,"children":2022},{"style":238},[2023],{"type":172,"value":915},{"type":167,"tag":219,"props":2025,"children":2026},{"style":248},[2027],{"type":172,"value":2028},"\u003C%=profile_image_url%>",{"type":167,"tag":219,"props":2030,"children":2031},{"style":238},[2032],{"type":172,"value":915},{"type":167,"tag":219,"props":2034,"children":2035},{"style":317},[2036],{"type":172,"value":2037},"/>\n",{"type":167,"tag":219,"props":2039,"children":2040},{"class":221,"line":281},[2041,2046,2050],{"type":167,"tag":219,"props":2042,"children":2043},{"style":317},[2044],{"type":172,"value":2045},"    \u003C/",{"type":167,"tag":219,"props":2047,"children":2048},{"style":425},[2049],{"type":172,"value":428},{"type":167,"tag":219,"props":2051,"children":2052},{"style":317},[2053],{"type":172,"value":452},{"type":167,"tag":219,"props":2055,"children":2056},{"class":221,"line":290},[2057,2061,2065,2069,2073,2077,2082,2086],{"type":167,"tag":219,"props":2058,"children":2059},{"style":317},[2060],{"type":172,"value":1947},{"type":167,"tag":219,"props":2062,"children":2063},{"style":425},[2064],{"type":172,"value":428},{"type":167,"tag":219,"props":2066,"children":2067},{"style":1809},[2068],{"type":172,"value":1893},{"type":167,"tag":219,"props":2070,"children":2071},{"style":317},[2072],{"type":172,"value":1263},{"type":167,"tag":219,"props":2074,"children":2075},{"style":238},[2076],{"type":172,"value":915},{"type":167,"tag":219,"props":2078,"children":2079},{"style":248},[2080],{"type":172,"value":2081},"grid_6 omega contents",{"type":167,"tag":219,"props":2083,"children":2084},{"style":238},[2085],{"type":172,"value":915},{"type":167,"tag":219,"props":2087,"children":2088},{"style":317},[2089],{"type":172,"value":452},{"type":167,"tag":219,"props":2091,"children":2092},{"class":221,"line":299},[2093,2097,2101,2106,2111,2115,2119,2124,2128,2132,2137,2141,2145,2150,2154,2158,2162,2166,2170,2174,2178,2183,2187,2191],{"type":167,"tag":219,"props":2094,"children":2095},{"style":317},[2096],{"type":172,"value":1984},{"type":167,"tag":219,"props":2098,"children":2099},{"style":425},[2100],{"type":172,"value":168},{"type":167,"tag":219,"props":2102,"children":2103},{"style":317},[2104],{"type":172,"value":2105},">\u003C",{"type":167,"tag":219,"props":2107,"children":2108},{"style":425},[2109],{"type":172,"value":2110},"b",{"type":167,"tag":219,"props":2112,"children":2113},{"style":317},[2114],{"type":172,"value":2105},{"type":167,"tag":219,"props":2116,"children":2117},{"style":425},[2118],{"type":172,"value":175},{"type":167,"tag":219,"props":2120,"children":2121},{"style":1809},[2122],{"type":172,"value":2123}," href",{"type":167,"tag":219,"props":2125,"children":2126},{"style":317},[2127],{"type":172,"value":1263},{"type":167,"tag":219,"props":2129,"children":2130},{"style":238},[2131],{"type":172,"value":915},{"type":167,"tag":219,"props":2133,"children":2134},{"style":248},[2135],{"type":172,"value":2136},"/\u003C%=from_user%>",{"type":167,"tag":219,"props":2138,"children":2139},{"style":238},[2140],{"type":172,"value":915},{"type":167,"tag":219,"props":2142,"children":2143},{"style":317},[2144],{"type":172,"value":433},{"type":167,"tag":219,"props":2146,"children":2147},{"style":232},[2148],{"type":172,"value":2149},"\u003C%=from_user%>",{"type":167,"tag":219,"props":2151,"children":2152},{"style":317},[2153],{"type":172,"value":443},{"type":167,"tag":219,"props":2155,"children":2156},{"style":425},[2157],{"type":172,"value":175},{"type":167,"tag":219,"props":2159,"children":2160},{"style":317},[2161],{"type":172,"value":433},{"type":167,"tag":219,"props":2163,"children":2164},{"style":232},[2165],{"type":172,"value":340},{"type":167,"tag":219,"props":2167,"children":2168},{"style":317},[2169],{"type":172,"value":443},{"type":167,"tag":219,"props":2171,"children":2172},{"style":425},[2173],{"type":172,"value":2110},{"type":167,"tag":219,"props":2175,"children":2176},{"style":317},[2177],{"type":172,"value":433},{"type":167,"tag":219,"props":2179,"children":2180},{"style":232},[2181],{"type":172,"value":2182}," \u003C%=text%>",{"type":167,"tag":219,"props":2184,"children":2185},{"style":317},[2186],{"type":172,"value":443},{"type":167,"tag":219,"props":2188,"children":2189},{"style":425},[2190],{"type":172,"value":168},{"type":167,"tag":219,"props":2192,"children":2193},{"style":317},[2194],{"type":172,"value":452},{"type":167,"tag":219,"props":2196,"children":2197},{"class":221,"line":308},[2198,2202,2206],{"type":167,"tag":219,"props":2199,"children":2200},{"style":317},[2201],{"type":172,"value":2045},{"type":167,"tag":219,"props":2203,"children":2204},{"style":425},[2205],{"type":172,"value":428},{"type":167,"tag":219,"props":2207,"children":2208},{"style":317},[2209],{"type":172,"value":452},{"type":167,"tag":219,"props":2211,"children":2212},{"class":221,"line":328},[2213,2218,2222],{"type":167,"tag":219,"props":2214,"children":2215},{"style":317},[2216],{"type":172,"value":2217},"  \u003C/",{"type":167,"tag":219,"props":2219,"children":2220},{"style":425},[2221],{"type":172,"value":428},{"type":167,"tag":219,"props":2223,"children":2224},{"style":317},[2225],{"type":172,"value":452},{"type":167,"tag":219,"props":2227,"children":2228},{"class":221,"line":354},[2229,2233,2237],{"type":167,"tag":219,"props":2230,"children":2231},{"style":317},[2232],{"type":172,"value":443},{"type":167,"tag":219,"props":2234,"children":2235},{"style":425},[2236],{"type":172,"value":1806},{"type":167,"tag":219,"props":2238,"children":2239},{"style":317},[2240],{"type":172,"value":452},{"type":167,"tag":209,"props":2242,"children":2244},{"className":211,"code":2243,"language":213,"meta":161,"style":161},"(function () {\n  var cache = {};\n  this.tmpl = function tmpl(str, data) {\n    return !/\\W/.test(str)\n      ? // 缓存会将读取脚本内容到模板解析这个过程的解析结果缓存下来\n        (cache[str] =\n          cache[str] ||\n          // 读取脚本内容\n          tmpl(document.getElementById(str).innerHTML))\n      : new Function();\n  };\n})();\n",[2245],{"type":167,"tag":183,"props":2246,"children":2247},{"__ignoreMap":161},[2248,2267,2286,2337,2380,2392,2420,2444,2452,2500,2525,2532],{"type":167,"tag":219,"props":2249,"children":2250},{"class":221,"line":222},[2251,2255,2259,2263],{"type":167,"tag":219,"props":2252,"children":2253},{"style":232},[2254],{"type":172,"value":235},{"type":167,"tag":219,"props":2256,"children":2257},{"style":565},[2258],{"type":172,"value":568},{"type":167,"tag":219,"props":2260,"children":2261},{"style":317},[2262],{"type":172,"value":573},{"type":167,"tag":219,"props":2264,"children":2265},{"style":317},[2266],{"type":172,"value":325},{"type":167,"tag":219,"props":2268,"children":2269},{"class":221,"line":244},[2270,2274,2278,2282],{"type":167,"tag":219,"props":2271,"children":2272},{"style":565},[2273],{"type":172,"value":585},{"type":167,"tag":219,"props":2275,"children":2276},{"style":232},[2277],{"type":172,"value":590},{"type":167,"tag":219,"props":2279,"children":2280},{"style":593},[2281],{"type":172,"value":596},{"type":167,"tag":219,"props":2283,"children":2284},{"style":317},[2285],{"type":172,"value":601},{"type":167,"tag":219,"props":2287,"children":2288},{"class":221,"line":254},[2289,2293,2297,2301,2305,2309,2313,2317,2321,2325,2329,2333],{"type":167,"tag":219,"props":2290,"children":2291},{"style":616},[2292],{"type":172,"value":619},{"type":167,"tag":219,"props":2294,"children":2295},{"style":317},[2296],{"type":172,"value":624},{"type":167,"tag":219,"props":2298,"children":2299},{"style":226},[2300],{"type":172,"value":629},{"type":167,"tag":219,"props":2302,"children":2303},{"style":593},[2304],{"type":172,"value":596},{"type":167,"tag":219,"props":2306,"children":2307},{"style":565},[2308],{"type":172,"value":638},{"type":167,"tag":219,"props":2310,"children":2311},{"style":226},[2312],{"type":172,"value":643},{"type":167,"tag":219,"props":2314,"children":2315},{"style":317},[2316],{"type":172,"value":235},{"type":167,"tag":219,"props":2318,"children":2319},{"style":650},[2320],{"type":172,"value":653},{"type":167,"tag":219,"props":2322,"children":2323},{"style":317},[2324],{"type":172,"value":320},{"type":167,"tag":219,"props":2326,"children":2327},{"style":650},[2328],{"type":172,"value":662},{"type":167,"tag":219,"props":2330,"children":2331},{"style":317},[2332],{"type":172,"value":667},{"type":167,"tag":219,"props":2334,"children":2335},{"style":317},[2336],{"type":172,"value":325},{"type":167,"tag":219,"props":2338,"children":2339},{"class":221,"line":263},[2340,2344,2348,2352,2356,2360,2364,2368,2372,2376],{"type":167,"tag":219,"props":2341,"children":2342},{"style":1152},[2343],{"type":172,"value":1576},{"type":167,"tag":219,"props":2345,"children":2346},{"style":593},[2347],{"type":172,"value":709},{"type":167,"tag":219,"props":2349,"children":2350},{"style":238},[2351],{"type":172,"value":714},{"type":167,"tag":219,"props":2353,"children":2354},{"style":717},[2355],{"type":172,"value":720},{"type":167,"tag":219,"props":2357,"children":2358},{"style":238},[2359],{"type":172,"value":714},{"type":167,"tag":219,"props":2361,"children":2362},{"style":317},[2363],{"type":172,"value":624},{"type":167,"tag":219,"props":2365,"children":2366},{"style":226},[2367],{"type":172,"value":733},{"type":167,"tag":219,"props":2369,"children":2370},{"style":332},[2371],{"type":172,"value":235},{"type":167,"tag":219,"props":2373,"children":2374},{"style":232},[2375],{"type":172,"value":653},{"type":167,"tag":219,"props":2377,"children":2378},{"style":332},[2379],{"type":172,"value":384},{"type":167,"tag":219,"props":2381,"children":2382},{"class":221,"line":272},[2383,2387],{"type":167,"tag":219,"props":2384,"children":2385},{"style":593},[2386],{"type":172,"value":753},{"type":167,"tag":219,"props":2388,"children":2389},{"style":411},[2390],{"type":172,"value":2391}," // 缓存会将读取脚本内容到模板解析这个过程的解析结果缓存下来\n",{"type":167,"tag":219,"props":2393,"children":2394},{"class":221,"line":281},[2395,2400,2404,2408,2412,2416],{"type":167,"tag":219,"props":2396,"children":2397},{"style":332},[2398],{"type":172,"value":2399},"        (",{"type":167,"tag":219,"props":2401,"children":2402},{"style":232},[2403],{"type":172,"value":763},{"type":167,"tag":219,"props":2405,"children":2406},{"style":332},[2407],{"type":172,"value":768},{"type":167,"tag":219,"props":2409,"children":2410},{"style":232},[2411],{"type":172,"value":653},{"type":167,"tag":219,"props":2413,"children":2414},{"style":332},[2415],{"type":172,"value":777},{"type":167,"tag":219,"props":2417,"children":2418},{"style":593},[2419],{"type":172,"value":782},{"type":167,"tag":219,"props":2421,"children":2422},{"class":221,"line":290},[2423,2427,2431,2435,2439],{"type":167,"tag":219,"props":2424,"children":2425},{"style":232},[2426],{"type":172,"value":790},{"type":167,"tag":219,"props":2428,"children":2429},{"style":332},[2430],{"type":172,"value":768},{"type":167,"tag":219,"props":2432,"children":2433},{"style":232},[2434],{"type":172,"value":653},{"type":167,"tag":219,"props":2436,"children":2437},{"style":332},[2438],{"type":172,"value":777},{"type":167,"tag":219,"props":2440,"children":2441},{"style":593},[2442],{"type":172,"value":2443},"||\n",{"type":167,"tag":219,"props":2445,"children":2446},{"class":221,"line":299},[2447],{"type":167,"tag":219,"props":2448,"children":2449},{"style":411},[2450],{"type":172,"value":2451},"          // 读取脚本内容\n",{"type":167,"tag":219,"props":2453,"children":2454},{"class":221,"line":308},[2455,2460,2464,2468,2472,2476,2480,2484,2488,2492,2496],{"type":167,"tag":219,"props":2456,"children":2457},{"style":226},[2458],{"type":172,"value":2459},"          tmpl",{"type":167,"tag":219,"props":2461,"children":2462},{"style":332},[2463],{"type":172,"value":235},{"type":167,"tag":219,"props":2465,"children":2466},{"style":232},[2467],{"type":172,"value":820},{"type":167,"tag":219,"props":2469,"children":2470},{"style":317},[2471],{"type":172,"value":624},{"type":167,"tag":219,"props":2473,"children":2474},{"style":226},[2475],{"type":172,"value":829},{"type":167,"tag":219,"props":2477,"children":2478},{"style":332},[2479],{"type":172,"value":235},{"type":167,"tag":219,"props":2481,"children":2482},{"style":232},[2483],{"type":172,"value":653},{"type":167,"tag":219,"props":2485,"children":2486},{"style":332},[2487],{"type":172,"value":667},{"type":167,"tag":219,"props":2489,"children":2490},{"style":317},[2491],{"type":172,"value":624},{"type":167,"tag":219,"props":2493,"children":2494},{"style":232},[2495],{"type":172,"value":850},{"type":167,"tag":219,"props":2497,"children":2498},{"style":332},[2499],{"type":172,"value":855},{"type":167,"tag":219,"props":2501,"children":2502},{"class":221,"line":328},[2503,2507,2512,2516,2521],{"type":167,"tag":219,"props":2504,"children":2505},{"style":593},[2506],{"type":172,"value":863},{"type":167,"tag":219,"props":2508,"children":2509},{"style":593},[2510],{"type":172,"value":2511}," new",{"type":167,"tag":219,"props":2513,"children":2514},{"style":226},[2515],{"type":172,"value":891},{"type":167,"tag":219,"props":2517,"children":2518},{"style":332},[2519],{"type":172,"value":2520},"()",{"type":167,"tag":219,"props":2522,"children":2523},{"style":317},[2524],{"type":172,"value":1550},{"type":167,"tag":219,"props":2526,"children":2527},{"class":221,"line":354},[2528],{"type":167,"tag":219,"props":2529,"children":2530},{"style":317},[2531],{"type":172,"value":1623},{"type":167,"tag":219,"props":2533,"children":2534},{"class":221,"line":373},[2535,2539,2543],{"type":167,"tag":219,"props":2536,"children":2537},{"style":317},[2538],{"type":172,"value":379},{"type":167,"tag":219,"props":2540,"children":2541},{"style":232},[2542],{"type":172,"value":1636},{"type":167,"tag":219,"props":2544,"children":2545},{"style":317},[2546],{"type":172,"value":1550},{"type":167,"tag":168,"props":2548,"children":2549},{},[2550,2556],{"type":167,"tag":183,"props":2551,"children":2553},{"className":2552},[],[2554],{"type":172,"value":2555},"new Function()",{"type":172,"value":2557}," 即模板解析的核心内容，原理是用一个数组，保存所有解析内容，再拼接回字符串，作为 JS 执行。类似 eval 函数。",{"type":167,"tag":209,"props":2559,"children":2561},{"className":211,"code":2560,"language":213,"meta":161,"style":161},"new Function(\n  \"obj\",\n  \"var p=[];\" +\n    // + '...'\n    \"return p.join('')\"\n);\n",[2562],{"type":167,"tag":183,"props":2563,"children":2564},{"__ignoreMap":161},[2565,2581,2601,2621,2629,2646],{"type":167,"tag":219,"props":2566,"children":2567},{"class":221,"line":222},[2568,2573,2577],{"type":167,"tag":219,"props":2569,"children":2570},{"style":593},[2571],{"type":172,"value":2572},"new",{"type":167,"tag":219,"props":2574,"children":2575},{"style":226},[2576],{"type":172,"value":891},{"type":167,"tag":219,"props":2578,"children":2579},{"style":232},[2580],{"type":172,"value":896},{"type":167,"tag":219,"props":2582,"children":2583},{"class":221,"line":244},[2584,2589,2593,2597],{"type":167,"tag":219,"props":2585,"children":2586},{"style":238},[2587],{"type":172,"value":2588},"  \"",{"type":167,"tag":219,"props":2590,"children":2591},{"style":248},[2592],{"type":172,"value":910},{"type":167,"tag":219,"props":2594,"children":2595},{"style":238},[2596],{"type":172,"value":915},{"type":167,"tag":219,"props":2598,"children":2599},{"style":317},[2600],{"type":172,"value":351},{"type":167,"tag":219,"props":2602,"children":2603},{"class":221,"line":254},[2604,2608,2613,2617],{"type":167,"tag":219,"props":2605,"children":2606},{"style":238},[2607],{"type":172,"value":2588},{"type":167,"tag":219,"props":2609,"children":2610},{"style":248},[2611],{"type":172,"value":2612},"var p=[];",{"type":167,"tag":219,"props":2614,"children":2615},{"style":238},[2616],{"type":172,"value":915},{"type":167,"tag":219,"props":2618,"children":2619},{"style":593},[2620],{"type":172,"value":941},{"type":167,"tag":219,"props":2622,"children":2623},{"class":221,"line":263},[2624],{"type":167,"tag":219,"props":2625,"children":2626},{"style":411},[2627],{"type":172,"value":2628},"    // + '...'\n",{"type":167,"tag":219,"props":2630,"children":2631},{"class":221,"line":272},[2632,2637,2642],{"type":167,"tag":219,"props":2633,"children":2634},{"style":238},[2635],{"type":172,"value":2636},"    \"",{"type":167,"tag":219,"props":2638,"children":2639},{"style":248},[2640],{"type":172,"value":2641},"return p.join('')",{"type":167,"tag":219,"props":2643,"children":2644},{"style":238},[2645],{"type":172,"value":1536},{"type":167,"tag":219,"props":2647,"children":2648},{"class":221,"line":281},[2649,2653],{"type":167,"tag":219,"props":2650,"children":2651},{"style":232},[2652],{"type":172,"value":667},{"type":167,"tag":219,"props":2654,"children":2655},{"style":317},[2656],{"type":172,"value":1550},{"type":167,"tag":168,"props":2658,"children":2659},{},[2660,2662,2668],{"type":172,"value":2661},"要解析什么内容呢？无非是 ",{"type":167,"tag":183,"props":2663,"children":2665},{"className":2664},[],[2666],{"type":172,"value":2667},"\u003C%=hello%>",{"type":172,"value":2669}," 这种模板字符串。执行过程中，通过 with 语句，将内部变量的求值（hello）转移到参数对象（data.hello）。这个玩意儿在 VueJS 的模板编译中也用到过：",{"type":167,"tag":209,"props":2671,"children":2673},{"className":211,"code":2672,"language":213,"meta":161,"style":161},"/* VueJS */\nwith (vm) {\n  return createVNode(\"p\", { attrs: { hi: hello /* vm.hello */ } }, [\n    createTextNode(\"Hello World\"),\n  ]);\n}\n",[2674],{"type":167,"tag":183,"props":2675,"children":2676},{"__ignoreMap":161},[2677,2685,2703,2788,2821,2833],{"type":167,"tag":219,"props":2678,"children":2679},{"class":221,"line":222},[2680],{"type":167,"tag":219,"props":2681,"children":2682},{"style":411},[2683],{"type":172,"value":2684},"/* VueJS */\n",{"type":167,"tag":219,"props":2686,"children":2687},{"class":221,"line":244},[2688,2693,2698],{"type":167,"tag":219,"props":2689,"children":2690},{"style":1152},[2691],{"type":172,"value":2692},"with",{"type":167,"tag":219,"props":2694,"children":2695},{"style":232},[2696],{"type":172,"value":2697}," (vm) ",{"type":167,"tag":219,"props":2699,"children":2700},{"style":317},[2701],{"type":172,"value":2702},"{\n",{"type":167,"tag":219,"props":2704,"children":2705},{"class":221,"line":254},[2706,2711,2716,2720,2724,2728,2732,2736,2741,2746,2750,2754,2759,2763,2768,2773,2778,2783],{"type":167,"tag":219,"props":2707,"children":2708},{"style":1152},[2709],{"type":172,"value":2710},"  return",{"type":167,"tag":219,"props":2712,"children":2713},{"style":226},[2714],{"type":172,"value":2715}," createVNode",{"type":167,"tag":219,"props":2717,"children":2718},{"style":332},[2719],{"type":172,"value":235},{"type":167,"tag":219,"props":2721,"children":2722},{"style":238},[2723],{"type":172,"value":915},{"type":167,"tag":219,"props":2725,"children":2726},{"style":248},[2727],{"type":172,"value":168},{"type":167,"tag":219,"props":2729,"children":2730},{"style":238},[2731],{"type":172,"value":915},{"type":167,"tag":219,"props":2733,"children":2734},{"style":317},[2735],{"type":172,"value":320},{"type":167,"tag":219,"props":2737,"children":2738},{"style":317},[2739],{"type":172,"value":2740}," {",{"type":167,"tag":219,"props":2742,"children":2743},{"style":332},[2744],{"type":172,"value":2745}," attrs",{"type":167,"tag":219,"props":2747,"children":2748},{"style":317},[2749],{"type":172,"value":340},{"type":167,"tag":219,"props":2751,"children":2752},{"style":317},[2753],{"type":172,"value":2740},{"type":167,"tag":219,"props":2755,"children":2756},{"style":332},[2757],{"type":172,"value":2758}," hi",{"type":167,"tag":219,"props":2760,"children":2761},{"style":317},[2762],{"type":172,"value":340},{"type":167,"tag":219,"props":2764,"children":2765},{"style":232},[2766],{"type":172,"value":2767}," hello",{"type":167,"tag":219,"props":2769,"children":2770},{"style":411},[2771],{"type":172,"value":2772}," /* vm.hello */",{"type":167,"tag":219,"props":2774,"children":2775},{"style":317},[2776],{"type":172,"value":2777}," }",{"type":167,"tag":219,"props":2779,"children":2780},{"style":317},[2781],{"type":172,"value":2782}," },",{"type":167,"tag":219,"props":2784,"children":2785},{"style":332},[2786],{"type":172,"value":2787}," [\n",{"type":167,"tag":219,"props":2789,"children":2790},{"class":221,"line":263},[2791,2796,2800,2804,2809,2813,2817],{"type":167,"tag":219,"props":2792,"children":2793},{"style":226},[2794],{"type":172,"value":2795},"    createTextNode",{"type":167,"tag":219,"props":2797,"children":2798},{"style":332},[2799],{"type":172,"value":235},{"type":167,"tag":219,"props":2801,"children":2802},{"style":238},[2803],{"type":172,"value":915},{"type":167,"tag":219,"props":2805,"children":2806},{"style":248},[2807],{"type":172,"value":2808},"Hello World",{"type":167,"tag":219,"props":2810,"children":2811},{"style":238},[2812],{"type":172,"value":915},{"type":167,"tag":219,"props":2814,"children":2815},{"style":332},[2816],{"type":172,"value":667},{"type":167,"tag":219,"props":2818,"children":2819},{"style":317},[2820],{"type":172,"value":351},{"type":167,"tag":219,"props":2822,"children":2823},{"class":221,"line":272},[2824,2829],{"type":167,"tag":219,"props":2825,"children":2826},{"style":332},[2827],{"type":172,"value":2828},"  ])",{"type":167,"tag":219,"props":2830,"children":2831},{"style":317},[2832],{"type":172,"value":1550},{"type":167,"tag":219,"props":2834,"children":2835},{"class":221,"line":281},[2836],{"type":167,"tag":219,"props":2837,"children":2838},{"style":317},[2839],{"type":172,"value":2840},"}\n",{"type":167,"tag":168,"props":2842,"children":2843},{},[2844],{"type":172,"value":2845},"那如何解析呢？",{"type":167,"tag":168,"props":2847,"children":2848},{},[2849,2855,2857,2863],{"type":167,"tag":2850,"props":2851,"children":2852},"del",{},[2853],{"type":172,"value":2854},"我们知道",{"type":172,"value":2856},"曾写过经典字符串模板的佬应该知道，",{"type":167,"tag":2858,"props":2859,"children":2860},"strong",{},[2861],{"type":172,"value":2862},"模板字符串一般包含：字符串、变量及逻辑",{"type":172,"value":2864},"。",{"type":167,"tag":2866,"props":2867,"children":2868},"ul",{},[2869,2881,2892],{"type":167,"tag":2870,"props":2871,"children":2872},"li",{},[2873,2875],{"type":172,"value":2874},"字符串 ",{"type":167,"tag":183,"props":2876,"children":2878},{"className":2877},[],[2879],{"type":172,"value":2880},"\u003Chtml>Lionad\u003C/html>",{"type":167,"tag":2870,"props":2882,"children":2883},{},[2884,2886],{"type":172,"value":2885},"带变量 ",{"type":167,"tag":183,"props":2887,"children":2889},{"className":2888},[],[2890],{"type":172,"value":2891},"\u003Chtml>\u003C%=name%>\u003C/html>",{"type":167,"tag":2870,"props":2893,"children":2894},{},[2895,2897,2903],{"type":172,"value":2896},"带逻辑 ",{"type":167,"tag":183,"props":2898,"children":2900},{"className":2899},[],[2901],{"type":172,"value":2902},"\u003C% if(name){ %>\u003Chtml>\u003C%=name%>\u003C/html>\u003C% } %>",{"type":172,"value":2864},{"type":167,"tag":168,"props":2905,"children":2906},{},[2907],{"type":172,"value":2908},"所以解析模板，无非就是把这三种字符串替换成纯粹的 JS 逻辑，作为 new Function 的参数。其中所有中间变量，可以用一个数组来储存：",{"type":167,"tag":2866,"props":2910,"children":2911},{},[2912,2931,2949],{"type":167,"tag":2870,"props":2913,"children":2914},{},[2915,2917,2922,2924,2930],{"type":172,"value":2916},"将普通字符串直接推入作为结果的内容数组，比如 ",{"type":167,"tag":183,"props":2918,"children":2920},{"className":2919},[],[2921],{"type":172,"value":2880},{"type":172,"value":2923}," 应该被解析为 ",{"type":167,"tag":183,"props":2925,"children":2927},{"className":2926},[],[2928],{"type":172,"value":2929},"p.push('\u003Chtml>Lionad\u003C/html>')",{"type":172,"value":2864},{"type":167,"tag":2870,"props":2932,"children":2933},{},[2934,2936,2941,2942,2948],{"type":172,"value":2935},"如果碰到变量，则将变量拆分出来推入数组，如 ",{"type":167,"tag":183,"props":2937,"children":2939},{"className":2938},[],[2940],{"type":172,"value":2891},{"type":172,"value":2923},{"type":167,"tag":183,"props":2943,"children":2945},{"className":2944},[],[2946],{"type":172,"value":2947},"p.push('\u003Chtml>');p.push(name);p.push('\u003C/html>')",{"type":172,"value":2864},{"type":167,"tag":2870,"props":2950,"children":2951},{},[2952,2954,2960,2962,2967,2969,2975],{"type":172,"value":2953},"带逻辑的字符串，由于逻辑本身就是 JS 代码，所以不需要解析为字符串，只需要把两侧的 ",{"type":167,"tag":183,"props":2955,"children":2957},{"className":2956},[],[2958],{"type":172,"value":2959},"\u003C% %>",{"type":172,"value":2961}," 这种模板标志去掉就好了。如 ",{"type":167,"tag":183,"props":2963,"children":2965},{"className":2964},[],[2966],{"type":172,"value":2902},{"type":172,"value":2968}," 应该被解析为：",{"type":167,"tag":183,"props":2970,"children":2972},{"className":2971},[],[2973],{"type":172,"value":2974},"if(name){ p.push('\u003Chtml>');p.push(name);p.push('\u003C/html>') } ",{"type":172,"value":2864},{"type":167,"tag":168,"props":2977,"children":2978},{},[2979],{"type":172,"value":2980},"以下面这段模板为例，我们看看字符串具体的替换规则。",{"type":167,"tag":209,"props":2982,"children":2984},{"className":211,"code":2983,"language":213,"meta":161,"style":161},"str = `\u003C% if (true) { %>\n    \u003Cli>\u003C%=users[i]%>\u003C/li>\n\u003C% } %>`;\n",[2985],{"type":167,"tag":183,"props":2986,"children":2987},{"__ignoreMap":161},[2988,3010,3018],{"type":167,"tag":219,"props":2989,"children":2990},{"class":221,"line":222},[2991,2996,3000,3005],{"type":167,"tag":219,"props":2992,"children":2993},{"style":232},[2994],{"type":172,"value":2995},"str ",{"type":167,"tag":219,"props":2997,"children":2998},{"style":593},[2999],{"type":172,"value":1263},{"type":167,"tag":219,"props":3001,"children":3002},{"style":238},[3003],{"type":172,"value":3004}," `",{"type":167,"tag":219,"props":3006,"children":3007},{"style":248},[3008],{"type":172,"value":3009},"\u003C% if (true) { %>\n",{"type":167,"tag":219,"props":3011,"children":3012},{"class":221,"line":244},[3013],{"type":167,"tag":219,"props":3014,"children":3015},{"style":248},[3016],{"type":172,"value":3017},"    \u003Cli>\u003C%=users[i]%>\u003C/li>\n",{"type":167,"tag":219,"props":3019,"children":3020},{"class":221,"line":254},[3021,3026,3030],{"type":167,"tag":219,"props":3022,"children":3023},{"style":248},[3024],{"type":172,"value":3025},"\u003C% } %>",{"type":167,"tag":219,"props":3027,"children":3028},{"style":238},[3029],{"type":172,"value":314},{"type":167,"tag":219,"props":3031,"children":3032},{"style":317},[3033],{"type":172,"value":1550},{"type":167,"tag":209,"props":3035,"children":3037},{"className":211,"code":3036,"language":213,"meta":161,"style":161},"// with 的使用方法都知道了，with(obj = { a })，那么\n// 就能在内部直接读取 a，不需要写 obj.a\n\"with(obj){p.push('\" +\n  str\n    // 将换行等空白字符转换为空格，这样所有代码都在一行了\n    // '\u003C% if (true) { %>     \u003Cli>\u003C%=users[i]%>\u003C/li> \u003C% } %>'\n    .replace(/[\\r\\t\\n]/g, \" \")\n    // ['', 'if (true) { %>\u003Cli>', '=users[i]%>\u003C/li>', ' } %>']\n    .split(\"\u003C%\")\n    // 因为 \\t 刚才已经被替换成空格了，所以这里可以使用 \\t 用来将不同行的代码字符串“相加”，\n    // 一会儿再拆分时，不会和原先字符串里的字符混淆\n    .join(\"\\t\")\n    // 去掉模板标志两端的引号，在这个例子里不会用到\n    .replace(/((^|%>)[^\\t]*)'/g, \"$1\\r\")\n    // 以下三句最重要，将所有变量推入数组，生成结果形如 `push('xxx',x,'xxx')` 的字符串\n    // 首先，刚才匹配完了 \u003C%，所以 \\t= 开头后边接的就是变量，这里让它转换成 ',x,' 的形式\n    .replace(/\\t=(.*?)%>/g, \"',$1,'\")\n    .split(\"\\t\")\n    // 在刚刚跟 split('\u003C%') 的位置用括号还原，得到了 ',x,'xxx'); 的形式\n    .join(\"');\")\n    // 在 \\t=xxx 那次匹配，已经把变量模板对应的结束标志 %> 匹配完了，\n    // 所以这是处理剩余语句的结束标志，用 split 拆分行后相当于直接把结束标记舍弃了\n    .split(\"%>\")\n    // 最终在每行开头增加 push 方法，形成了 push('xxx',x,'xxx'); 的形式\n    .join(\"p.push('\")\n    // 处理剩余的换行符\n    .split(\"\\r\")\n    .join(\"\\\\'\") +\n  \"');}\";\n",[3038],{"type":167,"tag":183,"props":3039,"children":3040},{"__ignoreMap":161},[3041,3049,3057,3076,3084,3092,3100,3156,3164,3195,3203,3211,3242,3250,3349,3357,3365,3440,3471,3479,3510,3518,3526,3557,3565,3596,3604,3635,3674],{"type":167,"tag":219,"props":3042,"children":3043},{"class":221,"line":222},[3044],{"type":167,"tag":219,"props":3045,"children":3046},{"style":411},[3047],{"type":172,"value":3048},"// with 的使用方法都知道了，with(obj = { a })，那么\n",{"type":167,"tag":219,"props":3050,"children":3051},{"class":221,"line":244},[3052],{"type":167,"tag":219,"props":3053,"children":3054},{"style":411},[3055],{"type":172,"value":3056},"// 就能在内部直接读取 a，不需要写 obj.a\n",{"type":167,"tag":219,"props":3058,"children":3059},{"class":221,"line":254},[3060,3064,3068,3072],{"type":167,"tag":219,"props":3061,"children":3062},{"style":238},[3063],{"type":172,"value":915},{"type":167,"tag":219,"props":3065,"children":3066},{"style":248},[3067],{"type":172,"value":964},{"type":167,"tag":219,"props":3069,"children":3070},{"style":238},[3071],{"type":172,"value":915},{"type":167,"tag":219,"props":3073,"children":3074},{"style":593},[3075],{"type":172,"value":941},{"type":167,"tag":219,"props":3077,"children":3078},{"class":221,"line":263},[3079],{"type":167,"tag":219,"props":3080,"children":3081},{"style":232},[3082],{"type":172,"value":3083},"  str\n",{"type":167,"tag":219,"props":3085,"children":3086},{"class":221,"line":272},[3087],{"type":167,"tag":219,"props":3088,"children":3089},{"style":411},[3090],{"type":172,"value":3091},"    // 将换行等空白字符转换为空格，这样所有代码都在一行了\n",{"type":167,"tag":219,"props":3093,"children":3094},{"class":221,"line":281},[3095],{"type":167,"tag":219,"props":3096,"children":3097},{"style":411},[3098],{"type":172,"value":3099},"    // '\u003C% if (true) { %>     \u003Cli>\u003C%=users[i]%>\u003C/li> \u003C% } %>'\n",{"type":167,"tag":219,"props":3101,"children":3102},{"class":221,"line":290},[3103,3108,3112,3116,3120,3124,3128,3132,3136,3140,3144,3148,3152],{"type":167,"tag":219,"props":3104,"children":3105},{"style":317},[3106],{"type":172,"value":3107},"    .",{"type":167,"tag":219,"props":3109,"children":3110},{"style":226},[3111],{"type":172,"value":1004},{"type":167,"tag":219,"props":3113,"children":3114},{"style":232},[3115],{"type":172,"value":235},{"type":167,"tag":219,"props":3117,"children":3118},{"style":238},[3119],{"type":172,"value":714},{"type":167,"tag":219,"props":3121,"children":3122},{"style":1015},[3123],{"type":172,"value":768},{"type":167,"tag":219,"props":3125,"children":3126},{"style":717},[3127],{"type":172,"value":1022},{"type":167,"tag":219,"props":3129,"children":3130},{"style":1015},[3131],{"type":172,"value":1027},{"type":167,"tag":219,"props":3133,"children":3134},{"style":238},[3135],{"type":172,"value":714},{"type":167,"tag":219,"props":3137,"children":3138},{"style":1034},[3139],{"type":172,"value":1037},{"type":167,"tag":219,"props":3141,"children":3142},{"style":317},[3143],{"type":172,"value":320},{"type":167,"tag":219,"props":3145,"children":3146},{"style":238},[3147],{"type":172,"value":1046},{"type":167,"tag":219,"props":3149,"children":3150},{"style":238},[3151],{"type":172,"value":1046},{"type":167,"tag":219,"props":3153,"children":3154},{"style":232},[3155],{"type":172,"value":384},{"type":167,"tag":219,"props":3157,"children":3158},{"class":221,"line":299},[3159],{"type":167,"tag":219,"props":3160,"children":3161},{"style":411},[3162],{"type":172,"value":3163},"    // ['', 'if (true) { %>\u003Cli>', '=users[i]%>\u003C/li>', ' } %>']\n",{"type":167,"tag":219,"props":3165,"children":3166},{"class":221,"line":308},[3167,3171,3175,3179,3183,3187,3191],{"type":167,"tag":219,"props":3168,"children":3169},{"style":317},[3170],{"type":172,"value":3107},{"type":167,"tag":219,"props":3172,"children":3173},{"style":226},[3174],{"type":172,"value":1067},{"type":167,"tag":219,"props":3176,"children":3177},{"style":232},[3178],{"type":172,"value":235},{"type":167,"tag":219,"props":3180,"children":3181},{"style":238},[3182],{"type":172,"value":915},{"type":167,"tag":219,"props":3184,"children":3185},{"style":248},[3186],{"type":172,"value":1080},{"type":167,"tag":219,"props":3188,"children":3189},{"style":238},[3190],{"type":172,"value":915},{"type":167,"tag":219,"props":3192,"children":3193},{"style":232},[3194],{"type":172,"value":384},{"type":167,"tag":219,"props":3196,"children":3197},{"class":221,"line":328},[3198],{"type":167,"tag":219,"props":3199,"children":3200},{"style":411},[3201],{"type":172,"value":3202},"    // 因为 \\t 刚才已经被替换成空格了，所以这里可以使用 \\t 用来将不同行的代码字符串“相加”，\n",{"type":167,"tag":219,"props":3204,"children":3205},{"class":221,"line":354},[3206],{"type":167,"tag":219,"props":3207,"children":3208},{"style":411},[3209],{"type":172,"value":3210},"    // 一会儿再拆分时，不会和原先字符串里的字符混淆\n",{"type":167,"tag":219,"props":3212,"children":3213},{"class":221,"line":373},[3214,3218,3222,3226,3230,3234,3238],{"type":167,"tag":219,"props":3215,"children":3216},{"style":317},[3217],{"type":172,"value":3107},{"type":167,"tag":219,"props":3219,"children":3220},{"style":226},[3221],{"type":172,"value":1101},{"type":167,"tag":219,"props":3223,"children":3224},{"style":232},[3225],{"type":172,"value":235},{"type":167,"tag":219,"props":3227,"children":3228},{"style":238},[3229],{"type":172,"value":915},{"type":167,"tag":219,"props":3231,"children":3232},{"style":1112},[3233],{"type":172,"value":1115},{"type":167,"tag":219,"props":3235,"children":3236},{"style":238},[3237],{"type":172,"value":915},{"type":167,"tag":219,"props":3239,"children":3240},{"style":232},[3241],{"type":172,"value":384},{"type":167,"tag":219,"props":3243,"children":3244},{"class":221,"line":871},[3245],{"type":167,"tag":219,"props":3246,"children":3247},{"style":411},[3248],{"type":172,"value":3249},"    // 去掉模板标志两端的引号，在这个例子里不会用到\n",{"type":167,"tag":219,"props":3251,"children":3252},{"class":221,"line":880},[3253,3257,3261,3265,3269,3273,3277,3281,3285,3289,3293,3297,3301,3305,3309,3313,3317,3321,3325,3329,3333,3337,3341,3345],{"type":167,"tag":219,"props":3254,"children":3255},{"style":317},[3256],{"type":172,"value":3107},{"type":167,"tag":219,"props":3258,"children":3259},{"style":226},[3260],{"type":172,"value":1004},{"type":167,"tag":219,"props":3262,"children":3263},{"style":232},[3264],{"type":172,"value":235},{"type":167,"tag":219,"props":3266,"children":3267},{"style":238},[3268],{"type":172,"value":714},{"type":167,"tag":219,"props":3270,"children":3271},{"style":1146},[3272],{"type":172,"value":1149},{"type":167,"tag":219,"props":3274,"children":3275},{"style":1152},[3276],{"type":172,"value":1155},{"type":167,"tag":219,"props":3278,"children":3279},{"style":593},[3280],{"type":172,"value":1160},{"type":167,"tag":219,"props":3282,"children":3283},{"style":1163},[3284],{"type":172,"value":1166},{"type":167,"tag":219,"props":3286,"children":3287},{"style":1146},[3288],{"type":172,"value":667},{"type":167,"tag":219,"props":3290,"children":3291},{"style":1015},[3292],{"type":172,"value":768},{"type":167,"tag":219,"props":3294,"children":3295},{"style":593},[3296],{"type":172,"value":1155},{"type":167,"tag":219,"props":3298,"children":3299},{"style":717},[3300],{"type":172,"value":1115},{"type":167,"tag":219,"props":3302,"children":3303},{"style":1015},[3304],{"type":172,"value":1027},{"type":167,"tag":219,"props":3306,"children":3307},{"style":593},[3308],{"type":172,"value":1191},{"type":167,"tag":219,"props":3310,"children":3311},{"style":1146},[3312],{"type":172,"value":667},{"type":167,"tag":219,"props":3314,"children":3315},{"style":1163},[3316],{"type":172,"value":1200},{"type":167,"tag":219,"props":3318,"children":3319},{"style":238},[3320],{"type":172,"value":714},{"type":167,"tag":219,"props":3322,"children":3323},{"style":1034},[3324],{"type":172,"value":1037},{"type":167,"tag":219,"props":3326,"children":3327},{"style":317},[3328],{"type":172,"value":320},{"type":167,"tag":219,"props":3330,"children":3331},{"style":238},[3332],{"type":172,"value":1046},{"type":167,"tag":219,"props":3334,"children":3335},{"style":248},[3336],{"type":172,"value":1221},{"type":167,"tag":219,"props":3338,"children":3339},{"style":1112},[3340],{"type":172,"value":1226},{"type":167,"tag":219,"props":3342,"children":3343},{"style":238},[3344],{"type":172,"value":915},{"type":167,"tag":219,"props":3346,"children":3347},{"style":232},[3348],{"type":172,"value":384},{"type":167,"tag":219,"props":3350,"children":3351},{"class":221,"line":899},[3352],{"type":167,"tag":219,"props":3353,"children":3354},{"style":411},[3355],{"type":172,"value":3356},"    // 以下三句最重要，将所有变量推入数组，生成结果形如 `push('xxx',x,'xxx')` 的字符串\n",{"type":167,"tag":219,"props":3358,"children":3359},{"class":221,"line":922},[3360],{"type":167,"tag":219,"props":3361,"children":3362},{"style":411},[3363],{"type":172,"value":3364},"    // 首先，刚才匹配完了 \u003C%，所以 \\t= 开头后边接的就是变量，这里让它转换成 ',x,' 的形式\n",{"type":167,"tag":219,"props":3366,"children":3367},{"class":221,"line":944},[3368,3372,3376,3380,3384,3388,3392,3396,3400,3404,3408,3412,3416,3420,3424,3428,3432,3436],{"type":167,"tag":219,"props":3369,"children":3370},{"style":317},[3371],{"type":172,"value":3107},{"type":167,"tag":219,"props":3373,"children":3374},{"style":226},[3375],{"type":172,"value":1004},{"type":167,"tag":219,"props":3377,"children":3378},{"style":232},[3379],{"type":172,"value":235},{"type":167,"tag":219,"props":3381,"children":3382},{"style":238},[3383],{"type":172,"value":714},{"type":167,"tag":219,"props":3385,"children":3386},{"style":717},[3387],{"type":172,"value":1115},{"type":167,"tag":219,"props":3389,"children":3390},{"style":1163},[3391],{"type":172,"value":1263},{"type":167,"tag":219,"props":3393,"children":3394},{"style":1146},[3395],{"type":172,"value":235},{"type":167,"tag":219,"props":3397,"children":3398},{"style":717},[3399],{"type":172,"value":624},{"type":167,"tag":219,"props":3401,"children":3402},{"style":593},[3403],{"type":172,"value":1276},{"type":167,"tag":219,"props":3405,"children":3406},{"style":1146},[3407],{"type":172,"value":667},{"type":167,"tag":219,"props":3409,"children":3410},{"style":1163},[3411],{"type":172,"value":1166},{"type":167,"tag":219,"props":3413,"children":3414},{"style":238},[3415],{"type":172,"value":714},{"type":167,"tag":219,"props":3417,"children":3418},{"style":1034},[3419],{"type":172,"value":1037},{"type":167,"tag":219,"props":3421,"children":3422},{"style":317},[3423],{"type":172,"value":320},{"type":167,"tag":219,"props":3425,"children":3426},{"style":238},[3427],{"type":172,"value":1046},{"type":167,"tag":219,"props":3429,"children":3430},{"style":248},[3431],{"type":172,"value":1305},{"type":167,"tag":219,"props":3433,"children":3434},{"style":238},[3435],{"type":172,"value":915},{"type":167,"tag":219,"props":3437,"children":3438},{"style":232},[3439],{"type":172,"value":384},{"type":167,"tag":219,"props":3441,"children":3442},{"class":221,"line":953},[3443,3447,3451,3455,3459,3463,3467],{"type":167,"tag":219,"props":3444,"children":3445},{"style":317},[3446],{"type":172,"value":3107},{"type":167,"tag":219,"props":3448,"children":3449},{"style":226},[3450],{"type":172,"value":1067},{"type":167,"tag":219,"props":3452,"children":3453},{"style":232},[3454],{"type":172,"value":235},{"type":167,"tag":219,"props":3456,"children":3457},{"style":238},[3458],{"type":172,"value":915},{"type":167,"tag":219,"props":3460,"children":3461},{"style":1112},[3462],{"type":172,"value":1115},{"type":167,"tag":219,"props":3464,"children":3465},{"style":238},[3466],{"type":172,"value":915},{"type":167,"tag":219,"props":3468,"children":3469},{"style":232},[3470],{"type":172,"value":384},{"type":167,"tag":219,"props":3472,"children":3473},{"class":221,"line":975},[3474],{"type":167,"tag":219,"props":3475,"children":3476},{"style":411},[3477],{"type":172,"value":3478},"    // 在刚刚跟 split('\u003C%') 的位置用括号还原，得到了 ',x,'xxx'); 的形式\n",{"type":167,"tag":219,"props":3480,"children":3481},{"class":221,"line":984},[3482,3486,3490,3494,3498,3502,3506],{"type":167,"tag":219,"props":3483,"children":3484},{"style":317},[3485],{"type":172,"value":3107},{"type":167,"tag":219,"props":3487,"children":3488},{"style":226},[3489],{"type":172,"value":1101},{"type":167,"tag":219,"props":3491,"children":3492},{"style":232},[3493],{"type":172,"value":235},{"type":167,"tag":219,"props":3495,"children":3496},{"style":238},[3497],{"type":172,"value":915},{"type":167,"tag":219,"props":3499,"children":3500},{"style":248},[3501],{"type":172,"value":1370},{"type":167,"tag":219,"props":3503,"children":3504},{"style":238},[3505],{"type":172,"value":915},{"type":167,"tag":219,"props":3507,"children":3508},{"style":232},[3509],{"type":172,"value":384},{"type":167,"tag":219,"props":3511,"children":3512},{"class":221,"line":993},[3513],{"type":167,"tag":219,"props":3514,"children":3515},{"style":411},[3516],{"type":172,"value":3517},"    // 在 \\t=xxx 那次匹配，已经把变量模板对应的结束标志 %> 匹配完了，\n",{"type":167,"tag":219,"props":3519,"children":3520},{"class":221,"line":1057},[3521],{"type":167,"tag":219,"props":3522,"children":3523},{"style":411},[3524],{"type":172,"value":3525},"    // 所以这是处理剩余语句的结束标志，用 split 拆分行后相当于直接把结束标记舍弃了\n",{"type":167,"tag":219,"props":3527,"children":3528},{"class":221,"line":1091},[3529,3533,3537,3541,3545,3549,3553],{"type":167,"tag":219,"props":3530,"children":3531},{"style":317},[3532],{"type":172,"value":3107},{"type":167,"tag":219,"props":3534,"children":3535},{"style":226},[3536],{"type":172,"value":1067},{"type":167,"tag":219,"props":3538,"children":3539},{"style":232},[3540],{"type":172,"value":235},{"type":167,"tag":219,"props":3542,"children":3543},{"style":238},[3544],{"type":172,"value":915},{"type":167,"tag":219,"props":3546,"children":3547},{"style":248},[3548],{"type":172,"value":1166},{"type":167,"tag":219,"props":3550,"children":3551},{"style":238},[3552],{"type":172,"value":915},{"type":167,"tag":219,"props":3554,"children":3555},{"style":232},[3556],{"type":172,"value":384},{"type":167,"tag":219,"props":3558,"children":3559},{"class":221,"line":1126},[3560],{"type":167,"tag":219,"props":3561,"children":3562},{"style":411},[3563],{"type":172,"value":3564},"    // 最终在每行开头增加 push 方法，形成了 push('xxx',x,'xxx'); 的形式\n",{"type":167,"tag":219,"props":3566,"children":3567},{"class":221,"line":1237},[3568,3572,3576,3580,3584,3588,3592],{"type":167,"tag":219,"props":3569,"children":3570},{"style":317},[3571],{"type":172,"value":3107},{"type":167,"tag":219,"props":3573,"children":3574},{"style":226},[3575],{"type":172,"value":1101},{"type":167,"tag":219,"props":3577,"children":3578},{"style":232},[3579],{"type":172,"value":235},{"type":167,"tag":219,"props":3581,"children":3582},{"style":238},[3583],{"type":172,"value":915},{"type":167,"tag":219,"props":3585,"children":3586},{"style":248},[3587],{"type":172,"value":1435},{"type":167,"tag":219,"props":3589,"children":3590},{"style":238},[3591],{"type":172,"value":915},{"type":167,"tag":219,"props":3593,"children":3594},{"style":232},[3595],{"type":172,"value":384},{"type":167,"tag":219,"props":3597,"children":3598},{"class":221,"line":1316},[3599],{"type":167,"tag":219,"props":3600,"children":3601},{"style":411},[3602],{"type":172,"value":3603},"    // 处理剩余的换行符\n",{"type":167,"tag":219,"props":3605,"children":3606},{"class":221,"line":1348},[3607,3611,3615,3619,3623,3627,3631],{"type":167,"tag":219,"props":3608,"children":3609},{"style":317},[3610],{"type":172,"value":3107},{"type":167,"tag":219,"props":3612,"children":3613},{"style":226},[3614],{"type":172,"value":1067},{"type":167,"tag":219,"props":3616,"children":3617},{"style":232},[3618],{"type":172,"value":235},{"type":167,"tag":219,"props":3620,"children":3621},{"style":238},[3622],{"type":172,"value":915},{"type":167,"tag":219,"props":3624,"children":3625},{"style":1112},[3626],{"type":172,"value":1226},{"type":167,"tag":219,"props":3628,"children":3629},{"style":238},[3630],{"type":172,"value":915},{"type":167,"tag":219,"props":3632,"children":3633},{"style":232},[3634],{"type":172,"value":384},{"type":167,"tag":219,"props":3636,"children":3637},{"class":221,"line":1381},[3638,3642,3646,3650,3654,3658,3662,3666,3670],{"type":167,"tag":219,"props":3639,"children":3640},{"style":317},[3641],{"type":172,"value":3107},{"type":167,"tag":219,"props":3643,"children":3644},{"style":226},[3645],{"type":172,"value":1101},{"type":167,"tag":219,"props":3647,"children":3648},{"style":232},[3649],{"type":172,"value":235},{"type":167,"tag":219,"props":3651,"children":3652},{"style":238},[3653],{"type":172,"value":915},{"type":167,"tag":219,"props":3655,"children":3656},{"style":1112},[3657],{"type":172,"value":1500},{"type":167,"tag":219,"props":3659,"children":3660},{"style":248},[3661],{"type":172,"value":1200},{"type":167,"tag":219,"props":3663,"children":3664},{"style":238},[3665],{"type":172,"value":915},{"type":167,"tag":219,"props":3667,"children":3668},{"style":232},[3669],{"type":172,"value":1513},{"type":167,"tag":219,"props":3671,"children":3672},{"style":593},[3673],{"type":172,"value":1518},{"type":167,"tag":219,"props":3675,"children":3676},{"class":221,"line":1413},[3677,3681,3686,3690],{"type":167,"tag":219,"props":3678,"children":3679},{"style":238},[3680],{"type":172,"value":2588},{"type":167,"tag":219,"props":3682,"children":3683},{"style":248},[3684],{"type":172,"value":3685},"');}",{"type":167,"tag":219,"props":3687,"children":3688},{"style":238},[3689],{"type":172,"value":915},{"type":167,"tag":219,"props":3691,"children":3692},{"style":317},[3693],{"type":172,"value":1550},{"type":167,"tag":168,"props":3695,"children":3696},{},[3697,3699,3704,3706,3711,3713,3718,3719,3725,3727,3732,3734,3739],{"type":172,"value":3698},"有一个小细节，字符串替换时，所有逻辑语句的模板标志开头和结尾（",{"type":167,"tag":183,"props":3700,"children":3702},{"className":3701},[],[3703],{"type":172,"value":1080},{"type":172,"value":3705},"、",{"type":167,"tag":183,"props":3707,"children":3709},{"className":3708},[],[3710],{"type":172,"value":1166},{"type":172,"value":3712},"）分别被替换为 ",{"type":167,"tag":183,"props":3714,"children":3716},{"className":3715},[],[3717],{"type":172,"value":1370},{"type":172,"value":3705},{"type":167,"tag":183,"props":3720,"children":3722},{"className":3721},[],[3723],{"type":172,"value":3724},"push('",{"type":172,"value":3726},"，但是开头和结尾的那个标志，并没有对应的匹配。所以在代码中，能看 ",{"type":167,"tag":183,"props":3728,"children":3730},{"className":3729},[],[3731],{"type":172,"value":964},{"type":172,"value":3733}," 和 ",{"type":167,"tag":183,"props":3735,"children":3737},{"className":3736},[],[3738],{"type":172,"value":1370},{"type":172,"value":3740}," 这种手动补全。",{"type":167,"tag":168,"props":3742,"children":3743},{},[3744],{"type":172,"value":3745},"最终生成的字符串如下（已格式化处理）：",{"type":167,"tag":209,"props":3747,"children":3749},{"className":211,"code":3748,"language":213,"meta":161,"style":161},"`with(obj){\n    p.push(''); \n    if (true) { \n        p.push('     \u003Cli>',users[i],'\u003C/li>   '); \n    } \n    p.push('');\n}`;\n",[3750],{"type":167,"tag":183,"props":3751,"children":3752},{"__ignoreMap":161},[3753,3765,3773,3781,3789,3797,3805],{"type":167,"tag":219,"props":3754,"children":3755},{"class":221,"line":222},[3756,3760],{"type":167,"tag":219,"props":3757,"children":3758},{"style":238},[3759],{"type":172,"value":314},{"type":167,"tag":219,"props":3761,"children":3762},{"style":248},[3763],{"type":172,"value":3764},"with(obj){\n",{"type":167,"tag":219,"props":3766,"children":3767},{"class":221,"line":244},[3768],{"type":167,"tag":219,"props":3769,"children":3770},{"style":248},[3771],{"type":172,"value":3772},"    p.push(''); \n",{"type":167,"tag":219,"props":3774,"children":3775},{"class":221,"line":254},[3776],{"type":167,"tag":219,"props":3777,"children":3778},{"style":248},[3779],{"type":172,"value":3780},"    if (true) { \n",{"type":167,"tag":219,"props":3782,"children":3783},{"class":221,"line":263},[3784],{"type":167,"tag":219,"props":3785,"children":3786},{"style":248},[3787],{"type":172,"value":3788},"        p.push('     \u003Cli>',users[i],'\u003C/li>   '); \n",{"type":167,"tag":219,"props":3790,"children":3791},{"class":221,"line":272},[3792],{"type":167,"tag":219,"props":3793,"children":3794},{"style":248},[3795],{"type":172,"value":3796},"    } \n",{"type":167,"tag":219,"props":3798,"children":3799},{"class":221,"line":281},[3800],{"type":167,"tag":219,"props":3801,"children":3802},{"style":248},[3803],{"type":172,"value":3804},"    p.push('');\n",{"type":167,"tag":219,"props":3806,"children":3807},{"class":221,"line":290},[3808,3812,3816],{"type":167,"tag":219,"props":3809,"children":3810},{"style":248},[3811],{"type":172,"value":379},{"type":167,"tag":219,"props":3813,"children":3814},{"style":238},[3815],{"type":172,"value":314},{"type":167,"tag":219,"props":3817,"children":3818},{"style":317},[3819],{"type":172,"value":1550},{"type":167,"tag":168,"props":3821,"children":3822},{},[3823,3825,3831],{"type":172,"value":3824},"为什么 with 语句里有一行空的 ",{"type":167,"tag":183,"props":3826,"children":3828},{"className":3827},[],[3829],{"type":172,"value":3830},"push('')",{"type":172,"value":3832}," 呢？",{"type":167,"tag":168,"props":3834,"children":3835},{},[3836],{"type":172,"value":3837},"还记得原始的模板吗？一开的模板是以“\u003C%”开头的，而“\u003C%”在替换过程被右括号取代了，此时正好和初始字符串结合形成了空 push。如果原始字符串开头是 \"123\u003C% if (true)\"，那这行空 push 会转换成“p.push('123');”，也是正确的代码。",{"type":167,"tag":168,"props":3839,"children":3840},{},[3841],{"type":172,"value":3842},"最后，micro-templating 需要返回这个新函数。如果不传参数 data 给模板函数，则会返回一个部分应用的函数等待用户输入 data 参数再执行模板解析；如果已经传了 data 那就会立即调用返回模板解析的结果。",{"type":167,"tag":209,"props":3844,"children":3846},{"className":211,"code":3845,"language":213,"meta":161,"style":161},"(function () {\n  var cache = {};\n  this.tmpl = function tmpl(str, data) {\n    return data ? fn(data) : fn;\n  };\n})();\n",[3847],{"type":167,"tag":183,"props":3848,"children":3849},{"__ignoreMap":161},[3850,3869,3888,3939,3982,3989],{"type":167,"tag":219,"props":3851,"children":3852},{"class":221,"line":222},[3853,3857,3861,3865],{"type":167,"tag":219,"props":3854,"children":3855},{"style":232},[3856],{"type":172,"value":235},{"type":167,"tag":219,"props":3858,"children":3859},{"style":565},[3860],{"type":172,"value":568},{"type":167,"tag":219,"props":3862,"children":3863},{"style":317},[3864],{"type":172,"value":573},{"type":167,"tag":219,"props":3866,"children":3867},{"style":317},[3868],{"type":172,"value":325},{"type":167,"tag":219,"props":3870,"children":3871},{"class":221,"line":244},[3872,3876,3880,3884],{"type":167,"tag":219,"props":3873,"children":3874},{"style":565},[3875],{"type":172,"value":585},{"type":167,"tag":219,"props":3877,"children":3878},{"style":232},[3879],{"type":172,"value":590},{"type":167,"tag":219,"props":3881,"children":3882},{"style":593},[3883],{"type":172,"value":596},{"type":167,"tag":219,"props":3885,"children":3886},{"style":317},[3887],{"type":172,"value":601},{"type":167,"tag":219,"props":3889,"children":3890},{"class":221,"line":254},[3891,3895,3899,3903,3907,3911,3915,3919,3923,3927,3931,3935],{"type":167,"tag":219,"props":3892,"children":3893},{"style":616},[3894],{"type":172,"value":619},{"type":167,"tag":219,"props":3896,"children":3897},{"style":317},[3898],{"type":172,"value":624},{"type":167,"tag":219,"props":3900,"children":3901},{"style":226},[3902],{"type":172,"value":629},{"type":167,"tag":219,"props":3904,"children":3905},{"style":593},[3906],{"type":172,"value":596},{"type":167,"tag":219,"props":3908,"children":3909},{"style":565},[3910],{"type":172,"value":638},{"type":167,"tag":219,"props":3912,"children":3913},{"style":226},[3914],{"type":172,"value":643},{"type":167,"tag":219,"props":3916,"children":3917},{"style":317},[3918],{"type":172,"value":235},{"type":167,"tag":219,"props":3920,"children":3921},{"style":650},[3922],{"type":172,"value":653},{"type":167,"tag":219,"props":3924,"children":3925},{"style":317},[3926],{"type":172,"value":320},{"type":167,"tag":219,"props":3928,"children":3929},{"style":650},[3930],{"type":172,"value":662},{"type":167,"tag":219,"props":3932,"children":3933},{"style":317},[3934],{"type":172,"value":667},{"type":167,"tag":219,"props":3936,"children":3937},{"style":317},[3938],{"type":172,"value":325},{"type":167,"tag":219,"props":3940,"children":3941},{"class":221,"line":263},[3942,3946,3950,3954,3958,3962,3966,3970,3974,3978],{"type":167,"tag":219,"props":3943,"children":3944},{"style":1152},[3945],{"type":172,"value":1576},{"type":167,"tag":219,"props":3947,"children":3948},{"style":232},[3949],{"type":172,"value":662},{"type":167,"tag":219,"props":3951,"children":3952},{"style":593},[3953],{"type":172,"value":1585},{"type":167,"tag":219,"props":3955,"children":3956},{"style":226},[3957],{"type":172,"value":700},{"type":167,"tag":219,"props":3959,"children":3960},{"style":332},[3961],{"type":172,"value":235},{"type":167,"tag":219,"props":3963,"children":3964},{"style":232},[3965],{"type":172,"value":1598},{"type":167,"tag":219,"props":3967,"children":3968},{"style":332},[3969],{"type":172,"value":1513},{"type":167,"tag":219,"props":3971,"children":3972},{"style":593},[3973],{"type":172,"value":340},{"type":167,"tag":219,"props":3975,"children":3976},{"style":232},[3977],{"type":172,"value":700},{"type":167,"tag":219,"props":3979,"children":3980},{"style":317},[3981],{"type":172,"value":1550},{"type":167,"tag":219,"props":3983,"children":3984},{"class":221,"line":272},[3985],{"type":167,"tag":219,"props":3986,"children":3987},{"style":317},[3988],{"type":172,"value":1623},{"type":167,"tag":219,"props":3990,"children":3991},{"class":221,"line":281},[3992,3996,4000],{"type":167,"tag":219,"props":3993,"children":3994},{"style":317},[3995],{"type":172,"value":379},{"type":167,"tag":219,"props":3997,"children":3998},{"style":232},[3999],{"type":172,"value":1636},{"type":167,"tag":219,"props":4001,"children":4002},{"style":317},[4003],{"type":172,"value":1550},{"type":167,"tag":168,"props":4005,"children":4006},{},[4007],{"type":172,"value":4008},"终于结束了！这个函数不长，但一口气看下来还是蛮费力气的。如果一遍写测试用例以便看代码，很快能把这个函数跑通，如果你是纯靠脑力跑，还没被那个长长的字符串替换链给吓住，在此我赐你称号：“Micro Templating 人肉编译器 - 十五周年限定版”。",{"type":167,"tag":168,"props":4010,"children":4011},{},[4012,4014,4021,4023,4028],{"type":172,"value":4013},"额外提一句，Function 构造器和 eval 函数比，除了能传参数意外，还有一些细节不同，比如说声明变量的作用域不同，这个需要注意。这个编译器没有错误处理等代码完善，因此不可以上生产。此外，由于 ",{"type":167,"tag":175,"props":4015,"children":4019},{"href":4016,"rel":4017},"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/with",[4018],"nofollow",[4020],{"type":172,"value":2692},{"type":172,"value":4022}," 语句非常容易出错，且不利于静态优化，不应该在业务函数里使用",{"type":167,"tag":219,"props":4024,"children":4025},{},[4026],{"type":172,"value":4027},"^with-mdn",{"type":172,"value":4029},"。最后，阅读源码需要技巧，这几点希望能帮助到你：",{"type":167,"tag":2866,"props":4031,"children":4032},{},[4033,4038,4043,4048],{"type":167,"tag":2870,"props":4034,"children":4035},{},[4036],{"type":172,"value":4037},"从注释、测试用例，先搞清楚要看的代码的作用",{"type":167,"tag":2870,"props":4039,"children":4040},{},[4041],{"type":172,"value":4042},"使用编辑器的折叠代码，一次只看一部分源码",{"type":167,"tag":2870,"props":4044,"children":4045},{},[4046],{"type":172,"value":4047},"在 Git 提交记录中搜索，从简单的版本看起",{"type":167,"tag":2870,"props":4049,"children":4050},{},[4051],{"type":172,"value":4052},"复杂代码应该从高层结构看起，比如使用 IDE 各种插件或是 Madge 等代码分析工具",{"type":167,"tag":523,"props":4054,"children":4056},{"id":4055},"相关链接",[4057],{"type":172,"value":4055},{"type":167,"tag":2866,"props":4059,"children":4060},{},[4061],{"type":167,"tag":2870,"props":4062,"children":4063},{},[4064],{"type":167,"tag":175,"props":4065,"children":4068},{"href":4066,"rel":4067},"https://johnresig.com/blog/javascript-micro-templating/",[4018],[4069],{"type":172,"value":4070},"JavaScript Micro-Templating",{"type":167,"tag":4072,"props":4073,"children":4074},"style",{},[4075],{"type":172,"value":4076},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":161,"searchDepth":244,"depth":244,"links":4078},[4079,4080,4081],{"id":525,"depth":244,"text":525},{"id":1648,"depth":244,"text":1648},{"id":4055,"depth":244,"text":4055},"markdown","content:2.articles:1100.micro-templating.md","content","2.articles/1100.micro-templating.md","2.articles/1100.micro-templating","md",[4089,4091],{"_path":49,"title":48,"description":4090},"沉浸式翻译太贵辽，试试本地部署 LLM 用来翻译网页的可行性。",{"_path":55,"title":54,"description":4092},"我的项目使用 micro-app 框架作为微前端框架。使用 micro-app 时，由于开启了样式隔离功能，子应用加载的 CSS 会被解析器解析，在选择器前增加一个子应用属性选择器前缀。我碰到的问题是，如果 CSS 源码中带嵌套语法那么解析就会失败。今天借这个问题给大家简单介绍一下 CSS Parser 的基本流程。",1742808182806]