[{"data":1,"prerenderedAt":4351},["ShallowReactive",2],{"navigation":3,"/articles/micro-templating":416,"/articles/micro-templating-surround":4346},[4,32,86,108,135,141,147,153,399,405,411],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🌃 长夜梦","/flows/long-night-dream",{"title":15,"_path":16},"🌌 万物联结与幸福感","/flows/everything",{"title":18,"_path":19},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":21,"_path":22},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":24,"_path":25},"🌧️ 我的腼腆","/flows/shy",{"title":27,"_path":28},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":30,"_path":31},"📝 心流归档","/flows/fold",{"title":33,"_path":34,"children":35},"技术博客 / Coder","/articles",[36,38,41,44,47,50,53,56,59,62,65,68,71,74,77,80,83],{"title":37,"_path":34},"🦁 为什么我要写博客",{"title":39,"_path":40},"🥞 在 tailwind 中使用现代化 CSS Layers","/articles/tailwind-sass-and-css-layer",{"title":42,"_path":43},"💻 本地部署 Qwen 翻译网页","/articles/local-translator",{"title":45,"_path":46},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":48,"_path":49},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":51,"_path":52},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":54,"_path":55},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":57,"_path":58},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":60,"_path":61},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":63,"_path":64},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":66,"_path":67},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":69,"_path":70},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":72,"_path":73},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":75,"_path":76},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":78,"_path":79},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":81,"_path":82},"🚝 四十二篇系列","/articles/fourty-two",{"title":84,"_path":85},"📝 技术博客归档","/articles/fold",{"title":87,"_path":88,"children":89},"造物 / Make","/tools",[90,93,96,99,102,105],{"title":91,"_path":92},"🥥 Coconut","/tools/coconut",{"title":94,"_path":95},"🧶 网易云音乐歌单排序","/tools/netease-sorter",{"title":97,"_path":98},"🌐 AnySort","/tools/anysort",{"title":100,"_path":101},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":103,"_path":104},"👓 Crapto","/tools/crypto-inline",{"title":106,"_path":107},"🖨️ any-to-base64","/tools/any-to-base64",{"title":109,"_path":110,"children":111},"吉他剧场 / Music","/music",[112,114,117,120,123,126,129,132],{"title":113,"_path":110},"🎸 FingerStyle！",{"title":115,"_path":116},"🌬️ 等待的风","/music/wind",{"title":118,"_path":119},"💕 约定的海洋","/music/ocean",{"title":121,"_path":122},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":124,"_path":125},"🌏 残酷天使的行动纲领","/music/eva",{"title":127,"_path":128},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":130,"_path":131},"🍷 Wu Wei","/music/wu-wei",{"title":133,"_path":134},"🌅 无题","/music/untitled",{"title":136,"_path":137,"children":138},"画点什么 / Paint","/paint",[139],{"title":140,"_path":137},"🚧 正在施工",{"title":142,"_path":143,"children":144},"读书笔记 / Notes","/books",[145],{"title":146,"_path":143},"📕 读书笔记",{"title":148,"_path":149,"children":150},"知识地图 / Maps","/maps",[151],{"title":152,"_path":149},"🏁 知识地图",{"title":154,"_path":155,"children":156},"零散的笔记 / Gists","/gists",[157,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255,258,261,264,267,270,273,276,279,282,285,288,291,294,297,300,303,306,309,312,315,318,321,324,327,330,333,336,339,342,345,348,351,354,357,360,363,366,369,372,375,378,381,384,387,390,393,396],{"title":158,"_path":155},"🧊 Gists",{"title":160,"_path":161},"网站的可访问性","/gists/accessibility",{"title":163,"_path":164},"Bit","/gists/bit",{"title":166,"_path":167},"图片模糊","/gists/blur",{"title":169,"_path":170},"渲染相关笔记","/gists/c4d",{"title":172,"_path":173},"CDN 问题记录","/gists/cdn",{"title":175,"_path":176},"消毒剂","/gists/cleaner",{"title":178,"_path":179},"Windows Command","/gists/cmd",{"title":181,"_path":182},"Command","/gists/command",{"title":184,"_path":185},"复杂科学","/gists/complexity-science",{"title":187,"_path":188},"GitHub Copilot","/gists/copilot",{"title":190,"_path":191},"宇宙","/gists/cosmos",{"title":193,"_path":194},"C++","/gists/cpp",{"title":196,"_path":197},"Data Structure","/gists/data-structure",{"title":199,"_path":200},"DEPRESSION","/gists/depression",{"title":202,"_path":203},"设计模式","/gists/design-patterns",{"title":205,"_path":206},"Developer Experience","/gists/developer-experience",{"title":208,"_path":209},"Device Metrics","/gists/device-metrix",{"title":211,"_path":212},"数字化转型","/gists/digital-transformation",{"title":214,"_path":215},"ECMAScript Language Specification","/gists/ecmascript-specification",{"title":217,"_path":218},"正则表达式","/gists/eegex",{"title":220,"_path":221},"Emoji","/gists/emoji",{"title":223,"_path":224},"工程","/gists/engineering",{"title":226,"_path":227},"熵","/gists/entropy",{"title":229,"_path":230},"Environment","/gists/environment",{"title":232,"_path":233},"Erlang","/gists/erlang",{"title":235,"_path":236},"逃离塔克夫","/gists/escape-from-tarkov",{"title":238,"_path":239},"ESNext (ES6-ES11)","/gists/esnext",{"title":241,"_path":242},"Eval！","/gists/eval",{"title":244,"_path":245},"Flutter","/gists/flutter",{"title":247,"_path":248},"字体","/gists/font",{"title":250,"_path":251},"JS 函数式编程","/gists/functional",{"title":253,"_path":254},"游戏化","/gists/gamification",{"title":256,"_path":257},"Google C++ Standard","/gists/google-cpp-standard",{"title":259,"_path":260},"双向链接完全体","/gists/graph",{"title":262,"_path":263},"Hardwares","/gists/hardwares",{"title":265,"_path":266},"哈希冲突","/gists/hash-collision",{"title":268,"_path":269},"信息设计","/gists/information-design",{"title":271,"_path":272},"InstantPage","/gists/instant.page",{"title":274,"_path":275},"ISUX 遇见大数据可视化系列","/gists/isux-data-visualization",{"title":277,"_path":278},"KVStore","/gists/key-value-db",{"title":280,"_path":281},"Kubernetes","/gists/kubernetes",{"title":283,"_path":284},"Makefile","/gists/makefile",{"title":286,"_path":287},"Markdown Inline Style","/gists/markdown-nice",{"title":289,"_path":290},"小程序","/gists/miniapp",{"title":292,"_path":293},"减小页面快照体积","/gists/minify-html",{"title":295,"_path":296},"mklink","/gists/mklink",{"title":298,"_path":299},"Mock","/gists/mock",{"title":301,"_path":302},"多人协作系统","/gists/multiplayer",{"title":304,"_path":305},"多端应用","/gists/multy-end-app",{"title":307,"_path":308},"神经科学","/gists/neuroscience",{"title":310,"_path":311},"OO","/gists/oo",{"title":313,"_path":314},"Opinioned Personal Folder","/gists/opinioned-personal-folder",{"title":316,"_path":317},"PInvoke","/gists/pinvoke",{"title":319,"_path":320},"像素","/gists/pixel",{"title":322,"_path":323},"PowerShell","/gists/powershell",{"title":325,"_path":326},"量子","/gists/quantum",{"title":328,"_path":329},"保持好奇心","/gists/questions",{"title":331,"_path":332},"React Native","/gists/react-native",{"title":334,"_path":335},"博客改版碰到的浏览器平滑滚动问题","/gists/scroll",{"title":337,"_path":338},"SEO","/gists/seo",{"title":340,"_path":341},"Shader","/gists/shader",{"title":343,"_path":344},"Shape Up","/gists/shape-up",{"title":346,"_path":347},"睡觉","/gists/sleep",{"title":349,"_path":350},"记录奇怪的问题","/gists/solved",{"title":352,"_path":353},"States","/gists/states",{"title":355,"_path":356},"Storage","/gists/storage",{"title":358,"_path":359},"音视频流处理","/gists/stream-cli",{"title":361,"_path":362},"Symbol","/gists/symbol",{"title":364,"_path":365},"系统论","/gists/systems-theory",{"title":367,"_path":368},"Taro","/gists/taro",{"title":370,"_path":371},"任务切片","/gists/task-slice",{"title":373,"_path":374},"技术偏好","/gists/tech-dudge",{"title":376,"_path":377},"Untitled","/gists/untitled",{"title":379,"_path":380},"可变字体","/gists/variable-font",{"title":382,"_path":383},"视觉错觉","/gists/visual-illusion",{"title":385,"_path":386},"SS(SSR)","/gists/vpn",{"title":388,"_path":389},"VS Code 插件开发","/gists/vscode-plugin",{"title":391,"_path":392},"Web Components","/gists/web-components",{"title":394,"_path":395},"Windows","/gists/windows",{"title":397,"_path":398},"查缺补漏","/gists/wrong",{"title":400,"_path":401,"children":402},"代码笔记 / Gists","/source-code",[403],{"title":404,"_path":401},"🚄 代码笔记",{"title":406,"_path":407,"children":408},"我 / About","/hire",[409],{"title":410,"_path":407},"📬 技术简历",{"title":412,"_path":413,"children":414},"todo","/todo",[415],{"title":412,"_path":413},{"_path":46,"_dir":417,"_draft":418,"_partial":418,"_locale":419,"title":45,"description":420,"body":421,"_type":4340,"_id":4341,"_source":4342,"_file":4343,"_stem":4344,"_extension":4345},"articles",false,"","忍者秘籍中提到的模板解析器，很短但支持变量和 if 等语句，还是 15 年前的代码！",{"type":422,"children":423,"toc":4335},"root",[424,449,461,466,643,655,775,780,786,791,1899,1904,1909,1914,2025,2038,2499,2805,2816,2915,2928,3099,3104,3123,3162,3167,3234,3239,3292,3952,3999,4004,4078,4091,4096,4101,4262,4267,4288,4311,4316,4329],{"type":425,"tag":426,"props":427,"children":428},"element","p",{},[429,432,438,440,447],{"type":430,"value":431},"text","上回我借着解决 CSS 嵌套解析问题聊到 micro-app 中实现的一个非常精简的 ",{"type":425,"tag":433,"props":434,"children":435},"a",{"href":49},[436],{"type":430,"value":437},"CSS 解析器",{"type":430,"value":439},"，还没过瘾。今天整理笔记的时候发现了角落里的这个模板解析器，那就赶紧擦擦灰尘拉出来聊一聊。这个模板解析器可是有年头了，它是 John Resig 佬 2008 年写的，叫 ",{"type":425,"tag":441,"props":442,"children":444},"code",{"className":443},[],[445],{"type":430,"value":446},"micro-templating",{"type":430,"value":448},"，距今十五年哩。（John Resig 就是写《JavaScript 忍者秘籍》那位）",{"type":425,"tag":426,"props":450,"children":451},{},[452,454,459],{"type":430,"value":453},"令人惊叹的地方是，",{"type":425,"tag":441,"props":455,"children":457},{"className":456},[],[458],{"type":430,"value":446},{"type":430,"value":460}," 的代码和它的名字一样 micro，它能用仅仅 30 行代码完成对模板的处理，并且还有读取 html 模板、缓存、柯里化等额外的高级功能！",{"type":425,"tag":426,"props":462,"children":463},{},[464],{"type":430,"value":465},"可能有些佬没接触过模板解析器，这里给出一个简单的示例。",{"type":425,"tag":467,"props":468,"children":472},"pre",{"className":469,"code":470,"language":471,"meta":419,"style":419},"language-js shiki shiki-themes material-theme-lighter github-light github-dark monokai","parse(`\n  \u003C% if (shouldCount) { %>\n    \u003C% for (var i = 1; i \u003C= 3; i++) { %>\n      \u003Cdiv>hello - \u003C%= i + count %>\u003C/div>\n    \u003C% } %>\n  \u003C% } else { %>\n    \u003Cdiv>noop\u003C/div>\n  \u003C% } %>\n`, {\n  shouldCount: true,\n  count: 1\n})\n","js",[473],{"type":425,"tag":441,"props":474,"children":475},{"__ignoreMap":419},[476,500,510,519,528,537,546,555,564,584,610,629],{"type":425,"tag":477,"props":478,"children":481},"span",{"class":479,"line":480},"line",1,[482,488,494],{"type":425,"tag":477,"props":483,"children":485},{"style":484},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[486],{"type":430,"value":487},"parse",{"type":425,"tag":477,"props":489,"children":491},{"style":490},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[492],{"type":430,"value":493},"(",{"type":425,"tag":477,"props":495,"children":497},{"style":496},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[498],{"type":430,"value":499},"`\n",{"type":425,"tag":477,"props":501,"children":503},{"class":479,"line":502},2,[504],{"type":425,"tag":477,"props":505,"children":507},{"style":506},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[508],{"type":430,"value":509},"  \u003C% if (shouldCount) { %>\n",{"type":425,"tag":477,"props":511,"children":513},{"class":479,"line":512},3,[514],{"type":425,"tag":477,"props":515,"children":516},{"style":506},[517],{"type":430,"value":518},"    \u003C% for (var i = 1; i \u003C= 3; i++) { %>\n",{"type":425,"tag":477,"props":520,"children":522},{"class":479,"line":521},4,[523],{"type":425,"tag":477,"props":524,"children":525},{"style":506},[526],{"type":430,"value":527},"      \u003Cdiv>hello - \u003C%= i + count %>\u003C/div>\n",{"type":425,"tag":477,"props":529,"children":531},{"class":479,"line":530},5,[532],{"type":425,"tag":477,"props":533,"children":534},{"style":506},[535],{"type":430,"value":536},"    \u003C% } %>\n",{"type":425,"tag":477,"props":538,"children":540},{"class":479,"line":539},6,[541],{"type":425,"tag":477,"props":542,"children":543},{"style":506},[544],{"type":430,"value":545},"  \u003C% } else { %>\n",{"type":425,"tag":477,"props":547,"children":549},{"class":479,"line":548},7,[550],{"type":425,"tag":477,"props":551,"children":552},{"style":506},[553],{"type":430,"value":554},"    \u003Cdiv>noop\u003C/div>\n",{"type":425,"tag":477,"props":556,"children":558},{"class":479,"line":557},8,[559],{"type":425,"tag":477,"props":560,"children":561},{"style":506},[562],{"type":430,"value":563},"  \u003C% } %>\n",{"type":425,"tag":477,"props":565,"children":567},{"class":479,"line":566},9,[568,573,579],{"type":425,"tag":477,"props":569,"children":570},{"style":496},[571],{"type":430,"value":572},"`",{"type":425,"tag":477,"props":574,"children":576},{"style":575},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[577],{"type":430,"value":578},",",{"type":425,"tag":477,"props":580,"children":581},{"style":575},[582],{"type":430,"value":583}," {\n",{"type":425,"tag":477,"props":585,"children":587},{"class":479,"line":586},10,[588,594,599,605],{"type":425,"tag":477,"props":589,"children":591},{"style":590},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[592],{"type":430,"value":593},"  shouldCount",{"type":425,"tag":477,"props":595,"children":596},{"style":575},[597],{"type":430,"value":598},":",{"type":425,"tag":477,"props":600,"children":602},{"style":601},"--shiki-light:#FF5370;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[603],{"type":430,"value":604}," true",{"type":425,"tag":477,"props":606,"children":607},{"style":575},[608],{"type":430,"value":609},",\n",{"type":425,"tag":477,"props":611,"children":613},{"class":479,"line":612},11,[614,619,623],{"type":425,"tag":477,"props":615,"children":616},{"style":590},[617],{"type":430,"value":618},"  count",{"type":425,"tag":477,"props":620,"children":621},{"style":575},[622],{"type":430,"value":598},{"type":425,"tag":477,"props":624,"children":626},{"style":625},"--shiki-light:#F76D47;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[627],{"type":430,"value":628}," 1\n",{"type":425,"tag":477,"props":630,"children":632},{"class":479,"line":631},12,[633,638],{"type":425,"tag":477,"props":634,"children":635},{"style":575},[636],{"type":430,"value":637},"}",{"type":425,"tag":477,"props":639,"children":640},{"style":490},[641],{"type":430,"value":642},")\n",{"type":425,"tag":426,"props":644,"children":645},{},[646,648,653],{"type":430,"value":647},"给 ",{"type":425,"tag":441,"props":649,"children":651},{"className":650},[],[652],{"type":430,"value":487},{"type":430,"value":654}," 函数传入模板字符串和数据后，自然也是输出字符串啦：",{"type":425,"tag":467,"props":656,"children":660},{"className":657,"code":658,"language":659,"meta":419,"style":419},"language-html shiki shiki-themes material-theme-lighter github-light github-dark monokai","\u003C!-- 以下经过格式化 -->\n\u003Cdiv>hello - 2\u003C/div>\n\u003Cdiv>hello - 3\u003C/div>\n\u003Cdiv>hello - 4\u003C/div>\n","html",[661],{"type":425,"tag":441,"props":662,"children":663},{"__ignoreMap":419},[664,673,711,743],{"type":425,"tag":477,"props":665,"children":666},{"class":479,"line":480},[667],{"type":425,"tag":477,"props":668,"children":670},{"style":669},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit",[671],{"type":430,"value":672},"\u003C!-- 以下经过格式化 -->\n",{"type":425,"tag":477,"props":674,"children":675},{"class":479,"line":502},[676,681,687,692,697,702,706],{"type":425,"tag":477,"props":677,"children":678},{"style":575},[679],{"type":430,"value":680},"\u003C",{"type":425,"tag":477,"props":682,"children":684},{"style":683},"--shiki-light:#E53935;--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672",[685],{"type":430,"value":686},"div",{"type":425,"tag":477,"props":688,"children":689},{"style":575},[690],{"type":430,"value":691},">",{"type":425,"tag":477,"props":693,"children":694},{"style":490},[695],{"type":430,"value":696},"hello - 2",{"type":425,"tag":477,"props":698,"children":699},{"style":575},[700],{"type":430,"value":701},"\u003C/",{"type":425,"tag":477,"props":703,"children":704},{"style":683},[705],{"type":430,"value":686},{"type":425,"tag":477,"props":707,"children":708},{"style":575},[709],{"type":430,"value":710},">\n",{"type":425,"tag":477,"props":712,"children":713},{"class":479,"line":512},[714,718,722,726,731,735,739],{"type":425,"tag":477,"props":715,"children":716},{"style":575},[717],{"type":430,"value":680},{"type":425,"tag":477,"props":719,"children":720},{"style":683},[721],{"type":430,"value":686},{"type":425,"tag":477,"props":723,"children":724},{"style":575},[725],{"type":430,"value":691},{"type":425,"tag":477,"props":727,"children":728},{"style":490},[729],{"type":430,"value":730},"hello - 3",{"type":425,"tag":477,"props":732,"children":733},{"style":575},[734],{"type":430,"value":701},{"type":425,"tag":477,"props":736,"children":737},{"style":683},[738],{"type":430,"value":686},{"type":425,"tag":477,"props":740,"children":741},{"style":575},[742],{"type":430,"value":710},{"type":425,"tag":477,"props":744,"children":745},{"class":479,"line":521},[746,750,754,758,763,767,771],{"type":425,"tag":477,"props":747,"children":748},{"style":575},[749],{"type":430,"value":680},{"type":425,"tag":477,"props":751,"children":752},{"style":683},[753],{"type":430,"value":686},{"type":425,"tag":477,"props":755,"children":756},{"style":575},[757],{"type":430,"value":691},{"type":425,"tag":477,"props":759,"children":760},{"style":490},[761],{"type":430,"value":762},"hello - 4",{"type":425,"tag":477,"props":764,"children":765},{"style":575},[766],{"type":430,"value":701},{"type":425,"tag":477,"props":768,"children":769},{"style":683},[770],{"type":430,"value":686},{"type":425,"tag":477,"props":772,"children":773},{"style":575},[774],{"type":430,"value":710},{"type":425,"tag":426,"props":776,"children":777},{},[778],{"type":430,"value":779},"相比生态里现在动则 30kb 甚至 300kb 的库，仅 30 行代码完成这个功能，简直不可思议。",{"type":425,"tag":781,"props":782,"children":784},"h2",{"id":783},"完整实现",[785],{"type":430,"value":783},{"type":425,"tag":426,"props":787,"children":788},{},[789],{"type":430,"value":790},"因为代码真的非常短，先直接看一遍，这是带注释版本的。如果你能在第一遍 review 这段代码后脑袋还保持清醒的话，留下评论，我拜你为大哥。",{"type":425,"tag":467,"props":792,"children":794},{"className":469,"code":793,"language":471,"meta":419,"style":419},"// Simple JavaScript Templating\n// John Resig - https://johnresig.com/ - MIT Licensed\n(function () {\n  var cache = {};\n\n  this.tmpl = function tmpl(str, data) {\n    // Figure out if we're getting a template, or if we need to\n    // load the template - and be sure to cache the result.\n    var fn = !/\\W/.test(str)\n      ? (cache[str] =\n          cache[str] || tmpl(document.getElementById(str).innerHTML))\n      : // Generate a reusable function that will serve as a template\n        // generator (and which will be cached).\n        new Function(\n          \"obj\",\n          \"var p=[],print=function(){p.push.apply(p,arguments);};\" +\n            // Introduce the data as local variables using with(){}\n            \"with(obj){p.push('\" +\n            // Convert the template into pure JavaScript\n            str\n              .replace(/[\\r\\t\\n]/g, \" \")\n              .split(\"\u003C%\")\n              .join(\"\\t\")\n              .replace(/((^|%>)[^\\t]*)'/g, \"$1\\r\")\n              .replace(/\\t=(.*?)%>/g, \"',$1,'\")\n              .split(\"\\t\")\n              .join(\"');\")\n              .split(\"%>\")\n              .join(\"p.push('\")\n              .split(\"\\r\")\n              .join(\"\\\\'\") +\n            \"');}return p.join('');\"\n        );\n\n    // Provide some basic currying to the user\n    return data ? fn(data) : fn;\n  };\n})();\n",[795],{"type":425,"tag":441,"props":796,"children":797},{"__ignoreMap":419},[798,806,814,836,860,869,930,938,946,1004,1041,1114,1127,1136,1155,1178,1200,1209,1231,1240,1249,1313,1347,1382,1493,1572,1604,1637,1669,1702,1734,1777,1795,1809,1817,1826,1873,1882],{"type":425,"tag":477,"props":799,"children":800},{"class":479,"line":480},[801],{"type":425,"tag":477,"props":802,"children":803},{"style":669},[804],{"type":430,"value":805},"// Simple JavaScript Templating\n",{"type":425,"tag":477,"props":807,"children":808},{"class":479,"line":502},[809],{"type":425,"tag":477,"props":810,"children":811},{"style":669},[812],{"type":430,"value":813},"// John Resig - https://johnresig.com/ - MIT Licensed\n",{"type":425,"tag":477,"props":815,"children":816},{"class":479,"line":512},[817,821,827,832],{"type":425,"tag":477,"props":818,"children":819},{"style":490},[820],{"type":430,"value":493},{"type":425,"tag":477,"props":822,"children":824},{"style":823},"--shiki-light:#9C3EDA;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic",[825],{"type":430,"value":826},"function",{"type":425,"tag":477,"props":828,"children":829},{"style":575},[830],{"type":430,"value":831}," ()",{"type":425,"tag":477,"props":833,"children":834},{"style":575},[835],{"type":430,"value":583},{"type":425,"tag":477,"props":837,"children":838},{"class":479,"line":521},[839,844,849,855],{"type":425,"tag":477,"props":840,"children":841},{"style":823},[842],{"type":430,"value":843},"  var",{"type":425,"tag":477,"props":845,"children":846},{"style":490},[847],{"type":430,"value":848}," cache",{"type":425,"tag":477,"props":850,"children":852},{"style":851},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[853],{"type":430,"value":854}," =",{"type":425,"tag":477,"props":856,"children":857},{"style":575},[858],{"type":430,"value":859}," {};\n",{"type":425,"tag":477,"props":861,"children":862},{"class":479,"line":530},[863],{"type":425,"tag":477,"props":864,"children":866},{"emptyLinePlaceholder":865},true,[867],{"type":430,"value":868},"\n",{"type":425,"tag":477,"props":870,"children":871},{"class":479,"line":539},[872,878,883,888,892,897,902,906,912,916,921,926],{"type":425,"tag":477,"props":873,"children":875},{"style":874},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[876],{"type":430,"value":877},"  this",{"type":425,"tag":477,"props":879,"children":880},{"style":575},[881],{"type":430,"value":882},".",{"type":425,"tag":477,"props":884,"children":885},{"style":484},[886],{"type":430,"value":887},"tmpl",{"type":425,"tag":477,"props":889,"children":890},{"style":851},[891],{"type":430,"value":854},{"type":425,"tag":477,"props":893,"children":894},{"style":823},[895],{"type":430,"value":896}," function",{"type":425,"tag":477,"props":898,"children":899},{"style":484},[900],{"type":430,"value":901}," tmpl",{"type":425,"tag":477,"props":903,"children":904},{"style":575},[905],{"type":430,"value":493},{"type":425,"tag":477,"props":907,"children":909},{"style":908},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#E36209;--shiki-default-font-style:inherit;--shiki-dark:#FFAB70;--shiki-dark-font-style:inherit;--shiki-sepia:#FD971F;--shiki-sepia-font-style:italic",[910],{"type":430,"value":911},"str",{"type":425,"tag":477,"props":913,"children":914},{"style":575},[915],{"type":430,"value":578},{"type":425,"tag":477,"props":917,"children":918},{"style":908},[919],{"type":430,"value":920}," data",{"type":425,"tag":477,"props":922,"children":923},{"style":575},[924],{"type":430,"value":925},")",{"type":425,"tag":477,"props":927,"children":928},{"style":575},[929],{"type":430,"value":583},{"type":425,"tag":477,"props":931,"children":932},{"class":479,"line":548},[933],{"type":425,"tag":477,"props":934,"children":935},{"style":669},[936],{"type":430,"value":937},"    // Figure out if we're getting a template, or if we need to\n",{"type":425,"tag":477,"props":939,"children":940},{"class":479,"line":557},[941],{"type":425,"tag":477,"props":942,"children":943},{"style":669},[944],{"type":430,"value":945},"    // load the template - and be sure to cache the result.\n",{"type":425,"tag":477,"props":947,"children":948},{"class":479,"line":566},[949,954,959,963,968,973,979,983,987,992,996,1000],{"type":425,"tag":477,"props":950,"children":951},{"style":823},[952],{"type":430,"value":953},"    var",{"type":425,"tag":477,"props":955,"children":956},{"style":490},[957],{"type":430,"value":958}," fn",{"type":425,"tag":477,"props":960,"children":961},{"style":851},[962],{"type":430,"value":854},{"type":425,"tag":477,"props":964,"children":965},{"style":851},[966],{"type":430,"value":967}," !",{"type":425,"tag":477,"props":969,"children":970},{"style":496},[971],{"type":430,"value":972},"/",{"type":425,"tag":477,"props":974,"children":976},{"style":975},"--shiki-light:#91B859;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[977],{"type":430,"value":978},"\\W",{"type":425,"tag":477,"props":980,"children":981},{"style":496},[982],{"type":430,"value":972},{"type":425,"tag":477,"props":984,"children":985},{"style":575},[986],{"type":430,"value":882},{"type":425,"tag":477,"props":988,"children":989},{"style":484},[990],{"type":430,"value":991},"test",{"type":425,"tag":477,"props":993,"children":994},{"style":590},[995],{"type":430,"value":493},{"type":425,"tag":477,"props":997,"children":998},{"style":490},[999],{"type":430,"value":911},{"type":425,"tag":477,"props":1001,"children":1002},{"style":590},[1003],{"type":430,"value":642},{"type":425,"tag":477,"props":1005,"children":1006},{"class":479,"line":586},[1007,1012,1017,1022,1027,1031,1036],{"type":425,"tag":477,"props":1008,"children":1009},{"style":851},[1010],{"type":430,"value":1011},"      ?",{"type":425,"tag":477,"props":1013,"children":1014},{"style":590},[1015],{"type":430,"value":1016}," (",{"type":425,"tag":477,"props":1018,"children":1019},{"style":490},[1020],{"type":430,"value":1021},"cache",{"type":425,"tag":477,"props":1023,"children":1024},{"style":590},[1025],{"type":430,"value":1026},"[",{"type":425,"tag":477,"props":1028,"children":1029},{"style":490},[1030],{"type":430,"value":911},{"type":425,"tag":477,"props":1032,"children":1033},{"style":590},[1034],{"type":430,"value":1035},"] ",{"type":425,"tag":477,"props":1037,"children":1038},{"style":851},[1039],{"type":430,"value":1040},"=\n",{"type":425,"tag":477,"props":1042,"children":1043},{"class":479,"line":612},[1044,1049,1053,1057,1061,1066,1070,1074,1079,1083,1088,1092,1096,1100,1104,1109],{"type":425,"tag":477,"props":1045,"children":1046},{"style":490},[1047],{"type":430,"value":1048},"          cache",{"type":425,"tag":477,"props":1050,"children":1051},{"style":590},[1052],{"type":430,"value":1026},{"type":425,"tag":477,"props":1054,"children":1055},{"style":490},[1056],{"type":430,"value":911},{"type":425,"tag":477,"props":1058,"children":1059},{"style":590},[1060],{"type":430,"value":1035},{"type":425,"tag":477,"props":1062,"children":1063},{"style":851},[1064],{"type":430,"value":1065},"||",{"type":425,"tag":477,"props":1067,"children":1068},{"style":484},[1069],{"type":430,"value":901},{"type":425,"tag":477,"props":1071,"children":1072},{"style":590},[1073],{"type":430,"value":493},{"type":425,"tag":477,"props":1075,"children":1076},{"style":490},[1077],{"type":430,"value":1078},"document",{"type":425,"tag":477,"props":1080,"children":1081},{"style":575},[1082],{"type":430,"value":882},{"type":425,"tag":477,"props":1084,"children":1085},{"style":484},[1086],{"type":430,"value":1087},"getElementById",{"type":425,"tag":477,"props":1089,"children":1090},{"style":590},[1091],{"type":430,"value":493},{"type":425,"tag":477,"props":1093,"children":1094},{"style":490},[1095],{"type":430,"value":911},{"type":425,"tag":477,"props":1097,"children":1098},{"style":590},[1099],{"type":430,"value":925},{"type":425,"tag":477,"props":1101,"children":1102},{"style":575},[1103],{"type":430,"value":882},{"type":425,"tag":477,"props":1105,"children":1106},{"style":490},[1107],{"type":430,"value":1108},"innerHTML",{"type":425,"tag":477,"props":1110,"children":1111},{"style":590},[1112],{"type":430,"value":1113},"))\n",{"type":425,"tag":477,"props":1115,"children":1116},{"class":479,"line":631},[1117,1122],{"type":425,"tag":477,"props":1118,"children":1119},{"style":851},[1120],{"type":430,"value":1121},"      :",{"type":425,"tag":477,"props":1123,"children":1124},{"style":669},[1125],{"type":430,"value":1126}," // Generate a reusable function that will serve as a template\n",{"type":425,"tag":477,"props":1128,"children":1130},{"class":479,"line":1129},13,[1131],{"type":425,"tag":477,"props":1132,"children":1133},{"style":669},[1134],{"type":430,"value":1135},"        // generator (and which will be cached).\n",{"type":425,"tag":477,"props":1137,"children":1139},{"class":479,"line":1138},14,[1140,1145,1150],{"type":425,"tag":477,"props":1141,"children":1142},{"style":851},[1143],{"type":430,"value":1144},"        new",{"type":425,"tag":477,"props":1146,"children":1147},{"style":484},[1148],{"type":430,"value":1149}," Function",{"type":425,"tag":477,"props":1151,"children":1152},{"style":590},[1153],{"type":430,"value":1154},"(\n",{"type":425,"tag":477,"props":1156,"children":1158},{"class":479,"line":1157},15,[1159,1164,1169,1174],{"type":425,"tag":477,"props":1160,"children":1161},{"style":496},[1162],{"type":430,"value":1163},"          \"",{"type":425,"tag":477,"props":1165,"children":1166},{"style":506},[1167],{"type":430,"value":1168},"obj",{"type":425,"tag":477,"props":1170,"children":1171},{"style":496},[1172],{"type":430,"value":1173},"\"",{"type":425,"tag":477,"props":1175,"children":1176},{"style":575},[1177],{"type":430,"value":609},{"type":425,"tag":477,"props":1179,"children":1181},{"class":479,"line":1180},16,[1182,1186,1191,1195],{"type":425,"tag":477,"props":1183,"children":1184},{"style":496},[1185],{"type":430,"value":1163},{"type":425,"tag":477,"props":1187,"children":1188},{"style":506},[1189],{"type":430,"value":1190},"var p=[],print=function(){p.push.apply(p,arguments);};",{"type":425,"tag":477,"props":1192,"children":1193},{"style":496},[1194],{"type":430,"value":1173},{"type":425,"tag":477,"props":1196,"children":1197},{"style":851},[1198],{"type":430,"value":1199}," +\n",{"type":425,"tag":477,"props":1201,"children":1203},{"class":479,"line":1202},17,[1204],{"type":425,"tag":477,"props":1205,"children":1206},{"style":669},[1207],{"type":430,"value":1208},"            // Introduce the data as local variables using with(){}\n",{"type":425,"tag":477,"props":1210,"children":1212},{"class":479,"line":1211},18,[1213,1218,1223,1227],{"type":425,"tag":477,"props":1214,"children":1215},{"style":496},[1216],{"type":430,"value":1217},"            \"",{"type":425,"tag":477,"props":1219,"children":1220},{"style":506},[1221],{"type":430,"value":1222},"with(obj){p.push('",{"type":425,"tag":477,"props":1224,"children":1225},{"style":496},[1226],{"type":430,"value":1173},{"type":425,"tag":477,"props":1228,"children":1229},{"style":851},[1230],{"type":430,"value":1199},{"type":425,"tag":477,"props":1232,"children":1234},{"class":479,"line":1233},19,[1235],{"type":425,"tag":477,"props":1236,"children":1237},{"style":669},[1238],{"type":430,"value":1239},"            // Convert the template into pure JavaScript\n",{"type":425,"tag":477,"props":1241,"children":1243},{"class":479,"line":1242},20,[1244],{"type":425,"tag":477,"props":1245,"children":1246},{"style":490},[1247],{"type":430,"value":1248},"            str\n",{"type":425,"tag":477,"props":1250,"children":1252},{"class":479,"line":1251},21,[1253,1258,1263,1267,1271,1276,1281,1286,1290,1296,1300,1305,1309],{"type":425,"tag":477,"props":1254,"children":1255},{"style":575},[1256],{"type":430,"value":1257},"              .",{"type":425,"tag":477,"props":1259,"children":1260},{"style":484},[1261],{"type":430,"value":1262},"replace",{"type":425,"tag":477,"props":1264,"children":1265},{"style":590},[1266],{"type":430,"value":493},{"type":425,"tag":477,"props":1268,"children":1269},{"style":496},[1270],{"type":430,"value":972},{"type":425,"tag":477,"props":1272,"children":1274},{"style":1273},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[1275],{"type":430,"value":1026},{"type":425,"tag":477,"props":1277,"children":1278},{"style":975},[1279],{"type":430,"value":1280},"\\r\\t\\n",{"type":425,"tag":477,"props":1282,"children":1283},{"style":1273},[1284],{"type":430,"value":1285},"]",{"type":425,"tag":477,"props":1287,"children":1288},{"style":496},[1289],{"type":430,"value":972},{"type":425,"tag":477,"props":1291,"children":1293},{"style":1292},"--shiki-light:#F76D47;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[1294],{"type":430,"value":1295},"g",{"type":425,"tag":477,"props":1297,"children":1298},{"style":575},[1299],{"type":430,"value":578},{"type":425,"tag":477,"props":1301,"children":1302},{"style":496},[1303],{"type":430,"value":1304}," \"",{"type":425,"tag":477,"props":1306,"children":1307},{"style":496},[1308],{"type":430,"value":1304},{"type":425,"tag":477,"props":1310,"children":1311},{"style":590},[1312],{"type":430,"value":642},{"type":425,"tag":477,"props":1314,"children":1316},{"class":479,"line":1315},22,[1317,1321,1326,1330,1334,1339,1343],{"type":425,"tag":477,"props":1318,"children":1319},{"style":575},[1320],{"type":430,"value":1257},{"type":425,"tag":477,"props":1322,"children":1323},{"style":484},[1324],{"type":430,"value":1325},"split",{"type":425,"tag":477,"props":1327,"children":1328},{"style":590},[1329],{"type":430,"value":493},{"type":425,"tag":477,"props":1331,"children":1332},{"style":496},[1333],{"type":430,"value":1173},{"type":425,"tag":477,"props":1335,"children":1336},{"style":506},[1337],{"type":430,"value":1338},"\u003C%",{"type":425,"tag":477,"props":1340,"children":1341},{"style":496},[1342],{"type":430,"value":1173},{"type":425,"tag":477,"props":1344,"children":1345},{"style":590},[1346],{"type":430,"value":642},{"type":425,"tag":477,"props":1348,"children":1350},{"class":479,"line":1349},23,[1351,1355,1360,1364,1368,1374,1378],{"type":425,"tag":477,"props":1352,"children":1353},{"style":575},[1354],{"type":430,"value":1257},{"type":425,"tag":477,"props":1356,"children":1357},{"style":484},[1358],{"type":430,"value":1359},"join",{"type":425,"tag":477,"props":1361,"children":1362},{"style":590},[1363],{"type":430,"value":493},{"type":425,"tag":477,"props":1365,"children":1366},{"style":496},[1367],{"type":430,"value":1173},{"type":425,"tag":477,"props":1369,"children":1371},{"style":1370},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[1372],{"type":430,"value":1373},"\\t",{"type":425,"tag":477,"props":1375,"children":1376},{"style":496},[1377],{"type":430,"value":1173},{"type":425,"tag":477,"props":1379,"children":1380},{"style":590},[1381],{"type":430,"value":642},{"type":425,"tag":477,"props":1383,"children":1385},{"class":479,"line":1384},24,[1386,1390,1394,1398,1402,1408,1414,1419,1425,1429,1433,1437,1441,1445,1450,1454,1459,1463,1467,1471,1475,1480,1485,1489],{"type":425,"tag":477,"props":1387,"children":1388},{"style":575},[1389],{"type":430,"value":1257},{"type":425,"tag":477,"props":1391,"children":1392},{"style":484},[1393],{"type":430,"value":1262},{"type":425,"tag":477,"props":1395,"children":1396},{"style":590},[1397],{"type":430,"value":493},{"type":425,"tag":477,"props":1399,"children":1400},{"style":496},[1401],{"type":430,"value":972},{"type":425,"tag":477,"props":1403,"children":1405},{"style":1404},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#DBEDFF;--shiki-sepia:#E6DB74",[1406],{"type":430,"value":1407},"((",{"type":425,"tag":477,"props":1409,"children":1411},{"style":1410},"--shiki-light:#39ADB5;--shiki-light-font-style:italic;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#F92672;--shiki-sepia-font-style:inherit",[1412],{"type":430,"value":1413},"^",{"type":425,"tag":477,"props":1415,"children":1416},{"style":851},[1417],{"type":430,"value":1418},"|",{"type":425,"tag":477,"props":1420,"children":1422},{"style":1421},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#DBEDFF;--shiki-sepia:#E6DB74",[1423],{"type":430,"value":1424},"%>",{"type":425,"tag":477,"props":1426,"children":1427},{"style":1404},[1428],{"type":430,"value":925},{"type":425,"tag":477,"props":1430,"children":1431},{"style":1273},[1432],{"type":430,"value":1026},{"type":425,"tag":477,"props":1434,"children":1435},{"style":851},[1436],{"type":430,"value":1413},{"type":425,"tag":477,"props":1438,"children":1439},{"style":975},[1440],{"type":430,"value":1373},{"type":425,"tag":477,"props":1442,"children":1443},{"style":1273},[1444],{"type":430,"value":1285},{"type":425,"tag":477,"props":1446,"children":1447},{"style":851},[1448],{"type":430,"value":1449},"*",{"type":425,"tag":477,"props":1451,"children":1452},{"style":1404},[1453],{"type":430,"value":925},{"type":425,"tag":477,"props":1455,"children":1456},{"style":1421},[1457],{"type":430,"value":1458},"'",{"type":425,"tag":477,"props":1460,"children":1461},{"style":496},[1462],{"type":430,"value":972},{"type":425,"tag":477,"props":1464,"children":1465},{"style":1292},[1466],{"type":430,"value":1295},{"type":425,"tag":477,"props":1468,"children":1469},{"style":575},[1470],{"type":430,"value":578},{"type":425,"tag":477,"props":1472,"children":1473},{"style":496},[1474],{"type":430,"value":1304},{"type":425,"tag":477,"props":1476,"children":1477},{"style":506},[1478],{"type":430,"value":1479},"$1",{"type":425,"tag":477,"props":1481,"children":1482},{"style":1370},[1483],{"type":430,"value":1484},"\\r",{"type":425,"tag":477,"props":1486,"children":1487},{"style":496},[1488],{"type":430,"value":1173},{"type":425,"tag":477,"props":1490,"children":1491},{"style":590},[1492],{"type":430,"value":642},{"type":425,"tag":477,"props":1494,"children":1496},{"class":479,"line":1495},25,[1497,1501,1505,1509,1513,1517,1522,1526,1530,1535,1539,1543,1547,1551,1555,1559,1564,1568],{"type":425,"tag":477,"props":1498,"children":1499},{"style":575},[1500],{"type":430,"value":1257},{"type":425,"tag":477,"props":1502,"children":1503},{"style":484},[1504],{"type":430,"value":1262},{"type":425,"tag":477,"props":1506,"children":1507},{"style":590},[1508],{"type":430,"value":493},{"type":425,"tag":477,"props":1510,"children":1511},{"style":496},[1512],{"type":430,"value":972},{"type":425,"tag":477,"props":1514,"children":1515},{"style":975},[1516],{"type":430,"value":1373},{"type":425,"tag":477,"props":1518,"children":1519},{"style":1421},[1520],{"type":430,"value":1521},"=",{"type":425,"tag":477,"props":1523,"children":1524},{"style":1404},[1525],{"type":430,"value":493},{"type":425,"tag":477,"props":1527,"children":1528},{"style":975},[1529],{"type":430,"value":882},{"type":425,"tag":477,"props":1531,"children":1532},{"style":851},[1533],{"type":430,"value":1534},"*?",{"type":425,"tag":477,"props":1536,"children":1537},{"style":1404},[1538],{"type":430,"value":925},{"type":425,"tag":477,"props":1540,"children":1541},{"style":1421},[1542],{"type":430,"value":1424},{"type":425,"tag":477,"props":1544,"children":1545},{"style":496},[1546],{"type":430,"value":972},{"type":425,"tag":477,"props":1548,"children":1549},{"style":1292},[1550],{"type":430,"value":1295},{"type":425,"tag":477,"props":1552,"children":1553},{"style":575},[1554],{"type":430,"value":578},{"type":425,"tag":477,"props":1556,"children":1557},{"style":496},[1558],{"type":430,"value":1304},{"type":425,"tag":477,"props":1560,"children":1561},{"style":506},[1562],{"type":430,"value":1563},"',$1,'",{"type":425,"tag":477,"props":1565,"children":1566},{"style":496},[1567],{"type":430,"value":1173},{"type":425,"tag":477,"props":1569,"children":1570},{"style":590},[1571],{"type":430,"value":642},{"type":425,"tag":477,"props":1573,"children":1575},{"class":479,"line":1574},26,[1576,1580,1584,1588,1592,1596,1600],{"type":425,"tag":477,"props":1577,"children":1578},{"style":575},[1579],{"type":430,"value":1257},{"type":425,"tag":477,"props":1581,"children":1582},{"style":484},[1583],{"type":430,"value":1325},{"type":425,"tag":477,"props":1585,"children":1586},{"style":590},[1587],{"type":430,"value":493},{"type":425,"tag":477,"props":1589,"children":1590},{"style":496},[1591],{"type":430,"value":1173},{"type":425,"tag":477,"props":1593,"children":1594},{"style":1370},[1595],{"type":430,"value":1373},{"type":425,"tag":477,"props":1597,"children":1598},{"style":496},[1599],{"type":430,"value":1173},{"type":425,"tag":477,"props":1601,"children":1602},{"style":590},[1603],{"type":430,"value":642},{"type":425,"tag":477,"props":1605,"children":1607},{"class":479,"line":1606},27,[1608,1612,1616,1620,1624,1629,1633],{"type":425,"tag":477,"props":1609,"children":1610},{"style":575},[1611],{"type":430,"value":1257},{"type":425,"tag":477,"props":1613,"children":1614},{"style":484},[1615],{"type":430,"value":1359},{"type":425,"tag":477,"props":1617,"children":1618},{"style":590},[1619],{"type":430,"value":493},{"type":425,"tag":477,"props":1621,"children":1622},{"style":496},[1623],{"type":430,"value":1173},{"type":425,"tag":477,"props":1625,"children":1626},{"style":506},[1627],{"type":430,"value":1628},"');",{"type":425,"tag":477,"props":1630,"children":1631},{"style":496},[1632],{"type":430,"value":1173},{"type":425,"tag":477,"props":1634,"children":1635},{"style":590},[1636],{"type":430,"value":642},{"type":425,"tag":477,"props":1638,"children":1640},{"class":479,"line":1639},28,[1641,1645,1649,1653,1657,1661,1665],{"type":425,"tag":477,"props":1642,"children":1643},{"style":575},[1644],{"type":430,"value":1257},{"type":425,"tag":477,"props":1646,"children":1647},{"style":484},[1648],{"type":430,"value":1325},{"type":425,"tag":477,"props":1650,"children":1651},{"style":590},[1652],{"type":430,"value":493},{"type":425,"tag":477,"props":1654,"children":1655},{"style":496},[1656],{"type":430,"value":1173},{"type":425,"tag":477,"props":1658,"children":1659},{"style":506},[1660],{"type":430,"value":1424},{"type":425,"tag":477,"props":1662,"children":1663},{"style":496},[1664],{"type":430,"value":1173},{"type":425,"tag":477,"props":1666,"children":1667},{"style":590},[1668],{"type":430,"value":642},{"type":425,"tag":477,"props":1670,"children":1672},{"class":479,"line":1671},29,[1673,1677,1681,1685,1689,1694,1698],{"type":425,"tag":477,"props":1674,"children":1675},{"style":575},[1676],{"type":430,"value":1257},{"type":425,"tag":477,"props":1678,"children":1679},{"style":484},[1680],{"type":430,"value":1359},{"type":425,"tag":477,"props":1682,"children":1683},{"style":590},[1684],{"type":430,"value":493},{"type":425,"tag":477,"props":1686,"children":1687},{"style":496},[1688],{"type":430,"value":1173},{"type":425,"tag":477,"props":1690,"children":1691},{"style":506},[1692],{"type":430,"value":1693},"p.push('",{"type":425,"tag":477,"props":1695,"children":1696},{"style":496},[1697],{"type":430,"value":1173},{"type":425,"tag":477,"props":1699,"children":1700},{"style":590},[1701],{"type":430,"value":642},{"type":425,"tag":477,"props":1703,"children":1705},{"class":479,"line":1704},30,[1706,1710,1714,1718,1722,1726,1730],{"type":425,"tag":477,"props":1707,"children":1708},{"style":575},[1709],{"type":430,"value":1257},{"type":425,"tag":477,"props":1711,"children":1712},{"style":484},[1713],{"type":430,"value":1325},{"type":425,"tag":477,"props":1715,"children":1716},{"style":590},[1717],{"type":430,"value":493},{"type":425,"tag":477,"props":1719,"children":1720},{"style":496},[1721],{"type":430,"value":1173},{"type":425,"tag":477,"props":1723,"children":1724},{"style":1370},[1725],{"type":430,"value":1484},{"type":425,"tag":477,"props":1727,"children":1728},{"style":496},[1729],{"type":430,"value":1173},{"type":425,"tag":477,"props":1731,"children":1732},{"style":590},[1733],{"type":430,"value":642},{"type":425,"tag":477,"props":1735,"children":1737},{"class":479,"line":1736},31,[1738,1742,1746,1750,1754,1759,1763,1767,1772],{"type":425,"tag":477,"props":1739,"children":1740},{"style":575},[1741],{"type":430,"value":1257},{"type":425,"tag":477,"props":1743,"children":1744},{"style":484},[1745],{"type":430,"value":1359},{"type":425,"tag":477,"props":1747,"children":1748},{"style":590},[1749],{"type":430,"value":493},{"type":425,"tag":477,"props":1751,"children":1752},{"style":496},[1753],{"type":430,"value":1173},{"type":425,"tag":477,"props":1755,"children":1756},{"style":1370},[1757],{"type":430,"value":1758},"\\\\",{"type":425,"tag":477,"props":1760,"children":1761},{"style":506},[1762],{"type":430,"value":1458},{"type":425,"tag":477,"props":1764,"children":1765},{"style":496},[1766],{"type":430,"value":1173},{"type":425,"tag":477,"props":1768,"children":1769},{"style":590},[1770],{"type":430,"value":1771},") ",{"type":425,"tag":477,"props":1773,"children":1774},{"style":851},[1775],{"type":430,"value":1776},"+\n",{"type":425,"tag":477,"props":1778,"children":1780},{"class":479,"line":1779},32,[1781,1785,1790],{"type":425,"tag":477,"props":1782,"children":1783},{"style":496},[1784],{"type":430,"value":1217},{"type":425,"tag":477,"props":1786,"children":1787},{"style":506},[1788],{"type":430,"value":1789},"');}return p.join('');",{"type":425,"tag":477,"props":1791,"children":1792},{"style":496},[1793],{"type":430,"value":1794},"\"\n",{"type":425,"tag":477,"props":1796,"children":1798},{"class":479,"line":1797},33,[1799,1804],{"type":425,"tag":477,"props":1800,"children":1801},{"style":590},[1802],{"type":430,"value":1803},"        )",{"type":425,"tag":477,"props":1805,"children":1806},{"style":575},[1807],{"type":430,"value":1808},";\n",{"type":425,"tag":477,"props":1810,"children":1812},{"class":479,"line":1811},34,[1813],{"type":425,"tag":477,"props":1814,"children":1815},{"emptyLinePlaceholder":865},[1816],{"type":430,"value":868},{"type":425,"tag":477,"props":1818,"children":1820},{"class":479,"line":1819},35,[1821],{"type":425,"tag":477,"props":1822,"children":1823},{"style":669},[1824],{"type":430,"value":1825},"    // Provide some basic currying to the user\n",{"type":425,"tag":477,"props":1827,"children":1829},{"class":479,"line":1828},36,[1830,1835,1839,1844,1848,1852,1857,1861,1865,1869],{"type":425,"tag":477,"props":1831,"children":1832},{"style":1410},[1833],{"type":430,"value":1834},"    return",{"type":425,"tag":477,"props":1836,"children":1837},{"style":490},[1838],{"type":430,"value":920},{"type":425,"tag":477,"props":1840,"children":1841},{"style":851},[1842],{"type":430,"value":1843}," ?",{"type":425,"tag":477,"props":1845,"children":1846},{"style":484},[1847],{"type":430,"value":958},{"type":425,"tag":477,"props":1849,"children":1850},{"style":590},[1851],{"type":430,"value":493},{"type":425,"tag":477,"props":1853,"children":1854},{"style":490},[1855],{"type":430,"value":1856},"data",{"type":425,"tag":477,"props":1858,"children":1859},{"style":590},[1860],{"type":430,"value":1771},{"type":425,"tag":477,"props":1862,"children":1863},{"style":851},[1864],{"type":430,"value":598},{"type":425,"tag":477,"props":1866,"children":1867},{"style":490},[1868],{"type":430,"value":958},{"type":425,"tag":477,"props":1870,"children":1871},{"style":575},[1872],{"type":430,"value":1808},{"type":425,"tag":477,"props":1874,"children":1876},{"class":479,"line":1875},37,[1877],{"type":425,"tag":477,"props":1878,"children":1879},{"style":575},[1880],{"type":430,"value":1881},"  };\n",{"type":425,"tag":477,"props":1883,"children":1885},{"class":479,"line":1884},38,[1886,1890,1895],{"type":425,"tag":477,"props":1887,"children":1888},{"style":575},[1889],{"type":430,"value":637},{"type":425,"tag":477,"props":1891,"children":1892},{"style":490},[1893],{"type":430,"value":1894},")()",{"type":425,"tag":477,"props":1896,"children":1897},{"style":575},[1898],{"type":430,"value":1808},{"type":425,"tag":426,"props":1900,"children":1901},{},[1902],{"type":430,"value":1903},"代码看完了，我知道你没看懂，因为曾经我也是。好了，留下三连，解析开始。",{"type":425,"tag":781,"props":1905,"children":1907},{"id":1906},"解析",[1908],{"type":430,"value":1906},{"type":425,"tag":426,"props":1910,"children":1911},{},[1912],{"type":430,"value":1913},"首先，代码最外层是一个 IIFE，给 this 对象挂载了 tmpl 函数，直接执行的话就是 window。内部通过局部变量保存了模板解析的缓存：",{"type":425,"tag":467,"props":1915,"children":1917},{"className":469,"code":1916,"language":471,"meta":419,"style":419},"(function () {\n  var cache = {};\n  this.tmpl = function tmpl(str, data) {};\n})();\n",[1918],{"type":425,"tag":441,"props":1919,"children":1920},{"__ignoreMap":419},[1921,1940,1959,2010],{"type":425,"tag":477,"props":1922,"children":1923},{"class":479,"line":480},[1924,1928,1932,1936],{"type":425,"tag":477,"props":1925,"children":1926},{"style":490},[1927],{"type":430,"value":493},{"type":425,"tag":477,"props":1929,"children":1930},{"style":823},[1931],{"type":430,"value":826},{"type":425,"tag":477,"props":1933,"children":1934},{"style":575},[1935],{"type":430,"value":831},{"type":425,"tag":477,"props":1937,"children":1938},{"style":575},[1939],{"type":430,"value":583},{"type":425,"tag":477,"props":1941,"children":1942},{"class":479,"line":502},[1943,1947,1951,1955],{"type":425,"tag":477,"props":1944,"children":1945},{"style":823},[1946],{"type":430,"value":843},{"type":425,"tag":477,"props":1948,"children":1949},{"style":490},[1950],{"type":430,"value":848},{"type":425,"tag":477,"props":1952,"children":1953},{"style":851},[1954],{"type":430,"value":854},{"type":425,"tag":477,"props":1956,"children":1957},{"style":575},[1958],{"type":430,"value":859},{"type":425,"tag":477,"props":1960,"children":1961},{"class":479,"line":512},[1962,1966,1970,1974,1978,1982,1986,1990,1994,1998,2002,2006],{"type":425,"tag":477,"props":1963,"children":1964},{"style":874},[1965],{"type":430,"value":877},{"type":425,"tag":477,"props":1967,"children":1968},{"style":575},[1969],{"type":430,"value":882},{"type":425,"tag":477,"props":1971,"children":1972},{"style":484},[1973],{"type":430,"value":887},{"type":425,"tag":477,"props":1975,"children":1976},{"style":851},[1977],{"type":430,"value":854},{"type":425,"tag":477,"props":1979,"children":1980},{"style":823},[1981],{"type":430,"value":896},{"type":425,"tag":477,"props":1983,"children":1984},{"style":484},[1985],{"type":430,"value":901},{"type":425,"tag":477,"props":1987,"children":1988},{"style":575},[1989],{"type":430,"value":493},{"type":425,"tag":477,"props":1991,"children":1992},{"style":908},[1993],{"type":430,"value":911},{"type":425,"tag":477,"props":1995,"children":1996},{"style":575},[1997],{"type":430,"value":578},{"type":425,"tag":477,"props":1999,"children":2000},{"style":908},[2001],{"type":430,"value":920},{"type":425,"tag":477,"props":2003,"children":2004},{"style":575},[2005],{"type":430,"value":925},{"type":425,"tag":477,"props":2007,"children":2008},{"style":575},[2009],{"type":430,"value":859},{"type":425,"tag":477,"props":2011,"children":2012},{"class":479,"line":521},[2013,2017,2021],{"type":425,"tag":477,"props":2014,"children":2015},{"style":575},[2016],{"type":430,"value":637},{"type":425,"tag":477,"props":2018,"children":2019},{"style":490},[2020],{"type":430,"value":1894},{"type":425,"tag":477,"props":2022,"children":2023},{"style":575},[2024],{"type":430,"value":1808},{"type":425,"tag":426,"props":2026,"children":2027},{},[2028,2030,2036],{"type":430,"value":2029},"str 参数有两种两种用途，",{"type":425,"tag":441,"props":2031,"children":2033},{"className":2032},[],[2034],{"type":430,"value":2035},"/\\W/.test(str)",{"type":430,"value":2037}," 用来判断字符串中包不包含模板分隔符，如果不含分隔符，即普通字符串，那就当作 ID，从页面对应 ID 的节点中获取内容作为模板。比如，如果 str 为 'user_tmpl'，那么模板函数将会读取页面的以下脚本的内容作为输入：",{"type":425,"tag":467,"props":2039,"children":2041},{"className":657,"code":2040,"language":659,"meta":419,"style":419},"\u003C!-- type=\"text/html\"，所以浏览器并不会执行这串脚本。它只能由 tmpl 来读取... -->\n\u003Cscript type=\"text/html\" id=\"item_tmpl\">\n  \u003Cdiv id=\"\u003C%=id%>\" class=\"\u003C%=(i % 2 == 1 ? \" even\" : \"\")%>\">\n    \u003Cdiv class=\"grid_1 alpha right\">\n      \u003Cimg class=\"righted\" src=\"\u003C%=profile_image_url%>\"/>\n    \u003C/div>\n    \u003Cdiv class=\"grid_6 omega contents\">\n      \u003Cp>\u003Cb>\u003Ca href=\"/\u003C%=from_user%>\">\u003C%=from_user%>\u003C/a>:\u003C/b> \u003C%=text%>\u003C/p>\n    \u003C/div>\n  \u003C/div>\n\u003C/script>\n",[2042],{"type":425,"tag":441,"props":2043,"children":2044},{"__ignoreMap":419},[2045,2053,2114,2198,2235,2296,2312,2348,2453,2468,2484],{"type":425,"tag":477,"props":2046,"children":2047},{"class":479,"line":480},[2048],{"type":425,"tag":477,"props":2049,"children":2050},{"style":669},[2051],{"type":430,"value":2052},"\u003C!-- type=\"text/html\"，所以浏览器并不会执行这串脚本。它只能由 tmpl 来读取... -->\n",{"type":425,"tag":477,"props":2054,"children":2055},{"class":479,"line":502},[2056,2060,2065,2071,2075,2079,2084,2088,2093,2097,2101,2106,2110],{"type":425,"tag":477,"props":2057,"children":2058},{"style":575},[2059],{"type":430,"value":680},{"type":425,"tag":477,"props":2061,"children":2062},{"style":683},[2063],{"type":430,"value":2064},"script",{"type":425,"tag":477,"props":2066,"children":2068},{"style":2067},"--shiki-light:#9C3EDA;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[2069],{"type":430,"value":2070}," type",{"type":425,"tag":477,"props":2072,"children":2073},{"style":575},[2074],{"type":430,"value":1521},{"type":425,"tag":477,"props":2076,"children":2077},{"style":496},[2078],{"type":430,"value":1173},{"type":425,"tag":477,"props":2080,"children":2081},{"style":506},[2082],{"type":430,"value":2083},"text/html",{"type":425,"tag":477,"props":2085,"children":2086},{"style":496},[2087],{"type":430,"value":1173},{"type":425,"tag":477,"props":2089,"children":2090},{"style":2067},[2091],{"type":430,"value":2092}," id",{"type":425,"tag":477,"props":2094,"children":2095},{"style":575},[2096],{"type":430,"value":1521},{"type":425,"tag":477,"props":2098,"children":2099},{"style":496},[2100],{"type":430,"value":1173},{"type":425,"tag":477,"props":2102,"children":2103},{"style":506},[2104],{"type":430,"value":2105},"item_tmpl",{"type":425,"tag":477,"props":2107,"children":2108},{"style":496},[2109],{"type":430,"value":1173},{"type":425,"tag":477,"props":2111,"children":2112},{"style":575},[2113],{"type":430,"value":710},{"type":425,"tag":477,"props":2115,"children":2116},{"class":479,"line":512},[2117,2122,2126,2130,2134,2138,2143,2147,2152,2156,2160,2165,2169,2174,2179,2184,2189,2193],{"type":425,"tag":477,"props":2118,"children":2119},{"style":575},[2120],{"type":430,"value":2121},"  \u003C",{"type":425,"tag":477,"props":2123,"children":2124},{"style":683},[2125],{"type":430,"value":686},{"type":425,"tag":477,"props":2127,"children":2128},{"style":2067},[2129],{"type":430,"value":2092},{"type":425,"tag":477,"props":2131,"children":2132},{"style":575},[2133],{"type":430,"value":1521},{"type":425,"tag":477,"props":2135,"children":2136},{"style":496},[2137],{"type":430,"value":1173},{"type":425,"tag":477,"props":2139,"children":2140},{"style":506},[2141],{"type":430,"value":2142},"\u003C%=id%>",{"type":425,"tag":477,"props":2144,"children":2145},{"style":496},[2146],{"type":430,"value":1173},{"type":425,"tag":477,"props":2148,"children":2149},{"style":2067},[2150],{"type":430,"value":2151}," class",{"type":425,"tag":477,"props":2153,"children":2154},{"style":575},[2155],{"type":430,"value":1521},{"type":425,"tag":477,"props":2157,"children":2158},{"style":496},[2159],{"type":430,"value":1173},{"type":425,"tag":477,"props":2161,"children":2162},{"style":506},[2163],{"type":430,"value":2164},"\u003C%=(i % 2 == 1 ? ",{"type":425,"tag":477,"props":2166,"children":2167},{"style":496},[2168],{"type":430,"value":1173},{"type":425,"tag":477,"props":2170,"children":2171},{"style":2067},[2172],{"type":430,"value":2173}," even",{"type":425,"tag":477,"props":2175,"children":2177},{"style":2176},"--shiki-light:#39ADB5;--shiki-light-font-style:inherit;--shiki-default:#B31D28;--shiki-default-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;--shiki-sepia:#F44747;--shiki-sepia-font-style:inherit",[2178],{"type":430,"value":1173},{"type":425,"tag":477,"props":2180,"children":2181},{"style":2067},[2182],{"type":430,"value":2183}," :",{"type":425,"tag":477,"props":2185,"children":2186},{"style":2176},[2187],{"type":430,"value":2188}," \"\")%",{"type":425,"tag":477,"props":2190,"children":2191},{"style":575},[2192],{"type":430,"value":691},{"type":425,"tag":477,"props":2194,"children":2195},{"style":490},[2196],{"type":430,"value":2197},"\">\n",{"type":425,"tag":477,"props":2199,"children":2200},{"class":479,"line":521},[2201,2206,2210,2214,2218,2222,2227,2231],{"type":425,"tag":477,"props":2202,"children":2203},{"style":575},[2204],{"type":430,"value":2205},"    \u003C",{"type":425,"tag":477,"props":2207,"children":2208},{"style":683},[2209],{"type":430,"value":686},{"type":425,"tag":477,"props":2211,"children":2212},{"style":2067},[2213],{"type":430,"value":2151},{"type":425,"tag":477,"props":2215,"children":2216},{"style":575},[2217],{"type":430,"value":1521},{"type":425,"tag":477,"props":2219,"children":2220},{"style":496},[2221],{"type":430,"value":1173},{"type":425,"tag":477,"props":2223,"children":2224},{"style":506},[2225],{"type":430,"value":2226},"grid_1 alpha right",{"type":425,"tag":477,"props":2228,"children":2229},{"style":496},[2230],{"type":430,"value":1173},{"type":425,"tag":477,"props":2232,"children":2233},{"style":575},[2234],{"type":430,"value":710},{"type":425,"tag":477,"props":2236,"children":2237},{"class":479,"line":530},[2238,2243,2248,2252,2256,2260,2265,2269,2274,2278,2282,2287,2291],{"type":425,"tag":477,"props":2239,"children":2240},{"style":575},[2241],{"type":430,"value":2242},"      \u003C",{"type":425,"tag":477,"props":2244,"children":2245},{"style":683},[2246],{"type":430,"value":2247},"img",{"type":425,"tag":477,"props":2249,"children":2250},{"style":2067},[2251],{"type":430,"value":2151},{"type":425,"tag":477,"props":2253,"children":2254},{"style":575},[2255],{"type":430,"value":1521},{"type":425,"tag":477,"props":2257,"children":2258},{"style":496},[2259],{"type":430,"value":1173},{"type":425,"tag":477,"props":2261,"children":2262},{"style":506},[2263],{"type":430,"value":2264},"righted",{"type":425,"tag":477,"props":2266,"children":2267},{"style":496},[2268],{"type":430,"value":1173},{"type":425,"tag":477,"props":2270,"children":2271},{"style":2067},[2272],{"type":430,"value":2273}," src",{"type":425,"tag":477,"props":2275,"children":2276},{"style":575},[2277],{"type":430,"value":1521},{"type":425,"tag":477,"props":2279,"children":2280},{"style":496},[2281],{"type":430,"value":1173},{"type":425,"tag":477,"props":2283,"children":2284},{"style":506},[2285],{"type":430,"value":2286},"\u003C%=profile_image_url%>",{"type":425,"tag":477,"props":2288,"children":2289},{"style":496},[2290],{"type":430,"value":1173},{"type":425,"tag":477,"props":2292,"children":2293},{"style":575},[2294],{"type":430,"value":2295},"/>\n",{"type":425,"tag":477,"props":2297,"children":2298},{"class":479,"line":539},[2299,2304,2308],{"type":425,"tag":477,"props":2300,"children":2301},{"style":575},[2302],{"type":430,"value":2303},"    \u003C/",{"type":425,"tag":477,"props":2305,"children":2306},{"style":683},[2307],{"type":430,"value":686},{"type":425,"tag":477,"props":2309,"children":2310},{"style":575},[2311],{"type":430,"value":710},{"type":425,"tag":477,"props":2313,"children":2314},{"class":479,"line":548},[2315,2319,2323,2327,2331,2335,2340,2344],{"type":425,"tag":477,"props":2316,"children":2317},{"style":575},[2318],{"type":430,"value":2205},{"type":425,"tag":477,"props":2320,"children":2321},{"style":683},[2322],{"type":430,"value":686},{"type":425,"tag":477,"props":2324,"children":2325},{"style":2067},[2326],{"type":430,"value":2151},{"type":425,"tag":477,"props":2328,"children":2329},{"style":575},[2330],{"type":430,"value":1521},{"type":425,"tag":477,"props":2332,"children":2333},{"style":496},[2334],{"type":430,"value":1173},{"type":425,"tag":477,"props":2336,"children":2337},{"style":506},[2338],{"type":430,"value":2339},"grid_6 omega contents",{"type":425,"tag":477,"props":2341,"children":2342},{"style":496},[2343],{"type":430,"value":1173},{"type":425,"tag":477,"props":2345,"children":2346},{"style":575},[2347],{"type":430,"value":710},{"type":425,"tag":477,"props":2349,"children":2350},{"class":479,"line":557},[2351,2355,2359,2364,2369,2373,2377,2382,2386,2390,2395,2399,2403,2408,2412,2416,2420,2424,2428,2432,2436,2441,2445,2449],{"type":425,"tag":477,"props":2352,"children":2353},{"style":575},[2354],{"type":430,"value":2242},{"type":425,"tag":477,"props":2356,"children":2357},{"style":683},[2358],{"type":430,"value":426},{"type":425,"tag":477,"props":2360,"children":2361},{"style":575},[2362],{"type":430,"value":2363},">\u003C",{"type":425,"tag":477,"props":2365,"children":2366},{"style":683},[2367],{"type":430,"value":2368},"b",{"type":425,"tag":477,"props":2370,"children":2371},{"style":575},[2372],{"type":430,"value":2363},{"type":425,"tag":477,"props":2374,"children":2375},{"style":683},[2376],{"type":430,"value":433},{"type":425,"tag":477,"props":2378,"children":2379},{"style":2067},[2380],{"type":430,"value":2381}," href",{"type":425,"tag":477,"props":2383,"children":2384},{"style":575},[2385],{"type":430,"value":1521},{"type":425,"tag":477,"props":2387,"children":2388},{"style":496},[2389],{"type":430,"value":1173},{"type":425,"tag":477,"props":2391,"children":2392},{"style":506},[2393],{"type":430,"value":2394},"/\u003C%=from_user%>",{"type":425,"tag":477,"props":2396,"children":2397},{"style":496},[2398],{"type":430,"value":1173},{"type":425,"tag":477,"props":2400,"children":2401},{"style":575},[2402],{"type":430,"value":691},{"type":425,"tag":477,"props":2404,"children":2405},{"style":490},[2406],{"type":430,"value":2407},"\u003C%=from_user%>",{"type":425,"tag":477,"props":2409,"children":2410},{"style":575},[2411],{"type":430,"value":701},{"type":425,"tag":477,"props":2413,"children":2414},{"style":683},[2415],{"type":430,"value":433},{"type":425,"tag":477,"props":2417,"children":2418},{"style":575},[2419],{"type":430,"value":691},{"type":425,"tag":477,"props":2421,"children":2422},{"style":490},[2423],{"type":430,"value":598},{"type":425,"tag":477,"props":2425,"children":2426},{"style":575},[2427],{"type":430,"value":701},{"type":425,"tag":477,"props":2429,"children":2430},{"style":683},[2431],{"type":430,"value":2368},{"type":425,"tag":477,"props":2433,"children":2434},{"style":575},[2435],{"type":430,"value":691},{"type":425,"tag":477,"props":2437,"children":2438},{"style":490},[2439],{"type":430,"value":2440}," \u003C%=text%>",{"type":425,"tag":477,"props":2442,"children":2443},{"style":575},[2444],{"type":430,"value":701},{"type":425,"tag":477,"props":2446,"children":2447},{"style":683},[2448],{"type":430,"value":426},{"type":425,"tag":477,"props":2450,"children":2451},{"style":575},[2452],{"type":430,"value":710},{"type":425,"tag":477,"props":2454,"children":2455},{"class":479,"line":566},[2456,2460,2464],{"type":425,"tag":477,"props":2457,"children":2458},{"style":575},[2459],{"type":430,"value":2303},{"type":425,"tag":477,"props":2461,"children":2462},{"style":683},[2463],{"type":430,"value":686},{"type":425,"tag":477,"props":2465,"children":2466},{"style":575},[2467],{"type":430,"value":710},{"type":425,"tag":477,"props":2469,"children":2470},{"class":479,"line":586},[2471,2476,2480],{"type":425,"tag":477,"props":2472,"children":2473},{"style":575},[2474],{"type":430,"value":2475},"  \u003C/",{"type":425,"tag":477,"props":2477,"children":2478},{"style":683},[2479],{"type":430,"value":686},{"type":425,"tag":477,"props":2481,"children":2482},{"style":575},[2483],{"type":430,"value":710},{"type":425,"tag":477,"props":2485,"children":2486},{"class":479,"line":612},[2487,2491,2495],{"type":425,"tag":477,"props":2488,"children":2489},{"style":575},[2490],{"type":430,"value":701},{"type":425,"tag":477,"props":2492,"children":2493},{"style":683},[2494],{"type":430,"value":2064},{"type":425,"tag":477,"props":2496,"children":2497},{"style":575},[2498],{"type":430,"value":710},{"type":425,"tag":467,"props":2500,"children":2502},{"className":469,"code":2501,"language":471,"meta":419,"style":419},"(function () {\n  var cache = {};\n  this.tmpl = function tmpl(str, data) {\n    return !/\\W/.test(str)\n      ? // 缓存会将读取脚本内容到模板解析这个过程的解析结果缓存下来\n        (cache[str] =\n          cache[str] ||\n          // 读取脚本内容\n          tmpl(document.getElementById(str).innerHTML))\n      : new Function();\n  };\n})();\n",[2503],{"type":425,"tag":441,"props":2504,"children":2505},{"__ignoreMap":419},[2506,2525,2544,2595,2638,2650,2678,2702,2710,2758,2783,2790],{"type":425,"tag":477,"props":2507,"children":2508},{"class":479,"line":480},[2509,2513,2517,2521],{"type":425,"tag":477,"props":2510,"children":2511},{"style":490},[2512],{"type":430,"value":493},{"type":425,"tag":477,"props":2514,"children":2515},{"style":823},[2516],{"type":430,"value":826},{"type":425,"tag":477,"props":2518,"children":2519},{"style":575},[2520],{"type":430,"value":831},{"type":425,"tag":477,"props":2522,"children":2523},{"style":575},[2524],{"type":430,"value":583},{"type":425,"tag":477,"props":2526,"children":2527},{"class":479,"line":502},[2528,2532,2536,2540],{"type":425,"tag":477,"props":2529,"children":2530},{"style":823},[2531],{"type":430,"value":843},{"type":425,"tag":477,"props":2533,"children":2534},{"style":490},[2535],{"type":430,"value":848},{"type":425,"tag":477,"props":2537,"children":2538},{"style":851},[2539],{"type":430,"value":854},{"type":425,"tag":477,"props":2541,"children":2542},{"style":575},[2543],{"type":430,"value":859},{"type":425,"tag":477,"props":2545,"children":2546},{"class":479,"line":512},[2547,2551,2555,2559,2563,2567,2571,2575,2579,2583,2587,2591],{"type":425,"tag":477,"props":2548,"children":2549},{"style":874},[2550],{"type":430,"value":877},{"type":425,"tag":477,"props":2552,"children":2553},{"style":575},[2554],{"type":430,"value":882},{"type":425,"tag":477,"props":2556,"children":2557},{"style":484},[2558],{"type":430,"value":887},{"type":425,"tag":477,"props":2560,"children":2561},{"style":851},[2562],{"type":430,"value":854},{"type":425,"tag":477,"props":2564,"children":2565},{"style":823},[2566],{"type":430,"value":896},{"type":425,"tag":477,"props":2568,"children":2569},{"style":484},[2570],{"type":430,"value":901},{"type":425,"tag":477,"props":2572,"children":2573},{"style":575},[2574],{"type":430,"value":493},{"type":425,"tag":477,"props":2576,"children":2577},{"style":908},[2578],{"type":430,"value":911},{"type":425,"tag":477,"props":2580,"children":2581},{"style":575},[2582],{"type":430,"value":578},{"type":425,"tag":477,"props":2584,"children":2585},{"style":908},[2586],{"type":430,"value":920},{"type":425,"tag":477,"props":2588,"children":2589},{"style":575},[2590],{"type":430,"value":925},{"type":425,"tag":477,"props":2592,"children":2593},{"style":575},[2594],{"type":430,"value":583},{"type":425,"tag":477,"props":2596,"children":2597},{"class":479,"line":521},[2598,2602,2606,2610,2614,2618,2622,2626,2630,2634],{"type":425,"tag":477,"props":2599,"children":2600},{"style":1410},[2601],{"type":430,"value":1834},{"type":425,"tag":477,"props":2603,"children":2604},{"style":851},[2605],{"type":430,"value":967},{"type":425,"tag":477,"props":2607,"children":2608},{"style":496},[2609],{"type":430,"value":972},{"type":425,"tag":477,"props":2611,"children":2612},{"style":975},[2613],{"type":430,"value":978},{"type":425,"tag":477,"props":2615,"children":2616},{"style":496},[2617],{"type":430,"value":972},{"type":425,"tag":477,"props":2619,"children":2620},{"style":575},[2621],{"type":430,"value":882},{"type":425,"tag":477,"props":2623,"children":2624},{"style":484},[2625],{"type":430,"value":991},{"type":425,"tag":477,"props":2627,"children":2628},{"style":590},[2629],{"type":430,"value":493},{"type":425,"tag":477,"props":2631,"children":2632},{"style":490},[2633],{"type":430,"value":911},{"type":425,"tag":477,"props":2635,"children":2636},{"style":590},[2637],{"type":430,"value":642},{"type":425,"tag":477,"props":2639,"children":2640},{"class":479,"line":530},[2641,2645],{"type":425,"tag":477,"props":2642,"children":2643},{"style":851},[2644],{"type":430,"value":1011},{"type":425,"tag":477,"props":2646,"children":2647},{"style":669},[2648],{"type":430,"value":2649}," // 缓存会将读取脚本内容到模板解析这个过程的解析结果缓存下来\n",{"type":425,"tag":477,"props":2651,"children":2652},{"class":479,"line":539},[2653,2658,2662,2666,2670,2674],{"type":425,"tag":477,"props":2654,"children":2655},{"style":590},[2656],{"type":430,"value":2657},"        (",{"type":425,"tag":477,"props":2659,"children":2660},{"style":490},[2661],{"type":430,"value":1021},{"type":425,"tag":477,"props":2663,"children":2664},{"style":590},[2665],{"type":430,"value":1026},{"type":425,"tag":477,"props":2667,"children":2668},{"style":490},[2669],{"type":430,"value":911},{"type":425,"tag":477,"props":2671,"children":2672},{"style":590},[2673],{"type":430,"value":1035},{"type":425,"tag":477,"props":2675,"children":2676},{"style":851},[2677],{"type":430,"value":1040},{"type":425,"tag":477,"props":2679,"children":2680},{"class":479,"line":548},[2681,2685,2689,2693,2697],{"type":425,"tag":477,"props":2682,"children":2683},{"style":490},[2684],{"type":430,"value":1048},{"type":425,"tag":477,"props":2686,"children":2687},{"style":590},[2688],{"type":430,"value":1026},{"type":425,"tag":477,"props":2690,"children":2691},{"style":490},[2692],{"type":430,"value":911},{"type":425,"tag":477,"props":2694,"children":2695},{"style":590},[2696],{"type":430,"value":1035},{"type":425,"tag":477,"props":2698,"children":2699},{"style":851},[2700],{"type":430,"value":2701},"||\n",{"type":425,"tag":477,"props":2703,"children":2704},{"class":479,"line":557},[2705],{"type":425,"tag":477,"props":2706,"children":2707},{"style":669},[2708],{"type":430,"value":2709},"          // 读取脚本内容\n",{"type":425,"tag":477,"props":2711,"children":2712},{"class":479,"line":566},[2713,2718,2722,2726,2730,2734,2738,2742,2746,2750,2754],{"type":425,"tag":477,"props":2714,"children":2715},{"style":484},[2716],{"type":430,"value":2717},"          tmpl",{"type":425,"tag":477,"props":2719,"children":2720},{"style":590},[2721],{"type":430,"value":493},{"type":425,"tag":477,"props":2723,"children":2724},{"style":490},[2725],{"type":430,"value":1078},{"type":425,"tag":477,"props":2727,"children":2728},{"style":575},[2729],{"type":430,"value":882},{"type":425,"tag":477,"props":2731,"children":2732},{"style":484},[2733],{"type":430,"value":1087},{"type":425,"tag":477,"props":2735,"children":2736},{"style":590},[2737],{"type":430,"value":493},{"type":425,"tag":477,"props":2739,"children":2740},{"style":490},[2741],{"type":430,"value":911},{"type":425,"tag":477,"props":2743,"children":2744},{"style":590},[2745],{"type":430,"value":925},{"type":425,"tag":477,"props":2747,"children":2748},{"style":575},[2749],{"type":430,"value":882},{"type":425,"tag":477,"props":2751,"children":2752},{"style":490},[2753],{"type":430,"value":1108},{"type":425,"tag":477,"props":2755,"children":2756},{"style":590},[2757],{"type":430,"value":1113},{"type":425,"tag":477,"props":2759,"children":2760},{"class":479,"line":586},[2761,2765,2770,2774,2779],{"type":425,"tag":477,"props":2762,"children":2763},{"style":851},[2764],{"type":430,"value":1121},{"type":425,"tag":477,"props":2766,"children":2767},{"style":851},[2768],{"type":430,"value":2769}," new",{"type":425,"tag":477,"props":2771,"children":2772},{"style":484},[2773],{"type":430,"value":1149},{"type":425,"tag":477,"props":2775,"children":2776},{"style":590},[2777],{"type":430,"value":2778},"()",{"type":425,"tag":477,"props":2780,"children":2781},{"style":575},[2782],{"type":430,"value":1808},{"type":425,"tag":477,"props":2784,"children":2785},{"class":479,"line":612},[2786],{"type":425,"tag":477,"props":2787,"children":2788},{"style":575},[2789],{"type":430,"value":1881},{"type":425,"tag":477,"props":2791,"children":2792},{"class":479,"line":631},[2793,2797,2801],{"type":425,"tag":477,"props":2794,"children":2795},{"style":575},[2796],{"type":430,"value":637},{"type":425,"tag":477,"props":2798,"children":2799},{"style":490},[2800],{"type":430,"value":1894},{"type":425,"tag":477,"props":2802,"children":2803},{"style":575},[2804],{"type":430,"value":1808},{"type":425,"tag":426,"props":2806,"children":2807},{},[2808,2814],{"type":425,"tag":441,"props":2809,"children":2811},{"className":2810},[],[2812],{"type":430,"value":2813},"new Function()",{"type":430,"value":2815}," 即模板解析的核心内容，原理是用一个数组，保存所有解析内容，再拼接回字符串，作为 JS 执行。类似 eval 函数。",{"type":425,"tag":467,"props":2817,"children":2819},{"className":469,"code":2818,"language":471,"meta":419,"style":419},"new Function(\n  \"obj\",\n  \"var p=[];\" +\n    // + '...'\n    \"return p.join('')\"\n);\n",[2820],{"type":425,"tag":441,"props":2821,"children":2822},{"__ignoreMap":419},[2823,2839,2859,2879,2887,2904],{"type":425,"tag":477,"props":2824,"children":2825},{"class":479,"line":480},[2826,2831,2835],{"type":425,"tag":477,"props":2827,"children":2828},{"style":851},[2829],{"type":430,"value":2830},"new",{"type":425,"tag":477,"props":2832,"children":2833},{"style":484},[2834],{"type":430,"value":1149},{"type":425,"tag":477,"props":2836,"children":2837},{"style":490},[2838],{"type":430,"value":1154},{"type":425,"tag":477,"props":2840,"children":2841},{"class":479,"line":502},[2842,2847,2851,2855],{"type":425,"tag":477,"props":2843,"children":2844},{"style":496},[2845],{"type":430,"value":2846},"  \"",{"type":425,"tag":477,"props":2848,"children":2849},{"style":506},[2850],{"type":430,"value":1168},{"type":425,"tag":477,"props":2852,"children":2853},{"style":496},[2854],{"type":430,"value":1173},{"type":425,"tag":477,"props":2856,"children":2857},{"style":575},[2858],{"type":430,"value":609},{"type":425,"tag":477,"props":2860,"children":2861},{"class":479,"line":512},[2862,2866,2871,2875],{"type":425,"tag":477,"props":2863,"children":2864},{"style":496},[2865],{"type":430,"value":2846},{"type":425,"tag":477,"props":2867,"children":2868},{"style":506},[2869],{"type":430,"value":2870},"var p=[];",{"type":425,"tag":477,"props":2872,"children":2873},{"style":496},[2874],{"type":430,"value":1173},{"type":425,"tag":477,"props":2876,"children":2877},{"style":851},[2878],{"type":430,"value":1199},{"type":425,"tag":477,"props":2880,"children":2881},{"class":479,"line":521},[2882],{"type":425,"tag":477,"props":2883,"children":2884},{"style":669},[2885],{"type":430,"value":2886},"    // + '...'\n",{"type":425,"tag":477,"props":2888,"children":2889},{"class":479,"line":530},[2890,2895,2900],{"type":425,"tag":477,"props":2891,"children":2892},{"style":496},[2893],{"type":430,"value":2894},"    \"",{"type":425,"tag":477,"props":2896,"children":2897},{"style":506},[2898],{"type":430,"value":2899},"return p.join('')",{"type":425,"tag":477,"props":2901,"children":2902},{"style":496},[2903],{"type":430,"value":1794},{"type":425,"tag":477,"props":2905,"children":2906},{"class":479,"line":539},[2907,2911],{"type":425,"tag":477,"props":2908,"children":2909},{"style":490},[2910],{"type":430,"value":925},{"type":425,"tag":477,"props":2912,"children":2913},{"style":575},[2914],{"type":430,"value":1808},{"type":425,"tag":426,"props":2916,"children":2917},{},[2918,2920,2926],{"type":430,"value":2919},"要解析什么内容呢？无非是 ",{"type":425,"tag":441,"props":2921,"children":2923},{"className":2922},[],[2924],{"type":430,"value":2925},"\u003C%=hello%>",{"type":430,"value":2927}," 这种模板字符串。执行过程中，通过 with 语句，将内部变量的求值（hello）转移到参数对象（data.hello）。这个玩意儿在 VueJS 的模板编译中也用到过：",{"type":425,"tag":467,"props":2929,"children":2931},{"className":469,"code":2930,"language":471,"meta":419,"style":419},"/* VueJS */\nwith (vm) {\n  return createVNode(\"p\", { attrs: { hi: hello /* vm.hello */ } }, [\n    createTextNode(\"Hello World\"),\n  ]);\n}\n",[2932],{"type":425,"tag":441,"props":2933,"children":2934},{"__ignoreMap":419},[2935,2943,2961,3046,3079,3091],{"type":425,"tag":477,"props":2936,"children":2937},{"class":479,"line":480},[2938],{"type":425,"tag":477,"props":2939,"children":2940},{"style":669},[2941],{"type":430,"value":2942},"/* VueJS */\n",{"type":425,"tag":477,"props":2944,"children":2945},{"class":479,"line":502},[2946,2951,2956],{"type":425,"tag":477,"props":2947,"children":2948},{"style":1410},[2949],{"type":430,"value":2950},"with",{"type":425,"tag":477,"props":2952,"children":2953},{"style":490},[2954],{"type":430,"value":2955}," (vm) ",{"type":425,"tag":477,"props":2957,"children":2958},{"style":575},[2959],{"type":430,"value":2960},"{\n",{"type":425,"tag":477,"props":2962,"children":2963},{"class":479,"line":512},[2964,2969,2974,2978,2982,2986,2990,2994,2999,3004,3008,3012,3017,3021,3026,3031,3036,3041],{"type":425,"tag":477,"props":2965,"children":2966},{"style":1410},[2967],{"type":430,"value":2968},"  return",{"type":425,"tag":477,"props":2970,"children":2971},{"style":484},[2972],{"type":430,"value":2973}," createVNode",{"type":425,"tag":477,"props":2975,"children":2976},{"style":590},[2977],{"type":430,"value":493},{"type":425,"tag":477,"props":2979,"children":2980},{"style":496},[2981],{"type":430,"value":1173},{"type":425,"tag":477,"props":2983,"children":2984},{"style":506},[2985],{"type":430,"value":426},{"type":425,"tag":477,"props":2987,"children":2988},{"style":496},[2989],{"type":430,"value":1173},{"type":425,"tag":477,"props":2991,"children":2992},{"style":575},[2993],{"type":430,"value":578},{"type":425,"tag":477,"props":2995,"children":2996},{"style":575},[2997],{"type":430,"value":2998}," {",{"type":425,"tag":477,"props":3000,"children":3001},{"style":590},[3002],{"type":430,"value":3003}," attrs",{"type":425,"tag":477,"props":3005,"children":3006},{"style":575},[3007],{"type":430,"value":598},{"type":425,"tag":477,"props":3009,"children":3010},{"style":575},[3011],{"type":430,"value":2998},{"type":425,"tag":477,"props":3013,"children":3014},{"style":590},[3015],{"type":430,"value":3016}," hi",{"type":425,"tag":477,"props":3018,"children":3019},{"style":575},[3020],{"type":430,"value":598},{"type":425,"tag":477,"props":3022,"children":3023},{"style":490},[3024],{"type":430,"value":3025}," hello",{"type":425,"tag":477,"props":3027,"children":3028},{"style":669},[3029],{"type":430,"value":3030}," /* vm.hello */",{"type":425,"tag":477,"props":3032,"children":3033},{"style":575},[3034],{"type":430,"value":3035}," }",{"type":425,"tag":477,"props":3037,"children":3038},{"style":575},[3039],{"type":430,"value":3040}," },",{"type":425,"tag":477,"props":3042,"children":3043},{"style":590},[3044],{"type":430,"value":3045}," [\n",{"type":425,"tag":477,"props":3047,"children":3048},{"class":479,"line":521},[3049,3054,3058,3062,3067,3071,3075],{"type":425,"tag":477,"props":3050,"children":3051},{"style":484},[3052],{"type":430,"value":3053},"    createTextNode",{"type":425,"tag":477,"props":3055,"children":3056},{"style":590},[3057],{"type":430,"value":493},{"type":425,"tag":477,"props":3059,"children":3060},{"style":496},[3061],{"type":430,"value":1173},{"type":425,"tag":477,"props":3063,"children":3064},{"style":506},[3065],{"type":430,"value":3066},"Hello World",{"type":425,"tag":477,"props":3068,"children":3069},{"style":496},[3070],{"type":430,"value":1173},{"type":425,"tag":477,"props":3072,"children":3073},{"style":590},[3074],{"type":430,"value":925},{"type":425,"tag":477,"props":3076,"children":3077},{"style":575},[3078],{"type":430,"value":609},{"type":425,"tag":477,"props":3080,"children":3081},{"class":479,"line":530},[3082,3087],{"type":425,"tag":477,"props":3083,"children":3084},{"style":590},[3085],{"type":430,"value":3086},"  ])",{"type":425,"tag":477,"props":3088,"children":3089},{"style":575},[3090],{"type":430,"value":1808},{"type":425,"tag":477,"props":3092,"children":3093},{"class":479,"line":539},[3094],{"type":425,"tag":477,"props":3095,"children":3096},{"style":575},[3097],{"type":430,"value":3098},"}\n",{"type":425,"tag":426,"props":3100,"children":3101},{},[3102],{"type":430,"value":3103},"那如何解析呢？",{"type":425,"tag":426,"props":3105,"children":3106},{},[3107,3113,3115,3121],{"type":425,"tag":3108,"props":3109,"children":3110},"del",{},[3111],{"type":430,"value":3112},"我们知道",{"type":430,"value":3114},"曾写过经典字符串模板的佬应该知道，",{"type":425,"tag":3116,"props":3117,"children":3118},"strong",{},[3119],{"type":430,"value":3120},"模板字符串一般包含：字符串、变量及逻辑",{"type":430,"value":3122},"。",{"type":425,"tag":3124,"props":3125,"children":3126},"ul",{},[3127,3139,3150],{"type":425,"tag":3128,"props":3129,"children":3130},"li",{},[3131,3133],{"type":430,"value":3132},"字符串 ",{"type":425,"tag":441,"props":3134,"children":3136},{"className":3135},[],[3137],{"type":430,"value":3138},"\u003Chtml>Lionad\u003C/html>",{"type":425,"tag":3128,"props":3140,"children":3141},{},[3142,3144],{"type":430,"value":3143},"带变量 ",{"type":425,"tag":441,"props":3145,"children":3147},{"className":3146},[],[3148],{"type":430,"value":3149},"\u003Chtml>\u003C%=name%>\u003C/html>",{"type":425,"tag":3128,"props":3151,"children":3152},{},[3153,3155,3161],{"type":430,"value":3154},"带逻辑 ",{"type":425,"tag":441,"props":3156,"children":3158},{"className":3157},[],[3159],{"type":430,"value":3160},"\u003C% if(name){ %>\u003Chtml>\u003C%=name%>\u003C/html>\u003C% } %>",{"type":430,"value":3122},{"type":425,"tag":426,"props":3163,"children":3164},{},[3165],{"type":430,"value":3166},"所以解析模板，无非就是把这三种字符串替换成纯粹的 JS 逻辑，作为 new Function 的参数。其中所有中间变量，可以用一个数组来储存：",{"type":425,"tag":3124,"props":3168,"children":3169},{},[3170,3189,3207],{"type":425,"tag":3128,"props":3171,"children":3172},{},[3173,3175,3180,3182,3188],{"type":430,"value":3174},"将普通字符串直接推入作为结果的内容数组，比如 ",{"type":425,"tag":441,"props":3176,"children":3178},{"className":3177},[],[3179],{"type":430,"value":3138},{"type":430,"value":3181}," 应该被解析为 ",{"type":425,"tag":441,"props":3183,"children":3185},{"className":3184},[],[3186],{"type":430,"value":3187},"p.push('\u003Chtml>Lionad\u003C/html>')",{"type":430,"value":3122},{"type":425,"tag":3128,"props":3190,"children":3191},{},[3192,3194,3199,3200,3206],{"type":430,"value":3193},"如果碰到变量，则将变量拆分出来推入数组，如 ",{"type":425,"tag":441,"props":3195,"children":3197},{"className":3196},[],[3198],{"type":430,"value":3149},{"type":430,"value":3181},{"type":425,"tag":441,"props":3201,"children":3203},{"className":3202},[],[3204],{"type":430,"value":3205},"p.push('\u003Chtml>');p.push(name);p.push('\u003C/html>')",{"type":430,"value":3122},{"type":425,"tag":3128,"props":3208,"children":3209},{},[3210,3212,3218,3220,3225,3227,3233],{"type":430,"value":3211},"带逻辑的字符串，由于逻辑本身就是 JS 代码，所以不需要解析为字符串，只需要把两侧的 ",{"type":425,"tag":441,"props":3213,"children":3215},{"className":3214},[],[3216],{"type":430,"value":3217},"\u003C% %>",{"type":430,"value":3219}," 这种模板标志去掉就好了。如 ",{"type":425,"tag":441,"props":3221,"children":3223},{"className":3222},[],[3224],{"type":430,"value":3160},{"type":430,"value":3226}," 应该被解析为：",{"type":425,"tag":441,"props":3228,"children":3230},{"className":3229},[],[3231],{"type":430,"value":3232},"if(name){ p.push('\u003Chtml>');p.push(name);p.push('\u003C/html>') } ",{"type":430,"value":3122},{"type":425,"tag":426,"props":3235,"children":3236},{},[3237],{"type":430,"value":3238},"以下面这段模板为例，我们看看字符串具体的替换规则。",{"type":425,"tag":467,"props":3240,"children":3242},{"className":469,"code":3241,"language":471,"meta":419,"style":419},"str = `\u003C% if (true) { %>\n    \u003Cli>\u003C%=users[i]%>\u003C/li>\n\u003C% } %>`;\n",[3243],{"type":425,"tag":441,"props":3244,"children":3245},{"__ignoreMap":419},[3246,3268,3276],{"type":425,"tag":477,"props":3247,"children":3248},{"class":479,"line":480},[3249,3254,3258,3263],{"type":425,"tag":477,"props":3250,"children":3251},{"style":490},[3252],{"type":430,"value":3253},"str ",{"type":425,"tag":477,"props":3255,"children":3256},{"style":851},[3257],{"type":430,"value":1521},{"type":425,"tag":477,"props":3259,"children":3260},{"style":496},[3261],{"type":430,"value":3262}," `",{"type":425,"tag":477,"props":3264,"children":3265},{"style":506},[3266],{"type":430,"value":3267},"\u003C% if (true) { %>\n",{"type":425,"tag":477,"props":3269,"children":3270},{"class":479,"line":502},[3271],{"type":425,"tag":477,"props":3272,"children":3273},{"style":506},[3274],{"type":430,"value":3275},"    \u003Cli>\u003C%=users[i]%>\u003C/li>\n",{"type":425,"tag":477,"props":3277,"children":3278},{"class":479,"line":512},[3279,3284,3288],{"type":425,"tag":477,"props":3280,"children":3281},{"style":506},[3282],{"type":430,"value":3283},"\u003C% } %>",{"type":425,"tag":477,"props":3285,"children":3286},{"style":496},[3287],{"type":430,"value":572},{"type":425,"tag":477,"props":3289,"children":3290},{"style":575},[3291],{"type":430,"value":1808},{"type":425,"tag":467,"props":3293,"children":3295},{"className":469,"code":3294,"language":471,"meta":419,"style":419},"// with 的使用方法都知道了，with(obj = { a })，那么\n// 就能在内部直接读取 a，不需要写 obj.a\n\"with(obj){p.push('\" +\n  str\n    // 将换行等空白字符转换为空格，这样所有代码都在一行了\n    // '\u003C% if (true) { %>     \u003Cli>\u003C%=users[i]%>\u003C/li> \u003C% } %>'\n    .replace(/[\\r\\t\\n]/g, \" \")\n    // ['', 'if (true) { %>\u003Cli>', '=users[i]%>\u003C/li>', ' } %>']\n    .split(\"\u003C%\")\n    // 因为 \\t 刚才已经被替换成空格了，所以这里可以使用 \\t 用来将不同行的代码字符串“相加”，\n    // 一会儿再拆分时，不会和原先字符串里的字符混淆\n    .join(\"\\t\")\n    // 去掉模板标志两端的引号，在这个例子里不会用到\n    .replace(/((^|%>)[^\\t]*)'/g, \"$1\\r\")\n    // 以下三句最重要，将所有变量推入数组，生成结果形如 `push('xxx',x,'xxx')` 的字符串\n    // 首先，刚才匹配完了 \u003C%，所以 \\t= 开头后边接的就是变量，这里让它转换成 ',x,' 的形式\n    .replace(/\\t=(.*?)%>/g, \"',$1,'\")\n    .split(\"\\t\")\n    // 在刚刚跟 split('\u003C%') 的位置用括号还原，得到了 ',x,'xxx'); 的形式\n    .join(\"');\")\n    // 在 \\t=xxx 那次匹配，已经把变量模板对应的结束标志 %> 匹配完了，\n    // 所以这是处理剩余语句的结束标志，用 split 拆分行后相当于直接把结束标记舍弃了\n    .split(\"%>\")\n    // 最终在每行开头增加 push 方法，形成了 push('xxx',x,'xxx'); 的形式\n    .join(\"p.push('\")\n    // 处理剩余的换行符\n    .split(\"\\r\")\n    .join(\"\\\\'\") +\n  \"');}\";\n",[3296],{"type":425,"tag":441,"props":3297,"children":3298},{"__ignoreMap":419},[3299,3307,3315,3334,3342,3350,3358,3414,3422,3453,3461,3469,3500,3508,3607,3615,3623,3698,3729,3737,3768,3776,3784,3815,3823,3854,3862,3893,3932],{"type":425,"tag":477,"props":3300,"children":3301},{"class":479,"line":480},[3302],{"type":425,"tag":477,"props":3303,"children":3304},{"style":669},[3305],{"type":430,"value":3306},"// with 的使用方法都知道了，with(obj = { a })，那么\n",{"type":425,"tag":477,"props":3308,"children":3309},{"class":479,"line":502},[3310],{"type":425,"tag":477,"props":3311,"children":3312},{"style":669},[3313],{"type":430,"value":3314},"// 就能在内部直接读取 a，不需要写 obj.a\n",{"type":425,"tag":477,"props":3316,"children":3317},{"class":479,"line":512},[3318,3322,3326,3330],{"type":425,"tag":477,"props":3319,"children":3320},{"style":496},[3321],{"type":430,"value":1173},{"type":425,"tag":477,"props":3323,"children":3324},{"style":506},[3325],{"type":430,"value":1222},{"type":425,"tag":477,"props":3327,"children":3328},{"style":496},[3329],{"type":430,"value":1173},{"type":425,"tag":477,"props":3331,"children":3332},{"style":851},[3333],{"type":430,"value":1199},{"type":425,"tag":477,"props":3335,"children":3336},{"class":479,"line":521},[3337],{"type":425,"tag":477,"props":3338,"children":3339},{"style":490},[3340],{"type":430,"value":3341},"  str\n",{"type":425,"tag":477,"props":3343,"children":3344},{"class":479,"line":530},[3345],{"type":425,"tag":477,"props":3346,"children":3347},{"style":669},[3348],{"type":430,"value":3349},"    // 将换行等空白字符转换为空格，这样所有代码都在一行了\n",{"type":425,"tag":477,"props":3351,"children":3352},{"class":479,"line":539},[3353],{"type":425,"tag":477,"props":3354,"children":3355},{"style":669},[3356],{"type":430,"value":3357},"    // '\u003C% if (true) { %>     \u003Cli>\u003C%=users[i]%>\u003C/li> \u003C% } %>'\n",{"type":425,"tag":477,"props":3359,"children":3360},{"class":479,"line":548},[3361,3366,3370,3374,3378,3382,3386,3390,3394,3398,3402,3406,3410],{"type":425,"tag":477,"props":3362,"children":3363},{"style":575},[3364],{"type":430,"value":3365},"    .",{"type":425,"tag":477,"props":3367,"children":3368},{"style":484},[3369],{"type":430,"value":1262},{"type":425,"tag":477,"props":3371,"children":3372},{"style":490},[3373],{"type":430,"value":493},{"type":425,"tag":477,"props":3375,"children":3376},{"style":496},[3377],{"type":430,"value":972},{"type":425,"tag":477,"props":3379,"children":3380},{"style":1273},[3381],{"type":430,"value":1026},{"type":425,"tag":477,"props":3383,"children":3384},{"style":975},[3385],{"type":430,"value":1280},{"type":425,"tag":477,"props":3387,"children":3388},{"style":1273},[3389],{"type":430,"value":1285},{"type":425,"tag":477,"props":3391,"children":3392},{"style":496},[3393],{"type":430,"value":972},{"type":425,"tag":477,"props":3395,"children":3396},{"style":1292},[3397],{"type":430,"value":1295},{"type":425,"tag":477,"props":3399,"children":3400},{"style":575},[3401],{"type":430,"value":578},{"type":425,"tag":477,"props":3403,"children":3404},{"style":496},[3405],{"type":430,"value":1304},{"type":425,"tag":477,"props":3407,"children":3408},{"style":496},[3409],{"type":430,"value":1304},{"type":425,"tag":477,"props":3411,"children":3412},{"style":490},[3413],{"type":430,"value":642},{"type":425,"tag":477,"props":3415,"children":3416},{"class":479,"line":557},[3417],{"type":425,"tag":477,"props":3418,"children":3419},{"style":669},[3420],{"type":430,"value":3421},"    // ['', 'if (true) { %>\u003Cli>', '=users[i]%>\u003C/li>', ' } %>']\n",{"type":425,"tag":477,"props":3423,"children":3424},{"class":479,"line":566},[3425,3429,3433,3437,3441,3445,3449],{"type":425,"tag":477,"props":3426,"children":3427},{"style":575},[3428],{"type":430,"value":3365},{"type":425,"tag":477,"props":3430,"children":3431},{"style":484},[3432],{"type":430,"value":1325},{"type":425,"tag":477,"props":3434,"children":3435},{"style":490},[3436],{"type":430,"value":493},{"type":425,"tag":477,"props":3438,"children":3439},{"style":496},[3440],{"type":430,"value":1173},{"type":425,"tag":477,"props":3442,"children":3443},{"style":506},[3444],{"type":430,"value":1338},{"type":425,"tag":477,"props":3446,"children":3447},{"style":496},[3448],{"type":430,"value":1173},{"type":425,"tag":477,"props":3450,"children":3451},{"style":490},[3452],{"type":430,"value":642},{"type":425,"tag":477,"props":3454,"children":3455},{"class":479,"line":586},[3456],{"type":425,"tag":477,"props":3457,"children":3458},{"style":669},[3459],{"type":430,"value":3460},"    // 因为 \\t 刚才已经被替换成空格了，所以这里可以使用 \\t 用来将不同行的代码字符串“相加”，\n",{"type":425,"tag":477,"props":3462,"children":3463},{"class":479,"line":612},[3464],{"type":425,"tag":477,"props":3465,"children":3466},{"style":669},[3467],{"type":430,"value":3468},"    // 一会儿再拆分时，不会和原先字符串里的字符混淆\n",{"type":425,"tag":477,"props":3470,"children":3471},{"class":479,"line":631},[3472,3476,3480,3484,3488,3492,3496],{"type":425,"tag":477,"props":3473,"children":3474},{"style":575},[3475],{"type":430,"value":3365},{"type":425,"tag":477,"props":3477,"children":3478},{"style":484},[3479],{"type":430,"value":1359},{"type":425,"tag":477,"props":3481,"children":3482},{"style":490},[3483],{"type":430,"value":493},{"type":425,"tag":477,"props":3485,"children":3486},{"style":496},[3487],{"type":430,"value":1173},{"type":425,"tag":477,"props":3489,"children":3490},{"style":1370},[3491],{"type":430,"value":1373},{"type":425,"tag":477,"props":3493,"children":3494},{"style":496},[3495],{"type":430,"value":1173},{"type":425,"tag":477,"props":3497,"children":3498},{"style":490},[3499],{"type":430,"value":642},{"type":425,"tag":477,"props":3501,"children":3502},{"class":479,"line":1129},[3503],{"type":425,"tag":477,"props":3504,"children":3505},{"style":669},[3506],{"type":430,"value":3507},"    // 去掉模板标志两端的引号，在这个例子里不会用到\n",{"type":425,"tag":477,"props":3509,"children":3510},{"class":479,"line":1138},[3511,3515,3519,3523,3527,3531,3535,3539,3543,3547,3551,3555,3559,3563,3567,3571,3575,3579,3583,3587,3591,3595,3599,3603],{"type":425,"tag":477,"props":3512,"children":3513},{"style":575},[3514],{"type":430,"value":3365},{"type":425,"tag":477,"props":3516,"children":3517},{"style":484},[3518],{"type":430,"value":1262},{"type":425,"tag":477,"props":3520,"children":3521},{"style":490},[3522],{"type":430,"value":493},{"type":425,"tag":477,"props":3524,"children":3525},{"style":496},[3526],{"type":430,"value":972},{"type":425,"tag":477,"props":3528,"children":3529},{"style":1404},[3530],{"type":430,"value":1407},{"type":425,"tag":477,"props":3532,"children":3533},{"style":1410},[3534],{"type":430,"value":1413},{"type":425,"tag":477,"props":3536,"children":3537},{"style":851},[3538],{"type":430,"value":1418},{"type":425,"tag":477,"props":3540,"children":3541},{"style":1421},[3542],{"type":430,"value":1424},{"type":425,"tag":477,"props":3544,"children":3545},{"style":1404},[3546],{"type":430,"value":925},{"type":425,"tag":477,"props":3548,"children":3549},{"style":1273},[3550],{"type":430,"value":1026},{"type":425,"tag":477,"props":3552,"children":3553},{"style":851},[3554],{"type":430,"value":1413},{"type":425,"tag":477,"props":3556,"children":3557},{"style":975},[3558],{"type":430,"value":1373},{"type":425,"tag":477,"props":3560,"children":3561},{"style":1273},[3562],{"type":430,"value":1285},{"type":425,"tag":477,"props":3564,"children":3565},{"style":851},[3566],{"type":430,"value":1449},{"type":425,"tag":477,"props":3568,"children":3569},{"style":1404},[3570],{"type":430,"value":925},{"type":425,"tag":477,"props":3572,"children":3573},{"style":1421},[3574],{"type":430,"value":1458},{"type":425,"tag":477,"props":3576,"children":3577},{"style":496},[3578],{"type":430,"value":972},{"type":425,"tag":477,"props":3580,"children":3581},{"style":1292},[3582],{"type":430,"value":1295},{"type":425,"tag":477,"props":3584,"children":3585},{"style":575},[3586],{"type":430,"value":578},{"type":425,"tag":477,"props":3588,"children":3589},{"style":496},[3590],{"type":430,"value":1304},{"type":425,"tag":477,"props":3592,"children":3593},{"style":506},[3594],{"type":430,"value":1479},{"type":425,"tag":477,"props":3596,"children":3597},{"style":1370},[3598],{"type":430,"value":1484},{"type":425,"tag":477,"props":3600,"children":3601},{"style":496},[3602],{"type":430,"value":1173},{"type":425,"tag":477,"props":3604,"children":3605},{"style":490},[3606],{"type":430,"value":642},{"type":425,"tag":477,"props":3608,"children":3609},{"class":479,"line":1157},[3610],{"type":425,"tag":477,"props":3611,"children":3612},{"style":669},[3613],{"type":430,"value":3614},"    // 以下三句最重要，将所有变量推入数组，生成结果形如 `push('xxx',x,'xxx')` 的字符串\n",{"type":425,"tag":477,"props":3616,"children":3617},{"class":479,"line":1180},[3618],{"type":425,"tag":477,"props":3619,"children":3620},{"style":669},[3621],{"type":430,"value":3622},"    // 首先，刚才匹配完了 \u003C%，所以 \\t= 开头后边接的就是变量，这里让它转换成 ',x,' 的形式\n",{"type":425,"tag":477,"props":3624,"children":3625},{"class":479,"line":1202},[3626,3630,3634,3638,3642,3646,3650,3654,3658,3662,3666,3670,3674,3678,3682,3686,3690,3694],{"type":425,"tag":477,"props":3627,"children":3628},{"style":575},[3629],{"type":430,"value":3365},{"type":425,"tag":477,"props":3631,"children":3632},{"style":484},[3633],{"type":430,"value":1262},{"type":425,"tag":477,"props":3635,"children":3636},{"style":490},[3637],{"type":430,"value":493},{"type":425,"tag":477,"props":3639,"children":3640},{"style":496},[3641],{"type":430,"value":972},{"type":425,"tag":477,"props":3643,"children":3644},{"style":975},[3645],{"type":430,"value":1373},{"type":425,"tag":477,"props":3647,"children":3648},{"style":1421},[3649],{"type":430,"value":1521},{"type":425,"tag":477,"props":3651,"children":3652},{"style":1404},[3653],{"type":430,"value":493},{"type":425,"tag":477,"props":3655,"children":3656},{"style":975},[3657],{"type":430,"value":882},{"type":425,"tag":477,"props":3659,"children":3660},{"style":851},[3661],{"type":430,"value":1534},{"type":425,"tag":477,"props":3663,"children":3664},{"style":1404},[3665],{"type":430,"value":925},{"type":425,"tag":477,"props":3667,"children":3668},{"style":1421},[3669],{"type":430,"value":1424},{"type":425,"tag":477,"props":3671,"children":3672},{"style":496},[3673],{"type":430,"value":972},{"type":425,"tag":477,"props":3675,"children":3676},{"style":1292},[3677],{"type":430,"value":1295},{"type":425,"tag":477,"props":3679,"children":3680},{"style":575},[3681],{"type":430,"value":578},{"type":425,"tag":477,"props":3683,"children":3684},{"style":496},[3685],{"type":430,"value":1304},{"type":425,"tag":477,"props":3687,"children":3688},{"style":506},[3689],{"type":430,"value":1563},{"type":425,"tag":477,"props":3691,"children":3692},{"style":496},[3693],{"type":430,"value":1173},{"type":425,"tag":477,"props":3695,"children":3696},{"style":490},[3697],{"type":430,"value":642},{"type":425,"tag":477,"props":3699,"children":3700},{"class":479,"line":1211},[3701,3705,3709,3713,3717,3721,3725],{"type":425,"tag":477,"props":3702,"children":3703},{"style":575},[3704],{"type":430,"value":3365},{"type":425,"tag":477,"props":3706,"children":3707},{"style":484},[3708],{"type":430,"value":1325},{"type":425,"tag":477,"props":3710,"children":3711},{"style":490},[3712],{"type":430,"value":493},{"type":425,"tag":477,"props":3714,"children":3715},{"style":496},[3716],{"type":430,"value":1173},{"type":425,"tag":477,"props":3718,"children":3719},{"style":1370},[3720],{"type":430,"value":1373},{"type":425,"tag":477,"props":3722,"children":3723},{"style":496},[3724],{"type":430,"value":1173},{"type":425,"tag":477,"props":3726,"children":3727},{"style":490},[3728],{"type":430,"value":642},{"type":425,"tag":477,"props":3730,"children":3731},{"class":479,"line":1233},[3732],{"type":425,"tag":477,"props":3733,"children":3734},{"style":669},[3735],{"type":430,"value":3736},"    // 在刚刚跟 split('\u003C%') 的位置用括号还原，得到了 ',x,'xxx'); 的形式\n",{"type":425,"tag":477,"props":3738,"children":3739},{"class":479,"line":1242},[3740,3744,3748,3752,3756,3760,3764],{"type":425,"tag":477,"props":3741,"children":3742},{"style":575},[3743],{"type":430,"value":3365},{"type":425,"tag":477,"props":3745,"children":3746},{"style":484},[3747],{"type":430,"value":1359},{"type":425,"tag":477,"props":3749,"children":3750},{"style":490},[3751],{"type":430,"value":493},{"type":425,"tag":477,"props":3753,"children":3754},{"style":496},[3755],{"type":430,"value":1173},{"type":425,"tag":477,"props":3757,"children":3758},{"style":506},[3759],{"type":430,"value":1628},{"type":425,"tag":477,"props":3761,"children":3762},{"style":496},[3763],{"type":430,"value":1173},{"type":425,"tag":477,"props":3765,"children":3766},{"style":490},[3767],{"type":430,"value":642},{"type":425,"tag":477,"props":3769,"children":3770},{"class":479,"line":1251},[3771],{"type":425,"tag":477,"props":3772,"children":3773},{"style":669},[3774],{"type":430,"value":3775},"    // 在 \\t=xxx 那次匹配，已经把变量模板对应的结束标志 %> 匹配完了，\n",{"type":425,"tag":477,"props":3777,"children":3778},{"class":479,"line":1315},[3779],{"type":425,"tag":477,"props":3780,"children":3781},{"style":669},[3782],{"type":430,"value":3783},"    // 所以这是处理剩余语句的结束标志，用 split 拆分行后相当于直接把结束标记舍弃了\n",{"type":425,"tag":477,"props":3785,"children":3786},{"class":479,"line":1349},[3787,3791,3795,3799,3803,3807,3811],{"type":425,"tag":477,"props":3788,"children":3789},{"style":575},[3790],{"type":430,"value":3365},{"type":425,"tag":477,"props":3792,"children":3793},{"style":484},[3794],{"type":430,"value":1325},{"type":425,"tag":477,"props":3796,"children":3797},{"style":490},[3798],{"type":430,"value":493},{"type":425,"tag":477,"props":3800,"children":3801},{"style":496},[3802],{"type":430,"value":1173},{"type":425,"tag":477,"props":3804,"children":3805},{"style":506},[3806],{"type":430,"value":1424},{"type":425,"tag":477,"props":3808,"children":3809},{"style":496},[3810],{"type":430,"value":1173},{"type":425,"tag":477,"props":3812,"children":3813},{"style":490},[3814],{"type":430,"value":642},{"type":425,"tag":477,"props":3816,"children":3817},{"class":479,"line":1384},[3818],{"type":425,"tag":477,"props":3819,"children":3820},{"style":669},[3821],{"type":430,"value":3822},"    // 最终在每行开头增加 push 方法，形成了 push('xxx',x,'xxx'); 的形式\n",{"type":425,"tag":477,"props":3824,"children":3825},{"class":479,"line":1495},[3826,3830,3834,3838,3842,3846,3850],{"type":425,"tag":477,"props":3827,"children":3828},{"style":575},[3829],{"type":430,"value":3365},{"type":425,"tag":477,"props":3831,"children":3832},{"style":484},[3833],{"type":430,"value":1359},{"type":425,"tag":477,"props":3835,"children":3836},{"style":490},[3837],{"type":430,"value":493},{"type":425,"tag":477,"props":3839,"children":3840},{"style":496},[3841],{"type":430,"value":1173},{"type":425,"tag":477,"props":3843,"children":3844},{"style":506},[3845],{"type":430,"value":1693},{"type":425,"tag":477,"props":3847,"children":3848},{"style":496},[3849],{"type":430,"value":1173},{"type":425,"tag":477,"props":3851,"children":3852},{"style":490},[3853],{"type":430,"value":642},{"type":425,"tag":477,"props":3855,"children":3856},{"class":479,"line":1574},[3857],{"type":425,"tag":477,"props":3858,"children":3859},{"style":669},[3860],{"type":430,"value":3861},"    // 处理剩余的换行符\n",{"type":425,"tag":477,"props":3863,"children":3864},{"class":479,"line":1606},[3865,3869,3873,3877,3881,3885,3889],{"type":425,"tag":477,"props":3866,"children":3867},{"style":575},[3868],{"type":430,"value":3365},{"type":425,"tag":477,"props":3870,"children":3871},{"style":484},[3872],{"type":430,"value":1325},{"type":425,"tag":477,"props":3874,"children":3875},{"style":490},[3876],{"type":430,"value":493},{"type":425,"tag":477,"props":3878,"children":3879},{"style":496},[3880],{"type":430,"value":1173},{"type":425,"tag":477,"props":3882,"children":3883},{"style":1370},[3884],{"type":430,"value":1484},{"type":425,"tag":477,"props":3886,"children":3887},{"style":496},[3888],{"type":430,"value":1173},{"type":425,"tag":477,"props":3890,"children":3891},{"style":490},[3892],{"type":430,"value":642},{"type":425,"tag":477,"props":3894,"children":3895},{"class":479,"line":1639},[3896,3900,3904,3908,3912,3916,3920,3924,3928],{"type":425,"tag":477,"props":3897,"children":3898},{"style":575},[3899],{"type":430,"value":3365},{"type":425,"tag":477,"props":3901,"children":3902},{"style":484},[3903],{"type":430,"value":1359},{"type":425,"tag":477,"props":3905,"children":3906},{"style":490},[3907],{"type":430,"value":493},{"type":425,"tag":477,"props":3909,"children":3910},{"style":496},[3911],{"type":430,"value":1173},{"type":425,"tag":477,"props":3913,"children":3914},{"style":1370},[3915],{"type":430,"value":1758},{"type":425,"tag":477,"props":3917,"children":3918},{"style":506},[3919],{"type":430,"value":1458},{"type":425,"tag":477,"props":3921,"children":3922},{"style":496},[3923],{"type":430,"value":1173},{"type":425,"tag":477,"props":3925,"children":3926},{"style":490},[3927],{"type":430,"value":1771},{"type":425,"tag":477,"props":3929,"children":3930},{"style":851},[3931],{"type":430,"value":1776},{"type":425,"tag":477,"props":3933,"children":3934},{"class":479,"line":1671},[3935,3939,3944,3948],{"type":425,"tag":477,"props":3936,"children":3937},{"style":496},[3938],{"type":430,"value":2846},{"type":425,"tag":477,"props":3940,"children":3941},{"style":506},[3942],{"type":430,"value":3943},"');}",{"type":425,"tag":477,"props":3945,"children":3946},{"style":496},[3947],{"type":430,"value":1173},{"type":425,"tag":477,"props":3949,"children":3950},{"style":575},[3951],{"type":430,"value":1808},{"type":425,"tag":426,"props":3953,"children":3954},{},[3955,3957,3962,3964,3969,3971,3976,3977,3983,3985,3990,3992,3997],{"type":430,"value":3956},"有一个小细节，字符串替换时，所有逻辑语句的模板标志开头和结尾（",{"type":425,"tag":441,"props":3958,"children":3960},{"className":3959},[],[3961],{"type":430,"value":1338},{"type":430,"value":3963},"、",{"type":425,"tag":441,"props":3965,"children":3967},{"className":3966},[],[3968],{"type":430,"value":1424},{"type":430,"value":3970},"）分别被替换为 ",{"type":425,"tag":441,"props":3972,"children":3974},{"className":3973},[],[3975],{"type":430,"value":1628},{"type":430,"value":3963},{"type":425,"tag":441,"props":3978,"children":3980},{"className":3979},[],[3981],{"type":430,"value":3982},"push('",{"type":430,"value":3984},"，但是开头和结尾的那个标志，并没有对应的匹配。所以在代码中，能看 ",{"type":425,"tag":441,"props":3986,"children":3988},{"className":3987},[],[3989],{"type":430,"value":1222},{"type":430,"value":3991}," 和 ",{"type":425,"tag":441,"props":3993,"children":3995},{"className":3994},[],[3996],{"type":430,"value":1628},{"type":430,"value":3998}," 这种手动补全。",{"type":425,"tag":426,"props":4000,"children":4001},{},[4002],{"type":430,"value":4003},"最终生成的字符串如下（已格式化处理）：",{"type":425,"tag":467,"props":4005,"children":4007},{"className":469,"code":4006,"language":471,"meta":419,"style":419},"`with(obj){\n    p.push(''); \n    if (true) { \n        p.push('     \u003Cli>',users[i],'\u003C/li>   '); \n    } \n    p.push('');\n}`;\n",[4008],{"type":425,"tag":441,"props":4009,"children":4010},{"__ignoreMap":419},[4011,4023,4031,4039,4047,4055,4063],{"type":425,"tag":477,"props":4012,"children":4013},{"class":479,"line":480},[4014,4018],{"type":425,"tag":477,"props":4015,"children":4016},{"style":496},[4017],{"type":430,"value":572},{"type":425,"tag":477,"props":4019,"children":4020},{"style":506},[4021],{"type":430,"value":4022},"with(obj){\n",{"type":425,"tag":477,"props":4024,"children":4025},{"class":479,"line":502},[4026],{"type":425,"tag":477,"props":4027,"children":4028},{"style":506},[4029],{"type":430,"value":4030},"    p.push(''); \n",{"type":425,"tag":477,"props":4032,"children":4033},{"class":479,"line":512},[4034],{"type":425,"tag":477,"props":4035,"children":4036},{"style":506},[4037],{"type":430,"value":4038},"    if (true) { \n",{"type":425,"tag":477,"props":4040,"children":4041},{"class":479,"line":521},[4042],{"type":425,"tag":477,"props":4043,"children":4044},{"style":506},[4045],{"type":430,"value":4046},"        p.push('     \u003Cli>',users[i],'\u003C/li>   '); \n",{"type":425,"tag":477,"props":4048,"children":4049},{"class":479,"line":530},[4050],{"type":425,"tag":477,"props":4051,"children":4052},{"style":506},[4053],{"type":430,"value":4054},"    } \n",{"type":425,"tag":477,"props":4056,"children":4057},{"class":479,"line":539},[4058],{"type":425,"tag":477,"props":4059,"children":4060},{"style":506},[4061],{"type":430,"value":4062},"    p.push('');\n",{"type":425,"tag":477,"props":4064,"children":4065},{"class":479,"line":548},[4066,4070,4074],{"type":425,"tag":477,"props":4067,"children":4068},{"style":506},[4069],{"type":430,"value":637},{"type":425,"tag":477,"props":4071,"children":4072},{"style":496},[4073],{"type":430,"value":572},{"type":425,"tag":477,"props":4075,"children":4076},{"style":575},[4077],{"type":430,"value":1808},{"type":425,"tag":426,"props":4079,"children":4080},{},[4081,4083,4089],{"type":430,"value":4082},"为什么 with 语句里有一行空的 ",{"type":425,"tag":441,"props":4084,"children":4086},{"className":4085},[],[4087],{"type":430,"value":4088},"push('')",{"type":430,"value":4090}," 呢？",{"type":425,"tag":426,"props":4092,"children":4093},{},[4094],{"type":430,"value":4095},"还记得原始的模板吗？一开的模板是以“\u003C%”开头的，而“\u003C%”在替换过程被右括号取代了，此时正好和初始字符串结合形成了空 push。如果原始字符串开头是 \"123\u003C% if (true)\"，那这行空 push 会转换成“p.push('123');”，也是正确的代码。",{"type":425,"tag":426,"props":4097,"children":4098},{},[4099],{"type":430,"value":4100},"最后，micro-templating 需要返回这个新函数。如果不传参数 data 给模板函数，则会返回一个部分应用的函数等待用户输入 data 参数再执行模板解析；如果已经传了 data 那就会立即调用返回模板解析的结果。",{"type":425,"tag":467,"props":4102,"children":4104},{"className":469,"code":4103,"language":471,"meta":419,"style":419},"(function () {\n  var cache = {};\n  this.tmpl = function tmpl(str, data) {\n    return data ? fn(data) : fn;\n  };\n})();\n",[4105],{"type":425,"tag":441,"props":4106,"children":4107},{"__ignoreMap":419},[4108,4127,4146,4197,4240,4247],{"type":425,"tag":477,"props":4109,"children":4110},{"class":479,"line":480},[4111,4115,4119,4123],{"type":425,"tag":477,"props":4112,"children":4113},{"style":490},[4114],{"type":430,"value":493},{"type":425,"tag":477,"props":4116,"children":4117},{"style":823},[4118],{"type":430,"value":826},{"type":425,"tag":477,"props":4120,"children":4121},{"style":575},[4122],{"type":430,"value":831},{"type":425,"tag":477,"props":4124,"children":4125},{"style":575},[4126],{"type":430,"value":583},{"type":425,"tag":477,"props":4128,"children":4129},{"class":479,"line":502},[4130,4134,4138,4142],{"type":425,"tag":477,"props":4131,"children":4132},{"style":823},[4133],{"type":430,"value":843},{"type":425,"tag":477,"props":4135,"children":4136},{"style":490},[4137],{"type":430,"value":848},{"type":425,"tag":477,"props":4139,"children":4140},{"style":851},[4141],{"type":430,"value":854},{"type":425,"tag":477,"props":4143,"children":4144},{"style":575},[4145],{"type":430,"value":859},{"type":425,"tag":477,"props":4147,"children":4148},{"class":479,"line":512},[4149,4153,4157,4161,4165,4169,4173,4177,4181,4185,4189,4193],{"type":425,"tag":477,"props":4150,"children":4151},{"style":874},[4152],{"type":430,"value":877},{"type":425,"tag":477,"props":4154,"children":4155},{"style":575},[4156],{"type":430,"value":882},{"type":425,"tag":477,"props":4158,"children":4159},{"style":484},[4160],{"type":430,"value":887},{"type":425,"tag":477,"props":4162,"children":4163},{"style":851},[4164],{"type":430,"value":854},{"type":425,"tag":477,"props":4166,"children":4167},{"style":823},[4168],{"type":430,"value":896},{"type":425,"tag":477,"props":4170,"children":4171},{"style":484},[4172],{"type":430,"value":901},{"type":425,"tag":477,"props":4174,"children":4175},{"style":575},[4176],{"type":430,"value":493},{"type":425,"tag":477,"props":4178,"children":4179},{"style":908},[4180],{"type":430,"value":911},{"type":425,"tag":477,"props":4182,"children":4183},{"style":575},[4184],{"type":430,"value":578},{"type":425,"tag":477,"props":4186,"children":4187},{"style":908},[4188],{"type":430,"value":920},{"type":425,"tag":477,"props":4190,"children":4191},{"style":575},[4192],{"type":430,"value":925},{"type":425,"tag":477,"props":4194,"children":4195},{"style":575},[4196],{"type":430,"value":583},{"type":425,"tag":477,"props":4198,"children":4199},{"class":479,"line":521},[4200,4204,4208,4212,4216,4220,4224,4228,4232,4236],{"type":425,"tag":477,"props":4201,"children":4202},{"style":1410},[4203],{"type":430,"value":1834},{"type":425,"tag":477,"props":4205,"children":4206},{"style":490},[4207],{"type":430,"value":920},{"type":425,"tag":477,"props":4209,"children":4210},{"style":851},[4211],{"type":430,"value":1843},{"type":425,"tag":477,"props":4213,"children":4214},{"style":484},[4215],{"type":430,"value":958},{"type":425,"tag":477,"props":4217,"children":4218},{"style":590},[4219],{"type":430,"value":493},{"type":425,"tag":477,"props":4221,"children":4222},{"style":490},[4223],{"type":430,"value":1856},{"type":425,"tag":477,"props":4225,"children":4226},{"style":590},[4227],{"type":430,"value":1771},{"type":425,"tag":477,"props":4229,"children":4230},{"style":851},[4231],{"type":430,"value":598},{"type":425,"tag":477,"props":4233,"children":4234},{"style":490},[4235],{"type":430,"value":958},{"type":425,"tag":477,"props":4237,"children":4238},{"style":575},[4239],{"type":430,"value":1808},{"type":425,"tag":477,"props":4241,"children":4242},{"class":479,"line":530},[4243],{"type":425,"tag":477,"props":4244,"children":4245},{"style":575},[4246],{"type":430,"value":1881},{"type":425,"tag":477,"props":4248,"children":4249},{"class":479,"line":539},[4250,4254,4258],{"type":425,"tag":477,"props":4251,"children":4252},{"style":575},[4253],{"type":430,"value":637},{"type":425,"tag":477,"props":4255,"children":4256},{"style":490},[4257],{"type":430,"value":1894},{"type":425,"tag":477,"props":4259,"children":4260},{"style":575},[4261],{"type":430,"value":1808},{"type":425,"tag":426,"props":4263,"children":4264},{},[4265],{"type":430,"value":4266},"终于结束了！这个函数不长，但一口气看下来还是蛮费力气的。如果一遍写测试用例以便看代码，很快能把这个函数跑通，如果你是纯靠脑力跑，还没被那个长长的字符串替换链给吓住，在此我赐你称号：“Micro Templating 人肉编译器 - 十五周年限定版”。",{"type":425,"tag":426,"props":4268,"children":4269},{},[4270,4272,4279,4281,4286],{"type":430,"value":4271},"额外提一句，Function 构造器和 eval 函数比，除了能传参数意外，还有一些细节不同，比如说声明变量的作用域不同，这个需要注意。这个编译器没有错误处理等代码完善，因此不可以上生产。此外，由于 ",{"type":425,"tag":433,"props":4273,"children":4277},{"href":4274,"rel":4275},"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/with",[4276],"nofollow",[4278],{"type":430,"value":2950},{"type":430,"value":4280}," 语句非常容易出错，且不利于静态优化，不应该在业务函数里使用",{"type":425,"tag":477,"props":4282,"children":4283},{},[4284],{"type":430,"value":4285},"^with-mdn",{"type":430,"value":4287},"。最后，阅读源码需要技巧，这几点希望能帮助到你：",{"type":425,"tag":3124,"props":4289,"children":4290},{},[4291,4296,4301,4306],{"type":425,"tag":3128,"props":4292,"children":4293},{},[4294],{"type":430,"value":4295},"从注释、测试用例，先搞清楚要看的代码的作用",{"type":425,"tag":3128,"props":4297,"children":4298},{},[4299],{"type":430,"value":4300},"使用编辑器的折叠代码，一次只看一部分源码",{"type":425,"tag":3128,"props":4302,"children":4303},{},[4304],{"type":430,"value":4305},"在 Git 提交记录中搜索，从简单的版本看起",{"type":425,"tag":3128,"props":4307,"children":4308},{},[4309],{"type":430,"value":4310},"复杂代码应该从高层结构看起，比如使用 IDE 各种插件或是 Madge 等代码分析工具",{"type":425,"tag":781,"props":4312,"children":4314},{"id":4313},"相关链接",[4315],{"type":430,"value":4313},{"type":425,"tag":3124,"props":4317,"children":4318},{},[4319],{"type":425,"tag":3128,"props":4320,"children":4321},{},[4322],{"type":425,"tag":433,"props":4323,"children":4326},{"href":4324,"rel":4325},"https://johnresig.com/blog/javascript-micro-templating/",[4276],[4327],{"type":430,"value":4328},"JavaScript Micro-Templating",{"type":425,"tag":4330,"props":4331,"children":4332},"style",{},[4333],{"type":430,"value":4334},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":419,"searchDepth":502,"depth":502,"links":4336},[4337,4338,4339],{"id":783,"depth":502,"text":783},{"id":1906,"depth":502,"text":1906},{"id":4313,"depth":502,"text":4313},"markdown","content:2.articles:1100.micro-templating.md","content","2.articles/1100.micro-templating.md","2.articles/1100.micro-templating","md",[4347,4349],{"_path":43,"title":42,"description":4348},"沉浸式翻译太贵辽，试试本地部署 LLM 用来翻译网页的可行性。",{"_path":49,"title":48,"description":4350},"我的项目使用 micro-app 框架作为微前端框架。使用 micro-app 时，由于开启了样式隔离功能，子应用加载的 CSS 会被解析器解析，在选择器前增加一个子应用属性选择器前缀。我碰到的问题是，如果 CSS 源码中带嵌套语法那么解析就会失败。今天借这个问题给大家简单介绍一下 CSS Parser 的基本流程。",1739579844796]