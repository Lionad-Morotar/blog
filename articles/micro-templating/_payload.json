[{"data":1,"prerenderedAt":4090},["ShallowReactive",2],{"navigation":3,"/articles/micro-templating":155,"/articles/micro-templating-surround":4085},[4,35,86,92,119,125,149],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29,32],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🚝 四十二篇系列","/flows/fourty-two",{"title":15,"_path":16},"🌃 长夜梦","/flows/long-night-dream",{"title":18,"_path":19},"🌌 万物联结与幸福感","/flows/everything",{"title":21,"_path":22},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":24,"_path":25},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":27,"_path":28},"🌧️ 我的腼腆","/flows/shy",{"title":30,"_path":31},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":33,"_path":34},"📝 心流归档","/flows/archive",{"title":36,"_path":37,"children":38},"技术博客 / Coder","/articles",[39,41,44,47,50,53,56,59,62,65,68,71,74,77,80,83],{"title":40,"_path":37},"🦁 欢迎",{"title":42,"_path":43},"🥞 在 tailwind 中使用现代化 CSS Layers","/articles/tailwind-sass-and-css-layer",{"title":45,"_path":46},"💻 本地部署 Qwen 翻译网页","/articles/local-translator",{"title":48,"_path":49},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":51,"_path":52},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":54,"_path":55},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":57,"_path":58},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":60,"_path":61},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":63,"_path":64},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":66,"_path":67},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":69,"_path":70},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":72,"_path":73},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":75,"_path":76},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":78,"_path":79},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":81,"_path":82},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":84,"_path":85},"📝 技术博客归档","/articles/archive",{"title":87,"_path":88,"children":89},"读书笔记 / Notes","/books",[90],{"title":91,"_path":88},"📕 读书笔记",{"title":93,"_path":94,"children":95},"吉他剧场 / Music","/music",[96,98,101,104,107,110,113,116],{"title":97,"_path":94},"🎸 FingerStyle！",{"title":99,"_path":100},"🌬️ 等待的风","/music/wind",{"title":102,"_path":103},"💕 约定的海洋","/music/ocean",{"title":105,"_path":106},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":108,"_path":109},"🌏 残酷天使的行动纲领","/music/eva",{"title":111,"_path":112},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":114,"_path":115},"🍷 Wu Wei","/music/wu-wei",{"title":117,"_path":118},"🌅 无题","/music/untitled",{"title":120,"_path":121,"children":122},"知识地图 / Maps","/maps",[123],{"title":124,"_path":121},"🏁 知识地图",{"title":126,"_path":127,"children":128},"造物 / Make","/tools",[129,131,134,137,140,143,146],{"title":130,"_path":127},"🧰 工具收集",{"title":132,"_path":133},"📕 博客","/tools/blog",{"title":135,"_path":136},"🥥 Coconut","/tools/coconut",{"title":138,"_path":139},"🧶 网易云音乐歌单排序","/tools/netease-sorter",{"title":141,"_path":142},"🌐 AnySort","/tools/anysort",{"title":144,"_path":145},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":147,"_path":148},"👓 Crapto","/tools/crypto-inline",{"title":150,"_path":151,"children":152},"我 / About","/hire",[153],{"title":154,"_path":151},"📬 技术简历",{"_path":49,"_dir":156,"_draft":157,"_partial":157,"_locale":158,"title":48,"description":159,"body":160,"_type":4079,"_id":4080,"_source":4081,"_file":4082,"_stem":4083,"_extension":4084},"articles",false,"","忍者秘籍中提到的模板解析器，很短但支持变量和 if 等语句，还是 15 年前的代码！",{"type":161,"children":162,"toc":4074},"root",[163,188,200,205,382,394,514,519,525,530,1638,1643,1648,1653,1764,1777,2238,2544,2555,2654,2667,2838,2843,2862,2901,2906,2973,2978,3031,3691,3738,3743,3817,3830,3835,3840,4001,4006,4027,4050,4055,4068],{"type":164,"tag":165,"props":166,"children":167},"element","p",{},[168,171,177,179,186],{"type":169,"value":170},"text","上回我借着解决 CSS 嵌套解析问题聊到 micro-app 中实现的一个非常精简的 ",{"type":164,"tag":172,"props":173,"children":174},"a",{"href":52},[175],{"type":169,"value":176},"CSS 解析器",{"type":169,"value":178},"，还没过瘾。今天整理笔记的时候发现了角落里的这个模板解析器，那就赶紧擦擦灰尘拉出来聊一聊。这个模板解析器可是有年头了，它是 John Resig 佬 2008 年写的，叫 ",{"type":164,"tag":180,"props":181,"children":183},"code",{"className":182},[],[184],{"type":169,"value":185},"micro-templating",{"type":169,"value":187},"，距今十五年哩。（John Resig 就是写《JavaScript 忍者秘籍》那位）",{"type":164,"tag":165,"props":189,"children":190},{},[191,193,198],{"type":169,"value":192},"令人惊叹的地方是，",{"type":164,"tag":180,"props":194,"children":196},{"className":195},[],[197],{"type":169,"value":185},{"type":169,"value":199}," 的代码和它的名字一样 micro，它能用仅仅 30 行代码完成对模板的处理，并且还有读取 html 模板、缓存、柯里化等额外的高级功能！",{"type":164,"tag":165,"props":201,"children":202},{},[203],{"type":169,"value":204},"可能有些佬没接触过模板解析器，这里给出一个简单的示例。",{"type":164,"tag":206,"props":207,"children":211},"pre",{"className":208,"code":209,"language":210,"meta":158,"style":158},"language-js shiki shiki-themes material-theme-lighter github-light github-dark monokai","parse(`\n  \u003C% if (shouldCount) { %>\n    \u003C% for (var i = 1; i \u003C= 3; i++) { %>\n      \u003Cdiv>hello - \u003C%= i + count %>\u003C/div>\n    \u003C% } %>\n  \u003C% } else { %>\n    \u003Cdiv>noop\u003C/div>\n  \u003C% } %>\n`, {\n  shouldCount: true,\n  count: 1\n})\n","js",[212],{"type":164,"tag":180,"props":213,"children":214},{"__ignoreMap":158},[215,239,249,258,267,276,285,294,303,323,349,368],{"type":164,"tag":216,"props":217,"children":220},"span",{"class":218,"line":219},"line",1,[221,227,233],{"type":164,"tag":216,"props":222,"children":224},{"style":223},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[225],{"type":169,"value":226},"parse",{"type":164,"tag":216,"props":228,"children":230},{"style":229},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[231],{"type":169,"value":232},"(",{"type":164,"tag":216,"props":234,"children":236},{"style":235},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[237],{"type":169,"value":238},"`\n",{"type":164,"tag":216,"props":240,"children":242},{"class":218,"line":241},2,[243],{"type":164,"tag":216,"props":244,"children":246},{"style":245},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[247],{"type":169,"value":248},"  \u003C% if (shouldCount) { %>\n",{"type":164,"tag":216,"props":250,"children":252},{"class":218,"line":251},3,[253],{"type":164,"tag":216,"props":254,"children":255},{"style":245},[256],{"type":169,"value":257},"    \u003C% for (var i = 1; i \u003C= 3; i++) { %>\n",{"type":164,"tag":216,"props":259,"children":261},{"class":218,"line":260},4,[262],{"type":164,"tag":216,"props":263,"children":264},{"style":245},[265],{"type":169,"value":266},"      \u003Cdiv>hello - \u003C%= i + count %>\u003C/div>\n",{"type":164,"tag":216,"props":268,"children":270},{"class":218,"line":269},5,[271],{"type":164,"tag":216,"props":272,"children":273},{"style":245},[274],{"type":169,"value":275},"    \u003C% } %>\n",{"type":164,"tag":216,"props":277,"children":279},{"class":218,"line":278},6,[280],{"type":164,"tag":216,"props":281,"children":282},{"style":245},[283],{"type":169,"value":284},"  \u003C% } else { %>\n",{"type":164,"tag":216,"props":286,"children":288},{"class":218,"line":287},7,[289],{"type":164,"tag":216,"props":290,"children":291},{"style":245},[292],{"type":169,"value":293},"    \u003Cdiv>noop\u003C/div>\n",{"type":164,"tag":216,"props":295,"children":297},{"class":218,"line":296},8,[298],{"type":164,"tag":216,"props":299,"children":300},{"style":245},[301],{"type":169,"value":302},"  \u003C% } %>\n",{"type":164,"tag":216,"props":304,"children":306},{"class":218,"line":305},9,[307,312,318],{"type":164,"tag":216,"props":308,"children":309},{"style":235},[310],{"type":169,"value":311},"`",{"type":164,"tag":216,"props":313,"children":315},{"style":314},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[316],{"type":169,"value":317},",",{"type":164,"tag":216,"props":319,"children":320},{"style":314},[321],{"type":169,"value":322}," {\n",{"type":164,"tag":216,"props":324,"children":326},{"class":218,"line":325},10,[327,333,338,344],{"type":164,"tag":216,"props":328,"children":330},{"style":329},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[331],{"type":169,"value":332},"  shouldCount",{"type":164,"tag":216,"props":334,"children":335},{"style":314},[336],{"type":169,"value":337},":",{"type":164,"tag":216,"props":339,"children":341},{"style":340},"--shiki-light:#FF5370;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[342],{"type":169,"value":343}," true",{"type":164,"tag":216,"props":345,"children":346},{"style":314},[347],{"type":169,"value":348},",\n",{"type":164,"tag":216,"props":350,"children":352},{"class":218,"line":351},11,[353,358,362],{"type":164,"tag":216,"props":354,"children":355},{"style":329},[356],{"type":169,"value":357},"  count",{"type":164,"tag":216,"props":359,"children":360},{"style":314},[361],{"type":169,"value":337},{"type":164,"tag":216,"props":363,"children":365},{"style":364},"--shiki-light:#F76D47;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[366],{"type":169,"value":367}," 1\n",{"type":164,"tag":216,"props":369,"children":371},{"class":218,"line":370},12,[372,377],{"type":164,"tag":216,"props":373,"children":374},{"style":314},[375],{"type":169,"value":376},"}",{"type":164,"tag":216,"props":378,"children":379},{"style":229},[380],{"type":169,"value":381},")\n",{"type":164,"tag":165,"props":383,"children":384},{},[385,387,392],{"type":169,"value":386},"给 ",{"type":164,"tag":180,"props":388,"children":390},{"className":389},[],[391],{"type":169,"value":226},{"type":169,"value":393}," 函数传入模板字符串和数据后，自然也是输出字符串啦：",{"type":164,"tag":206,"props":395,"children":399},{"className":396,"code":397,"language":398,"meta":158,"style":158},"language-html shiki shiki-themes material-theme-lighter github-light github-dark monokai","\u003C!-- 以下经过格式化 -->\n\u003Cdiv>hello - 2\u003C/div>\n\u003Cdiv>hello - 3\u003C/div>\n\u003Cdiv>hello - 4\u003C/div>\n","html",[400],{"type":164,"tag":180,"props":401,"children":402},{"__ignoreMap":158},[403,412,450,482],{"type":164,"tag":216,"props":404,"children":405},{"class":218,"line":219},[406],{"type":164,"tag":216,"props":407,"children":409},{"style":408},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit",[410],{"type":169,"value":411},"\u003C!-- 以下经过格式化 -->\n",{"type":164,"tag":216,"props":413,"children":414},{"class":218,"line":241},[415,420,426,431,436,441,445],{"type":164,"tag":216,"props":416,"children":417},{"style":314},[418],{"type":169,"value":419},"\u003C",{"type":164,"tag":216,"props":421,"children":423},{"style":422},"--shiki-light:#E53935;--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672",[424],{"type":169,"value":425},"div",{"type":164,"tag":216,"props":427,"children":428},{"style":314},[429],{"type":169,"value":430},">",{"type":164,"tag":216,"props":432,"children":433},{"style":229},[434],{"type":169,"value":435},"hello - 2",{"type":164,"tag":216,"props":437,"children":438},{"style":314},[439],{"type":169,"value":440},"\u003C/",{"type":164,"tag":216,"props":442,"children":443},{"style":422},[444],{"type":169,"value":425},{"type":164,"tag":216,"props":446,"children":447},{"style":314},[448],{"type":169,"value":449},">\n",{"type":164,"tag":216,"props":451,"children":452},{"class":218,"line":251},[453,457,461,465,470,474,478],{"type":164,"tag":216,"props":454,"children":455},{"style":314},[456],{"type":169,"value":419},{"type":164,"tag":216,"props":458,"children":459},{"style":422},[460],{"type":169,"value":425},{"type":164,"tag":216,"props":462,"children":463},{"style":314},[464],{"type":169,"value":430},{"type":164,"tag":216,"props":466,"children":467},{"style":229},[468],{"type":169,"value":469},"hello - 3",{"type":164,"tag":216,"props":471,"children":472},{"style":314},[473],{"type":169,"value":440},{"type":164,"tag":216,"props":475,"children":476},{"style":422},[477],{"type":169,"value":425},{"type":164,"tag":216,"props":479,"children":480},{"style":314},[481],{"type":169,"value":449},{"type":164,"tag":216,"props":483,"children":484},{"class":218,"line":260},[485,489,493,497,502,506,510],{"type":164,"tag":216,"props":486,"children":487},{"style":314},[488],{"type":169,"value":419},{"type":164,"tag":216,"props":490,"children":491},{"style":422},[492],{"type":169,"value":425},{"type":164,"tag":216,"props":494,"children":495},{"style":314},[496],{"type":169,"value":430},{"type":164,"tag":216,"props":498,"children":499},{"style":229},[500],{"type":169,"value":501},"hello - 4",{"type":164,"tag":216,"props":503,"children":504},{"style":314},[505],{"type":169,"value":440},{"type":164,"tag":216,"props":507,"children":508},{"style":422},[509],{"type":169,"value":425},{"type":164,"tag":216,"props":511,"children":512},{"style":314},[513],{"type":169,"value":449},{"type":164,"tag":165,"props":515,"children":516},{},[517],{"type":169,"value":518},"相比生态里现在动则 30kb 甚至 300kb 的库，仅 30 行代码完成这个功能，简直不可思议。",{"type":164,"tag":520,"props":521,"children":523},"h2",{"id":522},"完整实现",[524],{"type":169,"value":522},{"type":164,"tag":165,"props":526,"children":527},{},[528],{"type":169,"value":529},"因为代码真的非常短，先直接看一遍，这是带注释版本的。如果你能在第一遍 review 这段代码后脑袋还保持清醒的话，留下评论，我拜你为大哥。",{"type":164,"tag":206,"props":531,"children":533},{"className":208,"code":532,"language":210,"meta":158,"style":158},"// Simple JavaScript Templating\n// John Resig - https://johnresig.com/ - MIT Licensed\n(function () {\n  var cache = {};\n\n  this.tmpl = function tmpl(str, data) {\n    // Figure out if we're getting a template, or if we need to\n    // load the template - and be sure to cache the result.\n    var fn = !/\\W/.test(str)\n      ? (cache[str] =\n          cache[str] || tmpl(document.getElementById(str).innerHTML))\n      : // Generate a reusable function that will serve as a template\n        // generator (and which will be cached).\n        new Function(\n          \"obj\",\n          \"var p=[],print=function(){p.push.apply(p,arguments);};\" +\n            // Introduce the data as local variables using with(){}\n            \"with(obj){p.push('\" +\n            // Convert the template into pure JavaScript\n            str\n              .replace(/[\\r\\t\\n]/g, \" \")\n              .split(\"\u003C%\")\n              .join(\"\\t\")\n              .replace(/((^|%>)[^\\t]*)'/g, \"$1\\r\")\n              .replace(/\\t=(.*?)%>/g, \"',$1,'\")\n              .split(\"\\t\")\n              .join(\"');\")\n              .split(\"%>\")\n              .join(\"p.push('\")\n              .split(\"\\r\")\n              .join(\"\\\\'\") +\n            \"');}return p.join('');\"\n        );\n\n    // Provide some basic currying to the user\n    return data ? fn(data) : fn;\n  };\n})();\n",[534],{"type":164,"tag":180,"props":535,"children":536},{"__ignoreMap":158},[537,545,553,575,599,608,669,677,685,743,780,853,866,875,894,917,939,948,970,979,988,1052,1086,1121,1232,1311,1343,1376,1408,1441,1473,1516,1534,1548,1556,1565,1612,1621],{"type":164,"tag":216,"props":538,"children":539},{"class":218,"line":219},[540],{"type":164,"tag":216,"props":541,"children":542},{"style":408},[543],{"type":169,"value":544},"// Simple JavaScript Templating\n",{"type":164,"tag":216,"props":546,"children":547},{"class":218,"line":241},[548],{"type":164,"tag":216,"props":549,"children":550},{"style":408},[551],{"type":169,"value":552},"// John Resig - https://johnresig.com/ - MIT Licensed\n",{"type":164,"tag":216,"props":554,"children":555},{"class":218,"line":251},[556,560,566,571],{"type":164,"tag":216,"props":557,"children":558},{"style":229},[559],{"type":169,"value":232},{"type":164,"tag":216,"props":561,"children":563},{"style":562},"--shiki-light:#9C3EDA;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic",[564],{"type":169,"value":565},"function",{"type":164,"tag":216,"props":567,"children":568},{"style":314},[569],{"type":169,"value":570}," ()",{"type":164,"tag":216,"props":572,"children":573},{"style":314},[574],{"type":169,"value":322},{"type":164,"tag":216,"props":576,"children":577},{"class":218,"line":260},[578,583,588,594],{"type":164,"tag":216,"props":579,"children":580},{"style":562},[581],{"type":169,"value":582},"  var",{"type":164,"tag":216,"props":584,"children":585},{"style":229},[586],{"type":169,"value":587}," cache",{"type":164,"tag":216,"props":589,"children":591},{"style":590},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[592],{"type":169,"value":593}," =",{"type":164,"tag":216,"props":595,"children":596},{"style":314},[597],{"type":169,"value":598}," {};\n",{"type":164,"tag":216,"props":600,"children":601},{"class":218,"line":269},[602],{"type":164,"tag":216,"props":603,"children":605},{"emptyLinePlaceholder":604},true,[606],{"type":169,"value":607},"\n",{"type":164,"tag":216,"props":609,"children":610},{"class":218,"line":278},[611,617,622,627,631,636,641,645,651,655,660,665],{"type":164,"tag":216,"props":612,"children":614},{"style":613},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[615],{"type":169,"value":616},"  this",{"type":164,"tag":216,"props":618,"children":619},{"style":314},[620],{"type":169,"value":621},".",{"type":164,"tag":216,"props":623,"children":624},{"style":223},[625],{"type":169,"value":626},"tmpl",{"type":164,"tag":216,"props":628,"children":629},{"style":590},[630],{"type":169,"value":593},{"type":164,"tag":216,"props":632,"children":633},{"style":562},[634],{"type":169,"value":635}," function",{"type":164,"tag":216,"props":637,"children":638},{"style":223},[639],{"type":169,"value":640}," tmpl",{"type":164,"tag":216,"props":642,"children":643},{"style":314},[644],{"type":169,"value":232},{"type":164,"tag":216,"props":646,"children":648},{"style":647},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#E36209;--shiki-default-font-style:inherit;--shiki-dark:#FFAB70;--shiki-dark-font-style:inherit;--shiki-sepia:#FD971F;--shiki-sepia-font-style:italic",[649],{"type":169,"value":650},"str",{"type":164,"tag":216,"props":652,"children":653},{"style":314},[654],{"type":169,"value":317},{"type":164,"tag":216,"props":656,"children":657},{"style":647},[658],{"type":169,"value":659}," data",{"type":164,"tag":216,"props":661,"children":662},{"style":314},[663],{"type":169,"value":664},")",{"type":164,"tag":216,"props":666,"children":667},{"style":314},[668],{"type":169,"value":322},{"type":164,"tag":216,"props":670,"children":671},{"class":218,"line":287},[672],{"type":164,"tag":216,"props":673,"children":674},{"style":408},[675],{"type":169,"value":676},"    // Figure out if we're getting a template, or if we need to\n",{"type":164,"tag":216,"props":678,"children":679},{"class":218,"line":296},[680],{"type":164,"tag":216,"props":681,"children":682},{"style":408},[683],{"type":169,"value":684},"    // load the template - and be sure to cache the result.\n",{"type":164,"tag":216,"props":686,"children":687},{"class":218,"line":305},[688,693,698,702,707,712,718,722,726,731,735,739],{"type":164,"tag":216,"props":689,"children":690},{"style":562},[691],{"type":169,"value":692},"    var",{"type":164,"tag":216,"props":694,"children":695},{"style":229},[696],{"type":169,"value":697}," fn",{"type":164,"tag":216,"props":699,"children":700},{"style":590},[701],{"type":169,"value":593},{"type":164,"tag":216,"props":703,"children":704},{"style":590},[705],{"type":169,"value":706}," !",{"type":164,"tag":216,"props":708,"children":709},{"style":235},[710],{"type":169,"value":711},"/",{"type":164,"tag":216,"props":713,"children":715},{"style":714},"--shiki-light:#91B859;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[716],{"type":169,"value":717},"\\W",{"type":164,"tag":216,"props":719,"children":720},{"style":235},[721],{"type":169,"value":711},{"type":164,"tag":216,"props":723,"children":724},{"style":314},[725],{"type":169,"value":621},{"type":164,"tag":216,"props":727,"children":728},{"style":223},[729],{"type":169,"value":730},"test",{"type":164,"tag":216,"props":732,"children":733},{"style":329},[734],{"type":169,"value":232},{"type":164,"tag":216,"props":736,"children":737},{"style":229},[738],{"type":169,"value":650},{"type":164,"tag":216,"props":740,"children":741},{"style":329},[742],{"type":169,"value":381},{"type":164,"tag":216,"props":744,"children":745},{"class":218,"line":325},[746,751,756,761,766,770,775],{"type":164,"tag":216,"props":747,"children":748},{"style":590},[749],{"type":169,"value":750},"      ?",{"type":164,"tag":216,"props":752,"children":753},{"style":329},[754],{"type":169,"value":755}," (",{"type":164,"tag":216,"props":757,"children":758},{"style":229},[759],{"type":169,"value":760},"cache",{"type":164,"tag":216,"props":762,"children":763},{"style":329},[764],{"type":169,"value":765},"[",{"type":164,"tag":216,"props":767,"children":768},{"style":229},[769],{"type":169,"value":650},{"type":164,"tag":216,"props":771,"children":772},{"style":329},[773],{"type":169,"value":774},"] ",{"type":164,"tag":216,"props":776,"children":777},{"style":590},[778],{"type":169,"value":779},"=\n",{"type":164,"tag":216,"props":781,"children":782},{"class":218,"line":351},[783,788,792,796,800,805,809,813,818,822,827,831,835,839,843,848],{"type":164,"tag":216,"props":784,"children":785},{"style":229},[786],{"type":169,"value":787},"          cache",{"type":164,"tag":216,"props":789,"children":790},{"style":329},[791],{"type":169,"value":765},{"type":164,"tag":216,"props":793,"children":794},{"style":229},[795],{"type":169,"value":650},{"type":164,"tag":216,"props":797,"children":798},{"style":329},[799],{"type":169,"value":774},{"type":164,"tag":216,"props":801,"children":802},{"style":590},[803],{"type":169,"value":804},"||",{"type":164,"tag":216,"props":806,"children":807},{"style":223},[808],{"type":169,"value":640},{"type":164,"tag":216,"props":810,"children":811},{"style":329},[812],{"type":169,"value":232},{"type":164,"tag":216,"props":814,"children":815},{"style":229},[816],{"type":169,"value":817},"document",{"type":164,"tag":216,"props":819,"children":820},{"style":314},[821],{"type":169,"value":621},{"type":164,"tag":216,"props":823,"children":824},{"style":223},[825],{"type":169,"value":826},"getElementById",{"type":164,"tag":216,"props":828,"children":829},{"style":329},[830],{"type":169,"value":232},{"type":164,"tag":216,"props":832,"children":833},{"style":229},[834],{"type":169,"value":650},{"type":164,"tag":216,"props":836,"children":837},{"style":329},[838],{"type":169,"value":664},{"type":164,"tag":216,"props":840,"children":841},{"style":314},[842],{"type":169,"value":621},{"type":164,"tag":216,"props":844,"children":845},{"style":229},[846],{"type":169,"value":847},"innerHTML",{"type":164,"tag":216,"props":849,"children":850},{"style":329},[851],{"type":169,"value":852},"))\n",{"type":164,"tag":216,"props":854,"children":855},{"class":218,"line":370},[856,861],{"type":164,"tag":216,"props":857,"children":858},{"style":590},[859],{"type":169,"value":860},"      :",{"type":164,"tag":216,"props":862,"children":863},{"style":408},[864],{"type":169,"value":865}," // Generate a reusable function that will serve as a template\n",{"type":164,"tag":216,"props":867,"children":869},{"class":218,"line":868},13,[870],{"type":164,"tag":216,"props":871,"children":872},{"style":408},[873],{"type":169,"value":874},"        // generator (and which will be cached).\n",{"type":164,"tag":216,"props":876,"children":878},{"class":218,"line":877},14,[879,884,889],{"type":164,"tag":216,"props":880,"children":881},{"style":590},[882],{"type":169,"value":883},"        new",{"type":164,"tag":216,"props":885,"children":886},{"style":223},[887],{"type":169,"value":888}," Function",{"type":164,"tag":216,"props":890,"children":891},{"style":329},[892],{"type":169,"value":893},"(\n",{"type":164,"tag":216,"props":895,"children":897},{"class":218,"line":896},15,[898,903,908,913],{"type":164,"tag":216,"props":899,"children":900},{"style":235},[901],{"type":169,"value":902},"          \"",{"type":164,"tag":216,"props":904,"children":905},{"style":245},[906],{"type":169,"value":907},"obj",{"type":164,"tag":216,"props":909,"children":910},{"style":235},[911],{"type":169,"value":912},"\"",{"type":164,"tag":216,"props":914,"children":915},{"style":314},[916],{"type":169,"value":348},{"type":164,"tag":216,"props":918,"children":920},{"class":218,"line":919},16,[921,925,930,934],{"type":164,"tag":216,"props":922,"children":923},{"style":235},[924],{"type":169,"value":902},{"type":164,"tag":216,"props":926,"children":927},{"style":245},[928],{"type":169,"value":929},"var p=[],print=function(){p.push.apply(p,arguments);};",{"type":164,"tag":216,"props":931,"children":932},{"style":235},[933],{"type":169,"value":912},{"type":164,"tag":216,"props":935,"children":936},{"style":590},[937],{"type":169,"value":938}," +\n",{"type":164,"tag":216,"props":940,"children":942},{"class":218,"line":941},17,[943],{"type":164,"tag":216,"props":944,"children":945},{"style":408},[946],{"type":169,"value":947},"            // Introduce the data as local variables using with(){}\n",{"type":164,"tag":216,"props":949,"children":951},{"class":218,"line":950},18,[952,957,962,966],{"type":164,"tag":216,"props":953,"children":954},{"style":235},[955],{"type":169,"value":956},"            \"",{"type":164,"tag":216,"props":958,"children":959},{"style":245},[960],{"type":169,"value":961},"with(obj){p.push('",{"type":164,"tag":216,"props":963,"children":964},{"style":235},[965],{"type":169,"value":912},{"type":164,"tag":216,"props":967,"children":968},{"style":590},[969],{"type":169,"value":938},{"type":164,"tag":216,"props":971,"children":973},{"class":218,"line":972},19,[974],{"type":164,"tag":216,"props":975,"children":976},{"style":408},[977],{"type":169,"value":978},"            // Convert the template into pure JavaScript\n",{"type":164,"tag":216,"props":980,"children":982},{"class":218,"line":981},20,[983],{"type":164,"tag":216,"props":984,"children":985},{"style":229},[986],{"type":169,"value":987},"            str\n",{"type":164,"tag":216,"props":989,"children":991},{"class":218,"line":990},21,[992,997,1002,1006,1010,1015,1020,1025,1029,1035,1039,1044,1048],{"type":164,"tag":216,"props":993,"children":994},{"style":314},[995],{"type":169,"value":996},"              .",{"type":164,"tag":216,"props":998,"children":999},{"style":223},[1000],{"type":169,"value":1001},"replace",{"type":164,"tag":216,"props":1003,"children":1004},{"style":329},[1005],{"type":169,"value":232},{"type":164,"tag":216,"props":1007,"children":1008},{"style":235},[1009],{"type":169,"value":711},{"type":164,"tag":216,"props":1011,"children":1013},{"style":1012},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[1014],{"type":169,"value":765},{"type":164,"tag":216,"props":1016,"children":1017},{"style":714},[1018],{"type":169,"value":1019},"\\r\\t\\n",{"type":164,"tag":216,"props":1021,"children":1022},{"style":1012},[1023],{"type":169,"value":1024},"]",{"type":164,"tag":216,"props":1026,"children":1027},{"style":235},[1028],{"type":169,"value":711},{"type":164,"tag":216,"props":1030,"children":1032},{"style":1031},"--shiki-light:#F76D47;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[1033],{"type":169,"value":1034},"g",{"type":164,"tag":216,"props":1036,"children":1037},{"style":314},[1038],{"type":169,"value":317},{"type":164,"tag":216,"props":1040,"children":1041},{"style":235},[1042],{"type":169,"value":1043}," \"",{"type":164,"tag":216,"props":1045,"children":1046},{"style":235},[1047],{"type":169,"value":1043},{"type":164,"tag":216,"props":1049,"children":1050},{"style":329},[1051],{"type":169,"value":381},{"type":164,"tag":216,"props":1053,"children":1055},{"class":218,"line":1054},22,[1056,1060,1065,1069,1073,1078,1082],{"type":164,"tag":216,"props":1057,"children":1058},{"style":314},[1059],{"type":169,"value":996},{"type":164,"tag":216,"props":1061,"children":1062},{"style":223},[1063],{"type":169,"value":1064},"split",{"type":164,"tag":216,"props":1066,"children":1067},{"style":329},[1068],{"type":169,"value":232},{"type":164,"tag":216,"props":1070,"children":1071},{"style":235},[1072],{"type":169,"value":912},{"type":164,"tag":216,"props":1074,"children":1075},{"style":245},[1076],{"type":169,"value":1077},"\u003C%",{"type":164,"tag":216,"props":1079,"children":1080},{"style":235},[1081],{"type":169,"value":912},{"type":164,"tag":216,"props":1083,"children":1084},{"style":329},[1085],{"type":169,"value":381},{"type":164,"tag":216,"props":1087,"children":1089},{"class":218,"line":1088},23,[1090,1094,1099,1103,1107,1113,1117],{"type":164,"tag":216,"props":1091,"children":1092},{"style":314},[1093],{"type":169,"value":996},{"type":164,"tag":216,"props":1095,"children":1096},{"style":223},[1097],{"type":169,"value":1098},"join",{"type":164,"tag":216,"props":1100,"children":1101},{"style":329},[1102],{"type":169,"value":232},{"type":164,"tag":216,"props":1104,"children":1105},{"style":235},[1106],{"type":169,"value":912},{"type":164,"tag":216,"props":1108,"children":1110},{"style":1109},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[1111],{"type":169,"value":1112},"\\t",{"type":164,"tag":216,"props":1114,"children":1115},{"style":235},[1116],{"type":169,"value":912},{"type":164,"tag":216,"props":1118,"children":1119},{"style":329},[1120],{"type":169,"value":381},{"type":164,"tag":216,"props":1122,"children":1124},{"class":218,"line":1123},24,[1125,1129,1133,1137,1141,1147,1153,1158,1164,1168,1172,1176,1180,1184,1189,1193,1198,1202,1206,1210,1214,1219,1224,1228],{"type":164,"tag":216,"props":1126,"children":1127},{"style":314},[1128],{"type":169,"value":996},{"type":164,"tag":216,"props":1130,"children":1131},{"style":223},[1132],{"type":169,"value":1001},{"type":164,"tag":216,"props":1134,"children":1135},{"style":329},[1136],{"type":169,"value":232},{"type":164,"tag":216,"props":1138,"children":1139},{"style":235},[1140],{"type":169,"value":711},{"type":164,"tag":216,"props":1142,"children":1144},{"style":1143},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#DBEDFF;--shiki-sepia:#E6DB74",[1145],{"type":169,"value":1146},"((",{"type":164,"tag":216,"props":1148,"children":1150},{"style":1149},"--shiki-light:#39ADB5;--shiki-light-font-style:italic;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#F92672;--shiki-sepia-font-style:inherit",[1151],{"type":169,"value":1152},"^",{"type":164,"tag":216,"props":1154,"children":1155},{"style":590},[1156],{"type":169,"value":1157},"|",{"type":164,"tag":216,"props":1159,"children":1161},{"style":1160},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#DBEDFF;--shiki-sepia:#E6DB74",[1162],{"type":169,"value":1163},"%>",{"type":164,"tag":216,"props":1165,"children":1166},{"style":1143},[1167],{"type":169,"value":664},{"type":164,"tag":216,"props":1169,"children":1170},{"style":1012},[1171],{"type":169,"value":765},{"type":164,"tag":216,"props":1173,"children":1174},{"style":590},[1175],{"type":169,"value":1152},{"type":164,"tag":216,"props":1177,"children":1178},{"style":714},[1179],{"type":169,"value":1112},{"type":164,"tag":216,"props":1181,"children":1182},{"style":1012},[1183],{"type":169,"value":1024},{"type":164,"tag":216,"props":1185,"children":1186},{"style":590},[1187],{"type":169,"value":1188},"*",{"type":164,"tag":216,"props":1190,"children":1191},{"style":1143},[1192],{"type":169,"value":664},{"type":164,"tag":216,"props":1194,"children":1195},{"style":1160},[1196],{"type":169,"value":1197},"'",{"type":164,"tag":216,"props":1199,"children":1200},{"style":235},[1201],{"type":169,"value":711},{"type":164,"tag":216,"props":1203,"children":1204},{"style":1031},[1205],{"type":169,"value":1034},{"type":164,"tag":216,"props":1207,"children":1208},{"style":314},[1209],{"type":169,"value":317},{"type":164,"tag":216,"props":1211,"children":1212},{"style":235},[1213],{"type":169,"value":1043},{"type":164,"tag":216,"props":1215,"children":1216},{"style":245},[1217],{"type":169,"value":1218},"$1",{"type":164,"tag":216,"props":1220,"children":1221},{"style":1109},[1222],{"type":169,"value":1223},"\\r",{"type":164,"tag":216,"props":1225,"children":1226},{"style":235},[1227],{"type":169,"value":912},{"type":164,"tag":216,"props":1229,"children":1230},{"style":329},[1231],{"type":169,"value":381},{"type":164,"tag":216,"props":1233,"children":1235},{"class":218,"line":1234},25,[1236,1240,1244,1248,1252,1256,1261,1265,1269,1274,1278,1282,1286,1290,1294,1298,1303,1307],{"type":164,"tag":216,"props":1237,"children":1238},{"style":314},[1239],{"type":169,"value":996},{"type":164,"tag":216,"props":1241,"children":1242},{"style":223},[1243],{"type":169,"value":1001},{"type":164,"tag":216,"props":1245,"children":1246},{"style":329},[1247],{"type":169,"value":232},{"type":164,"tag":216,"props":1249,"children":1250},{"style":235},[1251],{"type":169,"value":711},{"type":164,"tag":216,"props":1253,"children":1254},{"style":714},[1255],{"type":169,"value":1112},{"type":164,"tag":216,"props":1257,"children":1258},{"style":1160},[1259],{"type":169,"value":1260},"=",{"type":164,"tag":216,"props":1262,"children":1263},{"style":1143},[1264],{"type":169,"value":232},{"type":164,"tag":216,"props":1266,"children":1267},{"style":714},[1268],{"type":169,"value":621},{"type":164,"tag":216,"props":1270,"children":1271},{"style":590},[1272],{"type":169,"value":1273},"*?",{"type":164,"tag":216,"props":1275,"children":1276},{"style":1143},[1277],{"type":169,"value":664},{"type":164,"tag":216,"props":1279,"children":1280},{"style":1160},[1281],{"type":169,"value":1163},{"type":164,"tag":216,"props":1283,"children":1284},{"style":235},[1285],{"type":169,"value":711},{"type":164,"tag":216,"props":1287,"children":1288},{"style":1031},[1289],{"type":169,"value":1034},{"type":164,"tag":216,"props":1291,"children":1292},{"style":314},[1293],{"type":169,"value":317},{"type":164,"tag":216,"props":1295,"children":1296},{"style":235},[1297],{"type":169,"value":1043},{"type":164,"tag":216,"props":1299,"children":1300},{"style":245},[1301],{"type":169,"value":1302},"',$1,'",{"type":164,"tag":216,"props":1304,"children":1305},{"style":235},[1306],{"type":169,"value":912},{"type":164,"tag":216,"props":1308,"children":1309},{"style":329},[1310],{"type":169,"value":381},{"type":164,"tag":216,"props":1312,"children":1314},{"class":218,"line":1313},26,[1315,1319,1323,1327,1331,1335,1339],{"type":164,"tag":216,"props":1316,"children":1317},{"style":314},[1318],{"type":169,"value":996},{"type":164,"tag":216,"props":1320,"children":1321},{"style":223},[1322],{"type":169,"value":1064},{"type":164,"tag":216,"props":1324,"children":1325},{"style":329},[1326],{"type":169,"value":232},{"type":164,"tag":216,"props":1328,"children":1329},{"style":235},[1330],{"type":169,"value":912},{"type":164,"tag":216,"props":1332,"children":1333},{"style":1109},[1334],{"type":169,"value":1112},{"type":164,"tag":216,"props":1336,"children":1337},{"style":235},[1338],{"type":169,"value":912},{"type":164,"tag":216,"props":1340,"children":1341},{"style":329},[1342],{"type":169,"value":381},{"type":164,"tag":216,"props":1344,"children":1346},{"class":218,"line":1345},27,[1347,1351,1355,1359,1363,1368,1372],{"type":164,"tag":216,"props":1348,"children":1349},{"style":314},[1350],{"type":169,"value":996},{"type":164,"tag":216,"props":1352,"children":1353},{"style":223},[1354],{"type":169,"value":1098},{"type":164,"tag":216,"props":1356,"children":1357},{"style":329},[1358],{"type":169,"value":232},{"type":164,"tag":216,"props":1360,"children":1361},{"style":235},[1362],{"type":169,"value":912},{"type":164,"tag":216,"props":1364,"children":1365},{"style":245},[1366],{"type":169,"value":1367},"');",{"type":164,"tag":216,"props":1369,"children":1370},{"style":235},[1371],{"type":169,"value":912},{"type":164,"tag":216,"props":1373,"children":1374},{"style":329},[1375],{"type":169,"value":381},{"type":164,"tag":216,"props":1377,"children":1379},{"class":218,"line":1378},28,[1380,1384,1388,1392,1396,1400,1404],{"type":164,"tag":216,"props":1381,"children":1382},{"style":314},[1383],{"type":169,"value":996},{"type":164,"tag":216,"props":1385,"children":1386},{"style":223},[1387],{"type":169,"value":1064},{"type":164,"tag":216,"props":1389,"children":1390},{"style":329},[1391],{"type":169,"value":232},{"type":164,"tag":216,"props":1393,"children":1394},{"style":235},[1395],{"type":169,"value":912},{"type":164,"tag":216,"props":1397,"children":1398},{"style":245},[1399],{"type":169,"value":1163},{"type":164,"tag":216,"props":1401,"children":1402},{"style":235},[1403],{"type":169,"value":912},{"type":164,"tag":216,"props":1405,"children":1406},{"style":329},[1407],{"type":169,"value":381},{"type":164,"tag":216,"props":1409,"children":1411},{"class":218,"line":1410},29,[1412,1416,1420,1424,1428,1433,1437],{"type":164,"tag":216,"props":1413,"children":1414},{"style":314},[1415],{"type":169,"value":996},{"type":164,"tag":216,"props":1417,"children":1418},{"style":223},[1419],{"type":169,"value":1098},{"type":164,"tag":216,"props":1421,"children":1422},{"style":329},[1423],{"type":169,"value":232},{"type":164,"tag":216,"props":1425,"children":1426},{"style":235},[1427],{"type":169,"value":912},{"type":164,"tag":216,"props":1429,"children":1430},{"style":245},[1431],{"type":169,"value":1432},"p.push('",{"type":164,"tag":216,"props":1434,"children":1435},{"style":235},[1436],{"type":169,"value":912},{"type":164,"tag":216,"props":1438,"children":1439},{"style":329},[1440],{"type":169,"value":381},{"type":164,"tag":216,"props":1442,"children":1444},{"class":218,"line":1443},30,[1445,1449,1453,1457,1461,1465,1469],{"type":164,"tag":216,"props":1446,"children":1447},{"style":314},[1448],{"type":169,"value":996},{"type":164,"tag":216,"props":1450,"children":1451},{"style":223},[1452],{"type":169,"value":1064},{"type":164,"tag":216,"props":1454,"children":1455},{"style":329},[1456],{"type":169,"value":232},{"type":164,"tag":216,"props":1458,"children":1459},{"style":235},[1460],{"type":169,"value":912},{"type":164,"tag":216,"props":1462,"children":1463},{"style":1109},[1464],{"type":169,"value":1223},{"type":164,"tag":216,"props":1466,"children":1467},{"style":235},[1468],{"type":169,"value":912},{"type":164,"tag":216,"props":1470,"children":1471},{"style":329},[1472],{"type":169,"value":381},{"type":164,"tag":216,"props":1474,"children":1476},{"class":218,"line":1475},31,[1477,1481,1485,1489,1493,1498,1502,1506,1511],{"type":164,"tag":216,"props":1478,"children":1479},{"style":314},[1480],{"type":169,"value":996},{"type":164,"tag":216,"props":1482,"children":1483},{"style":223},[1484],{"type":169,"value":1098},{"type":164,"tag":216,"props":1486,"children":1487},{"style":329},[1488],{"type":169,"value":232},{"type":164,"tag":216,"props":1490,"children":1491},{"style":235},[1492],{"type":169,"value":912},{"type":164,"tag":216,"props":1494,"children":1495},{"style":1109},[1496],{"type":169,"value":1497},"\\\\",{"type":164,"tag":216,"props":1499,"children":1500},{"style":245},[1501],{"type":169,"value":1197},{"type":164,"tag":216,"props":1503,"children":1504},{"style":235},[1505],{"type":169,"value":912},{"type":164,"tag":216,"props":1507,"children":1508},{"style":329},[1509],{"type":169,"value":1510},") ",{"type":164,"tag":216,"props":1512,"children":1513},{"style":590},[1514],{"type":169,"value":1515},"+\n",{"type":164,"tag":216,"props":1517,"children":1519},{"class":218,"line":1518},32,[1520,1524,1529],{"type":164,"tag":216,"props":1521,"children":1522},{"style":235},[1523],{"type":169,"value":956},{"type":164,"tag":216,"props":1525,"children":1526},{"style":245},[1527],{"type":169,"value":1528},"');}return p.join('');",{"type":164,"tag":216,"props":1530,"children":1531},{"style":235},[1532],{"type":169,"value":1533},"\"\n",{"type":164,"tag":216,"props":1535,"children":1537},{"class":218,"line":1536},33,[1538,1543],{"type":164,"tag":216,"props":1539,"children":1540},{"style":329},[1541],{"type":169,"value":1542},"        )",{"type":164,"tag":216,"props":1544,"children":1545},{"style":314},[1546],{"type":169,"value":1547},";\n",{"type":164,"tag":216,"props":1549,"children":1551},{"class":218,"line":1550},34,[1552],{"type":164,"tag":216,"props":1553,"children":1554},{"emptyLinePlaceholder":604},[1555],{"type":169,"value":607},{"type":164,"tag":216,"props":1557,"children":1559},{"class":218,"line":1558},35,[1560],{"type":164,"tag":216,"props":1561,"children":1562},{"style":408},[1563],{"type":169,"value":1564},"    // Provide some basic currying to the user\n",{"type":164,"tag":216,"props":1566,"children":1568},{"class":218,"line":1567},36,[1569,1574,1578,1583,1587,1591,1596,1600,1604,1608],{"type":164,"tag":216,"props":1570,"children":1571},{"style":1149},[1572],{"type":169,"value":1573},"    return",{"type":164,"tag":216,"props":1575,"children":1576},{"style":229},[1577],{"type":169,"value":659},{"type":164,"tag":216,"props":1579,"children":1580},{"style":590},[1581],{"type":169,"value":1582}," ?",{"type":164,"tag":216,"props":1584,"children":1585},{"style":223},[1586],{"type":169,"value":697},{"type":164,"tag":216,"props":1588,"children":1589},{"style":329},[1590],{"type":169,"value":232},{"type":164,"tag":216,"props":1592,"children":1593},{"style":229},[1594],{"type":169,"value":1595},"data",{"type":164,"tag":216,"props":1597,"children":1598},{"style":329},[1599],{"type":169,"value":1510},{"type":164,"tag":216,"props":1601,"children":1602},{"style":590},[1603],{"type":169,"value":337},{"type":164,"tag":216,"props":1605,"children":1606},{"style":229},[1607],{"type":169,"value":697},{"type":164,"tag":216,"props":1609,"children":1610},{"style":314},[1611],{"type":169,"value":1547},{"type":164,"tag":216,"props":1613,"children":1615},{"class":218,"line":1614},37,[1616],{"type":164,"tag":216,"props":1617,"children":1618},{"style":314},[1619],{"type":169,"value":1620},"  };\n",{"type":164,"tag":216,"props":1622,"children":1624},{"class":218,"line":1623},38,[1625,1629,1634],{"type":164,"tag":216,"props":1626,"children":1627},{"style":314},[1628],{"type":169,"value":376},{"type":164,"tag":216,"props":1630,"children":1631},{"style":229},[1632],{"type":169,"value":1633},")()",{"type":164,"tag":216,"props":1635,"children":1636},{"style":314},[1637],{"type":169,"value":1547},{"type":164,"tag":165,"props":1639,"children":1640},{},[1641],{"type":169,"value":1642},"代码看完了，我知道你没看懂，因为曾经我也是。好了，留下三连，解析开始。",{"type":164,"tag":520,"props":1644,"children":1646},{"id":1645},"解析",[1647],{"type":169,"value":1645},{"type":164,"tag":165,"props":1649,"children":1650},{},[1651],{"type":169,"value":1652},"首先，代码最外层是一个 IIFE，给 this 对象挂载了 tmpl 函数，直接执行的话就是 window。内部通过局部变量保存了模板解析的缓存：",{"type":164,"tag":206,"props":1654,"children":1656},{"className":208,"code":1655,"language":210,"meta":158,"style":158},"(function () {\n  var cache = {};\n  this.tmpl = function tmpl(str, data) {};\n})();\n",[1657],{"type":164,"tag":180,"props":1658,"children":1659},{"__ignoreMap":158},[1660,1679,1698,1749],{"type":164,"tag":216,"props":1661,"children":1662},{"class":218,"line":219},[1663,1667,1671,1675],{"type":164,"tag":216,"props":1664,"children":1665},{"style":229},[1666],{"type":169,"value":232},{"type":164,"tag":216,"props":1668,"children":1669},{"style":562},[1670],{"type":169,"value":565},{"type":164,"tag":216,"props":1672,"children":1673},{"style":314},[1674],{"type":169,"value":570},{"type":164,"tag":216,"props":1676,"children":1677},{"style":314},[1678],{"type":169,"value":322},{"type":164,"tag":216,"props":1680,"children":1681},{"class":218,"line":241},[1682,1686,1690,1694],{"type":164,"tag":216,"props":1683,"children":1684},{"style":562},[1685],{"type":169,"value":582},{"type":164,"tag":216,"props":1687,"children":1688},{"style":229},[1689],{"type":169,"value":587},{"type":164,"tag":216,"props":1691,"children":1692},{"style":590},[1693],{"type":169,"value":593},{"type":164,"tag":216,"props":1695,"children":1696},{"style":314},[1697],{"type":169,"value":598},{"type":164,"tag":216,"props":1699,"children":1700},{"class":218,"line":251},[1701,1705,1709,1713,1717,1721,1725,1729,1733,1737,1741,1745],{"type":164,"tag":216,"props":1702,"children":1703},{"style":613},[1704],{"type":169,"value":616},{"type":164,"tag":216,"props":1706,"children":1707},{"style":314},[1708],{"type":169,"value":621},{"type":164,"tag":216,"props":1710,"children":1711},{"style":223},[1712],{"type":169,"value":626},{"type":164,"tag":216,"props":1714,"children":1715},{"style":590},[1716],{"type":169,"value":593},{"type":164,"tag":216,"props":1718,"children":1719},{"style":562},[1720],{"type":169,"value":635},{"type":164,"tag":216,"props":1722,"children":1723},{"style":223},[1724],{"type":169,"value":640},{"type":164,"tag":216,"props":1726,"children":1727},{"style":314},[1728],{"type":169,"value":232},{"type":164,"tag":216,"props":1730,"children":1731},{"style":647},[1732],{"type":169,"value":650},{"type":164,"tag":216,"props":1734,"children":1735},{"style":314},[1736],{"type":169,"value":317},{"type":164,"tag":216,"props":1738,"children":1739},{"style":647},[1740],{"type":169,"value":659},{"type":164,"tag":216,"props":1742,"children":1743},{"style":314},[1744],{"type":169,"value":664},{"type":164,"tag":216,"props":1746,"children":1747},{"style":314},[1748],{"type":169,"value":598},{"type":164,"tag":216,"props":1750,"children":1751},{"class":218,"line":260},[1752,1756,1760],{"type":164,"tag":216,"props":1753,"children":1754},{"style":314},[1755],{"type":169,"value":376},{"type":164,"tag":216,"props":1757,"children":1758},{"style":229},[1759],{"type":169,"value":1633},{"type":164,"tag":216,"props":1761,"children":1762},{"style":314},[1763],{"type":169,"value":1547},{"type":164,"tag":165,"props":1765,"children":1766},{},[1767,1769,1775],{"type":169,"value":1768},"str 参数有两种两种用途，",{"type":164,"tag":180,"props":1770,"children":1772},{"className":1771},[],[1773],{"type":169,"value":1774},"/\\W/.test(str)",{"type":169,"value":1776}," 用来判断字符串中包不包含模板分隔符，如果不含分隔符，即普通字符串，那就当作 ID，从页面对应 ID 的节点中获取内容作为模板。比如，如果 str 为 'user_tmpl'，那么模板函数将会读取页面的以下脚本的内容作为输入：",{"type":164,"tag":206,"props":1778,"children":1780},{"className":396,"code":1779,"language":398,"meta":158,"style":158},"\u003C!-- type=\"text/html\"，所以浏览器并不会执行这串脚本。它只能由 tmpl 来读取... -->\n\u003Cscript type=\"text/html\" id=\"item_tmpl\">\n  \u003Cdiv id=\"\u003C%=id%>\" class=\"\u003C%=(i % 2 == 1 ? \" even\" : \"\")%>\">\n    \u003Cdiv class=\"grid_1 alpha right\">\n      \u003Cimg class=\"righted\" src=\"\u003C%=profile_image_url%>\"/>\n    \u003C/div>\n    \u003Cdiv class=\"grid_6 omega contents\">\n      \u003Cp>\u003Cb>\u003Ca href=\"/\u003C%=from_user%>\">\u003C%=from_user%>\u003C/a>:\u003C/b> \u003C%=text%>\u003C/p>\n    \u003C/div>\n  \u003C/div>\n\u003C/script>\n",[1781],{"type":164,"tag":180,"props":1782,"children":1783},{"__ignoreMap":158},[1784,1792,1853,1937,1974,2035,2051,2087,2192,2207,2223],{"type":164,"tag":216,"props":1785,"children":1786},{"class":218,"line":219},[1787],{"type":164,"tag":216,"props":1788,"children":1789},{"style":408},[1790],{"type":169,"value":1791},"\u003C!-- type=\"text/html\"，所以浏览器并不会执行这串脚本。它只能由 tmpl 来读取... -->\n",{"type":164,"tag":216,"props":1793,"children":1794},{"class":218,"line":241},[1795,1799,1804,1810,1814,1818,1823,1827,1832,1836,1840,1845,1849],{"type":164,"tag":216,"props":1796,"children":1797},{"style":314},[1798],{"type":169,"value":419},{"type":164,"tag":216,"props":1800,"children":1801},{"style":422},[1802],{"type":169,"value":1803},"script",{"type":164,"tag":216,"props":1805,"children":1807},{"style":1806},"--shiki-light:#9C3EDA;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[1808],{"type":169,"value":1809}," type",{"type":164,"tag":216,"props":1811,"children":1812},{"style":314},[1813],{"type":169,"value":1260},{"type":164,"tag":216,"props":1815,"children":1816},{"style":235},[1817],{"type":169,"value":912},{"type":164,"tag":216,"props":1819,"children":1820},{"style":245},[1821],{"type":169,"value":1822},"text/html",{"type":164,"tag":216,"props":1824,"children":1825},{"style":235},[1826],{"type":169,"value":912},{"type":164,"tag":216,"props":1828,"children":1829},{"style":1806},[1830],{"type":169,"value":1831}," id",{"type":164,"tag":216,"props":1833,"children":1834},{"style":314},[1835],{"type":169,"value":1260},{"type":164,"tag":216,"props":1837,"children":1838},{"style":235},[1839],{"type":169,"value":912},{"type":164,"tag":216,"props":1841,"children":1842},{"style":245},[1843],{"type":169,"value":1844},"item_tmpl",{"type":164,"tag":216,"props":1846,"children":1847},{"style":235},[1848],{"type":169,"value":912},{"type":164,"tag":216,"props":1850,"children":1851},{"style":314},[1852],{"type":169,"value":449},{"type":164,"tag":216,"props":1854,"children":1855},{"class":218,"line":251},[1856,1861,1865,1869,1873,1877,1882,1886,1891,1895,1899,1904,1908,1913,1918,1923,1928,1932],{"type":164,"tag":216,"props":1857,"children":1858},{"style":314},[1859],{"type":169,"value":1860},"  \u003C",{"type":164,"tag":216,"props":1862,"children":1863},{"style":422},[1864],{"type":169,"value":425},{"type":164,"tag":216,"props":1866,"children":1867},{"style":1806},[1868],{"type":169,"value":1831},{"type":164,"tag":216,"props":1870,"children":1871},{"style":314},[1872],{"type":169,"value":1260},{"type":164,"tag":216,"props":1874,"children":1875},{"style":235},[1876],{"type":169,"value":912},{"type":164,"tag":216,"props":1878,"children":1879},{"style":245},[1880],{"type":169,"value":1881},"\u003C%=id%>",{"type":164,"tag":216,"props":1883,"children":1884},{"style":235},[1885],{"type":169,"value":912},{"type":164,"tag":216,"props":1887,"children":1888},{"style":1806},[1889],{"type":169,"value":1890}," class",{"type":164,"tag":216,"props":1892,"children":1893},{"style":314},[1894],{"type":169,"value":1260},{"type":164,"tag":216,"props":1896,"children":1897},{"style":235},[1898],{"type":169,"value":912},{"type":164,"tag":216,"props":1900,"children":1901},{"style":245},[1902],{"type":169,"value":1903},"\u003C%=(i % 2 == 1 ? ",{"type":164,"tag":216,"props":1905,"children":1906},{"style":235},[1907],{"type":169,"value":912},{"type":164,"tag":216,"props":1909,"children":1910},{"style":1806},[1911],{"type":169,"value":1912}," even",{"type":164,"tag":216,"props":1914,"children":1916},{"style":1915},"--shiki-light:#39ADB5;--shiki-light-font-style:inherit;--shiki-default:#B31D28;--shiki-default-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;--shiki-sepia:#F44747;--shiki-sepia-font-style:inherit",[1917],{"type":169,"value":912},{"type":164,"tag":216,"props":1919,"children":1920},{"style":1806},[1921],{"type":169,"value":1922}," :",{"type":164,"tag":216,"props":1924,"children":1925},{"style":1915},[1926],{"type":169,"value":1927}," \"\")%",{"type":164,"tag":216,"props":1929,"children":1930},{"style":314},[1931],{"type":169,"value":430},{"type":164,"tag":216,"props":1933,"children":1934},{"style":229},[1935],{"type":169,"value":1936},"\">\n",{"type":164,"tag":216,"props":1938,"children":1939},{"class":218,"line":260},[1940,1945,1949,1953,1957,1961,1966,1970],{"type":164,"tag":216,"props":1941,"children":1942},{"style":314},[1943],{"type":169,"value":1944},"    \u003C",{"type":164,"tag":216,"props":1946,"children":1947},{"style":422},[1948],{"type":169,"value":425},{"type":164,"tag":216,"props":1950,"children":1951},{"style":1806},[1952],{"type":169,"value":1890},{"type":164,"tag":216,"props":1954,"children":1955},{"style":314},[1956],{"type":169,"value":1260},{"type":164,"tag":216,"props":1958,"children":1959},{"style":235},[1960],{"type":169,"value":912},{"type":164,"tag":216,"props":1962,"children":1963},{"style":245},[1964],{"type":169,"value":1965},"grid_1 alpha right",{"type":164,"tag":216,"props":1967,"children":1968},{"style":235},[1969],{"type":169,"value":912},{"type":164,"tag":216,"props":1971,"children":1972},{"style":314},[1973],{"type":169,"value":449},{"type":164,"tag":216,"props":1975,"children":1976},{"class":218,"line":269},[1977,1982,1987,1991,1995,1999,2004,2008,2013,2017,2021,2026,2030],{"type":164,"tag":216,"props":1978,"children":1979},{"style":314},[1980],{"type":169,"value":1981},"      \u003C",{"type":164,"tag":216,"props":1983,"children":1984},{"style":422},[1985],{"type":169,"value":1986},"img",{"type":164,"tag":216,"props":1988,"children":1989},{"style":1806},[1990],{"type":169,"value":1890},{"type":164,"tag":216,"props":1992,"children":1993},{"style":314},[1994],{"type":169,"value":1260},{"type":164,"tag":216,"props":1996,"children":1997},{"style":235},[1998],{"type":169,"value":912},{"type":164,"tag":216,"props":2000,"children":2001},{"style":245},[2002],{"type":169,"value":2003},"righted",{"type":164,"tag":216,"props":2005,"children":2006},{"style":235},[2007],{"type":169,"value":912},{"type":164,"tag":216,"props":2009,"children":2010},{"style":1806},[2011],{"type":169,"value":2012}," src",{"type":164,"tag":216,"props":2014,"children":2015},{"style":314},[2016],{"type":169,"value":1260},{"type":164,"tag":216,"props":2018,"children":2019},{"style":235},[2020],{"type":169,"value":912},{"type":164,"tag":216,"props":2022,"children":2023},{"style":245},[2024],{"type":169,"value":2025},"\u003C%=profile_image_url%>",{"type":164,"tag":216,"props":2027,"children":2028},{"style":235},[2029],{"type":169,"value":912},{"type":164,"tag":216,"props":2031,"children":2032},{"style":314},[2033],{"type":169,"value":2034},"/>\n",{"type":164,"tag":216,"props":2036,"children":2037},{"class":218,"line":278},[2038,2043,2047],{"type":164,"tag":216,"props":2039,"children":2040},{"style":314},[2041],{"type":169,"value":2042},"    \u003C/",{"type":164,"tag":216,"props":2044,"children":2045},{"style":422},[2046],{"type":169,"value":425},{"type":164,"tag":216,"props":2048,"children":2049},{"style":314},[2050],{"type":169,"value":449},{"type":164,"tag":216,"props":2052,"children":2053},{"class":218,"line":287},[2054,2058,2062,2066,2070,2074,2079,2083],{"type":164,"tag":216,"props":2055,"children":2056},{"style":314},[2057],{"type":169,"value":1944},{"type":164,"tag":216,"props":2059,"children":2060},{"style":422},[2061],{"type":169,"value":425},{"type":164,"tag":216,"props":2063,"children":2064},{"style":1806},[2065],{"type":169,"value":1890},{"type":164,"tag":216,"props":2067,"children":2068},{"style":314},[2069],{"type":169,"value":1260},{"type":164,"tag":216,"props":2071,"children":2072},{"style":235},[2073],{"type":169,"value":912},{"type":164,"tag":216,"props":2075,"children":2076},{"style":245},[2077],{"type":169,"value":2078},"grid_6 omega contents",{"type":164,"tag":216,"props":2080,"children":2081},{"style":235},[2082],{"type":169,"value":912},{"type":164,"tag":216,"props":2084,"children":2085},{"style":314},[2086],{"type":169,"value":449},{"type":164,"tag":216,"props":2088,"children":2089},{"class":218,"line":296},[2090,2094,2098,2103,2108,2112,2116,2121,2125,2129,2134,2138,2142,2147,2151,2155,2159,2163,2167,2171,2175,2180,2184,2188],{"type":164,"tag":216,"props":2091,"children":2092},{"style":314},[2093],{"type":169,"value":1981},{"type":164,"tag":216,"props":2095,"children":2096},{"style":422},[2097],{"type":169,"value":165},{"type":164,"tag":216,"props":2099,"children":2100},{"style":314},[2101],{"type":169,"value":2102},">\u003C",{"type":164,"tag":216,"props":2104,"children":2105},{"style":422},[2106],{"type":169,"value":2107},"b",{"type":164,"tag":216,"props":2109,"children":2110},{"style":314},[2111],{"type":169,"value":2102},{"type":164,"tag":216,"props":2113,"children":2114},{"style":422},[2115],{"type":169,"value":172},{"type":164,"tag":216,"props":2117,"children":2118},{"style":1806},[2119],{"type":169,"value":2120}," href",{"type":164,"tag":216,"props":2122,"children":2123},{"style":314},[2124],{"type":169,"value":1260},{"type":164,"tag":216,"props":2126,"children":2127},{"style":235},[2128],{"type":169,"value":912},{"type":164,"tag":216,"props":2130,"children":2131},{"style":245},[2132],{"type":169,"value":2133},"/\u003C%=from_user%>",{"type":164,"tag":216,"props":2135,"children":2136},{"style":235},[2137],{"type":169,"value":912},{"type":164,"tag":216,"props":2139,"children":2140},{"style":314},[2141],{"type":169,"value":430},{"type":164,"tag":216,"props":2143,"children":2144},{"style":229},[2145],{"type":169,"value":2146},"\u003C%=from_user%>",{"type":164,"tag":216,"props":2148,"children":2149},{"style":314},[2150],{"type":169,"value":440},{"type":164,"tag":216,"props":2152,"children":2153},{"style":422},[2154],{"type":169,"value":172},{"type":164,"tag":216,"props":2156,"children":2157},{"style":314},[2158],{"type":169,"value":430},{"type":164,"tag":216,"props":2160,"children":2161},{"style":229},[2162],{"type":169,"value":337},{"type":164,"tag":216,"props":2164,"children":2165},{"style":314},[2166],{"type":169,"value":440},{"type":164,"tag":216,"props":2168,"children":2169},{"style":422},[2170],{"type":169,"value":2107},{"type":164,"tag":216,"props":2172,"children":2173},{"style":314},[2174],{"type":169,"value":430},{"type":164,"tag":216,"props":2176,"children":2177},{"style":229},[2178],{"type":169,"value":2179}," \u003C%=text%>",{"type":164,"tag":216,"props":2181,"children":2182},{"style":314},[2183],{"type":169,"value":440},{"type":164,"tag":216,"props":2185,"children":2186},{"style":422},[2187],{"type":169,"value":165},{"type":164,"tag":216,"props":2189,"children":2190},{"style":314},[2191],{"type":169,"value":449},{"type":164,"tag":216,"props":2193,"children":2194},{"class":218,"line":305},[2195,2199,2203],{"type":164,"tag":216,"props":2196,"children":2197},{"style":314},[2198],{"type":169,"value":2042},{"type":164,"tag":216,"props":2200,"children":2201},{"style":422},[2202],{"type":169,"value":425},{"type":164,"tag":216,"props":2204,"children":2205},{"style":314},[2206],{"type":169,"value":449},{"type":164,"tag":216,"props":2208,"children":2209},{"class":218,"line":325},[2210,2215,2219],{"type":164,"tag":216,"props":2211,"children":2212},{"style":314},[2213],{"type":169,"value":2214},"  \u003C/",{"type":164,"tag":216,"props":2216,"children":2217},{"style":422},[2218],{"type":169,"value":425},{"type":164,"tag":216,"props":2220,"children":2221},{"style":314},[2222],{"type":169,"value":449},{"type":164,"tag":216,"props":2224,"children":2225},{"class":218,"line":351},[2226,2230,2234],{"type":164,"tag":216,"props":2227,"children":2228},{"style":314},[2229],{"type":169,"value":440},{"type":164,"tag":216,"props":2231,"children":2232},{"style":422},[2233],{"type":169,"value":1803},{"type":164,"tag":216,"props":2235,"children":2236},{"style":314},[2237],{"type":169,"value":449},{"type":164,"tag":206,"props":2239,"children":2241},{"className":208,"code":2240,"language":210,"meta":158,"style":158},"(function () {\n  var cache = {};\n  this.tmpl = function tmpl(str, data) {\n    return !/\\W/.test(str)\n      ? // 缓存会将读取脚本内容到模板解析这个过程的解析结果缓存下来\n        (cache[str] =\n          cache[str] ||\n          // 读取脚本内容\n          tmpl(document.getElementById(str).innerHTML))\n      : new Function();\n  };\n})();\n",[2242],{"type":164,"tag":180,"props":2243,"children":2244},{"__ignoreMap":158},[2245,2264,2283,2334,2377,2389,2417,2441,2449,2497,2522,2529],{"type":164,"tag":216,"props":2246,"children":2247},{"class":218,"line":219},[2248,2252,2256,2260],{"type":164,"tag":216,"props":2249,"children":2250},{"style":229},[2251],{"type":169,"value":232},{"type":164,"tag":216,"props":2253,"children":2254},{"style":562},[2255],{"type":169,"value":565},{"type":164,"tag":216,"props":2257,"children":2258},{"style":314},[2259],{"type":169,"value":570},{"type":164,"tag":216,"props":2261,"children":2262},{"style":314},[2263],{"type":169,"value":322},{"type":164,"tag":216,"props":2265,"children":2266},{"class":218,"line":241},[2267,2271,2275,2279],{"type":164,"tag":216,"props":2268,"children":2269},{"style":562},[2270],{"type":169,"value":582},{"type":164,"tag":216,"props":2272,"children":2273},{"style":229},[2274],{"type":169,"value":587},{"type":164,"tag":216,"props":2276,"children":2277},{"style":590},[2278],{"type":169,"value":593},{"type":164,"tag":216,"props":2280,"children":2281},{"style":314},[2282],{"type":169,"value":598},{"type":164,"tag":216,"props":2284,"children":2285},{"class":218,"line":251},[2286,2290,2294,2298,2302,2306,2310,2314,2318,2322,2326,2330],{"type":164,"tag":216,"props":2287,"children":2288},{"style":613},[2289],{"type":169,"value":616},{"type":164,"tag":216,"props":2291,"children":2292},{"style":314},[2293],{"type":169,"value":621},{"type":164,"tag":216,"props":2295,"children":2296},{"style":223},[2297],{"type":169,"value":626},{"type":164,"tag":216,"props":2299,"children":2300},{"style":590},[2301],{"type":169,"value":593},{"type":164,"tag":216,"props":2303,"children":2304},{"style":562},[2305],{"type":169,"value":635},{"type":164,"tag":216,"props":2307,"children":2308},{"style":223},[2309],{"type":169,"value":640},{"type":164,"tag":216,"props":2311,"children":2312},{"style":314},[2313],{"type":169,"value":232},{"type":164,"tag":216,"props":2315,"children":2316},{"style":647},[2317],{"type":169,"value":650},{"type":164,"tag":216,"props":2319,"children":2320},{"style":314},[2321],{"type":169,"value":317},{"type":164,"tag":216,"props":2323,"children":2324},{"style":647},[2325],{"type":169,"value":659},{"type":164,"tag":216,"props":2327,"children":2328},{"style":314},[2329],{"type":169,"value":664},{"type":164,"tag":216,"props":2331,"children":2332},{"style":314},[2333],{"type":169,"value":322},{"type":164,"tag":216,"props":2335,"children":2336},{"class":218,"line":260},[2337,2341,2345,2349,2353,2357,2361,2365,2369,2373],{"type":164,"tag":216,"props":2338,"children":2339},{"style":1149},[2340],{"type":169,"value":1573},{"type":164,"tag":216,"props":2342,"children":2343},{"style":590},[2344],{"type":169,"value":706},{"type":164,"tag":216,"props":2346,"children":2347},{"style":235},[2348],{"type":169,"value":711},{"type":164,"tag":216,"props":2350,"children":2351},{"style":714},[2352],{"type":169,"value":717},{"type":164,"tag":216,"props":2354,"children":2355},{"style":235},[2356],{"type":169,"value":711},{"type":164,"tag":216,"props":2358,"children":2359},{"style":314},[2360],{"type":169,"value":621},{"type":164,"tag":216,"props":2362,"children":2363},{"style":223},[2364],{"type":169,"value":730},{"type":164,"tag":216,"props":2366,"children":2367},{"style":329},[2368],{"type":169,"value":232},{"type":164,"tag":216,"props":2370,"children":2371},{"style":229},[2372],{"type":169,"value":650},{"type":164,"tag":216,"props":2374,"children":2375},{"style":329},[2376],{"type":169,"value":381},{"type":164,"tag":216,"props":2378,"children":2379},{"class":218,"line":269},[2380,2384],{"type":164,"tag":216,"props":2381,"children":2382},{"style":590},[2383],{"type":169,"value":750},{"type":164,"tag":216,"props":2385,"children":2386},{"style":408},[2387],{"type":169,"value":2388}," // 缓存会将读取脚本内容到模板解析这个过程的解析结果缓存下来\n",{"type":164,"tag":216,"props":2390,"children":2391},{"class":218,"line":278},[2392,2397,2401,2405,2409,2413],{"type":164,"tag":216,"props":2393,"children":2394},{"style":329},[2395],{"type":169,"value":2396},"        (",{"type":164,"tag":216,"props":2398,"children":2399},{"style":229},[2400],{"type":169,"value":760},{"type":164,"tag":216,"props":2402,"children":2403},{"style":329},[2404],{"type":169,"value":765},{"type":164,"tag":216,"props":2406,"children":2407},{"style":229},[2408],{"type":169,"value":650},{"type":164,"tag":216,"props":2410,"children":2411},{"style":329},[2412],{"type":169,"value":774},{"type":164,"tag":216,"props":2414,"children":2415},{"style":590},[2416],{"type":169,"value":779},{"type":164,"tag":216,"props":2418,"children":2419},{"class":218,"line":287},[2420,2424,2428,2432,2436],{"type":164,"tag":216,"props":2421,"children":2422},{"style":229},[2423],{"type":169,"value":787},{"type":164,"tag":216,"props":2425,"children":2426},{"style":329},[2427],{"type":169,"value":765},{"type":164,"tag":216,"props":2429,"children":2430},{"style":229},[2431],{"type":169,"value":650},{"type":164,"tag":216,"props":2433,"children":2434},{"style":329},[2435],{"type":169,"value":774},{"type":164,"tag":216,"props":2437,"children":2438},{"style":590},[2439],{"type":169,"value":2440},"||\n",{"type":164,"tag":216,"props":2442,"children":2443},{"class":218,"line":296},[2444],{"type":164,"tag":216,"props":2445,"children":2446},{"style":408},[2447],{"type":169,"value":2448},"          // 读取脚本内容\n",{"type":164,"tag":216,"props":2450,"children":2451},{"class":218,"line":305},[2452,2457,2461,2465,2469,2473,2477,2481,2485,2489,2493],{"type":164,"tag":216,"props":2453,"children":2454},{"style":223},[2455],{"type":169,"value":2456},"          tmpl",{"type":164,"tag":216,"props":2458,"children":2459},{"style":329},[2460],{"type":169,"value":232},{"type":164,"tag":216,"props":2462,"children":2463},{"style":229},[2464],{"type":169,"value":817},{"type":164,"tag":216,"props":2466,"children":2467},{"style":314},[2468],{"type":169,"value":621},{"type":164,"tag":216,"props":2470,"children":2471},{"style":223},[2472],{"type":169,"value":826},{"type":164,"tag":216,"props":2474,"children":2475},{"style":329},[2476],{"type":169,"value":232},{"type":164,"tag":216,"props":2478,"children":2479},{"style":229},[2480],{"type":169,"value":650},{"type":164,"tag":216,"props":2482,"children":2483},{"style":329},[2484],{"type":169,"value":664},{"type":164,"tag":216,"props":2486,"children":2487},{"style":314},[2488],{"type":169,"value":621},{"type":164,"tag":216,"props":2490,"children":2491},{"style":229},[2492],{"type":169,"value":847},{"type":164,"tag":216,"props":2494,"children":2495},{"style":329},[2496],{"type":169,"value":852},{"type":164,"tag":216,"props":2498,"children":2499},{"class":218,"line":325},[2500,2504,2509,2513,2518],{"type":164,"tag":216,"props":2501,"children":2502},{"style":590},[2503],{"type":169,"value":860},{"type":164,"tag":216,"props":2505,"children":2506},{"style":590},[2507],{"type":169,"value":2508}," new",{"type":164,"tag":216,"props":2510,"children":2511},{"style":223},[2512],{"type":169,"value":888},{"type":164,"tag":216,"props":2514,"children":2515},{"style":329},[2516],{"type":169,"value":2517},"()",{"type":164,"tag":216,"props":2519,"children":2520},{"style":314},[2521],{"type":169,"value":1547},{"type":164,"tag":216,"props":2523,"children":2524},{"class":218,"line":351},[2525],{"type":164,"tag":216,"props":2526,"children":2527},{"style":314},[2528],{"type":169,"value":1620},{"type":164,"tag":216,"props":2530,"children":2531},{"class":218,"line":370},[2532,2536,2540],{"type":164,"tag":216,"props":2533,"children":2534},{"style":314},[2535],{"type":169,"value":376},{"type":164,"tag":216,"props":2537,"children":2538},{"style":229},[2539],{"type":169,"value":1633},{"type":164,"tag":216,"props":2541,"children":2542},{"style":314},[2543],{"type":169,"value":1547},{"type":164,"tag":165,"props":2545,"children":2546},{},[2547,2553],{"type":164,"tag":180,"props":2548,"children":2550},{"className":2549},[],[2551],{"type":169,"value":2552},"new Function()",{"type":169,"value":2554}," 即模板解析的核心内容，原理是用一个数组，保存所有解析内容，再拼接回字符串，作为 JS 执行。类似 eval 函数。",{"type":164,"tag":206,"props":2556,"children":2558},{"className":208,"code":2557,"language":210,"meta":158,"style":158},"new Function(\n  \"obj\",\n  \"var p=[];\" +\n    // + '...'\n    \"return p.join('')\"\n);\n",[2559],{"type":164,"tag":180,"props":2560,"children":2561},{"__ignoreMap":158},[2562,2578,2598,2618,2626,2643],{"type":164,"tag":216,"props":2563,"children":2564},{"class":218,"line":219},[2565,2570,2574],{"type":164,"tag":216,"props":2566,"children":2567},{"style":590},[2568],{"type":169,"value":2569},"new",{"type":164,"tag":216,"props":2571,"children":2572},{"style":223},[2573],{"type":169,"value":888},{"type":164,"tag":216,"props":2575,"children":2576},{"style":229},[2577],{"type":169,"value":893},{"type":164,"tag":216,"props":2579,"children":2580},{"class":218,"line":241},[2581,2586,2590,2594],{"type":164,"tag":216,"props":2582,"children":2583},{"style":235},[2584],{"type":169,"value":2585},"  \"",{"type":164,"tag":216,"props":2587,"children":2588},{"style":245},[2589],{"type":169,"value":907},{"type":164,"tag":216,"props":2591,"children":2592},{"style":235},[2593],{"type":169,"value":912},{"type":164,"tag":216,"props":2595,"children":2596},{"style":314},[2597],{"type":169,"value":348},{"type":164,"tag":216,"props":2599,"children":2600},{"class":218,"line":251},[2601,2605,2610,2614],{"type":164,"tag":216,"props":2602,"children":2603},{"style":235},[2604],{"type":169,"value":2585},{"type":164,"tag":216,"props":2606,"children":2607},{"style":245},[2608],{"type":169,"value":2609},"var p=[];",{"type":164,"tag":216,"props":2611,"children":2612},{"style":235},[2613],{"type":169,"value":912},{"type":164,"tag":216,"props":2615,"children":2616},{"style":590},[2617],{"type":169,"value":938},{"type":164,"tag":216,"props":2619,"children":2620},{"class":218,"line":260},[2621],{"type":164,"tag":216,"props":2622,"children":2623},{"style":408},[2624],{"type":169,"value":2625},"    // + '...'\n",{"type":164,"tag":216,"props":2627,"children":2628},{"class":218,"line":269},[2629,2634,2639],{"type":164,"tag":216,"props":2630,"children":2631},{"style":235},[2632],{"type":169,"value":2633},"    \"",{"type":164,"tag":216,"props":2635,"children":2636},{"style":245},[2637],{"type":169,"value":2638},"return p.join('')",{"type":164,"tag":216,"props":2640,"children":2641},{"style":235},[2642],{"type":169,"value":1533},{"type":164,"tag":216,"props":2644,"children":2645},{"class":218,"line":278},[2646,2650],{"type":164,"tag":216,"props":2647,"children":2648},{"style":229},[2649],{"type":169,"value":664},{"type":164,"tag":216,"props":2651,"children":2652},{"style":314},[2653],{"type":169,"value":1547},{"type":164,"tag":165,"props":2655,"children":2656},{},[2657,2659,2665],{"type":169,"value":2658},"要解析什么内容呢？无非是 ",{"type":164,"tag":180,"props":2660,"children":2662},{"className":2661},[],[2663],{"type":169,"value":2664},"\u003C%=hello%>",{"type":169,"value":2666}," 这种模板字符串。执行过程中，通过 with 语句，将内部变量的求值（hello）转移到参数对象（data.hello）。这个玩意儿在 VueJS 的模板编译中也用到过：",{"type":164,"tag":206,"props":2668,"children":2670},{"className":208,"code":2669,"language":210,"meta":158,"style":158},"/* VueJS */\nwith (vm) {\n  return createVNode(\"p\", { attrs: { hi: hello /* vm.hello */ } }, [\n    createTextNode(\"Hello World\"),\n  ]);\n}\n",[2671],{"type":164,"tag":180,"props":2672,"children":2673},{"__ignoreMap":158},[2674,2682,2700,2785,2818,2830],{"type":164,"tag":216,"props":2675,"children":2676},{"class":218,"line":219},[2677],{"type":164,"tag":216,"props":2678,"children":2679},{"style":408},[2680],{"type":169,"value":2681},"/* VueJS */\n",{"type":164,"tag":216,"props":2683,"children":2684},{"class":218,"line":241},[2685,2690,2695],{"type":164,"tag":216,"props":2686,"children":2687},{"style":1149},[2688],{"type":169,"value":2689},"with",{"type":164,"tag":216,"props":2691,"children":2692},{"style":229},[2693],{"type":169,"value":2694}," (vm) ",{"type":164,"tag":216,"props":2696,"children":2697},{"style":314},[2698],{"type":169,"value":2699},"{\n",{"type":164,"tag":216,"props":2701,"children":2702},{"class":218,"line":251},[2703,2708,2713,2717,2721,2725,2729,2733,2738,2743,2747,2751,2756,2760,2765,2770,2775,2780],{"type":164,"tag":216,"props":2704,"children":2705},{"style":1149},[2706],{"type":169,"value":2707},"  return",{"type":164,"tag":216,"props":2709,"children":2710},{"style":223},[2711],{"type":169,"value":2712}," createVNode",{"type":164,"tag":216,"props":2714,"children":2715},{"style":329},[2716],{"type":169,"value":232},{"type":164,"tag":216,"props":2718,"children":2719},{"style":235},[2720],{"type":169,"value":912},{"type":164,"tag":216,"props":2722,"children":2723},{"style":245},[2724],{"type":169,"value":165},{"type":164,"tag":216,"props":2726,"children":2727},{"style":235},[2728],{"type":169,"value":912},{"type":164,"tag":216,"props":2730,"children":2731},{"style":314},[2732],{"type":169,"value":317},{"type":164,"tag":216,"props":2734,"children":2735},{"style":314},[2736],{"type":169,"value":2737}," {",{"type":164,"tag":216,"props":2739,"children":2740},{"style":329},[2741],{"type":169,"value":2742}," attrs",{"type":164,"tag":216,"props":2744,"children":2745},{"style":314},[2746],{"type":169,"value":337},{"type":164,"tag":216,"props":2748,"children":2749},{"style":314},[2750],{"type":169,"value":2737},{"type":164,"tag":216,"props":2752,"children":2753},{"style":329},[2754],{"type":169,"value":2755}," hi",{"type":164,"tag":216,"props":2757,"children":2758},{"style":314},[2759],{"type":169,"value":337},{"type":164,"tag":216,"props":2761,"children":2762},{"style":229},[2763],{"type":169,"value":2764}," hello",{"type":164,"tag":216,"props":2766,"children":2767},{"style":408},[2768],{"type":169,"value":2769}," /* vm.hello */",{"type":164,"tag":216,"props":2771,"children":2772},{"style":314},[2773],{"type":169,"value":2774}," }",{"type":164,"tag":216,"props":2776,"children":2777},{"style":314},[2778],{"type":169,"value":2779}," },",{"type":164,"tag":216,"props":2781,"children":2782},{"style":329},[2783],{"type":169,"value":2784}," [\n",{"type":164,"tag":216,"props":2786,"children":2787},{"class":218,"line":260},[2788,2793,2797,2801,2806,2810,2814],{"type":164,"tag":216,"props":2789,"children":2790},{"style":223},[2791],{"type":169,"value":2792},"    createTextNode",{"type":164,"tag":216,"props":2794,"children":2795},{"style":329},[2796],{"type":169,"value":232},{"type":164,"tag":216,"props":2798,"children":2799},{"style":235},[2800],{"type":169,"value":912},{"type":164,"tag":216,"props":2802,"children":2803},{"style":245},[2804],{"type":169,"value":2805},"Hello World",{"type":164,"tag":216,"props":2807,"children":2808},{"style":235},[2809],{"type":169,"value":912},{"type":164,"tag":216,"props":2811,"children":2812},{"style":329},[2813],{"type":169,"value":664},{"type":164,"tag":216,"props":2815,"children":2816},{"style":314},[2817],{"type":169,"value":348},{"type":164,"tag":216,"props":2819,"children":2820},{"class":218,"line":269},[2821,2826],{"type":164,"tag":216,"props":2822,"children":2823},{"style":329},[2824],{"type":169,"value":2825},"  ])",{"type":164,"tag":216,"props":2827,"children":2828},{"style":314},[2829],{"type":169,"value":1547},{"type":164,"tag":216,"props":2831,"children":2832},{"class":218,"line":278},[2833],{"type":164,"tag":216,"props":2834,"children":2835},{"style":314},[2836],{"type":169,"value":2837},"}\n",{"type":164,"tag":165,"props":2839,"children":2840},{},[2841],{"type":169,"value":2842},"那如何解析呢？",{"type":164,"tag":165,"props":2844,"children":2845},{},[2846,2852,2854,2860],{"type":164,"tag":2847,"props":2848,"children":2849},"del",{},[2850],{"type":169,"value":2851},"我们知道",{"type":169,"value":2853},"曾写过经典字符串模板的佬应该知道，",{"type":164,"tag":2855,"props":2856,"children":2857},"strong",{},[2858],{"type":169,"value":2859},"模板字符串一般包含：字符串、变量及逻辑",{"type":169,"value":2861},"。",{"type":164,"tag":2863,"props":2864,"children":2865},"ul",{},[2866,2878,2889],{"type":164,"tag":2867,"props":2868,"children":2869},"li",{},[2870,2872],{"type":169,"value":2871},"字符串 ",{"type":164,"tag":180,"props":2873,"children":2875},{"className":2874},[],[2876],{"type":169,"value":2877},"\u003Chtml>Lionad\u003C/html>",{"type":164,"tag":2867,"props":2879,"children":2880},{},[2881,2883],{"type":169,"value":2882},"带变量 ",{"type":164,"tag":180,"props":2884,"children":2886},{"className":2885},[],[2887],{"type":169,"value":2888},"\u003Chtml>\u003C%=name%>\u003C/html>",{"type":164,"tag":2867,"props":2890,"children":2891},{},[2892,2894,2900],{"type":169,"value":2893},"带逻辑 ",{"type":164,"tag":180,"props":2895,"children":2897},{"className":2896},[],[2898],{"type":169,"value":2899},"\u003C% if(name){ %>\u003Chtml>\u003C%=name%>\u003C/html>\u003C% } %>",{"type":169,"value":2861},{"type":164,"tag":165,"props":2902,"children":2903},{},[2904],{"type":169,"value":2905},"所以解析模板，无非就是把这三种字符串替换成纯粹的 JS 逻辑，作为 new Function 的参数。其中所有中间变量，可以用一个数组来储存：",{"type":164,"tag":2863,"props":2907,"children":2908},{},[2909,2928,2946],{"type":164,"tag":2867,"props":2910,"children":2911},{},[2912,2914,2919,2921,2927],{"type":169,"value":2913},"将普通字符串直接推入作为结果的内容数组，比如 ",{"type":164,"tag":180,"props":2915,"children":2917},{"className":2916},[],[2918],{"type":169,"value":2877},{"type":169,"value":2920}," 应该被解析为 ",{"type":164,"tag":180,"props":2922,"children":2924},{"className":2923},[],[2925],{"type":169,"value":2926},"p.push('\u003Chtml>Lionad\u003C/html>')",{"type":169,"value":2861},{"type":164,"tag":2867,"props":2929,"children":2930},{},[2931,2933,2938,2939,2945],{"type":169,"value":2932},"如果碰到变量，则将变量拆分出来推入数组，如 ",{"type":164,"tag":180,"props":2934,"children":2936},{"className":2935},[],[2937],{"type":169,"value":2888},{"type":169,"value":2920},{"type":164,"tag":180,"props":2940,"children":2942},{"className":2941},[],[2943],{"type":169,"value":2944},"p.push('\u003Chtml>');p.push(name);p.push('\u003C/html>')",{"type":169,"value":2861},{"type":164,"tag":2867,"props":2947,"children":2948},{},[2949,2951,2957,2959,2964,2966,2972],{"type":169,"value":2950},"带逻辑的字符串，由于逻辑本身就是 JS 代码，所以不需要解析为字符串，只需要把两侧的 ",{"type":164,"tag":180,"props":2952,"children":2954},{"className":2953},[],[2955],{"type":169,"value":2956},"\u003C% %>",{"type":169,"value":2958}," 这种模板标志去掉就好了。如 ",{"type":164,"tag":180,"props":2960,"children":2962},{"className":2961},[],[2963],{"type":169,"value":2899},{"type":169,"value":2965}," 应该被解析为：",{"type":164,"tag":180,"props":2967,"children":2969},{"className":2968},[],[2970],{"type":169,"value":2971},"if(name){ p.push('\u003Chtml>');p.push(name);p.push('\u003C/html>') } ",{"type":169,"value":2861},{"type":164,"tag":165,"props":2974,"children":2975},{},[2976],{"type":169,"value":2977},"以下面这段模板为例，我们看看字符串具体的替换规则。",{"type":164,"tag":206,"props":2979,"children":2981},{"className":208,"code":2980,"language":210,"meta":158,"style":158},"str = `\u003C% if (true) { %>\n    \u003Cli>\u003C%=users[i]%>\u003C/li>\n\u003C% } %>`;\n",[2982],{"type":164,"tag":180,"props":2983,"children":2984},{"__ignoreMap":158},[2985,3007,3015],{"type":164,"tag":216,"props":2986,"children":2987},{"class":218,"line":219},[2988,2993,2997,3002],{"type":164,"tag":216,"props":2989,"children":2990},{"style":229},[2991],{"type":169,"value":2992},"str ",{"type":164,"tag":216,"props":2994,"children":2995},{"style":590},[2996],{"type":169,"value":1260},{"type":164,"tag":216,"props":2998,"children":2999},{"style":235},[3000],{"type":169,"value":3001}," `",{"type":164,"tag":216,"props":3003,"children":3004},{"style":245},[3005],{"type":169,"value":3006},"\u003C% if (true) { %>\n",{"type":164,"tag":216,"props":3008,"children":3009},{"class":218,"line":241},[3010],{"type":164,"tag":216,"props":3011,"children":3012},{"style":245},[3013],{"type":169,"value":3014},"    \u003Cli>\u003C%=users[i]%>\u003C/li>\n",{"type":164,"tag":216,"props":3016,"children":3017},{"class":218,"line":251},[3018,3023,3027],{"type":164,"tag":216,"props":3019,"children":3020},{"style":245},[3021],{"type":169,"value":3022},"\u003C% } %>",{"type":164,"tag":216,"props":3024,"children":3025},{"style":235},[3026],{"type":169,"value":311},{"type":164,"tag":216,"props":3028,"children":3029},{"style":314},[3030],{"type":169,"value":1547},{"type":164,"tag":206,"props":3032,"children":3034},{"className":208,"code":3033,"language":210,"meta":158,"style":158},"// with 的使用方法都知道了，with(obj = { a })，那么\n// 就能在内部直接读取 a，不需要写 obj.a\n\"with(obj){p.push('\" +\n  str\n    // 将换行等空白字符转换为空格，这样所有代码都在一行了\n    // '\u003C% if (true) { %>     \u003Cli>\u003C%=users[i]%>\u003C/li> \u003C% } %>'\n    .replace(/[\\r\\t\\n]/g, \" \")\n    // ['', 'if (true) { %>\u003Cli>', '=users[i]%>\u003C/li>', ' } %>']\n    .split(\"\u003C%\")\n    // 因为 \\t 刚才已经被替换成空格了，所以这里可以使用 \\t 用来将不同行的代码字符串“相加”，\n    // 一会儿再拆分时，不会和原先字符串里的字符混淆\n    .join(\"\\t\")\n    // 去掉模板标志两端的引号，在这个例子里不会用到\n    .replace(/((^|%>)[^\\t]*)'/g, \"$1\\r\")\n    // 以下三句最重要，将所有变量推入数组，生成结果形如 `push('xxx',x,'xxx')` 的字符串\n    // 首先，刚才匹配完了 \u003C%，所以 \\t= 开头后边接的就是变量，这里让它转换成 ',x,' 的形式\n    .replace(/\\t=(.*?)%>/g, \"',$1,'\")\n    .split(\"\\t\")\n    // 在刚刚跟 split('\u003C%') 的位置用括号还原，得到了 ',x,'xxx'); 的形式\n    .join(\"');\")\n    // 在 \\t=xxx 那次匹配，已经把变量模板对应的结束标志 %> 匹配完了，\n    // 所以这是处理剩余语句的结束标志，用 split 拆分行后相当于直接把结束标记舍弃了\n    .split(\"%>\")\n    // 最终在每行开头增加 push 方法，形成了 push('xxx',x,'xxx'); 的形式\n    .join(\"p.push('\")\n    // 处理剩余的换行符\n    .split(\"\\r\")\n    .join(\"\\\\'\") +\n  \"');}\";\n",[3035],{"type":164,"tag":180,"props":3036,"children":3037},{"__ignoreMap":158},[3038,3046,3054,3073,3081,3089,3097,3153,3161,3192,3200,3208,3239,3247,3346,3354,3362,3437,3468,3476,3507,3515,3523,3554,3562,3593,3601,3632,3671],{"type":164,"tag":216,"props":3039,"children":3040},{"class":218,"line":219},[3041],{"type":164,"tag":216,"props":3042,"children":3043},{"style":408},[3044],{"type":169,"value":3045},"// with 的使用方法都知道了，with(obj = { a })，那么\n",{"type":164,"tag":216,"props":3047,"children":3048},{"class":218,"line":241},[3049],{"type":164,"tag":216,"props":3050,"children":3051},{"style":408},[3052],{"type":169,"value":3053},"// 就能在内部直接读取 a，不需要写 obj.a\n",{"type":164,"tag":216,"props":3055,"children":3056},{"class":218,"line":251},[3057,3061,3065,3069],{"type":164,"tag":216,"props":3058,"children":3059},{"style":235},[3060],{"type":169,"value":912},{"type":164,"tag":216,"props":3062,"children":3063},{"style":245},[3064],{"type":169,"value":961},{"type":164,"tag":216,"props":3066,"children":3067},{"style":235},[3068],{"type":169,"value":912},{"type":164,"tag":216,"props":3070,"children":3071},{"style":590},[3072],{"type":169,"value":938},{"type":164,"tag":216,"props":3074,"children":3075},{"class":218,"line":260},[3076],{"type":164,"tag":216,"props":3077,"children":3078},{"style":229},[3079],{"type":169,"value":3080},"  str\n",{"type":164,"tag":216,"props":3082,"children":3083},{"class":218,"line":269},[3084],{"type":164,"tag":216,"props":3085,"children":3086},{"style":408},[3087],{"type":169,"value":3088},"    // 将换行等空白字符转换为空格，这样所有代码都在一行了\n",{"type":164,"tag":216,"props":3090,"children":3091},{"class":218,"line":278},[3092],{"type":164,"tag":216,"props":3093,"children":3094},{"style":408},[3095],{"type":169,"value":3096},"    // '\u003C% if (true) { %>     \u003Cli>\u003C%=users[i]%>\u003C/li> \u003C% } %>'\n",{"type":164,"tag":216,"props":3098,"children":3099},{"class":218,"line":287},[3100,3105,3109,3113,3117,3121,3125,3129,3133,3137,3141,3145,3149],{"type":164,"tag":216,"props":3101,"children":3102},{"style":314},[3103],{"type":169,"value":3104},"    .",{"type":164,"tag":216,"props":3106,"children":3107},{"style":223},[3108],{"type":169,"value":1001},{"type":164,"tag":216,"props":3110,"children":3111},{"style":229},[3112],{"type":169,"value":232},{"type":164,"tag":216,"props":3114,"children":3115},{"style":235},[3116],{"type":169,"value":711},{"type":164,"tag":216,"props":3118,"children":3119},{"style":1012},[3120],{"type":169,"value":765},{"type":164,"tag":216,"props":3122,"children":3123},{"style":714},[3124],{"type":169,"value":1019},{"type":164,"tag":216,"props":3126,"children":3127},{"style":1012},[3128],{"type":169,"value":1024},{"type":164,"tag":216,"props":3130,"children":3131},{"style":235},[3132],{"type":169,"value":711},{"type":164,"tag":216,"props":3134,"children":3135},{"style":1031},[3136],{"type":169,"value":1034},{"type":164,"tag":216,"props":3138,"children":3139},{"style":314},[3140],{"type":169,"value":317},{"type":164,"tag":216,"props":3142,"children":3143},{"style":235},[3144],{"type":169,"value":1043},{"type":164,"tag":216,"props":3146,"children":3147},{"style":235},[3148],{"type":169,"value":1043},{"type":164,"tag":216,"props":3150,"children":3151},{"style":229},[3152],{"type":169,"value":381},{"type":164,"tag":216,"props":3154,"children":3155},{"class":218,"line":296},[3156],{"type":164,"tag":216,"props":3157,"children":3158},{"style":408},[3159],{"type":169,"value":3160},"    // ['', 'if (true) { %>\u003Cli>', '=users[i]%>\u003C/li>', ' } %>']\n",{"type":164,"tag":216,"props":3162,"children":3163},{"class":218,"line":305},[3164,3168,3172,3176,3180,3184,3188],{"type":164,"tag":216,"props":3165,"children":3166},{"style":314},[3167],{"type":169,"value":3104},{"type":164,"tag":216,"props":3169,"children":3170},{"style":223},[3171],{"type":169,"value":1064},{"type":164,"tag":216,"props":3173,"children":3174},{"style":229},[3175],{"type":169,"value":232},{"type":164,"tag":216,"props":3177,"children":3178},{"style":235},[3179],{"type":169,"value":912},{"type":164,"tag":216,"props":3181,"children":3182},{"style":245},[3183],{"type":169,"value":1077},{"type":164,"tag":216,"props":3185,"children":3186},{"style":235},[3187],{"type":169,"value":912},{"type":164,"tag":216,"props":3189,"children":3190},{"style":229},[3191],{"type":169,"value":381},{"type":164,"tag":216,"props":3193,"children":3194},{"class":218,"line":325},[3195],{"type":164,"tag":216,"props":3196,"children":3197},{"style":408},[3198],{"type":169,"value":3199},"    // 因为 \\t 刚才已经被替换成空格了，所以这里可以使用 \\t 用来将不同行的代码字符串“相加”，\n",{"type":164,"tag":216,"props":3201,"children":3202},{"class":218,"line":351},[3203],{"type":164,"tag":216,"props":3204,"children":3205},{"style":408},[3206],{"type":169,"value":3207},"    // 一会儿再拆分时，不会和原先字符串里的字符混淆\n",{"type":164,"tag":216,"props":3209,"children":3210},{"class":218,"line":370},[3211,3215,3219,3223,3227,3231,3235],{"type":164,"tag":216,"props":3212,"children":3213},{"style":314},[3214],{"type":169,"value":3104},{"type":164,"tag":216,"props":3216,"children":3217},{"style":223},[3218],{"type":169,"value":1098},{"type":164,"tag":216,"props":3220,"children":3221},{"style":229},[3222],{"type":169,"value":232},{"type":164,"tag":216,"props":3224,"children":3225},{"style":235},[3226],{"type":169,"value":912},{"type":164,"tag":216,"props":3228,"children":3229},{"style":1109},[3230],{"type":169,"value":1112},{"type":164,"tag":216,"props":3232,"children":3233},{"style":235},[3234],{"type":169,"value":912},{"type":164,"tag":216,"props":3236,"children":3237},{"style":229},[3238],{"type":169,"value":381},{"type":164,"tag":216,"props":3240,"children":3241},{"class":218,"line":868},[3242],{"type":164,"tag":216,"props":3243,"children":3244},{"style":408},[3245],{"type":169,"value":3246},"    // 去掉模板标志两端的引号，在这个例子里不会用到\n",{"type":164,"tag":216,"props":3248,"children":3249},{"class":218,"line":877},[3250,3254,3258,3262,3266,3270,3274,3278,3282,3286,3290,3294,3298,3302,3306,3310,3314,3318,3322,3326,3330,3334,3338,3342],{"type":164,"tag":216,"props":3251,"children":3252},{"style":314},[3253],{"type":169,"value":3104},{"type":164,"tag":216,"props":3255,"children":3256},{"style":223},[3257],{"type":169,"value":1001},{"type":164,"tag":216,"props":3259,"children":3260},{"style":229},[3261],{"type":169,"value":232},{"type":164,"tag":216,"props":3263,"children":3264},{"style":235},[3265],{"type":169,"value":711},{"type":164,"tag":216,"props":3267,"children":3268},{"style":1143},[3269],{"type":169,"value":1146},{"type":164,"tag":216,"props":3271,"children":3272},{"style":1149},[3273],{"type":169,"value":1152},{"type":164,"tag":216,"props":3275,"children":3276},{"style":590},[3277],{"type":169,"value":1157},{"type":164,"tag":216,"props":3279,"children":3280},{"style":1160},[3281],{"type":169,"value":1163},{"type":164,"tag":216,"props":3283,"children":3284},{"style":1143},[3285],{"type":169,"value":664},{"type":164,"tag":216,"props":3287,"children":3288},{"style":1012},[3289],{"type":169,"value":765},{"type":164,"tag":216,"props":3291,"children":3292},{"style":590},[3293],{"type":169,"value":1152},{"type":164,"tag":216,"props":3295,"children":3296},{"style":714},[3297],{"type":169,"value":1112},{"type":164,"tag":216,"props":3299,"children":3300},{"style":1012},[3301],{"type":169,"value":1024},{"type":164,"tag":216,"props":3303,"children":3304},{"style":590},[3305],{"type":169,"value":1188},{"type":164,"tag":216,"props":3307,"children":3308},{"style":1143},[3309],{"type":169,"value":664},{"type":164,"tag":216,"props":3311,"children":3312},{"style":1160},[3313],{"type":169,"value":1197},{"type":164,"tag":216,"props":3315,"children":3316},{"style":235},[3317],{"type":169,"value":711},{"type":164,"tag":216,"props":3319,"children":3320},{"style":1031},[3321],{"type":169,"value":1034},{"type":164,"tag":216,"props":3323,"children":3324},{"style":314},[3325],{"type":169,"value":317},{"type":164,"tag":216,"props":3327,"children":3328},{"style":235},[3329],{"type":169,"value":1043},{"type":164,"tag":216,"props":3331,"children":3332},{"style":245},[3333],{"type":169,"value":1218},{"type":164,"tag":216,"props":3335,"children":3336},{"style":1109},[3337],{"type":169,"value":1223},{"type":164,"tag":216,"props":3339,"children":3340},{"style":235},[3341],{"type":169,"value":912},{"type":164,"tag":216,"props":3343,"children":3344},{"style":229},[3345],{"type":169,"value":381},{"type":164,"tag":216,"props":3347,"children":3348},{"class":218,"line":896},[3349],{"type":164,"tag":216,"props":3350,"children":3351},{"style":408},[3352],{"type":169,"value":3353},"    // 以下三句最重要，将所有变量推入数组，生成结果形如 `push('xxx',x,'xxx')` 的字符串\n",{"type":164,"tag":216,"props":3355,"children":3356},{"class":218,"line":919},[3357],{"type":164,"tag":216,"props":3358,"children":3359},{"style":408},[3360],{"type":169,"value":3361},"    // 首先，刚才匹配完了 \u003C%，所以 \\t= 开头后边接的就是变量，这里让它转换成 ',x,' 的形式\n",{"type":164,"tag":216,"props":3363,"children":3364},{"class":218,"line":941},[3365,3369,3373,3377,3381,3385,3389,3393,3397,3401,3405,3409,3413,3417,3421,3425,3429,3433],{"type":164,"tag":216,"props":3366,"children":3367},{"style":314},[3368],{"type":169,"value":3104},{"type":164,"tag":216,"props":3370,"children":3371},{"style":223},[3372],{"type":169,"value":1001},{"type":164,"tag":216,"props":3374,"children":3375},{"style":229},[3376],{"type":169,"value":232},{"type":164,"tag":216,"props":3378,"children":3379},{"style":235},[3380],{"type":169,"value":711},{"type":164,"tag":216,"props":3382,"children":3383},{"style":714},[3384],{"type":169,"value":1112},{"type":164,"tag":216,"props":3386,"children":3387},{"style":1160},[3388],{"type":169,"value":1260},{"type":164,"tag":216,"props":3390,"children":3391},{"style":1143},[3392],{"type":169,"value":232},{"type":164,"tag":216,"props":3394,"children":3395},{"style":714},[3396],{"type":169,"value":621},{"type":164,"tag":216,"props":3398,"children":3399},{"style":590},[3400],{"type":169,"value":1273},{"type":164,"tag":216,"props":3402,"children":3403},{"style":1143},[3404],{"type":169,"value":664},{"type":164,"tag":216,"props":3406,"children":3407},{"style":1160},[3408],{"type":169,"value":1163},{"type":164,"tag":216,"props":3410,"children":3411},{"style":235},[3412],{"type":169,"value":711},{"type":164,"tag":216,"props":3414,"children":3415},{"style":1031},[3416],{"type":169,"value":1034},{"type":164,"tag":216,"props":3418,"children":3419},{"style":314},[3420],{"type":169,"value":317},{"type":164,"tag":216,"props":3422,"children":3423},{"style":235},[3424],{"type":169,"value":1043},{"type":164,"tag":216,"props":3426,"children":3427},{"style":245},[3428],{"type":169,"value":1302},{"type":164,"tag":216,"props":3430,"children":3431},{"style":235},[3432],{"type":169,"value":912},{"type":164,"tag":216,"props":3434,"children":3435},{"style":229},[3436],{"type":169,"value":381},{"type":164,"tag":216,"props":3438,"children":3439},{"class":218,"line":950},[3440,3444,3448,3452,3456,3460,3464],{"type":164,"tag":216,"props":3441,"children":3442},{"style":314},[3443],{"type":169,"value":3104},{"type":164,"tag":216,"props":3445,"children":3446},{"style":223},[3447],{"type":169,"value":1064},{"type":164,"tag":216,"props":3449,"children":3450},{"style":229},[3451],{"type":169,"value":232},{"type":164,"tag":216,"props":3453,"children":3454},{"style":235},[3455],{"type":169,"value":912},{"type":164,"tag":216,"props":3457,"children":3458},{"style":1109},[3459],{"type":169,"value":1112},{"type":164,"tag":216,"props":3461,"children":3462},{"style":235},[3463],{"type":169,"value":912},{"type":164,"tag":216,"props":3465,"children":3466},{"style":229},[3467],{"type":169,"value":381},{"type":164,"tag":216,"props":3469,"children":3470},{"class":218,"line":972},[3471],{"type":164,"tag":216,"props":3472,"children":3473},{"style":408},[3474],{"type":169,"value":3475},"    // 在刚刚跟 split('\u003C%') 的位置用括号还原，得到了 ',x,'xxx'); 的形式\n",{"type":164,"tag":216,"props":3477,"children":3478},{"class":218,"line":981},[3479,3483,3487,3491,3495,3499,3503],{"type":164,"tag":216,"props":3480,"children":3481},{"style":314},[3482],{"type":169,"value":3104},{"type":164,"tag":216,"props":3484,"children":3485},{"style":223},[3486],{"type":169,"value":1098},{"type":164,"tag":216,"props":3488,"children":3489},{"style":229},[3490],{"type":169,"value":232},{"type":164,"tag":216,"props":3492,"children":3493},{"style":235},[3494],{"type":169,"value":912},{"type":164,"tag":216,"props":3496,"children":3497},{"style":245},[3498],{"type":169,"value":1367},{"type":164,"tag":216,"props":3500,"children":3501},{"style":235},[3502],{"type":169,"value":912},{"type":164,"tag":216,"props":3504,"children":3505},{"style":229},[3506],{"type":169,"value":381},{"type":164,"tag":216,"props":3508,"children":3509},{"class":218,"line":990},[3510],{"type":164,"tag":216,"props":3511,"children":3512},{"style":408},[3513],{"type":169,"value":3514},"    // 在 \\t=xxx 那次匹配，已经把变量模板对应的结束标志 %> 匹配完了，\n",{"type":164,"tag":216,"props":3516,"children":3517},{"class":218,"line":1054},[3518],{"type":164,"tag":216,"props":3519,"children":3520},{"style":408},[3521],{"type":169,"value":3522},"    // 所以这是处理剩余语句的结束标志，用 split 拆分行后相当于直接把结束标记舍弃了\n",{"type":164,"tag":216,"props":3524,"children":3525},{"class":218,"line":1088},[3526,3530,3534,3538,3542,3546,3550],{"type":164,"tag":216,"props":3527,"children":3528},{"style":314},[3529],{"type":169,"value":3104},{"type":164,"tag":216,"props":3531,"children":3532},{"style":223},[3533],{"type":169,"value":1064},{"type":164,"tag":216,"props":3535,"children":3536},{"style":229},[3537],{"type":169,"value":232},{"type":164,"tag":216,"props":3539,"children":3540},{"style":235},[3541],{"type":169,"value":912},{"type":164,"tag":216,"props":3543,"children":3544},{"style":245},[3545],{"type":169,"value":1163},{"type":164,"tag":216,"props":3547,"children":3548},{"style":235},[3549],{"type":169,"value":912},{"type":164,"tag":216,"props":3551,"children":3552},{"style":229},[3553],{"type":169,"value":381},{"type":164,"tag":216,"props":3555,"children":3556},{"class":218,"line":1123},[3557],{"type":164,"tag":216,"props":3558,"children":3559},{"style":408},[3560],{"type":169,"value":3561},"    // 最终在每行开头增加 push 方法，形成了 push('xxx',x,'xxx'); 的形式\n",{"type":164,"tag":216,"props":3563,"children":3564},{"class":218,"line":1234},[3565,3569,3573,3577,3581,3585,3589],{"type":164,"tag":216,"props":3566,"children":3567},{"style":314},[3568],{"type":169,"value":3104},{"type":164,"tag":216,"props":3570,"children":3571},{"style":223},[3572],{"type":169,"value":1098},{"type":164,"tag":216,"props":3574,"children":3575},{"style":229},[3576],{"type":169,"value":232},{"type":164,"tag":216,"props":3578,"children":3579},{"style":235},[3580],{"type":169,"value":912},{"type":164,"tag":216,"props":3582,"children":3583},{"style":245},[3584],{"type":169,"value":1432},{"type":164,"tag":216,"props":3586,"children":3587},{"style":235},[3588],{"type":169,"value":912},{"type":164,"tag":216,"props":3590,"children":3591},{"style":229},[3592],{"type":169,"value":381},{"type":164,"tag":216,"props":3594,"children":3595},{"class":218,"line":1313},[3596],{"type":164,"tag":216,"props":3597,"children":3598},{"style":408},[3599],{"type":169,"value":3600},"    // 处理剩余的换行符\n",{"type":164,"tag":216,"props":3602,"children":3603},{"class":218,"line":1345},[3604,3608,3612,3616,3620,3624,3628],{"type":164,"tag":216,"props":3605,"children":3606},{"style":314},[3607],{"type":169,"value":3104},{"type":164,"tag":216,"props":3609,"children":3610},{"style":223},[3611],{"type":169,"value":1064},{"type":164,"tag":216,"props":3613,"children":3614},{"style":229},[3615],{"type":169,"value":232},{"type":164,"tag":216,"props":3617,"children":3618},{"style":235},[3619],{"type":169,"value":912},{"type":164,"tag":216,"props":3621,"children":3622},{"style":1109},[3623],{"type":169,"value":1223},{"type":164,"tag":216,"props":3625,"children":3626},{"style":235},[3627],{"type":169,"value":912},{"type":164,"tag":216,"props":3629,"children":3630},{"style":229},[3631],{"type":169,"value":381},{"type":164,"tag":216,"props":3633,"children":3634},{"class":218,"line":1378},[3635,3639,3643,3647,3651,3655,3659,3663,3667],{"type":164,"tag":216,"props":3636,"children":3637},{"style":314},[3638],{"type":169,"value":3104},{"type":164,"tag":216,"props":3640,"children":3641},{"style":223},[3642],{"type":169,"value":1098},{"type":164,"tag":216,"props":3644,"children":3645},{"style":229},[3646],{"type":169,"value":232},{"type":164,"tag":216,"props":3648,"children":3649},{"style":235},[3650],{"type":169,"value":912},{"type":164,"tag":216,"props":3652,"children":3653},{"style":1109},[3654],{"type":169,"value":1497},{"type":164,"tag":216,"props":3656,"children":3657},{"style":245},[3658],{"type":169,"value":1197},{"type":164,"tag":216,"props":3660,"children":3661},{"style":235},[3662],{"type":169,"value":912},{"type":164,"tag":216,"props":3664,"children":3665},{"style":229},[3666],{"type":169,"value":1510},{"type":164,"tag":216,"props":3668,"children":3669},{"style":590},[3670],{"type":169,"value":1515},{"type":164,"tag":216,"props":3672,"children":3673},{"class":218,"line":1410},[3674,3678,3683,3687],{"type":164,"tag":216,"props":3675,"children":3676},{"style":235},[3677],{"type":169,"value":2585},{"type":164,"tag":216,"props":3679,"children":3680},{"style":245},[3681],{"type":169,"value":3682},"');}",{"type":164,"tag":216,"props":3684,"children":3685},{"style":235},[3686],{"type":169,"value":912},{"type":164,"tag":216,"props":3688,"children":3689},{"style":314},[3690],{"type":169,"value":1547},{"type":164,"tag":165,"props":3692,"children":3693},{},[3694,3696,3701,3703,3708,3710,3715,3716,3722,3724,3729,3731,3736],{"type":169,"value":3695},"有一个小细节，字符串替换时，所有逻辑语句的模板标志开头和结尾（",{"type":164,"tag":180,"props":3697,"children":3699},{"className":3698},[],[3700],{"type":169,"value":1077},{"type":169,"value":3702},"、",{"type":164,"tag":180,"props":3704,"children":3706},{"className":3705},[],[3707],{"type":169,"value":1163},{"type":169,"value":3709},"）分别被替换为 ",{"type":164,"tag":180,"props":3711,"children":3713},{"className":3712},[],[3714],{"type":169,"value":1367},{"type":169,"value":3702},{"type":164,"tag":180,"props":3717,"children":3719},{"className":3718},[],[3720],{"type":169,"value":3721},"push('",{"type":169,"value":3723},"，但是开头和结尾的那个标志，并没有对应的匹配。所以在代码中，能看 ",{"type":164,"tag":180,"props":3725,"children":3727},{"className":3726},[],[3728],{"type":169,"value":961},{"type":169,"value":3730}," 和 ",{"type":164,"tag":180,"props":3732,"children":3734},{"className":3733},[],[3735],{"type":169,"value":1367},{"type":169,"value":3737}," 这种手动补全。",{"type":164,"tag":165,"props":3739,"children":3740},{},[3741],{"type":169,"value":3742},"最终生成的字符串如下（已格式化处理）：",{"type":164,"tag":206,"props":3744,"children":3746},{"className":208,"code":3745,"language":210,"meta":158,"style":158},"`with(obj){\n    p.push(''); \n    if (true) { \n        p.push('     \u003Cli>',users[i],'\u003C/li>   '); \n    } \n    p.push('');\n}`;\n",[3747],{"type":164,"tag":180,"props":3748,"children":3749},{"__ignoreMap":158},[3750,3762,3770,3778,3786,3794,3802],{"type":164,"tag":216,"props":3751,"children":3752},{"class":218,"line":219},[3753,3757],{"type":164,"tag":216,"props":3754,"children":3755},{"style":235},[3756],{"type":169,"value":311},{"type":164,"tag":216,"props":3758,"children":3759},{"style":245},[3760],{"type":169,"value":3761},"with(obj){\n",{"type":164,"tag":216,"props":3763,"children":3764},{"class":218,"line":241},[3765],{"type":164,"tag":216,"props":3766,"children":3767},{"style":245},[3768],{"type":169,"value":3769},"    p.push(''); \n",{"type":164,"tag":216,"props":3771,"children":3772},{"class":218,"line":251},[3773],{"type":164,"tag":216,"props":3774,"children":3775},{"style":245},[3776],{"type":169,"value":3777},"    if (true) { \n",{"type":164,"tag":216,"props":3779,"children":3780},{"class":218,"line":260},[3781],{"type":164,"tag":216,"props":3782,"children":3783},{"style":245},[3784],{"type":169,"value":3785},"        p.push('     \u003Cli>',users[i],'\u003C/li>   '); \n",{"type":164,"tag":216,"props":3787,"children":3788},{"class":218,"line":269},[3789],{"type":164,"tag":216,"props":3790,"children":3791},{"style":245},[3792],{"type":169,"value":3793},"    } \n",{"type":164,"tag":216,"props":3795,"children":3796},{"class":218,"line":278},[3797],{"type":164,"tag":216,"props":3798,"children":3799},{"style":245},[3800],{"type":169,"value":3801},"    p.push('');\n",{"type":164,"tag":216,"props":3803,"children":3804},{"class":218,"line":287},[3805,3809,3813],{"type":164,"tag":216,"props":3806,"children":3807},{"style":245},[3808],{"type":169,"value":376},{"type":164,"tag":216,"props":3810,"children":3811},{"style":235},[3812],{"type":169,"value":311},{"type":164,"tag":216,"props":3814,"children":3815},{"style":314},[3816],{"type":169,"value":1547},{"type":164,"tag":165,"props":3818,"children":3819},{},[3820,3822,3828],{"type":169,"value":3821},"为什么 with 语句里有一行空的 ",{"type":164,"tag":180,"props":3823,"children":3825},{"className":3824},[],[3826],{"type":169,"value":3827},"push('')",{"type":169,"value":3829}," 呢？",{"type":164,"tag":165,"props":3831,"children":3832},{},[3833],{"type":169,"value":3834},"还记得原始的模板吗？一开的模板是以“\u003C%”开头的，而“\u003C%”在替换过程被右括号取代了，此时正好和初始字符串结合形成了空 push。如果原始字符串开头是 \"123\u003C% if (true)\"，那这行空 push 会转换成“p.push('123');”，也是正确的代码。",{"type":164,"tag":165,"props":3836,"children":3837},{},[3838],{"type":169,"value":3839},"最后，micro-templating 需要返回这个新函数。如果不传参数 data 给模板函数，则会返回一个部分应用的函数等待用户输入 data 参数再执行模板解析；如果已经传了 data 那就会立即调用返回模板解析的结果。",{"type":164,"tag":206,"props":3841,"children":3843},{"className":208,"code":3842,"language":210,"meta":158,"style":158},"(function () {\n  var cache = {};\n  this.tmpl = function tmpl(str, data) {\n    return data ? fn(data) : fn;\n  };\n})();\n",[3844],{"type":164,"tag":180,"props":3845,"children":3846},{"__ignoreMap":158},[3847,3866,3885,3936,3979,3986],{"type":164,"tag":216,"props":3848,"children":3849},{"class":218,"line":219},[3850,3854,3858,3862],{"type":164,"tag":216,"props":3851,"children":3852},{"style":229},[3853],{"type":169,"value":232},{"type":164,"tag":216,"props":3855,"children":3856},{"style":562},[3857],{"type":169,"value":565},{"type":164,"tag":216,"props":3859,"children":3860},{"style":314},[3861],{"type":169,"value":570},{"type":164,"tag":216,"props":3863,"children":3864},{"style":314},[3865],{"type":169,"value":322},{"type":164,"tag":216,"props":3867,"children":3868},{"class":218,"line":241},[3869,3873,3877,3881],{"type":164,"tag":216,"props":3870,"children":3871},{"style":562},[3872],{"type":169,"value":582},{"type":164,"tag":216,"props":3874,"children":3875},{"style":229},[3876],{"type":169,"value":587},{"type":164,"tag":216,"props":3878,"children":3879},{"style":590},[3880],{"type":169,"value":593},{"type":164,"tag":216,"props":3882,"children":3883},{"style":314},[3884],{"type":169,"value":598},{"type":164,"tag":216,"props":3886,"children":3887},{"class":218,"line":251},[3888,3892,3896,3900,3904,3908,3912,3916,3920,3924,3928,3932],{"type":164,"tag":216,"props":3889,"children":3890},{"style":613},[3891],{"type":169,"value":616},{"type":164,"tag":216,"props":3893,"children":3894},{"style":314},[3895],{"type":169,"value":621},{"type":164,"tag":216,"props":3897,"children":3898},{"style":223},[3899],{"type":169,"value":626},{"type":164,"tag":216,"props":3901,"children":3902},{"style":590},[3903],{"type":169,"value":593},{"type":164,"tag":216,"props":3905,"children":3906},{"style":562},[3907],{"type":169,"value":635},{"type":164,"tag":216,"props":3909,"children":3910},{"style":223},[3911],{"type":169,"value":640},{"type":164,"tag":216,"props":3913,"children":3914},{"style":314},[3915],{"type":169,"value":232},{"type":164,"tag":216,"props":3917,"children":3918},{"style":647},[3919],{"type":169,"value":650},{"type":164,"tag":216,"props":3921,"children":3922},{"style":314},[3923],{"type":169,"value":317},{"type":164,"tag":216,"props":3925,"children":3926},{"style":647},[3927],{"type":169,"value":659},{"type":164,"tag":216,"props":3929,"children":3930},{"style":314},[3931],{"type":169,"value":664},{"type":164,"tag":216,"props":3933,"children":3934},{"style":314},[3935],{"type":169,"value":322},{"type":164,"tag":216,"props":3937,"children":3938},{"class":218,"line":260},[3939,3943,3947,3951,3955,3959,3963,3967,3971,3975],{"type":164,"tag":216,"props":3940,"children":3941},{"style":1149},[3942],{"type":169,"value":1573},{"type":164,"tag":216,"props":3944,"children":3945},{"style":229},[3946],{"type":169,"value":659},{"type":164,"tag":216,"props":3948,"children":3949},{"style":590},[3950],{"type":169,"value":1582},{"type":164,"tag":216,"props":3952,"children":3953},{"style":223},[3954],{"type":169,"value":697},{"type":164,"tag":216,"props":3956,"children":3957},{"style":329},[3958],{"type":169,"value":232},{"type":164,"tag":216,"props":3960,"children":3961},{"style":229},[3962],{"type":169,"value":1595},{"type":164,"tag":216,"props":3964,"children":3965},{"style":329},[3966],{"type":169,"value":1510},{"type":164,"tag":216,"props":3968,"children":3969},{"style":590},[3970],{"type":169,"value":337},{"type":164,"tag":216,"props":3972,"children":3973},{"style":229},[3974],{"type":169,"value":697},{"type":164,"tag":216,"props":3976,"children":3977},{"style":314},[3978],{"type":169,"value":1547},{"type":164,"tag":216,"props":3980,"children":3981},{"class":218,"line":269},[3982],{"type":164,"tag":216,"props":3983,"children":3984},{"style":314},[3985],{"type":169,"value":1620},{"type":164,"tag":216,"props":3987,"children":3988},{"class":218,"line":278},[3989,3993,3997],{"type":164,"tag":216,"props":3990,"children":3991},{"style":314},[3992],{"type":169,"value":376},{"type":164,"tag":216,"props":3994,"children":3995},{"style":229},[3996],{"type":169,"value":1633},{"type":164,"tag":216,"props":3998,"children":3999},{"style":314},[4000],{"type":169,"value":1547},{"type":164,"tag":165,"props":4002,"children":4003},{},[4004],{"type":169,"value":4005},"终于结束了！这个函数不长，但一口气看下来还是蛮费力气的。如果一遍写测试用例以便看代码，很快能把这个函数跑通，如果你是纯靠脑力跑，还没被那个长长的字符串替换链给吓住，在此我赐你称号：“Micro Templating 人肉编译器 - 十五周年限定版”。",{"type":164,"tag":165,"props":4007,"children":4008},{},[4009,4011,4018,4020,4025],{"type":169,"value":4010},"额外提一句，Function 构造器和 eval 函数比，除了能传参数意外，还有一些细节不同，比如说声明变量的作用域不同，这个需要注意。这个编译器没有错误处理等代码完善，因此不可以上生产。此外，由于 ",{"type":164,"tag":172,"props":4012,"children":4016},{"href":4013,"rel":4014},"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/with",[4015],"nofollow",[4017],{"type":169,"value":2689},{"type":169,"value":4019}," 语句非常容易出错，且不利于静态优化，不应该在业务函数里使用",{"type":164,"tag":216,"props":4021,"children":4022},{},[4023],{"type":169,"value":4024},"^with-mdn",{"type":169,"value":4026},"。最后，阅读源码需要技巧，这几点希望能帮助到你：",{"type":164,"tag":2863,"props":4028,"children":4029},{},[4030,4035,4040,4045],{"type":164,"tag":2867,"props":4031,"children":4032},{},[4033],{"type":169,"value":4034},"从注释、测试用例，先搞清楚要看的代码的作用",{"type":164,"tag":2867,"props":4036,"children":4037},{},[4038],{"type":169,"value":4039},"使用编辑器的折叠代码，一次只看一部分源码",{"type":164,"tag":2867,"props":4041,"children":4042},{},[4043],{"type":169,"value":4044},"在 Git 提交记录中搜索，从简单的版本看起",{"type":164,"tag":2867,"props":4046,"children":4047},{},[4048],{"type":169,"value":4049},"复杂代码应该从高层结构看起，比如使用 IDE 各种插件或是 Madge 等代码分析工具",{"type":164,"tag":520,"props":4051,"children":4053},{"id":4052},"相关链接",[4054],{"type":169,"value":4052},{"type":164,"tag":2863,"props":4056,"children":4057},{},[4058],{"type":164,"tag":2867,"props":4059,"children":4060},{},[4061],{"type":164,"tag":172,"props":4062,"children":4065},{"href":4063,"rel":4064},"https://johnresig.com/blog/javascript-micro-templating/",[4015],[4066],{"type":169,"value":4067},"JavaScript Micro-Templating",{"type":164,"tag":4069,"props":4070,"children":4071},"style",{},[4072],{"type":169,"value":4073},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":158,"searchDepth":241,"depth":241,"links":4075},[4076,4077,4078],{"id":522,"depth":241,"text":522},{"id":1645,"depth":241,"text":1645},{"id":4052,"depth":241,"text":4052},"markdown","content:2.articles:1100.micro-templating.md","content","2.articles/1100.micro-templating.md","2.articles/1100.micro-templating","md",[4086,4088],{"_path":46,"title":45,"description":4087},"沉浸式翻译太贵辽，试试本地部署 LLM 用来翻译网页的可行性。",{"_path":52,"title":51,"description":4089},"我的项目使用 micro-app 框架作为微前端框架。使用 micro-app 时，由于开启了样式隔离功能，子应用加载的 CSS 会被解析器解析，在选择器前增加一个子应用属性选择器前缀。我碰到的问题是，如果 CSS 源码中带嵌套语法那么解析就会失败。今天借这个问题给大家简单介绍一下 CSS Parser 的基本流程。",1742745231665]