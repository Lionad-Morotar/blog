[{"data":1,"prerenderedAt":4096},["ShallowReactive",2],{"navigation":3,"/articles/micro-templating":161,"/articles/micro-templating-surround":4091},[4,35,92,98,125,131,155],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29,32],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🚝 四十二篇系列","/flows/fourty-two",{"title":15,"_path":16},"🌃 长夜梦","/flows/long-night-dream",{"title":18,"_path":19},"🌌 万物联结与幸福感","/flows/everything",{"title":21,"_path":22},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":24,"_path":25},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":27,"_path":28},"🌧️ 我的腼腆","/flows/shy",{"title":30,"_path":31},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":33,"_path":34},"📝 心流归档","/flows/archive",{"title":36,"_path":37,"children":38},"技术博客 / Coder","/articles",[39,41,44,47,50,53,56,59,62,65,68,71,74,77,80,83,86,89],{"title":40,"_path":37},"🦁 欢迎",{"title":42,"_path":43},"🖌️ Blockies Animation","/maps/_fe-framework/motion/blockies-animation",{"title":45,"_path":46},"🌪️ Tailwind v4 如何兼容预处理器","/articles/tailwind4-with-sass",{"title":48,"_path":49},"🥞 在 tailwind 中使用现代化 CSS Layers","/articles/tailwind-sass-and-css-layer",{"title":51,"_path":52},"💻 本地部署 Qwen 翻译网页","/articles/local-translator",{"title":54,"_path":55},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":57,"_path":58},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":60,"_path":61},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":63,"_path":64},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":66,"_path":67},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":69,"_path":70},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":72,"_path":73},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":75,"_path":76},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":78,"_path":79},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":81,"_path":82},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":84,"_path":85},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":87,"_path":88},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":90,"_path":91},"📝 技术博客归档","/articles/archive",{"title":93,"_path":94,"children":95},"读书笔记 / Notes","/books",[96],{"title":97,"_path":94},"📕 读书笔记",{"title":99,"_path":100,"children":101},"吉他剧场 / Music","/music",[102,104,107,110,113,116,119,122],{"title":103,"_path":100},"🎸 FingerStyle！",{"title":105,"_path":106},"🌬️ 等待的风","/music/wind",{"title":108,"_path":109},"💕 约定的海洋","/music/ocean",{"title":111,"_path":112},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":114,"_path":115},"🌏 残酷天使的行动纲领","/music/eva",{"title":117,"_path":118},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":120,"_path":121},"🍷 Wu Wei","/music/wu-wei",{"title":123,"_path":124},"🌅 无题","/music/untitled",{"title":126,"_path":127,"children":128},"知识地图 / Maps","/maps",[129],{"title":130,"_path":127},"🏁 知识地图",{"title":132,"_path":133,"children":134},"造物 / Make","/tools",[135,137,140,143,146,149,152],{"title":136,"_path":133},"🧰 工具收集",{"title":138,"_path":139},"📕 博客","/tools/blog",{"title":141,"_path":142},"🥥 Coconut","/tools/coconut",{"title":144,"_path":145},"🧶 网易云音乐歌单排序","/tools/netease-sorter",{"title":147,"_path":148},"🌐 AnySort","/tools/anysort",{"title":150,"_path":151},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":153,"_path":154},"👓 Crapto","/tools/crypto-inline",{"title":156,"_path":157,"children":158},"我 / About","/hire",[159],{"title":160,"_path":157},"📬 技术简历",{"_path":55,"_dir":162,"_draft":163,"_partial":163,"_locale":164,"title":54,"description":165,"body":166,"_type":4085,"_id":4086,"_source":4087,"_file":4088,"_stem":4089,"_extension":4090},"articles",false,"","忍者秘籍中提到的模板解析器，很短但支持变量和 if 等语句，还是 15 年前的代码！",{"type":167,"children":168,"toc":4080},"root",[169,194,206,211,388,400,520,525,531,536,1644,1649,1654,1659,1770,1783,2244,2550,2561,2660,2673,2844,2849,2868,2907,2912,2979,2984,3037,3697,3744,3749,3823,3836,3841,3846,4007,4012,4033,4056,4061,4074],{"type":170,"tag":171,"props":172,"children":173},"element","p",{},[174,177,183,185,192],{"type":175,"value":176},"text","上回我借着解决 CSS 嵌套解析问题聊到 micro-app 中实现的一个非常精简的 ",{"type":170,"tag":178,"props":179,"children":180},"a",{"href":58},[181],{"type":175,"value":182},"CSS 解析器",{"type":175,"value":184},"，还没过瘾。今天整理笔记的时候发现了角落里的这个模板解析器，那就赶紧擦擦灰尘拉出来聊一聊。这个模板解析器可是有年头了，它是 John Resig 佬 2008 年写的，叫 ",{"type":170,"tag":186,"props":187,"children":189},"code",{"className":188},[],[190],{"type":175,"value":191},"micro-templating",{"type":175,"value":193},"，距今十五年哩。（John Resig 就是写《JavaScript 忍者秘籍》那位）",{"type":170,"tag":171,"props":195,"children":196},{},[197,199,204],{"type":175,"value":198},"令人惊叹的地方是，",{"type":170,"tag":186,"props":200,"children":202},{"className":201},[],[203],{"type":175,"value":191},{"type":175,"value":205}," 的代码和它的名字一样 micro，它能用仅仅 30 行代码完成对模板的处理，并且还有读取 html 模板、缓存、柯里化等额外的高级功能！",{"type":170,"tag":171,"props":207,"children":208},{},[209],{"type":175,"value":210},"可能有些佬没接触过模板解析器，这里给出一个简单的示例。",{"type":170,"tag":212,"props":213,"children":217},"pre",{"className":214,"code":215,"language":216,"meta":164,"style":164},"language-js shiki shiki-themes material-theme-lighter github-light github-dark monokai","parse(`\n  \u003C% if (shouldCount) { %>\n    \u003C% for (var i = 1; i \u003C= 3; i++) { %>\n      \u003Cdiv>hello - \u003C%= i + count %>\u003C/div>\n    \u003C% } %>\n  \u003C% } else { %>\n    \u003Cdiv>noop\u003C/div>\n  \u003C% } %>\n`, {\n  shouldCount: true,\n  count: 1\n})\n","js",[218],{"type":170,"tag":186,"props":219,"children":220},{"__ignoreMap":164},[221,245,255,264,273,282,291,300,309,329,355,374],{"type":170,"tag":222,"props":223,"children":226},"span",{"class":224,"line":225},"line",1,[227,233,239],{"type":170,"tag":222,"props":228,"children":230},{"style":229},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[231],{"type":175,"value":232},"parse",{"type":170,"tag":222,"props":234,"children":236},{"style":235},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[237],{"type":175,"value":238},"(",{"type":170,"tag":222,"props":240,"children":242},{"style":241},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[243],{"type":175,"value":244},"`\n",{"type":170,"tag":222,"props":246,"children":248},{"class":224,"line":247},2,[249],{"type":170,"tag":222,"props":250,"children":252},{"style":251},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[253],{"type":175,"value":254},"  \u003C% if (shouldCount) { %>\n",{"type":170,"tag":222,"props":256,"children":258},{"class":224,"line":257},3,[259],{"type":170,"tag":222,"props":260,"children":261},{"style":251},[262],{"type":175,"value":263},"    \u003C% for (var i = 1; i \u003C= 3; i++) { %>\n",{"type":170,"tag":222,"props":265,"children":267},{"class":224,"line":266},4,[268],{"type":170,"tag":222,"props":269,"children":270},{"style":251},[271],{"type":175,"value":272},"      \u003Cdiv>hello - \u003C%= i + count %>\u003C/div>\n",{"type":170,"tag":222,"props":274,"children":276},{"class":224,"line":275},5,[277],{"type":170,"tag":222,"props":278,"children":279},{"style":251},[280],{"type":175,"value":281},"    \u003C% } %>\n",{"type":170,"tag":222,"props":283,"children":285},{"class":224,"line":284},6,[286],{"type":170,"tag":222,"props":287,"children":288},{"style":251},[289],{"type":175,"value":290},"  \u003C% } else { %>\n",{"type":170,"tag":222,"props":292,"children":294},{"class":224,"line":293},7,[295],{"type":170,"tag":222,"props":296,"children":297},{"style":251},[298],{"type":175,"value":299},"    \u003Cdiv>noop\u003C/div>\n",{"type":170,"tag":222,"props":301,"children":303},{"class":224,"line":302},8,[304],{"type":170,"tag":222,"props":305,"children":306},{"style":251},[307],{"type":175,"value":308},"  \u003C% } %>\n",{"type":170,"tag":222,"props":310,"children":312},{"class":224,"line":311},9,[313,318,324],{"type":170,"tag":222,"props":314,"children":315},{"style":241},[316],{"type":175,"value":317},"`",{"type":170,"tag":222,"props":319,"children":321},{"style":320},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[322],{"type":175,"value":323},",",{"type":170,"tag":222,"props":325,"children":326},{"style":320},[327],{"type":175,"value":328}," {\n",{"type":170,"tag":222,"props":330,"children":332},{"class":224,"line":331},10,[333,339,344,350],{"type":170,"tag":222,"props":334,"children":336},{"style":335},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[337],{"type":175,"value":338},"  shouldCount",{"type":170,"tag":222,"props":340,"children":341},{"style":320},[342],{"type":175,"value":343},":",{"type":170,"tag":222,"props":345,"children":347},{"style":346},"--shiki-light:#FF5370;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[348],{"type":175,"value":349}," true",{"type":170,"tag":222,"props":351,"children":352},{"style":320},[353],{"type":175,"value":354},",\n",{"type":170,"tag":222,"props":356,"children":358},{"class":224,"line":357},11,[359,364,368],{"type":170,"tag":222,"props":360,"children":361},{"style":335},[362],{"type":175,"value":363},"  count",{"type":170,"tag":222,"props":365,"children":366},{"style":320},[367],{"type":175,"value":343},{"type":170,"tag":222,"props":369,"children":371},{"style":370},"--shiki-light:#F76D47;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[372],{"type":175,"value":373}," 1\n",{"type":170,"tag":222,"props":375,"children":377},{"class":224,"line":376},12,[378,383],{"type":170,"tag":222,"props":379,"children":380},{"style":320},[381],{"type":175,"value":382},"}",{"type":170,"tag":222,"props":384,"children":385},{"style":235},[386],{"type":175,"value":387},")\n",{"type":170,"tag":171,"props":389,"children":390},{},[391,393,398],{"type":175,"value":392},"给 ",{"type":170,"tag":186,"props":394,"children":396},{"className":395},[],[397],{"type":175,"value":232},{"type":175,"value":399}," 函数传入模板字符串和数据后，自然也是输出字符串啦：",{"type":170,"tag":212,"props":401,"children":405},{"className":402,"code":403,"language":404,"meta":164,"style":164},"language-html shiki shiki-themes material-theme-lighter github-light github-dark monokai","\u003C!-- 以下经过格式化 -->\n\u003Cdiv>hello - 2\u003C/div>\n\u003Cdiv>hello - 3\u003C/div>\n\u003Cdiv>hello - 4\u003C/div>\n","html",[406],{"type":170,"tag":186,"props":407,"children":408},{"__ignoreMap":164},[409,418,456,488],{"type":170,"tag":222,"props":410,"children":411},{"class":224,"line":225},[412],{"type":170,"tag":222,"props":413,"children":415},{"style":414},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit",[416],{"type":175,"value":417},"\u003C!-- 以下经过格式化 -->\n",{"type":170,"tag":222,"props":419,"children":420},{"class":224,"line":247},[421,426,432,437,442,447,451],{"type":170,"tag":222,"props":422,"children":423},{"style":320},[424],{"type":175,"value":425},"\u003C",{"type":170,"tag":222,"props":427,"children":429},{"style":428},"--shiki-light:#E53935;--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672",[430],{"type":175,"value":431},"div",{"type":170,"tag":222,"props":433,"children":434},{"style":320},[435],{"type":175,"value":436},">",{"type":170,"tag":222,"props":438,"children":439},{"style":235},[440],{"type":175,"value":441},"hello - 2",{"type":170,"tag":222,"props":443,"children":444},{"style":320},[445],{"type":175,"value":446},"\u003C/",{"type":170,"tag":222,"props":448,"children":449},{"style":428},[450],{"type":175,"value":431},{"type":170,"tag":222,"props":452,"children":453},{"style":320},[454],{"type":175,"value":455},">\n",{"type":170,"tag":222,"props":457,"children":458},{"class":224,"line":257},[459,463,467,471,476,480,484],{"type":170,"tag":222,"props":460,"children":461},{"style":320},[462],{"type":175,"value":425},{"type":170,"tag":222,"props":464,"children":465},{"style":428},[466],{"type":175,"value":431},{"type":170,"tag":222,"props":468,"children":469},{"style":320},[470],{"type":175,"value":436},{"type":170,"tag":222,"props":472,"children":473},{"style":235},[474],{"type":175,"value":475},"hello - 3",{"type":170,"tag":222,"props":477,"children":478},{"style":320},[479],{"type":175,"value":446},{"type":170,"tag":222,"props":481,"children":482},{"style":428},[483],{"type":175,"value":431},{"type":170,"tag":222,"props":485,"children":486},{"style":320},[487],{"type":175,"value":455},{"type":170,"tag":222,"props":489,"children":490},{"class":224,"line":266},[491,495,499,503,508,512,516],{"type":170,"tag":222,"props":492,"children":493},{"style":320},[494],{"type":175,"value":425},{"type":170,"tag":222,"props":496,"children":497},{"style":428},[498],{"type":175,"value":431},{"type":170,"tag":222,"props":500,"children":501},{"style":320},[502],{"type":175,"value":436},{"type":170,"tag":222,"props":504,"children":505},{"style":235},[506],{"type":175,"value":507},"hello - 4",{"type":170,"tag":222,"props":509,"children":510},{"style":320},[511],{"type":175,"value":446},{"type":170,"tag":222,"props":513,"children":514},{"style":428},[515],{"type":175,"value":431},{"type":170,"tag":222,"props":517,"children":518},{"style":320},[519],{"type":175,"value":455},{"type":170,"tag":171,"props":521,"children":522},{},[523],{"type":175,"value":524},"相比生态里现在动则 30kb 甚至 300kb 的库，仅 30 行代码完成这个功能，简直不可思议。",{"type":170,"tag":526,"props":527,"children":529},"h2",{"id":528},"完整实现",[530],{"type":175,"value":528},{"type":170,"tag":171,"props":532,"children":533},{},[534],{"type":175,"value":535},"因为代码真的非常短，先直接看一遍，这是带注释版本的。如果你能在第一遍 review 这段代码后脑袋还保持清醒的话，留下评论，我拜你为大哥。",{"type":170,"tag":212,"props":537,"children":539},{"className":214,"code":538,"language":216,"meta":164,"style":164},"// Simple JavaScript Templating\n// John Resig - https://johnresig.com/ - MIT Licensed\n(function () {\n  var cache = {};\n\n  this.tmpl = function tmpl(str, data) {\n    // Figure out if we're getting a template, or if we need to\n    // load the template - and be sure to cache the result.\n    var fn = !/\\W/.test(str)\n      ? (cache[str] =\n          cache[str] || tmpl(document.getElementById(str).innerHTML))\n      : // Generate a reusable function that will serve as a template\n        // generator (and which will be cached).\n        new Function(\n          \"obj\",\n          \"var p=[],print=function(){p.push.apply(p,arguments);};\" +\n            // Introduce the data as local variables using with(){}\n            \"with(obj){p.push('\" +\n            // Convert the template into pure JavaScript\n            str\n              .replace(/[\\r\\t\\n]/g, \" \")\n              .split(\"\u003C%\")\n              .join(\"\\t\")\n              .replace(/((^|%>)[^\\t]*)'/g, \"$1\\r\")\n              .replace(/\\t=(.*?)%>/g, \"',$1,'\")\n              .split(\"\\t\")\n              .join(\"');\")\n              .split(\"%>\")\n              .join(\"p.push('\")\n              .split(\"\\r\")\n              .join(\"\\\\'\") +\n            \"');}return p.join('');\"\n        );\n\n    // Provide some basic currying to the user\n    return data ? fn(data) : fn;\n  };\n})();\n",[540],{"type":170,"tag":186,"props":541,"children":542},{"__ignoreMap":164},[543,551,559,581,605,614,675,683,691,749,786,859,872,881,900,923,945,954,976,985,994,1058,1092,1127,1238,1317,1349,1382,1414,1447,1479,1522,1540,1554,1562,1571,1618,1627],{"type":170,"tag":222,"props":544,"children":545},{"class":224,"line":225},[546],{"type":170,"tag":222,"props":547,"children":548},{"style":414},[549],{"type":175,"value":550},"// Simple JavaScript Templating\n",{"type":170,"tag":222,"props":552,"children":553},{"class":224,"line":247},[554],{"type":170,"tag":222,"props":555,"children":556},{"style":414},[557],{"type":175,"value":558},"// John Resig - https://johnresig.com/ - MIT Licensed\n",{"type":170,"tag":222,"props":560,"children":561},{"class":224,"line":257},[562,566,572,577],{"type":170,"tag":222,"props":563,"children":564},{"style":235},[565],{"type":175,"value":238},{"type":170,"tag":222,"props":567,"children":569},{"style":568},"--shiki-light:#9C3EDA;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic",[570],{"type":175,"value":571},"function",{"type":170,"tag":222,"props":573,"children":574},{"style":320},[575],{"type":175,"value":576}," ()",{"type":170,"tag":222,"props":578,"children":579},{"style":320},[580],{"type":175,"value":328},{"type":170,"tag":222,"props":582,"children":583},{"class":224,"line":266},[584,589,594,600],{"type":170,"tag":222,"props":585,"children":586},{"style":568},[587],{"type":175,"value":588},"  var",{"type":170,"tag":222,"props":590,"children":591},{"style":235},[592],{"type":175,"value":593}," cache",{"type":170,"tag":222,"props":595,"children":597},{"style":596},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[598],{"type":175,"value":599}," =",{"type":170,"tag":222,"props":601,"children":602},{"style":320},[603],{"type":175,"value":604}," {};\n",{"type":170,"tag":222,"props":606,"children":607},{"class":224,"line":275},[608],{"type":170,"tag":222,"props":609,"children":611},{"emptyLinePlaceholder":610},true,[612],{"type":175,"value":613},"\n",{"type":170,"tag":222,"props":615,"children":616},{"class":224,"line":284},[617,623,628,633,637,642,647,651,657,661,666,671],{"type":170,"tag":222,"props":618,"children":620},{"style":619},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[621],{"type":175,"value":622},"  this",{"type":170,"tag":222,"props":624,"children":625},{"style":320},[626],{"type":175,"value":627},".",{"type":170,"tag":222,"props":629,"children":630},{"style":229},[631],{"type":175,"value":632},"tmpl",{"type":170,"tag":222,"props":634,"children":635},{"style":596},[636],{"type":175,"value":599},{"type":170,"tag":222,"props":638,"children":639},{"style":568},[640],{"type":175,"value":641}," function",{"type":170,"tag":222,"props":643,"children":644},{"style":229},[645],{"type":175,"value":646}," tmpl",{"type":170,"tag":222,"props":648,"children":649},{"style":320},[650],{"type":175,"value":238},{"type":170,"tag":222,"props":652,"children":654},{"style":653},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#E36209;--shiki-default-font-style:inherit;--shiki-dark:#FFAB70;--shiki-dark-font-style:inherit;--shiki-sepia:#FD971F;--shiki-sepia-font-style:italic",[655],{"type":175,"value":656},"str",{"type":170,"tag":222,"props":658,"children":659},{"style":320},[660],{"type":175,"value":323},{"type":170,"tag":222,"props":662,"children":663},{"style":653},[664],{"type":175,"value":665}," data",{"type":170,"tag":222,"props":667,"children":668},{"style":320},[669],{"type":175,"value":670},")",{"type":170,"tag":222,"props":672,"children":673},{"style":320},[674],{"type":175,"value":328},{"type":170,"tag":222,"props":676,"children":677},{"class":224,"line":293},[678],{"type":170,"tag":222,"props":679,"children":680},{"style":414},[681],{"type":175,"value":682},"    // Figure out if we're getting a template, or if we need to\n",{"type":170,"tag":222,"props":684,"children":685},{"class":224,"line":302},[686],{"type":170,"tag":222,"props":687,"children":688},{"style":414},[689],{"type":175,"value":690},"    // load the template - and be sure to cache the result.\n",{"type":170,"tag":222,"props":692,"children":693},{"class":224,"line":311},[694,699,704,708,713,718,724,728,732,737,741,745],{"type":170,"tag":222,"props":695,"children":696},{"style":568},[697],{"type":175,"value":698},"    var",{"type":170,"tag":222,"props":700,"children":701},{"style":235},[702],{"type":175,"value":703}," fn",{"type":170,"tag":222,"props":705,"children":706},{"style":596},[707],{"type":175,"value":599},{"type":170,"tag":222,"props":709,"children":710},{"style":596},[711],{"type":175,"value":712}," !",{"type":170,"tag":222,"props":714,"children":715},{"style":241},[716],{"type":175,"value":717},"/",{"type":170,"tag":222,"props":719,"children":721},{"style":720},"--shiki-light:#91B859;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[722],{"type":175,"value":723},"\\W",{"type":170,"tag":222,"props":725,"children":726},{"style":241},[727],{"type":175,"value":717},{"type":170,"tag":222,"props":729,"children":730},{"style":320},[731],{"type":175,"value":627},{"type":170,"tag":222,"props":733,"children":734},{"style":229},[735],{"type":175,"value":736},"test",{"type":170,"tag":222,"props":738,"children":739},{"style":335},[740],{"type":175,"value":238},{"type":170,"tag":222,"props":742,"children":743},{"style":235},[744],{"type":175,"value":656},{"type":170,"tag":222,"props":746,"children":747},{"style":335},[748],{"type":175,"value":387},{"type":170,"tag":222,"props":750,"children":751},{"class":224,"line":331},[752,757,762,767,772,776,781],{"type":170,"tag":222,"props":753,"children":754},{"style":596},[755],{"type":175,"value":756},"      ?",{"type":170,"tag":222,"props":758,"children":759},{"style":335},[760],{"type":175,"value":761}," (",{"type":170,"tag":222,"props":763,"children":764},{"style":235},[765],{"type":175,"value":766},"cache",{"type":170,"tag":222,"props":768,"children":769},{"style":335},[770],{"type":175,"value":771},"[",{"type":170,"tag":222,"props":773,"children":774},{"style":235},[775],{"type":175,"value":656},{"type":170,"tag":222,"props":777,"children":778},{"style":335},[779],{"type":175,"value":780},"] ",{"type":170,"tag":222,"props":782,"children":783},{"style":596},[784],{"type":175,"value":785},"=\n",{"type":170,"tag":222,"props":787,"children":788},{"class":224,"line":357},[789,794,798,802,806,811,815,819,824,828,833,837,841,845,849,854],{"type":170,"tag":222,"props":790,"children":791},{"style":235},[792],{"type":175,"value":793},"          cache",{"type":170,"tag":222,"props":795,"children":796},{"style":335},[797],{"type":175,"value":771},{"type":170,"tag":222,"props":799,"children":800},{"style":235},[801],{"type":175,"value":656},{"type":170,"tag":222,"props":803,"children":804},{"style":335},[805],{"type":175,"value":780},{"type":170,"tag":222,"props":807,"children":808},{"style":596},[809],{"type":175,"value":810},"||",{"type":170,"tag":222,"props":812,"children":813},{"style":229},[814],{"type":175,"value":646},{"type":170,"tag":222,"props":816,"children":817},{"style":335},[818],{"type":175,"value":238},{"type":170,"tag":222,"props":820,"children":821},{"style":235},[822],{"type":175,"value":823},"document",{"type":170,"tag":222,"props":825,"children":826},{"style":320},[827],{"type":175,"value":627},{"type":170,"tag":222,"props":829,"children":830},{"style":229},[831],{"type":175,"value":832},"getElementById",{"type":170,"tag":222,"props":834,"children":835},{"style":335},[836],{"type":175,"value":238},{"type":170,"tag":222,"props":838,"children":839},{"style":235},[840],{"type":175,"value":656},{"type":170,"tag":222,"props":842,"children":843},{"style":335},[844],{"type":175,"value":670},{"type":170,"tag":222,"props":846,"children":847},{"style":320},[848],{"type":175,"value":627},{"type":170,"tag":222,"props":850,"children":851},{"style":235},[852],{"type":175,"value":853},"innerHTML",{"type":170,"tag":222,"props":855,"children":856},{"style":335},[857],{"type":175,"value":858},"))\n",{"type":170,"tag":222,"props":860,"children":861},{"class":224,"line":376},[862,867],{"type":170,"tag":222,"props":863,"children":864},{"style":596},[865],{"type":175,"value":866},"      :",{"type":170,"tag":222,"props":868,"children":869},{"style":414},[870],{"type":175,"value":871}," // Generate a reusable function that will serve as a template\n",{"type":170,"tag":222,"props":873,"children":875},{"class":224,"line":874},13,[876],{"type":170,"tag":222,"props":877,"children":878},{"style":414},[879],{"type":175,"value":880},"        // generator (and which will be cached).\n",{"type":170,"tag":222,"props":882,"children":884},{"class":224,"line":883},14,[885,890,895],{"type":170,"tag":222,"props":886,"children":887},{"style":596},[888],{"type":175,"value":889},"        new",{"type":170,"tag":222,"props":891,"children":892},{"style":229},[893],{"type":175,"value":894}," Function",{"type":170,"tag":222,"props":896,"children":897},{"style":335},[898],{"type":175,"value":899},"(\n",{"type":170,"tag":222,"props":901,"children":903},{"class":224,"line":902},15,[904,909,914,919],{"type":170,"tag":222,"props":905,"children":906},{"style":241},[907],{"type":175,"value":908},"          \"",{"type":170,"tag":222,"props":910,"children":911},{"style":251},[912],{"type":175,"value":913},"obj",{"type":170,"tag":222,"props":915,"children":916},{"style":241},[917],{"type":175,"value":918},"\"",{"type":170,"tag":222,"props":920,"children":921},{"style":320},[922],{"type":175,"value":354},{"type":170,"tag":222,"props":924,"children":926},{"class":224,"line":925},16,[927,931,936,940],{"type":170,"tag":222,"props":928,"children":929},{"style":241},[930],{"type":175,"value":908},{"type":170,"tag":222,"props":932,"children":933},{"style":251},[934],{"type":175,"value":935},"var p=[],print=function(){p.push.apply(p,arguments);};",{"type":170,"tag":222,"props":937,"children":938},{"style":241},[939],{"type":175,"value":918},{"type":170,"tag":222,"props":941,"children":942},{"style":596},[943],{"type":175,"value":944}," +\n",{"type":170,"tag":222,"props":946,"children":948},{"class":224,"line":947},17,[949],{"type":170,"tag":222,"props":950,"children":951},{"style":414},[952],{"type":175,"value":953},"            // Introduce the data as local variables using with(){}\n",{"type":170,"tag":222,"props":955,"children":957},{"class":224,"line":956},18,[958,963,968,972],{"type":170,"tag":222,"props":959,"children":960},{"style":241},[961],{"type":175,"value":962},"            \"",{"type":170,"tag":222,"props":964,"children":965},{"style":251},[966],{"type":175,"value":967},"with(obj){p.push('",{"type":170,"tag":222,"props":969,"children":970},{"style":241},[971],{"type":175,"value":918},{"type":170,"tag":222,"props":973,"children":974},{"style":596},[975],{"type":175,"value":944},{"type":170,"tag":222,"props":977,"children":979},{"class":224,"line":978},19,[980],{"type":170,"tag":222,"props":981,"children":982},{"style":414},[983],{"type":175,"value":984},"            // Convert the template into pure JavaScript\n",{"type":170,"tag":222,"props":986,"children":988},{"class":224,"line":987},20,[989],{"type":170,"tag":222,"props":990,"children":991},{"style":235},[992],{"type":175,"value":993},"            str\n",{"type":170,"tag":222,"props":995,"children":997},{"class":224,"line":996},21,[998,1003,1008,1012,1016,1021,1026,1031,1035,1041,1045,1050,1054],{"type":170,"tag":222,"props":999,"children":1000},{"style":320},[1001],{"type":175,"value":1002},"              .",{"type":170,"tag":222,"props":1004,"children":1005},{"style":229},[1006],{"type":175,"value":1007},"replace",{"type":170,"tag":222,"props":1009,"children":1010},{"style":335},[1011],{"type":175,"value":238},{"type":170,"tag":222,"props":1013,"children":1014},{"style":241},[1015],{"type":175,"value":717},{"type":170,"tag":222,"props":1017,"children":1019},{"style":1018},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[1020],{"type":175,"value":771},{"type":170,"tag":222,"props":1022,"children":1023},{"style":720},[1024],{"type":175,"value":1025},"\\r\\t\\n",{"type":170,"tag":222,"props":1027,"children":1028},{"style":1018},[1029],{"type":175,"value":1030},"]",{"type":170,"tag":222,"props":1032,"children":1033},{"style":241},[1034],{"type":175,"value":717},{"type":170,"tag":222,"props":1036,"children":1038},{"style":1037},"--shiki-light:#F76D47;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[1039],{"type":175,"value":1040},"g",{"type":170,"tag":222,"props":1042,"children":1043},{"style":320},[1044],{"type":175,"value":323},{"type":170,"tag":222,"props":1046,"children":1047},{"style":241},[1048],{"type":175,"value":1049}," \"",{"type":170,"tag":222,"props":1051,"children":1052},{"style":241},[1053],{"type":175,"value":1049},{"type":170,"tag":222,"props":1055,"children":1056},{"style":335},[1057],{"type":175,"value":387},{"type":170,"tag":222,"props":1059,"children":1061},{"class":224,"line":1060},22,[1062,1066,1071,1075,1079,1084,1088],{"type":170,"tag":222,"props":1063,"children":1064},{"style":320},[1065],{"type":175,"value":1002},{"type":170,"tag":222,"props":1067,"children":1068},{"style":229},[1069],{"type":175,"value":1070},"split",{"type":170,"tag":222,"props":1072,"children":1073},{"style":335},[1074],{"type":175,"value":238},{"type":170,"tag":222,"props":1076,"children":1077},{"style":241},[1078],{"type":175,"value":918},{"type":170,"tag":222,"props":1080,"children":1081},{"style":251},[1082],{"type":175,"value":1083},"\u003C%",{"type":170,"tag":222,"props":1085,"children":1086},{"style":241},[1087],{"type":175,"value":918},{"type":170,"tag":222,"props":1089,"children":1090},{"style":335},[1091],{"type":175,"value":387},{"type":170,"tag":222,"props":1093,"children":1095},{"class":224,"line":1094},23,[1096,1100,1105,1109,1113,1119,1123],{"type":170,"tag":222,"props":1097,"children":1098},{"style":320},[1099],{"type":175,"value":1002},{"type":170,"tag":222,"props":1101,"children":1102},{"style":229},[1103],{"type":175,"value":1104},"join",{"type":170,"tag":222,"props":1106,"children":1107},{"style":335},[1108],{"type":175,"value":238},{"type":170,"tag":222,"props":1110,"children":1111},{"style":241},[1112],{"type":175,"value":918},{"type":170,"tag":222,"props":1114,"children":1116},{"style":1115},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[1117],{"type":175,"value":1118},"\\t",{"type":170,"tag":222,"props":1120,"children":1121},{"style":241},[1122],{"type":175,"value":918},{"type":170,"tag":222,"props":1124,"children":1125},{"style":335},[1126],{"type":175,"value":387},{"type":170,"tag":222,"props":1128,"children":1130},{"class":224,"line":1129},24,[1131,1135,1139,1143,1147,1153,1159,1164,1170,1174,1178,1182,1186,1190,1195,1199,1204,1208,1212,1216,1220,1225,1230,1234],{"type":170,"tag":222,"props":1132,"children":1133},{"style":320},[1134],{"type":175,"value":1002},{"type":170,"tag":222,"props":1136,"children":1137},{"style":229},[1138],{"type":175,"value":1007},{"type":170,"tag":222,"props":1140,"children":1141},{"style":335},[1142],{"type":175,"value":238},{"type":170,"tag":222,"props":1144,"children":1145},{"style":241},[1146],{"type":175,"value":717},{"type":170,"tag":222,"props":1148,"children":1150},{"style":1149},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#DBEDFF;--shiki-sepia:#E6DB74",[1151],{"type":175,"value":1152},"((",{"type":170,"tag":222,"props":1154,"children":1156},{"style":1155},"--shiki-light:#39ADB5;--shiki-light-font-style:italic;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#F92672;--shiki-sepia-font-style:inherit",[1157],{"type":175,"value":1158},"^",{"type":170,"tag":222,"props":1160,"children":1161},{"style":596},[1162],{"type":175,"value":1163},"|",{"type":170,"tag":222,"props":1165,"children":1167},{"style":1166},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#DBEDFF;--shiki-sepia:#E6DB74",[1168],{"type":175,"value":1169},"%>",{"type":170,"tag":222,"props":1171,"children":1172},{"style":1149},[1173],{"type":175,"value":670},{"type":170,"tag":222,"props":1175,"children":1176},{"style":1018},[1177],{"type":175,"value":771},{"type":170,"tag":222,"props":1179,"children":1180},{"style":596},[1181],{"type":175,"value":1158},{"type":170,"tag":222,"props":1183,"children":1184},{"style":720},[1185],{"type":175,"value":1118},{"type":170,"tag":222,"props":1187,"children":1188},{"style":1018},[1189],{"type":175,"value":1030},{"type":170,"tag":222,"props":1191,"children":1192},{"style":596},[1193],{"type":175,"value":1194},"*",{"type":170,"tag":222,"props":1196,"children":1197},{"style":1149},[1198],{"type":175,"value":670},{"type":170,"tag":222,"props":1200,"children":1201},{"style":1166},[1202],{"type":175,"value":1203},"'",{"type":170,"tag":222,"props":1205,"children":1206},{"style":241},[1207],{"type":175,"value":717},{"type":170,"tag":222,"props":1209,"children":1210},{"style":1037},[1211],{"type":175,"value":1040},{"type":170,"tag":222,"props":1213,"children":1214},{"style":320},[1215],{"type":175,"value":323},{"type":170,"tag":222,"props":1217,"children":1218},{"style":241},[1219],{"type":175,"value":1049},{"type":170,"tag":222,"props":1221,"children":1222},{"style":251},[1223],{"type":175,"value":1224},"$1",{"type":170,"tag":222,"props":1226,"children":1227},{"style":1115},[1228],{"type":175,"value":1229},"\\r",{"type":170,"tag":222,"props":1231,"children":1232},{"style":241},[1233],{"type":175,"value":918},{"type":170,"tag":222,"props":1235,"children":1236},{"style":335},[1237],{"type":175,"value":387},{"type":170,"tag":222,"props":1239,"children":1241},{"class":224,"line":1240},25,[1242,1246,1250,1254,1258,1262,1267,1271,1275,1280,1284,1288,1292,1296,1300,1304,1309,1313],{"type":170,"tag":222,"props":1243,"children":1244},{"style":320},[1245],{"type":175,"value":1002},{"type":170,"tag":222,"props":1247,"children":1248},{"style":229},[1249],{"type":175,"value":1007},{"type":170,"tag":222,"props":1251,"children":1252},{"style":335},[1253],{"type":175,"value":238},{"type":170,"tag":222,"props":1255,"children":1256},{"style":241},[1257],{"type":175,"value":717},{"type":170,"tag":222,"props":1259,"children":1260},{"style":720},[1261],{"type":175,"value":1118},{"type":170,"tag":222,"props":1263,"children":1264},{"style":1166},[1265],{"type":175,"value":1266},"=",{"type":170,"tag":222,"props":1268,"children":1269},{"style":1149},[1270],{"type":175,"value":238},{"type":170,"tag":222,"props":1272,"children":1273},{"style":720},[1274],{"type":175,"value":627},{"type":170,"tag":222,"props":1276,"children":1277},{"style":596},[1278],{"type":175,"value":1279},"*?",{"type":170,"tag":222,"props":1281,"children":1282},{"style":1149},[1283],{"type":175,"value":670},{"type":170,"tag":222,"props":1285,"children":1286},{"style":1166},[1287],{"type":175,"value":1169},{"type":170,"tag":222,"props":1289,"children":1290},{"style":241},[1291],{"type":175,"value":717},{"type":170,"tag":222,"props":1293,"children":1294},{"style":1037},[1295],{"type":175,"value":1040},{"type":170,"tag":222,"props":1297,"children":1298},{"style":320},[1299],{"type":175,"value":323},{"type":170,"tag":222,"props":1301,"children":1302},{"style":241},[1303],{"type":175,"value":1049},{"type":170,"tag":222,"props":1305,"children":1306},{"style":251},[1307],{"type":175,"value":1308},"',$1,'",{"type":170,"tag":222,"props":1310,"children":1311},{"style":241},[1312],{"type":175,"value":918},{"type":170,"tag":222,"props":1314,"children":1315},{"style":335},[1316],{"type":175,"value":387},{"type":170,"tag":222,"props":1318,"children":1320},{"class":224,"line":1319},26,[1321,1325,1329,1333,1337,1341,1345],{"type":170,"tag":222,"props":1322,"children":1323},{"style":320},[1324],{"type":175,"value":1002},{"type":170,"tag":222,"props":1326,"children":1327},{"style":229},[1328],{"type":175,"value":1070},{"type":170,"tag":222,"props":1330,"children":1331},{"style":335},[1332],{"type":175,"value":238},{"type":170,"tag":222,"props":1334,"children":1335},{"style":241},[1336],{"type":175,"value":918},{"type":170,"tag":222,"props":1338,"children":1339},{"style":1115},[1340],{"type":175,"value":1118},{"type":170,"tag":222,"props":1342,"children":1343},{"style":241},[1344],{"type":175,"value":918},{"type":170,"tag":222,"props":1346,"children":1347},{"style":335},[1348],{"type":175,"value":387},{"type":170,"tag":222,"props":1350,"children":1352},{"class":224,"line":1351},27,[1353,1357,1361,1365,1369,1374,1378],{"type":170,"tag":222,"props":1354,"children":1355},{"style":320},[1356],{"type":175,"value":1002},{"type":170,"tag":222,"props":1358,"children":1359},{"style":229},[1360],{"type":175,"value":1104},{"type":170,"tag":222,"props":1362,"children":1363},{"style":335},[1364],{"type":175,"value":238},{"type":170,"tag":222,"props":1366,"children":1367},{"style":241},[1368],{"type":175,"value":918},{"type":170,"tag":222,"props":1370,"children":1371},{"style":251},[1372],{"type":175,"value":1373},"');",{"type":170,"tag":222,"props":1375,"children":1376},{"style":241},[1377],{"type":175,"value":918},{"type":170,"tag":222,"props":1379,"children":1380},{"style":335},[1381],{"type":175,"value":387},{"type":170,"tag":222,"props":1383,"children":1385},{"class":224,"line":1384},28,[1386,1390,1394,1398,1402,1406,1410],{"type":170,"tag":222,"props":1387,"children":1388},{"style":320},[1389],{"type":175,"value":1002},{"type":170,"tag":222,"props":1391,"children":1392},{"style":229},[1393],{"type":175,"value":1070},{"type":170,"tag":222,"props":1395,"children":1396},{"style":335},[1397],{"type":175,"value":238},{"type":170,"tag":222,"props":1399,"children":1400},{"style":241},[1401],{"type":175,"value":918},{"type":170,"tag":222,"props":1403,"children":1404},{"style":251},[1405],{"type":175,"value":1169},{"type":170,"tag":222,"props":1407,"children":1408},{"style":241},[1409],{"type":175,"value":918},{"type":170,"tag":222,"props":1411,"children":1412},{"style":335},[1413],{"type":175,"value":387},{"type":170,"tag":222,"props":1415,"children":1417},{"class":224,"line":1416},29,[1418,1422,1426,1430,1434,1439,1443],{"type":170,"tag":222,"props":1419,"children":1420},{"style":320},[1421],{"type":175,"value":1002},{"type":170,"tag":222,"props":1423,"children":1424},{"style":229},[1425],{"type":175,"value":1104},{"type":170,"tag":222,"props":1427,"children":1428},{"style":335},[1429],{"type":175,"value":238},{"type":170,"tag":222,"props":1431,"children":1432},{"style":241},[1433],{"type":175,"value":918},{"type":170,"tag":222,"props":1435,"children":1436},{"style":251},[1437],{"type":175,"value":1438},"p.push('",{"type":170,"tag":222,"props":1440,"children":1441},{"style":241},[1442],{"type":175,"value":918},{"type":170,"tag":222,"props":1444,"children":1445},{"style":335},[1446],{"type":175,"value":387},{"type":170,"tag":222,"props":1448,"children":1450},{"class":224,"line":1449},30,[1451,1455,1459,1463,1467,1471,1475],{"type":170,"tag":222,"props":1452,"children":1453},{"style":320},[1454],{"type":175,"value":1002},{"type":170,"tag":222,"props":1456,"children":1457},{"style":229},[1458],{"type":175,"value":1070},{"type":170,"tag":222,"props":1460,"children":1461},{"style":335},[1462],{"type":175,"value":238},{"type":170,"tag":222,"props":1464,"children":1465},{"style":241},[1466],{"type":175,"value":918},{"type":170,"tag":222,"props":1468,"children":1469},{"style":1115},[1470],{"type":175,"value":1229},{"type":170,"tag":222,"props":1472,"children":1473},{"style":241},[1474],{"type":175,"value":918},{"type":170,"tag":222,"props":1476,"children":1477},{"style":335},[1478],{"type":175,"value":387},{"type":170,"tag":222,"props":1480,"children":1482},{"class":224,"line":1481},31,[1483,1487,1491,1495,1499,1504,1508,1512,1517],{"type":170,"tag":222,"props":1484,"children":1485},{"style":320},[1486],{"type":175,"value":1002},{"type":170,"tag":222,"props":1488,"children":1489},{"style":229},[1490],{"type":175,"value":1104},{"type":170,"tag":222,"props":1492,"children":1493},{"style":335},[1494],{"type":175,"value":238},{"type":170,"tag":222,"props":1496,"children":1497},{"style":241},[1498],{"type":175,"value":918},{"type":170,"tag":222,"props":1500,"children":1501},{"style":1115},[1502],{"type":175,"value":1503},"\\\\",{"type":170,"tag":222,"props":1505,"children":1506},{"style":251},[1507],{"type":175,"value":1203},{"type":170,"tag":222,"props":1509,"children":1510},{"style":241},[1511],{"type":175,"value":918},{"type":170,"tag":222,"props":1513,"children":1514},{"style":335},[1515],{"type":175,"value":1516},") ",{"type":170,"tag":222,"props":1518,"children":1519},{"style":596},[1520],{"type":175,"value":1521},"+\n",{"type":170,"tag":222,"props":1523,"children":1525},{"class":224,"line":1524},32,[1526,1530,1535],{"type":170,"tag":222,"props":1527,"children":1528},{"style":241},[1529],{"type":175,"value":962},{"type":170,"tag":222,"props":1531,"children":1532},{"style":251},[1533],{"type":175,"value":1534},"');}return p.join('');",{"type":170,"tag":222,"props":1536,"children":1537},{"style":241},[1538],{"type":175,"value":1539},"\"\n",{"type":170,"tag":222,"props":1541,"children":1543},{"class":224,"line":1542},33,[1544,1549],{"type":170,"tag":222,"props":1545,"children":1546},{"style":335},[1547],{"type":175,"value":1548},"        )",{"type":170,"tag":222,"props":1550,"children":1551},{"style":320},[1552],{"type":175,"value":1553},";\n",{"type":170,"tag":222,"props":1555,"children":1557},{"class":224,"line":1556},34,[1558],{"type":170,"tag":222,"props":1559,"children":1560},{"emptyLinePlaceholder":610},[1561],{"type":175,"value":613},{"type":170,"tag":222,"props":1563,"children":1565},{"class":224,"line":1564},35,[1566],{"type":170,"tag":222,"props":1567,"children":1568},{"style":414},[1569],{"type":175,"value":1570},"    // Provide some basic currying to the user\n",{"type":170,"tag":222,"props":1572,"children":1574},{"class":224,"line":1573},36,[1575,1580,1584,1589,1593,1597,1602,1606,1610,1614],{"type":170,"tag":222,"props":1576,"children":1577},{"style":1155},[1578],{"type":175,"value":1579},"    return",{"type":170,"tag":222,"props":1581,"children":1582},{"style":235},[1583],{"type":175,"value":665},{"type":170,"tag":222,"props":1585,"children":1586},{"style":596},[1587],{"type":175,"value":1588}," ?",{"type":170,"tag":222,"props":1590,"children":1591},{"style":229},[1592],{"type":175,"value":703},{"type":170,"tag":222,"props":1594,"children":1595},{"style":335},[1596],{"type":175,"value":238},{"type":170,"tag":222,"props":1598,"children":1599},{"style":235},[1600],{"type":175,"value":1601},"data",{"type":170,"tag":222,"props":1603,"children":1604},{"style":335},[1605],{"type":175,"value":1516},{"type":170,"tag":222,"props":1607,"children":1608},{"style":596},[1609],{"type":175,"value":343},{"type":170,"tag":222,"props":1611,"children":1612},{"style":235},[1613],{"type":175,"value":703},{"type":170,"tag":222,"props":1615,"children":1616},{"style":320},[1617],{"type":175,"value":1553},{"type":170,"tag":222,"props":1619,"children":1621},{"class":224,"line":1620},37,[1622],{"type":170,"tag":222,"props":1623,"children":1624},{"style":320},[1625],{"type":175,"value":1626},"  };\n",{"type":170,"tag":222,"props":1628,"children":1630},{"class":224,"line":1629},38,[1631,1635,1640],{"type":170,"tag":222,"props":1632,"children":1633},{"style":320},[1634],{"type":175,"value":382},{"type":170,"tag":222,"props":1636,"children":1637},{"style":235},[1638],{"type":175,"value":1639},")()",{"type":170,"tag":222,"props":1641,"children":1642},{"style":320},[1643],{"type":175,"value":1553},{"type":170,"tag":171,"props":1645,"children":1646},{},[1647],{"type":175,"value":1648},"代码看完了，我知道你没看懂，因为曾经我也是。好了，留下三连，解析开始。",{"type":170,"tag":526,"props":1650,"children":1652},{"id":1651},"解析",[1653],{"type":175,"value":1651},{"type":170,"tag":171,"props":1655,"children":1656},{},[1657],{"type":175,"value":1658},"首先，代码最外层是一个 IIFE，给 this 对象挂载了 tmpl 函数，直接执行的话就是 window。内部通过局部变量保存了模板解析的缓存：",{"type":170,"tag":212,"props":1660,"children":1662},{"className":214,"code":1661,"language":216,"meta":164,"style":164},"(function () {\n  var cache = {};\n  this.tmpl = function tmpl(str, data) {};\n})();\n",[1663],{"type":170,"tag":186,"props":1664,"children":1665},{"__ignoreMap":164},[1666,1685,1704,1755],{"type":170,"tag":222,"props":1667,"children":1668},{"class":224,"line":225},[1669,1673,1677,1681],{"type":170,"tag":222,"props":1670,"children":1671},{"style":235},[1672],{"type":175,"value":238},{"type":170,"tag":222,"props":1674,"children":1675},{"style":568},[1676],{"type":175,"value":571},{"type":170,"tag":222,"props":1678,"children":1679},{"style":320},[1680],{"type":175,"value":576},{"type":170,"tag":222,"props":1682,"children":1683},{"style":320},[1684],{"type":175,"value":328},{"type":170,"tag":222,"props":1686,"children":1687},{"class":224,"line":247},[1688,1692,1696,1700],{"type":170,"tag":222,"props":1689,"children":1690},{"style":568},[1691],{"type":175,"value":588},{"type":170,"tag":222,"props":1693,"children":1694},{"style":235},[1695],{"type":175,"value":593},{"type":170,"tag":222,"props":1697,"children":1698},{"style":596},[1699],{"type":175,"value":599},{"type":170,"tag":222,"props":1701,"children":1702},{"style":320},[1703],{"type":175,"value":604},{"type":170,"tag":222,"props":1705,"children":1706},{"class":224,"line":257},[1707,1711,1715,1719,1723,1727,1731,1735,1739,1743,1747,1751],{"type":170,"tag":222,"props":1708,"children":1709},{"style":619},[1710],{"type":175,"value":622},{"type":170,"tag":222,"props":1712,"children":1713},{"style":320},[1714],{"type":175,"value":627},{"type":170,"tag":222,"props":1716,"children":1717},{"style":229},[1718],{"type":175,"value":632},{"type":170,"tag":222,"props":1720,"children":1721},{"style":596},[1722],{"type":175,"value":599},{"type":170,"tag":222,"props":1724,"children":1725},{"style":568},[1726],{"type":175,"value":641},{"type":170,"tag":222,"props":1728,"children":1729},{"style":229},[1730],{"type":175,"value":646},{"type":170,"tag":222,"props":1732,"children":1733},{"style":320},[1734],{"type":175,"value":238},{"type":170,"tag":222,"props":1736,"children":1737},{"style":653},[1738],{"type":175,"value":656},{"type":170,"tag":222,"props":1740,"children":1741},{"style":320},[1742],{"type":175,"value":323},{"type":170,"tag":222,"props":1744,"children":1745},{"style":653},[1746],{"type":175,"value":665},{"type":170,"tag":222,"props":1748,"children":1749},{"style":320},[1750],{"type":175,"value":670},{"type":170,"tag":222,"props":1752,"children":1753},{"style":320},[1754],{"type":175,"value":604},{"type":170,"tag":222,"props":1756,"children":1757},{"class":224,"line":266},[1758,1762,1766],{"type":170,"tag":222,"props":1759,"children":1760},{"style":320},[1761],{"type":175,"value":382},{"type":170,"tag":222,"props":1763,"children":1764},{"style":235},[1765],{"type":175,"value":1639},{"type":170,"tag":222,"props":1767,"children":1768},{"style":320},[1769],{"type":175,"value":1553},{"type":170,"tag":171,"props":1771,"children":1772},{},[1773,1775,1781],{"type":175,"value":1774},"str 参数有两种两种用途，",{"type":170,"tag":186,"props":1776,"children":1778},{"className":1777},[],[1779],{"type":175,"value":1780},"/\\W/.test(str)",{"type":175,"value":1782}," 用来判断字符串中包不包含模板分隔符，如果不含分隔符，即普通字符串，那就当作 ID，从页面对应 ID 的节点中获取内容作为模板。比如，如果 str 为 'user_tmpl'，那么模板函数将会读取页面的以下脚本的内容作为输入：",{"type":170,"tag":212,"props":1784,"children":1786},{"className":402,"code":1785,"language":404,"meta":164,"style":164},"\u003C!-- type=\"text/html\"，所以浏览器并不会执行这串脚本。它只能由 tmpl 来读取... -->\n\u003Cscript type=\"text/html\" id=\"item_tmpl\">\n  \u003Cdiv id=\"\u003C%=id%>\" class=\"\u003C%=(i % 2 == 1 ? \" even\" : \"\")%>\">\n    \u003Cdiv class=\"grid_1 alpha right\">\n      \u003Cimg class=\"righted\" src=\"\u003C%=profile_image_url%>\"/>\n    \u003C/div>\n    \u003Cdiv class=\"grid_6 omega contents\">\n      \u003Cp>\u003Cb>\u003Ca href=\"/\u003C%=from_user%>\">\u003C%=from_user%>\u003C/a>:\u003C/b> \u003C%=text%>\u003C/p>\n    \u003C/div>\n  \u003C/div>\n\u003C/script>\n",[1787],{"type":170,"tag":186,"props":1788,"children":1789},{"__ignoreMap":164},[1790,1798,1859,1943,1980,2041,2057,2093,2198,2213,2229],{"type":170,"tag":222,"props":1791,"children":1792},{"class":224,"line":225},[1793],{"type":170,"tag":222,"props":1794,"children":1795},{"style":414},[1796],{"type":175,"value":1797},"\u003C!-- type=\"text/html\"，所以浏览器并不会执行这串脚本。它只能由 tmpl 来读取... -->\n",{"type":170,"tag":222,"props":1799,"children":1800},{"class":224,"line":247},[1801,1805,1810,1816,1820,1824,1829,1833,1838,1842,1846,1851,1855],{"type":170,"tag":222,"props":1802,"children":1803},{"style":320},[1804],{"type":175,"value":425},{"type":170,"tag":222,"props":1806,"children":1807},{"style":428},[1808],{"type":175,"value":1809},"script",{"type":170,"tag":222,"props":1811,"children":1813},{"style":1812},"--shiki-light:#9C3EDA;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[1814],{"type":175,"value":1815}," type",{"type":170,"tag":222,"props":1817,"children":1818},{"style":320},[1819],{"type":175,"value":1266},{"type":170,"tag":222,"props":1821,"children":1822},{"style":241},[1823],{"type":175,"value":918},{"type":170,"tag":222,"props":1825,"children":1826},{"style":251},[1827],{"type":175,"value":1828},"text/html",{"type":170,"tag":222,"props":1830,"children":1831},{"style":241},[1832],{"type":175,"value":918},{"type":170,"tag":222,"props":1834,"children":1835},{"style":1812},[1836],{"type":175,"value":1837}," id",{"type":170,"tag":222,"props":1839,"children":1840},{"style":320},[1841],{"type":175,"value":1266},{"type":170,"tag":222,"props":1843,"children":1844},{"style":241},[1845],{"type":175,"value":918},{"type":170,"tag":222,"props":1847,"children":1848},{"style":251},[1849],{"type":175,"value":1850},"item_tmpl",{"type":170,"tag":222,"props":1852,"children":1853},{"style":241},[1854],{"type":175,"value":918},{"type":170,"tag":222,"props":1856,"children":1857},{"style":320},[1858],{"type":175,"value":455},{"type":170,"tag":222,"props":1860,"children":1861},{"class":224,"line":257},[1862,1867,1871,1875,1879,1883,1888,1892,1897,1901,1905,1910,1914,1919,1924,1929,1934,1938],{"type":170,"tag":222,"props":1863,"children":1864},{"style":320},[1865],{"type":175,"value":1866},"  \u003C",{"type":170,"tag":222,"props":1868,"children":1869},{"style":428},[1870],{"type":175,"value":431},{"type":170,"tag":222,"props":1872,"children":1873},{"style":1812},[1874],{"type":175,"value":1837},{"type":170,"tag":222,"props":1876,"children":1877},{"style":320},[1878],{"type":175,"value":1266},{"type":170,"tag":222,"props":1880,"children":1881},{"style":241},[1882],{"type":175,"value":918},{"type":170,"tag":222,"props":1884,"children":1885},{"style":251},[1886],{"type":175,"value":1887},"\u003C%=id%>",{"type":170,"tag":222,"props":1889,"children":1890},{"style":241},[1891],{"type":175,"value":918},{"type":170,"tag":222,"props":1893,"children":1894},{"style":1812},[1895],{"type":175,"value":1896}," class",{"type":170,"tag":222,"props":1898,"children":1899},{"style":320},[1900],{"type":175,"value":1266},{"type":170,"tag":222,"props":1902,"children":1903},{"style":241},[1904],{"type":175,"value":918},{"type":170,"tag":222,"props":1906,"children":1907},{"style":251},[1908],{"type":175,"value":1909},"\u003C%=(i % 2 == 1 ? ",{"type":170,"tag":222,"props":1911,"children":1912},{"style":241},[1913],{"type":175,"value":918},{"type":170,"tag":222,"props":1915,"children":1916},{"style":1812},[1917],{"type":175,"value":1918}," even",{"type":170,"tag":222,"props":1920,"children":1922},{"style":1921},"--shiki-light:#39ADB5;--shiki-light-font-style:inherit;--shiki-default:#B31D28;--shiki-default-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;--shiki-sepia:#F44747;--shiki-sepia-font-style:inherit",[1923],{"type":175,"value":918},{"type":170,"tag":222,"props":1925,"children":1926},{"style":1812},[1927],{"type":175,"value":1928}," :",{"type":170,"tag":222,"props":1930,"children":1931},{"style":1921},[1932],{"type":175,"value":1933}," \"\")%",{"type":170,"tag":222,"props":1935,"children":1936},{"style":320},[1937],{"type":175,"value":436},{"type":170,"tag":222,"props":1939,"children":1940},{"style":235},[1941],{"type":175,"value":1942},"\">\n",{"type":170,"tag":222,"props":1944,"children":1945},{"class":224,"line":266},[1946,1951,1955,1959,1963,1967,1972,1976],{"type":170,"tag":222,"props":1947,"children":1948},{"style":320},[1949],{"type":175,"value":1950},"    \u003C",{"type":170,"tag":222,"props":1952,"children":1953},{"style":428},[1954],{"type":175,"value":431},{"type":170,"tag":222,"props":1956,"children":1957},{"style":1812},[1958],{"type":175,"value":1896},{"type":170,"tag":222,"props":1960,"children":1961},{"style":320},[1962],{"type":175,"value":1266},{"type":170,"tag":222,"props":1964,"children":1965},{"style":241},[1966],{"type":175,"value":918},{"type":170,"tag":222,"props":1968,"children":1969},{"style":251},[1970],{"type":175,"value":1971},"grid_1 alpha right",{"type":170,"tag":222,"props":1973,"children":1974},{"style":241},[1975],{"type":175,"value":918},{"type":170,"tag":222,"props":1977,"children":1978},{"style":320},[1979],{"type":175,"value":455},{"type":170,"tag":222,"props":1981,"children":1982},{"class":224,"line":275},[1983,1988,1993,1997,2001,2005,2010,2014,2019,2023,2027,2032,2036],{"type":170,"tag":222,"props":1984,"children":1985},{"style":320},[1986],{"type":175,"value":1987},"      \u003C",{"type":170,"tag":222,"props":1989,"children":1990},{"style":428},[1991],{"type":175,"value":1992},"img",{"type":170,"tag":222,"props":1994,"children":1995},{"style":1812},[1996],{"type":175,"value":1896},{"type":170,"tag":222,"props":1998,"children":1999},{"style":320},[2000],{"type":175,"value":1266},{"type":170,"tag":222,"props":2002,"children":2003},{"style":241},[2004],{"type":175,"value":918},{"type":170,"tag":222,"props":2006,"children":2007},{"style":251},[2008],{"type":175,"value":2009},"righted",{"type":170,"tag":222,"props":2011,"children":2012},{"style":241},[2013],{"type":175,"value":918},{"type":170,"tag":222,"props":2015,"children":2016},{"style":1812},[2017],{"type":175,"value":2018}," src",{"type":170,"tag":222,"props":2020,"children":2021},{"style":320},[2022],{"type":175,"value":1266},{"type":170,"tag":222,"props":2024,"children":2025},{"style":241},[2026],{"type":175,"value":918},{"type":170,"tag":222,"props":2028,"children":2029},{"style":251},[2030],{"type":175,"value":2031},"\u003C%=profile_image_url%>",{"type":170,"tag":222,"props":2033,"children":2034},{"style":241},[2035],{"type":175,"value":918},{"type":170,"tag":222,"props":2037,"children":2038},{"style":320},[2039],{"type":175,"value":2040},"/>\n",{"type":170,"tag":222,"props":2042,"children":2043},{"class":224,"line":284},[2044,2049,2053],{"type":170,"tag":222,"props":2045,"children":2046},{"style":320},[2047],{"type":175,"value":2048},"    \u003C/",{"type":170,"tag":222,"props":2050,"children":2051},{"style":428},[2052],{"type":175,"value":431},{"type":170,"tag":222,"props":2054,"children":2055},{"style":320},[2056],{"type":175,"value":455},{"type":170,"tag":222,"props":2058,"children":2059},{"class":224,"line":293},[2060,2064,2068,2072,2076,2080,2085,2089],{"type":170,"tag":222,"props":2061,"children":2062},{"style":320},[2063],{"type":175,"value":1950},{"type":170,"tag":222,"props":2065,"children":2066},{"style":428},[2067],{"type":175,"value":431},{"type":170,"tag":222,"props":2069,"children":2070},{"style":1812},[2071],{"type":175,"value":1896},{"type":170,"tag":222,"props":2073,"children":2074},{"style":320},[2075],{"type":175,"value":1266},{"type":170,"tag":222,"props":2077,"children":2078},{"style":241},[2079],{"type":175,"value":918},{"type":170,"tag":222,"props":2081,"children":2082},{"style":251},[2083],{"type":175,"value":2084},"grid_6 omega contents",{"type":170,"tag":222,"props":2086,"children":2087},{"style":241},[2088],{"type":175,"value":918},{"type":170,"tag":222,"props":2090,"children":2091},{"style":320},[2092],{"type":175,"value":455},{"type":170,"tag":222,"props":2094,"children":2095},{"class":224,"line":302},[2096,2100,2104,2109,2114,2118,2122,2127,2131,2135,2140,2144,2148,2153,2157,2161,2165,2169,2173,2177,2181,2186,2190,2194],{"type":170,"tag":222,"props":2097,"children":2098},{"style":320},[2099],{"type":175,"value":1987},{"type":170,"tag":222,"props":2101,"children":2102},{"style":428},[2103],{"type":175,"value":171},{"type":170,"tag":222,"props":2105,"children":2106},{"style":320},[2107],{"type":175,"value":2108},">\u003C",{"type":170,"tag":222,"props":2110,"children":2111},{"style":428},[2112],{"type":175,"value":2113},"b",{"type":170,"tag":222,"props":2115,"children":2116},{"style":320},[2117],{"type":175,"value":2108},{"type":170,"tag":222,"props":2119,"children":2120},{"style":428},[2121],{"type":175,"value":178},{"type":170,"tag":222,"props":2123,"children":2124},{"style":1812},[2125],{"type":175,"value":2126}," href",{"type":170,"tag":222,"props":2128,"children":2129},{"style":320},[2130],{"type":175,"value":1266},{"type":170,"tag":222,"props":2132,"children":2133},{"style":241},[2134],{"type":175,"value":918},{"type":170,"tag":222,"props":2136,"children":2137},{"style":251},[2138],{"type":175,"value":2139},"/\u003C%=from_user%>",{"type":170,"tag":222,"props":2141,"children":2142},{"style":241},[2143],{"type":175,"value":918},{"type":170,"tag":222,"props":2145,"children":2146},{"style":320},[2147],{"type":175,"value":436},{"type":170,"tag":222,"props":2149,"children":2150},{"style":235},[2151],{"type":175,"value":2152},"\u003C%=from_user%>",{"type":170,"tag":222,"props":2154,"children":2155},{"style":320},[2156],{"type":175,"value":446},{"type":170,"tag":222,"props":2158,"children":2159},{"style":428},[2160],{"type":175,"value":178},{"type":170,"tag":222,"props":2162,"children":2163},{"style":320},[2164],{"type":175,"value":436},{"type":170,"tag":222,"props":2166,"children":2167},{"style":235},[2168],{"type":175,"value":343},{"type":170,"tag":222,"props":2170,"children":2171},{"style":320},[2172],{"type":175,"value":446},{"type":170,"tag":222,"props":2174,"children":2175},{"style":428},[2176],{"type":175,"value":2113},{"type":170,"tag":222,"props":2178,"children":2179},{"style":320},[2180],{"type":175,"value":436},{"type":170,"tag":222,"props":2182,"children":2183},{"style":235},[2184],{"type":175,"value":2185}," \u003C%=text%>",{"type":170,"tag":222,"props":2187,"children":2188},{"style":320},[2189],{"type":175,"value":446},{"type":170,"tag":222,"props":2191,"children":2192},{"style":428},[2193],{"type":175,"value":171},{"type":170,"tag":222,"props":2195,"children":2196},{"style":320},[2197],{"type":175,"value":455},{"type":170,"tag":222,"props":2199,"children":2200},{"class":224,"line":311},[2201,2205,2209],{"type":170,"tag":222,"props":2202,"children":2203},{"style":320},[2204],{"type":175,"value":2048},{"type":170,"tag":222,"props":2206,"children":2207},{"style":428},[2208],{"type":175,"value":431},{"type":170,"tag":222,"props":2210,"children":2211},{"style":320},[2212],{"type":175,"value":455},{"type":170,"tag":222,"props":2214,"children":2215},{"class":224,"line":331},[2216,2221,2225],{"type":170,"tag":222,"props":2217,"children":2218},{"style":320},[2219],{"type":175,"value":2220},"  \u003C/",{"type":170,"tag":222,"props":2222,"children":2223},{"style":428},[2224],{"type":175,"value":431},{"type":170,"tag":222,"props":2226,"children":2227},{"style":320},[2228],{"type":175,"value":455},{"type":170,"tag":222,"props":2230,"children":2231},{"class":224,"line":357},[2232,2236,2240],{"type":170,"tag":222,"props":2233,"children":2234},{"style":320},[2235],{"type":175,"value":446},{"type":170,"tag":222,"props":2237,"children":2238},{"style":428},[2239],{"type":175,"value":1809},{"type":170,"tag":222,"props":2241,"children":2242},{"style":320},[2243],{"type":175,"value":455},{"type":170,"tag":212,"props":2245,"children":2247},{"className":214,"code":2246,"language":216,"meta":164,"style":164},"(function () {\n  var cache = {};\n  this.tmpl = function tmpl(str, data) {\n    return !/\\W/.test(str)\n      ? // 缓存会将读取脚本内容到模板解析这个过程的解析结果缓存下来\n        (cache[str] =\n          cache[str] ||\n          // 读取脚本内容\n          tmpl(document.getElementById(str).innerHTML))\n      : new Function();\n  };\n})();\n",[2248],{"type":170,"tag":186,"props":2249,"children":2250},{"__ignoreMap":164},[2251,2270,2289,2340,2383,2395,2423,2447,2455,2503,2528,2535],{"type":170,"tag":222,"props":2252,"children":2253},{"class":224,"line":225},[2254,2258,2262,2266],{"type":170,"tag":222,"props":2255,"children":2256},{"style":235},[2257],{"type":175,"value":238},{"type":170,"tag":222,"props":2259,"children":2260},{"style":568},[2261],{"type":175,"value":571},{"type":170,"tag":222,"props":2263,"children":2264},{"style":320},[2265],{"type":175,"value":576},{"type":170,"tag":222,"props":2267,"children":2268},{"style":320},[2269],{"type":175,"value":328},{"type":170,"tag":222,"props":2271,"children":2272},{"class":224,"line":247},[2273,2277,2281,2285],{"type":170,"tag":222,"props":2274,"children":2275},{"style":568},[2276],{"type":175,"value":588},{"type":170,"tag":222,"props":2278,"children":2279},{"style":235},[2280],{"type":175,"value":593},{"type":170,"tag":222,"props":2282,"children":2283},{"style":596},[2284],{"type":175,"value":599},{"type":170,"tag":222,"props":2286,"children":2287},{"style":320},[2288],{"type":175,"value":604},{"type":170,"tag":222,"props":2290,"children":2291},{"class":224,"line":257},[2292,2296,2300,2304,2308,2312,2316,2320,2324,2328,2332,2336],{"type":170,"tag":222,"props":2293,"children":2294},{"style":619},[2295],{"type":175,"value":622},{"type":170,"tag":222,"props":2297,"children":2298},{"style":320},[2299],{"type":175,"value":627},{"type":170,"tag":222,"props":2301,"children":2302},{"style":229},[2303],{"type":175,"value":632},{"type":170,"tag":222,"props":2305,"children":2306},{"style":596},[2307],{"type":175,"value":599},{"type":170,"tag":222,"props":2309,"children":2310},{"style":568},[2311],{"type":175,"value":641},{"type":170,"tag":222,"props":2313,"children":2314},{"style":229},[2315],{"type":175,"value":646},{"type":170,"tag":222,"props":2317,"children":2318},{"style":320},[2319],{"type":175,"value":238},{"type":170,"tag":222,"props":2321,"children":2322},{"style":653},[2323],{"type":175,"value":656},{"type":170,"tag":222,"props":2325,"children":2326},{"style":320},[2327],{"type":175,"value":323},{"type":170,"tag":222,"props":2329,"children":2330},{"style":653},[2331],{"type":175,"value":665},{"type":170,"tag":222,"props":2333,"children":2334},{"style":320},[2335],{"type":175,"value":670},{"type":170,"tag":222,"props":2337,"children":2338},{"style":320},[2339],{"type":175,"value":328},{"type":170,"tag":222,"props":2341,"children":2342},{"class":224,"line":266},[2343,2347,2351,2355,2359,2363,2367,2371,2375,2379],{"type":170,"tag":222,"props":2344,"children":2345},{"style":1155},[2346],{"type":175,"value":1579},{"type":170,"tag":222,"props":2348,"children":2349},{"style":596},[2350],{"type":175,"value":712},{"type":170,"tag":222,"props":2352,"children":2353},{"style":241},[2354],{"type":175,"value":717},{"type":170,"tag":222,"props":2356,"children":2357},{"style":720},[2358],{"type":175,"value":723},{"type":170,"tag":222,"props":2360,"children":2361},{"style":241},[2362],{"type":175,"value":717},{"type":170,"tag":222,"props":2364,"children":2365},{"style":320},[2366],{"type":175,"value":627},{"type":170,"tag":222,"props":2368,"children":2369},{"style":229},[2370],{"type":175,"value":736},{"type":170,"tag":222,"props":2372,"children":2373},{"style":335},[2374],{"type":175,"value":238},{"type":170,"tag":222,"props":2376,"children":2377},{"style":235},[2378],{"type":175,"value":656},{"type":170,"tag":222,"props":2380,"children":2381},{"style":335},[2382],{"type":175,"value":387},{"type":170,"tag":222,"props":2384,"children":2385},{"class":224,"line":275},[2386,2390],{"type":170,"tag":222,"props":2387,"children":2388},{"style":596},[2389],{"type":175,"value":756},{"type":170,"tag":222,"props":2391,"children":2392},{"style":414},[2393],{"type":175,"value":2394}," // 缓存会将读取脚本内容到模板解析这个过程的解析结果缓存下来\n",{"type":170,"tag":222,"props":2396,"children":2397},{"class":224,"line":284},[2398,2403,2407,2411,2415,2419],{"type":170,"tag":222,"props":2399,"children":2400},{"style":335},[2401],{"type":175,"value":2402},"        (",{"type":170,"tag":222,"props":2404,"children":2405},{"style":235},[2406],{"type":175,"value":766},{"type":170,"tag":222,"props":2408,"children":2409},{"style":335},[2410],{"type":175,"value":771},{"type":170,"tag":222,"props":2412,"children":2413},{"style":235},[2414],{"type":175,"value":656},{"type":170,"tag":222,"props":2416,"children":2417},{"style":335},[2418],{"type":175,"value":780},{"type":170,"tag":222,"props":2420,"children":2421},{"style":596},[2422],{"type":175,"value":785},{"type":170,"tag":222,"props":2424,"children":2425},{"class":224,"line":293},[2426,2430,2434,2438,2442],{"type":170,"tag":222,"props":2427,"children":2428},{"style":235},[2429],{"type":175,"value":793},{"type":170,"tag":222,"props":2431,"children":2432},{"style":335},[2433],{"type":175,"value":771},{"type":170,"tag":222,"props":2435,"children":2436},{"style":235},[2437],{"type":175,"value":656},{"type":170,"tag":222,"props":2439,"children":2440},{"style":335},[2441],{"type":175,"value":780},{"type":170,"tag":222,"props":2443,"children":2444},{"style":596},[2445],{"type":175,"value":2446},"||\n",{"type":170,"tag":222,"props":2448,"children":2449},{"class":224,"line":302},[2450],{"type":170,"tag":222,"props":2451,"children":2452},{"style":414},[2453],{"type":175,"value":2454},"          // 读取脚本内容\n",{"type":170,"tag":222,"props":2456,"children":2457},{"class":224,"line":311},[2458,2463,2467,2471,2475,2479,2483,2487,2491,2495,2499],{"type":170,"tag":222,"props":2459,"children":2460},{"style":229},[2461],{"type":175,"value":2462},"          tmpl",{"type":170,"tag":222,"props":2464,"children":2465},{"style":335},[2466],{"type":175,"value":238},{"type":170,"tag":222,"props":2468,"children":2469},{"style":235},[2470],{"type":175,"value":823},{"type":170,"tag":222,"props":2472,"children":2473},{"style":320},[2474],{"type":175,"value":627},{"type":170,"tag":222,"props":2476,"children":2477},{"style":229},[2478],{"type":175,"value":832},{"type":170,"tag":222,"props":2480,"children":2481},{"style":335},[2482],{"type":175,"value":238},{"type":170,"tag":222,"props":2484,"children":2485},{"style":235},[2486],{"type":175,"value":656},{"type":170,"tag":222,"props":2488,"children":2489},{"style":335},[2490],{"type":175,"value":670},{"type":170,"tag":222,"props":2492,"children":2493},{"style":320},[2494],{"type":175,"value":627},{"type":170,"tag":222,"props":2496,"children":2497},{"style":235},[2498],{"type":175,"value":853},{"type":170,"tag":222,"props":2500,"children":2501},{"style":335},[2502],{"type":175,"value":858},{"type":170,"tag":222,"props":2504,"children":2505},{"class":224,"line":331},[2506,2510,2515,2519,2524],{"type":170,"tag":222,"props":2507,"children":2508},{"style":596},[2509],{"type":175,"value":866},{"type":170,"tag":222,"props":2511,"children":2512},{"style":596},[2513],{"type":175,"value":2514}," new",{"type":170,"tag":222,"props":2516,"children":2517},{"style":229},[2518],{"type":175,"value":894},{"type":170,"tag":222,"props":2520,"children":2521},{"style":335},[2522],{"type":175,"value":2523},"()",{"type":170,"tag":222,"props":2525,"children":2526},{"style":320},[2527],{"type":175,"value":1553},{"type":170,"tag":222,"props":2529,"children":2530},{"class":224,"line":357},[2531],{"type":170,"tag":222,"props":2532,"children":2533},{"style":320},[2534],{"type":175,"value":1626},{"type":170,"tag":222,"props":2536,"children":2537},{"class":224,"line":376},[2538,2542,2546],{"type":170,"tag":222,"props":2539,"children":2540},{"style":320},[2541],{"type":175,"value":382},{"type":170,"tag":222,"props":2543,"children":2544},{"style":235},[2545],{"type":175,"value":1639},{"type":170,"tag":222,"props":2547,"children":2548},{"style":320},[2549],{"type":175,"value":1553},{"type":170,"tag":171,"props":2551,"children":2552},{},[2553,2559],{"type":170,"tag":186,"props":2554,"children":2556},{"className":2555},[],[2557],{"type":175,"value":2558},"new Function()",{"type":175,"value":2560}," 即模板解析的核心内容，原理是用一个数组，保存所有解析内容，再拼接回字符串，作为 JS 执行。类似 eval 函数。",{"type":170,"tag":212,"props":2562,"children":2564},{"className":214,"code":2563,"language":216,"meta":164,"style":164},"new Function(\n  \"obj\",\n  \"var p=[];\" +\n    // + '...'\n    \"return p.join('')\"\n);\n",[2565],{"type":170,"tag":186,"props":2566,"children":2567},{"__ignoreMap":164},[2568,2584,2604,2624,2632,2649],{"type":170,"tag":222,"props":2569,"children":2570},{"class":224,"line":225},[2571,2576,2580],{"type":170,"tag":222,"props":2572,"children":2573},{"style":596},[2574],{"type":175,"value":2575},"new",{"type":170,"tag":222,"props":2577,"children":2578},{"style":229},[2579],{"type":175,"value":894},{"type":170,"tag":222,"props":2581,"children":2582},{"style":235},[2583],{"type":175,"value":899},{"type":170,"tag":222,"props":2585,"children":2586},{"class":224,"line":247},[2587,2592,2596,2600],{"type":170,"tag":222,"props":2588,"children":2589},{"style":241},[2590],{"type":175,"value":2591},"  \"",{"type":170,"tag":222,"props":2593,"children":2594},{"style":251},[2595],{"type":175,"value":913},{"type":170,"tag":222,"props":2597,"children":2598},{"style":241},[2599],{"type":175,"value":918},{"type":170,"tag":222,"props":2601,"children":2602},{"style":320},[2603],{"type":175,"value":354},{"type":170,"tag":222,"props":2605,"children":2606},{"class":224,"line":257},[2607,2611,2616,2620],{"type":170,"tag":222,"props":2608,"children":2609},{"style":241},[2610],{"type":175,"value":2591},{"type":170,"tag":222,"props":2612,"children":2613},{"style":251},[2614],{"type":175,"value":2615},"var p=[];",{"type":170,"tag":222,"props":2617,"children":2618},{"style":241},[2619],{"type":175,"value":918},{"type":170,"tag":222,"props":2621,"children":2622},{"style":596},[2623],{"type":175,"value":944},{"type":170,"tag":222,"props":2625,"children":2626},{"class":224,"line":266},[2627],{"type":170,"tag":222,"props":2628,"children":2629},{"style":414},[2630],{"type":175,"value":2631},"    // + '...'\n",{"type":170,"tag":222,"props":2633,"children":2634},{"class":224,"line":275},[2635,2640,2645],{"type":170,"tag":222,"props":2636,"children":2637},{"style":241},[2638],{"type":175,"value":2639},"    \"",{"type":170,"tag":222,"props":2641,"children":2642},{"style":251},[2643],{"type":175,"value":2644},"return p.join('')",{"type":170,"tag":222,"props":2646,"children":2647},{"style":241},[2648],{"type":175,"value":1539},{"type":170,"tag":222,"props":2650,"children":2651},{"class":224,"line":284},[2652,2656],{"type":170,"tag":222,"props":2653,"children":2654},{"style":235},[2655],{"type":175,"value":670},{"type":170,"tag":222,"props":2657,"children":2658},{"style":320},[2659],{"type":175,"value":1553},{"type":170,"tag":171,"props":2661,"children":2662},{},[2663,2665,2671],{"type":175,"value":2664},"要解析什么内容呢？无非是 ",{"type":170,"tag":186,"props":2666,"children":2668},{"className":2667},[],[2669],{"type":175,"value":2670},"\u003C%=hello%>",{"type":175,"value":2672}," 这种模板字符串。执行过程中，通过 with 语句，将内部变量的求值（hello）转移到参数对象（data.hello）。这个玩意儿在 VueJS 的模板编译中也用到过：",{"type":170,"tag":212,"props":2674,"children":2676},{"className":214,"code":2675,"language":216,"meta":164,"style":164},"/* VueJS */\nwith (vm) {\n  return createVNode(\"p\", { attrs: { hi: hello /* vm.hello */ } }, [\n    createTextNode(\"Hello World\"),\n  ]);\n}\n",[2677],{"type":170,"tag":186,"props":2678,"children":2679},{"__ignoreMap":164},[2680,2688,2706,2791,2824,2836],{"type":170,"tag":222,"props":2681,"children":2682},{"class":224,"line":225},[2683],{"type":170,"tag":222,"props":2684,"children":2685},{"style":414},[2686],{"type":175,"value":2687},"/* VueJS */\n",{"type":170,"tag":222,"props":2689,"children":2690},{"class":224,"line":247},[2691,2696,2701],{"type":170,"tag":222,"props":2692,"children":2693},{"style":1155},[2694],{"type":175,"value":2695},"with",{"type":170,"tag":222,"props":2697,"children":2698},{"style":235},[2699],{"type":175,"value":2700}," (vm) ",{"type":170,"tag":222,"props":2702,"children":2703},{"style":320},[2704],{"type":175,"value":2705},"{\n",{"type":170,"tag":222,"props":2707,"children":2708},{"class":224,"line":257},[2709,2714,2719,2723,2727,2731,2735,2739,2744,2749,2753,2757,2762,2766,2771,2776,2781,2786],{"type":170,"tag":222,"props":2710,"children":2711},{"style":1155},[2712],{"type":175,"value":2713},"  return",{"type":170,"tag":222,"props":2715,"children":2716},{"style":229},[2717],{"type":175,"value":2718}," createVNode",{"type":170,"tag":222,"props":2720,"children":2721},{"style":335},[2722],{"type":175,"value":238},{"type":170,"tag":222,"props":2724,"children":2725},{"style":241},[2726],{"type":175,"value":918},{"type":170,"tag":222,"props":2728,"children":2729},{"style":251},[2730],{"type":175,"value":171},{"type":170,"tag":222,"props":2732,"children":2733},{"style":241},[2734],{"type":175,"value":918},{"type":170,"tag":222,"props":2736,"children":2737},{"style":320},[2738],{"type":175,"value":323},{"type":170,"tag":222,"props":2740,"children":2741},{"style":320},[2742],{"type":175,"value":2743}," {",{"type":170,"tag":222,"props":2745,"children":2746},{"style":335},[2747],{"type":175,"value":2748}," attrs",{"type":170,"tag":222,"props":2750,"children":2751},{"style":320},[2752],{"type":175,"value":343},{"type":170,"tag":222,"props":2754,"children":2755},{"style":320},[2756],{"type":175,"value":2743},{"type":170,"tag":222,"props":2758,"children":2759},{"style":335},[2760],{"type":175,"value":2761}," hi",{"type":170,"tag":222,"props":2763,"children":2764},{"style":320},[2765],{"type":175,"value":343},{"type":170,"tag":222,"props":2767,"children":2768},{"style":235},[2769],{"type":175,"value":2770}," hello",{"type":170,"tag":222,"props":2772,"children":2773},{"style":414},[2774],{"type":175,"value":2775}," /* vm.hello */",{"type":170,"tag":222,"props":2777,"children":2778},{"style":320},[2779],{"type":175,"value":2780}," }",{"type":170,"tag":222,"props":2782,"children":2783},{"style":320},[2784],{"type":175,"value":2785}," },",{"type":170,"tag":222,"props":2787,"children":2788},{"style":335},[2789],{"type":175,"value":2790}," [\n",{"type":170,"tag":222,"props":2792,"children":2793},{"class":224,"line":266},[2794,2799,2803,2807,2812,2816,2820],{"type":170,"tag":222,"props":2795,"children":2796},{"style":229},[2797],{"type":175,"value":2798},"    createTextNode",{"type":170,"tag":222,"props":2800,"children":2801},{"style":335},[2802],{"type":175,"value":238},{"type":170,"tag":222,"props":2804,"children":2805},{"style":241},[2806],{"type":175,"value":918},{"type":170,"tag":222,"props":2808,"children":2809},{"style":251},[2810],{"type":175,"value":2811},"Hello World",{"type":170,"tag":222,"props":2813,"children":2814},{"style":241},[2815],{"type":175,"value":918},{"type":170,"tag":222,"props":2817,"children":2818},{"style":335},[2819],{"type":175,"value":670},{"type":170,"tag":222,"props":2821,"children":2822},{"style":320},[2823],{"type":175,"value":354},{"type":170,"tag":222,"props":2825,"children":2826},{"class":224,"line":275},[2827,2832],{"type":170,"tag":222,"props":2828,"children":2829},{"style":335},[2830],{"type":175,"value":2831},"  ])",{"type":170,"tag":222,"props":2833,"children":2834},{"style":320},[2835],{"type":175,"value":1553},{"type":170,"tag":222,"props":2837,"children":2838},{"class":224,"line":284},[2839],{"type":170,"tag":222,"props":2840,"children":2841},{"style":320},[2842],{"type":175,"value":2843},"}\n",{"type":170,"tag":171,"props":2845,"children":2846},{},[2847],{"type":175,"value":2848},"那如何解析呢？",{"type":170,"tag":171,"props":2850,"children":2851},{},[2852,2858,2860,2866],{"type":170,"tag":2853,"props":2854,"children":2855},"del",{},[2856],{"type":175,"value":2857},"我们知道",{"type":175,"value":2859},"曾写过经典字符串模板的佬应该知道，",{"type":170,"tag":2861,"props":2862,"children":2863},"strong",{},[2864],{"type":175,"value":2865},"模板字符串一般包含：字符串、变量及逻辑",{"type":175,"value":2867},"。",{"type":170,"tag":2869,"props":2870,"children":2871},"ul",{},[2872,2884,2895],{"type":170,"tag":2873,"props":2874,"children":2875},"li",{},[2876,2878],{"type":175,"value":2877},"字符串 ",{"type":170,"tag":186,"props":2879,"children":2881},{"className":2880},[],[2882],{"type":175,"value":2883},"\u003Chtml>Lionad\u003C/html>",{"type":170,"tag":2873,"props":2885,"children":2886},{},[2887,2889],{"type":175,"value":2888},"带变量 ",{"type":170,"tag":186,"props":2890,"children":2892},{"className":2891},[],[2893],{"type":175,"value":2894},"\u003Chtml>\u003C%=name%>\u003C/html>",{"type":170,"tag":2873,"props":2896,"children":2897},{},[2898,2900,2906],{"type":175,"value":2899},"带逻辑 ",{"type":170,"tag":186,"props":2901,"children":2903},{"className":2902},[],[2904],{"type":175,"value":2905},"\u003C% if(name){ %>\u003Chtml>\u003C%=name%>\u003C/html>\u003C% } %>",{"type":175,"value":2867},{"type":170,"tag":171,"props":2908,"children":2909},{},[2910],{"type":175,"value":2911},"所以解析模板，无非就是把这三种字符串替换成纯粹的 JS 逻辑，作为 new Function 的参数。其中所有中间变量，可以用一个数组来储存：",{"type":170,"tag":2869,"props":2913,"children":2914},{},[2915,2934,2952],{"type":170,"tag":2873,"props":2916,"children":2917},{},[2918,2920,2925,2927,2933],{"type":175,"value":2919},"将普通字符串直接推入作为结果的内容数组，比如 ",{"type":170,"tag":186,"props":2921,"children":2923},{"className":2922},[],[2924],{"type":175,"value":2883},{"type":175,"value":2926}," 应该被解析为 ",{"type":170,"tag":186,"props":2928,"children":2930},{"className":2929},[],[2931],{"type":175,"value":2932},"p.push('\u003Chtml>Lionad\u003C/html>')",{"type":175,"value":2867},{"type":170,"tag":2873,"props":2935,"children":2936},{},[2937,2939,2944,2945,2951],{"type":175,"value":2938},"如果碰到变量，则将变量拆分出来推入数组，如 ",{"type":170,"tag":186,"props":2940,"children":2942},{"className":2941},[],[2943],{"type":175,"value":2894},{"type":175,"value":2926},{"type":170,"tag":186,"props":2946,"children":2948},{"className":2947},[],[2949],{"type":175,"value":2950},"p.push('\u003Chtml>');p.push(name);p.push('\u003C/html>')",{"type":175,"value":2867},{"type":170,"tag":2873,"props":2953,"children":2954},{},[2955,2957,2963,2965,2970,2972,2978],{"type":175,"value":2956},"带逻辑的字符串，由于逻辑本身就是 JS 代码，所以不需要解析为字符串，只需要把两侧的 ",{"type":170,"tag":186,"props":2958,"children":2960},{"className":2959},[],[2961],{"type":175,"value":2962},"\u003C% %>",{"type":175,"value":2964}," 这种模板标志去掉就好了。如 ",{"type":170,"tag":186,"props":2966,"children":2968},{"className":2967},[],[2969],{"type":175,"value":2905},{"type":175,"value":2971}," 应该被解析为：",{"type":170,"tag":186,"props":2973,"children":2975},{"className":2974},[],[2976],{"type":175,"value":2977},"if(name){ p.push('\u003Chtml>');p.push(name);p.push('\u003C/html>') } ",{"type":175,"value":2867},{"type":170,"tag":171,"props":2980,"children":2981},{},[2982],{"type":175,"value":2983},"以下面这段模板为例，我们看看字符串具体的替换规则。",{"type":170,"tag":212,"props":2985,"children":2987},{"className":214,"code":2986,"language":216,"meta":164,"style":164},"str = `\u003C% if (true) { %>\n    \u003Cli>\u003C%=users[i]%>\u003C/li>\n\u003C% } %>`;\n",[2988],{"type":170,"tag":186,"props":2989,"children":2990},{"__ignoreMap":164},[2991,3013,3021],{"type":170,"tag":222,"props":2992,"children":2993},{"class":224,"line":225},[2994,2999,3003,3008],{"type":170,"tag":222,"props":2995,"children":2996},{"style":235},[2997],{"type":175,"value":2998},"str ",{"type":170,"tag":222,"props":3000,"children":3001},{"style":596},[3002],{"type":175,"value":1266},{"type":170,"tag":222,"props":3004,"children":3005},{"style":241},[3006],{"type":175,"value":3007}," `",{"type":170,"tag":222,"props":3009,"children":3010},{"style":251},[3011],{"type":175,"value":3012},"\u003C% if (true) { %>\n",{"type":170,"tag":222,"props":3014,"children":3015},{"class":224,"line":247},[3016],{"type":170,"tag":222,"props":3017,"children":3018},{"style":251},[3019],{"type":175,"value":3020},"    \u003Cli>\u003C%=users[i]%>\u003C/li>\n",{"type":170,"tag":222,"props":3022,"children":3023},{"class":224,"line":257},[3024,3029,3033],{"type":170,"tag":222,"props":3025,"children":3026},{"style":251},[3027],{"type":175,"value":3028},"\u003C% } %>",{"type":170,"tag":222,"props":3030,"children":3031},{"style":241},[3032],{"type":175,"value":317},{"type":170,"tag":222,"props":3034,"children":3035},{"style":320},[3036],{"type":175,"value":1553},{"type":170,"tag":212,"props":3038,"children":3040},{"className":214,"code":3039,"language":216,"meta":164,"style":164},"// with 的使用方法都知道了，with(obj = { a })，那么\n// 就能在内部直接读取 a，不需要写 obj.a\n\"with(obj){p.push('\" +\n  str\n    // 将换行等空白字符转换为空格，这样所有代码都在一行了\n    // '\u003C% if (true) { %>     \u003Cli>\u003C%=users[i]%>\u003C/li> \u003C% } %>'\n    .replace(/[\\r\\t\\n]/g, \" \")\n    // ['', 'if (true) { %>\u003Cli>', '=users[i]%>\u003C/li>', ' } %>']\n    .split(\"\u003C%\")\n    // 因为 \\t 刚才已经被替换成空格了，所以这里可以使用 \\t 用来将不同行的代码字符串“相加”，\n    // 一会儿再拆分时，不会和原先字符串里的字符混淆\n    .join(\"\\t\")\n    // 去掉模板标志两端的引号，在这个例子里不会用到\n    .replace(/((^|%>)[^\\t]*)'/g, \"$1\\r\")\n    // 以下三句最重要，将所有变量推入数组，生成结果形如 `push('xxx',x,'xxx')` 的字符串\n    // 首先，刚才匹配完了 \u003C%，所以 \\t= 开头后边接的就是变量，这里让它转换成 ',x,' 的形式\n    .replace(/\\t=(.*?)%>/g, \"',$1,'\")\n    .split(\"\\t\")\n    // 在刚刚跟 split('\u003C%') 的位置用括号还原，得到了 ',x,'xxx'); 的形式\n    .join(\"');\")\n    // 在 \\t=xxx 那次匹配，已经把变量模板对应的结束标志 %> 匹配完了，\n    // 所以这是处理剩余语句的结束标志，用 split 拆分行后相当于直接把结束标记舍弃了\n    .split(\"%>\")\n    // 最终在每行开头增加 push 方法，形成了 push('xxx',x,'xxx'); 的形式\n    .join(\"p.push('\")\n    // 处理剩余的换行符\n    .split(\"\\r\")\n    .join(\"\\\\'\") +\n  \"');}\";\n",[3041],{"type":170,"tag":186,"props":3042,"children":3043},{"__ignoreMap":164},[3044,3052,3060,3079,3087,3095,3103,3159,3167,3198,3206,3214,3245,3253,3352,3360,3368,3443,3474,3482,3513,3521,3529,3560,3568,3599,3607,3638,3677],{"type":170,"tag":222,"props":3045,"children":3046},{"class":224,"line":225},[3047],{"type":170,"tag":222,"props":3048,"children":3049},{"style":414},[3050],{"type":175,"value":3051},"// with 的使用方法都知道了，with(obj = { a })，那么\n",{"type":170,"tag":222,"props":3053,"children":3054},{"class":224,"line":247},[3055],{"type":170,"tag":222,"props":3056,"children":3057},{"style":414},[3058],{"type":175,"value":3059},"// 就能在内部直接读取 a，不需要写 obj.a\n",{"type":170,"tag":222,"props":3061,"children":3062},{"class":224,"line":257},[3063,3067,3071,3075],{"type":170,"tag":222,"props":3064,"children":3065},{"style":241},[3066],{"type":175,"value":918},{"type":170,"tag":222,"props":3068,"children":3069},{"style":251},[3070],{"type":175,"value":967},{"type":170,"tag":222,"props":3072,"children":3073},{"style":241},[3074],{"type":175,"value":918},{"type":170,"tag":222,"props":3076,"children":3077},{"style":596},[3078],{"type":175,"value":944},{"type":170,"tag":222,"props":3080,"children":3081},{"class":224,"line":266},[3082],{"type":170,"tag":222,"props":3083,"children":3084},{"style":235},[3085],{"type":175,"value":3086},"  str\n",{"type":170,"tag":222,"props":3088,"children":3089},{"class":224,"line":275},[3090],{"type":170,"tag":222,"props":3091,"children":3092},{"style":414},[3093],{"type":175,"value":3094},"    // 将换行等空白字符转换为空格，这样所有代码都在一行了\n",{"type":170,"tag":222,"props":3096,"children":3097},{"class":224,"line":284},[3098],{"type":170,"tag":222,"props":3099,"children":3100},{"style":414},[3101],{"type":175,"value":3102},"    // '\u003C% if (true) { %>     \u003Cli>\u003C%=users[i]%>\u003C/li> \u003C% } %>'\n",{"type":170,"tag":222,"props":3104,"children":3105},{"class":224,"line":293},[3106,3111,3115,3119,3123,3127,3131,3135,3139,3143,3147,3151,3155],{"type":170,"tag":222,"props":3107,"children":3108},{"style":320},[3109],{"type":175,"value":3110},"    .",{"type":170,"tag":222,"props":3112,"children":3113},{"style":229},[3114],{"type":175,"value":1007},{"type":170,"tag":222,"props":3116,"children":3117},{"style":235},[3118],{"type":175,"value":238},{"type":170,"tag":222,"props":3120,"children":3121},{"style":241},[3122],{"type":175,"value":717},{"type":170,"tag":222,"props":3124,"children":3125},{"style":1018},[3126],{"type":175,"value":771},{"type":170,"tag":222,"props":3128,"children":3129},{"style":720},[3130],{"type":175,"value":1025},{"type":170,"tag":222,"props":3132,"children":3133},{"style":1018},[3134],{"type":175,"value":1030},{"type":170,"tag":222,"props":3136,"children":3137},{"style":241},[3138],{"type":175,"value":717},{"type":170,"tag":222,"props":3140,"children":3141},{"style":1037},[3142],{"type":175,"value":1040},{"type":170,"tag":222,"props":3144,"children":3145},{"style":320},[3146],{"type":175,"value":323},{"type":170,"tag":222,"props":3148,"children":3149},{"style":241},[3150],{"type":175,"value":1049},{"type":170,"tag":222,"props":3152,"children":3153},{"style":241},[3154],{"type":175,"value":1049},{"type":170,"tag":222,"props":3156,"children":3157},{"style":235},[3158],{"type":175,"value":387},{"type":170,"tag":222,"props":3160,"children":3161},{"class":224,"line":302},[3162],{"type":170,"tag":222,"props":3163,"children":3164},{"style":414},[3165],{"type":175,"value":3166},"    // ['', 'if (true) { %>\u003Cli>', '=users[i]%>\u003C/li>', ' } %>']\n",{"type":170,"tag":222,"props":3168,"children":3169},{"class":224,"line":311},[3170,3174,3178,3182,3186,3190,3194],{"type":170,"tag":222,"props":3171,"children":3172},{"style":320},[3173],{"type":175,"value":3110},{"type":170,"tag":222,"props":3175,"children":3176},{"style":229},[3177],{"type":175,"value":1070},{"type":170,"tag":222,"props":3179,"children":3180},{"style":235},[3181],{"type":175,"value":238},{"type":170,"tag":222,"props":3183,"children":3184},{"style":241},[3185],{"type":175,"value":918},{"type":170,"tag":222,"props":3187,"children":3188},{"style":251},[3189],{"type":175,"value":1083},{"type":170,"tag":222,"props":3191,"children":3192},{"style":241},[3193],{"type":175,"value":918},{"type":170,"tag":222,"props":3195,"children":3196},{"style":235},[3197],{"type":175,"value":387},{"type":170,"tag":222,"props":3199,"children":3200},{"class":224,"line":331},[3201],{"type":170,"tag":222,"props":3202,"children":3203},{"style":414},[3204],{"type":175,"value":3205},"    // 因为 \\t 刚才已经被替换成空格了，所以这里可以使用 \\t 用来将不同行的代码字符串“相加”，\n",{"type":170,"tag":222,"props":3207,"children":3208},{"class":224,"line":357},[3209],{"type":170,"tag":222,"props":3210,"children":3211},{"style":414},[3212],{"type":175,"value":3213},"    // 一会儿再拆分时，不会和原先字符串里的字符混淆\n",{"type":170,"tag":222,"props":3215,"children":3216},{"class":224,"line":376},[3217,3221,3225,3229,3233,3237,3241],{"type":170,"tag":222,"props":3218,"children":3219},{"style":320},[3220],{"type":175,"value":3110},{"type":170,"tag":222,"props":3222,"children":3223},{"style":229},[3224],{"type":175,"value":1104},{"type":170,"tag":222,"props":3226,"children":3227},{"style":235},[3228],{"type":175,"value":238},{"type":170,"tag":222,"props":3230,"children":3231},{"style":241},[3232],{"type":175,"value":918},{"type":170,"tag":222,"props":3234,"children":3235},{"style":1115},[3236],{"type":175,"value":1118},{"type":170,"tag":222,"props":3238,"children":3239},{"style":241},[3240],{"type":175,"value":918},{"type":170,"tag":222,"props":3242,"children":3243},{"style":235},[3244],{"type":175,"value":387},{"type":170,"tag":222,"props":3246,"children":3247},{"class":224,"line":874},[3248],{"type":170,"tag":222,"props":3249,"children":3250},{"style":414},[3251],{"type":175,"value":3252},"    // 去掉模板标志两端的引号，在这个例子里不会用到\n",{"type":170,"tag":222,"props":3254,"children":3255},{"class":224,"line":883},[3256,3260,3264,3268,3272,3276,3280,3284,3288,3292,3296,3300,3304,3308,3312,3316,3320,3324,3328,3332,3336,3340,3344,3348],{"type":170,"tag":222,"props":3257,"children":3258},{"style":320},[3259],{"type":175,"value":3110},{"type":170,"tag":222,"props":3261,"children":3262},{"style":229},[3263],{"type":175,"value":1007},{"type":170,"tag":222,"props":3265,"children":3266},{"style":235},[3267],{"type":175,"value":238},{"type":170,"tag":222,"props":3269,"children":3270},{"style":241},[3271],{"type":175,"value":717},{"type":170,"tag":222,"props":3273,"children":3274},{"style":1149},[3275],{"type":175,"value":1152},{"type":170,"tag":222,"props":3277,"children":3278},{"style":1155},[3279],{"type":175,"value":1158},{"type":170,"tag":222,"props":3281,"children":3282},{"style":596},[3283],{"type":175,"value":1163},{"type":170,"tag":222,"props":3285,"children":3286},{"style":1166},[3287],{"type":175,"value":1169},{"type":170,"tag":222,"props":3289,"children":3290},{"style":1149},[3291],{"type":175,"value":670},{"type":170,"tag":222,"props":3293,"children":3294},{"style":1018},[3295],{"type":175,"value":771},{"type":170,"tag":222,"props":3297,"children":3298},{"style":596},[3299],{"type":175,"value":1158},{"type":170,"tag":222,"props":3301,"children":3302},{"style":720},[3303],{"type":175,"value":1118},{"type":170,"tag":222,"props":3305,"children":3306},{"style":1018},[3307],{"type":175,"value":1030},{"type":170,"tag":222,"props":3309,"children":3310},{"style":596},[3311],{"type":175,"value":1194},{"type":170,"tag":222,"props":3313,"children":3314},{"style":1149},[3315],{"type":175,"value":670},{"type":170,"tag":222,"props":3317,"children":3318},{"style":1166},[3319],{"type":175,"value":1203},{"type":170,"tag":222,"props":3321,"children":3322},{"style":241},[3323],{"type":175,"value":717},{"type":170,"tag":222,"props":3325,"children":3326},{"style":1037},[3327],{"type":175,"value":1040},{"type":170,"tag":222,"props":3329,"children":3330},{"style":320},[3331],{"type":175,"value":323},{"type":170,"tag":222,"props":3333,"children":3334},{"style":241},[3335],{"type":175,"value":1049},{"type":170,"tag":222,"props":3337,"children":3338},{"style":251},[3339],{"type":175,"value":1224},{"type":170,"tag":222,"props":3341,"children":3342},{"style":1115},[3343],{"type":175,"value":1229},{"type":170,"tag":222,"props":3345,"children":3346},{"style":241},[3347],{"type":175,"value":918},{"type":170,"tag":222,"props":3349,"children":3350},{"style":235},[3351],{"type":175,"value":387},{"type":170,"tag":222,"props":3353,"children":3354},{"class":224,"line":902},[3355],{"type":170,"tag":222,"props":3356,"children":3357},{"style":414},[3358],{"type":175,"value":3359},"    // 以下三句最重要，将所有变量推入数组，生成结果形如 `push('xxx',x,'xxx')` 的字符串\n",{"type":170,"tag":222,"props":3361,"children":3362},{"class":224,"line":925},[3363],{"type":170,"tag":222,"props":3364,"children":3365},{"style":414},[3366],{"type":175,"value":3367},"    // 首先，刚才匹配完了 \u003C%，所以 \\t= 开头后边接的就是变量，这里让它转换成 ',x,' 的形式\n",{"type":170,"tag":222,"props":3369,"children":3370},{"class":224,"line":947},[3371,3375,3379,3383,3387,3391,3395,3399,3403,3407,3411,3415,3419,3423,3427,3431,3435,3439],{"type":170,"tag":222,"props":3372,"children":3373},{"style":320},[3374],{"type":175,"value":3110},{"type":170,"tag":222,"props":3376,"children":3377},{"style":229},[3378],{"type":175,"value":1007},{"type":170,"tag":222,"props":3380,"children":3381},{"style":235},[3382],{"type":175,"value":238},{"type":170,"tag":222,"props":3384,"children":3385},{"style":241},[3386],{"type":175,"value":717},{"type":170,"tag":222,"props":3388,"children":3389},{"style":720},[3390],{"type":175,"value":1118},{"type":170,"tag":222,"props":3392,"children":3393},{"style":1166},[3394],{"type":175,"value":1266},{"type":170,"tag":222,"props":3396,"children":3397},{"style":1149},[3398],{"type":175,"value":238},{"type":170,"tag":222,"props":3400,"children":3401},{"style":720},[3402],{"type":175,"value":627},{"type":170,"tag":222,"props":3404,"children":3405},{"style":596},[3406],{"type":175,"value":1279},{"type":170,"tag":222,"props":3408,"children":3409},{"style":1149},[3410],{"type":175,"value":670},{"type":170,"tag":222,"props":3412,"children":3413},{"style":1166},[3414],{"type":175,"value":1169},{"type":170,"tag":222,"props":3416,"children":3417},{"style":241},[3418],{"type":175,"value":717},{"type":170,"tag":222,"props":3420,"children":3421},{"style":1037},[3422],{"type":175,"value":1040},{"type":170,"tag":222,"props":3424,"children":3425},{"style":320},[3426],{"type":175,"value":323},{"type":170,"tag":222,"props":3428,"children":3429},{"style":241},[3430],{"type":175,"value":1049},{"type":170,"tag":222,"props":3432,"children":3433},{"style":251},[3434],{"type":175,"value":1308},{"type":170,"tag":222,"props":3436,"children":3437},{"style":241},[3438],{"type":175,"value":918},{"type":170,"tag":222,"props":3440,"children":3441},{"style":235},[3442],{"type":175,"value":387},{"type":170,"tag":222,"props":3444,"children":3445},{"class":224,"line":956},[3446,3450,3454,3458,3462,3466,3470],{"type":170,"tag":222,"props":3447,"children":3448},{"style":320},[3449],{"type":175,"value":3110},{"type":170,"tag":222,"props":3451,"children":3452},{"style":229},[3453],{"type":175,"value":1070},{"type":170,"tag":222,"props":3455,"children":3456},{"style":235},[3457],{"type":175,"value":238},{"type":170,"tag":222,"props":3459,"children":3460},{"style":241},[3461],{"type":175,"value":918},{"type":170,"tag":222,"props":3463,"children":3464},{"style":1115},[3465],{"type":175,"value":1118},{"type":170,"tag":222,"props":3467,"children":3468},{"style":241},[3469],{"type":175,"value":918},{"type":170,"tag":222,"props":3471,"children":3472},{"style":235},[3473],{"type":175,"value":387},{"type":170,"tag":222,"props":3475,"children":3476},{"class":224,"line":978},[3477],{"type":170,"tag":222,"props":3478,"children":3479},{"style":414},[3480],{"type":175,"value":3481},"    // 在刚刚跟 split('\u003C%') 的位置用括号还原，得到了 ',x,'xxx'); 的形式\n",{"type":170,"tag":222,"props":3483,"children":3484},{"class":224,"line":987},[3485,3489,3493,3497,3501,3505,3509],{"type":170,"tag":222,"props":3486,"children":3487},{"style":320},[3488],{"type":175,"value":3110},{"type":170,"tag":222,"props":3490,"children":3491},{"style":229},[3492],{"type":175,"value":1104},{"type":170,"tag":222,"props":3494,"children":3495},{"style":235},[3496],{"type":175,"value":238},{"type":170,"tag":222,"props":3498,"children":3499},{"style":241},[3500],{"type":175,"value":918},{"type":170,"tag":222,"props":3502,"children":3503},{"style":251},[3504],{"type":175,"value":1373},{"type":170,"tag":222,"props":3506,"children":3507},{"style":241},[3508],{"type":175,"value":918},{"type":170,"tag":222,"props":3510,"children":3511},{"style":235},[3512],{"type":175,"value":387},{"type":170,"tag":222,"props":3514,"children":3515},{"class":224,"line":996},[3516],{"type":170,"tag":222,"props":3517,"children":3518},{"style":414},[3519],{"type":175,"value":3520},"    // 在 \\t=xxx 那次匹配，已经把变量模板对应的结束标志 %> 匹配完了，\n",{"type":170,"tag":222,"props":3522,"children":3523},{"class":224,"line":1060},[3524],{"type":170,"tag":222,"props":3525,"children":3526},{"style":414},[3527],{"type":175,"value":3528},"    // 所以这是处理剩余语句的结束标志，用 split 拆分行后相当于直接把结束标记舍弃了\n",{"type":170,"tag":222,"props":3530,"children":3531},{"class":224,"line":1094},[3532,3536,3540,3544,3548,3552,3556],{"type":170,"tag":222,"props":3533,"children":3534},{"style":320},[3535],{"type":175,"value":3110},{"type":170,"tag":222,"props":3537,"children":3538},{"style":229},[3539],{"type":175,"value":1070},{"type":170,"tag":222,"props":3541,"children":3542},{"style":235},[3543],{"type":175,"value":238},{"type":170,"tag":222,"props":3545,"children":3546},{"style":241},[3547],{"type":175,"value":918},{"type":170,"tag":222,"props":3549,"children":3550},{"style":251},[3551],{"type":175,"value":1169},{"type":170,"tag":222,"props":3553,"children":3554},{"style":241},[3555],{"type":175,"value":918},{"type":170,"tag":222,"props":3557,"children":3558},{"style":235},[3559],{"type":175,"value":387},{"type":170,"tag":222,"props":3561,"children":3562},{"class":224,"line":1129},[3563],{"type":170,"tag":222,"props":3564,"children":3565},{"style":414},[3566],{"type":175,"value":3567},"    // 最终在每行开头增加 push 方法，形成了 push('xxx',x,'xxx'); 的形式\n",{"type":170,"tag":222,"props":3569,"children":3570},{"class":224,"line":1240},[3571,3575,3579,3583,3587,3591,3595],{"type":170,"tag":222,"props":3572,"children":3573},{"style":320},[3574],{"type":175,"value":3110},{"type":170,"tag":222,"props":3576,"children":3577},{"style":229},[3578],{"type":175,"value":1104},{"type":170,"tag":222,"props":3580,"children":3581},{"style":235},[3582],{"type":175,"value":238},{"type":170,"tag":222,"props":3584,"children":3585},{"style":241},[3586],{"type":175,"value":918},{"type":170,"tag":222,"props":3588,"children":3589},{"style":251},[3590],{"type":175,"value":1438},{"type":170,"tag":222,"props":3592,"children":3593},{"style":241},[3594],{"type":175,"value":918},{"type":170,"tag":222,"props":3596,"children":3597},{"style":235},[3598],{"type":175,"value":387},{"type":170,"tag":222,"props":3600,"children":3601},{"class":224,"line":1319},[3602],{"type":170,"tag":222,"props":3603,"children":3604},{"style":414},[3605],{"type":175,"value":3606},"    // 处理剩余的换行符\n",{"type":170,"tag":222,"props":3608,"children":3609},{"class":224,"line":1351},[3610,3614,3618,3622,3626,3630,3634],{"type":170,"tag":222,"props":3611,"children":3612},{"style":320},[3613],{"type":175,"value":3110},{"type":170,"tag":222,"props":3615,"children":3616},{"style":229},[3617],{"type":175,"value":1070},{"type":170,"tag":222,"props":3619,"children":3620},{"style":235},[3621],{"type":175,"value":238},{"type":170,"tag":222,"props":3623,"children":3624},{"style":241},[3625],{"type":175,"value":918},{"type":170,"tag":222,"props":3627,"children":3628},{"style":1115},[3629],{"type":175,"value":1229},{"type":170,"tag":222,"props":3631,"children":3632},{"style":241},[3633],{"type":175,"value":918},{"type":170,"tag":222,"props":3635,"children":3636},{"style":235},[3637],{"type":175,"value":387},{"type":170,"tag":222,"props":3639,"children":3640},{"class":224,"line":1384},[3641,3645,3649,3653,3657,3661,3665,3669,3673],{"type":170,"tag":222,"props":3642,"children":3643},{"style":320},[3644],{"type":175,"value":3110},{"type":170,"tag":222,"props":3646,"children":3647},{"style":229},[3648],{"type":175,"value":1104},{"type":170,"tag":222,"props":3650,"children":3651},{"style":235},[3652],{"type":175,"value":238},{"type":170,"tag":222,"props":3654,"children":3655},{"style":241},[3656],{"type":175,"value":918},{"type":170,"tag":222,"props":3658,"children":3659},{"style":1115},[3660],{"type":175,"value":1503},{"type":170,"tag":222,"props":3662,"children":3663},{"style":251},[3664],{"type":175,"value":1203},{"type":170,"tag":222,"props":3666,"children":3667},{"style":241},[3668],{"type":175,"value":918},{"type":170,"tag":222,"props":3670,"children":3671},{"style":235},[3672],{"type":175,"value":1516},{"type":170,"tag":222,"props":3674,"children":3675},{"style":596},[3676],{"type":175,"value":1521},{"type":170,"tag":222,"props":3678,"children":3679},{"class":224,"line":1416},[3680,3684,3689,3693],{"type":170,"tag":222,"props":3681,"children":3682},{"style":241},[3683],{"type":175,"value":2591},{"type":170,"tag":222,"props":3685,"children":3686},{"style":251},[3687],{"type":175,"value":3688},"');}",{"type":170,"tag":222,"props":3690,"children":3691},{"style":241},[3692],{"type":175,"value":918},{"type":170,"tag":222,"props":3694,"children":3695},{"style":320},[3696],{"type":175,"value":1553},{"type":170,"tag":171,"props":3698,"children":3699},{},[3700,3702,3707,3709,3714,3716,3721,3722,3728,3730,3735,3737,3742],{"type":175,"value":3701},"有一个小细节，字符串替换时，所有逻辑语句的模板标志开头和结尾（",{"type":170,"tag":186,"props":3703,"children":3705},{"className":3704},[],[3706],{"type":175,"value":1083},{"type":175,"value":3708},"、",{"type":170,"tag":186,"props":3710,"children":3712},{"className":3711},[],[3713],{"type":175,"value":1169},{"type":175,"value":3715},"）分别被替换为 ",{"type":170,"tag":186,"props":3717,"children":3719},{"className":3718},[],[3720],{"type":175,"value":1373},{"type":175,"value":3708},{"type":170,"tag":186,"props":3723,"children":3725},{"className":3724},[],[3726],{"type":175,"value":3727},"push('",{"type":175,"value":3729},"，但是开头和结尾的那个标志，并没有对应的匹配。所以在代码中，能看 ",{"type":170,"tag":186,"props":3731,"children":3733},{"className":3732},[],[3734],{"type":175,"value":967},{"type":175,"value":3736}," 和 ",{"type":170,"tag":186,"props":3738,"children":3740},{"className":3739},[],[3741],{"type":175,"value":1373},{"type":175,"value":3743}," 这种手动补全。",{"type":170,"tag":171,"props":3745,"children":3746},{},[3747],{"type":175,"value":3748},"最终生成的字符串如下（已格式化处理）：",{"type":170,"tag":212,"props":3750,"children":3752},{"className":214,"code":3751,"language":216,"meta":164,"style":164},"`with(obj){\n    p.push(''); \n    if (true) { \n        p.push('     \u003Cli>',users[i],'\u003C/li>   '); \n    } \n    p.push('');\n}`;\n",[3753],{"type":170,"tag":186,"props":3754,"children":3755},{"__ignoreMap":164},[3756,3768,3776,3784,3792,3800,3808],{"type":170,"tag":222,"props":3757,"children":3758},{"class":224,"line":225},[3759,3763],{"type":170,"tag":222,"props":3760,"children":3761},{"style":241},[3762],{"type":175,"value":317},{"type":170,"tag":222,"props":3764,"children":3765},{"style":251},[3766],{"type":175,"value":3767},"with(obj){\n",{"type":170,"tag":222,"props":3769,"children":3770},{"class":224,"line":247},[3771],{"type":170,"tag":222,"props":3772,"children":3773},{"style":251},[3774],{"type":175,"value":3775},"    p.push(''); \n",{"type":170,"tag":222,"props":3777,"children":3778},{"class":224,"line":257},[3779],{"type":170,"tag":222,"props":3780,"children":3781},{"style":251},[3782],{"type":175,"value":3783},"    if (true) { \n",{"type":170,"tag":222,"props":3785,"children":3786},{"class":224,"line":266},[3787],{"type":170,"tag":222,"props":3788,"children":3789},{"style":251},[3790],{"type":175,"value":3791},"        p.push('     \u003Cli>',users[i],'\u003C/li>   '); \n",{"type":170,"tag":222,"props":3793,"children":3794},{"class":224,"line":275},[3795],{"type":170,"tag":222,"props":3796,"children":3797},{"style":251},[3798],{"type":175,"value":3799},"    } \n",{"type":170,"tag":222,"props":3801,"children":3802},{"class":224,"line":284},[3803],{"type":170,"tag":222,"props":3804,"children":3805},{"style":251},[3806],{"type":175,"value":3807},"    p.push('');\n",{"type":170,"tag":222,"props":3809,"children":3810},{"class":224,"line":293},[3811,3815,3819],{"type":170,"tag":222,"props":3812,"children":3813},{"style":251},[3814],{"type":175,"value":382},{"type":170,"tag":222,"props":3816,"children":3817},{"style":241},[3818],{"type":175,"value":317},{"type":170,"tag":222,"props":3820,"children":3821},{"style":320},[3822],{"type":175,"value":1553},{"type":170,"tag":171,"props":3824,"children":3825},{},[3826,3828,3834],{"type":175,"value":3827},"为什么 with 语句里有一行空的 ",{"type":170,"tag":186,"props":3829,"children":3831},{"className":3830},[],[3832],{"type":175,"value":3833},"push('')",{"type":175,"value":3835}," 呢？",{"type":170,"tag":171,"props":3837,"children":3838},{},[3839],{"type":175,"value":3840},"还记得原始的模板吗？一开的模板是以“\u003C%”开头的，而“\u003C%”在替换过程被右括号取代了，此时正好和初始字符串结合形成了空 push。如果原始字符串开头是 \"123\u003C% if (true)\"，那这行空 push 会转换成“p.push('123');”，也是正确的代码。",{"type":170,"tag":171,"props":3842,"children":3843},{},[3844],{"type":175,"value":3845},"最后，micro-templating 需要返回这个新函数。如果不传参数 data 给模板函数，则会返回一个部分应用的函数等待用户输入 data 参数再执行模板解析；如果已经传了 data 那就会立即调用返回模板解析的结果。",{"type":170,"tag":212,"props":3847,"children":3849},{"className":214,"code":3848,"language":216,"meta":164,"style":164},"(function () {\n  var cache = {};\n  this.tmpl = function tmpl(str, data) {\n    return data ? fn(data) : fn;\n  };\n})();\n",[3850],{"type":170,"tag":186,"props":3851,"children":3852},{"__ignoreMap":164},[3853,3872,3891,3942,3985,3992],{"type":170,"tag":222,"props":3854,"children":3855},{"class":224,"line":225},[3856,3860,3864,3868],{"type":170,"tag":222,"props":3857,"children":3858},{"style":235},[3859],{"type":175,"value":238},{"type":170,"tag":222,"props":3861,"children":3862},{"style":568},[3863],{"type":175,"value":571},{"type":170,"tag":222,"props":3865,"children":3866},{"style":320},[3867],{"type":175,"value":576},{"type":170,"tag":222,"props":3869,"children":3870},{"style":320},[3871],{"type":175,"value":328},{"type":170,"tag":222,"props":3873,"children":3874},{"class":224,"line":247},[3875,3879,3883,3887],{"type":170,"tag":222,"props":3876,"children":3877},{"style":568},[3878],{"type":175,"value":588},{"type":170,"tag":222,"props":3880,"children":3881},{"style":235},[3882],{"type":175,"value":593},{"type":170,"tag":222,"props":3884,"children":3885},{"style":596},[3886],{"type":175,"value":599},{"type":170,"tag":222,"props":3888,"children":3889},{"style":320},[3890],{"type":175,"value":604},{"type":170,"tag":222,"props":3892,"children":3893},{"class":224,"line":257},[3894,3898,3902,3906,3910,3914,3918,3922,3926,3930,3934,3938],{"type":170,"tag":222,"props":3895,"children":3896},{"style":619},[3897],{"type":175,"value":622},{"type":170,"tag":222,"props":3899,"children":3900},{"style":320},[3901],{"type":175,"value":627},{"type":170,"tag":222,"props":3903,"children":3904},{"style":229},[3905],{"type":175,"value":632},{"type":170,"tag":222,"props":3907,"children":3908},{"style":596},[3909],{"type":175,"value":599},{"type":170,"tag":222,"props":3911,"children":3912},{"style":568},[3913],{"type":175,"value":641},{"type":170,"tag":222,"props":3915,"children":3916},{"style":229},[3917],{"type":175,"value":646},{"type":170,"tag":222,"props":3919,"children":3920},{"style":320},[3921],{"type":175,"value":238},{"type":170,"tag":222,"props":3923,"children":3924},{"style":653},[3925],{"type":175,"value":656},{"type":170,"tag":222,"props":3927,"children":3928},{"style":320},[3929],{"type":175,"value":323},{"type":170,"tag":222,"props":3931,"children":3932},{"style":653},[3933],{"type":175,"value":665},{"type":170,"tag":222,"props":3935,"children":3936},{"style":320},[3937],{"type":175,"value":670},{"type":170,"tag":222,"props":3939,"children":3940},{"style":320},[3941],{"type":175,"value":328},{"type":170,"tag":222,"props":3943,"children":3944},{"class":224,"line":266},[3945,3949,3953,3957,3961,3965,3969,3973,3977,3981],{"type":170,"tag":222,"props":3946,"children":3947},{"style":1155},[3948],{"type":175,"value":1579},{"type":170,"tag":222,"props":3950,"children":3951},{"style":235},[3952],{"type":175,"value":665},{"type":170,"tag":222,"props":3954,"children":3955},{"style":596},[3956],{"type":175,"value":1588},{"type":170,"tag":222,"props":3958,"children":3959},{"style":229},[3960],{"type":175,"value":703},{"type":170,"tag":222,"props":3962,"children":3963},{"style":335},[3964],{"type":175,"value":238},{"type":170,"tag":222,"props":3966,"children":3967},{"style":235},[3968],{"type":175,"value":1601},{"type":170,"tag":222,"props":3970,"children":3971},{"style":335},[3972],{"type":175,"value":1516},{"type":170,"tag":222,"props":3974,"children":3975},{"style":596},[3976],{"type":175,"value":343},{"type":170,"tag":222,"props":3978,"children":3979},{"style":235},[3980],{"type":175,"value":703},{"type":170,"tag":222,"props":3982,"children":3983},{"style":320},[3984],{"type":175,"value":1553},{"type":170,"tag":222,"props":3986,"children":3987},{"class":224,"line":275},[3988],{"type":170,"tag":222,"props":3989,"children":3990},{"style":320},[3991],{"type":175,"value":1626},{"type":170,"tag":222,"props":3993,"children":3994},{"class":224,"line":284},[3995,3999,4003],{"type":170,"tag":222,"props":3996,"children":3997},{"style":320},[3998],{"type":175,"value":382},{"type":170,"tag":222,"props":4000,"children":4001},{"style":235},[4002],{"type":175,"value":1639},{"type":170,"tag":222,"props":4004,"children":4005},{"style":320},[4006],{"type":175,"value":1553},{"type":170,"tag":171,"props":4008,"children":4009},{},[4010],{"type":175,"value":4011},"终于结束了！这个函数不长，但一口气看下来还是蛮费力气的。如果一遍写测试用例以便看代码，很快能把这个函数跑通，如果你是纯靠脑力跑，还没被那个长长的字符串替换链给吓住，在此我赐你称号：“Micro Templating 人肉编译器 - 十五周年限定版”。",{"type":170,"tag":171,"props":4013,"children":4014},{},[4015,4017,4024,4026,4031],{"type":175,"value":4016},"额外提一句，Function 构造器和 eval 函数比，除了能传参数意外，还有一些细节不同，比如说声明变量的作用域不同，这个需要注意。这个编译器没有错误处理等代码完善，因此不可以上生产。此外，由于 ",{"type":170,"tag":178,"props":4018,"children":4022},{"href":4019,"rel":4020},"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/with",[4021],"nofollow",[4023],{"type":175,"value":2695},{"type":175,"value":4025}," 语句非常容易出错，且不利于静态优化，不应该在业务函数里使用",{"type":170,"tag":222,"props":4027,"children":4028},{},[4029],{"type":175,"value":4030},"^with-mdn",{"type":175,"value":4032},"。最后，阅读源码需要技巧，这几点希望能帮助到你：",{"type":170,"tag":2869,"props":4034,"children":4035},{},[4036,4041,4046,4051],{"type":170,"tag":2873,"props":4037,"children":4038},{},[4039],{"type":175,"value":4040},"从注释、测试用例，先搞清楚要看的代码的作用",{"type":170,"tag":2873,"props":4042,"children":4043},{},[4044],{"type":175,"value":4045},"使用编辑器的折叠代码，一次只看一部分源码",{"type":170,"tag":2873,"props":4047,"children":4048},{},[4049],{"type":175,"value":4050},"在 Git 提交记录中搜索，从简单的版本看起",{"type":170,"tag":2873,"props":4052,"children":4053},{},[4054],{"type":175,"value":4055},"复杂代码应该从高层结构看起，比如使用 IDE 各种插件或是 Madge 等代码分析工具",{"type":170,"tag":526,"props":4057,"children":4059},{"id":4058},"相关链接",[4060],{"type":175,"value":4058},{"type":170,"tag":2869,"props":4062,"children":4063},{},[4064],{"type":170,"tag":2873,"props":4065,"children":4066},{},[4067],{"type":170,"tag":178,"props":4068,"children":4071},{"href":4069,"rel":4070},"https://johnresig.com/blog/javascript-micro-templating/",[4021],[4072],{"type":175,"value":4073},"JavaScript Micro-Templating",{"type":170,"tag":4075,"props":4076,"children":4077},"style",{},[4078],{"type":175,"value":4079},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":164,"searchDepth":247,"depth":247,"links":4081},[4082,4083,4084],{"id":528,"depth":247,"text":528},{"id":1651,"depth":247,"text":1651},{"id":4058,"depth":247,"text":4058},"markdown","content:2.articles:1100.micro-templating.md","content","2.articles/1100.micro-templating.md","2.articles/1100.micro-templating","md",[4092,4094],{"_path":52,"title":51,"description":4093},"沉浸式翻译太贵辽，试试本地部署 LLM 用来翻译网页的可行性。",{"_path":58,"title":57,"description":4095},"我的项目使用 micro-app 框架作为微前端框架。使用 micro-app 时，由于开启了样式隔离功能，子应用加载的 CSS 会被解析器解析，在选择器前增加一个子应用属性选择器前缀。我碰到的问题是，如果 CSS 源码中带嵌套语法那么解析就会失败。今天借这个问题给大家简单介绍一下 CSS Parser 的基本流程。",1753069984703]