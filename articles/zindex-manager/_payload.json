[{"data":1,"prerenderedAt":2103},["ShallowReactive",2],{"navigation":3,"/articles/zindex-manager":410,"/articles/zindex-manager-surround":2098},[4,32,83,102,129,135,141,147,393,399,405],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🌃 长夜梦","/flows/long-night-dream",{"title":15,"_path":16},"🌌 万物联结与幸福感","/flows/everything",{"title":18,"_path":19},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":21,"_path":22},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":24,"_path":25},"🌧️ 我的腼腆","/flows/shy",{"title":27,"_path":28},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":30,"_path":31},"📝 心流归档","/flows/fold",{"title":33,"_path":34,"children":35},"技术博客 / Coder","/articles",[36,38,41,44,47,50,53,56,59,62,65,68,71,74,77,80],{"title":37,"_path":34},"🦁 为什么我要写博客",{"title":39,"_path":40},"💻 本地部署 Qwen 翻译网页","/articles/local-translator",{"title":42,"_path":43},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":45,"_path":46},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":48,"_path":49},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":51,"_path":52},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":54,"_path":55},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":57,"_path":58},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":60,"_path":61},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":63,"_path":64},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":66,"_path":67},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":69,"_path":70},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":72,"_path":73},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":75,"_path":76},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":78,"_path":79},"🚝 四十二篇系列","/articles/fourty-two",{"title":81,"_path":82},"📝 技术博客归档","/articles/fold",{"title":84,"_path":85,"children":86},"造物 / Make","/tools",[87,90,93,96,99],{"title":88,"_path":89},"🧶 网易云音乐歌单排序","/tools/netease-sorter",{"title":91,"_path":92},"🌐 AnySort","/tools/anysort",{"title":94,"_path":95},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":97,"_path":98},"👓 Crapto","/tools/crypto-inline",{"title":100,"_path":101},"🖨️ any-to-base64","/tools/any-to-base64",{"title":103,"_path":104,"children":105},"吉他剧场 / Music","/music",[106,108,111,114,117,120,123,126],{"title":107,"_path":104},"🎸 FingerStyle！",{"title":109,"_path":110},"🌬️ 等待的风","/music/wind",{"title":112,"_path":113},"💕 约定的海洋","/music/ocean",{"title":115,"_path":116},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":118,"_path":119},"🌏 残酷天使的行动纲领","/music/eva",{"title":121,"_path":122},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":124,"_path":125},"🍷 Wu Wei","/music/wu-wei",{"title":127,"_path":128},"🌅 无题","/music/untitled",{"title":130,"_path":131,"children":132},"画点什么 / Paint","/paint",[133],{"title":134,"_path":131},"🚧 正在施工",{"title":136,"_path":137,"children":138},"读书笔记 / Notes","/books",[139],{"title":140,"_path":137},"📕 读书笔记",{"title":142,"_path":143,"children":144},"知识地图 / Maps","/maps",[145],{"title":146,"_path":143},"🏁 知识地图",{"title":148,"_path":149,"children":150},"零散的笔记 / Gists","/gists",[151,153,156,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255,258,261,264,267,270,273,276,279,282,285,288,291,294,297,300,303,306,309,312,315,318,321,324,327,330,333,336,339,342,345,348,351,354,357,360,363,366,369,372,375,378,381,384,387,390],{"title":152,"_path":149},"🧊 Gists",{"title":154,"_path":155},"网站的可访问性","/gists/accessibility",{"title":157,"_path":158},"Bit","/gists/bit",{"title":160,"_path":161},"图片模糊","/gists/blur",{"title":163,"_path":164},"渲染相关笔记","/gists/c4d",{"title":166,"_path":167},"CDN 问题记录","/gists/cdn",{"title":169,"_path":170},"消毒剂","/gists/cleaner",{"title":172,"_path":173},"Windows Command","/gists/cmd",{"title":175,"_path":176},"Command","/gists/command",{"title":178,"_path":179},"复杂科学","/gists/complexity-science",{"title":181,"_path":182},"GitHub Copilot","/gists/copilot",{"title":184,"_path":185},"宇宙","/gists/cosmos",{"title":187,"_path":188},"C++","/gists/cpp",{"title":190,"_path":191},"Data Structure","/gists/data-structure",{"title":193,"_path":194},"DEPRESSION","/gists/depression",{"title":196,"_path":197},"设计模式","/gists/design-patterns",{"title":199,"_path":200},"Developer Experience","/gists/developer-experience",{"title":202,"_path":203},"Device Metrics","/gists/device-metrix",{"title":205,"_path":206},"数字化转型","/gists/digital-transformation",{"title":208,"_path":209},"ECMAScript Language Specification","/gists/ecmascript-specification",{"title":211,"_path":212},"正则表达式","/gists/eegex",{"title":214,"_path":215},"Emoji","/gists/emoji",{"title":217,"_path":218},"工程","/gists/engineering",{"title":220,"_path":221},"熵","/gists/entropy",{"title":223,"_path":224},"Environment","/gists/environment",{"title":226,"_path":227},"Erlang","/gists/erlang",{"title":229,"_path":230},"逃离塔克夫","/gists/escape-from-tarkov",{"title":232,"_path":233},"ESNext (ES6-ES11)","/gists/esnext",{"title":235,"_path":236},"Eval！","/gists/eval",{"title":238,"_path":239},"Flutter","/gists/flutter",{"title":241,"_path":242},"字体","/gists/font",{"title":244,"_path":245},"JS 函数式编程","/gists/functional",{"title":247,"_path":248},"游戏化","/gists/gamification",{"title":250,"_path":251},"Google C++ Standard","/gists/google-cpp-standard",{"title":253,"_path":254},"双向链接完全体","/gists/graph",{"title":256,"_path":257},"Hardwares","/gists/hardwares",{"title":259,"_path":260},"哈希冲突","/gists/hash-collision",{"title":262,"_path":263},"信息设计","/gists/information-design",{"title":265,"_path":266},"InstantPage","/gists/instant.page",{"title":268,"_path":269},"ISUX 遇见大数据可视化系列","/gists/isux-data-visualization",{"title":271,"_path":272},"KVStore","/gists/key-value-db",{"title":274,"_path":275},"Kubernetes","/gists/kubernetes",{"title":277,"_path":278},"Makefile","/gists/makefile",{"title":280,"_path":281},"Markdown Inline Style","/gists/markdown-nice",{"title":283,"_path":284},"小程序","/gists/miniapp",{"title":286,"_path":287},"减小页面快照体积","/gists/minify-html",{"title":289,"_path":290},"mklink","/gists/mklink",{"title":292,"_path":293},"Mock","/gists/mock",{"title":295,"_path":296},"多人协作系统","/gists/multiplayer",{"title":298,"_path":299},"多端应用","/gists/multy-end-app",{"title":301,"_path":302},"神经科学","/gists/neuroscience",{"title":304,"_path":305},"OO","/gists/oo",{"title":307,"_path":308},"Opinioned Personal Folder","/gists/opinioned-personal-folder",{"title":310,"_path":311},"PInvoke","/gists/pinvoke",{"title":313,"_path":314},"像素","/gists/pixel",{"title":316,"_path":317},"PowerShell","/gists/powershell",{"title":319,"_path":320},"量子","/gists/quantum",{"title":322,"_path":323},"保持好奇心","/gists/questions",{"title":325,"_path":326},"React Native","/gists/react-native",{"title":328,"_path":329},"博客改版碰到的浏览器平滑滚动问题","/gists/scroll",{"title":331,"_path":332},"SEO","/gists/seo",{"title":334,"_path":335},"Shader","/gists/shader",{"title":337,"_path":338},"Shape Up","/gists/shape-up",{"title":340,"_path":341},"睡觉","/gists/sleep",{"title":343,"_path":344},"记录奇怪的问题","/gists/solved",{"title":346,"_path":347},"States","/gists/states",{"title":349,"_path":350},"Storage","/gists/storage",{"title":352,"_path":353},"音视频流处理","/gists/stream-cli",{"title":355,"_path":356},"Symbol","/gists/symbol",{"title":358,"_path":359},"系统论","/gists/systems-theory",{"title":361,"_path":362},"Taro","/gists/taro",{"title":364,"_path":365},"任务切片","/gists/task-slice",{"title":367,"_path":368},"技术偏好","/gists/tech-dudge",{"title":370,"_path":371},"Untitled","/gists/untitled",{"title":373,"_path":374},"可变字体","/gists/variable-font",{"title":376,"_path":377},"视觉错觉","/gists/visual-illusion",{"title":379,"_path":380},"SS(SSR)","/gists/vpn",{"title":382,"_path":383},"VS Code 插件开发","/gists/vscode-plugin",{"title":385,"_path":386},"Web Components","/gists/web-components",{"title":388,"_path":389},"Windows","/gists/windows",{"title":391,"_path":392},"查缺补漏","/gists/wrong",{"title":394,"_path":395,"children":396},"代码笔记 / Gists","/source-code",[397],{"title":398,"_path":395},"🚄 代码笔记",{"title":400,"_path":401,"children":402},"我 / Abount","/hire",[403],{"title":404,"_path":401},"📬 技术简历",{"title":406,"_path":407,"children":408},"todo","/todo",[409],{"title":406,"_path":407},{"_path":55,"_dir":411,"_draft":412,"_partial":412,"_locale":413,"title":54,"description":414,"body":415,"_type":2092,"_id":2093,"_source":2094,"_file":2095,"_stem":2096,"_extension":2097},"articles",false,"","使用 element-plus 内的层级管理器可以解决多组件库间层级不统一的问题",{"type":416,"children":417,"toc":2085},"root",[418,427,433,438,443,464,473,478,483,489,494,1002,1007,1222,1227,1240,1245,1253,1258,1263,1268,1273,1278,1528,1533,2027,2032,2047,2080],{"type":419,"tag":420,"props":421,"children":423},"element","h2",{"id":422},"增订-2022年9月5日",[424],{"type":425,"value":426},"text","增订 | 2022年9月5日",{"type":419,"tag":428,"props":429,"children":430},"p",{},[431],{"type":425,"value":432},"终于把两个 ElementPlus 实例干得只剩了一个，也顺带解决了一些项目中出现的稀奇古怪的问题。不过，这里容我吐槽一句，目前来说 ElementPlus 的问题是真的多，因为遇见 A 问题所以升级 Element 版本却引起了 B 问题这种情况屡见不鲜。我经常对着问题一调试就是两三个小时，恍惚之间就下班了，觉得一天喂狗了。呼呼，我想摸鱼啊，请给机会！",{"type":419,"tag":420,"props":434,"children":436},{"id":435},"背景",[437],{"type":425,"value":435},{"type":419,"tag":428,"props":439,"children":440},{},[441],{"type":425,"value":442},"上周在项目中碰到个棘手的问题。公司某项目依赖了两个不同的组件库，element-plus@2.0.2 和 element-plus@2.1.8。由于没把两个组件库的 zIndex 统一管理起来，所以这两库的弹窗各弹各的，可能互相遮住，很是尴尬。",{"type":419,"tag":428,"props":444,"children":445},{},[446,448,462],{"type":425,"value":447},"举例说明一下，两个组件库以下使用简称 E1 和 E2。element-plus（以及 element-ui）在内部实现了 zIndex 管理器，使打开的弹框的 zIndex 永远递增，解决了在单个 element 内部打开 dialog、popover、selector-option 等组件时互相遮盖的问题。element 默认的 zIndex 起始值是 2000，首先打开一个弹窗，dialog1，dialog1 的 zIndex 设置为 2001，如果在 dialog1 中使用按钮用打开了新的 dialog2，那么 dialog2 的 zIndex 值被置为 2002，遮住了 dialog1，这是正常的",{"type":419,"tag":449,"props":450,"children":451},"sup",{},[452],{"type":419,"tag":453,"props":454,"children":459},"a",{"href":455,"ariaDescribedBy":456,"dataFootnoteRef":413,"id":458},"#user-content-fn-append-to-body",[457],"footnote-label","user-content-fnref-append-to-body",[460],{"type":425,"value":461},"1",{"type":425,"value":463},"。那么问题来了，以上两个 dialog 都是通过 E1 打开的，一但在 dialog2 引用了 E2 的组件，打开弹窗 dialog3，那么 dialog3 的 zIndex 使用的是 E2 从 2000 开始递增为 2001 的值，不足以遮盖 E1 中 2002 的 dialog2，所以 dialog3 被 dialog2 遮挡，显示异常。",{"type":419,"tag":428,"props":465,"children":466},{},[467],{"type":419,"tag":468,"props":469,"children":472},"img",{"alt":470,"src":471},"打开多个弹窗示例","https://mgear-image.oss-cn-shanghai.aliyuncs.com/image/other/20220814192040.png",[],{"type":419,"tag":420,"props":474,"children":476},{"id":475},"解决",[477],{"type":425,"value":475},{"type":419,"tag":428,"props":479,"children":480},{},[481],{"type":425,"value":482},"统一多组件库层叠顺序，意味着将 E1 和 E2 内部实现的 zIndex 管理器中的 zIndex 通过某种形式关联起来。由于对 element 内部的实现不是很熟悉，所以一开始团队成员内部讨论时提出过许多天马行空的设想，比如“将 E2 的 zIndex 管理器作为 external 载入”、或是“使用 MutationObserver 检测 DOM 变化读取最新的 zIndex 值”... 最坏的情况是把当前的 element fork 出一份代码来自己维护，改造 zIndex 管理器实现多项目的统一管理。这些方案听起来不是那么可靠，所以我们决定先看看 element 的实现再近一步思考更优雅的解决方案。",{"type":419,"tag":484,"props":485,"children":487},"h4",{"id":486},"层叠管理器",[488],{"type":425,"value":486},{"type":419,"tag":428,"props":490,"children":491},{},[492],{"type":425,"value":493},"element-plus 的层叠管理器（PopupManager）实现比较简单，其核心原理和 element-ui 一致，通过闭包维护了一个 zIndex 的值的单例，暴露出获取值以及递增值的接口，以方便内部的 dialog 等组件在需要的时候有能力获取最新 zIndex 或者对 zIndex 进行递增。element-plus 中的层叠值管理的实现甚至比 element-ui 还要简单，它是一个 vue3 的 hook，只有 20 行代码。",{"type":419,"tag":495,"props":496,"children":500},"pre",{"className":497,"code":498,"language":499,"meta":413,"style":413},"language-js shiki shiki-themes material-theme-lighter github-light github-dark monokai","import { ref, computed } from 'vue'\nimport { useGlobalConfig } from '../use-global-config'\n\nconst zIndex = ref(0)\n\nexport const useZIndex = () => {\n  const initialZIndex = useGlobalConfig('zIndex', 2000) // TODO: move to @element-plus/constants\n  const currentZIndex = computed(() => initialZIndex.value + zIndex.value)\n\n  const nextZIndex = () => {\n    zIndex.value++\n    return currentZIndex.value\n  }\n\n  return {\n    initialZIndex,\n    currentZIndex,\n    nextZIndex,\n  }\n}\n","js",[501],{"type":419,"tag":502,"props":503,"children":504},"code",{"__ignoreMap":413},[505,566,604,614,657,665,704,765,834,842,871,893,915,924,932,945,959,972,985,993],{"type":419,"tag":506,"props":507,"children":510},"span",{"class":508,"line":509},"line",1,[511,517,523,529,534,539,544,549,555,561],{"type":419,"tag":506,"props":512,"children":514},{"style":513},"--shiki-light:#39ADB5;--shiki-light-font-style:italic;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#F92672;--shiki-sepia-font-style:inherit",[515],{"type":425,"value":516},"import",{"type":419,"tag":506,"props":518,"children":520},{"style":519},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[521],{"type":425,"value":522}," {",{"type":419,"tag":506,"props":524,"children":526},{"style":525},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[527],{"type":425,"value":528}," ref",{"type":419,"tag":506,"props":530,"children":531},{"style":519},[532],{"type":425,"value":533},",",{"type":419,"tag":506,"props":535,"children":536},{"style":525},[537],{"type":425,"value":538}," computed",{"type":419,"tag":506,"props":540,"children":541},{"style":519},[542],{"type":425,"value":543}," }",{"type":419,"tag":506,"props":545,"children":546},{"style":513},[547],{"type":425,"value":548}," from",{"type":419,"tag":506,"props":550,"children":552},{"style":551},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[553],{"type":425,"value":554}," '",{"type":419,"tag":506,"props":556,"children":558},{"style":557},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[559],{"type":425,"value":560},"vue",{"type":419,"tag":506,"props":562,"children":563},{"style":551},[564],{"type":425,"value":565},"'\n",{"type":419,"tag":506,"props":567,"children":569},{"class":508,"line":568},2,[570,574,578,583,587,591,595,600],{"type":419,"tag":506,"props":571,"children":572},{"style":513},[573],{"type":425,"value":516},{"type":419,"tag":506,"props":575,"children":576},{"style":519},[577],{"type":425,"value":522},{"type":419,"tag":506,"props":579,"children":580},{"style":525},[581],{"type":425,"value":582}," useGlobalConfig",{"type":419,"tag":506,"props":584,"children":585},{"style":519},[586],{"type":425,"value":543},{"type":419,"tag":506,"props":588,"children":589},{"style":513},[590],{"type":425,"value":548},{"type":419,"tag":506,"props":592,"children":593},{"style":551},[594],{"type":425,"value":554},{"type":419,"tag":506,"props":596,"children":597},{"style":557},[598],{"type":425,"value":599},"../use-global-config",{"type":419,"tag":506,"props":601,"children":602},{"style":551},[603],{"type":425,"value":565},{"type":419,"tag":506,"props":605,"children":607},{"class":508,"line":606},3,[608],{"type":419,"tag":506,"props":609,"children":611},{"emptyLinePlaceholder":610},true,[612],{"type":425,"value":613},"\n",{"type":419,"tag":506,"props":615,"children":617},{"class":508,"line":616},4,[618,624,630,636,641,646,652],{"type":419,"tag":506,"props":619,"children":621},{"style":620},"--shiki-light:#9C3EDA;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic",[622],{"type":425,"value":623},"const",{"type":419,"tag":506,"props":625,"children":627},{"style":626},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#F8F8F2",[628],{"type":425,"value":629}," zIndex",{"type":419,"tag":506,"props":631,"children":633},{"style":632},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[634],{"type":425,"value":635}," =",{"type":419,"tag":506,"props":637,"children":639},{"style":638},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[640],{"type":425,"value":528},{"type":419,"tag":506,"props":642,"children":643},{"style":525},[644],{"type":425,"value":645},"(",{"type":419,"tag":506,"props":647,"children":649},{"style":648},"--shiki-light:#F76D47;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[650],{"type":425,"value":651},"0",{"type":419,"tag":506,"props":653,"children":654},{"style":525},[655],{"type":425,"value":656},")\n",{"type":419,"tag":506,"props":658,"children":660},{"class":508,"line":659},5,[661],{"type":419,"tag":506,"props":662,"children":663},{"emptyLinePlaceholder":610},[664],{"type":425,"value":613},{"type":419,"tag":506,"props":666,"children":668},{"class":508,"line":667},6,[669,674,679,685,689,694,699],{"type":419,"tag":506,"props":670,"children":671},{"style":513},[672],{"type":425,"value":673},"export",{"type":419,"tag":506,"props":675,"children":676},{"style":620},[677],{"type":425,"value":678}," const",{"type":419,"tag":506,"props":680,"children":682},{"style":681},"--shiki-light:#90A4AE;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[683],{"type":425,"value":684}," useZIndex",{"type":419,"tag":506,"props":686,"children":687},{"style":632},[688],{"type":425,"value":635},{"type":419,"tag":506,"props":690,"children":691},{"style":519},[692],{"type":425,"value":693}," ()",{"type":419,"tag":506,"props":695,"children":696},{"style":620},[697],{"type":425,"value":698}," =>",{"type":419,"tag":506,"props":700,"children":701},{"style":519},[702],{"type":425,"value":703}," {\n",{"type":419,"tag":506,"props":705,"children":707},{"class":508,"line":706},7,[708,713,718,722,726,731,736,741,745,749,754,759],{"type":419,"tag":506,"props":709,"children":710},{"style":620},[711],{"type":425,"value":712},"  const",{"type":419,"tag":506,"props":714,"children":715},{"style":626},[716],{"type":425,"value":717}," initialZIndex",{"type":419,"tag":506,"props":719,"children":720},{"style":632},[721],{"type":425,"value":635},{"type":419,"tag":506,"props":723,"children":724},{"style":638},[725],{"type":425,"value":582},{"type":419,"tag":506,"props":727,"children":729},{"style":728},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[730],{"type":425,"value":645},{"type":419,"tag":506,"props":732,"children":733},{"style":551},[734],{"type":425,"value":735},"'",{"type":419,"tag":506,"props":737,"children":738},{"style":557},[739],{"type":425,"value":740},"zIndex",{"type":419,"tag":506,"props":742,"children":743},{"style":551},[744],{"type":425,"value":735},{"type":419,"tag":506,"props":746,"children":747},{"style":519},[748],{"type":425,"value":533},{"type":419,"tag":506,"props":750,"children":751},{"style":648},[752],{"type":425,"value":753}," 2000",{"type":419,"tag":506,"props":755,"children":756},{"style":728},[757],{"type":425,"value":758},") ",{"type":419,"tag":506,"props":760,"children":762},{"style":761},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit",[763],{"type":425,"value":764},"// TODO: move to @element-plus/constants\n",{"type":419,"tag":506,"props":766,"children":768},{"class":508,"line":767},8,[769,773,778,782,786,790,795,799,803,808,813,818,822,826,830],{"type":419,"tag":506,"props":770,"children":771},{"style":620},[772],{"type":425,"value":712},{"type":419,"tag":506,"props":774,"children":775},{"style":626},[776],{"type":425,"value":777}," currentZIndex",{"type":419,"tag":506,"props":779,"children":780},{"style":632},[781],{"type":425,"value":635},{"type":419,"tag":506,"props":783,"children":784},{"style":638},[785],{"type":425,"value":538},{"type":419,"tag":506,"props":787,"children":788},{"style":728},[789],{"type":425,"value":645},{"type":419,"tag":506,"props":791,"children":792},{"style":519},[793],{"type":425,"value":794},"()",{"type":419,"tag":506,"props":796,"children":797},{"style":620},[798],{"type":425,"value":698},{"type":419,"tag":506,"props":800,"children":801},{"style":525},[802],{"type":425,"value":717},{"type":419,"tag":506,"props":804,"children":805},{"style":519},[806],{"type":425,"value":807},".",{"type":419,"tag":506,"props":809,"children":810},{"style":525},[811],{"type":425,"value":812},"value",{"type":419,"tag":506,"props":814,"children":815},{"style":632},[816],{"type":425,"value":817}," +",{"type":419,"tag":506,"props":819,"children":820},{"style":525},[821],{"type":425,"value":629},{"type":419,"tag":506,"props":823,"children":824},{"style":519},[825],{"type":425,"value":807},{"type":419,"tag":506,"props":827,"children":828},{"style":525},[829],{"type":425,"value":812},{"type":419,"tag":506,"props":831,"children":832},{"style":728},[833],{"type":425,"value":656},{"type":419,"tag":506,"props":835,"children":837},{"class":508,"line":836},9,[838],{"type":419,"tag":506,"props":839,"children":840},{"emptyLinePlaceholder":610},[841],{"type":425,"value":613},{"type":419,"tag":506,"props":843,"children":845},{"class":508,"line":844},10,[846,850,855,859,863,867],{"type":419,"tag":506,"props":847,"children":848},{"style":620},[849],{"type":425,"value":712},{"type":419,"tag":506,"props":851,"children":852},{"style":681},[853],{"type":425,"value":854}," nextZIndex",{"type":419,"tag":506,"props":856,"children":857},{"style":632},[858],{"type":425,"value":635},{"type":419,"tag":506,"props":860,"children":861},{"style":519},[862],{"type":425,"value":693},{"type":419,"tag":506,"props":864,"children":865},{"style":620},[866],{"type":425,"value":698},{"type":419,"tag":506,"props":868,"children":869},{"style":519},[870],{"type":425,"value":703},{"type":419,"tag":506,"props":872,"children":874},{"class":508,"line":873},11,[875,880,884,888],{"type":419,"tag":506,"props":876,"children":877},{"style":525},[878],{"type":425,"value":879},"    zIndex",{"type":419,"tag":506,"props":881,"children":882},{"style":519},[883],{"type":425,"value":807},{"type":419,"tag":506,"props":885,"children":886},{"style":525},[887],{"type":425,"value":812},{"type":419,"tag":506,"props":889,"children":890},{"style":632},[891],{"type":425,"value":892},"++\n",{"type":419,"tag":506,"props":894,"children":896},{"class":508,"line":895},12,[897,902,906,910],{"type":419,"tag":506,"props":898,"children":899},{"style":513},[900],{"type":425,"value":901},"    return",{"type":419,"tag":506,"props":903,"children":904},{"style":525},[905],{"type":425,"value":777},{"type":419,"tag":506,"props":907,"children":908},{"style":519},[909],{"type":425,"value":807},{"type":419,"tag":506,"props":911,"children":912},{"style":525},[913],{"type":425,"value":914},"value\n",{"type":419,"tag":506,"props":916,"children":918},{"class":508,"line":917},13,[919],{"type":419,"tag":506,"props":920,"children":921},{"style":519},[922],{"type":425,"value":923},"  }\n",{"type":419,"tag":506,"props":925,"children":927},{"class":508,"line":926},14,[928],{"type":419,"tag":506,"props":929,"children":930},{"emptyLinePlaceholder":610},[931],{"type":425,"value":613},{"type":419,"tag":506,"props":933,"children":935},{"class":508,"line":934},15,[936,941],{"type":419,"tag":506,"props":937,"children":938},{"style":513},[939],{"type":425,"value":940},"  return",{"type":419,"tag":506,"props":942,"children":943},{"style":519},[944],{"type":425,"value":703},{"type":419,"tag":506,"props":946,"children":948},{"class":508,"line":947},16,[949,954],{"type":419,"tag":506,"props":950,"children":951},{"style":525},[952],{"type":425,"value":953},"    initialZIndex",{"type":419,"tag":506,"props":955,"children":956},{"style":519},[957],{"type":425,"value":958},",\n",{"type":419,"tag":506,"props":960,"children":962},{"class":508,"line":961},17,[963,968],{"type":419,"tag":506,"props":964,"children":965},{"style":525},[966],{"type":425,"value":967},"    currentZIndex",{"type":419,"tag":506,"props":969,"children":970},{"style":519},[971],{"type":425,"value":958},{"type":419,"tag":506,"props":973,"children":975},{"class":508,"line":974},18,[976,981],{"type":419,"tag":506,"props":977,"children":978},{"style":525},[979],{"type":425,"value":980},"    nextZIndex",{"type":419,"tag":506,"props":982,"children":983},{"style":519},[984],{"type":425,"value":958},{"type":419,"tag":506,"props":986,"children":988},{"class":508,"line":987},19,[989],{"type":419,"tag":506,"props":990,"children":991},{"style":519},[992],{"type":425,"value":923},{"type":419,"tag":506,"props":994,"children":996},{"class":508,"line":995},20,[997],{"type":419,"tag":506,"props":998,"children":999},{"style":519},[1000],{"type":425,"value":1001},"}\n",{"type":419,"tag":428,"props":1003,"children":1004},{},[1005],{"type":425,"value":1006},"useZIndex 可以在任意 vue setup 中调用。调用后的回调提供了 initialZIndex、currentZIndex、nextZIndex 三个接口。initialZIndex 是通过 ElementConfigProvider 传入的 zIndex 初始值；用 currentZIndex 能拿到最新的 zIndex 值；用 nextZindex 可以给 zIndex 递增后获取其值，因为 zIndex 是全局的单例，所以使用 nextZIndex 拿到的值一定是全局最大的 zIndex。",{"type":419,"tag":495,"props":1008,"children":1011},{"className":1009,"code":1010,"language":560,"meta":413,"style":413},"language-vue shiki shiki-themes material-theme-lighter github-light github-dark monokai","\u003Ctemplate>\n  \u003Cdialog :style=\"{zIndex}\" />\n\u003C/template>\n\u003Cscript setup>\nconst { useZIndex } from \"../hooks/use-z-index\";\n// 这个 zIndex 一定是当前 element 中最大的 zIndex\nconst zIndex = useZIndex.nextZIndex();\n\u003C/script>\n",[1012],{"type":419,"tag":502,"props":1013,"children":1014},{"__ignoreMap":413},[1015,1034,1097,1113,1134,1163,1171,1207],{"type":419,"tag":506,"props":1016,"children":1017},{"class":508,"line":509},[1018,1023,1029],{"type":419,"tag":506,"props":1019,"children":1020},{"style":519},[1021],{"type":425,"value":1022},"\u003C",{"type":419,"tag":506,"props":1024,"children":1026},{"style":1025},"--shiki-light:#E53935;--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672",[1027],{"type":425,"value":1028},"template",{"type":419,"tag":506,"props":1030,"children":1031},{"style":519},[1032],{"type":425,"value":1033},">\n",{"type":419,"tag":506,"props":1035,"children":1036},{"class":508,"line":568},[1037,1042,1047,1052,1058,1063,1069,1074,1078,1083,1087,1093],{"type":419,"tag":506,"props":1038,"children":1039},{"style":519},[1040],{"type":425,"value":1041},"  \u003C",{"type":419,"tag":506,"props":1043,"children":1044},{"style":1025},[1045],{"type":425,"value":1046},"dialog",{"type":419,"tag":506,"props":1048,"children":1049},{"style":519},[1050],{"type":425,"value":1051}," :",{"type":419,"tag":506,"props":1053,"children":1055},{"style":1054},"--shiki-light:#9C3EDA;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[1056],{"type":425,"value":1057},"style",{"type":419,"tag":506,"props":1059,"children":1060},{"style":519},[1061],{"type":425,"value":1062},"=",{"type":419,"tag":506,"props":1064,"children":1066},{"style":1065},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#F8F8F2",[1067],{"type":425,"value":1068},"\"",{"type":419,"tag":506,"props":1070,"children":1071},{"style":519},[1072],{"type":425,"value":1073},"{",{"type":419,"tag":506,"props":1075,"children":1076},{"style":525},[1077],{"type":425,"value":740},{"type":419,"tag":506,"props":1079,"children":1080},{"style":519},[1081],{"type":425,"value":1082},"}",{"type":419,"tag":506,"props":1084,"children":1085},{"style":1065},[1086],{"type":425,"value":1068},{"type":419,"tag":506,"props":1088,"children":1090},{"style":1089},"--shiki-light:#39ADB5;--shiki-light-font-style:inherit;--shiki-default:#B31D28;--shiki-default-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;--shiki-sepia:#F44747;--shiki-sepia-font-style:inherit",[1091],{"type":425,"value":1092}," /",{"type":419,"tag":506,"props":1094,"children":1095},{"style":519},[1096],{"type":425,"value":1033},{"type":419,"tag":506,"props":1098,"children":1099},{"class":508,"line":606},[1100,1105,1109],{"type":419,"tag":506,"props":1101,"children":1102},{"style":519},[1103],{"type":425,"value":1104},"\u003C/",{"type":419,"tag":506,"props":1106,"children":1107},{"style":1025},[1108],{"type":425,"value":1028},{"type":419,"tag":506,"props":1110,"children":1111},{"style":519},[1112],{"type":425,"value":1033},{"type":419,"tag":506,"props":1114,"children":1115},{"class":508,"line":616},[1116,1120,1125,1130],{"type":419,"tag":506,"props":1117,"children":1118},{"style":519},[1119],{"type":425,"value":1022},{"type":419,"tag":506,"props":1121,"children":1122},{"style":1025},[1123],{"type":425,"value":1124},"script",{"type":419,"tag":506,"props":1126,"children":1127},{"style":1054},[1128],{"type":425,"value":1129}," setup",{"type":419,"tag":506,"props":1131,"children":1132},{"style":519},[1133],{"type":425,"value":1033},{"type":419,"tag":506,"props":1135,"children":1136},{"class":508,"line":659},[1137,1141,1145,1149,1153,1158],{"type":419,"tag":506,"props":1138,"children":1139},{"style":620},[1140],{"type":425,"value":623},{"type":419,"tag":506,"props":1142,"children":1143},{"style":519},[1144],{"type":425,"value":522},{"type":419,"tag":506,"props":1146,"children":1147},{"style":626},[1148],{"type":425,"value":684},{"type":419,"tag":506,"props":1150,"children":1151},{"style":519},[1152],{"type":425,"value":543},{"type":419,"tag":506,"props":1154,"children":1155},{"style":525},[1156],{"type":425,"value":1157}," from \"../hooks/use-z-index\"",{"type":419,"tag":506,"props":1159,"children":1160},{"style":519},[1161],{"type":425,"value":1162},";\n",{"type":419,"tag":506,"props":1164,"children":1165},{"class":508,"line":667},[1166],{"type":419,"tag":506,"props":1167,"children":1168},{"style":761},[1169],{"type":425,"value":1170},"// 这个 zIndex 一定是当前 element 中最大的 zIndex\n",{"type":419,"tag":506,"props":1172,"children":1173},{"class":508,"line":706},[1174,1178,1182,1186,1190,1194,1199,1203],{"type":419,"tag":506,"props":1175,"children":1176},{"style":620},[1177],{"type":425,"value":623},{"type":419,"tag":506,"props":1179,"children":1180},{"style":626},[1181],{"type":425,"value":629},{"type":419,"tag":506,"props":1183,"children":1184},{"style":632},[1185],{"type":425,"value":635},{"type":419,"tag":506,"props":1187,"children":1188},{"style":525},[1189],{"type":425,"value":684},{"type":419,"tag":506,"props":1191,"children":1192},{"style":519},[1193],{"type":425,"value":807},{"type":419,"tag":506,"props":1195,"children":1196},{"style":638},[1197],{"type":425,"value":1198},"nextZIndex",{"type":419,"tag":506,"props":1200,"children":1201},{"style":525},[1202],{"type":425,"value":794},{"type":419,"tag":506,"props":1204,"children":1205},{"style":519},[1206],{"type":425,"value":1162},{"type":419,"tag":506,"props":1208,"children":1209},{"class":508,"line":767},[1210,1214,1218],{"type":419,"tag":506,"props":1211,"children":1212},{"style":519},[1213],{"type":425,"value":1104},{"type":419,"tag":506,"props":1215,"children":1216},{"style":1025},[1217],{"type":425,"value":1124},{"type":419,"tag":506,"props":1219,"children":1220},{"style":519},[1221],{"type":425,"value":1033},{"type":419,"tag":484,"props":1223,"children":1225},{"id":1224},"思路分析",[1226],{"type":425,"value":1224},{"type":419,"tag":428,"props":1228,"children":1229},{},[1230,1232,1238],{"type":425,"value":1231},"既然在 element-plus 的内部能使用 ",{"type":419,"tag":502,"props":1233,"children":1235},{"className":1234},[],[1236],{"type":425,"value":1237},"const { useZIndex } from ...",{"type":425,"value":1239}," 的形式拿到 zIndex 管理器暴露的接口，那么在项目中是否能通过一样的方法得到它呢？",{"type":419,"tag":428,"props":1241,"children":1242},{},[1243],{"type":425,"value":1244},"答案是肯定的。通过观察 element 的默认导出可以发现其中有 useZIndex 的存在。",{"type":419,"tag":428,"props":1246,"children":1247},{},[1248],{"type":419,"tag":468,"props":1249,"children":1252},{"alt":1250,"src":1251},"exports in element-plus","https://mgear-image.oss-cn-shanghai.aliyuncs.com/image/other/20220814195047.png",[],{"type":419,"tag":428,"props":1254,"children":1255},{},[1256],{"type":425,"value":1257},"解决多组件库统一层叠顺序问题的本质就是在项目的应用层再实现一个 zIndex 管理器。管理器需要接受来自不同组件库的 zIndex 管理器，并在任一管理器中的 zIndex 值发生变化时，把变化同步到其它管理器中。",{"type":419,"tag":428,"props":1259,"children":1260},{},[1261],{"type":425,"value":1262},"举个例子，我们在文章开头先使用 E1 打开了 dialog1 和 dialog2，使 E1 的 zIndex 从 2000 递增到 2001 再递增到 2002，如果再打开 E2 的 dialog3，我们希望 dialog3 的 zIndex 从 2002 递增到 2003，这也就意味着打开 dialog1 和 dialog2 时的 zIndex 递增需要从 E1 同步到 E2。",{"type":419,"tag":428,"props":1264,"children":1265},{},[1266],{"type":425,"value":1267},"既然 element 导出了 useZIndex，那问题就好办了。我们可以在项目中拿到 E1 以及 E2 的 useZIndex，用 vue watch 监听两个 useZIndex 回传的 currentZIndex 接口，并把小的那个 zIndex（对应上述 E2）通过 nextZIndex 接口递增到大的（对应上述 E1）。这样一来，E1 和 E2 的 zIndex 就相等，在下一次打开弹窗时，无论是使用 E1 还是使用 E2 的弹窗，其 zIndex 值都能保证在项目中最大。",{"type":419,"tag":484,"props":1269,"children":1271},{"id":1270},"代码实现",[1272],{"type":425,"value":1270},{"type":419,"tag":428,"props":1274,"children":1275},{},[1276],{"type":425,"value":1277},"代码实现时，团队的小伙伴写了以下代码，这段代码非常好理解，这里就不细说了。",{"type":419,"tag":495,"props":1279,"children":1281},{"className":497,"code":1280,"language":499,"meta":413,"style":413},"watch([\n  () => e1ZIndexContext.currentZIndex.value,\n  () => e2ZIndexContext.currentZIndex.value,\n], ([z1, z2]) => {\n  if (z1 \u003C z2) {\n    e1ZIndexContext.nextZIndex()\n  } else {\n    e2ZIndexContext.nextZIndex()\n  }\n})\n",[1282],{"type":419,"tag":502,"props":1283,"children":1284},{"__ignoreMap":413},[1285,1298,1336,1372,1417,1452,1473,1490,1510,1517],{"type":419,"tag":506,"props":1286,"children":1287},{"class":508,"line":509},[1288,1293],{"type":419,"tag":506,"props":1289,"children":1290},{"style":638},[1291],{"type":425,"value":1292},"watch",{"type":419,"tag":506,"props":1294,"children":1295},{"style":525},[1296],{"type":425,"value":1297},"([\n",{"type":419,"tag":506,"props":1299,"children":1300},{"class":508,"line":568},[1301,1306,1310,1315,1319,1324,1328,1332],{"type":419,"tag":506,"props":1302,"children":1303},{"style":519},[1304],{"type":425,"value":1305},"  ()",{"type":419,"tag":506,"props":1307,"children":1308},{"style":620},[1309],{"type":425,"value":698},{"type":419,"tag":506,"props":1311,"children":1312},{"style":525},[1313],{"type":425,"value":1314}," e1ZIndexContext",{"type":419,"tag":506,"props":1316,"children":1317},{"style":519},[1318],{"type":425,"value":807},{"type":419,"tag":506,"props":1320,"children":1321},{"style":525},[1322],{"type":425,"value":1323},"currentZIndex",{"type":419,"tag":506,"props":1325,"children":1326},{"style":519},[1327],{"type":425,"value":807},{"type":419,"tag":506,"props":1329,"children":1330},{"style":525},[1331],{"type":425,"value":812},{"type":419,"tag":506,"props":1333,"children":1334},{"style":519},[1335],{"type":425,"value":958},{"type":419,"tag":506,"props":1337,"children":1338},{"class":508,"line":606},[1339,1343,1347,1352,1356,1360,1364,1368],{"type":419,"tag":506,"props":1340,"children":1341},{"style":519},[1342],{"type":425,"value":1305},{"type":419,"tag":506,"props":1344,"children":1345},{"style":620},[1346],{"type":425,"value":698},{"type":419,"tag":506,"props":1348,"children":1349},{"style":525},[1350],{"type":425,"value":1351}," e2ZIndexContext",{"type":419,"tag":506,"props":1353,"children":1354},{"style":519},[1355],{"type":425,"value":807},{"type":419,"tag":506,"props":1357,"children":1358},{"style":525},[1359],{"type":425,"value":1323},{"type":419,"tag":506,"props":1361,"children":1362},{"style":519},[1363],{"type":425,"value":807},{"type":419,"tag":506,"props":1365,"children":1366},{"style":525},[1367],{"type":425,"value":812},{"type":419,"tag":506,"props":1369,"children":1370},{"style":519},[1371],{"type":425,"value":958},{"type":419,"tag":506,"props":1373,"children":1374},{"class":508,"line":616},[1375,1380,1384,1389,1395,1399,1404,1409,1413],{"type":419,"tag":506,"props":1376,"children":1377},{"style":525},[1378],{"type":425,"value":1379},"]",{"type":419,"tag":506,"props":1381,"children":1382},{"style":519},[1383],{"type":425,"value":533},{"type":419,"tag":506,"props":1385,"children":1386},{"style":519},[1387],{"type":425,"value":1388}," ([",{"type":419,"tag":506,"props":1390,"children":1392},{"style":1391},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#E36209;--shiki-default-font-style:inherit;--shiki-dark:#FFAB70;--shiki-dark-font-style:inherit;--shiki-sepia:#FD971F;--shiki-sepia-font-style:italic",[1393],{"type":425,"value":1394},"z1",{"type":419,"tag":506,"props":1396,"children":1397},{"style":519},[1398],{"type":425,"value":533},{"type":419,"tag":506,"props":1400,"children":1401},{"style":1391},[1402],{"type":425,"value":1403}," z2",{"type":419,"tag":506,"props":1405,"children":1406},{"style":519},[1407],{"type":425,"value":1408},"])",{"type":419,"tag":506,"props":1410,"children":1411},{"style":620},[1412],{"type":425,"value":698},{"type":419,"tag":506,"props":1414,"children":1415},{"style":519},[1416],{"type":425,"value":703},{"type":419,"tag":506,"props":1418,"children":1419},{"class":508,"line":659},[1420,1425,1430,1434,1439,1443,1447],{"type":419,"tag":506,"props":1421,"children":1422},{"style":513},[1423],{"type":425,"value":1424},"  if",{"type":419,"tag":506,"props":1426,"children":1427},{"style":728},[1428],{"type":425,"value":1429}," (",{"type":419,"tag":506,"props":1431,"children":1432},{"style":525},[1433],{"type":425,"value":1394},{"type":419,"tag":506,"props":1435,"children":1436},{"style":632},[1437],{"type":425,"value":1438}," \u003C",{"type":419,"tag":506,"props":1440,"children":1441},{"style":525},[1442],{"type":425,"value":1403},{"type":419,"tag":506,"props":1444,"children":1445},{"style":728},[1446],{"type":425,"value":758},{"type":419,"tag":506,"props":1448,"children":1449},{"style":519},[1450],{"type":425,"value":1451},"{\n",{"type":419,"tag":506,"props":1453,"children":1454},{"class":508,"line":667},[1455,1460,1464,1468],{"type":419,"tag":506,"props":1456,"children":1457},{"style":525},[1458],{"type":425,"value":1459},"    e1ZIndexContext",{"type":419,"tag":506,"props":1461,"children":1462},{"style":519},[1463],{"type":425,"value":807},{"type":419,"tag":506,"props":1465,"children":1466},{"style":638},[1467],{"type":425,"value":1198},{"type":419,"tag":506,"props":1469,"children":1470},{"style":728},[1471],{"type":425,"value":1472},"()\n",{"type":419,"tag":506,"props":1474,"children":1475},{"class":508,"line":706},[1476,1481,1486],{"type":419,"tag":506,"props":1477,"children":1478},{"style":519},[1479],{"type":425,"value":1480},"  }",{"type":419,"tag":506,"props":1482,"children":1483},{"style":513},[1484],{"type":425,"value":1485}," else",{"type":419,"tag":506,"props":1487,"children":1488},{"style":519},[1489],{"type":425,"value":703},{"type":419,"tag":506,"props":1491,"children":1492},{"class":508,"line":767},[1493,1498,1502,1506],{"type":419,"tag":506,"props":1494,"children":1495},{"style":525},[1496],{"type":425,"value":1497},"    e2ZIndexContext",{"type":419,"tag":506,"props":1499,"children":1500},{"style":519},[1501],{"type":425,"value":807},{"type":419,"tag":506,"props":1503,"children":1504},{"style":638},[1505],{"type":425,"value":1198},{"type":419,"tag":506,"props":1507,"children":1508},{"style":728},[1509],{"type":425,"value":1472},{"type":419,"tag":506,"props":1511,"children":1512},{"class":508,"line":836},[1513],{"type":419,"tag":506,"props":1514,"children":1515},{"style":519},[1516],{"type":425,"value":923},{"type":419,"tag":506,"props":1518,"children":1519},{"class":508,"line":844},[1520,1524],{"type":419,"tag":506,"props":1521,"children":1522},{"style":519},[1523],{"type":425,"value":1082},{"type":419,"tag":506,"props":1525,"children":1526},{"style":525},[1527],{"type":425,"value":656},{"type":419,"tag":428,"props":1529,"children":1530},{},[1531],{"type":425,"value":1532},"需要注意的是，可能有非常多组件依赖了 useZIndex 的内部的响应式值，所以直接使用 watch 暴力递增 zIndex 是有问题的。想象一下，每递增一次，相关 vue 组件会被收集到等待更新的队列中，如果 z1 和 z2 的差值很大，容易报栈溢出问题。好在解决方式也非常简单，使用 nextTick 分担每个 tick 的任务，并在回调中，根据最新的 zIndex 值进行 zIndex 递增就行了。",{"type":419,"tag":495,"props":1534,"children":1536},{"className":497,"code":1535,"language":499,"meta":413,"style":413},"const { watch, nextTick } from \"vue\"\nconst unwatch = null\n\nexport function useSameZIndex(ctx1, ctx2) {\n  unwatch && unwatch()\n  unwatch = watch([\n    () => ctx1.currentZIndex.value,\n    () => ctx2.currentZIndex.value,\n  ], ([z1, z2]) => nextTick(() => {\n    const [nz1, nz2] = [\n      ctx1.currentZIndex.value,\n      ctx2.currentZIndex.value\n    ]\n    if (nz1 \u003C nz2) {\n      ctx1.nextZIndex()\n    } else {\n      ctx2.nextZIndex()\n    }\n  })\n}\n",[1537],{"type":419,"tag":502,"props":1538,"children":1539},{"__ignoreMap":413},[1540,1574,1596,1603,1647,1668,1687,1724,1759,1815,1855,1883,1907,1915,1947,1966,1982,2001,2009,2020],{"type":419,"tag":506,"props":1541,"children":1542},{"class":508,"line":509},[1543,1547,1551,1556,1560,1565,1569],{"type":419,"tag":506,"props":1544,"children":1545},{"style":620},[1546],{"type":425,"value":623},{"type":419,"tag":506,"props":1548,"children":1549},{"style":519},[1550],{"type":425,"value":522},{"type":419,"tag":506,"props":1552,"children":1553},{"style":626},[1554],{"type":425,"value":1555}," watch",{"type":419,"tag":506,"props":1557,"children":1558},{"style":519},[1559],{"type":425,"value":533},{"type":419,"tag":506,"props":1561,"children":1562},{"style":626},[1563],{"type":425,"value":1564}," nextTick",{"type":419,"tag":506,"props":1566,"children":1567},{"style":519},[1568],{"type":425,"value":543},{"type":419,"tag":506,"props":1570,"children":1571},{"style":525},[1572],{"type":425,"value":1573}," from \"vue\"\n",{"type":419,"tag":506,"props":1575,"children":1576},{"class":508,"line":568},[1577,1581,1586,1590],{"type":419,"tag":506,"props":1578,"children":1579},{"style":620},[1580],{"type":425,"value":623},{"type":419,"tag":506,"props":1582,"children":1583},{"style":626},[1584],{"type":425,"value":1585}," unwatch",{"type":419,"tag":506,"props":1587,"children":1588},{"style":632},[1589],{"type":425,"value":635},{"type":419,"tag":506,"props":1591,"children":1593},{"style":1592},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[1594],{"type":425,"value":1595}," null\n",{"type":419,"tag":506,"props":1597,"children":1598},{"class":508,"line":606},[1599],{"type":419,"tag":506,"props":1600,"children":1601},{"emptyLinePlaceholder":610},[1602],{"type":425,"value":613},{"type":419,"tag":506,"props":1604,"children":1605},{"class":508,"line":616},[1606,1610,1615,1620,1624,1629,1633,1638,1643],{"type":419,"tag":506,"props":1607,"children":1608},{"style":513},[1609],{"type":425,"value":673},{"type":419,"tag":506,"props":1611,"children":1612},{"style":620},[1613],{"type":425,"value":1614}," function",{"type":419,"tag":506,"props":1616,"children":1617},{"style":638},[1618],{"type":425,"value":1619}," useSameZIndex",{"type":419,"tag":506,"props":1621,"children":1622},{"style":519},[1623],{"type":425,"value":645},{"type":419,"tag":506,"props":1625,"children":1626},{"style":1391},[1627],{"type":425,"value":1628},"ctx1",{"type":419,"tag":506,"props":1630,"children":1631},{"style":519},[1632],{"type":425,"value":533},{"type":419,"tag":506,"props":1634,"children":1635},{"style":1391},[1636],{"type":425,"value":1637}," ctx2",{"type":419,"tag":506,"props":1639,"children":1640},{"style":519},[1641],{"type":425,"value":1642},")",{"type":419,"tag":506,"props":1644,"children":1645},{"style":519},[1646],{"type":425,"value":703},{"type":419,"tag":506,"props":1648,"children":1649},{"class":508,"line":659},[1650,1655,1660,1664],{"type":419,"tag":506,"props":1651,"children":1652},{"style":525},[1653],{"type":425,"value":1654},"  unwatch",{"type":419,"tag":506,"props":1656,"children":1657},{"style":632},[1658],{"type":425,"value":1659}," &&",{"type":419,"tag":506,"props":1661,"children":1662},{"style":638},[1663],{"type":425,"value":1585},{"type":419,"tag":506,"props":1665,"children":1666},{"style":728},[1667],{"type":425,"value":1472},{"type":419,"tag":506,"props":1669,"children":1670},{"class":508,"line":667},[1671,1675,1679,1683],{"type":419,"tag":506,"props":1672,"children":1673},{"style":525},[1674],{"type":425,"value":1654},{"type":419,"tag":506,"props":1676,"children":1677},{"style":632},[1678],{"type":425,"value":635},{"type":419,"tag":506,"props":1680,"children":1681},{"style":638},[1682],{"type":425,"value":1555},{"type":419,"tag":506,"props":1684,"children":1685},{"style":728},[1686],{"type":425,"value":1297},{"type":419,"tag":506,"props":1688,"children":1689},{"class":508,"line":706},[1690,1695,1699,1704,1708,1712,1716,1720],{"type":419,"tag":506,"props":1691,"children":1692},{"style":519},[1693],{"type":425,"value":1694},"    ()",{"type":419,"tag":506,"props":1696,"children":1697},{"style":620},[1698],{"type":425,"value":698},{"type":419,"tag":506,"props":1700,"children":1701},{"style":525},[1702],{"type":425,"value":1703}," ctx1",{"type":419,"tag":506,"props":1705,"children":1706},{"style":519},[1707],{"type":425,"value":807},{"type":419,"tag":506,"props":1709,"children":1710},{"style":525},[1711],{"type":425,"value":1323},{"type":419,"tag":506,"props":1713,"children":1714},{"style":519},[1715],{"type":425,"value":807},{"type":419,"tag":506,"props":1717,"children":1718},{"style":525},[1719],{"type":425,"value":812},{"type":419,"tag":506,"props":1721,"children":1722},{"style":519},[1723],{"type":425,"value":958},{"type":419,"tag":506,"props":1725,"children":1726},{"class":508,"line":767},[1727,1731,1735,1739,1743,1747,1751,1755],{"type":419,"tag":506,"props":1728,"children":1729},{"style":519},[1730],{"type":425,"value":1694},{"type":419,"tag":506,"props":1732,"children":1733},{"style":620},[1734],{"type":425,"value":698},{"type":419,"tag":506,"props":1736,"children":1737},{"style":525},[1738],{"type":425,"value":1637},{"type":419,"tag":506,"props":1740,"children":1741},{"style":519},[1742],{"type":425,"value":807},{"type":419,"tag":506,"props":1744,"children":1745},{"style":525},[1746],{"type":425,"value":1323},{"type":419,"tag":506,"props":1748,"children":1749},{"style":519},[1750],{"type":425,"value":807},{"type":419,"tag":506,"props":1752,"children":1753},{"style":525},[1754],{"type":425,"value":812},{"type":419,"tag":506,"props":1756,"children":1757},{"style":519},[1758],{"type":425,"value":958},{"type":419,"tag":506,"props":1760,"children":1761},{"class":508,"line":836},[1762,1767,1771,1775,1779,1783,1787,1791,1795,1799,1803,1807,1811],{"type":419,"tag":506,"props":1763,"children":1764},{"style":728},[1765],{"type":425,"value":1766},"  ]",{"type":419,"tag":506,"props":1768,"children":1769},{"style":519},[1770],{"type":425,"value":533},{"type":419,"tag":506,"props":1772,"children":1773},{"style":519},[1774],{"type":425,"value":1388},{"type":419,"tag":506,"props":1776,"children":1777},{"style":1391},[1778],{"type":425,"value":1394},{"type":419,"tag":506,"props":1780,"children":1781},{"style":519},[1782],{"type":425,"value":533},{"type":419,"tag":506,"props":1784,"children":1785},{"style":1391},[1786],{"type":425,"value":1403},{"type":419,"tag":506,"props":1788,"children":1789},{"style":519},[1790],{"type":425,"value":1408},{"type":419,"tag":506,"props":1792,"children":1793},{"style":620},[1794],{"type":425,"value":698},{"type":419,"tag":506,"props":1796,"children":1797},{"style":638},[1798],{"type":425,"value":1564},{"type":419,"tag":506,"props":1800,"children":1801},{"style":728},[1802],{"type":425,"value":645},{"type":419,"tag":506,"props":1804,"children":1805},{"style":519},[1806],{"type":425,"value":794},{"type":419,"tag":506,"props":1808,"children":1809},{"style":620},[1810],{"type":425,"value":698},{"type":419,"tag":506,"props":1812,"children":1813},{"style":519},[1814],{"type":425,"value":703},{"type":419,"tag":506,"props":1816,"children":1817},{"class":508,"line":844},[1818,1823,1828,1833,1837,1842,1846,1850],{"type":419,"tag":506,"props":1819,"children":1820},{"style":620},[1821],{"type":425,"value":1822},"    const",{"type":419,"tag":506,"props":1824,"children":1825},{"style":519},[1826],{"type":425,"value":1827}," [",{"type":419,"tag":506,"props":1829,"children":1830},{"style":626},[1831],{"type":425,"value":1832},"nz1",{"type":419,"tag":506,"props":1834,"children":1835},{"style":519},[1836],{"type":425,"value":533},{"type":419,"tag":506,"props":1838,"children":1839},{"style":626},[1840],{"type":425,"value":1841}," nz2",{"type":419,"tag":506,"props":1843,"children":1844},{"style":519},[1845],{"type":425,"value":1379},{"type":419,"tag":506,"props":1847,"children":1848},{"style":632},[1849],{"type":425,"value":635},{"type":419,"tag":506,"props":1851,"children":1852},{"style":728},[1853],{"type":425,"value":1854}," [\n",{"type":419,"tag":506,"props":1856,"children":1857},{"class":508,"line":873},[1858,1863,1867,1871,1875,1879],{"type":419,"tag":506,"props":1859,"children":1860},{"style":525},[1861],{"type":425,"value":1862},"      ctx1",{"type":419,"tag":506,"props":1864,"children":1865},{"style":519},[1866],{"type":425,"value":807},{"type":419,"tag":506,"props":1868,"children":1869},{"style":525},[1870],{"type":425,"value":1323},{"type":419,"tag":506,"props":1872,"children":1873},{"style":519},[1874],{"type":425,"value":807},{"type":419,"tag":506,"props":1876,"children":1877},{"style":525},[1878],{"type":425,"value":812},{"type":419,"tag":506,"props":1880,"children":1881},{"style":519},[1882],{"type":425,"value":958},{"type":419,"tag":506,"props":1884,"children":1885},{"class":508,"line":895},[1886,1891,1895,1899,1903],{"type":419,"tag":506,"props":1887,"children":1888},{"style":525},[1889],{"type":425,"value":1890},"      ctx2",{"type":419,"tag":506,"props":1892,"children":1893},{"style":519},[1894],{"type":425,"value":807},{"type":419,"tag":506,"props":1896,"children":1897},{"style":525},[1898],{"type":425,"value":1323},{"type":419,"tag":506,"props":1900,"children":1901},{"style":519},[1902],{"type":425,"value":807},{"type":419,"tag":506,"props":1904,"children":1905},{"style":525},[1906],{"type":425,"value":914},{"type":419,"tag":506,"props":1908,"children":1909},{"class":508,"line":917},[1910],{"type":419,"tag":506,"props":1911,"children":1912},{"style":728},[1913],{"type":425,"value":1914},"    ]\n",{"type":419,"tag":506,"props":1916,"children":1917},{"class":508,"line":926},[1918,1923,1927,1931,1935,1939,1943],{"type":419,"tag":506,"props":1919,"children":1920},{"style":513},[1921],{"type":425,"value":1922},"    if",{"type":419,"tag":506,"props":1924,"children":1925},{"style":728},[1926],{"type":425,"value":1429},{"type":419,"tag":506,"props":1928,"children":1929},{"style":525},[1930],{"type":425,"value":1832},{"type":419,"tag":506,"props":1932,"children":1933},{"style":632},[1934],{"type":425,"value":1438},{"type":419,"tag":506,"props":1936,"children":1937},{"style":525},[1938],{"type":425,"value":1841},{"type":419,"tag":506,"props":1940,"children":1941},{"style":728},[1942],{"type":425,"value":758},{"type":419,"tag":506,"props":1944,"children":1945},{"style":519},[1946],{"type":425,"value":1451},{"type":419,"tag":506,"props":1948,"children":1949},{"class":508,"line":934},[1950,1954,1958,1962],{"type":419,"tag":506,"props":1951,"children":1952},{"style":525},[1953],{"type":425,"value":1862},{"type":419,"tag":506,"props":1955,"children":1956},{"style":519},[1957],{"type":425,"value":807},{"type":419,"tag":506,"props":1959,"children":1960},{"style":638},[1961],{"type":425,"value":1198},{"type":419,"tag":506,"props":1963,"children":1964},{"style":728},[1965],{"type":425,"value":1472},{"type":419,"tag":506,"props":1967,"children":1968},{"class":508,"line":947},[1969,1974,1978],{"type":419,"tag":506,"props":1970,"children":1971},{"style":519},[1972],{"type":425,"value":1973},"    }",{"type":419,"tag":506,"props":1975,"children":1976},{"style":513},[1977],{"type":425,"value":1485},{"type":419,"tag":506,"props":1979,"children":1980},{"style":519},[1981],{"type":425,"value":703},{"type":419,"tag":506,"props":1983,"children":1984},{"class":508,"line":961},[1985,1989,1993,1997],{"type":419,"tag":506,"props":1986,"children":1987},{"style":525},[1988],{"type":425,"value":1890},{"type":419,"tag":506,"props":1990,"children":1991},{"style":519},[1992],{"type":425,"value":807},{"type":419,"tag":506,"props":1994,"children":1995},{"style":638},[1996],{"type":425,"value":1198},{"type":419,"tag":506,"props":1998,"children":1999},{"style":728},[2000],{"type":425,"value":1472},{"type":419,"tag":506,"props":2002,"children":2003},{"class":508,"line":974},[2004],{"type":419,"tag":506,"props":2005,"children":2006},{"style":519},[2007],{"type":425,"value":2008},"    }\n",{"type":419,"tag":506,"props":2010,"children":2011},{"class":508,"line":987},[2012,2016],{"type":419,"tag":506,"props":2013,"children":2014},{"style":519},[2015],{"type":425,"value":1480},{"type":419,"tag":506,"props":2017,"children":2018},{"style":728},[2019],{"type":425,"value":656},{"type":419,"tag":506,"props":2021,"children":2022},{"class":508,"line":995},[2023],{"type":419,"tag":506,"props":2024,"children":2025},{"style":728},[2026],{"type":425,"value":1001},{"type":419,"tag":420,"props":2028,"children":2030},{"id":2029},"更多",[2031],{"type":425,"value":2029},{"type":419,"tag":428,"props":2033,"children":2034},{},[2035,2037,2045],{"type":425,"value":2036},"以上分享的代码略为简单，想深入探索的话推荐直接看 element-plus 相关组件的源码，如 ",{"type":419,"tag":453,"props":2038,"children":2042},{"href":2039,"rel":2040},"https://github.com/element-plus/element-plus/blob/6503e5527715a6424433df0ff523b8910e891033/packages/components/message-box/src/index.vue",[2041],"nofollow",[2043],{"type":425,"value":2044},"message-box",{"type":425,"value":2046},"。虽然文中仅介绍了如何 watch 并递增管理器中的 zIndex 值，但是在实际项目开发时的使用场景肯定更加复杂，比方说，在 element-plus 上层封装业务 UI 库时可能会要用到全屏组件或是购物车等业务弹窗，那么这些库在全局的 zIndex 管理实际也可以使用 element-plus 的这套。总之，要活学活用嘛...",{"type":419,"tag":2048,"props":2049,"children":2052},"section",{"className":2050,"dataFootnotes":413},[2051],"footnotes",[2053,2060],{"type":419,"tag":420,"props":2054,"children":2057},{"className":2055,"id":457},[2056],"sr-only",[2058],{"type":425,"value":2059},"Footnotes",{"type":419,"tag":2061,"props":2062,"children":2063},"ol",{},[2064],{"type":419,"tag":2065,"props":2066,"children":2068},"li",{"id":2067},"user-content-fn-append-to-body",[2069,2071],{"type":425,"value":2070},"为了降低复杂度，这里只考虑将弹窗 teleport 到 body 中的情况。 ",{"type":419,"tag":453,"props":2072,"children":2077},{"href":2073,"ariaLabel":2074,"className":2075,"dataFootnoteBackref":413},"#user-content-fnref-append-to-body","Back to reference 1",[2076],"data-footnote-backref",[2078],{"type":425,"value":2079},"↩",{"type":419,"tag":1057,"props":2081,"children":2082},{},[2083],{"type":425,"value":2084},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":413,"searchDepth":568,"depth":568,"links":2086},[2087,2088,2089,2090,2091],{"id":422,"depth":568,"text":426},{"id":435,"depth":568,"text":435},{"id":475,"depth":568,"text":475},{"id":2029,"depth":568,"text":2029},{"id":457,"depth":568,"text":2059},"markdown","content:2.articles:1104.zindex-manager.md","content","2.articles/1104.zindex-manager.md","2.articles/1104.zindex-manager","md",[2099,2101],{"_path":52,"title":51,"description":2100},"如何自定义 antd-table、vxe-table 等复杂组件的滚动条？",{"_path":58,"title":57,"description":2102},"如何破解滑块验证码？本文介绍使用Puppeteer操作浏览器进行图片对比、图片识别及优化鼠标轨迹以模仿真是用户等几种简单爬虫验证码破解思路，适用多种场景。",1732808103823]