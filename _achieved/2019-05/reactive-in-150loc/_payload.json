[{"data":1,"prerenderedAt":5890},["ShallowReactive",2],{"navigation":3,"/_achieved/2019-05/reactive-in-150loc":393,"/_achieved/2019-05/reactive-in-150loc-surround":5883},[4,35,86,105,132,138,144,150,387],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29,32],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🚝 四十二篇系列","/flows/fourty-two",{"title":15,"_path":16},"🌃 长夜梦","/flows/long-night-dream",{"title":18,"_path":19},"🌌 万物联结与幸福感","/flows/everything",{"title":21,"_path":22},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":24,"_path":25},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":27,"_path":28},"🌧️ 我的腼腆","/flows/shy",{"title":30,"_path":31},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":33,"_path":34},"📝 心流归档","/flows/archive",{"title":36,"_path":37,"children":38},"技术博客 / Coder","/articles",[39,41,44,47,50,53,56,59,62,65,68,71,74,77,80,83],{"title":40,"_path":37},"🦁 欢迎",{"title":42,"_path":43},"🥞 在 tailwind 中使用现代化 CSS Layers","/articles/tailwind-sass-and-css-layer",{"title":45,"_path":46},"💻 本地部署 Qwen 翻译网页","/articles/local-translator",{"title":48,"_path":49},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":51,"_path":52},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":54,"_path":55},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":57,"_path":58},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":60,"_path":61},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":63,"_path":64},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":66,"_path":67},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":69,"_path":70},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":72,"_path":73},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":75,"_path":76},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":78,"_path":79},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":81,"_path":82},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":84,"_path":85},"📝 技术博客归档","/articles/archive",{"title":87,"_path":88,"children":89},"造物 / Make","/tools",[90,93,96,99,102],{"title":91,"_path":92},"🥥 Coconut","/tools/coconut",{"title":94,"_path":95},"🧶 网易云音乐歌单排序","/tools/netease-sorter",{"title":97,"_path":98},"🌐 AnySort","/tools/anysort",{"title":100,"_path":101},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":103,"_path":104},"👓 Crapto","/tools/crypto-inline",{"title":106,"_path":107,"children":108},"吉他剧场 / Music","/music",[109,111,114,117,120,123,126,129],{"title":110,"_path":107},"🎸 FingerStyle！",{"title":112,"_path":113},"🌬️ 等待的风","/music/wind",{"title":115,"_path":116},"💕 约定的海洋","/music/ocean",{"title":118,"_path":119},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":121,"_path":122},"🌏 残酷天使的行动纲领","/music/eva",{"title":124,"_path":125},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":127,"_path":128},"🍷 Wu Wei","/music/wu-wei",{"title":130,"_path":131},"🌅 无题","/music/untitled",{"title":133,"_path":134,"children":135},"画点什么 / Paint","/paint",[136],{"title":137,"_path":134},"🚧 正在施工",{"title":139,"_path":140,"children":141},"读书笔记 / Notes","/books",[142],{"title":143,"_path":140},"📕 读书笔记",{"title":145,"_path":146,"children":147},"知识地图 / Maps","/maps",[148],{"title":149,"_path":146},"🏁 知识地图",{"title":151,"_path":152,"children":153},"零散的笔记 / Gists","/gists",[154,156,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255,258,261,264,267,270,273,276,279,282,285,288,291,294,297,300,303,306,309,312,315,318,321,324,327,330,333,336,339,342,345,348,351,354,357,360,363,366,369,372,375,378,381,384],{"title":155,"_path":152},"🧊 Gists",{"title":157,"_path":158},"网站的可访问性","/gists/accessibility",{"title":160,"_path":161},"Bit","/gists/bit",{"title":163,"_path":164},"图片模糊","/gists/blur",{"title":166,"_path":167},"渲染相关笔记","/gists/c4d",{"title":169,"_path":170},"CDN 问题记录","/gists/cdn",{"title":172,"_path":173},"消毒剂","/gists/cleaner",{"title":175,"_path":176},"Windows Command","/gists/cmd",{"title":178,"_path":179},"Command","/gists/command",{"title":181,"_path":182},"复杂科学","/gists/complexity-science",{"title":184,"_path":185},"GitHub Copilot","/gists/copilot",{"title":187,"_path":188},"宇宙","/gists/cosmos",{"title":190,"_path":191},"C++","/gists/cpp",{"title":193,"_path":194},"DEPRESSION","/gists/depression",{"title":196,"_path":197},"Developer Experience","/gists/developer-experience",{"title":199,"_path":200},"Device Metrics","/gists/device-metrix",{"title":202,"_path":203},"数字化转型","/gists/digital-transformation",{"title":205,"_path":206},"ECMAScript Language Specification","/gists/ecmascript-specification",{"title":208,"_path":209},"正则表达式","/gists/eegex",{"title":211,"_path":212},"Emoji","/gists/emoji",{"title":214,"_path":215},"工程","/gists/engineering",{"title":217,"_path":218},"熵","/gists/entropy",{"title":220,"_path":221},"Environment","/gists/environment",{"title":223,"_path":224},"Erlang","/gists/erlang",{"title":226,"_path":227},"逃离塔克夫","/gists/escape-from-tarkov",{"title":229,"_path":230},"ESNext (ES6-ES11)","/gists/esnext",{"title":232,"_path":233},"Eval！","/gists/eval",{"title":235,"_path":236},"Flutter","/gists/flutter",{"title":238,"_path":239},"字体","/gists/font",{"title":241,"_path":242},"JS 函数式编程","/gists/functional",{"title":244,"_path":245},"游戏化","/gists/gamification",{"title":247,"_path":248},"Google C++ Standard","/gists/google-cpp-standard",{"title":250,"_path":251},"双向链接完全体","/gists/graph",{"title":253,"_path":254},"Hardwares","/gists/hardwares",{"title":256,"_path":257},"哈希冲突","/gists/hash-collision",{"title":259,"_path":260},"信息设计","/gists/information-design",{"title":262,"_path":263},"InstantPage","/gists/instant.page",{"title":265,"_path":266},"ISUX 遇见大数据可视化系列","/gists/isux-data-visualization",{"title":268,"_path":269},"KVStore","/gists/key-value-db",{"title":271,"_path":272},"Kubernetes","/gists/kubernetes",{"title":274,"_path":275},"Makefile","/gists/makefile",{"title":277,"_path":278},"Markdown Inline Style","/gists/markdown-nice",{"title":280,"_path":281},"小程序","/gists/miniapp",{"title":283,"_path":284},"减小页面快照体积","/gists/minify-html",{"title":286,"_path":287},"mklink","/gists/mklink",{"title":289,"_path":290},"Mock","/gists/mock",{"title":292,"_path":293},"多人协作系统","/gists/multiplayer",{"title":295,"_path":296},"多端应用","/gists/multy-end-app",{"title":298,"_path":299},"神经科学","/gists/neuroscience",{"title":301,"_path":302},"Opinioned Personal Folder","/gists/opinioned-personal-folder",{"title":304,"_path":305},"PInvoke","/gists/pinvoke",{"title":307,"_path":308},"像素","/gists/pixel",{"title":310,"_path":311},"PowerShell","/gists/powershell",{"title":313,"_path":314},"量子","/gists/quantum",{"title":316,"_path":317},"保持好奇心","/gists/questions",{"title":319,"_path":320},"React Native","/gists/react-native",{"title":322,"_path":323},"博客改版碰到的浏览器平滑滚动问题","/gists/scroll",{"title":325,"_path":326},"SEO","/gists/seo",{"title":328,"_path":329},"Shader","/gists/shader",{"title":331,"_path":332},"Shape Up","/gists/shape-up",{"title":334,"_path":335},"睡觉","/gists/sleep",{"title":337,"_path":338},"记录奇怪的问题","/gists/solved",{"title":340,"_path":341},"States","/gists/states",{"title":343,"_path":344},"Storage","/gists/storage",{"title":346,"_path":347},"音视频流处理","/gists/stream-cli",{"title":349,"_path":350},"Symbol","/gists/symbol",{"title":352,"_path":353},"系统论","/gists/systems-theory",{"title":355,"_path":356},"Taro","/gists/taro",{"title":358,"_path":359},"任务切片","/gists/task-slice",{"title":361,"_path":362},"技术偏好","/gists/tech-dudge",{"title":364,"_path":365},"Untitled","/gists/untitled",{"title":367,"_path":368},"可变字体","/gists/variable-font",{"title":370,"_path":371},"视觉错觉","/gists/visual-illusion",{"title":373,"_path":374},"SS(SSR)","/gists/vpn",{"title":376,"_path":377},"VS Code 插件开发","/gists/vscode-plugin",{"title":379,"_path":380},"Web Components","/gists/web-components",{"title":382,"_path":383},"Windows","/gists/windows",{"title":385,"_path":386},"查缺补漏","/gists/wrong",{"title":388,"_path":389,"children":390},"我 / About","/hire",[391],{"title":392,"_path":389},"📬 技术简历",{"_path":394,"_dir":395,"_draft":396,"_partial":397,"_locale":398,"title":399,"description":400,"body":401,"_type":5877,"_id":5878,"_source":5879,"_file":5880,"_stem":5881,"_extension":5882},"/_achieved/2019-05/reactive-in-150loc","2019-05",false,true,"","🚀 150 行代码带你实现小程序中的数据侦听","本文介绍了在 150 行代码内使用 defineProperty 实现一个简单的拥有事件发布订阅能力的状态管理库的思路。",{"type":402,"children":403,"toc":5855},"root",[404,412,427,432,711,723,728,733,738,743,756,1037,1050,1055,1062,1074,1328,1333,1716,1721,1726,1731,1888,2030,2035,2041,2046,2051,2060,2065,2073,2079,2084,2340,2345,2350,2823,2828,2857,3632,3638,3651,3987,4000,4013,4535,4540,4545,4550,4555,4568,5084,5089,5095,5100,5105,5329,5335,5340,5560,5684,5696,5826,5831,5836,5849],{"type":405,"tag":406,"props":407,"children":409},"element","h2",{"id":408},"前言",[410],{"type":411,"value":408},"text",{"type":405,"tag":413,"props":414,"children":415},"p",{},[416,418,425],{"type":411,"value":417},"在小程序项目中, 我们的通常会使用到使用到一个全局对象作为各个页面通用的数据存储容器, 将它绑定到 app 对象后, 就能在每一个页面都自由的操纵这个对象. 然而在实践中, 由于这个对象及其属性不具备响应式条件, 它不能直接参与业务逻辑的编写, 能力仅仅局限于数据储存. 若是在 VueJS 项目中, 我们可能经常使用到",{"type":405,"tag":419,"props":420,"children":422},"code",{"className":421},[],[423],{"type":411,"value":424},"Vue.$watch",{"type":411,"value":426},"去侦听某个数据是否发生变化, 小程序却缺乏这种能力.",{"type":405,"tag":413,"props":428,"children":429},{},[430],{"type":411,"value":431},"在这篇文章中, 我将用 150 行代码, 手把手带你打造一个小程序也可以使用的侦听器(下简称 VX):",{"type":405,"tag":433,"props":434,"children":438},"pre",{"className":435,"code":436,"language":437,"meta":398,"style":398},"language-js shiki shiki-themes material-theme-lighter github-light github-dark monokai","// 一个快速赋值的语法糖函数, 可以创建结构为 { value: a { b: { val: ''} } } 的对象\nvx.set('value.a.d', { val: '' })\n// 对某个属性进行侦听, 如果发生改变, 则执行相应函数(可多次watch以执行多个函数)\nvx.watch('value.a.d.val', newVal => {\n  console.log(`val改变为 : `, newVal)\n})\nvalue.a.d.val = 3 // val改编为 : 3\n","js",[439],{"type":405,"tag":419,"props":440,"children":441},{"__ignoreMap":398},[442,454,533,542,597,645,658],{"type":405,"tag":443,"props":444,"children":447},"span",{"class":445,"line":446},"line",1,[448],{"type":405,"tag":443,"props":449,"children":451},{"style":450},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit",[452],{"type":411,"value":453},"// 一个快速赋值的语法糖函数, 可以创建结构为 { value: a { b: { val: ''} } } 的对象\n",{"type":405,"tag":443,"props":455,"children":457},{"class":445,"line":456},2,[458,464,470,476,481,487,493,497,502,507,513,518,523,528],{"type":405,"tag":443,"props":459,"children":461},{"style":460},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[462],{"type":411,"value":463},"vx",{"type":405,"tag":443,"props":465,"children":467},{"style":466},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[468],{"type":411,"value":469},".",{"type":405,"tag":443,"props":471,"children":473},{"style":472},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[474],{"type":411,"value":475},"set",{"type":405,"tag":443,"props":477,"children":478},{"style":460},[479],{"type":411,"value":480},"(",{"type":405,"tag":443,"props":482,"children":484},{"style":483},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[485],{"type":411,"value":486},"'",{"type":405,"tag":443,"props":488,"children":490},{"style":489},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[491],{"type":411,"value":492},"value.a.d",{"type":405,"tag":443,"props":494,"children":495},{"style":483},[496],{"type":411,"value":486},{"type":405,"tag":443,"props":498,"children":499},{"style":466},[500],{"type":411,"value":501},",",{"type":405,"tag":443,"props":503,"children":504},{"style":466},[505],{"type":411,"value":506}," {",{"type":405,"tag":443,"props":508,"children":510},{"style":509},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[511],{"type":411,"value":512}," val",{"type":405,"tag":443,"props":514,"children":515},{"style":466},[516],{"type":411,"value":517},":",{"type":405,"tag":443,"props":519,"children":520},{"style":483},[521],{"type":411,"value":522}," ''",{"type":405,"tag":443,"props":524,"children":525},{"style":466},[526],{"type":411,"value":527}," }",{"type":405,"tag":443,"props":529,"children":530},{"style":460},[531],{"type":411,"value":532},")\n",{"type":405,"tag":443,"props":534,"children":536},{"class":445,"line":535},3,[537],{"type":405,"tag":443,"props":538,"children":539},{"style":450},[540],{"type":411,"value":541},"// 对某个属性进行侦听, 如果发生改变, 则执行相应函数(可多次watch以执行多个函数)\n",{"type":405,"tag":443,"props":543,"children":545},{"class":445,"line":544},4,[546,550,554,559,563,567,572,576,580,586,592],{"type":405,"tag":443,"props":547,"children":548},{"style":460},[549],{"type":411,"value":463},{"type":405,"tag":443,"props":551,"children":552},{"style":466},[553],{"type":411,"value":469},{"type":405,"tag":443,"props":555,"children":556},{"style":472},[557],{"type":411,"value":558},"watch",{"type":405,"tag":443,"props":560,"children":561},{"style":460},[562],{"type":411,"value":480},{"type":405,"tag":443,"props":564,"children":565},{"style":483},[566],{"type":411,"value":486},{"type":405,"tag":443,"props":568,"children":569},{"style":489},[570],{"type":411,"value":571},"value.a.d.val",{"type":405,"tag":443,"props":573,"children":574},{"style":483},[575],{"type":411,"value":486},{"type":405,"tag":443,"props":577,"children":578},{"style":466},[579],{"type":411,"value":501},{"type":405,"tag":443,"props":581,"children":583},{"style":582},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#E36209;--shiki-default-font-style:inherit;--shiki-dark:#FFAB70;--shiki-dark-font-style:inherit;--shiki-sepia:#FD971F;--shiki-sepia-font-style:italic",[584],{"type":411,"value":585}," newVal",{"type":405,"tag":443,"props":587,"children":589},{"style":588},"--shiki-light:#9C3EDA;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic",[590],{"type":411,"value":591}," =>",{"type":405,"tag":443,"props":593,"children":594},{"style":466},[595],{"type":411,"value":596}," {\n",{"type":405,"tag":443,"props":598,"children":600},{"class":445,"line":599},5,[601,606,610,615,619,624,629,633,637,641],{"type":405,"tag":443,"props":602,"children":603},{"style":460},[604],{"type":411,"value":605},"  console",{"type":405,"tag":443,"props":607,"children":608},{"style":466},[609],{"type":411,"value":469},{"type":405,"tag":443,"props":611,"children":612},{"style":472},[613],{"type":411,"value":614},"log",{"type":405,"tag":443,"props":616,"children":617},{"style":509},[618],{"type":411,"value":480},{"type":405,"tag":443,"props":620,"children":621},{"style":483},[622],{"type":411,"value":623},"`",{"type":405,"tag":443,"props":625,"children":626},{"style":489},[627],{"type":411,"value":628},"val改变为 : ",{"type":405,"tag":443,"props":630,"children":631},{"style":483},[632],{"type":411,"value":623},{"type":405,"tag":443,"props":634,"children":635},{"style":466},[636],{"type":411,"value":501},{"type":405,"tag":443,"props":638,"children":639},{"style":460},[640],{"type":411,"value":585},{"type":405,"tag":443,"props":642,"children":643},{"style":509},[644],{"type":411,"value":532},{"type":405,"tag":443,"props":646,"children":648},{"class":445,"line":647},6,[649,654],{"type":405,"tag":443,"props":650,"children":651},{"style":466},[652],{"type":411,"value":653},"}",{"type":405,"tag":443,"props":655,"children":656},{"style":460},[657],{"type":411,"value":532},{"type":405,"tag":443,"props":659,"children":661},{"class":445,"line":660},7,[662,667,671,676,680,685,689,694,700,706],{"type":405,"tag":443,"props":663,"children":664},{"style":460},[665],{"type":411,"value":666},"value",{"type":405,"tag":443,"props":668,"children":669},{"style":466},[670],{"type":411,"value":469},{"type":405,"tag":443,"props":672,"children":673},{"style":460},[674],{"type":411,"value":675},"a",{"type":405,"tag":443,"props":677,"children":678},{"style":466},[679],{"type":411,"value":469},{"type":405,"tag":443,"props":681,"children":682},{"style":460},[683],{"type":411,"value":684},"d",{"type":405,"tag":443,"props":686,"children":687},{"style":466},[688],{"type":411,"value":469},{"type":405,"tag":443,"props":690,"children":691},{"style":460},[692],{"type":411,"value":693},"val ",{"type":405,"tag":443,"props":695,"children":697},{"style":696},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[698],{"type":411,"value":699},"=",{"type":405,"tag":443,"props":701,"children":703},{"style":702},"--shiki-light:#F76D47;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[704],{"type":411,"value":705}," 3",{"type":405,"tag":443,"props":707,"children":708},{"style":450},[709],{"type":411,"value":710}," // val改编为 : 3\n",{"type":405,"tag":413,"props":712,"children":713},{},[714,716,721],{"type":411,"value":715},"使用 VX 侦听器, 我们可以更加方便的管理各个页面的状态. 同时, 我们凭借",{"type":405,"tag":419,"props":717,"children":719},{"className":718},[],[720],{"type":411,"value":558},{"type":411,"value":722},"语法, 可以更优雅地编写业务逻辑.",{"type":405,"tag":413,"props":724,"children":725},{},[726],{"type":411,"value":727},"坐稳了, 三轮车准备启动了~ 各位评论见~ 😋",{"type":405,"tag":406,"props":729,"children":731},{"id":730},"稍微理一理思路",[732],{"type":411,"value":730},{"type":405,"tag":413,"props":734,"children":735},{},[736],{"type":411,"value":737},"在全局对象中, 我们不一定要对每一个属性都进行侦听, 所以 VX 主要的功能就是通过 set 去设置某个具体属性的 setter/getter, 同时通过 watch 向添加该属性添加需要订阅的回调函数.",{"type":405,"tag":406,"props":739,"children":741},{"id":740},"依赖对象的实现",[742],{"type":411,"value":740},{"type":405,"tag":413,"props":744,"children":745},{},[746,748,754],{"type":411,"value":747},"首先我们需要造一个通用的",{"type":405,"tag":749,"props":750,"children":751},"strong",{},[752],{"type":411,"value":753},"依赖对象",{"type":411,"value":755},", 依赖对象携带一个订阅数组用于存放一组回调函数, 同时它还应该包括一些操作订阅数组能力(如添加订阅, 清空订阅)的函数",{"type":405,"tag":433,"props":757,"children":759},{"className":435,"code":758,"language":437,"meta":398,"style":398},"class Dep {\n  constructor () {\n    this.subs = []\n  }\n  // 将回调添加到数组中\n  addSub (fn) { /*...*/ }\n  delSub (fn) { /*...*/ }\n  // 执行数组中每一项函数\n  notify (newVal, oldVal) {\n    this.subs.forEach(func => func(newVal, oldVal))\n  }\n}\n",[760],{"type":405,"tag":419,"props":761,"children":762},{"__ignoreMap":398},[763,781,798,826,834,842,880,912,921,956,1020,1028],{"type":405,"tag":443,"props":764,"children":765},{"class":445,"line":446},[766,771,777],{"type":405,"tag":443,"props":767,"children":768},{"style":588},[769],{"type":411,"value":770},"class",{"type":405,"tag":443,"props":772,"children":774},{"style":773},"--shiki-light:#E2931D;--shiki-light-text-decoration:inherit;--shiki-default:#6F42C1;--shiki-default-text-decoration:inherit;--shiki-dark:#B392F0;--shiki-dark-text-decoration:inherit;--shiki-sepia:#A6E22E;--shiki-sepia-text-decoration:underline",[775],{"type":411,"value":776}," Dep",{"type":405,"tag":443,"props":778,"children":779},{"style":466},[780],{"type":411,"value":596},{"type":405,"tag":443,"props":782,"children":783},{"class":445,"line":456},[784,789,794],{"type":405,"tag":443,"props":785,"children":786},{"style":588},[787],{"type":411,"value":788},"  constructor",{"type":405,"tag":443,"props":790,"children":791},{"style":466},[792],{"type":411,"value":793}," ()",{"type":405,"tag":443,"props":795,"children":796},{"style":466},[797],{"type":411,"value":596},{"type":405,"tag":443,"props":799,"children":800},{"class":445,"line":535},[801,807,811,816,821],{"type":405,"tag":443,"props":802,"children":804},{"style":803},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[805],{"type":411,"value":806},"    this",{"type":405,"tag":443,"props":808,"children":809},{"style":466},[810],{"type":411,"value":469},{"type":405,"tag":443,"props":812,"children":813},{"style":460},[814],{"type":411,"value":815},"subs",{"type":405,"tag":443,"props":817,"children":818},{"style":696},[819],{"type":411,"value":820}," =",{"type":405,"tag":443,"props":822,"children":823},{"style":509},[824],{"type":411,"value":825}," []\n",{"type":405,"tag":443,"props":827,"children":828},{"class":445,"line":544},[829],{"type":405,"tag":443,"props":830,"children":831},{"style":466},[832],{"type":411,"value":833},"  }\n",{"type":405,"tag":443,"props":835,"children":836},{"class":445,"line":599},[837],{"type":405,"tag":443,"props":838,"children":839},{"style":450},[840],{"type":411,"value":841},"  // 将回调添加到数组中\n",{"type":405,"tag":443,"props":843,"children":844},{"class":445,"line":647},[845,851,856,861,866,870,875],{"type":405,"tag":443,"props":846,"children":848},{"style":847},"--shiki-light:#E53935;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[849],{"type":411,"value":850},"  addSub",{"type":405,"tag":443,"props":852,"children":853},{"style":466},[854],{"type":411,"value":855}," (",{"type":405,"tag":443,"props":857,"children":858},{"style":582},[859],{"type":411,"value":860},"fn",{"type":405,"tag":443,"props":862,"children":863},{"style":466},[864],{"type":411,"value":865},")",{"type":405,"tag":443,"props":867,"children":868},{"style":466},[869],{"type":411,"value":506},{"type":405,"tag":443,"props":871,"children":872},{"style":450},[873],{"type":411,"value":874}," /*...*/",{"type":405,"tag":443,"props":876,"children":877},{"style":466},[878],{"type":411,"value":879}," }\n",{"type":405,"tag":443,"props":881,"children":882},{"class":445,"line":660},[883,888,892,896,900,904,908],{"type":405,"tag":443,"props":884,"children":885},{"style":847},[886],{"type":411,"value":887},"  delSub",{"type":405,"tag":443,"props":889,"children":890},{"style":466},[891],{"type":411,"value":855},{"type":405,"tag":443,"props":893,"children":894},{"style":582},[895],{"type":411,"value":860},{"type":405,"tag":443,"props":897,"children":898},{"style":466},[899],{"type":411,"value":865},{"type":405,"tag":443,"props":901,"children":902},{"style":466},[903],{"type":411,"value":506},{"type":405,"tag":443,"props":905,"children":906},{"style":450},[907],{"type":411,"value":874},{"type":405,"tag":443,"props":909,"children":910},{"style":466},[911],{"type":411,"value":879},{"type":405,"tag":443,"props":913,"children":915},{"class":445,"line":914},8,[916],{"type":405,"tag":443,"props":917,"children":918},{"style":450},[919],{"type":411,"value":920},"  // 执行数组中每一项函数\n",{"type":405,"tag":443,"props":922,"children":924},{"class":445,"line":923},9,[925,930,934,939,943,948,952],{"type":405,"tag":443,"props":926,"children":927},{"style":847},[928],{"type":411,"value":929},"  notify",{"type":405,"tag":443,"props":931,"children":932},{"style":466},[933],{"type":411,"value":855},{"type":405,"tag":443,"props":935,"children":936},{"style":582},[937],{"type":411,"value":938},"newVal",{"type":405,"tag":443,"props":940,"children":941},{"style":466},[942],{"type":411,"value":501},{"type":405,"tag":443,"props":944,"children":945},{"style":582},[946],{"type":411,"value":947}," oldVal",{"type":405,"tag":443,"props":949,"children":950},{"style":466},[951],{"type":411,"value":865},{"type":405,"tag":443,"props":953,"children":954},{"style":466},[955],{"type":411,"value":596},{"type":405,"tag":443,"props":957,"children":959},{"class":445,"line":958},10,[960,964,968,972,976,981,985,990,994,999,1003,1007,1011,1015],{"type":405,"tag":443,"props":961,"children":962},{"style":803},[963],{"type":411,"value":806},{"type":405,"tag":443,"props":965,"children":966},{"style":466},[967],{"type":411,"value":469},{"type":405,"tag":443,"props":969,"children":970},{"style":460},[971],{"type":411,"value":815},{"type":405,"tag":443,"props":973,"children":974},{"style":466},[975],{"type":411,"value":469},{"type":405,"tag":443,"props":977,"children":978},{"style":472},[979],{"type":411,"value":980},"forEach",{"type":405,"tag":443,"props":982,"children":983},{"style":509},[984],{"type":411,"value":480},{"type":405,"tag":443,"props":986,"children":987},{"style":582},[988],{"type":411,"value":989},"func",{"type":405,"tag":443,"props":991,"children":992},{"style":588},[993],{"type":411,"value":591},{"type":405,"tag":443,"props":995,"children":996},{"style":472},[997],{"type":411,"value":998}," func",{"type":405,"tag":443,"props":1000,"children":1001},{"style":509},[1002],{"type":411,"value":480},{"type":405,"tag":443,"props":1004,"children":1005},{"style":460},[1006],{"type":411,"value":938},{"type":405,"tag":443,"props":1008,"children":1009},{"style":466},[1010],{"type":411,"value":501},{"type":405,"tag":443,"props":1012,"children":1013},{"style":460},[1014],{"type":411,"value":947},{"type":405,"tag":443,"props":1016,"children":1017},{"style":509},[1018],{"type":411,"value":1019},"))\n",{"type":405,"tag":443,"props":1021,"children":1023},{"class":445,"line":1022},11,[1024],{"type":405,"tag":443,"props":1025,"children":1026},{"style":466},[1027],{"type":411,"value":833},{"type":405,"tag":443,"props":1029,"children":1031},{"class":445,"line":1030},12,[1032],{"type":405,"tag":443,"props":1033,"children":1034},{"style":466},[1035],{"type":411,"value":1036},"}\n",{"type":405,"tag":413,"props":1038,"children":1039},{},[1040,1042,1048],{"type":411,"value":1041},"全局对象中每一个响应式属性(及其每一个子属性), 都应该和一个新的 Dep 实例保持一一对应的关系, 这样我们进行侦听变化, 执行订阅的回调函数时, 只需要找到对应的实例执行",{"type":405,"tag":419,"props":1043,"children":1045},{"className":1044},[],[1046],{"type":411,"value":1047},"notify",{"type":411,"value":1049},"通知更新即可.",{"type":405,"tag":406,"props":1051,"children":1053},{"id":1052},"设置响应式属性",[1054],{"type":411,"value":1052},{"type":405,"tag":1056,"props":1057,"children":1059},"h3",{"id":1058},"defineproperty",[1060],{"type":411,"value":1061},"defineProperty",{"type":405,"tag":413,"props":1063,"children":1064},{},[1065,1067,1072],{"type":411,"value":1066},"可能是因为接触 DefineProperty 要比接触 Proxy 早一些的缘故, 代码使用了前者进行响应式的实现, Object.defineProperty 方法会直接在一个对象上定义一个新属性, 这里快速过一遍",{"type":405,"tag":419,"props":1068,"children":1070},{"className":1069},[],[1071],{"type":411,"value":1061},{"type":411,"value":1073},"具体配置:",{"type":405,"tag":433,"props":1075,"children":1077},{"className":435,"code":1076,"language":437,"meta":398,"style":398},"// @param obj 要在其上定义属性的对象\n// @param key 要定义或修改的属性的名称\nObject.defineProperty(obj, key, {\n  // 该属性是否能被枚举\n  enumerable: true,\n  // 该属性能否被删除\n  configurable: true,\n  // 访问该属性则会执行此方法\n  get: () => {\n    return val\n  },\n  // 修改该属性时会执行此方法\n  set: newVal => {\n    val = newVal\n  },\n  // value & writeble 不能和 getter/setter 同时出现\n})\n",[1078],{"type":405,"tag":419,"props":1079,"children":1080},{"__ignoreMap":398},[1081,1089,1097,1135,1143,1166,1174,1194,1202,1226,1240,1248,1256,1281,1299,1307,1316],{"type":405,"tag":443,"props":1082,"children":1083},{"class":445,"line":446},[1084],{"type":405,"tag":443,"props":1085,"children":1086},{"style":450},[1087],{"type":411,"value":1088},"// @param obj 要在其上定义属性的对象\n",{"type":405,"tag":443,"props":1090,"children":1091},{"class":445,"line":456},[1092],{"type":405,"tag":443,"props":1093,"children":1094},{"style":450},[1095],{"type":411,"value":1096},"// @param key 要定义或修改的属性的名称\n",{"type":405,"tag":443,"props":1098,"children":1099},{"class":445,"line":535},[1100,1105,1109,1113,1118,1122,1127,1131],{"type":405,"tag":443,"props":1101,"children":1102},{"style":460},[1103],{"type":411,"value":1104},"Object",{"type":405,"tag":443,"props":1106,"children":1107},{"style":466},[1108],{"type":411,"value":469},{"type":405,"tag":443,"props":1110,"children":1111},{"style":472},[1112],{"type":411,"value":1061},{"type":405,"tag":443,"props":1114,"children":1115},{"style":460},[1116],{"type":411,"value":1117},"(obj",{"type":405,"tag":443,"props":1119,"children":1120},{"style":466},[1121],{"type":411,"value":501},{"type":405,"tag":443,"props":1123,"children":1124},{"style":460},[1125],{"type":411,"value":1126}," key",{"type":405,"tag":443,"props":1128,"children":1129},{"style":466},[1130],{"type":411,"value":501},{"type":405,"tag":443,"props":1132,"children":1133},{"style":466},[1134],{"type":411,"value":596},{"type":405,"tag":443,"props":1136,"children":1137},{"class":445,"line":544},[1138],{"type":405,"tag":443,"props":1139,"children":1140},{"style":450},[1141],{"type":411,"value":1142},"  // 该属性是否能被枚举\n",{"type":405,"tag":443,"props":1144,"children":1145},{"class":445,"line":599},[1146,1151,1155,1161],{"type":405,"tag":443,"props":1147,"children":1148},{"style":509},[1149],{"type":411,"value":1150},"  enumerable",{"type":405,"tag":443,"props":1152,"children":1153},{"style":466},[1154],{"type":411,"value":517},{"type":405,"tag":443,"props":1156,"children":1158},{"style":1157},"--shiki-light:#FF5370;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[1159],{"type":411,"value":1160}," true",{"type":405,"tag":443,"props":1162,"children":1163},{"style":466},[1164],{"type":411,"value":1165},",\n",{"type":405,"tag":443,"props":1167,"children":1168},{"class":445,"line":647},[1169],{"type":405,"tag":443,"props":1170,"children":1171},{"style":450},[1172],{"type":411,"value":1173},"  // 该属性能否被删除\n",{"type":405,"tag":443,"props":1175,"children":1176},{"class":445,"line":660},[1177,1182,1186,1190],{"type":405,"tag":443,"props":1178,"children":1179},{"style":509},[1180],{"type":411,"value":1181},"  configurable",{"type":405,"tag":443,"props":1183,"children":1184},{"style":466},[1185],{"type":411,"value":517},{"type":405,"tag":443,"props":1187,"children":1188},{"style":1157},[1189],{"type":411,"value":1160},{"type":405,"tag":443,"props":1191,"children":1192},{"style":466},[1193],{"type":411,"value":1165},{"type":405,"tag":443,"props":1195,"children":1196},{"class":445,"line":914},[1197],{"type":405,"tag":443,"props":1198,"children":1199},{"style":450},[1200],{"type":411,"value":1201},"  // 访问该属性则会执行此方法\n",{"type":405,"tag":443,"props":1203,"children":1204},{"class":445,"line":923},[1205,1210,1214,1218,1222],{"type":405,"tag":443,"props":1206,"children":1207},{"style":472},[1208],{"type":411,"value":1209},"  get",{"type":405,"tag":443,"props":1211,"children":1212},{"style":466},[1213],{"type":411,"value":517},{"type":405,"tag":443,"props":1215,"children":1216},{"style":466},[1217],{"type":411,"value":793},{"type":405,"tag":443,"props":1219,"children":1220},{"style":588},[1221],{"type":411,"value":591},{"type":405,"tag":443,"props":1223,"children":1224},{"style":466},[1225],{"type":411,"value":596},{"type":405,"tag":443,"props":1227,"children":1228},{"class":445,"line":958},[1229,1235],{"type":405,"tag":443,"props":1230,"children":1232},{"style":1231},"--shiki-light:#39ADB5;--shiki-light-font-style:italic;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#F92672;--shiki-sepia-font-style:inherit",[1233],{"type":411,"value":1234},"    return",{"type":405,"tag":443,"props":1236,"children":1237},{"style":460},[1238],{"type":411,"value":1239}," val\n",{"type":405,"tag":443,"props":1241,"children":1242},{"class":445,"line":1022},[1243],{"type":405,"tag":443,"props":1244,"children":1245},{"style":466},[1246],{"type":411,"value":1247},"  },\n",{"type":405,"tag":443,"props":1249,"children":1250},{"class":445,"line":1030},[1251],{"type":405,"tag":443,"props":1252,"children":1253},{"style":450},[1254],{"type":411,"value":1255},"  // 修改该属性时会执行此方法\n",{"type":405,"tag":443,"props":1257,"children":1259},{"class":445,"line":1258},13,[1260,1265,1269,1273,1277],{"type":405,"tag":443,"props":1261,"children":1262},{"style":472},[1263],{"type":411,"value":1264},"  set",{"type":405,"tag":443,"props":1266,"children":1267},{"style":466},[1268],{"type":411,"value":517},{"type":405,"tag":443,"props":1270,"children":1271},{"style":582},[1272],{"type":411,"value":585},{"type":405,"tag":443,"props":1274,"children":1275},{"style":588},[1276],{"type":411,"value":591},{"type":405,"tag":443,"props":1278,"children":1279},{"style":466},[1280],{"type":411,"value":596},{"type":405,"tag":443,"props":1282,"children":1284},{"class":445,"line":1283},14,[1285,1290,1294],{"type":405,"tag":443,"props":1286,"children":1287},{"style":460},[1288],{"type":411,"value":1289},"    val",{"type":405,"tag":443,"props":1291,"children":1292},{"style":696},[1293],{"type":411,"value":820},{"type":405,"tag":443,"props":1295,"children":1296},{"style":460},[1297],{"type":411,"value":1298}," newVal\n",{"type":405,"tag":443,"props":1300,"children":1302},{"class":445,"line":1301},15,[1303],{"type":405,"tag":443,"props":1304,"children":1305},{"style":466},[1306],{"type":411,"value":1247},{"type":405,"tag":443,"props":1308,"children":1310},{"class":445,"line":1309},16,[1311],{"type":405,"tag":443,"props":1312,"children":1313},{"style":450},[1314],{"type":411,"value":1315},"  // value & writeble 不能和 getter/setter 同时出现\n",{"type":405,"tag":443,"props":1317,"children":1319},{"class":445,"line":1318},17,[1320,1324],{"type":405,"tag":443,"props":1321,"children":1322},{"style":466},[1323],{"type":411,"value":653},{"type":405,"tag":443,"props":1325,"children":1326},{"style":460},[1327],{"type":411,"value":532},{"type":405,"tag":413,"props":1329,"children":1330},{},[1331],{"type":411,"value":1332},"通过对 defineProperty 进行上层封装, 我们可以轻松的实现在全局对象上设置响应式属性功能, 在此, 我们结合刚才定义的 Dep 对象, 将一个新的 dep 实例绑定到新增属性的 setter 中:",{"type":405,"tag":433,"props":1334,"children":1336},{"className":435,"code":1335,"language":437,"meta":398,"style":398},"set (key, val, options = {}, obj = this.store) {\n  const dep = new Dep()\n  Object.defineProperty(obj, key, {\n    enumerable: true,\n    configurable: true,\n    get: () => {\n      return val\n    },\n    set: newVal => {\n      if (newVal === val) {\n        return\n      }\n      dep.notify(newVal, val)\n      val = newVal\n    }\n  })\n}\n",[1337],{"type":405,"tag":419,"props":1338,"children":1339},{"__ignoreMap":398},[1340,1406,1438,1479,1499,1519,1543,1555,1563,1587,1621,1629,1637,1673,1689,1697,1709],{"type":405,"tag":443,"props":1341,"children":1342},{"class":445,"line":446},[1343,1347,1352,1356,1360,1364,1369,1373,1378,1383,1387,1392,1396,1401],{"type":405,"tag":443,"props":1344,"children":1345},{"style":472},[1346],{"type":411,"value":475},{"type":405,"tag":443,"props":1348,"children":1349},{"style":460},[1350],{"type":411,"value":1351}," (key",{"type":405,"tag":443,"props":1353,"children":1354},{"style":466},[1355],{"type":411,"value":501},{"type":405,"tag":443,"props":1357,"children":1358},{"style":460},[1359],{"type":411,"value":512},{"type":405,"tag":443,"props":1361,"children":1362},{"style":466},[1363],{"type":411,"value":501},{"type":405,"tag":443,"props":1365,"children":1366},{"style":460},[1367],{"type":411,"value":1368}," options ",{"type":405,"tag":443,"props":1370,"children":1371},{"style":696},[1372],{"type":411,"value":699},{"type":405,"tag":443,"props":1374,"children":1375},{"style":466},[1376],{"type":411,"value":1377}," {},",{"type":405,"tag":443,"props":1379,"children":1380},{"style":460},[1381],{"type":411,"value":1382}," obj ",{"type":405,"tag":443,"props":1384,"children":1385},{"style":696},[1386],{"type":411,"value":699},{"type":405,"tag":443,"props":1388,"children":1389},{"style":803},[1390],{"type":411,"value":1391}," this",{"type":405,"tag":443,"props":1393,"children":1394},{"style":466},[1395],{"type":411,"value":469},{"type":405,"tag":443,"props":1397,"children":1398},{"style":460},[1399],{"type":411,"value":1400},"store) ",{"type":405,"tag":443,"props":1402,"children":1403},{"style":466},[1404],{"type":411,"value":1405},"{\n",{"type":405,"tag":443,"props":1407,"children":1408},{"class":445,"line":456},[1409,1414,1420,1424,1429,1433],{"type":405,"tag":443,"props":1410,"children":1411},{"style":588},[1412],{"type":411,"value":1413},"  const",{"type":405,"tag":443,"props":1415,"children":1417},{"style":1416},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#F8F8F2",[1418],{"type":411,"value":1419}," dep",{"type":405,"tag":443,"props":1421,"children":1422},{"style":696},[1423],{"type":411,"value":820},{"type":405,"tag":443,"props":1425,"children":1426},{"style":696},[1427],{"type":411,"value":1428}," new",{"type":405,"tag":443,"props":1430,"children":1431},{"style":472},[1432],{"type":411,"value":776},{"type":405,"tag":443,"props":1434,"children":1435},{"style":509},[1436],{"type":411,"value":1437},"()\n",{"type":405,"tag":443,"props":1439,"children":1440},{"class":445,"line":535},[1441,1446,1450,1454,1458,1463,1467,1471,1475],{"type":405,"tag":443,"props":1442,"children":1443},{"style":460},[1444],{"type":411,"value":1445},"  Object",{"type":405,"tag":443,"props":1447,"children":1448},{"style":466},[1449],{"type":411,"value":469},{"type":405,"tag":443,"props":1451,"children":1452},{"style":472},[1453],{"type":411,"value":1061},{"type":405,"tag":443,"props":1455,"children":1456},{"style":509},[1457],{"type":411,"value":480},{"type":405,"tag":443,"props":1459,"children":1460},{"style":460},[1461],{"type":411,"value":1462},"obj",{"type":405,"tag":443,"props":1464,"children":1465},{"style":466},[1466],{"type":411,"value":501},{"type":405,"tag":443,"props":1468,"children":1469},{"style":460},[1470],{"type":411,"value":1126},{"type":405,"tag":443,"props":1472,"children":1473},{"style":466},[1474],{"type":411,"value":501},{"type":405,"tag":443,"props":1476,"children":1477},{"style":466},[1478],{"type":411,"value":596},{"type":405,"tag":443,"props":1480,"children":1481},{"class":445,"line":544},[1482,1487,1491,1495],{"type":405,"tag":443,"props":1483,"children":1484},{"style":509},[1485],{"type":411,"value":1486},"    enumerable",{"type":405,"tag":443,"props":1488,"children":1489},{"style":466},[1490],{"type":411,"value":517},{"type":405,"tag":443,"props":1492,"children":1493},{"style":1157},[1494],{"type":411,"value":1160},{"type":405,"tag":443,"props":1496,"children":1497},{"style":466},[1498],{"type":411,"value":1165},{"type":405,"tag":443,"props":1500,"children":1501},{"class":445,"line":599},[1502,1507,1511,1515],{"type":405,"tag":443,"props":1503,"children":1504},{"style":509},[1505],{"type":411,"value":1506},"    configurable",{"type":405,"tag":443,"props":1508,"children":1509},{"style":466},[1510],{"type":411,"value":517},{"type":405,"tag":443,"props":1512,"children":1513},{"style":1157},[1514],{"type":411,"value":1160},{"type":405,"tag":443,"props":1516,"children":1517},{"style":466},[1518],{"type":411,"value":1165},{"type":405,"tag":443,"props":1520,"children":1521},{"class":445,"line":647},[1522,1527,1531,1535,1539],{"type":405,"tag":443,"props":1523,"children":1524},{"style":472},[1525],{"type":411,"value":1526},"    get",{"type":405,"tag":443,"props":1528,"children":1529},{"style":466},[1530],{"type":411,"value":517},{"type":405,"tag":443,"props":1532,"children":1533},{"style":466},[1534],{"type":411,"value":793},{"type":405,"tag":443,"props":1536,"children":1537},{"style":588},[1538],{"type":411,"value":591},{"type":405,"tag":443,"props":1540,"children":1541},{"style":466},[1542],{"type":411,"value":596},{"type":405,"tag":443,"props":1544,"children":1545},{"class":445,"line":660},[1546,1551],{"type":405,"tag":443,"props":1547,"children":1548},{"style":1231},[1549],{"type":411,"value":1550},"      return",{"type":405,"tag":443,"props":1552,"children":1553},{"style":460},[1554],{"type":411,"value":1239},{"type":405,"tag":443,"props":1556,"children":1557},{"class":445,"line":914},[1558],{"type":405,"tag":443,"props":1559,"children":1560},{"style":466},[1561],{"type":411,"value":1562},"    },\n",{"type":405,"tag":443,"props":1564,"children":1565},{"class":445,"line":923},[1566,1571,1575,1579,1583],{"type":405,"tag":443,"props":1567,"children":1568},{"style":472},[1569],{"type":411,"value":1570},"    set",{"type":405,"tag":443,"props":1572,"children":1573},{"style":466},[1574],{"type":411,"value":517},{"type":405,"tag":443,"props":1576,"children":1577},{"style":582},[1578],{"type":411,"value":585},{"type":405,"tag":443,"props":1580,"children":1581},{"style":588},[1582],{"type":411,"value":591},{"type":405,"tag":443,"props":1584,"children":1585},{"style":466},[1586],{"type":411,"value":596},{"type":405,"tag":443,"props":1588,"children":1589},{"class":445,"line":958},[1590,1595,1599,1603,1608,1612,1617],{"type":405,"tag":443,"props":1591,"children":1592},{"style":1231},[1593],{"type":411,"value":1594},"      if",{"type":405,"tag":443,"props":1596,"children":1597},{"style":509},[1598],{"type":411,"value":855},{"type":405,"tag":443,"props":1600,"children":1601},{"style":460},[1602],{"type":411,"value":938},{"type":405,"tag":443,"props":1604,"children":1605},{"style":696},[1606],{"type":411,"value":1607}," ===",{"type":405,"tag":443,"props":1609,"children":1610},{"style":460},[1611],{"type":411,"value":512},{"type":405,"tag":443,"props":1613,"children":1614},{"style":509},[1615],{"type":411,"value":1616},") ",{"type":405,"tag":443,"props":1618,"children":1619},{"style":466},[1620],{"type":411,"value":1405},{"type":405,"tag":443,"props":1622,"children":1623},{"class":445,"line":1022},[1624],{"type":405,"tag":443,"props":1625,"children":1626},{"style":1231},[1627],{"type":411,"value":1628},"        return\n",{"type":405,"tag":443,"props":1630,"children":1631},{"class":445,"line":1030},[1632],{"type":405,"tag":443,"props":1633,"children":1634},{"style":466},[1635],{"type":411,"value":1636},"      }\n",{"type":405,"tag":443,"props":1638,"children":1639},{"class":445,"line":1258},[1640,1645,1649,1653,1657,1661,1665,1669],{"type":405,"tag":443,"props":1641,"children":1642},{"style":460},[1643],{"type":411,"value":1644},"      dep",{"type":405,"tag":443,"props":1646,"children":1647},{"style":466},[1648],{"type":411,"value":469},{"type":405,"tag":443,"props":1650,"children":1651},{"style":472},[1652],{"type":411,"value":1047},{"type":405,"tag":443,"props":1654,"children":1655},{"style":509},[1656],{"type":411,"value":480},{"type":405,"tag":443,"props":1658,"children":1659},{"style":460},[1660],{"type":411,"value":938},{"type":405,"tag":443,"props":1662,"children":1663},{"style":466},[1664],{"type":411,"value":501},{"type":405,"tag":443,"props":1666,"children":1667},{"style":460},[1668],{"type":411,"value":512},{"type":405,"tag":443,"props":1670,"children":1671},{"style":509},[1672],{"type":411,"value":532},{"type":405,"tag":443,"props":1674,"children":1675},{"class":445,"line":1283},[1676,1681,1685],{"type":405,"tag":443,"props":1677,"children":1678},{"style":460},[1679],{"type":411,"value":1680},"      val",{"type":405,"tag":443,"props":1682,"children":1683},{"style":696},[1684],{"type":411,"value":820},{"type":405,"tag":443,"props":1686,"children":1687},{"style":460},[1688],{"type":411,"value":1298},{"type":405,"tag":443,"props":1690,"children":1691},{"class":445,"line":1301},[1692],{"type":405,"tag":443,"props":1693,"children":1694},{"style":466},[1695],{"type":411,"value":1696},"    }\n",{"type":405,"tag":443,"props":1698,"children":1699},{"class":445,"line":1309},[1700,1705],{"type":405,"tag":443,"props":1701,"children":1702},{"style":466},[1703],{"type":411,"value":1704},"  }",{"type":405,"tag":443,"props":1706,"children":1707},{"style":509},[1708],{"type":411,"value":532},{"type":405,"tag":443,"props":1710,"children":1711},{"class":445,"line":1318},[1712],{"type":405,"tag":443,"props":1713,"children":1714},{"style":466},[1715],{"type":411,"value":1036},{"type":405,"tag":413,"props":1717,"children":1718},{},[1719],{"type":411,"value":1720},"每当对应属性被赋值, 就会执行依赖数组中的回调函数.",{"type":405,"tag":413,"props":1722,"children":1723},{},[1724],{"type":411,"value":1725},"不过这样还不够, 我们还得想办法获取到这个 dep 实例, 才能给它的依赖数组填充函数.",{"type":405,"tag":413,"props":1727,"children":1728},{},[1729],{"type":411,"value":1730},"这边提供一个很简单的思路, 并不推荐实践中这么做:",{"type":405,"tag":433,"props":1732,"children":1734},{"className":435,"code":1733,"language":437,"meta":398,"style":398},"set (key, val, options = {}, obj = this.store) {\n  const dep = new Dep()\n  Object.defineProperty(obj, key, {})\n  return dep\n}\n",[1735],{"type":405,"tag":419,"props":1736,"children":1737},{"__ignoreMap":398},[1738,1797,1824,1868,1881],{"type":405,"tag":443,"props":1739,"children":1740},{"class":445,"line":446},[1741,1745,1749,1753,1757,1761,1765,1769,1773,1777,1781,1785,1789,1793],{"type":405,"tag":443,"props":1742,"children":1743},{"style":472},[1744],{"type":411,"value":475},{"type":405,"tag":443,"props":1746,"children":1747},{"style":460},[1748],{"type":411,"value":1351},{"type":405,"tag":443,"props":1750,"children":1751},{"style":466},[1752],{"type":411,"value":501},{"type":405,"tag":443,"props":1754,"children":1755},{"style":460},[1756],{"type":411,"value":512},{"type":405,"tag":443,"props":1758,"children":1759},{"style":466},[1760],{"type":411,"value":501},{"type":405,"tag":443,"props":1762,"children":1763},{"style":460},[1764],{"type":411,"value":1368},{"type":405,"tag":443,"props":1766,"children":1767},{"style":696},[1768],{"type":411,"value":699},{"type":405,"tag":443,"props":1770,"children":1771},{"style":466},[1772],{"type":411,"value":1377},{"type":405,"tag":443,"props":1774,"children":1775},{"style":460},[1776],{"type":411,"value":1382},{"type":405,"tag":443,"props":1778,"children":1779},{"style":696},[1780],{"type":411,"value":699},{"type":405,"tag":443,"props":1782,"children":1783},{"style":803},[1784],{"type":411,"value":1391},{"type":405,"tag":443,"props":1786,"children":1787},{"style":466},[1788],{"type":411,"value":469},{"type":405,"tag":443,"props":1790,"children":1791},{"style":460},[1792],{"type":411,"value":1400},{"type":405,"tag":443,"props":1794,"children":1795},{"style":466},[1796],{"type":411,"value":1405},{"type":405,"tag":443,"props":1798,"children":1799},{"class":445,"line":456},[1800,1804,1808,1812,1816,1820],{"type":405,"tag":443,"props":1801,"children":1802},{"style":588},[1803],{"type":411,"value":1413},{"type":405,"tag":443,"props":1805,"children":1806},{"style":1416},[1807],{"type":411,"value":1419},{"type":405,"tag":443,"props":1809,"children":1810},{"style":696},[1811],{"type":411,"value":820},{"type":405,"tag":443,"props":1813,"children":1814},{"style":696},[1815],{"type":411,"value":1428},{"type":405,"tag":443,"props":1817,"children":1818},{"style":472},[1819],{"type":411,"value":776},{"type":405,"tag":443,"props":1821,"children":1822},{"style":509},[1823],{"type":411,"value":1437},{"type":405,"tag":443,"props":1825,"children":1826},{"class":445,"line":535},[1827,1831,1835,1839,1843,1847,1851,1855,1859,1864],{"type":405,"tag":443,"props":1828,"children":1829},{"style":460},[1830],{"type":411,"value":1445},{"type":405,"tag":443,"props":1832,"children":1833},{"style":466},[1834],{"type":411,"value":469},{"type":405,"tag":443,"props":1836,"children":1837},{"style":472},[1838],{"type":411,"value":1061},{"type":405,"tag":443,"props":1840,"children":1841},{"style":509},[1842],{"type":411,"value":480},{"type":405,"tag":443,"props":1844,"children":1845},{"style":460},[1846],{"type":411,"value":1462},{"type":405,"tag":443,"props":1848,"children":1849},{"style":466},[1850],{"type":411,"value":501},{"type":405,"tag":443,"props":1852,"children":1853},{"style":460},[1854],{"type":411,"value":1126},{"type":405,"tag":443,"props":1856,"children":1857},{"style":466},[1858],{"type":411,"value":501},{"type":405,"tag":443,"props":1860,"children":1861},{"style":466},[1862],{"type":411,"value":1863}," {}",{"type":405,"tag":443,"props":1865,"children":1866},{"style":509},[1867],{"type":411,"value":532},{"type":405,"tag":443,"props":1869,"children":1870},{"class":445,"line":544},[1871,1876],{"type":405,"tag":443,"props":1872,"children":1873},{"style":1231},[1874],{"type":411,"value":1875},"  return",{"type":405,"tag":443,"props":1877,"children":1878},{"style":460},[1879],{"type":411,"value":1880}," dep\n",{"type":405,"tag":443,"props":1882,"children":1883},{"class":445,"line":599},[1884],{"type":405,"tag":443,"props":1885,"children":1886},{"style":466},[1887],{"type":411,"value":1036},{"type":405,"tag":433,"props":1889,"children":1891},{"className":435,"code":1890,"language":437,"meta":398,"style":398},"const valueDep = set('value', b, {})\nvalueDep.addSub(() => { console.log('value changed!') })\n",[1892],{"type":405,"tag":419,"props":1893,"children":1894},{"__ignoreMap":398},[1895,1954],{"type":405,"tag":443,"props":1896,"children":1897},{"class":445,"line":446},[1898,1903,1908,1912,1917,1921,1925,1929,1933,1937,1942,1946,1950],{"type":405,"tag":443,"props":1899,"children":1900},{"style":588},[1901],{"type":411,"value":1902},"const",{"type":405,"tag":443,"props":1904,"children":1905},{"style":1416},[1906],{"type":411,"value":1907}," valueDep",{"type":405,"tag":443,"props":1909,"children":1910},{"style":696},[1911],{"type":411,"value":820},{"type":405,"tag":443,"props":1913,"children":1914},{"style":472},[1915],{"type":411,"value":1916}," set",{"type":405,"tag":443,"props":1918,"children":1919},{"style":460},[1920],{"type":411,"value":480},{"type":405,"tag":443,"props":1922,"children":1923},{"style":483},[1924],{"type":411,"value":486},{"type":405,"tag":443,"props":1926,"children":1927},{"style":489},[1928],{"type":411,"value":666},{"type":405,"tag":443,"props":1930,"children":1931},{"style":483},[1932],{"type":411,"value":486},{"type":405,"tag":443,"props":1934,"children":1935},{"style":466},[1936],{"type":411,"value":501},{"type":405,"tag":443,"props":1938,"children":1939},{"style":460},[1940],{"type":411,"value":1941}," b",{"type":405,"tag":443,"props":1943,"children":1944},{"style":466},[1945],{"type":411,"value":501},{"type":405,"tag":443,"props":1947,"children":1948},{"style":466},[1949],{"type":411,"value":1863},{"type":405,"tag":443,"props":1951,"children":1952},{"style":460},[1953],{"type":411,"value":532},{"type":405,"tag":443,"props":1955,"children":1956},{"class":445,"line":456},[1957,1962,1966,1971,1975,1980,1984,1988,1993,1997,2001,2005,2009,2014,2018,2022,2026],{"type":405,"tag":443,"props":1958,"children":1959},{"style":460},[1960],{"type":411,"value":1961},"valueDep",{"type":405,"tag":443,"props":1963,"children":1964},{"style":466},[1965],{"type":411,"value":469},{"type":405,"tag":443,"props":1967,"children":1968},{"style":472},[1969],{"type":411,"value":1970},"addSub",{"type":405,"tag":443,"props":1972,"children":1973},{"style":460},[1974],{"type":411,"value":480},{"type":405,"tag":443,"props":1976,"children":1977},{"style":466},[1978],{"type":411,"value":1979},"()",{"type":405,"tag":443,"props":1981,"children":1982},{"style":588},[1983],{"type":411,"value":591},{"type":405,"tag":443,"props":1985,"children":1986},{"style":466},[1987],{"type":411,"value":506},{"type":405,"tag":443,"props":1989,"children":1990},{"style":460},[1991],{"type":411,"value":1992}," console",{"type":405,"tag":443,"props":1994,"children":1995},{"style":466},[1996],{"type":411,"value":469},{"type":405,"tag":443,"props":1998,"children":1999},{"style":472},[2000],{"type":411,"value":614},{"type":405,"tag":443,"props":2002,"children":2003},{"style":509},[2004],{"type":411,"value":480},{"type":405,"tag":443,"props":2006,"children":2007},{"style":483},[2008],{"type":411,"value":486},{"type":405,"tag":443,"props":2010,"children":2011},{"style":489},[2012],{"type":411,"value":2013},"value changed!",{"type":405,"tag":443,"props":2015,"children":2016},{"style":483},[2017],{"type":411,"value":486},{"type":405,"tag":443,"props":2019,"children":2020},{"style":509},[2021],{"type":411,"value":1616},{"type":405,"tag":443,"props":2023,"children":2024},{"style":466},[2025],{"type":411,"value":653},{"type":405,"tag":443,"props":2027,"children":2028},{"style":460},[2029],{"type":411,"value":532},{"type":405,"tag":413,"props":2031,"children":2032},{},[2033],{"type":411,"value":2034},"虽然代码能使用了, 就是是看起来怪怪的~ 😋 我们的三轮车开进了岔路~",{"type":405,"tag":406,"props":2036,"children":2038},{"id":2037},"通过-watch-添加订阅",[2039],{"type":411,"value":2040},"通过 watch 添加订阅",{"type":405,"tag":1056,"props":2042,"children":2044},{"id":2043},"喝口水我们继续",[2045],{"type":411,"value":2043},{"type":405,"tag":413,"props":2047,"children":2048},{},[2049],{"type":411,"value":2050},"《黑客与画家》中曾经提到这样一个观点, 我深有体会:",{"type":405,"tag":2052,"props":2053,"children":2054},"blockquote",{},[2055],{"type":405,"tag":413,"props":2056,"children":2057},{},[2058],{"type":411,"value":2059},"如果你觉得你的代码奇怪, 那么往往它是错的",{"type":405,"tag":413,"props":2061,"children":2062},{},[2063],{"type":411,"value":2064},"上面的那一串代码仅仅是能跑通的水平, 我们需要加入更多的细节和思考, 有时候只需要坐下来稍微看一下代码, 就会有各种想法蹦出来:",{"type":405,"tag":2052,"props":2066,"children":2067},{},[2068],{"type":405,"tag":413,"props":2069,"children":2070},{},[2071],{"type":411,"value":2072},"构思这种东西有一个特点，那就是它会导致更多的构思。你有没有注意过，坐下来写东西的时候，一半的构思是写作时产生的？",{"type":405,"tag":1056,"props":2074,"children":2076},{"id":2075},"隐藏-dep",[2077],{"type":411,"value":2078},"隐藏 Dep",{"type":405,"tag":413,"props":2080,"children":2081},{},[2082],{"type":411,"value":2083},"这些内容应和外部是解耦的. 首先一点, 我们创建一个侦听器类, 用于封装我们侦听所用到的所有方法, 它包含了我们想要的全局对象以及操作它的方法(如 watch,set):",{"type":405,"tag":433,"props":2085,"children":2087},{"className":435,"code":2086,"language":437,"meta":398,"style":398},"class VX {\n  constructor () {\n    this.store = Object.create(null)\n  }\n  watch (key, fn, obj = this.store) {}\n  set (key, val, options = {}, obj = this.store) {}\n}\nconst vx = new VX()\n",[2088],{"type":405,"tag":419,"props":2089,"children":2090},{"__ignoreMap":398},[2091,2107,2122,2170,2177,2237,2305,2312],{"type":405,"tag":443,"props":2092,"children":2093},{"class":445,"line":446},[2094,2098,2103],{"type":405,"tag":443,"props":2095,"children":2096},{"style":588},[2097],{"type":411,"value":770},{"type":405,"tag":443,"props":2099,"children":2100},{"style":773},[2101],{"type":411,"value":2102}," VX",{"type":405,"tag":443,"props":2104,"children":2105},{"style":466},[2106],{"type":411,"value":596},{"type":405,"tag":443,"props":2108,"children":2109},{"class":445,"line":456},[2110,2114,2118],{"type":405,"tag":443,"props":2111,"children":2112},{"style":588},[2113],{"type":411,"value":788},{"type":405,"tag":443,"props":2115,"children":2116},{"style":466},[2117],{"type":411,"value":793},{"type":405,"tag":443,"props":2119,"children":2120},{"style":466},[2121],{"type":411,"value":596},{"type":405,"tag":443,"props":2123,"children":2124},{"class":445,"line":535},[2125,2129,2133,2138,2142,2147,2151,2156,2160,2166],{"type":405,"tag":443,"props":2126,"children":2127},{"style":803},[2128],{"type":411,"value":806},{"type":405,"tag":443,"props":2130,"children":2131},{"style":466},[2132],{"type":411,"value":469},{"type":405,"tag":443,"props":2134,"children":2135},{"style":460},[2136],{"type":411,"value":2137},"store",{"type":405,"tag":443,"props":2139,"children":2140},{"style":696},[2141],{"type":411,"value":820},{"type":405,"tag":443,"props":2143,"children":2144},{"style":460},[2145],{"type":411,"value":2146}," Object",{"type":405,"tag":443,"props":2148,"children":2149},{"style":466},[2150],{"type":411,"value":469},{"type":405,"tag":443,"props":2152,"children":2153},{"style":472},[2154],{"type":411,"value":2155},"create",{"type":405,"tag":443,"props":2157,"children":2158},{"style":509},[2159],{"type":411,"value":480},{"type":405,"tag":443,"props":2161,"children":2163},{"style":2162},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[2164],{"type":411,"value":2165},"null",{"type":405,"tag":443,"props":2167,"children":2168},{"style":509},[2169],{"type":411,"value":532},{"type":405,"tag":443,"props":2171,"children":2172},{"class":445,"line":544},[2173],{"type":405,"tag":443,"props":2174,"children":2175},{"style":466},[2176],{"type":411,"value":833},{"type":405,"tag":443,"props":2178,"children":2179},{"class":445,"line":599},[2180,2185,2189,2194,2198,2203,2207,2212,2216,2220,2224,2228,2232],{"type":405,"tag":443,"props":2181,"children":2182},{"style":847},[2183],{"type":411,"value":2184},"  watch",{"type":405,"tag":443,"props":2186,"children":2187},{"style":466},[2188],{"type":411,"value":855},{"type":405,"tag":443,"props":2190,"children":2191},{"style":582},[2192],{"type":411,"value":2193},"key",{"type":405,"tag":443,"props":2195,"children":2196},{"style":466},[2197],{"type":411,"value":501},{"type":405,"tag":443,"props":2199,"children":2200},{"style":582},[2201],{"type":411,"value":2202}," fn",{"type":405,"tag":443,"props":2204,"children":2205},{"style":466},[2206],{"type":411,"value":501},{"type":405,"tag":443,"props":2208,"children":2209},{"style":582},[2210],{"type":411,"value":2211}," obj",{"type":405,"tag":443,"props":2213,"children":2214},{"style":696},[2215],{"type":411,"value":820},{"type":405,"tag":443,"props":2217,"children":2218},{"style":803},[2219],{"type":411,"value":1391},{"type":405,"tag":443,"props":2221,"children":2222},{"style":466},[2223],{"type":411,"value":469},{"type":405,"tag":443,"props":2225,"children":2226},{"style":460},[2227],{"type":411,"value":2137},{"type":405,"tag":443,"props":2229,"children":2230},{"style":466},[2231],{"type":411,"value":865},{"type":405,"tag":443,"props":2233,"children":2234},{"style":466},[2235],{"type":411,"value":2236}," {}\n",{"type":405,"tag":443,"props":2238,"children":2239},{"class":445,"line":647},[2240,2244,2248,2252,2256,2260,2264,2269,2273,2277,2281,2285,2289,2293,2297,2301],{"type":405,"tag":443,"props":2241,"children":2242},{"style":847},[2243],{"type":411,"value":1264},{"type":405,"tag":443,"props":2245,"children":2246},{"style":466},[2247],{"type":411,"value":855},{"type":405,"tag":443,"props":2249,"children":2250},{"style":582},[2251],{"type":411,"value":2193},{"type":405,"tag":443,"props":2253,"children":2254},{"style":466},[2255],{"type":411,"value":501},{"type":405,"tag":443,"props":2257,"children":2258},{"style":582},[2259],{"type":411,"value":512},{"type":405,"tag":443,"props":2261,"children":2262},{"style":466},[2263],{"type":411,"value":501},{"type":405,"tag":443,"props":2265,"children":2266},{"style":582},[2267],{"type":411,"value":2268}," options",{"type":405,"tag":443,"props":2270,"children":2271},{"style":696},[2272],{"type":411,"value":820},{"type":405,"tag":443,"props":2274,"children":2275},{"style":466},[2276],{"type":411,"value":1377},{"type":405,"tag":443,"props":2278,"children":2279},{"style":582},[2280],{"type":411,"value":2211},{"type":405,"tag":443,"props":2282,"children":2283},{"style":696},[2284],{"type":411,"value":820},{"type":405,"tag":443,"props":2286,"children":2287},{"style":803},[2288],{"type":411,"value":1391},{"type":405,"tag":443,"props":2290,"children":2291},{"style":466},[2292],{"type":411,"value":469},{"type":405,"tag":443,"props":2294,"children":2295},{"style":460},[2296],{"type":411,"value":2137},{"type":405,"tag":443,"props":2298,"children":2299},{"style":466},[2300],{"type":411,"value":865},{"type":405,"tag":443,"props":2302,"children":2303},{"style":466},[2304],{"type":411,"value":2236},{"type":405,"tag":443,"props":2306,"children":2307},{"class":445,"line":660},[2308],{"type":405,"tag":443,"props":2309,"children":2310},{"style":466},[2311],{"type":411,"value":1036},{"type":405,"tag":443,"props":2313,"children":2314},{"class":445,"line":914},[2315,2319,2324,2328,2332,2336],{"type":405,"tag":443,"props":2316,"children":2317},{"style":588},[2318],{"type":411,"value":1902},{"type":405,"tag":443,"props":2320,"children":2321},{"style":1416},[2322],{"type":411,"value":2323}," vx",{"type":405,"tag":443,"props":2325,"children":2326},{"style":696},[2327],{"type":411,"value":820},{"type":405,"tag":443,"props":2329,"children":2330},{"style":696},[2331],{"type":411,"value":1428},{"type":405,"tag":443,"props":2333,"children":2334},{"style":472},[2335],{"type":411,"value":2102},{"type":405,"tag":443,"props":2337,"children":2338},{"style":460},[2339],{"type":411,"value":1437},{"type":405,"tag":413,"props":2341,"children":2342},{},[2343],{"type":411,"value":2344},"我们可以在 watch 中给对象某个属性添加回调, 就不用去直接操作 Dep 依赖数组了. 只是, 我们在业务代码中调用 watch, 要怎么去获取 obj.key 对应的 dep 呢?",{"type":405,"tag":413,"props":2346,"children":2347},{},[2348],{"type":411,"value":2349},"我们设置一个全局的 depHandler, 在 obj.key 的 getter 中主动将 depHandler 设置为当前 obj.key 的 dep 实例, 那么我们在 watch 函数里, 只要用任意操作触发 obj.key 的 getter, 就能通过 depHandler 得到它的 dep 实例了, 代码形如:",{"type":405,"tag":433,"props":2351,"children":2353},{"className":435,"code":2352,"language":437,"meta":398,"style":398},"  // 一开始没有持有dep实例\n  let handleDep = null\n  class VX {\n    watch (key, fn, obj = this.store) {\n      console.log(obj.key) // 使用任意操作触发obj.key的getter, 那么handleDep将自动引用obj.key的dep实例\n      handleDep.addSub(fn)\n    }\n    set (key, val, options = {}, obj = this.store) {\n      const dep = new Dep()\n      Object.defineProperty(obj, key, {\n        enumerable: true,\n        configurable: true,\n        get: () => {\n          handleDep = dep\n          return val\n        },\n        set: newVal => {}\n      })\n    }\n  }\n",[2354],{"type":405,"tag":419,"props":2355,"children":2356},{"__ignoreMap":398},[2357,2365,2387,2403,2459,2500,2528,2535,2602,2630,2670,2690,2710,2734,2750,2762,2770,2794,2807,2815],{"type":405,"tag":443,"props":2358,"children":2359},{"class":445,"line":446},[2360],{"type":405,"tag":443,"props":2361,"children":2362},{"style":450},[2363],{"type":411,"value":2364},"  // 一开始没有持有dep实例\n",{"type":405,"tag":443,"props":2366,"children":2367},{"class":445,"line":456},[2368,2373,2378,2382],{"type":405,"tag":443,"props":2369,"children":2370},{"style":588},[2371],{"type":411,"value":2372},"  let",{"type":405,"tag":443,"props":2374,"children":2375},{"style":460},[2376],{"type":411,"value":2377}," handleDep ",{"type":405,"tag":443,"props":2379,"children":2380},{"style":696},[2381],{"type":411,"value":699},{"type":405,"tag":443,"props":2383,"children":2384},{"style":2162},[2385],{"type":411,"value":2386}," null\n",{"type":405,"tag":443,"props":2388,"children":2389},{"class":445,"line":535},[2390,2395,2399],{"type":405,"tag":443,"props":2391,"children":2392},{"style":588},[2393],{"type":411,"value":2394},"  class",{"type":405,"tag":443,"props":2396,"children":2397},{"style":773},[2398],{"type":411,"value":2102},{"type":405,"tag":443,"props":2400,"children":2401},{"style":466},[2402],{"type":411,"value":596},{"type":405,"tag":443,"props":2404,"children":2405},{"class":445,"line":544},[2406,2411,2415,2419,2423,2427,2431,2435,2439,2443,2447,2451,2455],{"type":405,"tag":443,"props":2407,"children":2408},{"style":847},[2409],{"type":411,"value":2410},"    watch",{"type":405,"tag":443,"props":2412,"children":2413},{"style":466},[2414],{"type":411,"value":855},{"type":405,"tag":443,"props":2416,"children":2417},{"style":582},[2418],{"type":411,"value":2193},{"type":405,"tag":443,"props":2420,"children":2421},{"style":466},[2422],{"type":411,"value":501},{"type":405,"tag":443,"props":2424,"children":2425},{"style":582},[2426],{"type":411,"value":2202},{"type":405,"tag":443,"props":2428,"children":2429},{"style":466},[2430],{"type":411,"value":501},{"type":405,"tag":443,"props":2432,"children":2433},{"style":582},[2434],{"type":411,"value":2211},{"type":405,"tag":443,"props":2436,"children":2437},{"style":696},[2438],{"type":411,"value":820},{"type":405,"tag":443,"props":2440,"children":2441},{"style":803},[2442],{"type":411,"value":1391},{"type":405,"tag":443,"props":2444,"children":2445},{"style":466},[2446],{"type":411,"value":469},{"type":405,"tag":443,"props":2448,"children":2449},{"style":460},[2450],{"type":411,"value":2137},{"type":405,"tag":443,"props":2452,"children":2453},{"style":466},[2454],{"type":411,"value":865},{"type":405,"tag":443,"props":2456,"children":2457},{"style":466},[2458],{"type":411,"value":596},{"type":405,"tag":443,"props":2460,"children":2461},{"class":445,"line":599},[2462,2467,2471,2475,2479,2483,2487,2491,2495],{"type":405,"tag":443,"props":2463,"children":2464},{"style":460},[2465],{"type":411,"value":2466},"      console",{"type":405,"tag":443,"props":2468,"children":2469},{"style":466},[2470],{"type":411,"value":469},{"type":405,"tag":443,"props":2472,"children":2473},{"style":472},[2474],{"type":411,"value":614},{"type":405,"tag":443,"props":2476,"children":2477},{"style":509},[2478],{"type":411,"value":480},{"type":405,"tag":443,"props":2480,"children":2481},{"style":460},[2482],{"type":411,"value":1462},{"type":405,"tag":443,"props":2484,"children":2485},{"style":466},[2486],{"type":411,"value":469},{"type":405,"tag":443,"props":2488,"children":2489},{"style":460},[2490],{"type":411,"value":2193},{"type":405,"tag":443,"props":2492,"children":2493},{"style":509},[2494],{"type":411,"value":1616},{"type":405,"tag":443,"props":2496,"children":2497},{"style":450},[2498],{"type":411,"value":2499},"// 使用任意操作触发obj.key的getter, 那么handleDep将自动引用obj.key的dep实例\n",{"type":405,"tag":443,"props":2501,"children":2502},{"class":445,"line":647},[2503,2508,2512,2516,2520,2524],{"type":405,"tag":443,"props":2504,"children":2505},{"style":460},[2506],{"type":411,"value":2507},"      handleDep",{"type":405,"tag":443,"props":2509,"children":2510},{"style":466},[2511],{"type":411,"value":469},{"type":405,"tag":443,"props":2513,"children":2514},{"style":472},[2515],{"type":411,"value":1970},{"type":405,"tag":443,"props":2517,"children":2518},{"style":509},[2519],{"type":411,"value":480},{"type":405,"tag":443,"props":2521,"children":2522},{"style":460},[2523],{"type":411,"value":860},{"type":405,"tag":443,"props":2525,"children":2526},{"style":509},[2527],{"type":411,"value":532},{"type":405,"tag":443,"props":2529,"children":2530},{"class":445,"line":660},[2531],{"type":405,"tag":443,"props":2532,"children":2533},{"style":466},[2534],{"type":411,"value":1696},{"type":405,"tag":443,"props":2536,"children":2537},{"class":445,"line":914},[2538,2542,2546,2550,2554,2558,2562,2566,2570,2574,2578,2582,2586,2590,2594,2598],{"type":405,"tag":443,"props":2539,"children":2540},{"style":847},[2541],{"type":411,"value":1570},{"type":405,"tag":443,"props":2543,"children":2544},{"style":466},[2545],{"type":411,"value":855},{"type":405,"tag":443,"props":2547,"children":2548},{"style":582},[2549],{"type":411,"value":2193},{"type":405,"tag":443,"props":2551,"children":2552},{"style":466},[2553],{"type":411,"value":501},{"type":405,"tag":443,"props":2555,"children":2556},{"style":582},[2557],{"type":411,"value":512},{"type":405,"tag":443,"props":2559,"children":2560},{"style":466},[2561],{"type":411,"value":501},{"type":405,"tag":443,"props":2563,"children":2564},{"style":582},[2565],{"type":411,"value":2268},{"type":405,"tag":443,"props":2567,"children":2568},{"style":696},[2569],{"type":411,"value":820},{"type":405,"tag":443,"props":2571,"children":2572},{"style":466},[2573],{"type":411,"value":1377},{"type":405,"tag":443,"props":2575,"children":2576},{"style":582},[2577],{"type":411,"value":2211},{"type":405,"tag":443,"props":2579,"children":2580},{"style":696},[2581],{"type":411,"value":820},{"type":405,"tag":443,"props":2583,"children":2584},{"style":803},[2585],{"type":411,"value":1391},{"type":405,"tag":443,"props":2587,"children":2588},{"style":466},[2589],{"type":411,"value":469},{"type":405,"tag":443,"props":2591,"children":2592},{"style":460},[2593],{"type":411,"value":2137},{"type":405,"tag":443,"props":2595,"children":2596},{"style":466},[2597],{"type":411,"value":865},{"type":405,"tag":443,"props":2599,"children":2600},{"style":466},[2601],{"type":411,"value":596},{"type":405,"tag":443,"props":2603,"children":2604},{"class":445,"line":923},[2605,2610,2614,2618,2622,2626],{"type":405,"tag":443,"props":2606,"children":2607},{"style":588},[2608],{"type":411,"value":2609},"      const",{"type":405,"tag":443,"props":2611,"children":2612},{"style":1416},[2613],{"type":411,"value":1419},{"type":405,"tag":443,"props":2615,"children":2616},{"style":696},[2617],{"type":411,"value":820},{"type":405,"tag":443,"props":2619,"children":2620},{"style":696},[2621],{"type":411,"value":1428},{"type":405,"tag":443,"props":2623,"children":2624},{"style":472},[2625],{"type":411,"value":776},{"type":405,"tag":443,"props":2627,"children":2628},{"style":509},[2629],{"type":411,"value":1437},{"type":405,"tag":443,"props":2631,"children":2632},{"class":445,"line":958},[2633,2638,2642,2646,2650,2654,2658,2662,2666],{"type":405,"tag":443,"props":2634,"children":2635},{"style":460},[2636],{"type":411,"value":2637},"      Object",{"type":405,"tag":443,"props":2639,"children":2640},{"style":466},[2641],{"type":411,"value":469},{"type":405,"tag":443,"props":2643,"children":2644},{"style":472},[2645],{"type":411,"value":1061},{"type":405,"tag":443,"props":2647,"children":2648},{"style":509},[2649],{"type":411,"value":480},{"type":405,"tag":443,"props":2651,"children":2652},{"style":460},[2653],{"type":411,"value":1462},{"type":405,"tag":443,"props":2655,"children":2656},{"style":466},[2657],{"type":411,"value":501},{"type":405,"tag":443,"props":2659,"children":2660},{"style":460},[2661],{"type":411,"value":1126},{"type":405,"tag":443,"props":2663,"children":2664},{"style":466},[2665],{"type":411,"value":501},{"type":405,"tag":443,"props":2667,"children":2668},{"style":466},[2669],{"type":411,"value":596},{"type":405,"tag":443,"props":2671,"children":2672},{"class":445,"line":1022},[2673,2678,2682,2686],{"type":405,"tag":443,"props":2674,"children":2675},{"style":509},[2676],{"type":411,"value":2677},"        enumerable",{"type":405,"tag":443,"props":2679,"children":2680},{"style":466},[2681],{"type":411,"value":517},{"type":405,"tag":443,"props":2683,"children":2684},{"style":1157},[2685],{"type":411,"value":1160},{"type":405,"tag":443,"props":2687,"children":2688},{"style":466},[2689],{"type":411,"value":1165},{"type":405,"tag":443,"props":2691,"children":2692},{"class":445,"line":1030},[2693,2698,2702,2706],{"type":405,"tag":443,"props":2694,"children":2695},{"style":509},[2696],{"type":411,"value":2697},"        configurable",{"type":405,"tag":443,"props":2699,"children":2700},{"style":466},[2701],{"type":411,"value":517},{"type":405,"tag":443,"props":2703,"children":2704},{"style":1157},[2705],{"type":411,"value":1160},{"type":405,"tag":443,"props":2707,"children":2708},{"style":466},[2709],{"type":411,"value":1165},{"type":405,"tag":443,"props":2711,"children":2712},{"class":445,"line":1258},[2713,2718,2722,2726,2730],{"type":405,"tag":443,"props":2714,"children":2715},{"style":472},[2716],{"type":411,"value":2717},"        get",{"type":405,"tag":443,"props":2719,"children":2720},{"style":466},[2721],{"type":411,"value":517},{"type":405,"tag":443,"props":2723,"children":2724},{"style":466},[2725],{"type":411,"value":793},{"type":405,"tag":443,"props":2727,"children":2728},{"style":588},[2729],{"type":411,"value":591},{"type":405,"tag":443,"props":2731,"children":2732},{"style":466},[2733],{"type":411,"value":596},{"type":405,"tag":443,"props":2735,"children":2736},{"class":445,"line":1283},[2737,2742,2746],{"type":405,"tag":443,"props":2738,"children":2739},{"style":460},[2740],{"type":411,"value":2741},"          handleDep",{"type":405,"tag":443,"props":2743,"children":2744},{"style":696},[2745],{"type":411,"value":820},{"type":405,"tag":443,"props":2747,"children":2748},{"style":460},[2749],{"type":411,"value":1880},{"type":405,"tag":443,"props":2751,"children":2752},{"class":445,"line":1301},[2753,2758],{"type":405,"tag":443,"props":2754,"children":2755},{"style":1231},[2756],{"type":411,"value":2757},"          return",{"type":405,"tag":443,"props":2759,"children":2760},{"style":460},[2761],{"type":411,"value":1239},{"type":405,"tag":443,"props":2763,"children":2764},{"class":445,"line":1309},[2765],{"type":405,"tag":443,"props":2766,"children":2767},{"style":466},[2768],{"type":411,"value":2769},"        },\n",{"type":405,"tag":443,"props":2771,"children":2772},{"class":445,"line":1318},[2773,2778,2782,2786,2790],{"type":405,"tag":443,"props":2774,"children":2775},{"style":472},[2776],{"type":411,"value":2777},"        set",{"type":405,"tag":443,"props":2779,"children":2780},{"style":466},[2781],{"type":411,"value":517},{"type":405,"tag":443,"props":2783,"children":2784},{"style":582},[2785],{"type":411,"value":585},{"type":405,"tag":443,"props":2787,"children":2788},{"style":588},[2789],{"type":411,"value":591},{"type":405,"tag":443,"props":2791,"children":2792},{"style":466},[2793],{"type":411,"value":2236},{"type":405,"tag":443,"props":2795,"children":2797},{"class":445,"line":2796},18,[2798,2803],{"type":405,"tag":443,"props":2799,"children":2800},{"style":466},[2801],{"type":411,"value":2802},"      }",{"type":405,"tag":443,"props":2804,"children":2805},{"style":509},[2806],{"type":411,"value":532},{"type":405,"tag":443,"props":2808,"children":2810},{"class":445,"line":2809},19,[2811],{"type":405,"tag":443,"props":2812,"children":2813},{"style":466},[2814],{"type":411,"value":1696},{"type":405,"tag":443,"props":2816,"children":2818},{"class":445,"line":2817},20,[2819],{"type":405,"tag":443,"props":2820,"children":2821},{"style":466},[2822],{"type":411,"value":833},{"type":405,"tag":1056,"props":2824,"children":2826},{"id":2825},"主动收集依赖",[2827],{"type":411,"value":2825},{"type":405,"tag":413,"props":2829,"children":2830},{},[2831,2833,2839,2841,2847,2849,2855],{"type":411,"value":2832},"我们增加",{"type":405,"tag":419,"props":2834,"children":2836},{"className":2835},[],[2837],{"type":411,"value":2838},"handleDep.addSub(fn)",{"type":411,"value":2840},"添加回调函数的逻辑, 其实可以直接放到 getter 中, 首先在 Dep 类中封装一个'主动'收集依赖的",{"type":405,"tag":419,"props":2842,"children":2844},{"className":2843},[],[2845],{"type":411,"value":2846},"collect",{"type":411,"value":2848},"方法, 他会将全局",{"type":405,"tag":419,"props":2850,"children":2852},{"className":2851},[],[2853],{"type":411,"value":2854},"handleFn",{"type":411,"value":2856},"存放到订阅数组中, 这样一来, 在 watch 函数中, 我们只要触发 obj.key 的 getter, 就可以主动收集依赖了:",{"type":405,"tag":433,"props":2858,"children":2860},{"className":435,"code":2859,"language":437,"meta":398,"style":398},"let handleFn = null\nclass Dep {\n  addSub (fn) {}\n  delSub (fn) {}\n  clear () {}\n  collect (fn = handleFn) {\n    if (fn && !this.subs.find(x => x === fn)) {\n      this.addSub(fn)\n    }\n  }\n  notify (newVal, oldVal) {}\n}\n\nlet handleDep = null\nclass VX {\n  watch (key, fn, obj = this.store) {\n    handleFn = fn\n    console.log(obj.key)\n  }\n  set (key, val, options = {}, obj = this.store) {\n    const dep = new Dep()\n    Object.defineProperty(obj, key, {\n      enumerable: true,\n      configurable: true,\n      get: () => {\n        handleDep = dep\n        handleDep.collect()\n        return val\n      },\n      set: newVal => {}\n    })\n  }\n}\n",[2861],{"type":405,"tag":419,"props":2862,"children":2863},{"__ignoreMap":398},[2864,2885,2900,2923,2946,2962,2995,3078,3106,3113,3120,3151,3158,3166,3185,3200,3255,3272,3308,3315,3382,3411,3452,3473,3494,3519,3536,3556,3569,3578,3603,3616,3624],{"type":405,"tag":443,"props":2865,"children":2866},{"class":445,"line":446},[2867,2872,2877,2881],{"type":405,"tag":443,"props":2868,"children":2869},{"style":588},[2870],{"type":411,"value":2871},"let",{"type":405,"tag":443,"props":2873,"children":2874},{"style":460},[2875],{"type":411,"value":2876}," handleFn ",{"type":405,"tag":443,"props":2878,"children":2879},{"style":696},[2880],{"type":411,"value":699},{"type":405,"tag":443,"props":2882,"children":2883},{"style":2162},[2884],{"type":411,"value":2386},{"type":405,"tag":443,"props":2886,"children":2887},{"class":445,"line":456},[2888,2892,2896],{"type":405,"tag":443,"props":2889,"children":2890},{"style":588},[2891],{"type":411,"value":770},{"type":405,"tag":443,"props":2893,"children":2894},{"style":773},[2895],{"type":411,"value":776},{"type":405,"tag":443,"props":2897,"children":2898},{"style":466},[2899],{"type":411,"value":596},{"type":405,"tag":443,"props":2901,"children":2902},{"class":445,"line":535},[2903,2907,2911,2915,2919],{"type":405,"tag":443,"props":2904,"children":2905},{"style":847},[2906],{"type":411,"value":850},{"type":405,"tag":443,"props":2908,"children":2909},{"style":466},[2910],{"type":411,"value":855},{"type":405,"tag":443,"props":2912,"children":2913},{"style":582},[2914],{"type":411,"value":860},{"type":405,"tag":443,"props":2916,"children":2917},{"style":466},[2918],{"type":411,"value":865},{"type":405,"tag":443,"props":2920,"children":2921},{"style":466},[2922],{"type":411,"value":2236},{"type":405,"tag":443,"props":2924,"children":2925},{"class":445,"line":544},[2926,2930,2934,2938,2942],{"type":405,"tag":443,"props":2927,"children":2928},{"style":847},[2929],{"type":411,"value":887},{"type":405,"tag":443,"props":2931,"children":2932},{"style":466},[2933],{"type":411,"value":855},{"type":405,"tag":443,"props":2935,"children":2936},{"style":582},[2937],{"type":411,"value":860},{"type":405,"tag":443,"props":2939,"children":2940},{"style":466},[2941],{"type":411,"value":865},{"type":405,"tag":443,"props":2943,"children":2944},{"style":466},[2945],{"type":411,"value":2236},{"type":405,"tag":443,"props":2947,"children":2948},{"class":445,"line":599},[2949,2954,2958],{"type":405,"tag":443,"props":2950,"children":2951},{"style":847},[2952],{"type":411,"value":2953},"  clear",{"type":405,"tag":443,"props":2955,"children":2956},{"style":466},[2957],{"type":411,"value":793},{"type":405,"tag":443,"props":2959,"children":2960},{"style":466},[2961],{"type":411,"value":2236},{"type":405,"tag":443,"props":2963,"children":2964},{"class":445,"line":647},[2965,2970,2974,2978,2982,2987,2991],{"type":405,"tag":443,"props":2966,"children":2967},{"style":847},[2968],{"type":411,"value":2969},"  collect",{"type":405,"tag":443,"props":2971,"children":2972},{"style":466},[2973],{"type":411,"value":855},{"type":405,"tag":443,"props":2975,"children":2976},{"style":582},[2977],{"type":411,"value":860},{"type":405,"tag":443,"props":2979,"children":2980},{"style":696},[2981],{"type":411,"value":820},{"type":405,"tag":443,"props":2983,"children":2984},{"style":460},[2985],{"type":411,"value":2986}," handleFn",{"type":405,"tag":443,"props":2988,"children":2989},{"style":466},[2990],{"type":411,"value":865},{"type":405,"tag":443,"props":2992,"children":2993},{"style":466},[2994],{"type":411,"value":596},{"type":405,"tag":443,"props":2996,"children":2997},{"class":445,"line":660},[2998,3003,3007,3011,3016,3021,3026,3030,3034,3038,3043,3047,3052,3056,3061,3065,3069,3074],{"type":405,"tag":443,"props":2999,"children":3000},{"style":1231},[3001],{"type":411,"value":3002},"    if",{"type":405,"tag":443,"props":3004,"children":3005},{"style":509},[3006],{"type":411,"value":855},{"type":405,"tag":443,"props":3008,"children":3009},{"style":460},[3010],{"type":411,"value":860},{"type":405,"tag":443,"props":3012,"children":3013},{"style":696},[3014],{"type":411,"value":3015}," &&",{"type":405,"tag":443,"props":3017,"children":3018},{"style":696},[3019],{"type":411,"value":3020}," !",{"type":405,"tag":443,"props":3022,"children":3023},{"style":803},[3024],{"type":411,"value":3025},"this",{"type":405,"tag":443,"props":3027,"children":3028},{"style":466},[3029],{"type":411,"value":469},{"type":405,"tag":443,"props":3031,"children":3032},{"style":460},[3033],{"type":411,"value":815},{"type":405,"tag":443,"props":3035,"children":3036},{"style":466},[3037],{"type":411,"value":469},{"type":405,"tag":443,"props":3039,"children":3040},{"style":472},[3041],{"type":411,"value":3042},"find",{"type":405,"tag":443,"props":3044,"children":3045},{"style":509},[3046],{"type":411,"value":480},{"type":405,"tag":443,"props":3048,"children":3049},{"style":582},[3050],{"type":411,"value":3051},"x",{"type":405,"tag":443,"props":3053,"children":3054},{"style":588},[3055],{"type":411,"value":591},{"type":405,"tag":443,"props":3057,"children":3058},{"style":460},[3059],{"type":411,"value":3060}," x",{"type":405,"tag":443,"props":3062,"children":3063},{"style":696},[3064],{"type":411,"value":1607},{"type":405,"tag":443,"props":3066,"children":3067},{"style":460},[3068],{"type":411,"value":2202},{"type":405,"tag":443,"props":3070,"children":3071},{"style":509},[3072],{"type":411,"value":3073},")) ",{"type":405,"tag":443,"props":3075,"children":3076},{"style":466},[3077],{"type":411,"value":1405},{"type":405,"tag":443,"props":3079,"children":3080},{"class":445,"line":914},[3081,3086,3090,3094,3098,3102],{"type":405,"tag":443,"props":3082,"children":3083},{"style":803},[3084],{"type":411,"value":3085},"      this",{"type":405,"tag":443,"props":3087,"children":3088},{"style":466},[3089],{"type":411,"value":469},{"type":405,"tag":443,"props":3091,"children":3092},{"style":472},[3093],{"type":411,"value":1970},{"type":405,"tag":443,"props":3095,"children":3096},{"style":509},[3097],{"type":411,"value":480},{"type":405,"tag":443,"props":3099,"children":3100},{"style":460},[3101],{"type":411,"value":860},{"type":405,"tag":443,"props":3103,"children":3104},{"style":509},[3105],{"type":411,"value":532},{"type":405,"tag":443,"props":3107,"children":3108},{"class":445,"line":923},[3109],{"type":405,"tag":443,"props":3110,"children":3111},{"style":466},[3112],{"type":411,"value":1696},{"type":405,"tag":443,"props":3114,"children":3115},{"class":445,"line":958},[3116],{"type":405,"tag":443,"props":3117,"children":3118},{"style":466},[3119],{"type":411,"value":833},{"type":405,"tag":443,"props":3121,"children":3122},{"class":445,"line":1022},[3123,3127,3131,3135,3139,3143,3147],{"type":405,"tag":443,"props":3124,"children":3125},{"style":847},[3126],{"type":411,"value":929},{"type":405,"tag":443,"props":3128,"children":3129},{"style":466},[3130],{"type":411,"value":855},{"type":405,"tag":443,"props":3132,"children":3133},{"style":582},[3134],{"type":411,"value":938},{"type":405,"tag":443,"props":3136,"children":3137},{"style":466},[3138],{"type":411,"value":501},{"type":405,"tag":443,"props":3140,"children":3141},{"style":582},[3142],{"type":411,"value":947},{"type":405,"tag":443,"props":3144,"children":3145},{"style":466},[3146],{"type":411,"value":865},{"type":405,"tag":443,"props":3148,"children":3149},{"style":466},[3150],{"type":411,"value":2236},{"type":405,"tag":443,"props":3152,"children":3153},{"class":445,"line":1030},[3154],{"type":405,"tag":443,"props":3155,"children":3156},{"style":466},[3157],{"type":411,"value":1036},{"type":405,"tag":443,"props":3159,"children":3160},{"class":445,"line":1258},[3161],{"type":405,"tag":443,"props":3162,"children":3163},{"emptyLinePlaceholder":397},[3164],{"type":411,"value":3165},"\n",{"type":405,"tag":443,"props":3167,"children":3168},{"class":445,"line":1283},[3169,3173,3177,3181],{"type":405,"tag":443,"props":3170,"children":3171},{"style":588},[3172],{"type":411,"value":2871},{"type":405,"tag":443,"props":3174,"children":3175},{"style":460},[3176],{"type":411,"value":2377},{"type":405,"tag":443,"props":3178,"children":3179},{"style":696},[3180],{"type":411,"value":699},{"type":405,"tag":443,"props":3182,"children":3183},{"style":2162},[3184],{"type":411,"value":2386},{"type":405,"tag":443,"props":3186,"children":3187},{"class":445,"line":1301},[3188,3192,3196],{"type":405,"tag":443,"props":3189,"children":3190},{"style":588},[3191],{"type":411,"value":770},{"type":405,"tag":443,"props":3193,"children":3194},{"style":773},[3195],{"type":411,"value":2102},{"type":405,"tag":443,"props":3197,"children":3198},{"style":466},[3199],{"type":411,"value":596},{"type":405,"tag":443,"props":3201,"children":3202},{"class":445,"line":1309},[3203,3207,3211,3215,3219,3223,3227,3231,3235,3239,3243,3247,3251],{"type":405,"tag":443,"props":3204,"children":3205},{"style":847},[3206],{"type":411,"value":2184},{"type":405,"tag":443,"props":3208,"children":3209},{"style":466},[3210],{"type":411,"value":855},{"type":405,"tag":443,"props":3212,"children":3213},{"style":582},[3214],{"type":411,"value":2193},{"type":405,"tag":443,"props":3216,"children":3217},{"style":466},[3218],{"type":411,"value":501},{"type":405,"tag":443,"props":3220,"children":3221},{"style":582},[3222],{"type":411,"value":2202},{"type":405,"tag":443,"props":3224,"children":3225},{"style":466},[3226],{"type":411,"value":501},{"type":405,"tag":443,"props":3228,"children":3229},{"style":582},[3230],{"type":411,"value":2211},{"type":405,"tag":443,"props":3232,"children":3233},{"style":696},[3234],{"type":411,"value":820},{"type":405,"tag":443,"props":3236,"children":3237},{"style":803},[3238],{"type":411,"value":1391},{"type":405,"tag":443,"props":3240,"children":3241},{"style":466},[3242],{"type":411,"value":469},{"type":405,"tag":443,"props":3244,"children":3245},{"style":460},[3246],{"type":411,"value":2137},{"type":405,"tag":443,"props":3248,"children":3249},{"style":466},[3250],{"type":411,"value":865},{"type":405,"tag":443,"props":3252,"children":3253},{"style":466},[3254],{"type":411,"value":596},{"type":405,"tag":443,"props":3256,"children":3257},{"class":445,"line":1318},[3258,3263,3267],{"type":405,"tag":443,"props":3259,"children":3260},{"style":460},[3261],{"type":411,"value":3262},"    handleFn",{"type":405,"tag":443,"props":3264,"children":3265},{"style":696},[3266],{"type":411,"value":820},{"type":405,"tag":443,"props":3268,"children":3269},{"style":460},[3270],{"type":411,"value":3271}," fn\n",{"type":405,"tag":443,"props":3273,"children":3274},{"class":445,"line":2796},[3275,3280,3284,3288,3292,3296,3300,3304],{"type":405,"tag":443,"props":3276,"children":3277},{"style":460},[3278],{"type":411,"value":3279},"    console",{"type":405,"tag":443,"props":3281,"children":3282},{"style":466},[3283],{"type":411,"value":469},{"type":405,"tag":443,"props":3285,"children":3286},{"style":472},[3287],{"type":411,"value":614},{"type":405,"tag":443,"props":3289,"children":3290},{"style":509},[3291],{"type":411,"value":480},{"type":405,"tag":443,"props":3293,"children":3294},{"style":460},[3295],{"type":411,"value":1462},{"type":405,"tag":443,"props":3297,"children":3298},{"style":466},[3299],{"type":411,"value":469},{"type":405,"tag":443,"props":3301,"children":3302},{"style":460},[3303],{"type":411,"value":2193},{"type":405,"tag":443,"props":3305,"children":3306},{"style":509},[3307],{"type":411,"value":532},{"type":405,"tag":443,"props":3309,"children":3310},{"class":445,"line":2809},[3311],{"type":405,"tag":443,"props":3312,"children":3313},{"style":466},[3314],{"type":411,"value":833},{"type":405,"tag":443,"props":3316,"children":3317},{"class":445,"line":2817},[3318,3322,3326,3330,3334,3338,3342,3346,3350,3354,3358,3362,3366,3370,3374,3378],{"type":405,"tag":443,"props":3319,"children":3320},{"style":847},[3321],{"type":411,"value":1264},{"type":405,"tag":443,"props":3323,"children":3324},{"style":466},[3325],{"type":411,"value":855},{"type":405,"tag":443,"props":3327,"children":3328},{"style":582},[3329],{"type":411,"value":2193},{"type":405,"tag":443,"props":3331,"children":3332},{"style":466},[3333],{"type":411,"value":501},{"type":405,"tag":443,"props":3335,"children":3336},{"style":582},[3337],{"type":411,"value":512},{"type":405,"tag":443,"props":3339,"children":3340},{"style":466},[3341],{"type":411,"value":501},{"type":405,"tag":443,"props":3343,"children":3344},{"style":582},[3345],{"type":411,"value":2268},{"type":405,"tag":443,"props":3347,"children":3348},{"style":696},[3349],{"type":411,"value":820},{"type":405,"tag":443,"props":3351,"children":3352},{"style":466},[3353],{"type":411,"value":1377},{"type":405,"tag":443,"props":3355,"children":3356},{"style":582},[3357],{"type":411,"value":2211},{"type":405,"tag":443,"props":3359,"children":3360},{"style":696},[3361],{"type":411,"value":820},{"type":405,"tag":443,"props":3363,"children":3364},{"style":803},[3365],{"type":411,"value":1391},{"type":405,"tag":443,"props":3367,"children":3368},{"style":466},[3369],{"type":411,"value":469},{"type":405,"tag":443,"props":3371,"children":3372},{"style":460},[3373],{"type":411,"value":2137},{"type":405,"tag":443,"props":3375,"children":3376},{"style":466},[3377],{"type":411,"value":865},{"type":405,"tag":443,"props":3379,"children":3380},{"style":466},[3381],{"type":411,"value":596},{"type":405,"tag":443,"props":3383,"children":3385},{"class":445,"line":3384},21,[3386,3391,3395,3399,3403,3407],{"type":405,"tag":443,"props":3387,"children":3388},{"style":588},[3389],{"type":411,"value":3390},"    const",{"type":405,"tag":443,"props":3392,"children":3393},{"style":1416},[3394],{"type":411,"value":1419},{"type":405,"tag":443,"props":3396,"children":3397},{"style":696},[3398],{"type":411,"value":820},{"type":405,"tag":443,"props":3400,"children":3401},{"style":696},[3402],{"type":411,"value":1428},{"type":405,"tag":443,"props":3404,"children":3405},{"style":472},[3406],{"type":411,"value":776},{"type":405,"tag":443,"props":3408,"children":3409},{"style":509},[3410],{"type":411,"value":1437},{"type":405,"tag":443,"props":3412,"children":3414},{"class":445,"line":3413},22,[3415,3420,3424,3428,3432,3436,3440,3444,3448],{"type":405,"tag":443,"props":3416,"children":3417},{"style":460},[3418],{"type":411,"value":3419},"    Object",{"type":405,"tag":443,"props":3421,"children":3422},{"style":466},[3423],{"type":411,"value":469},{"type":405,"tag":443,"props":3425,"children":3426},{"style":472},[3427],{"type":411,"value":1061},{"type":405,"tag":443,"props":3429,"children":3430},{"style":509},[3431],{"type":411,"value":480},{"type":405,"tag":443,"props":3433,"children":3434},{"style":460},[3435],{"type":411,"value":1462},{"type":405,"tag":443,"props":3437,"children":3438},{"style":466},[3439],{"type":411,"value":501},{"type":405,"tag":443,"props":3441,"children":3442},{"style":460},[3443],{"type":411,"value":1126},{"type":405,"tag":443,"props":3445,"children":3446},{"style":466},[3447],{"type":411,"value":501},{"type":405,"tag":443,"props":3449,"children":3450},{"style":466},[3451],{"type":411,"value":596},{"type":405,"tag":443,"props":3453,"children":3455},{"class":445,"line":3454},23,[3456,3461,3465,3469],{"type":405,"tag":443,"props":3457,"children":3458},{"style":509},[3459],{"type":411,"value":3460},"      enumerable",{"type":405,"tag":443,"props":3462,"children":3463},{"style":466},[3464],{"type":411,"value":517},{"type":405,"tag":443,"props":3466,"children":3467},{"style":1157},[3468],{"type":411,"value":1160},{"type":405,"tag":443,"props":3470,"children":3471},{"style":466},[3472],{"type":411,"value":1165},{"type":405,"tag":443,"props":3474,"children":3476},{"class":445,"line":3475},24,[3477,3482,3486,3490],{"type":405,"tag":443,"props":3478,"children":3479},{"style":509},[3480],{"type":411,"value":3481},"      configurable",{"type":405,"tag":443,"props":3483,"children":3484},{"style":466},[3485],{"type":411,"value":517},{"type":405,"tag":443,"props":3487,"children":3488},{"style":1157},[3489],{"type":411,"value":1160},{"type":405,"tag":443,"props":3491,"children":3492},{"style":466},[3493],{"type":411,"value":1165},{"type":405,"tag":443,"props":3495,"children":3497},{"class":445,"line":3496},25,[3498,3503,3507,3511,3515],{"type":405,"tag":443,"props":3499,"children":3500},{"style":472},[3501],{"type":411,"value":3502},"      get",{"type":405,"tag":443,"props":3504,"children":3505},{"style":466},[3506],{"type":411,"value":517},{"type":405,"tag":443,"props":3508,"children":3509},{"style":466},[3510],{"type":411,"value":793},{"type":405,"tag":443,"props":3512,"children":3513},{"style":588},[3514],{"type":411,"value":591},{"type":405,"tag":443,"props":3516,"children":3517},{"style":466},[3518],{"type":411,"value":596},{"type":405,"tag":443,"props":3520,"children":3522},{"class":445,"line":3521},26,[3523,3528,3532],{"type":405,"tag":443,"props":3524,"children":3525},{"style":460},[3526],{"type":411,"value":3527},"        handleDep",{"type":405,"tag":443,"props":3529,"children":3530},{"style":696},[3531],{"type":411,"value":820},{"type":405,"tag":443,"props":3533,"children":3534},{"style":460},[3535],{"type":411,"value":1880},{"type":405,"tag":443,"props":3537,"children":3539},{"class":445,"line":3538},27,[3540,3544,3548,3552],{"type":405,"tag":443,"props":3541,"children":3542},{"style":460},[3543],{"type":411,"value":3527},{"type":405,"tag":443,"props":3545,"children":3546},{"style":466},[3547],{"type":411,"value":469},{"type":405,"tag":443,"props":3549,"children":3550},{"style":472},[3551],{"type":411,"value":2846},{"type":405,"tag":443,"props":3553,"children":3554},{"style":509},[3555],{"type":411,"value":1437},{"type":405,"tag":443,"props":3557,"children":3559},{"class":445,"line":3558},28,[3560,3565],{"type":405,"tag":443,"props":3561,"children":3562},{"style":1231},[3563],{"type":411,"value":3564},"        return",{"type":405,"tag":443,"props":3566,"children":3567},{"style":460},[3568],{"type":411,"value":1239},{"type":405,"tag":443,"props":3570,"children":3572},{"class":445,"line":3571},29,[3573],{"type":405,"tag":443,"props":3574,"children":3575},{"style":466},[3576],{"type":411,"value":3577},"      },\n",{"type":405,"tag":443,"props":3579,"children":3581},{"class":445,"line":3580},30,[3582,3587,3591,3595,3599],{"type":405,"tag":443,"props":3583,"children":3584},{"style":472},[3585],{"type":411,"value":3586},"      set",{"type":405,"tag":443,"props":3588,"children":3589},{"style":466},[3590],{"type":411,"value":517},{"type":405,"tag":443,"props":3592,"children":3593},{"style":582},[3594],{"type":411,"value":585},{"type":405,"tag":443,"props":3596,"children":3597},{"style":588},[3598],{"type":411,"value":591},{"type":405,"tag":443,"props":3600,"children":3601},{"style":466},[3602],{"type":411,"value":2236},{"type":405,"tag":443,"props":3604,"children":3606},{"class":445,"line":3605},31,[3607,3612],{"type":405,"tag":443,"props":3608,"children":3609},{"style":466},[3610],{"type":411,"value":3611},"    }",{"type":405,"tag":443,"props":3613,"children":3614},{"style":509},[3615],{"type":411,"value":532},{"type":405,"tag":443,"props":3617,"children":3619},{"class":445,"line":3618},32,[3620],{"type":405,"tag":443,"props":3621,"children":3622},{"style":466},[3623],{"type":411,"value":833},{"type":405,"tag":443,"props":3625,"children":3627},{"class":445,"line":3626},33,[3628],{"type":405,"tag":443,"props":3629,"children":3630},{"style":466},[3631],{"type":411,"value":1036},{"type":405,"tag":406,"props":3633,"children":3635},{"id":3634},"处理-key-值为对象链的情况",[3636],{"type":411,"value":3637},"处理 key 值为对象链的情况",{"type":405,"tag":413,"props":3639,"children":3640},{},[3641,3643,3649],{"type":411,"value":3642},"在先前的 watch 函数中, 我们使用 console.log(obj.key)去触发对应属性的 getter, 如果我们调用方式是",{"type":405,"tag":419,"props":3644,"children":3646},{"className":3645},[],[3647],{"type":411,"value":3648},"watch('a.b.c')",{"type":411,"value":3650},"就无能为力了. 这里我们封装一个通用方法, 用于处理对象链字符串的形式:",{"type":405,"tag":433,"props":3652,"children":3654},{"className":435,"code":3653,"language":437,"meta":398,"style":398},"// 通过将字符串'a.b'分割为['a', 'b'], 再使用一个while循环就可以走完这个对象链\nfunction walkChains (key, obj) {\n  const segments = key.split('.')\n  let deepObj = obj\n  while (segments.length) {\n    deepObj = deepObj[segments.shift()]\n  }\n}\nclass VX {\n  watch (key, fn, obj = this.store) {\n    handleFn = fn\n    walkChains(key, obj)\n  }\n}\n",[3655],{"type":405,"tag":419,"props":3656,"children":3657},{"__ignoreMap":398},[3658,3666,3703,3752,3773,3807,3846,3853,3860,3875,3930,3945,3973,3980],{"type":405,"tag":443,"props":3659,"children":3660},{"class":445,"line":446},[3661],{"type":405,"tag":443,"props":3662,"children":3663},{"style":450},[3664],{"type":411,"value":3665},"// 通过将字符串'a.b'分割为['a', 'b'], 再使用一个while循环就可以走完这个对象链\n",{"type":405,"tag":443,"props":3667,"children":3668},{"class":445,"line":456},[3669,3674,3679,3683,3687,3691,3695,3699],{"type":405,"tag":443,"props":3670,"children":3671},{"style":588},[3672],{"type":411,"value":3673},"function",{"type":405,"tag":443,"props":3675,"children":3676},{"style":472},[3677],{"type":411,"value":3678}," walkChains",{"type":405,"tag":443,"props":3680,"children":3681},{"style":466},[3682],{"type":411,"value":855},{"type":405,"tag":443,"props":3684,"children":3685},{"style":582},[3686],{"type":411,"value":2193},{"type":405,"tag":443,"props":3688,"children":3689},{"style":466},[3690],{"type":411,"value":501},{"type":405,"tag":443,"props":3692,"children":3693},{"style":582},[3694],{"type":411,"value":2211},{"type":405,"tag":443,"props":3696,"children":3697},{"style":466},[3698],{"type":411,"value":865},{"type":405,"tag":443,"props":3700,"children":3701},{"style":466},[3702],{"type":411,"value":596},{"type":405,"tag":443,"props":3704,"children":3705},{"class":445,"line":535},[3706,3710,3715,3719,3723,3727,3732,3736,3740,3744,3748],{"type":405,"tag":443,"props":3707,"children":3708},{"style":588},[3709],{"type":411,"value":1413},{"type":405,"tag":443,"props":3711,"children":3712},{"style":1416},[3713],{"type":411,"value":3714}," segments",{"type":405,"tag":443,"props":3716,"children":3717},{"style":696},[3718],{"type":411,"value":820},{"type":405,"tag":443,"props":3720,"children":3721},{"style":460},[3722],{"type":411,"value":1126},{"type":405,"tag":443,"props":3724,"children":3725},{"style":466},[3726],{"type":411,"value":469},{"type":405,"tag":443,"props":3728,"children":3729},{"style":472},[3730],{"type":411,"value":3731},"split",{"type":405,"tag":443,"props":3733,"children":3734},{"style":509},[3735],{"type":411,"value":480},{"type":405,"tag":443,"props":3737,"children":3738},{"style":483},[3739],{"type":411,"value":486},{"type":405,"tag":443,"props":3741,"children":3742},{"style":489},[3743],{"type":411,"value":469},{"type":405,"tag":443,"props":3745,"children":3746},{"style":483},[3747],{"type":411,"value":486},{"type":405,"tag":443,"props":3749,"children":3750},{"style":509},[3751],{"type":411,"value":532},{"type":405,"tag":443,"props":3753,"children":3754},{"class":445,"line":544},[3755,3759,3764,3768],{"type":405,"tag":443,"props":3756,"children":3757},{"style":588},[3758],{"type":411,"value":2372},{"type":405,"tag":443,"props":3760,"children":3761},{"style":460},[3762],{"type":411,"value":3763}," deepObj",{"type":405,"tag":443,"props":3765,"children":3766},{"style":696},[3767],{"type":411,"value":820},{"type":405,"tag":443,"props":3769,"children":3770},{"style":460},[3771],{"type":411,"value":3772}," obj\n",{"type":405,"tag":443,"props":3774,"children":3775},{"class":445,"line":599},[3776,3781,3785,3790,3794,3799,3803],{"type":405,"tag":443,"props":3777,"children":3778},{"style":1231},[3779],{"type":411,"value":3780},"  while",{"type":405,"tag":443,"props":3782,"children":3783},{"style":509},[3784],{"type":411,"value":855},{"type":405,"tag":443,"props":3786,"children":3787},{"style":460},[3788],{"type":411,"value":3789},"segments",{"type":405,"tag":443,"props":3791,"children":3792},{"style":466},[3793],{"type":411,"value":469},{"type":405,"tag":443,"props":3795,"children":3796},{"style":1416},[3797],{"type":411,"value":3798},"length",{"type":405,"tag":443,"props":3800,"children":3801},{"style":509},[3802],{"type":411,"value":1616},{"type":405,"tag":443,"props":3804,"children":3805},{"style":466},[3806],{"type":411,"value":1405},{"type":405,"tag":443,"props":3808,"children":3809},{"class":445,"line":647},[3810,3815,3819,3823,3828,3832,3836,3841],{"type":405,"tag":443,"props":3811,"children":3812},{"style":460},[3813],{"type":411,"value":3814},"    deepObj",{"type":405,"tag":443,"props":3816,"children":3817},{"style":696},[3818],{"type":411,"value":820},{"type":405,"tag":443,"props":3820,"children":3821},{"style":460},[3822],{"type":411,"value":3763},{"type":405,"tag":443,"props":3824,"children":3825},{"style":509},[3826],{"type":411,"value":3827},"[",{"type":405,"tag":443,"props":3829,"children":3830},{"style":460},[3831],{"type":411,"value":3789},{"type":405,"tag":443,"props":3833,"children":3834},{"style":466},[3835],{"type":411,"value":469},{"type":405,"tag":443,"props":3837,"children":3838},{"style":472},[3839],{"type":411,"value":3840},"shift",{"type":405,"tag":443,"props":3842,"children":3843},{"style":509},[3844],{"type":411,"value":3845},"()]\n",{"type":405,"tag":443,"props":3847,"children":3848},{"class":445,"line":660},[3849],{"type":405,"tag":443,"props":3850,"children":3851},{"style":466},[3852],{"type":411,"value":833},{"type":405,"tag":443,"props":3854,"children":3855},{"class":445,"line":914},[3856],{"type":405,"tag":443,"props":3857,"children":3858},{"style":466},[3859],{"type":411,"value":1036},{"type":405,"tag":443,"props":3861,"children":3862},{"class":445,"line":923},[3863,3867,3871],{"type":405,"tag":443,"props":3864,"children":3865},{"style":588},[3866],{"type":411,"value":770},{"type":405,"tag":443,"props":3868,"children":3869},{"style":773},[3870],{"type":411,"value":2102},{"type":405,"tag":443,"props":3872,"children":3873},{"style":466},[3874],{"type":411,"value":596},{"type":405,"tag":443,"props":3876,"children":3877},{"class":445,"line":958},[3878,3882,3886,3890,3894,3898,3902,3906,3910,3914,3918,3922,3926],{"type":405,"tag":443,"props":3879,"children":3880},{"style":847},[3881],{"type":411,"value":2184},{"type":405,"tag":443,"props":3883,"children":3884},{"style":466},[3885],{"type":411,"value":855},{"type":405,"tag":443,"props":3887,"children":3888},{"style":582},[3889],{"type":411,"value":2193},{"type":405,"tag":443,"props":3891,"children":3892},{"style":466},[3893],{"type":411,"value":501},{"type":405,"tag":443,"props":3895,"children":3896},{"style":582},[3897],{"type":411,"value":2202},{"type":405,"tag":443,"props":3899,"children":3900},{"style":466},[3901],{"type":411,"value":501},{"type":405,"tag":443,"props":3903,"children":3904},{"style":582},[3905],{"type":411,"value":2211},{"type":405,"tag":443,"props":3907,"children":3908},{"style":696},[3909],{"type":411,"value":820},{"type":405,"tag":443,"props":3911,"children":3912},{"style":803},[3913],{"type":411,"value":1391},{"type":405,"tag":443,"props":3915,"children":3916},{"style":466},[3917],{"type":411,"value":469},{"type":405,"tag":443,"props":3919,"children":3920},{"style":460},[3921],{"type":411,"value":2137},{"type":405,"tag":443,"props":3923,"children":3924},{"style":466},[3925],{"type":411,"value":865},{"type":405,"tag":443,"props":3927,"children":3928},{"style":466},[3929],{"type":411,"value":596},{"type":405,"tag":443,"props":3931,"children":3932},{"class":445,"line":1022},[3933,3937,3941],{"type":405,"tag":443,"props":3934,"children":3935},{"style":460},[3936],{"type":411,"value":3262},{"type":405,"tag":443,"props":3938,"children":3939},{"style":696},[3940],{"type":411,"value":820},{"type":405,"tag":443,"props":3942,"children":3943},{"style":460},[3944],{"type":411,"value":3271},{"type":405,"tag":443,"props":3946,"children":3947},{"class":445,"line":1030},[3948,3953,3957,3961,3965,3969],{"type":405,"tag":443,"props":3949,"children":3950},{"style":472},[3951],{"type":411,"value":3952},"    walkChains",{"type":405,"tag":443,"props":3954,"children":3955},{"style":509},[3956],{"type":411,"value":480},{"type":405,"tag":443,"props":3958,"children":3959},{"style":460},[3960],{"type":411,"value":2193},{"type":405,"tag":443,"props":3962,"children":3963},{"style":466},[3964],{"type":411,"value":501},{"type":405,"tag":443,"props":3966,"children":3967},{"style":460},[3968],{"type":411,"value":2211},{"type":405,"tag":443,"props":3970,"children":3971},{"style":509},[3972],{"type":411,"value":532},{"type":405,"tag":443,"props":3974,"children":3975},{"class":445,"line":1258},[3976],{"type":405,"tag":443,"props":3977,"children":3978},{"style":466},[3979],{"type":411,"value":833},{"type":405,"tag":443,"props":3981,"children":3982},{"class":445,"line":1283},[3983],{"type":405,"tag":443,"props":3984,"children":3985},{"style":466},[3986],{"type":411,"value":1036},{"type":405,"tag":413,"props":3988,"children":3989},{},[3990,3992,3998],{"type":411,"value":3991},"在 set 方法中处理对象链字符串稍微有些不同, 因为如果",{"type":405,"tag":419,"props":3993,"children":3995},{"className":3994},[],[3996],{"type":411,"value":3997},"set('a.b')",{"type":411,"value":3999},"时, 没有在我们全局对象中找到 a 属性, 这里应该抛错.",{"type":405,"tag":413,"props":4001,"children":4002},{},[4003,4005,4011],{"type":411,"value":4004},"实际的处理中, 需要推断'obj.a'以及'obj.a.b'是否存在. 假设没有'obj.a', 那么我们应该创建一个新的对象, 并且给新的对象添加属性'b', 所以代码类似",{"type":405,"tag":419,"props":4006,"children":4008},{"className":4007},[],[4009],{"type":411,"value":4010},"walkChains",{"type":411,"value":4012},"函数, 只是稍作一层判断:",{"type":405,"tag":433,"props":4014,"children":4016},{"className":435,"code":4015,"language":437,"meta":398,"style":398},"set (key, val, obj) {\n  const segments = key.split('.')\n  // 这里需要注意, 我们只处理到倒数第二个属性\n  while (segments.length > 1) {\n    const handleKey = segments.shift()\n    const handleVal = obj[handleKey]\n    // 存在'obj.a'的情况\n    if (typeof handleVal === 'object') {\n      obj = handleVal\n    // 不存在'obj.a'则给a属性赋一个非响应式的对象\n    } else if (!handleVal) {\n      obj = (\n        key = handleKey,\n        obj[handleKey] = {},\n        obj[handleKey]\n      )\n    } else {\n      console.trace('already has val')\n    }\n  }\n  // 最后一个属性要手动赋值\n  key = segments[0]\n}\n",[4017],{"type":405,"tag":419,"props":4018,"children":4019},{"__ignoreMap":398},[4020,4052,4099,4107,4148,4180,4214,4222,4268,4285,4293,4332,4348,4368,4398,4417,4425,4440,4477,4484,4491,4499,4528],{"type":405,"tag":443,"props":4021,"children":4022},{"class":445,"line":446},[4023,4027,4031,4035,4039,4043,4048],{"type":405,"tag":443,"props":4024,"children":4025},{"style":472},[4026],{"type":411,"value":475},{"type":405,"tag":443,"props":4028,"children":4029},{"style":460},[4030],{"type":411,"value":1351},{"type":405,"tag":443,"props":4032,"children":4033},{"style":466},[4034],{"type":411,"value":501},{"type":405,"tag":443,"props":4036,"children":4037},{"style":460},[4038],{"type":411,"value":512},{"type":405,"tag":443,"props":4040,"children":4041},{"style":466},[4042],{"type":411,"value":501},{"type":405,"tag":443,"props":4044,"children":4045},{"style":460},[4046],{"type":411,"value":4047}," obj) ",{"type":405,"tag":443,"props":4049,"children":4050},{"style":466},[4051],{"type":411,"value":1405},{"type":405,"tag":443,"props":4053,"children":4054},{"class":445,"line":456},[4055,4059,4063,4067,4071,4075,4079,4083,4087,4091,4095],{"type":405,"tag":443,"props":4056,"children":4057},{"style":588},[4058],{"type":411,"value":1413},{"type":405,"tag":443,"props":4060,"children":4061},{"style":1416},[4062],{"type":411,"value":3714},{"type":405,"tag":443,"props":4064,"children":4065},{"style":696},[4066],{"type":411,"value":820},{"type":405,"tag":443,"props":4068,"children":4069},{"style":460},[4070],{"type":411,"value":1126},{"type":405,"tag":443,"props":4072,"children":4073},{"style":466},[4074],{"type":411,"value":469},{"type":405,"tag":443,"props":4076,"children":4077},{"style":472},[4078],{"type":411,"value":3731},{"type":405,"tag":443,"props":4080,"children":4081},{"style":509},[4082],{"type":411,"value":480},{"type":405,"tag":443,"props":4084,"children":4085},{"style":483},[4086],{"type":411,"value":486},{"type":405,"tag":443,"props":4088,"children":4089},{"style":489},[4090],{"type":411,"value":469},{"type":405,"tag":443,"props":4092,"children":4093},{"style":483},[4094],{"type":411,"value":486},{"type":405,"tag":443,"props":4096,"children":4097},{"style":509},[4098],{"type":411,"value":532},{"type":405,"tag":443,"props":4100,"children":4101},{"class":445,"line":535},[4102],{"type":405,"tag":443,"props":4103,"children":4104},{"style":450},[4105],{"type":411,"value":4106},"  // 这里需要注意, 我们只处理到倒数第二个属性\n",{"type":405,"tag":443,"props":4108,"children":4109},{"class":445,"line":544},[4110,4114,4118,4122,4126,4130,4135,4140,4144],{"type":405,"tag":443,"props":4111,"children":4112},{"style":1231},[4113],{"type":411,"value":3780},{"type":405,"tag":443,"props":4115,"children":4116},{"style":509},[4117],{"type":411,"value":855},{"type":405,"tag":443,"props":4119,"children":4120},{"style":460},[4121],{"type":411,"value":3789},{"type":405,"tag":443,"props":4123,"children":4124},{"style":466},[4125],{"type":411,"value":469},{"type":405,"tag":443,"props":4127,"children":4128},{"style":1416},[4129],{"type":411,"value":3798},{"type":405,"tag":443,"props":4131,"children":4132},{"style":696},[4133],{"type":411,"value":4134}," >",{"type":405,"tag":443,"props":4136,"children":4137},{"style":702},[4138],{"type":411,"value":4139}," 1",{"type":405,"tag":443,"props":4141,"children":4142},{"style":509},[4143],{"type":411,"value":1616},{"type":405,"tag":443,"props":4145,"children":4146},{"style":466},[4147],{"type":411,"value":1405},{"type":405,"tag":443,"props":4149,"children":4150},{"class":445,"line":599},[4151,4155,4160,4164,4168,4172,4176],{"type":405,"tag":443,"props":4152,"children":4153},{"style":588},[4154],{"type":411,"value":3390},{"type":405,"tag":443,"props":4156,"children":4157},{"style":1416},[4158],{"type":411,"value":4159}," handleKey",{"type":405,"tag":443,"props":4161,"children":4162},{"style":696},[4163],{"type":411,"value":820},{"type":405,"tag":443,"props":4165,"children":4166},{"style":460},[4167],{"type":411,"value":3714},{"type":405,"tag":443,"props":4169,"children":4170},{"style":466},[4171],{"type":411,"value":469},{"type":405,"tag":443,"props":4173,"children":4174},{"style":472},[4175],{"type":411,"value":3840},{"type":405,"tag":443,"props":4177,"children":4178},{"style":509},[4179],{"type":411,"value":1437},{"type":405,"tag":443,"props":4181,"children":4182},{"class":445,"line":647},[4183,4187,4192,4196,4200,4204,4209],{"type":405,"tag":443,"props":4184,"children":4185},{"style":588},[4186],{"type":411,"value":3390},{"type":405,"tag":443,"props":4188,"children":4189},{"style":1416},[4190],{"type":411,"value":4191}," handleVal",{"type":405,"tag":443,"props":4193,"children":4194},{"style":696},[4195],{"type":411,"value":820},{"type":405,"tag":443,"props":4197,"children":4198},{"style":460},[4199],{"type":411,"value":2211},{"type":405,"tag":443,"props":4201,"children":4202},{"style":509},[4203],{"type":411,"value":3827},{"type":405,"tag":443,"props":4205,"children":4206},{"style":460},[4207],{"type":411,"value":4208},"handleKey",{"type":405,"tag":443,"props":4210,"children":4211},{"style":509},[4212],{"type":411,"value":4213},"]\n",{"type":405,"tag":443,"props":4215,"children":4216},{"class":445,"line":660},[4217],{"type":405,"tag":443,"props":4218,"children":4219},{"style":450},[4220],{"type":411,"value":4221},"    // 存在'obj.a'的情况\n",{"type":405,"tag":443,"props":4223,"children":4224},{"class":445,"line":914},[4225,4229,4233,4238,4242,4246,4251,4256,4260,4264],{"type":405,"tag":443,"props":4226,"children":4227},{"style":1231},[4228],{"type":411,"value":3002},{"type":405,"tag":443,"props":4230,"children":4231},{"style":509},[4232],{"type":411,"value":855},{"type":405,"tag":443,"props":4234,"children":4235},{"style":696},[4236],{"type":411,"value":4237},"typeof",{"type":405,"tag":443,"props":4239,"children":4240},{"style":460},[4241],{"type":411,"value":4191},{"type":405,"tag":443,"props":4243,"children":4244},{"style":696},[4245],{"type":411,"value":1607},{"type":405,"tag":443,"props":4247,"children":4248},{"style":483},[4249],{"type":411,"value":4250}," '",{"type":405,"tag":443,"props":4252,"children":4253},{"style":489},[4254],{"type":411,"value":4255},"object",{"type":405,"tag":443,"props":4257,"children":4258},{"style":483},[4259],{"type":411,"value":486},{"type":405,"tag":443,"props":4261,"children":4262},{"style":509},[4263],{"type":411,"value":1616},{"type":405,"tag":443,"props":4265,"children":4266},{"style":466},[4267],{"type":411,"value":1405},{"type":405,"tag":443,"props":4269,"children":4270},{"class":445,"line":923},[4271,4276,4280],{"type":405,"tag":443,"props":4272,"children":4273},{"style":460},[4274],{"type":411,"value":4275},"      obj",{"type":405,"tag":443,"props":4277,"children":4278},{"style":696},[4279],{"type":411,"value":820},{"type":405,"tag":443,"props":4281,"children":4282},{"style":460},[4283],{"type":411,"value":4284}," handleVal\n",{"type":405,"tag":443,"props":4286,"children":4287},{"class":445,"line":958},[4288],{"type":405,"tag":443,"props":4289,"children":4290},{"style":450},[4291],{"type":411,"value":4292},"    // 不存在'obj.a'则给a属性赋一个非响应式的对象\n",{"type":405,"tag":443,"props":4294,"children":4295},{"class":445,"line":1022},[4296,4300,4305,4310,4314,4319,4324,4328],{"type":405,"tag":443,"props":4297,"children":4298},{"style":466},[4299],{"type":411,"value":3611},{"type":405,"tag":443,"props":4301,"children":4302},{"style":1231},[4303],{"type":411,"value":4304}," else",{"type":405,"tag":443,"props":4306,"children":4307},{"style":1231},[4308],{"type":411,"value":4309}," if",{"type":405,"tag":443,"props":4311,"children":4312},{"style":509},[4313],{"type":411,"value":855},{"type":405,"tag":443,"props":4315,"children":4316},{"style":696},[4317],{"type":411,"value":4318},"!",{"type":405,"tag":443,"props":4320,"children":4321},{"style":460},[4322],{"type":411,"value":4323},"handleVal",{"type":405,"tag":443,"props":4325,"children":4326},{"style":509},[4327],{"type":411,"value":1616},{"type":405,"tag":443,"props":4329,"children":4330},{"style":466},[4331],{"type":411,"value":1405},{"type":405,"tag":443,"props":4333,"children":4334},{"class":445,"line":1030},[4335,4339,4343],{"type":405,"tag":443,"props":4336,"children":4337},{"style":472},[4338],{"type":411,"value":4275},{"type":405,"tag":443,"props":4340,"children":4341},{"style":696},[4342],{"type":411,"value":820},{"type":405,"tag":443,"props":4344,"children":4345},{"style":509},[4346],{"type":411,"value":4347}," (\n",{"type":405,"tag":443,"props":4349,"children":4350},{"class":445,"line":1258},[4351,4356,4360,4364],{"type":405,"tag":443,"props":4352,"children":4353},{"style":460},[4354],{"type":411,"value":4355},"        key",{"type":405,"tag":443,"props":4357,"children":4358},{"style":696},[4359],{"type":411,"value":820},{"type":405,"tag":443,"props":4361,"children":4362},{"style":582},[4363],{"type":411,"value":4159},{"type":405,"tag":443,"props":4365,"children":4366},{"style":466},[4367],{"type":411,"value":1165},{"type":405,"tag":443,"props":4369,"children":4370},{"class":445,"line":1283},[4371,4376,4380,4384,4389,4393],{"type":405,"tag":443,"props":4372,"children":4373},{"style":460},[4374],{"type":411,"value":4375},"        obj",{"type":405,"tag":443,"props":4377,"children":4378},{"style":509},[4379],{"type":411,"value":3827},{"type":405,"tag":443,"props":4381,"children":4382},{"style":460},[4383],{"type":411,"value":4208},{"type":405,"tag":443,"props":4385,"children":4386},{"style":509},[4387],{"type":411,"value":4388},"] ",{"type":405,"tag":443,"props":4390,"children":4391},{"style":696},[4392],{"type":411,"value":699},{"type":405,"tag":443,"props":4394,"children":4395},{"style":466},[4396],{"type":411,"value":4397}," {},\n",{"type":405,"tag":443,"props":4399,"children":4400},{"class":445,"line":1301},[4401,4405,4409,4413],{"type":405,"tag":443,"props":4402,"children":4403},{"style":460},[4404],{"type":411,"value":4375},{"type":405,"tag":443,"props":4406,"children":4407},{"style":509},[4408],{"type":411,"value":3827},{"type":405,"tag":443,"props":4410,"children":4411},{"style":460},[4412],{"type":411,"value":4208},{"type":405,"tag":443,"props":4414,"children":4415},{"style":509},[4416],{"type":411,"value":4213},{"type":405,"tag":443,"props":4418,"children":4419},{"class":445,"line":1309},[4420],{"type":405,"tag":443,"props":4421,"children":4422},{"style":509},[4423],{"type":411,"value":4424},"      )\n",{"type":405,"tag":443,"props":4426,"children":4427},{"class":445,"line":1318},[4428,4432,4436],{"type":405,"tag":443,"props":4429,"children":4430},{"style":466},[4431],{"type":411,"value":3611},{"type":405,"tag":443,"props":4433,"children":4434},{"style":1231},[4435],{"type":411,"value":4304},{"type":405,"tag":443,"props":4437,"children":4438},{"style":466},[4439],{"type":411,"value":596},{"type":405,"tag":443,"props":4441,"children":4442},{"class":445,"line":2796},[4443,4447,4451,4456,4460,4464,4469,4473],{"type":405,"tag":443,"props":4444,"children":4445},{"style":460},[4446],{"type":411,"value":2466},{"type":405,"tag":443,"props":4448,"children":4449},{"style":466},[4450],{"type":411,"value":469},{"type":405,"tag":443,"props":4452,"children":4453},{"style":472},[4454],{"type":411,"value":4455},"trace",{"type":405,"tag":443,"props":4457,"children":4458},{"style":509},[4459],{"type":411,"value":480},{"type":405,"tag":443,"props":4461,"children":4462},{"style":483},[4463],{"type":411,"value":486},{"type":405,"tag":443,"props":4465,"children":4466},{"style":489},[4467],{"type":411,"value":4468},"already has val",{"type":405,"tag":443,"props":4470,"children":4471},{"style":483},[4472],{"type":411,"value":486},{"type":405,"tag":443,"props":4474,"children":4475},{"style":509},[4476],{"type":411,"value":532},{"type":405,"tag":443,"props":4478,"children":4479},{"class":445,"line":2809},[4480],{"type":405,"tag":443,"props":4481,"children":4482},{"style":466},[4483],{"type":411,"value":1696},{"type":405,"tag":443,"props":4485,"children":4486},{"class":445,"line":2817},[4487],{"type":405,"tag":443,"props":4488,"children":4489},{"style":466},[4490],{"type":411,"value":833},{"type":405,"tag":443,"props":4492,"children":4493},{"class":445,"line":3384},[4494],{"type":405,"tag":443,"props":4495,"children":4496},{"style":450},[4497],{"type":411,"value":4498},"  // 最后一个属性要手动赋值\n",{"type":405,"tag":443,"props":4500,"children":4501},{"class":445,"line":3413},[4502,4507,4511,4515,4519,4524],{"type":405,"tag":443,"props":4503,"children":4504},{"style":460},[4505],{"type":411,"value":4506},"  key",{"type":405,"tag":443,"props":4508,"children":4509},{"style":696},[4510],{"type":411,"value":820},{"type":405,"tag":443,"props":4512,"children":4513},{"style":460},[4514],{"type":411,"value":3714},{"type":405,"tag":443,"props":4516,"children":4517},{"style":509},[4518],{"type":411,"value":3827},{"type":405,"tag":443,"props":4520,"children":4521},{"style":702},[4522],{"type":411,"value":4523},"0",{"type":405,"tag":443,"props":4525,"children":4526},{"style":509},[4527],{"type":411,"value":4213},{"type":405,"tag":443,"props":4529,"children":4530},{"class":445,"line":3454},[4531],{"type":405,"tag":443,"props":4532,"children":4533},{"style":466},[4534],{"type":411,"value":1036},{"type":405,"tag":406,"props":4536,"children":4538},{"id":4537},"业务场景应用",[4539],{"type":411,"value":4537},{"type":405,"tag":1056,"props":4541,"children":4543},{"id":4542},"小程序跨页面刷新数据",[4544],{"type":411,"value":4542},{"type":405,"tag":413,"props":4546,"children":4547},{},[4548],{"type":411,"value":4549},"我们经常碰到在小程序中由 A 页面跳转到 B 页面, 如果 B 页面进行了一些操作, 希望 A 页面自动刷新数据的情况. 但是由于 A 页面跳转到 B 页面不同(也许是 redirect,也许是 navigate), 处理方法也不尽相同.",{"type":405,"tag":413,"props":4551,"children":4552},{},[4553],{"type":411,"value":4554},"使用 navigate 方式跳转后, A 页面不会被注销, 所以我们一般会通过全局对象去贮存 A 页面实例(也就是 A 页面的 this 对象), 然后在 B 页面直接调用相应的方法(如 A.refreshList())进行刷新操作.",{"type":405,"tag":413,"props":4556,"children":4557},{},[4558,4560,4566],{"type":411,"value":4559},"引入 VX 后, 我们可以在",{"type":405,"tag":419,"props":4561,"children":4563},{"className":4562},[],[4564],{"type":411,"value":4565},"onload",{"type":411,"value":4567},"生命周期直接调用 watch 方法添加订阅:",{"type":405,"tag":433,"props":4569,"children":4571},{"className":435,"code":4570,"language":437,"meta":398,"style":398},"// app.js\nimport VX from '@/utils/suites/vx'\nconst vx = new VX()\napp.vx = vx\napp.store = vx.store\napp.vx.set('userType', '商户')\n\n// page a\nonLoad () {\n  app.vx.watch('userType', userType => {\n    if (userType === '商户') {\n      // ...\n    } else if (userType === '管理员') {\n      // ...\n    }\n  }, {\n    immediate: true\n  })\n}\n\n// page b\nswitchUserType () {\n  app.store.userType = '管理员'\n}\n",[4572],{"type":405,"tag":419,"props":4573,"children":4574},{"__ignoreMap":398},[4575,4583,4615,4642,4668,4701,4762,4769,4777,4794,4851,4890,4898,4946,4953,4960,4972,4989,5000,5007,5014,5022,5038,5077],{"type":405,"tag":443,"props":4576,"children":4577},{"class":445,"line":446},[4578],{"type":405,"tag":443,"props":4579,"children":4580},{"style":450},[4581],{"type":411,"value":4582},"// app.js\n",{"type":405,"tag":443,"props":4584,"children":4585},{"class":445,"line":456},[4586,4591,4596,4601,4605,4610],{"type":405,"tag":443,"props":4587,"children":4588},{"style":1231},[4589],{"type":411,"value":4590},"import",{"type":405,"tag":443,"props":4592,"children":4593},{"style":460},[4594],{"type":411,"value":4595}," VX ",{"type":405,"tag":443,"props":4597,"children":4598},{"style":1231},[4599],{"type":411,"value":4600},"from",{"type":405,"tag":443,"props":4602,"children":4603},{"style":483},[4604],{"type":411,"value":4250},{"type":405,"tag":443,"props":4606,"children":4607},{"style":489},[4608],{"type":411,"value":4609},"@/utils/suites/vx",{"type":405,"tag":443,"props":4611,"children":4612},{"style":483},[4613],{"type":411,"value":4614},"'\n",{"type":405,"tag":443,"props":4616,"children":4617},{"class":445,"line":535},[4618,4622,4626,4630,4634,4638],{"type":405,"tag":443,"props":4619,"children":4620},{"style":588},[4621],{"type":411,"value":1902},{"type":405,"tag":443,"props":4623,"children":4624},{"style":1416},[4625],{"type":411,"value":2323},{"type":405,"tag":443,"props":4627,"children":4628},{"style":696},[4629],{"type":411,"value":820},{"type":405,"tag":443,"props":4631,"children":4632},{"style":696},[4633],{"type":411,"value":1428},{"type":405,"tag":443,"props":4635,"children":4636},{"style":472},[4637],{"type":411,"value":2102},{"type":405,"tag":443,"props":4639,"children":4640},{"style":460},[4641],{"type":411,"value":1437},{"type":405,"tag":443,"props":4643,"children":4644},{"class":445,"line":544},[4645,4650,4654,4659,4663],{"type":405,"tag":443,"props":4646,"children":4647},{"style":460},[4648],{"type":411,"value":4649},"app",{"type":405,"tag":443,"props":4651,"children":4652},{"style":466},[4653],{"type":411,"value":469},{"type":405,"tag":443,"props":4655,"children":4656},{"style":460},[4657],{"type":411,"value":4658},"vx ",{"type":405,"tag":443,"props":4660,"children":4661},{"style":696},[4662],{"type":411,"value":699},{"type":405,"tag":443,"props":4664,"children":4665},{"style":460},[4666],{"type":411,"value":4667}," vx\n",{"type":405,"tag":443,"props":4669,"children":4670},{"class":445,"line":599},[4671,4675,4679,4684,4688,4692,4696],{"type":405,"tag":443,"props":4672,"children":4673},{"style":460},[4674],{"type":411,"value":4649},{"type":405,"tag":443,"props":4676,"children":4677},{"style":466},[4678],{"type":411,"value":469},{"type":405,"tag":443,"props":4680,"children":4681},{"style":460},[4682],{"type":411,"value":4683},"store ",{"type":405,"tag":443,"props":4685,"children":4686},{"style":696},[4687],{"type":411,"value":699},{"type":405,"tag":443,"props":4689,"children":4690},{"style":460},[4691],{"type":411,"value":2323},{"type":405,"tag":443,"props":4693,"children":4694},{"style":466},[4695],{"type":411,"value":469},{"type":405,"tag":443,"props":4697,"children":4698},{"style":460},[4699],{"type":411,"value":4700},"store\n",{"type":405,"tag":443,"props":4702,"children":4703},{"class":445,"line":647},[4704,4708,4712,4716,4720,4724,4728,4732,4737,4741,4745,4749,4754,4758],{"type":405,"tag":443,"props":4705,"children":4706},{"style":460},[4707],{"type":411,"value":4649},{"type":405,"tag":443,"props":4709,"children":4710},{"style":466},[4711],{"type":411,"value":469},{"type":405,"tag":443,"props":4713,"children":4714},{"style":460},[4715],{"type":411,"value":463},{"type":405,"tag":443,"props":4717,"children":4718},{"style":466},[4719],{"type":411,"value":469},{"type":405,"tag":443,"props":4721,"children":4722},{"style":472},[4723],{"type":411,"value":475},{"type":405,"tag":443,"props":4725,"children":4726},{"style":460},[4727],{"type":411,"value":480},{"type":405,"tag":443,"props":4729,"children":4730},{"style":483},[4731],{"type":411,"value":486},{"type":405,"tag":443,"props":4733,"children":4734},{"style":489},[4735],{"type":411,"value":4736},"userType",{"type":405,"tag":443,"props":4738,"children":4739},{"style":483},[4740],{"type":411,"value":486},{"type":405,"tag":443,"props":4742,"children":4743},{"style":466},[4744],{"type":411,"value":501},{"type":405,"tag":443,"props":4746,"children":4747},{"style":483},[4748],{"type":411,"value":4250},{"type":405,"tag":443,"props":4750,"children":4751},{"style":489},[4752],{"type":411,"value":4753},"商户",{"type":405,"tag":443,"props":4755,"children":4756},{"style":483},[4757],{"type":411,"value":486},{"type":405,"tag":443,"props":4759,"children":4760},{"style":460},[4761],{"type":411,"value":532},{"type":405,"tag":443,"props":4763,"children":4764},{"class":445,"line":660},[4765],{"type":405,"tag":443,"props":4766,"children":4767},{"emptyLinePlaceholder":397},[4768],{"type":411,"value":3165},{"type":405,"tag":443,"props":4770,"children":4771},{"class":445,"line":914},[4772],{"type":405,"tag":443,"props":4773,"children":4774},{"style":450},[4775],{"type":411,"value":4776},"// page a\n",{"type":405,"tag":443,"props":4778,"children":4779},{"class":445,"line":923},[4780,4785,4790],{"type":405,"tag":443,"props":4781,"children":4782},{"style":472},[4783],{"type":411,"value":4784},"onLoad",{"type":405,"tag":443,"props":4786,"children":4787},{"style":460},[4788],{"type":411,"value":4789}," () ",{"type":405,"tag":443,"props":4791,"children":4792},{"style":466},[4793],{"type":411,"value":1405},{"type":405,"tag":443,"props":4795,"children":4796},{"class":445,"line":958},[4797,4802,4806,4810,4814,4818,4822,4826,4830,4834,4838,4843,4847],{"type":405,"tag":443,"props":4798,"children":4799},{"style":460},[4800],{"type":411,"value":4801},"  app",{"type":405,"tag":443,"props":4803,"children":4804},{"style":466},[4805],{"type":411,"value":469},{"type":405,"tag":443,"props":4807,"children":4808},{"style":460},[4809],{"type":411,"value":463},{"type":405,"tag":443,"props":4811,"children":4812},{"style":466},[4813],{"type":411,"value":469},{"type":405,"tag":443,"props":4815,"children":4816},{"style":472},[4817],{"type":411,"value":558},{"type":405,"tag":443,"props":4819,"children":4820},{"style":509},[4821],{"type":411,"value":480},{"type":405,"tag":443,"props":4823,"children":4824},{"style":483},[4825],{"type":411,"value":486},{"type":405,"tag":443,"props":4827,"children":4828},{"style":489},[4829],{"type":411,"value":4736},{"type":405,"tag":443,"props":4831,"children":4832},{"style":483},[4833],{"type":411,"value":486},{"type":405,"tag":443,"props":4835,"children":4836},{"style":466},[4837],{"type":411,"value":501},{"type":405,"tag":443,"props":4839,"children":4840},{"style":582},[4841],{"type":411,"value":4842}," userType",{"type":405,"tag":443,"props":4844,"children":4845},{"style":588},[4846],{"type":411,"value":591},{"type":405,"tag":443,"props":4848,"children":4849},{"style":466},[4850],{"type":411,"value":596},{"type":405,"tag":443,"props":4852,"children":4853},{"class":445,"line":1022},[4854,4858,4862,4866,4870,4874,4878,4882,4886],{"type":405,"tag":443,"props":4855,"children":4856},{"style":1231},[4857],{"type":411,"value":3002},{"type":405,"tag":443,"props":4859,"children":4860},{"style":509},[4861],{"type":411,"value":855},{"type":405,"tag":443,"props":4863,"children":4864},{"style":460},[4865],{"type":411,"value":4736},{"type":405,"tag":443,"props":4867,"children":4868},{"style":696},[4869],{"type":411,"value":1607},{"type":405,"tag":443,"props":4871,"children":4872},{"style":483},[4873],{"type":411,"value":4250},{"type":405,"tag":443,"props":4875,"children":4876},{"style":489},[4877],{"type":411,"value":4753},{"type":405,"tag":443,"props":4879,"children":4880},{"style":483},[4881],{"type":411,"value":486},{"type":405,"tag":443,"props":4883,"children":4884},{"style":509},[4885],{"type":411,"value":1616},{"type":405,"tag":443,"props":4887,"children":4888},{"style":466},[4889],{"type":411,"value":1405},{"type":405,"tag":443,"props":4891,"children":4892},{"class":445,"line":1030},[4893],{"type":405,"tag":443,"props":4894,"children":4895},{"style":450},[4896],{"type":411,"value":4897},"      // ...\n",{"type":405,"tag":443,"props":4899,"children":4900},{"class":445,"line":1258},[4901,4905,4909,4913,4917,4921,4925,4929,4934,4938,4942],{"type":405,"tag":443,"props":4902,"children":4903},{"style":466},[4904],{"type":411,"value":3611},{"type":405,"tag":443,"props":4906,"children":4907},{"style":1231},[4908],{"type":411,"value":4304},{"type":405,"tag":443,"props":4910,"children":4911},{"style":1231},[4912],{"type":411,"value":4309},{"type":405,"tag":443,"props":4914,"children":4915},{"style":509},[4916],{"type":411,"value":855},{"type":405,"tag":443,"props":4918,"children":4919},{"style":460},[4920],{"type":411,"value":4736},{"type":405,"tag":443,"props":4922,"children":4923},{"style":696},[4924],{"type":411,"value":1607},{"type":405,"tag":443,"props":4926,"children":4927},{"style":483},[4928],{"type":411,"value":4250},{"type":405,"tag":443,"props":4930,"children":4931},{"style":489},[4932],{"type":411,"value":4933},"管理员",{"type":405,"tag":443,"props":4935,"children":4936},{"style":483},[4937],{"type":411,"value":486},{"type":405,"tag":443,"props":4939,"children":4940},{"style":509},[4941],{"type":411,"value":1616},{"type":405,"tag":443,"props":4943,"children":4944},{"style":466},[4945],{"type":411,"value":1405},{"type":405,"tag":443,"props":4947,"children":4948},{"class":445,"line":1283},[4949],{"type":405,"tag":443,"props":4950,"children":4951},{"style":450},[4952],{"type":411,"value":4897},{"type":405,"tag":443,"props":4954,"children":4955},{"class":445,"line":1301},[4956],{"type":405,"tag":443,"props":4957,"children":4958},{"style":466},[4959],{"type":411,"value":1696},{"type":405,"tag":443,"props":4961,"children":4962},{"class":445,"line":1309},[4963,4968],{"type":405,"tag":443,"props":4964,"children":4965},{"style":466},[4966],{"type":411,"value":4967},"  },",{"type":405,"tag":443,"props":4969,"children":4970},{"style":466},[4971],{"type":411,"value":596},{"type":405,"tag":443,"props":4973,"children":4974},{"class":445,"line":1318},[4975,4980,4984],{"type":405,"tag":443,"props":4976,"children":4977},{"style":509},[4978],{"type":411,"value":4979},"    immediate",{"type":405,"tag":443,"props":4981,"children":4982},{"style":466},[4983],{"type":411,"value":517},{"type":405,"tag":443,"props":4985,"children":4986},{"style":1157},[4987],{"type":411,"value":4988}," true\n",{"type":405,"tag":443,"props":4990,"children":4991},{"class":445,"line":2796},[4992,4996],{"type":405,"tag":443,"props":4993,"children":4994},{"style":466},[4995],{"type":411,"value":1704},{"type":405,"tag":443,"props":4997,"children":4998},{"style":509},[4999],{"type":411,"value":532},{"type":405,"tag":443,"props":5001,"children":5002},{"class":445,"line":2809},[5003],{"type":405,"tag":443,"props":5004,"children":5005},{"style":466},[5006],{"type":411,"value":1036},{"type":405,"tag":443,"props":5008,"children":5009},{"class":445,"line":2817},[5010],{"type":405,"tag":443,"props":5011,"children":5012},{"emptyLinePlaceholder":397},[5013],{"type":411,"value":3165},{"type":405,"tag":443,"props":5015,"children":5016},{"class":445,"line":3384},[5017],{"type":405,"tag":443,"props":5018,"children":5019},{"style":450},[5020],{"type":411,"value":5021},"// page b\n",{"type":405,"tag":443,"props":5023,"children":5024},{"class":445,"line":3413},[5025,5030,5034],{"type":405,"tag":443,"props":5026,"children":5027},{"style":472},[5028],{"type":411,"value":5029},"switchUserType",{"type":405,"tag":443,"props":5031,"children":5032},{"style":460},[5033],{"type":411,"value":4789},{"type":405,"tag":443,"props":5035,"children":5036},{"style":466},[5037],{"type":411,"value":1405},{"type":405,"tag":443,"props":5039,"children":5040},{"class":445,"line":3454},[5041,5045,5049,5053,5057,5061,5065,5069,5073],{"type":405,"tag":443,"props":5042,"children":5043},{"style":460},[5044],{"type":411,"value":4801},{"type":405,"tag":443,"props":5046,"children":5047},{"style":466},[5048],{"type":411,"value":469},{"type":405,"tag":443,"props":5050,"children":5051},{"style":460},[5052],{"type":411,"value":2137},{"type":405,"tag":443,"props":5054,"children":5055},{"style":466},[5056],{"type":411,"value":469},{"type":405,"tag":443,"props":5058,"children":5059},{"style":460},[5060],{"type":411,"value":4736},{"type":405,"tag":443,"props":5062,"children":5063},{"style":696},[5064],{"type":411,"value":820},{"type":405,"tag":443,"props":5066,"children":5067},{"style":483},[5068],{"type":411,"value":4250},{"type":405,"tag":443,"props":5070,"children":5071},{"style":489},[5072],{"type":411,"value":4933},{"type":405,"tag":443,"props":5074,"children":5075},{"style":483},[5076],{"type":411,"value":4614},{"type":405,"tag":443,"props":5078,"children":5079},{"class":445,"line":3475},[5080],{"type":405,"tag":443,"props":5081,"children":5082},{"style":466},[5083],{"type":411,"value":1036},{"type":405,"tag":406,"props":5085,"children":5087},{"id":5086},"可能遇到的问题",[5088],{"type":411,"value":5086},{"type":405,"tag":1056,"props":5090,"children":5092},{"id":5091},"给-watch-方法添加的函数设置立即执行",[5093],{"type":411,"value":5094},"给 watch 方法添加的函数设置立即执行",{"type":405,"tag":413,"props":5096,"children":5097},{},[5098],{"type":411,"value":5099},"有的时候我们希望通过 watch 添加函数的同时还立即执行该函数一次, 这个时候我们需要再定义额外的参数传递到 watch 中. 问题是这个函数不一定是同步函数.",{"type":405,"tag":413,"props":5101,"children":5102},{},[5103],{"type":411,"value":5104},"简单处理如下:",{"type":405,"tag":433,"props":5106,"children":5108},{"className":435,"code":5107,"language":437,"meta":398,"style":398},"class VX {\n  async watch (key, fn, options = { immediately: false }, obj = this.store) {\n    handleDep = fn\n    walkChains(key, obj)\n    options.immediately && await fn(options.defaultParams)\n  }\n}\n",[5109],{"type":405,"tag":419,"props":5110,"children":5111},{"__ignoreMap":398},[5112,5127,5220,5236,5263,5315,5322],{"type":405,"tag":443,"props":5113,"children":5114},{"class":445,"line":446},[5115,5119,5123],{"type":405,"tag":443,"props":5116,"children":5117},{"style":588},[5118],{"type":411,"value":770},{"type":405,"tag":443,"props":5120,"children":5121},{"style":773},[5122],{"type":411,"value":2102},{"type":405,"tag":443,"props":5124,"children":5125},{"style":466},[5126],{"type":411,"value":596},{"type":405,"tag":443,"props":5128,"children":5129},{"class":445,"line":456},[5130,5136,5141,5145,5149,5153,5157,5161,5165,5169,5173,5178,5182,5187,5192,5196,5200,5204,5208,5212,5216],{"type":405,"tag":443,"props":5131,"children":5133},{"style":5132},"--shiki-light:#9C3EDA;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[5134],{"type":411,"value":5135},"  async",{"type":405,"tag":443,"props":5137,"children":5138},{"style":847},[5139],{"type":411,"value":5140}," watch",{"type":405,"tag":443,"props":5142,"children":5143},{"style":466},[5144],{"type":411,"value":855},{"type":405,"tag":443,"props":5146,"children":5147},{"style":582},[5148],{"type":411,"value":2193},{"type":405,"tag":443,"props":5150,"children":5151},{"style":466},[5152],{"type":411,"value":501},{"type":405,"tag":443,"props":5154,"children":5155},{"style":582},[5156],{"type":411,"value":2202},{"type":405,"tag":443,"props":5158,"children":5159},{"style":466},[5160],{"type":411,"value":501},{"type":405,"tag":443,"props":5162,"children":5163},{"style":582},[5164],{"type":411,"value":2268},{"type":405,"tag":443,"props":5166,"children":5167},{"style":696},[5168],{"type":411,"value":820},{"type":405,"tag":443,"props":5170,"children":5171},{"style":466},[5172],{"type":411,"value":506},{"type":405,"tag":443,"props":5174,"children":5175},{"style":509},[5176],{"type":411,"value":5177}," immediately",{"type":405,"tag":443,"props":5179,"children":5180},{"style":466},[5181],{"type":411,"value":517},{"type":405,"tag":443,"props":5183,"children":5184},{"style":1157},[5185],{"type":411,"value":5186}," false",{"type":405,"tag":443,"props":5188,"children":5189},{"style":466},[5190],{"type":411,"value":5191}," },",{"type":405,"tag":443,"props":5193,"children":5194},{"style":582},[5195],{"type":411,"value":2211},{"type":405,"tag":443,"props":5197,"children":5198},{"style":696},[5199],{"type":411,"value":820},{"type":405,"tag":443,"props":5201,"children":5202},{"style":803},[5203],{"type":411,"value":1391},{"type":405,"tag":443,"props":5205,"children":5206},{"style":466},[5207],{"type":411,"value":469},{"type":405,"tag":443,"props":5209,"children":5210},{"style":460},[5211],{"type":411,"value":2137},{"type":405,"tag":443,"props":5213,"children":5214},{"style":466},[5215],{"type":411,"value":865},{"type":405,"tag":443,"props":5217,"children":5218},{"style":466},[5219],{"type":411,"value":596},{"type":405,"tag":443,"props":5221,"children":5222},{"class":445,"line":535},[5223,5228,5232],{"type":405,"tag":443,"props":5224,"children":5225},{"style":460},[5226],{"type":411,"value":5227},"    handleDep",{"type":405,"tag":443,"props":5229,"children":5230},{"style":696},[5231],{"type":411,"value":820},{"type":405,"tag":443,"props":5233,"children":5234},{"style":460},[5235],{"type":411,"value":3271},{"type":405,"tag":443,"props":5237,"children":5238},{"class":445,"line":544},[5239,5243,5247,5251,5255,5259],{"type":405,"tag":443,"props":5240,"children":5241},{"style":472},[5242],{"type":411,"value":3952},{"type":405,"tag":443,"props":5244,"children":5245},{"style":509},[5246],{"type":411,"value":480},{"type":405,"tag":443,"props":5248,"children":5249},{"style":460},[5250],{"type":411,"value":2193},{"type":405,"tag":443,"props":5252,"children":5253},{"style":466},[5254],{"type":411,"value":501},{"type":405,"tag":443,"props":5256,"children":5257},{"style":460},[5258],{"type":411,"value":2211},{"type":405,"tag":443,"props":5260,"children":5261},{"style":509},[5262],{"type":411,"value":532},{"type":405,"tag":443,"props":5264,"children":5265},{"class":445,"line":599},[5266,5271,5275,5280,5284,5289,5293,5297,5302,5306,5311],{"type":405,"tag":443,"props":5267,"children":5268},{"style":460},[5269],{"type":411,"value":5270},"    options",{"type":405,"tag":443,"props":5272,"children":5273},{"style":466},[5274],{"type":411,"value":469},{"type":405,"tag":443,"props":5276,"children":5277},{"style":460},[5278],{"type":411,"value":5279},"immediately",{"type":405,"tag":443,"props":5281,"children":5282},{"style":696},[5283],{"type":411,"value":3015},{"type":405,"tag":443,"props":5285,"children":5286},{"style":1231},[5287],{"type":411,"value":5288}," await",{"type":405,"tag":443,"props":5290,"children":5291},{"style":472},[5292],{"type":411,"value":2202},{"type":405,"tag":443,"props":5294,"children":5295},{"style":509},[5296],{"type":411,"value":480},{"type":405,"tag":443,"props":5298,"children":5299},{"style":460},[5300],{"type":411,"value":5301},"options",{"type":405,"tag":443,"props":5303,"children":5304},{"style":466},[5305],{"type":411,"value":469},{"type":405,"tag":443,"props":5307,"children":5308},{"style":460},[5309],{"type":411,"value":5310},"defaultParams",{"type":405,"tag":443,"props":5312,"children":5313},{"style":509},[5314],{"type":411,"value":532},{"type":405,"tag":443,"props":5316,"children":5317},{"class":445,"line":647},[5318],{"type":405,"tag":443,"props":5319,"children":5320},{"style":466},[5321],{"type":411,"value":833},{"type":405,"tag":443,"props":5323,"children":5324},{"class":445,"line":660},[5325],{"type":405,"tag":443,"props":5326,"children":5327},{"style":466},[5328],{"type":411,"value":1036},{"type":405,"tag":1056,"props":5330,"children":5332},{"id":5331},"this-绑定丢失问题",[5333],{"type":411,"value":5334},"this 绑定丢失问题",{"type":405,"tag":413,"props":5336,"children":5337},{},[5338],{"type":411,"value":5339},"在我在对 VX 进行删除属性方法的扩展时, 我往 walkChain 函数中添加了一个执行回调函数的机制, 并且在删除属性这个方法直接调用了 walkChain:",{"type":405,"tag":433,"props":5341,"children":5343},{"className":435,"code":5342,"language":437,"meta":398,"style":398},"  function walkChains (key, obj, fn) {\n    const segments = key.split('.')\n    let deepObj = obj\n    while (segments.length) {\n      deepObj = deepObj[segments.shift()]\n      fn && fn()\n    }\n  }\n",[5344],{"type":405,"tag":419,"props":5345,"children":5346},{"__ignoreMap":398},[5347,5391,5438,5458,5490,5526,5546,5553],{"type":405,"tag":443,"props":5348,"children":5349},{"class":445,"line":446},[5350,5355,5359,5363,5367,5371,5375,5379,5383,5387],{"type":405,"tag":443,"props":5351,"children":5352},{"style":588},[5353],{"type":411,"value":5354},"  function",{"type":405,"tag":443,"props":5356,"children":5357},{"style":472},[5358],{"type":411,"value":3678},{"type":405,"tag":443,"props":5360,"children":5361},{"style":466},[5362],{"type":411,"value":855},{"type":405,"tag":443,"props":5364,"children":5365},{"style":582},[5366],{"type":411,"value":2193},{"type":405,"tag":443,"props":5368,"children":5369},{"style":466},[5370],{"type":411,"value":501},{"type":405,"tag":443,"props":5372,"children":5373},{"style":582},[5374],{"type":411,"value":2211},{"type":405,"tag":443,"props":5376,"children":5377},{"style":466},[5378],{"type":411,"value":501},{"type":405,"tag":443,"props":5380,"children":5381},{"style":582},[5382],{"type":411,"value":2202},{"type":405,"tag":443,"props":5384,"children":5385},{"style":466},[5386],{"type":411,"value":865},{"type":405,"tag":443,"props":5388,"children":5389},{"style":466},[5390],{"type":411,"value":596},{"type":405,"tag":443,"props":5392,"children":5393},{"class":445,"line":456},[5394,5398,5402,5406,5410,5414,5418,5422,5426,5430,5434],{"type":405,"tag":443,"props":5395,"children":5396},{"style":588},[5397],{"type":411,"value":3390},{"type":405,"tag":443,"props":5399,"children":5400},{"style":1416},[5401],{"type":411,"value":3714},{"type":405,"tag":443,"props":5403,"children":5404},{"style":696},[5405],{"type":411,"value":820},{"type":405,"tag":443,"props":5407,"children":5408},{"style":460},[5409],{"type":411,"value":1126},{"type":405,"tag":443,"props":5411,"children":5412},{"style":466},[5413],{"type":411,"value":469},{"type":405,"tag":443,"props":5415,"children":5416},{"style":472},[5417],{"type":411,"value":3731},{"type":405,"tag":443,"props":5419,"children":5420},{"style":509},[5421],{"type":411,"value":480},{"type":405,"tag":443,"props":5423,"children":5424},{"style":483},[5425],{"type":411,"value":486},{"type":405,"tag":443,"props":5427,"children":5428},{"style":489},[5429],{"type":411,"value":469},{"type":405,"tag":443,"props":5431,"children":5432},{"style":483},[5433],{"type":411,"value":486},{"type":405,"tag":443,"props":5435,"children":5436},{"style":509},[5437],{"type":411,"value":532},{"type":405,"tag":443,"props":5439,"children":5440},{"class":445,"line":535},[5441,5446,5450,5454],{"type":405,"tag":443,"props":5442,"children":5443},{"style":588},[5444],{"type":411,"value":5445},"    let",{"type":405,"tag":443,"props":5447,"children":5448},{"style":460},[5449],{"type":411,"value":3763},{"type":405,"tag":443,"props":5451,"children":5452},{"style":696},[5453],{"type":411,"value":820},{"type":405,"tag":443,"props":5455,"children":5456},{"style":460},[5457],{"type":411,"value":3772},{"type":405,"tag":443,"props":5459,"children":5460},{"class":445,"line":544},[5461,5466,5470,5474,5478,5482,5486],{"type":405,"tag":443,"props":5462,"children":5463},{"style":1231},[5464],{"type":411,"value":5465},"    while",{"type":405,"tag":443,"props":5467,"children":5468},{"style":509},[5469],{"type":411,"value":855},{"type":405,"tag":443,"props":5471,"children":5472},{"style":460},[5473],{"type":411,"value":3789},{"type":405,"tag":443,"props":5475,"children":5476},{"style":466},[5477],{"type":411,"value":469},{"type":405,"tag":443,"props":5479,"children":5480},{"style":1416},[5481],{"type":411,"value":3798},{"type":405,"tag":443,"props":5483,"children":5484},{"style":509},[5485],{"type":411,"value":1616},{"type":405,"tag":443,"props":5487,"children":5488},{"style":466},[5489],{"type":411,"value":1405},{"type":405,"tag":443,"props":5491,"children":5492},{"class":445,"line":599},[5493,5498,5502,5506,5510,5514,5518,5522],{"type":405,"tag":443,"props":5494,"children":5495},{"style":460},[5496],{"type":411,"value":5497},"      deepObj",{"type":405,"tag":443,"props":5499,"children":5500},{"style":696},[5501],{"type":411,"value":820},{"type":405,"tag":443,"props":5503,"children":5504},{"style":460},[5505],{"type":411,"value":3763},{"type":405,"tag":443,"props":5507,"children":5508},{"style":509},[5509],{"type":411,"value":3827},{"type":405,"tag":443,"props":5511,"children":5512},{"style":460},[5513],{"type":411,"value":3789},{"type":405,"tag":443,"props":5515,"children":5516},{"style":466},[5517],{"type":411,"value":469},{"type":405,"tag":443,"props":5519,"children":5520},{"style":472},[5521],{"type":411,"value":3840},{"type":405,"tag":443,"props":5523,"children":5524},{"style":509},[5525],{"type":411,"value":3845},{"type":405,"tag":443,"props":5527,"children":5528},{"class":445,"line":647},[5529,5534,5538,5542],{"type":405,"tag":443,"props":5530,"children":5531},{"style":460},[5532],{"type":411,"value":5533},"      fn",{"type":405,"tag":443,"props":5535,"children":5536},{"style":696},[5537],{"type":411,"value":3015},{"type":405,"tag":443,"props":5539,"children":5540},{"style":472},[5541],{"type":411,"value":2202},{"type":405,"tag":443,"props":5543,"children":5544},{"style":509},[5545],{"type":411,"value":1437},{"type":405,"tag":443,"props":5547,"children":5548},{"class":445,"line":660},[5549],{"type":405,"tag":443,"props":5550,"children":5551},{"style":466},[5552],{"type":411,"value":1696},{"type":405,"tag":443,"props":5554,"children":5555},{"class":445,"line":914},[5556],{"type":405,"tag":443,"props":5557,"children":5558},{"style":466},[5559],{"type":411,"value":833},{"type":405,"tag":433,"props":5561,"children":5563},{"className":435,"code":5562,"language":437,"meta":398,"style":398},"del (key, obj = this.store) {\n  walkChains(key, obj, handleDep.clear)\n  delete obj[key]\n}\n",[5564],{"type":405,"tag":419,"props":5565,"children":5566},{"__ignoreMap":398},[5567,5607,5653,5677],{"type":405,"tag":443,"props":5568,"children":5569},{"class":445,"line":446},[5570,5575,5579,5583,5587,5591,5595,5599,5603],{"type":405,"tag":443,"props":5571,"children":5572},{"style":472},[5573],{"type":411,"value":5574},"del",{"type":405,"tag":443,"props":5576,"children":5577},{"style":460},[5578],{"type":411,"value":1351},{"type":405,"tag":443,"props":5580,"children":5581},{"style":466},[5582],{"type":411,"value":501},{"type":405,"tag":443,"props":5584,"children":5585},{"style":460},[5586],{"type":411,"value":1382},{"type":405,"tag":443,"props":5588,"children":5589},{"style":696},[5590],{"type":411,"value":699},{"type":405,"tag":443,"props":5592,"children":5593},{"style":803},[5594],{"type":411,"value":1391},{"type":405,"tag":443,"props":5596,"children":5597},{"style":466},[5598],{"type":411,"value":469},{"type":405,"tag":443,"props":5600,"children":5601},{"style":460},[5602],{"type":411,"value":1400},{"type":405,"tag":443,"props":5604,"children":5605},{"style":466},[5606],{"type":411,"value":1405},{"type":405,"tag":443,"props":5608,"children":5609},{"class":445,"line":456},[5610,5615,5619,5623,5627,5631,5635,5640,5644,5649],{"type":405,"tag":443,"props":5611,"children":5612},{"style":472},[5613],{"type":411,"value":5614},"  walkChains",{"type":405,"tag":443,"props":5616,"children":5617},{"style":509},[5618],{"type":411,"value":480},{"type":405,"tag":443,"props":5620,"children":5621},{"style":460},[5622],{"type":411,"value":2193},{"type":405,"tag":443,"props":5624,"children":5625},{"style":466},[5626],{"type":411,"value":501},{"type":405,"tag":443,"props":5628,"children":5629},{"style":460},[5630],{"type":411,"value":2211},{"type":405,"tag":443,"props":5632,"children":5633},{"style":466},[5634],{"type":411,"value":501},{"type":405,"tag":443,"props":5636,"children":5637},{"style":460},[5638],{"type":411,"value":5639}," handleDep",{"type":405,"tag":443,"props":5641,"children":5642},{"style":466},[5643],{"type":411,"value":469},{"type":405,"tag":443,"props":5645,"children":5646},{"style":460},[5647],{"type":411,"value":5648},"clear",{"type":405,"tag":443,"props":5650,"children":5651},{"style":509},[5652],{"type":411,"value":532},{"type":405,"tag":443,"props":5654,"children":5655},{"class":445,"line":535},[5656,5661,5665,5669,5673],{"type":405,"tag":443,"props":5657,"children":5658},{"style":696},[5659],{"type":411,"value":5660},"  delete",{"type":405,"tag":443,"props":5662,"children":5663},{"style":460},[5664],{"type":411,"value":2211},{"type":405,"tag":443,"props":5666,"children":5667},{"style":509},[5668],{"type":411,"value":3827},{"type":405,"tag":443,"props":5670,"children":5671},{"style":460},[5672],{"type":411,"value":2193},{"type":405,"tag":443,"props":5674,"children":5675},{"style":509},[5676],{"type":411,"value":4213},{"type":405,"tag":443,"props":5678,"children":5679},{"class":445,"line":544},[5680],{"type":405,"tag":443,"props":5681,"children":5682},{"style":466},[5683],{"type":411,"value":1036},{"type":405,"tag":413,"props":5685,"children":5686},{},[5687,5689,5694],{"type":411,"value":5688},"因为 handleDep.clear 当成参数传递进 walkChains 中会",{"type":405,"tag":749,"props":5690,"children":5691},{},[5692],{"type":411,"value":5693},"丢失 this 绑定",{"type":411,"value":5695},", 所以上面那段代码其实是有问题的, 不过稍作修改就好了:",{"type":405,"tag":433,"props":5697,"children":5699},{"className":435,"code":5698,"language":437,"meta":398,"style":398},"  del (key, obj = this.store) {\n    walkChains(key, obj, () => handleDep.clear())\n    delete obj[key]\n  }\n",[5700],{"type":405,"tag":419,"props":5701,"children":5702},{"__ignoreMap":398},[5703,5743,5795,5819],{"type":405,"tag":443,"props":5704,"children":5705},{"class":445,"line":446},[5706,5711,5715,5719,5723,5727,5731,5735,5739],{"type":405,"tag":443,"props":5707,"children":5708},{"style":472},[5709],{"type":411,"value":5710},"  del",{"type":405,"tag":443,"props":5712,"children":5713},{"style":460},[5714],{"type":411,"value":1351},{"type":405,"tag":443,"props":5716,"children":5717},{"style":466},[5718],{"type":411,"value":501},{"type":405,"tag":443,"props":5720,"children":5721},{"style":460},[5722],{"type":411,"value":1382},{"type":405,"tag":443,"props":5724,"children":5725},{"style":696},[5726],{"type":411,"value":699},{"type":405,"tag":443,"props":5728,"children":5729},{"style":803},[5730],{"type":411,"value":1391},{"type":405,"tag":443,"props":5732,"children":5733},{"style":466},[5734],{"type":411,"value":469},{"type":405,"tag":443,"props":5736,"children":5737},{"style":460},[5738],{"type":411,"value":1400},{"type":405,"tag":443,"props":5740,"children":5741},{"style":466},[5742],{"type":411,"value":1405},{"type":405,"tag":443,"props":5744,"children":5745},{"class":445,"line":456},[5746,5750,5754,5758,5762,5766,5770,5774,5778,5782,5786,5790],{"type":405,"tag":443,"props":5747,"children":5748},{"style":472},[5749],{"type":411,"value":3952},{"type":405,"tag":443,"props":5751,"children":5752},{"style":509},[5753],{"type":411,"value":480},{"type":405,"tag":443,"props":5755,"children":5756},{"style":460},[5757],{"type":411,"value":2193},{"type":405,"tag":443,"props":5759,"children":5760},{"style":466},[5761],{"type":411,"value":501},{"type":405,"tag":443,"props":5763,"children":5764},{"style":460},[5765],{"type":411,"value":2211},{"type":405,"tag":443,"props":5767,"children":5768},{"style":466},[5769],{"type":411,"value":501},{"type":405,"tag":443,"props":5771,"children":5772},{"style":466},[5773],{"type":411,"value":793},{"type":405,"tag":443,"props":5775,"children":5776},{"style":588},[5777],{"type":411,"value":591},{"type":405,"tag":443,"props":5779,"children":5780},{"style":460},[5781],{"type":411,"value":5639},{"type":405,"tag":443,"props":5783,"children":5784},{"style":466},[5785],{"type":411,"value":469},{"type":405,"tag":443,"props":5787,"children":5788},{"style":472},[5789],{"type":411,"value":5648},{"type":405,"tag":443,"props":5791,"children":5792},{"style":509},[5793],{"type":411,"value":5794},"())\n",{"type":405,"tag":443,"props":5796,"children":5797},{"class":445,"line":535},[5798,5803,5807,5811,5815],{"type":405,"tag":443,"props":5799,"children":5800},{"style":696},[5801],{"type":411,"value":5802},"    delete",{"type":405,"tag":443,"props":5804,"children":5805},{"style":460},[5806],{"type":411,"value":2211},{"type":405,"tag":443,"props":5808,"children":5809},{"style":509},[5810],{"type":411,"value":3827},{"type":405,"tag":443,"props":5812,"children":5813},{"style":460},[5814],{"type":411,"value":2193},{"type":405,"tag":443,"props":5816,"children":5817},{"style":509},[5818],{"type":411,"value":4213},{"type":405,"tag":443,"props":5820,"children":5821},{"class":445,"line":544},[5822],{"type":405,"tag":443,"props":5823,"children":5824},{"style":466},[5825],{"type":411,"value":833},{"type":405,"tag":406,"props":5827,"children":5829},{"id":5828},"后语",[5830],{"type":411,"value":5828},{"type":405,"tag":413,"props":5832,"children":5833},{},[5834],{"type":411,"value":5835},"在这篇文章中, 我们通过对 defineProperty 进行封装, 实现了一个简单的对象属性侦听器的功能, 以弥补小程序所没有的$watch 能力. 在此基础上, 各位可以再对 VX 进行扩展, 更方便地去书写业务代码.",{"type":405,"tag":413,"props":5837,"children":5838},{},[5839,5841],{"type":411,"value":5840},"完整代码 ",{"type":405,"tag":675,"props":5842,"children":5846},{"href":5843,"rel":5844},"https://github.com/Lionad-Morotar/media-gear/blob/master/src/renderer/utils/suites/vx/index.js",[5845],"nofollow",[5847],{"type":411,"value":5848},"GitHub 直达",{"type":405,"tag":5850,"props":5851,"children":5852},"style",{},[5853],{"type":411,"value":5854},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":398,"searchDepth":456,"depth":456,"links":5856},[5857,5858,5859,5860,5863,5868,5869,5872,5876],{"id":408,"depth":456,"text":408},{"id":730,"depth":456,"text":730},{"id":740,"depth":456,"text":740},{"id":1052,"depth":456,"text":1052,"children":5861},[5862],{"id":1058,"depth":535,"text":1061},{"id":2037,"depth":456,"text":2040,"children":5864},[5865,5866,5867],{"id":2043,"depth":535,"text":2043},{"id":2075,"depth":535,"text":2078},{"id":2825,"depth":535,"text":2825},{"id":3634,"depth":456,"text":3637},{"id":4537,"depth":456,"text":4537,"children":5870},[5871],{"id":4542,"depth":535,"text":4542},{"id":5086,"depth":456,"text":5086,"children":5873},[5874,5875],{"id":5091,"depth":535,"text":5094},{"id":5331,"depth":535,"text":5334},{"id":5828,"depth":456,"text":5828},"markdown","content:_achieved:2019-05:reactive-in-150loc.md","content","_achieved/2019-05/reactive-in-150loc.md","_achieved/2019-05/reactive-in-150loc","md",[5884,5887],{"_path":5885,"title":5886,"description":398},"/_achieved/2018-10/noname","🌆 无题",{"_path":5888,"title":5889,"description":398},"/_achieved/2019-06/messy-in-two-years","💖 聊聊此次离职，毕业，及其它杂乱的事情",1741604952253]