暗黑模式及及 CSS 变量相关说明。

<!-- STASH -->

### 资源文件

* 平台提供的变量表文档：[CyberCloud 主题样式](https://doc.weixin.qq.com/sheet/e3_AHQATgb4AEk7vClCvlQR70RAJbumQ?scode=APQAkAdRAAY0CaXaADAHQATgb4AEk&journal_source=chat&roomid=Person%3A1688854515420720%3A1688855492302652&open_source=wecomprivate&clickStart=1699249719996&version=4.1.10.6015&platform=win&tab=BB08J2)
* 平台使用（应当使用）的颜色表文档：[https://tailwindcolor.com/](https://tailwindcolor.com/)

* 平台提供的变量表：
	* light：https://cdn.loghub.com/assets/themes/light.css
	* dark：https://cdn.loghub.com/assets/themes/dark.css

### 原理简介

主应用维护了枚举值为 ‘light’ 及 ‘dark' 的主题状态。

主题状态变化时，主应用会动态引用 CDN 对应的样式文件，切换全局变量，以达到初始化不同主题对应的平台变量的功能。主应用及子应用代码内引用到平台变量的地方会自动更改样式。

主应用及其子应用使用了 Naive UI 和 Element Plus 两个 UI 框架作为基础库，基础库需要按照特定模式切换主题：
* Naive UI：根据主题状态在主应用项目使用 native-ui 内置组件 n-config-provider 注入暗黑主题的样式。注入的样式变量会自动复写到各组件的 style 以改变样式。
* Element Plus：Element Plus 仅区分亮色及暗黑模式，并根据 html 挂载的 CSS 类名 dark 来动态切换变量来改变样式。

Cybercloud UI 项目提供 isDark 响应式变量，判断当前应用是否处于暗黑模式。

### 平台微前端框架相关问题

* 许多 UI 框架使用特殊标签 + CSS 类名的方式实现暗色模式[^tag-and-css]，由于 MicroApp 不支持设置 scoped 逃逸选择器，只能默认逃逸根选择器（`html`、`:root`）或通过特殊注释自定义，这会给插件开发者带来心智负担。使用这些 UI 框架的开发者需要了解平台使用的微前端框架的特殊注释的写法。

[^tag-and-css]: 如 Quasar、SemiDesign、Ionic 等 UI 框架。这些框架使用 body + classname 的方式实现暗色模式下的变量覆盖，见 [Quasar 暗色模式](http://www.quasarchs.com/style/dark-mode/)、[SemiDesign 暗色模式](https://semi.design/zh-CN/start/dark-mode)。

### 代码规范

#### 1. 优先使用变量

在主应用、App、Setup、UI 项目优先使用变量写 CSS 值。变量的优先级为平台变量、ElementPlus 变量、UI 项目变量。

```css
.header {
  .name {
    color: var(--cp-text-color);
  }
}
```

#### 2. 代码中引用平台变量时需要使用默认值

避免切换样式带来的样式突变

```css
.header {
  .name {
    color: var(--cp-text-color, #392121);
  }
}
```
#### 2. 仅和主题切换相关的变量才需要放到表中

```css
--cp-page-header-bg-color: white; // 某元素背景色会随主题的变化而变化，应当在 CDN 的每一个主题文件中都做覆盖

--cp-page-header-height: 50px // 此高度不会随主题变化而变化，应该放到主应用的 styes/index.less 或跟随组件
```

