# 本地如何调试自定义弹窗及其生命周期

[toc]

## 简介

弹窗是包含 JS、HTML、CSS 的网页应用，弹窗生命周期是一段 JS 代码，将其线上地址代理到本地，就能在使用平台环境的基础上调试弹窗以及弹窗生命周期的代码。

使用代理进行调试能节约包括推送代码、CI、部署等一系列环节带来的时间损耗。代理的一般方法有：修改 Host 文件、Fiddler AutoResponder、nginx、NodeJS 服务器。以下介绍难度更小以及兼容性更好的方法。

## 步骤说明

总共有 5 个步骤。

**1.** 使用谷歌浏览器安装 [Mod Header 插件](https://chrome.google.com/webstore/search/mod-header)：

![浏览器安装 Mod Header 插件](https://mgear-image.oss-cn-shanghai.aliyuncs.com/image/other/20230714234829.png)

**2.** 配置自定义弹窗的的转发规则，示例如下：

```bash
# request headers
Access-Control-Allow-Credentials: true
Access-Control-Request-Private-Network: true

# response headers
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: *
Access-Control-Allow-Credentials: true
Access-Control-Allow-Private-Network: true

# redirect urls
#   from
http://saas-ttxrd-dev-ttxrd-wmsbase.cloud.loghub.com/expose/dialogs/(.*)
#   to
http://localhost:9999/expose/dialogs/$1
```

![Mod Header Options](https://mgear-image.oss-cn-shanghai.aliyuncs.com/image/other/20230714234726.png)

**3.** 使用弹窗（或弹窗生命周期）的自动编译功能，并等待第一次编译完成，示例如下：

```bash
# 弹窗
pnpm run -r _build:dialogs:watch
# 弹窗生命周期
pnpm run -r _build:dialog-lifecycle:watch
```

![watch script example](https://mgear-image.oss-cn-shanghai.aliyuncs.com/image/other/20230714234811.png)

**4.** 使用代理服务器代理编译产物所在的目录，示例如下：

```bash
pnpm serve:dist
```

![pnpm serve-dist](https://mgear-image.oss-cn-shanghai.aliyuncs.com/image/other/20230714234751.png)

**5.** 修改相关代码，会发现相关代码很快就编译好并在控制台显示了编译时间。此时，在浏览器相关页面关闭弹窗，再重新打开弹窗，便能看到修改后的效果。同时，在代理服务器也应该能看到相关日志。

![新编译好的弹窗生命周期函数会输出一行”Time”](https://mgear-image.oss-cn-shanghai.aliyuncs.com/image/other/20230714234845.png)
