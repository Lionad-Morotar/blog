{"_path":"/maps/_ai/prompt/context-engineering","_dir":"prompt","_draft":false,"_partial":true,"_locale":"","title":"Context Engineering","description":"Context Engineering 是一种优化与大型语言模型（LLM）交互的技术，旨在通过提供结构化和相关的上下文信息，提高模型生成内容的准确性和相关性。","body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"brief"},"children":[{"type":"text","value":"Brief"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"上下文工程是指在推理阶段，对提供给大语言模型的信息进行系统化的设计与优化，从而稳定地产生期望输出。它的核心是对各种情境要素进行结构化、选择和排序——例如提示词、检索到的数据、记忆、指令以及环境信号等——以便让模型的内部层次在一种最优状态下运行。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"与只关注提示词措辞的提示工程不同，上下文工程关心的是“情境”的完整配置：相关知识、指令和历史上下文是如何被组织和投递的，以便实现最有效的结果。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"目前，工程师会使用一系列离散的技术，这些技术大致可以分为三个方向："}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"情境搭建（Context setup）"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n主要关注“上下文的初始配置与精简”，包括："},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"使用极简的系统提示词"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"使用规范化（canonical）的少样本示例"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"使用高效利用 token 的工具来支持果断行动"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"情境管理（Context management for long-horizon tasks）"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n面向长周期任务，解决有限上下文窗口的问题，包括："},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"上下文摘要，将较长历史压缩成关键信息"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"结构化笔记，用外部持久化记忆记录关键过程与结论"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"子代理架构，将复杂任务拆解为子任务，并在子任务层面进行隔离与摘要"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"动态信息检索（Dynamic information retrieval）"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n依赖“即时（Just-in-Time, JIT）上下文检索”："},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"只有在确实需要时，智能体才自主加载外部数据"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"通过这种按需拉取的方式，最大化信息利用效率与推理精度"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"details"},"children":[{"type":"text","value":"Details"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"目录"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"什么是上下文工程"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"上下文工程 vs 提示工程"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"上下文工程的三大方向（架构颗粒度）"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n3.1 情境搭建（Context Setup）"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n3.2 情境管理：长周期任务（Context Management）"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n3.3 动态信息检索（Dynamic Information Retrieval）"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"实践要点与落地建议"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"——————————"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"什么是上下文工程（Context Engineering）"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"1.1 概念"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n上下文工程是在推理阶段，对“喂给大模型的所有信息”进行整体设计和优化的一套方法论与工程实践。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n它关心的是整个“上下文配置”如何影响模型内部状态，从而影响输出质量和稳定性。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"1.2 对象范围"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n上下文工程覆盖但不限于："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"系统提示词与角色设定"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"用户指令与任务描述"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"少样本示例与模板"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"从外部系统检索到的数据"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"会话历史与外部记忆（notes、知识库等）"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"环境信号（如工具调用结果、系统状态等）"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"这些都被视作“情境元素”，需要被合理组织和调度。"}]},{"type":"element","tag":"ol","props":{"start":2},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"上下文工程 vs 提示工程"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"2.1 提示工程关注点"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n提示工程主要聚焦在一句或若干句“prompt”的写法："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"如何更清晰地描述任务"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"如何减少歧义"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"如何通过措辞影响模型行为"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"2.2 上下文工程关注点"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n上下文工程则关注："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"用哪些信息：信息源选择、过滤、裁剪"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"以什么结构组织：分块、层级、标签、模板化"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"以什么顺序喂给模型：先指令、后知识，或先总结、后追问等"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"在整个任务生命周期内，如何滚动维护与更新上下文"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"可以理解为："},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n提示工程是“怎么说这句话”，"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n上下文工程是“说什么、按什么结构说、在什么时机说，以及说给谁（哪个子代理）听”。"}]},{"type":"element","tag":"ol","props":{"start":3},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"上下文工程的三大方向"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"3.1 情境搭建（Context Setup）"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"3.1.1 目标"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n在模型开始处理任务之前，搭建一个“干净、明确、轻量”的初始上下文，让后续推理在良好约束下进行。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"3.1.2 关键实践"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"极简系统提示词"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"避免在系统提示里堆积过多要求"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"只保留核心角色设定和关键约束"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"其他细节通过工具、模板或后续指令承载"}]}]},{"type":"element","tag":"ol","props":{"start":2},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"规范化少样本示例（Canonical Few-shot）"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"为高频任务设计标准示例集"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"示例结构统一：输入格式、思考过程、输出格式"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"通过“几个高质量样例”塑造模型行为，而不是大量杂乱样例"}]}]},{"type":"element","tag":"ol","props":{"start":3},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"token 高效的工具与结构"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"将复杂逻辑下沉到工具（代码、API），让模型通过自然语言调用"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"用紧凑的数据表示（ID、引用、索引）替代冗长文本"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"用模板化结构（JSON、表格样式文本）减少解释成本"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"3.2 情境管理：长周期任务（Context Management for Long-horizon Tasks）"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"3.2.1 问题背景"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n在长周期、多轮对话或复杂流程中："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"模型的上下文窗口有限"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"历史信息会不断被新内容挤出"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"重要决策、约定和中间结论容易丢失"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"3.2.2 关键实践"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"上下文摘要"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"周期性地对对话/步骤做总结，保留：\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"关键决策"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"重要中间结论"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"未解决的问题与假设"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"用摘要替换长对话原文，以压缩 token"}]}]},{"type":"element","tag":"ol","props":{"start":2},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"结构化笔记 / 外部记忆"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"将重要信息写入外部结构：\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"任务目标与约束"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"当前状态与进度"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"已完成与待办列表"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"以“笔记”形式重新注入上下文，而不是反复传入全部历史对话"}]}]},{"type":"element","tag":"ol","props":{"start":3},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"子代理架构（Sub-agent Architectures）"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"将复杂任务拆解为多类子任务：分析、规划、执行、评审等"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"每个子代理只保留与自己子任务强相关的局部上下文"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"对子代理输出进行摘要，再汇总给主代理"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"通过“隔离 + 摘要”控制整体上下文体积与噪音"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"3.2.3 效果"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"减少无关历史对当前推理的干扰"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"在有限上下文内维持对长期任务的一致理解"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"提升长流程、多阶段系统的稳定性和可追溯性"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"3.3 动态信息检索（Dynamic Information Retrieval）"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"3.3.1 核心思想：JIT（Just-in-Time）"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n动态信息检索强调“按需加载”："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"不在一开始就把所有可能相关的信息塞给模型"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"由智能体在推理过程中判断何时需要外部知识"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"只在“当下这一步”真的需要时，才发起检索或工具调用"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"3.3.2 关键实践"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"JIT 检索策略"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"让代理先进行初步思考，识别信息缺口"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"在识别缺口后，触发检索：知识库、数据库、API、搜索等"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"将检索结果以结构化方式注入后续上下文"}]}]},{"type":"element","tag":"ol","props":{"start":2},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"精准匹配与裁剪"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"使用向量检索 / 结构化查询，尽量只返回“最相关的少量片段”"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"对检索结果做二次过滤与摘要，降低噪音和 token 消耗"}]}]},{"type":"element","tag":"ol","props":{"start":3},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"与工具生态结合"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"把外部系统封装成“可调用工具”，由代理按需调用"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"工具返回数据尽量结构化（JSON 等），便于后处理与复用"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"3.3.3 目标效果"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"在保持结果质量的前提下，最小化上下文体积"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"避免信息过载导致模型“跑偏”或陷入无关细节"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"实现更高的时效性和更好的领域适配（通过实时数据源）"}]}]},{"type":"element","tag":"ol","props":{"start":4},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"实践要点与落地建议"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"4.1 设计层面"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"把“上下文”当成系统的一等公民来建模，而不是零散的 prompt 文本"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"明确区分：\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"固定长期配置：角色、全局约束"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"任务级配置：目标、输入、成功标准"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"步骤级配置：当前子任务相关信息"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"为这三层分别设计结构与更新策略"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"4.2 工程实现层面"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"引入“上下文编排层”：\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"负责收集、过滤、排序各种信息源"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"输出给模型的是一个结构化、可解释的最终上下文"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"内置常用能力模块：\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"摘要模块（对历史、对子代理输出）"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"检索模块（向量、全文、结构化）"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"记忆模块（长期笔记、会话级存储）"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"4.3 评估与优化"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"不只评估“单轮回答质量”，还要评估：\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"长任务中的一致性"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"信息利用率（用到的 vs 提供的）"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"token 成本和延迟"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"用实验对比不同情境策略：\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"不同摘要粒度"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"不同检索阈值"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"不同子代理拆分方式"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"通过将以上三大方向（情境搭建、情境管理、动态检索）纳入统一架构设计，可以从“单次 prompt 调优”升级为“上下文系统工程”，在复杂场景下显著提高大模型应用的可靠性、效率与可维护性。"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"brief","depth":2,"text":"Brief"},{"id":"details","depth":2,"text":"Details"}]}},"_type":"markdown","_id":"content:6.maps:_ai:prompt:context-engineering.md","_source":"content","_file":"6.maps/_ai/prompt/context-engineering.md","_stem":"6.maps/_ai/prompt/context-engineering","_extension":"md"}