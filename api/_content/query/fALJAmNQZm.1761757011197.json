{"_path":"/maps/_interview/_frontend/nuxt","_dir":"_frontend","_draft":false,"_partial":true,"_locale":"","title":"Nuxt 面试题","description":"当前内容使用AI合成，参考时请谨慎甄别","body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"知识大纲"},"children":[{"type":"text","value":"知识大纲"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"一、基础与核心概念"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Nuxt 的定位与优势"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• Nuxt 与 Vue CLI、Vite 的区别"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• SPA / SSR / SSG / ISR 模式的实现原理"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"项目结构"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• pages、layouts、components、assets、plugins、middleware、modules 等目录作用"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"路由系统"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 基于文件系统自动生成路由的规则"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 动态路由、嵌套路由、可选参数、catch-all 路由\n• 路由守卫：中间件（middleware）与 Vue Router 4 的区别"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"运行时配置"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• runtimeConfig、process.env、import.meta 的使用场景"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"二、渲染机制与数据获取"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"SSR 生命周期"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• serverPrefetch 对比 useAsyncData/useFetch\n• hydration 与客户端激活（hydration mismatch 排查）"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"数据获取 API"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• useAsyncData、useFetch、useLazyAsyncData 的差异"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 缓存 key、defer、default、transform 选项"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"SSG 生成流程"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• nitro generate、prerender routes、payload extraction"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• incremental static regeneration（ISR）原理"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"SEO 与首屏优化"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• useHead / useSeoMeta 与 "},{"type":"element","tag":"nuxt-link","props":{},"children":[{"type":"text","value":" 预取策略"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• Nuxt Image、lazy loading、预渲染 FCP/LCP 指标优化方法"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"三、状态管理与组合式 API"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Pinia 集成"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• defineStore、storeToRefs、$reset 及插件机制"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• SSR 下的状态序列化与 hydration"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Vue 3 组合式 API"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• composables 目录自动导入规则"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• useState vs useCookie、useSession"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"跨端共享状态"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• server side cookie / token 注入"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• nuxt/app 与 nitro context 的桥接"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"四、插件与中间件"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"插件生命周期"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• mode: client/server/all 与 order"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• provide/inject 在 SSR 中的可行性"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"中间件分类"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• global / named / route-based / server route middleware"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• auth、i18n 场景设计题"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Server Routes（Nitro）"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• API Routes、Event Handler、server middleware"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• Streaming / Edge Function 支持"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"五、Nuxt Nitro 与部署"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"构建产物"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• .output 结构解析、server.mjs、dist/server 关系"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• preset-standard、preset-node、preset-vercel、preset-cloudflare"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"无服务器部署"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• Vercel、Netlify、Cloudflare Pages、AWS Lambda 的不同打包策略"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• Cold start 与 bundle size 优化"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Docker 化与自托管"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 多阶段构建、PNPM Hoisting、静态资源 CDN Offload"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"监控与 APM"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• runtimeConfig 注入 Sentry / NewRelic 实战"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• server-timing header、nitro timing"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"六、性能、安全与故障排查"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Bundle 拆分"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• dynamic import、vendor/commons chunk、payload extraction"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"资源优化"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• nuxt/image、nuxt/scripts defer/async、preload/prefetch"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"安全实践"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• XSS/CSRF 防护、Helmet 中间件、Cookie SameSite"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"常见报错排查"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• navigate aborted、Cannot read property ‘_payload’ of undefined"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• HMR 失败、nitro error captured"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"七、可扩展性与生态"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Nuxt 模块开发"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• defineNuxtModule、addPlugin、extendPages、hooks"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 自动导入（autoImports）生成逻辑"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"经典社区模块"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• @nuxt/image、@pinia/nuxt、nuxt-i18n、nuxt-auth"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 面试中可讨论的源码实现亮点"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Monorepo 与微前端"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• NPM Workspaces / PNPM / TurboRepo 配置 Nuxt"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• Module Federation、iframe sandbox 对比"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"八、综合实战 / 场景题"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"设计题：为全球新闻站点选型 SSR + ISR 架构，考虑 SEO、缓存、成本"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"排障题：生产环境出现 hydration mismatch，如何快速定位"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"性能题：Lighthouse CLS 偏高，Nuxt 项目需要怎样优化"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"安全题：如何在 SSR API 中安全地读取第三方密钥并下发前端"}]}]},{"type":"element","tag":"h2","props":{"id":"问题分类"},"children":[{"type":"text","value":"问题分类"}]},{"type":"element","tag":"h3","props":{"id":"基础与核心概念"},"children":[{"type":"text","value":"基础与核心概念"}]},{"type":"element","tag":"h4","props":{"id":"nuxt-与-vue-cli-的区别"},"children":[{"type":"text","value":"Nuxt 与 Vue CLI 的区别？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Nuxt 是以服务端渲染、静态生成为核心、带路由约定、能辅助项目生成、开发、编译、部署全链路的 Vue3 元框架，Vue CLI 更像是 webpack 的某种封装。"}]},{"type":"element","tag":"h4","props":{"id":"spassrssgisr-模式的基本原理"},"children":[{"type":"text","value":"SPA、SSR、SSG、ISR 模式的基本原理？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"SPA 全部在浏览器渲染，SSR 则是请求时服务端动态渲染，SSG 构建时一次性渲染，ISR：SSG + 在线按需、分批重新渲染。"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"SPA（Single-Page Application）"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 构建时：打出一个入口 HTML + 多个 JS/CSS chunk。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 首次请求：服务器只回 1 个极简 HTML（Root DIV）+ JS 引用。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 运行时：浏览器下载 JS → "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"createApp()"}]},{"type":"text","value":" 挂载 → 客户端路由 (history/hash) 劫持导航、动态 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"fetch"}]},{"type":"text","value":" 数据并重新 patch DOM。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 关键点：所有页面切换发生在浏览器；服务器只做静态文件或 API。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"SSR（Server-Side Rendering）"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 每次 HTTP 请求：Node/Nitro 等在服务器内执行 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"renderToString()"}]},{"type":"text","value":"（或 Streaming）→ 生成完整 HTML（含首屏数据）返回。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• HTML 内嵌序列化的初始状态 ("},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"window.__NUXT__/__INITIAL_STATE__"}]},{"type":"text","value":")。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 浏览器下载同一套 JS → "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"hydrate()"}]},{"type":"text","value":" 复用已有 DOM，事件监听接管；之后退化为普通 SPA。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 关键点：首屏由服务器算好，SEO 与 FCP 友好，服务器需常驻、承受 QPS。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"SSG（Static Site Generation）"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 构建时：跑一次 SSR 渲染，但针对路由列表批量离线生成 HTML + JSON payload，写入 /dist。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 部署时：产物是纯静态文件，可直接挂 CDN，0 服务器成本。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 运行时：用户拿到静态 HTML；JS 启动后再做客户端导航。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 关键点：不可变内容=最佳；有变动需整站或指定路由重新 build。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"ISR（Incremental Static Regeneration）"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 构建时：与 SSG 相同，先产出静态文件。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 线上流量：CDN 命中现有 HTML 即直接返回。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 失效策略：设定 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"revalidate"}]},{"type":"text","value":"（TTL）或 webhook。过期命中时，边缘或原点触发后台“再跑一次 SSR”→ 新文件写回对象存储/CDN，原请求仍返回旧版，下一请求拿到新版；更新原子切换。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 关键点：静态性能 + 可增量更新；实现需锁定并发、保证写文件原子性，框架层（Nuxt Nitro/Vercel ISR）已封装。"}]}]},{"type":"element","tag":"h4","props":{"id":"nuxt-的一些基础概念"},"children":[{"type":"text","value":"Nuxt 的一些基础概念？"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"pages"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 约定式路由生成器：文件树 → "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"vue-router"}]},{"type":"text","value":" 配置（基于文件名 / 文件夹名 ➜ 动态段、可选段、catch-all）。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 解析时机：Dev server 启动 & build 时扫描；支持 HMR 增量更新。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 输出：每个 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":".vue"}]},{"type":"text","value":" → 同名异步 chunk，路由懒加载。"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"definePageMeta"}]},{"type":"text","value":" 可注入 head、middleware 等元数据。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"layouts"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 页面骨架复用层；默认 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"_default.vue"}]},{"type":"text","value":"。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• pages 通过 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"definePageMeta({ layout: 'xxx' })"}]},{"type":"text","value":" 或 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"<script setup>export default{ layout:'xxx'}"}]},{"type":"text","value":" 选择。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 每次路由切换仅替换 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"<NuxtPage/>"}]},{"type":"text","value":" 插槽，保留布局状态；可用于持久化侧边栏、导航动画。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"components"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 自动导入（"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"@nuxt/components"}]},{"type":"text","value":"）：按目录名生成组件 name，编译期做 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"babel"}]},{"type":"text","value":" 转换 → 静态分析 + tree-shake；无需 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"import"}]},{"type":"text","value":"/"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"registration"}]},{"type":"text","value":"。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 细分子目录会映射为命名空间，如 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"components/ui/Button.vue"}]},{"type":"text","value":" → "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"<UiButton/>"}]},{"type":"text","value":"。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 运行时走异步加载（可 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"lazy: true"}]},{"type":"text","value":" 强制）。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"assets"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 参与构建链：SASS/LESS/PostCSS 被 loader 处理，图片可经 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"vite-imagetools"}]},{"type":"text","value":"/"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"url-loader"}]},{"type":"text","value":"。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 引用方式：通过 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"@/assets/xxx"}]},{"type":"text","value":" 或相对路径导入；会被哈希命名并放入 build 输出。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 与 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"public/"}]},{"type":"text","value":" 区别：后者原样复制，不经打包。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"plugins"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 作用：在根应用实例创建前执行，注入全局依赖（如 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"axios"}]},{"type":"text","value":", "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"i18n"}]},{"type":"text","value":"）或注册指令/过滤器。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 书写："},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"defineNuxtPlugin(ctx => { ctx.provide('xxx', …) })"}]},{"type":"text","value":"；支持 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"mode: 'client' | 'server'"}]},{"type":"text","value":" 前缀文件名或 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"export const ssr = false"}]},{"type":"text","value":" 控制端。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 插入顺序 = 文件系统排序，可通过 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"order"}]},{"type":"text","value":" 显式配置。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"middleware"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 路由生命周期钩子（server & client 共用）："},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"defineNuxtRouteMiddleware((to, from) => { ... })"}]},{"type":"text","value":"。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 执行时机：页面组件解析前；可返回 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"navigateTo"}]},{"type":"text","value":" / "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"abortNavigation"}]},{"type":"text","value":"。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 作用域："},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n– 全局：放在 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"middleware/"}]},{"type":"text","value":" 并在 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nuxt.config"}]},{"type":"text","value":" 或 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"definePageMeta"}]},{"type":"text","value":" 引用。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n– 匿名：直接写在 page 文件内。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• SSR 时在 Nitro 中先跑一次；客户端路由跳转再跑一次（保障同构）。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"modules"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 构建期 & 运行期的可插拔扩展（等价 Nuxt 的“Webpack/Vite+Nitro”双栈插件）。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 定义："},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"export default defineNuxtModule({ hooks, vite, nitro, … })"}]},{"type":"text","value":"；可修改 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nuxt.options"}]},{"type":"text","value":"、注入 runtime code、注册 hooks。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 生态："},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"@nuxt/image"}]},{"type":"text","value":", "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"@pinia/nuxt"}]},{"type":"text","value":", "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nuxt-auth"}]},{"type":"text","value":" 等。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 与插件区别：module 以“修改框架配置”为主，plugin 以“运行时注入”为主；module 可自动安装 plugin。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"执行顺序（从启动到渲染）："},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"modules"}]},{"type":"text","value":" 调整配置 → 构建 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"vite"}]},{"type":"text","value":"/"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"webpack"}]},{"type":"text","value":" → "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"plugins"}]},{"type":"text","value":" 初始化 → "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"layouts"}]},{"type":"text","value":" 渲染框架 → "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"middleware"}]},{"type":"text","value":" 验权/数据预取 → "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"pages"}]},{"type":"text","value":" 渲染 → "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"components"}]},{"type":"text","value":" 拼装视图 → "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"assets"}]},{"type":"text","value":" 与静态文件注入页面。"}]},{"type":"element","tag":"h4","props":{"id":"基于文件系统自动生成路由的规则"},"children":[{"type":"text","value":"基于文件系统自动生成路由的规则？"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"扫描入口"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• dev 启动或 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nuxi build"}]},{"type":"text","value":" 时，Nuxt Kit 的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"pages"}]},{"type":"text","value":" 模块递归遍历 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"./pages"}]},{"type":"text","value":" 目录，收集所有 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":".vue"}]},{"type":"text","value":"、"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":".md"}]},{"type":"text","value":"、"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":".ts"}]},{"type":"text","value":"/"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":".js"}]},{"type":"text","value":"（export default 组件）文件。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 生成 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":".nuxt/pages.mjs"}]},{"type":"text","value":"，在 Vite Server/SSR 构建阶段被 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"vue-router"}]},{"type":"text","value":" 动态 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"import()"}]},{"type":"text","value":" 使用。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"基础映射规则"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 文件 → 路径："},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"pages/index.vue"}]},{"type":"text","value":"   ⇢ "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"pages/about.vue"}]},{"type":"text","value":"   ⇢ "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/about"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"pages/foo/bar.vue"}]},{"type":"text","value":"  ⇢ "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/foo/bar"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 目录 → 嵌套路由：目录名只是路径片段；同层 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"index.vue"}]},{"type":"text","value":" 代表“该段根”。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"pages/blog/index.vue"}]},{"type":"text","value":" ⇢ "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/blog"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"pages/blog/post.vue"}]},{"type":"text","value":"  ⇢ "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/blog/post"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"动态片段（Dynamic Segment）"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"[param].vue"}]},{"type":"text","value":" → "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/:param"}]},{"type":"text","value":"（必填）"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"[...param].vue"}]},{"type":"text","value":" → "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/:param(.*)"}]},{"type":"text","value":" （catch-all，至少 1 段）"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"[[...param]].vue"}]},{"type":"text","value":" → "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/:param(.*)?"}]},{"type":"text","value":"（可选 catch-all，0-∞ 段）"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"[param]-details.vue"}]},{"type":"text","value":" 等混合写法支持 RegExp 兼容："},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/:param(.*)-details"}]},{"type":"text","value":"。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 多级动态："},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"pages/user-[group]/[id].vue"}]},{"type":"text","value":" ⇢ "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/user-:group/:id"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"可选动态片段（Optional Segment，Nuxt 3 专属）"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"pages/blog/[slug].vue"}]},{"type":"text","value":" ⇢ "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/blog/:slug"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"pages/blog/[slug].index.vue"}]},{"type":"text","value":" 可同时持有 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/blog"}]},{"type":"text","value":" 和 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/blog/:slug"}]},{"type":"text","value":"，利用目录级 optional。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"[param]?"}]},{"type":"text","value":" 语法暂不支持，需用双层目录 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"blog/[slug]/index.vue"}]},{"type":"text","value":" + "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"blog/index.vue"}]},{"type":"text","value":" 实现。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"路由分组\n• 以圆括号包裹的目录不会出现在 URL，仅用于组织文件："},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"pages/(auth)/login.vue"}]},{"type":"text","value":" ⇢ "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/login"}]},{"type":"text","value":"。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 生成的 route name 也会排除括号部分。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"路由命名策略"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 由路径片段用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" 拼接："},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"pages/users/[id]/edit.vue"}]},{"type":"text","value":" → name "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"users-id-edit"}]},{"type":"text","value":"."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 可用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"<RouteName>"}]},{"type":"text","value":" 宏覆盖："},{"type":"element","tag":"pre","props":{"className":"language-vue shiki shiki-themes material-theme-lighter github-light github-dark monokai","code":"<script setup>\ndefinePageMeta({ name: 'user-edit' })\n</script>\n","language":"vue","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"script"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#9C3EDA;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":" setup"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":"definePageMeta"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"{"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" '"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"user-edit"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" }"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"</"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"script"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":">\n"}]}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"生成顺序 & 匹配优先级（关键保证无手写冲突）"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n排序函数大致遵循："},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n① 静态路径长度降序 → ② 动态段个数升序 → ③ catch-all 最后。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n因此先匹配 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/users/create"}]},{"type":"text","value":"，后匹配 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/users/[id]"}]},{"type":"text","value":"，最后 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/*"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"多扩展名支持"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• MDX / Markdown：依赖 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"@nuxt/content"}]},{"type":"text","value":" 模块注册 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"pages-parser"}]},{"type":"text","value":"。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":".ts"}]},{"type":"text","value":" / "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":".jsx"}]},{"type":"text","value":" 文件只要默认导出组件即可。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"与 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"definePageMeta()"}]},{"type":"text","value":" 的关系"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 生成完 route record 后，Nuxt 在运行时将 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"meta"}]},{"type":"text","value":" 合并自页面的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"definePageMeta()"}]},{"type":"text","value":" 输出，如 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"middleware"}]},{"type":"text","value":", "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"layout"}]},{"type":"text","value":", "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"pageTransition"}]},{"type":"text","value":" 等。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 这一步发生于服务端、客户端首次解析路由前。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"自定义/高级场景"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 关闭文件系统路由："},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"router: { autoRoutes: false }"}]},{"type":"text","value":" → 完全手写 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"app/router.options.ts"}]},{"type":"text","value":"。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 滤掉测试文件："},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"routeRules: [{ path: '/**/__tests__/**', skip: true }]"}]},{"type":"text","value":"。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 动态导入懒加载：Nuxt 默认按路由分割生成异步 chunk；可通过 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"definePageMeta({ lazy: true })"}]},{"type":"text","value":" 关闭首屏预加载。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"HMR & 增量更新"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• dev 模式下 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"chokidar"}]},{"type":"text","value":" 监听 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"pages"}]},{"type":"text","value":" 目录，增删改会触发 pages tree diff，只重写 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":".nuxt/pages.mjs"}]},{"type":"text","value":" 并热更新 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"vue-router"}]},{"type":"text","value":" 配置；视图状态保留不刷新。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"SEO / Redirect 辅助"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 配合 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"routeRules"}]},{"type":"text","value":" 在 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nuxt.config"}]},{"type":"text","value":" 做 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"_redirects"}]},{"type":"text","value":"、静态缓存 TTL、edge middleware 等。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 未匹配到的路径自动走 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"error.vue"}]},{"type":"text","value":"，可根据 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"error.statusCode"}]},{"type":"text","value":" 自定义 404/500。"}]}]},{"type":"element","tag":"h4","props":{"id":"路由守卫中间件与-vue-router-4-的区别"},"children":[{"type":"text","value":"路由守卫：中间件与 Vue Router 4 的区别？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Nuxt 的 middleware 能同时跑在服务端和客户端，并带来完整的 Nuxt 上下文与 HTTP 控制；而 Vue Router 4 的导航守卫只是浏览器端的路由钩子，主要解决页面切换逻辑。选型时若应用涉及 SSR/Edge、首屏数据注水或需要设置 HTTP 状态，就应使用 Nuxt Middleware；纯前端 SPA 则使用 Vue Router Guard 即可。"}]},{"type":"element","tag":"h4","props":{"id":"runtimeconfigprocessenvimportmeta-的使用场景"},"children":[{"type":"text","value":"runtimeConfig、process.env、import.meta 的使用场景？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"process.env 适合在「打包阶段」就确定的常量，例如编译开关或第三方库要求的环境标记；import.meta 更多用于单个模块的上下文信息（如动态 import 的 URL、热更新标识等），与框架配置关系不大；而 runtimeConfig 则在「运行阶段」才读取，可按部署环境注入不同值，并通过 public / private 分区保证敏感数据仅留在服务端，因此应把需要随环境切换或包含密钥的配置放进 runtimeConfig，把完全静态且编译期就要用到的变量留给 process.env，至于 import.meta 则仅在需要获取当前模块元数据或进行懒加载计算路径时使用。"}]},{"type":"element","tag":"h3","props":{"id":"渲染机制与数据获取"},"children":[{"type":"text","value":"渲染机制与数据获取"}]},{"type":"element","tag":"h4","props":{"id":"serverprefetch-对比-useasyncdatausefetch"},"children":[{"type":"text","value":"serverPrefetch 对比 useAsyncData/useFetch？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"serverPrefetch 仅在 SSR 首屏渲染时执行一次，把结果注入组件实例后随 HTML 一并下发，适合一次性、静态首屏数据；而 useAsyncData（或 useFetch，HTTP 特化的 useAsyncData） 同样会在 SSR 首次运行，但其返回值具备缓存、响应式和客户端路由切换后自动重刷等能力，可手动 revalidate，因而更适合需要多次调用或动态更新的接口数据。"}]},{"type":"element","tag":"h4","props":{"id":"hydration-mismatch-排查"},"children":[{"type":"text","value":"hydration mismatch 排查？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Hydration 指的是浏览器下载完服务端 HTML 后，客户端 JavaScript 将这份静态标记“注水”成可交互应用的过程；当框架完成所有事件绑定、异步组件加载并开始响应用户操作时，便进入客户端激活阶段。若两端渲染结果出现差异（hydration mismatch），框架会在控制台警告并尝试 DOM 补丁，严重时导致白屏或闪烁。排查重点：①确保首屏数据来源一致——不要在客户端额外修改初始 state；②避免在 SSR 中调用仅浏览器可用的 API（如 window、localStorage）；③保证列表渲染的 key 稳定，时间/随机数/Intl 等需固定输出；④检查条件渲染与环境判断（process.client / process.server）逻辑是否对称；⑤使用 Nuxt 的 devtools“Hydration mismatch”面板或在浏览器 diff 服务端 HTML 与首次客户端渲染的 DOM，定位具体节点，再逐步比对 props 或数据源即可。"}]},{"type":"element","tag":"h4","props":{"id":"useasyncdatausefetchuselazyasyncdata-的差异"},"children":[{"type":"text","value":"useAsyncData、useFetch、useLazyAsyncData 的差异？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"useAsyncData"}]},{"type":"text","value":" 是通用型数据钩子：组件加载时立即执行提供的任意异步函数并把结果做响应式缓存；"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"useFetch"}]},{"type":"text","value":" 在此之上专为 HTTP 请求做了语法糖，自动调用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"$fetch"}]},{"type":"text","value":"、拼接 baseURL、解析响应与状态码，因此写接口时最省事；而 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"useLazyAsyncData"}]},{"type":"text","value":" 仍沿用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"useAsyncData"}]},{"type":"text","value":" 的缓存/响应式机制，但默认“懒执行”，只有当显式调用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"refresh()"}]},{"type":"text","value":" 或组件首次访问 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"data"}]},{"type":"text","value":" 时才真正发起请求，适合非首屏、按需加载场景。"}]},{"type":"element","tag":"h4","props":{"id":"缓存-keydeferdefaulttransform-选项"},"children":[{"type":"text","value":"缓存 key、defer、default、transform 选项？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 Nuxt 的 useAsyncData/useFetch 配置里：cache key 用来给这次请求起唯一 ID，让服务端渲染产生的结果可以在客户端继续复用或跨组件共享；defer 表示把真正的请求推迟到页面已渲染（或满足指定条件）之后执行，避免阻塞首屏；default 是在请求尚未完成或失败时注入的初始值，保证模版渲染时有可用数据，不会出现 undefined 闪烁；transform 则是在拿到原始响应后立刻做一次同步处理（如筛选字段、格式化日期），返回给组件的是 transform 处理后的最终数据，从而把视图层与数据清洗逻辑解耦。"}]},{"type":"element","tag":"h4","props":{"id":"ssg-生成流程-nitro-generateprerender-routespayload-extraction"},"children":[{"type":"text","value":"SSG 生成流程 nitro generate、prerender routes、payload extraction？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"SSG 流程可以一句话概括为“用运行时 SSR 去离线产出静态资源”：执行 ​"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nuxi build && nitro generate"}]},{"type":"text","value":" 时，Nitro 会把项目以 SSR 方式逐一渲染 ​prerender routes​（自动爬取到的和在 ​nitro.prerender.routes​ 中显式声明的路径），将得到的 HTML 与必要的静态资源写入 ​dist/​；同时会把渲染过程中注入页面的初始数据（"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"useAsyncData"}]},{"type":"text","value":"、"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"useFetch"}]},{"type":"text","value":" 等返回的结果）抽取成独立的 JSON 文件，这一步就叫 ​payload extraction​，对应路由最终访问时浏览器先下 HTML，再异步拉这份 payload 做 hydration，从而既保留了首屏秒开的静态站点体验，又能在客户端继续作为 SPA 交互。"}]},{"type":"element","tag":"h4","props":{"id":"incremental-static-regenerationisr原理"},"children":[{"type":"text","value":"incremental static regeneration（ISR）原理？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ISR 的核心实现是“静态文件 + SWR 缓存策略”：构建阶段先把页面渲成 HTML 并写入磁盘（或对象存储），同时在每个页面前插一段 runtime 代码/中间件记录 revalidate 秒数；请求到来时，CDN 直接把已有 HTML 返回给用户，然后在服务器（往往是一个无状态的 serverless 函数）里读取文件的 mtime 与当前时间比较——若已过期就异步执行同一段 SSR 渲染逻辑、生成新的 HTML/JSON，并用原子写（写临时文件再 rename）覆盖旧文件；写完后下一次请求即可命中新文件，从而将“静态首屏 + 后台增量重建”融合在一条代码路径里，无需整站重构。"}]},{"type":"element","tag":"h4","props":{"id":"nuxt-的-seo-思路"},"children":[{"type":"text","value":"Nuxt 的 SEO 思路？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"首先借助 SSR/SSG 在首字节就输出可爬取的语义化 DOM；在页面级别用 useHead / useSeoMeta 动态注入 title、description、Open Graph、Twitter Card 等 meta；利用模块生态（@nuxtjs/sitemap、robots、schema-org）自动生成 sitemap.xml、robots.txt 及 JSON-LD 结构化数据；对长尾页面可用 ​nitro prerender​ 或增量静态重建（ISR）离线产出 HTML，保证首屏速度与爬虫友好；最后结合静态资源指纹和 CDN 缓存策略，既让搜索引擎抓到最新内容，又不牺牲性能，从而系统化提升站点在搜索结果中的可见性与点击率。"}]},{"type":"element","tag":"h4","props":{"id":"nuxt-的首屏优化方法"},"children":[{"type":"text","value":"Nuxt 的首屏优化方法？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"首先构建阶段借 SSR/SSG/Nitro prerender（或 ISR）把页面直接产出静态 HTML + 内嵌关键 CSS，TTFB/LCP 等核心指标先压到底；运行时利用 payload 分离机制把数据以 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"<script type=\"application/json\">"}]},{"type":"text","value":" 注入，浏览器拿到首屏 DOM 后才异步下载并懒加载分割好的 JS chunk，避免阻塞渲染；通过 useHead / useSeoMeta 在同一次 HTML flush 中插入 preload、modulepreload、dns-prefetch 等提示，把字体、首屏图片与首要 chunk 并行拉取；Nitro preset 会自动给静态资源打指纹并生成 route rules，让 CDN 边缘命中 HTML 与 asset，同时按需开启 HTTP 103 Early Hints 把关键资源依赖提到握手阶段；最后配合 nuxt-link 的智能预取和 Suspense/Island 架构，让后续路由与组件只在交互点才加载。"}]},{"type":"element","tag":"h3","props":{"id":"状态管理与组合式-api"},"children":[{"type":"text","value":"状态管理与组合式 API"}]},{"type":"element","tag":"h4","props":{"id":"nuxt-集成-pinia-的-definestorestoretorefsreset-及插件机制"},"children":[{"type":"text","value":"Nuxt 集成 Pinia 的 defineStore、storeToRefs、$reset 及插件机制？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 Nuxt 3 中集成 Pinia 的本质是把 SSR/岛屿架构下的全局响应式状态抽象为“可树摇的模块”，然后通过 Nuxt 的 runtime‐context 注入到每个请求：① "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"defineStore"}]},{"type":"text","value":" 在构建期生成同名 composable，既能被自动导入，又能在服务端为每个 HTTP 请求各开一份独立实例，实现「每次渲染隔离、客户端复用」；② 组件里用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"storeToRefs"}]},{"type":"text","value":" 把 store 的 state/gets 转成 ref，既避免解构失去响应式，也让 TS 类型推断完整保留；③ "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"$reset"}]},{"type":"text","value":" 内置在每个 store 的 prototype，上游只需把初始 state 作为闭包快照存档，即可在任何场景（例如退出登录或切路由）一键回滚到初始值；④ 插件机制则借助 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nuxtApp.pinia.use(plugin)"}]},{"type":"text","value":" 把自定义逻辑（如持久化、日志、授权 header 注入等）挂载到所有 store —— 插件拿到的是同一个 per-request Pinia 实例，因此可以安全访问 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nuxtApp.ssrContext"}]},{"type":"text","value":"、cookies 或 Nitro runtime。在这套设计里，Pinia 的声明式 API 与 Nuxt 的自动注册 / per-request scope 天然契合，既保证了服务器并发安全，又让客户端 hydration 零配置地获得统一、可热更新的状态层。"}]},{"type":"element","tag":"h4","props":{"id":"ssr-下的状态序列化与-hydration"},"children":[{"type":"text","value":"SSR 下的状态序列化与 hydration？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"服务器在渲染 Vue/Nuxt 组件树时，会先跑一遍 data fetching 与 Pinia/Vuex 计算，把得到的 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"最终状态快照"}]},{"type":"text","value":"（对象/Map/Set 等）用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"devalue"}]},{"type":"text","value":" 或同类安全编码器转成可传输的 JSON 字符串；这一串数据被嵌入到返回 HTML 的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"<script id=\"__NUXT_DATA__\" type=\"application/json\">...</script>"}]},{"type":"text","value":"（或 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"window.__INITIAL_STATE__"}]},{"type":"text","value":"）中并做 XSS 转义。浏览器拿到这段已带真实 DOM 的 HTML 后，下载客户端 JS，框架在 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"hydrate()"}]},{"type":"text","value":" 过程中读取这段序列化数据，反序列化填充到 Pinia 实例或组件 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"setup()"}]},{"type":"text","value":" 中的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"useAsyncData"}]},{"type":"text","value":" 缓存，再与服务器生成的 VDOM 做一次 Diff，若完全一致就把事件监听器绑定到现有 DOM——整个页面瞬间拥有交互能力且无需重复绘制。要点是：1) 每个请求都有独立状态，避免数据串流；2) JSON 必须与服务器渲染时的真实状态 bit-wise 对齐，才能避免 hydration mismatch；3) 序列化要防注入（"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"</script>"}]},{"type":"text","value":" 转义）并尽量精简，减少首屏负载。"}]},{"type":"element","tag":"h4","props":{"id":"composables-目录自动导入规则"},"children":[{"type":"text","value":"composables 目录自动导入规则？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"composables 自动导入底层是借助 unplugin-auto-import 在构建期做静态代码改写：Nuxt 会递归扫描 /composables 目录，把每个 *.{ts,js,mjs} 文件（含子目录）登记到一个虚拟模块 #imports；同时根据文件名生成可用标识符——默认去掉扩展名并转成驼峰，例如 useUser.ts → useUser，user/auth.ts → userAuth。随后在解析 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"<script setup>"}]},{"type":"text","value":" 或普通 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"<script>"}]},{"type":"text","value":" 时，若检测到未显式声明的标识符且在 #imports 表内，就即时插入 import { useUser } from '#imports' 等语句；运行时代码与手写 import 毫无区别，因此能被 Vite/rollup 正常 tree-shaking，并享受 TypeScript 类型提示。因为这些 composable 最终仍是 ESM 模块，SSR 每个请求会按 Nuxt 的 per-request module cache 规则各自实例化一次，保证数据隔离。整体效果是在“零显式导入”的同时维持可摇树、类型安全、SSR 隔离三大特性，大幅减少样板代码并提高组合式逻辑的可发现性。"}]},{"type":"element","tag":"h4","props":{"id":"usestate-vs-usecookieusesession-对比"},"children":[{"type":"text","value":"useState vs useCookie、useSession 对比？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"useState 只把值挂在 per-request 的 in-memory cache，SSR 时随渲染周期创建、客户端刷新就失效；useCookie 通过 event.req.headers.cookie ↔ document.cookie 做双向序列化，刷页或多标签页都能共享，受大小（≈4 KB）、SameSite/HttpOnly 等浏览器规则约束；useSession 则把数据写进 Nitro 的 server-side session store（Redis、KV、内存等自选驱动），返回给客户端的只是一把加密 ID，真正数据永远停在服务端，既跨请求持久又避免前端暴露。"}]},{"type":"element","tag":"h4","props":{"id":"跨端共享状态策略"},"children":[{"type":"text","value":"跨端共享状态策略？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Nuxt 3 的跨端共享状态可以理解为在 Nitro HTTP 事件对象 (event) 和前端应用 (nuxtApp) 之间搭起的一条“单向数据隧道”。当请求抵达服务器时，可先在 server middleware / plugin 里读取或写入 event.req.headers.cookie，再把 JWT、CSRF token 等注入到 event.context 或直接用 setCookie(event, ...) 写回；随后渲染流程会把 event 挂进 nuxtApp.ssrContext，Pinia／useState 等 store 初始化时即可透过 useCookie()、useRequestHeaders() 等 API 同步取得这些值。Nitro 在收尾阶段会把 nuxtApp.ssrContext.state 与已设置的响应 Cookie 一并序列化进 HTML 的 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"NUXT"}]},{"type":"text","value":" payload 与 Set-Cookie 头；浏览器收到后先应用 Set-Cookie 让 token 落地，再在 hydration 里用 payload 修补前端的 Pinia/store，保证页面首帧就与服务器保持同一份身份与业务状态。这条“event → nuxtApp → payload → client”链路既完成了安全的服务器注入，也让后续前端读写都落在响应式数据层，而无需额外 API 往返。"}]},{"type":"element","tag":"h3","props":{"id":"插件与中间件"},"children":[{"type":"text","value":"插件与中间件"}]},{"type":"element","tag":"h4","props":{"id":"插件的类型和加载顺序"},"children":[{"type":"text","value":"插件的类型和加载顺序？"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"文件扫描阶段，Nuxt 按 plugins/ 目录下文件名的字母顺序注入插件清单，顺序越靠前就越早被 import，这保证了后面的插件可以安全依赖前面通过 provide() 注入到 nuxtApp 的对象；"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"运行阶段再依据文件后缀的 mode 策略分流——.server 只在 SSR 的 Nitro request-scope 内执行一次；.client 只在浏览器的第一个 hydration tick 执行一次；无后缀（all）会先在服务器执行完（可向 payload 注入预计算数据），随后在客户端再次执行以获得同样的注入结果，形成“同名两次、状态对齐”效果。整体时序可概括为：alphabet sort → server-side import & run → HTML 注入 → client import & run →组件树 access。"}]}]},{"type":"element","tag":"h4","props":{"id":"provideinject-如何在-ssr-可行"},"children":[{"type":"text","value":"provide/inject 如何在 SSR 可行？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"主要依赖每个请求独立创建的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nuxtApp"}]},{"type":"text","value":" 实例——当 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":".server"}]},{"type":"text","value":" 或无后缀（all）插件在 Node 端执行时，当调用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nuxtApp.provide('foo', value)"}]},{"type":"text","value":"，实质是把这份依赖挂载到当前请求范围的应用上下文；随后 Nuxt 在渲染完成前会把 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nuxtApp.payload"}]},{"type":"text","value":"（包含所有由 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"provide"}]},{"type":"text","value":" 注入的序列化安全数据）写入 HTML 的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"__NUXT__"}]},{"type":"text","value":" 对象；浏览器 hydration 时重新创建 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nuxtApp"}]},{"type":"text","value":"，再用这段 payload 做一次“反向补丁”，于是客户端得到同名的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"provide"}]},{"type":"text","value":" 条目并可被 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"inject('foo')"}]},{"type":"text","value":" 即刻消费。因为整个链路基于请求隔离与 payload 回放，既保证了 SSR 期间的并发安全，又确保了注入值在首帧就与服务器一致，无需额外 API 往返；而若插件以 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":".client"}]},{"type":"text","value":" 结尾则只会在浏览器端执行，无法参与这条 SSR 传递流程。"}]},{"type":"element","tag":"h4","props":{"id":"中间件分类"},"children":[{"type":"text","value":"中间件分类？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 Nuxt 3 里，“中间件”可以概括为两大类五小类：① 路由中间件，既跑在 SSR 渲染阶段也跑在浏览器路由跳转时，按执行先后又分为全局文件（/middleware/*.global.ts，站点级守卫）、命名文件（/middleware/auth.ts，在页面/布局通过 definePageMeta({ middleware: 'auth' }) 引用）和匿名声明（直接在页面里 defineNuxtRouteMiddleware()，离业务最近）；② 服务器端中间件，仅在 Nitro 运行时触发，包括路由级（/server/middleware/"},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"，常做代理、日志、鉴权等拦截）与 API 级（/server/api/"}]},{"type":"text","value":"，返回 JSON/流并可串联前后钩子）。一次导航的顺序大致是：Server 端 Global→Named→Anonymous→page.setup()→渲染，Hydration 后浏览器再按同样链路重放。这样的层次让能精确决定逻辑作用域：既要 SSR+CSR 同步的导航守卫放路由中间件，需要纯后端拦截就用 server 中间件。"}]},{"type":"element","tag":"h4","props":{"id":"对比-api-routesevent-handlerserver-middleware"},"children":[{"type":"text","value":"对比 API Routes、Event Handler、server middleware？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"• Server middleware（"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/server/middleware/**"}]},{"type":"text","value":"）按文件路径匹配，最早拦截请求，可在不返回内容的情况下做日志、鉴权、URL 重写等横切逻辑；"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• API Routes（"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/server/api/*.ts"}]},{"type":"text","value":"）是显式暴露的 REST/HTTP 端点，天然返回 JSON/流，底层同样是一个 eventHandler，但框架会帮做参数解析与自动路由；"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• Event Handler（"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"defineEventHandler()"}]},{"type":"text","value":" 或 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"eventHandler()"}]},{"type":"text","value":"）是 Nitro 的原子函数，既可作为 API Route 的实现体，也可在 server middleware 内链式调用，用来截获并改写 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"event.node.req/res"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"h4","props":{"id":"什么是-streaming-和-edge-function-支持"},"children":[{"type":"text","value":"什么是 Streaming 和 Edge Function 支持？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Nitro 把 Nuxt 的服务端 runtime 抽象成零依赖、跨平台的 Lambda 级产物，所以它天然支持："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Streaming——渲染过程可将 HTML/JSON 块分段 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"write"}]},{"type":"text","value":" 给客户端（基于 Web Streams API），首字节可在 TTFB 便到达浏览器，后续组件数据或异步 fetch 结果再“水龙头式”续写，避免阻塞首屏。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Edge Functions——构建产物可直接部署到 Vercel Edge、Cloudflare Workers、Netlify Edge 等 V8 isolate 环境，Nitro 自动注入 polyfill 并生成平台特定入口，把同一份代码无缝移到离用户最近的 PoP，典型 RTT 从几十 ms 降到个位数。"}]}]},{"type":"element","tag":"h4","props":{"id":"什么样的场景适合-edge-function"},"children":[{"type":"text","value":"什么样的场景适合 Edge Function？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"把逻辑搬到 Edge Function 最适合“轻量但对响应时延和全球覆盖极挑剔”的场景：例如首页首屏或动态列表的 HTML-Streaming/ISR，让 POP 就近渲染把 TTFB 压到个位数；按 Geo/IP、Cookie、UA 做 A/B 实验或多语言分流，实现毫秒级个性化；在边缘先行校验 JWT、做速率限制、图片小尺寸转换或 SWR 缓存，直接过滤恶意流量并减轻源站压力；还可以即时重写 URL、生成带签名的下载链接或处理 Webhook 轻量回执。反之，重 CPU/AI 运算、大文件上传或强持久化依赖仍应交给传统 Serverless 或容器。"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"首屏与动态内容加速"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• HTML Streaming SSR：先把骨架串流到浏览器，组件数据再延迟注水，Edge 可把 TTFB 从几十 ms 拆到个位数。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• Edge-Side Rendering/ISR：对全局用户统一的页面可在 POP 内做增量静态化；命中缓存直接 0 ms 返回，回源频率大减。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"个性化与 A/B 实验"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• Geo/IP、UA、Cookie 分流：按国家语言、会员等级实时挑选不同布局或资源，而不必让主服务来决定。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• Feature flag / A/B bucket：在 POP 里注入实验脚本或替换资源，配合持久化 Cookie，毫秒级完成试验分组。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"安全与鉴权"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• JWT / Session 校验：请求先到 Edge 做短算术验证，非法请求直接挡在边缘，节省下游带宽与计算。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 速率限制 / 防爬虫：基于 KV 或 Durable Objects 维护计数器，在第一跳就熔断异常流量。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"智能路由与内容重写"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 动态重定向、Re-write：例如国际站根据 Accept-Language 改写到 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/en/…"}]},{"type":"text","value":"，或在“灰度发布”时按 Header 分流到 canary 集群。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 资源签名校验：为 OSS / S3 鉴权 URL 生成防盗链签名并立即 302。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"边缘缓存与数据预处理"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• Stale-While-Revalidate / SWR 缓存：先返回旧数据再后台回源刷新，使动态 API 拥有近似静态的性能。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 即时图像处理（resize/webp）：把小型 CPU 计算下沉到 PoP，减轻 Origin 压力并缩短链路。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"事件或 webhook Fan-out"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 全球低延迟 WebSocket / SSE 广播：Worker 侧可以快速把消息写入 PUB/SUB 管道。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 处理第三方回调（支付、OAuth）后就近写入队列，保证回执速度。"}]}]},{"type":"element","tag":"h3","props":{"id":"nuxt-nitro-与部署"},"children":[{"type":"text","value":"Nuxt Nitro 与部署"}]},{"type":"element","tag":"h4","props":{"id":"nuxt-生成产物结构解析"},"children":[{"type":"text","value":"Nuxt 生成产物结构解析？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Nuxt 在执行 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nuxi build"}]},{"type":"text","value":" 后会把整站打进 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":".output"}]},{"type":"text","value":"："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"最外层的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":".output/public"}]},{"type":"text","value":" 是纯静态资源，直接丢 CDN；"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"中层的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":".output/dist/server/*"}]},{"type":"text","value":"（新版已简化为 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":".output/server/*"}]},{"type":"text","value":"）是经过 Nitro + Rollup 打包后的 SSR 渲染器与 API 处理器，真正的业务逻辑和 route 分块都在这里；"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"最内层根目录的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"server.mjs"}]},{"type":"text","value":" 只是一个 3 行左右的薄壳（"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"export { default } from './server/index.mjs'"}]},{"type":"text","value":"），负责把不同托管平台期望的“入口文件”指向实际的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"dist/server/index.mjs"}]},{"type":"text","value":"。\n因此：部署到支持 Node 的环境时可以直接 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"node .output/server/index.mjs"}]},{"type":"text","value":"；而把整个 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":".output"}]},{"type":"text","value":" 上传到 Vercel、Netlify、Cloudflare 等平台时，它们只需执行 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"server.mjs"}]},{"type":"text","value":" 就能找到同一份编译后的 Server Bundle——两者内容一致，只是入口路径差异，方便在传统服务器与 Serverless/Edge 之间无缝切换。"}]}]},{"type":"element","tag":"h4","props":{"id":"无服务器部署-cold-start-与-bundle-size-优化"},"children":[{"type":"text","value":"无服务器部署 Cold start 与 bundle size 优化？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"无服务器部署中的冷启动时间几乎由「执行环境初始化 + 包体加载」两部分决定，因此想压缩冷启动就得从 bundle size 下手：首先在 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nuxt.config.ts"}]},{"type":"text","value":" 里开启 Nitro 的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"externals/inline"}]},{"type":"text","value":" 与 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"preset-node"}]},{"type":"text","value":"（或 edge-friendly 的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"preset-vercel"}]},{"type":"text","value":" / "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"preset-cloudflare"}]},{"type":"text","value":"）组合，让核心运行时拆分为最小入口；其次利用 Nuxt 的自动代码分割与 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"definePageMeta(keepalive: false)"}]},{"type":"text","value":" 控制仅按路由动态 import 组件，配合 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"serverAssetsPatterns"}]},{"type":"text","value":" 把大文件移到 CDN；再通过 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"vite build --ssr"}]},{"type":"text","value":" 的 tree-shaking、"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"vite-plugin-compress"}]},{"type":"text","value":" gzip/brotli 和 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"bundleAnalyzer"}]},{"type":"text","value":" 剔除未用依赖，把产物稳定压在 1 MB 以内。这样部署到任意 Serverless/Edge 平台时，初始化只需加载一个轻量 JS 文件即可就绪，冷启动延迟可从数百毫秒降到几十毫秒，同时网络传输与 PoP 缓存命中率也大幅提升。"}]},{"type":"element","tag":"h4","props":{"id":"nuxt-应用的-docker-化与自托管简介"},"children":[{"type":"text","value":"Nuxt 应用的 Docker 化与自托管简介？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在自托管场景下，Nuxt 项目可以用多阶段 Dockerfile 先在 node-alpine 镜像里执行 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"pnpm install --frozen-lockfile --prod=false"}]},{"type":"text","value":"，凭借 PNPM 的 hoisting 把共享依赖集中到 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":".pnpm"}]},{"type":"text","value":" 目录避免层层拷贝，随后 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"pnpm build"}]},{"type":"text","value":" 产出 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":".output"}]},{"type":"text","value":"；接着在极简运行层（如 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"node:20-slim"}]},{"type":"text","value":" 或 distroless）只复制 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":".output"}]},{"type":"text","value":" 和 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"pnpm exec nitro preview"}]},{"type":"text","value":" 所需的 runtime node_modules，把最终镜像压到百 MB 以内并消除编译工具链。构建阶段把 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" 里的静态文件或 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nitro.prerender"}]},{"type":"text","value":" 生成的 HTML 推送到对象存储 / CDN Origin，运行层只负责 SSR API，浏览器请求首屏后剩余静态资源由 CDN Offload，实现动态冷启动 <100 ms、静态命中率 99% 的全球加速。"}]},{"type":"element","tag":"h4","props":{"id":"监控指标的落地"},"children":[{"type":"text","value":"监控指标的落地？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"前端通过插件 ("},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"plugins/sentry.client.ts"}]},{"type":"text","value":") 注入 Sentry / Datadog RUM，捕获 Vue 组件异常与 Web Vitals；服务端借助 Nitro 的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nitro:config"}]},{"type":"text","value":" 钩子和 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"runtimeConfig"}]},{"type":"text","value":" 动态注入 API Key，把新建的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"server/plugins/apm.ts"}]},{"type":"text","value":" 包装 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nitroApp.hooks"}]},{"type":"text","value":"（"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"request"}]},{"type":"text","value":", "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"error"}]},{"type":"text","value":", "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"response"}]},{"type":"text","value":") 将 Trace-ID 贯穿请求链；与此同时在 Vite SSR 打包阶段开启 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"@sentry/vite-plugin"}]},{"type":"text","value":" 生成 Source Map 供后台反解栈信息；生产环境再接入 New Relic/Elastic APM 的 Node SDK 监控 GC、CPU、外部依赖延迟，并将 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"routeRules"}]},{"type":"text","value":" 中的边缘缓存命中率写入自定义指标。这样一来，无论是客户端渲染错误、SSR 冷启动抖动，还是第三方 API 慢查询，都能在统一的仪表盘内以 Trace Waterfall 方式还原，真正实现 Nuxt 应用的全链路可观测。"}]},{"type":"element","tag":"h3","props":{"id":"性能安全与故障排查"},"children":[{"type":"text","value":"性能、安全与故障排查"}]},{"type":"element","tag":"h4","props":{"id":"bundle-拆分解析"},"children":[{"type":"text","value":"Bundle 拆分解析？"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"dynamic import：在页面或组件中写 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"const Chart = defineAsyncComponent(() => import('@/components/Chart.vue'))"}]},{"type":"text","value":"，Rollup 会把 Chart 及其依赖拆成独立 chunk，只有当路由命中才按需下载，首屏 JS 负载可缩到几十 KB。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"vendor / commons chunk：借助 Vite 内置的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"splitVendorChunkPlugin"}]},{"type":"text","value":" 与 Nuxt 的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"app.build.transpile"}]},{"type":"text","value":"，第三方库（Vue、axios 等）被统一抽到 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"vendor.[hash].js"}]},{"type":"text","value":"，而多页共用的业务代码自动聚合到 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"commons.[hash].js"}]},{"type":"text","value":"；浏览器可长 Cache vendor，升级只需重拉变动较小的业务 chunk。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"payload extraction：SSR 时，Nuxt 将 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"useAsyncData"}]},{"type":"text","value":" / "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"useState"}]},{"type":"text","value":" 产生的初始数据序列化为 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"payload.[hash].js"}]},{"type":"text","value":" 并内联 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"<link rel=\"modulepreload\">"}]},{"type":"text","value":"；客户端 Hydrate 时直接读这个文件而非二次请求 API，既避免 RTT，又让数据与视图版本一致。"}]}]},{"type":"element","tag":"h4","props":{"id":"资源优化速览"},"children":[{"type":"text","value":"资源优化速览？"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"@nuxt/image"}]},{"type":"text","value":" 组件会在 SSR 阶段根据容器宽度与 DPR 生成带尺寸和格式参数的 URL，运行时再由 IPX / Cloudinary 等服务动态转码为 AVIF/WebP，并默认懒加载；对首屏 Hero 图则可加 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"preload"}]},{"type":"text","value":" 与 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"sizes=\"100vw\""}]},{"type":"text","value":"，让浏览器抢占式下载且避免 CLS。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"在 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nuxt.config.ts"}]},{"type":"text","value":" 的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"app.head.script"}]},{"type":"text","value":" 或任意组件的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"<script>"}]},{"type":"text","value":" 标签里声明 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"defer"}]},{"type":"text","value":" / "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"async"}]},{"type":"text","value":"，Nuxt 会连同 Vite chunk 自动注入，确保第三方 SDK（如 Analytics）异步执行，Vue hydration 不被阻塞；若脚本需在 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"DOMContentLoaded"}]},{"type":"text","value":" 前执行，可结合 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"inject"}]},{"type":"text","value":" 钩子内联一小段 bootstrap，再把大文件 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"defer"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"通过 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"<link rel=\"preload\">"}]},{"type":"text","value":" 把首屏必需的字体、关键 CSS 与拆分后的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"commons.[hash].js"}]},{"type":"text","value":" 提前拉起，同时用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"<link rel=\"prefetch\">"}]},{"type":"text","value":"、"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"router.prefetchLinks=true"}]},{"type":"text","value":" 预取下一跳路由的动态 chunk，与 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"useAsyncData"}]},{"type":"text","value":" 的 payload 形成“代码+数据”双预热。"}]}]},{"type":"element","tag":"h3","props":{"id":"综合实战-场景题"},"children":[{"type":"text","value":"综合实战 / 场景题"}]},{"type":"element","tag":"h4","props":{"id":"为全球新闻站点选型-ssr-isr-架构考虑-seo缓存成本"},"children":[{"type":"text","value":"为全球新闻站点选型 SSR + ISR 架构，考虑 SEO、缓存、成本？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"以下从“渲染策略 → 缓存模型 → 成本测算”3 个维度，拆解在 Nuxt 3 中为全球新闻站点落地 SSR + ISR 的完整选型思路。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"一、渲染策略：SSR 抢时效，ISR 占高频"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"首次请求（或缓存失效）"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 走 SSR："},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nitro"}]},{"type":"text","value":" 在 Edge Function / λ 中执行，读取最新稿件 API，返回带完整 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"<html>"}]},{"type":"text","value":" 的响应，让搜索引擎立即抓取 → 解决“时效 + SEO”。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 同时在 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"event.waitUntil()"}]},{"type":"text","value":" 中将 HTML + Nuxt Payload 写入边缘 KV / Object Storage，供后续命中。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"后续请求"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 触发 ISR：在 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"routeRules"}]},{"type":"text","value":" 设置 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"isr: { revalidate: 60 }"}]},{"type":"text","value":"（热稿 60 s，冷稿 30 min+）。边缘先返回静态副本，后台异步比较 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"etag"}]},{"type":"text","value":"，若已过期则静默回源重新 SSR 并覆盖缓存，用户永远拿到“(准)最新 + 秒开”的页面。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"On-Demand Revalidate"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 重大更正/突发新闻可在 CMS 发布时调用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/api/revalidate?slug=/2025/07/30/foo"}]},{"type":"text","value":"；"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"defineEventHandler"}]},{"type":"text","value":" 中用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nitro.revalidatePath()"}]},{"type":"text","value":" 即时失效边缘副本，确保分钟级刷新。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"二、缓存模型：三层护航"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"CDN Layer"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"surrogate-control: max-age=0, stale-while-revalidate=300"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"cache-tag: article:{id}"}]},{"type":"text","value":" 方便批量 purge（Cloudflare "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"tag"}]},{"type":"text","value":", Fastly "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"surrogate-key"}]},{"type":"text","value":"）。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Edge KV / R2 / S3"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 存 ISR 产物（HTML + "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"payload.js"}]},{"type":"text","value":"）。"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"cache-control: public, max-age=31536000, immutable"}]},{"type":"text","value":"，真正失效由上层 CDN + Nuxt "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"revalidate"}]},{"type":"text","value":" 决定。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Browser Layer"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 同样利用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"immutable"}]},{"type":"text","value":" 静态资产 + HTTP/3 分片，结合 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"<script type=\"application/json\" id=\"payload\">"}]},{"type":"text","value":" 避免二次 API 拉取。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"三、成本测算：≈纯 SSG 的 1.3–1.5 倍"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"假设全球日 PV 5,000 万，90 % 命中边缘静态："},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• SSR λ 调用：500 万 / 日 × 5 ms ≈ 25 GB-"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"ms"}]},{"type":"text","value":"（Cloudflare D1 或 AWS Lambda@Edge 按请求+时间计费），成本个位数美元。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• KV 存储：页面 200 KB × 2 万 热稿 ≈ 4 GB，成本 < 1 美元/月。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 原生 SSR 集群若全量处理需 4–6 台 4C8G 实例；采用 SSR+ISR 只需 1–2 台作“回源”，边缘高峰全靠静态，实例费节省约 60 %。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"四、Nuxt 实操要点"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"nuxt.config.ts"}]}]},{"type":"element","tag":"pre","props":{"className":"language-ts shiki shiki-themes material-theme-lighter github-light github-dark monokai","code":"export default defineNuxtConfig({\n  routeRules: {\n    '/news/**': { isr: { revalidate: 60 } },   // 热点\n    '/opinion/**': { isr: { revalidate: 1800 } } // 长尾\n  },\n  nitro: {\n    preset: 'cloudflare',           // 或 'aws-lambda'\n    storage: {\n      'cache': { driver: 'cloudflare-kv', binding: 'NEWS_KV' }\n    }\n  }\n})\n","language":"ts","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-light-font-style:italic;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#F92672;--shiki-sepia-font-style:inherit"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-light-font-style:italic;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#F92672;--shiki-sepia-font-style:inherit"},"children":[{"type":"text","value":" default"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":" defineNuxtConfig"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"{\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"  routeRules"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"    '"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"/news/**"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" {"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" isr"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" {"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" revalidate"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#F76D47;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF"},"children":[{"type":"text","value":" 60"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" }"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" },"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit"},"children":[{"type":"text","value":"   // 热点\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"    '"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"/opinion/**"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" {"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" isr"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" {"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" revalidate"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#F76D47;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF"},"children":[{"type":"text","value":" 1800"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" }"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" }"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit"},"children":[{"type":"text","value":" // 长尾\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"  },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"  nitro"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"    preset"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" '"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"cloudflare"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":","}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit"},"children":[{"type":"text","value":"           // 或 'aws-lambda'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"    storage"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"      '"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"cache"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" {"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" driver"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" '"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"cloudflare-kv"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":","}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" binding"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" '"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"NEWS_KV"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"}"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":")\n"}]}]}]}]},{"type":"element","tag":"ol","props":{"start":2},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"SEO 细节"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"<head>"}]},{"type":"text","value":" 仍由 SSR 输出最新 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"<title>"}]},{"type":"text","value":"、"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"<meta property=\"og:*\">"}]},{"type":"text","value":"，保证社交分享预览更新。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 新闻规范化：设置 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"sitemap: { autoLastmod: true, gzip: true }"}]},{"type":"text","value":"，并用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"x-robots-tag: noindex"}]},{"type":"text","value":" 避免旧 URL 重复。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"安全 & 完整性"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• HTML 缓存前通过 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"transformHtml"}]},{"type":"text","value":" 钩子注入 nonce-based CSP，防边缘篡改。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 对 KV 写入加 SHA-256 摘要；Edge 取出时校验，避免脏数据回注 CDN。"}]}]},{"type":"element","tag":"h4","props":{"id":"生产环境出现-hydration-mismatch如何快速定位"},"children":[{"type":"text","value":"生产环境出现 hydration mismatch，如何快速定位？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"要在线上（已压缩、已 CDN 化、不可断点调试）的 Nuxt 3 站点里“秒级”定位 hydration mismatch，可以按下面 5 步建立一条从告警 → 复现 → 精确 diff → 代码回溯的排查流水线。整套方法兼顾了生产环境的可观测性、边缘缓存、以及 Nuxt SSR/CSR 双栈特性，前端专家可以直接落地。"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"先让问题“可见”——在生产也打出精准告警"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 在 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"app.config.ts"}]},{"type":"text","value":" 中打开框架原生的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"experimental.payloadExtraction"}]},{"type":"text","value":" 并给 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"vue"}]},{"type":"text","value":" runtime 打补丁："}]}]},{"type":"element","tag":"pre","props":{"className":"language-ts shiki shiki-themes material-theme-lighter github-light github-dark monokai","code":"if (process.client && !import.meta.dev) {\n  const _hydrate = window.__NUXT__.config.hydrateErrorHandler\n  window.__NUXT__.config.hydrateErrorHandler = (err, vnode) => {\n    console.error('[HYDRATE]', vnode?.type?.name, err)\n    // 上报到 Sentry / Datadog，自带 vnode key + route.fullPath\n    _hydrate?.(err, vnode)\n  }\n}\n","language":"ts","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-light-font-style:italic;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#F92672;--shiki-sepia-font-style:inherit"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" (process"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"client "}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"&&"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672"},"children":[{"type":"text","value":" !"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-light-font-style:italic;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#F92672;--shiki-sepia-font-style:inherit"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"meta"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"dev) "}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"{\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#9C3EDA;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic"},"children":[{"type":"text","value":"  const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" _hydrate"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" window"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"__NUXT__"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"config"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"hydrateErrorHandler\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"  window"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"__NUXT__"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"config"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":"hydrateErrorHandler"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#E36209;--shiki-default-font-style:inherit;--shiki-dark:#FFAB70;--shiki-dark-font-style:inherit;--shiki-sepia:#FD971F;--shiki-sepia-font-style:italic"},"children":[{"type":"text","value":"err"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":","}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#E36209;--shiki-default-font-style:inherit;--shiki-dark:#FFAB70;--shiki-dark-font-style:inherit;--shiki-sepia:#FD971F;--shiki-sepia-font-style:italic"},"children":[{"type":"text","value":" vnode"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":")"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#9C3EDA;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic"},"children":[{"type":"text","value":" =>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"    console"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":"error"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"[HYDRATE]"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":","}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" vnode"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"?."}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"?."}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":","}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" err"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit"},"children":[{"type":"text","value":"    // 上报到 Sentry / Datadog，自带 vnode key + route.fullPath\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":"    _hydrate"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"?."}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"err"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":","}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" vnode"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"• 这样一旦出现 mismatch，Sentry Issue 会带："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"组件名"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"错误栈（client）"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"当时的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"route.fullPath"}]},{"type":"text","value":" & query，方便回放。"}]}]},{"type":"element","tag":"ol","props":{"start":2},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"把“失配 HTML”一并抓取，便于离线 diff"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 在 Nitro "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"onBeforeResponse"}]},{"type":"text","value":" 钩子里，如果检测到请求头有 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"x-dump-html: 1"}]},{"type":"text","value":"，就在响应头里回传 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"x-html-digest: <sha1>"}]},{"type":"text","value":" 并把完整 HTML 追加到对象存储（R2/S3）。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• Sentry 里捕获到 hydration mismatch 后，用同一个 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"sha1"}]},{"type":"text","value":" 去拉这份 SSR HTML；浏览器端则可通过 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"document.documentElement.outerHTML"}]},{"type":"text","value":" 拿到 CSR 结果。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"做自动化 DOM Diff，快速锁定“哪一块”错"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 使用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"diffDOM"}]},{"type":"text","value":"（或自研简单比较脚本）在 CI 里把两份 HTML 做节点对比："}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"元数据不一致，经常是 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"meta"}]},{"type":"text","value":", "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"title"}]},{"type":"text","value":", "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"link"}]},{"type":"text","value":" → 大概率由 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"useHead"}]},{"type":"text","value":" 里写 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"process.client"}]},{"type":"text","value":" 条件导致。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"动态列表顺序 / 长度不一致，聚焦 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":":key"}]},{"type":"text","value":" 或数据源不一致。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"文本节点不同，通常是时区 / locale / random ID。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 把 diff 结果写到 GitHub PR Check，开发看到红标直接修。"}]}]},{"type":"element","tag":"ol","props":{"start":4},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"本地复现：锁精确版本 + seed"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 线上 snapshot 往往是带缓存的。用上一步 HTML + "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"window.__NUXT__.payload"}]},{"type":"text","value":" 生成 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":".har"}]},{"type":"text","value":" 文件，Chrome DevTools → Network → Import，完美复现线上首屏。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n• 同时把服务器渲染用的 API 响应在 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"msw"}]},{"type":"text","value":" 里 mock 住，本地 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nuxt dev --modern"}]},{"type":"text","value":" 直连假接口即可。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"常见根因定位思路（对照 checklist 一扫）"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n① 初始状态不一致"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Vue composable 在 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"onMounted"}]},{"type":"text","value":" 里 setState 但 SSR 已同步写过一次。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"确认所有 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"useState('foo', () => …)"}]},{"type":"text","value":" 给定稳定的默认值，不要依赖浏览器环境变量。"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"② 浏览器专属 API 泄漏到 SSR"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"搜索全仓库 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"process.client ?"}]},{"type":"text","value":"、"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"window."}]},{"type":"text","value":"。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"建议装 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"eslint-plugin-nuxt/no-env-in-setup"}]},{"type":"text","value":"，在 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"<script setup>"}]},{"type":"text","value":" 中使用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"window"}]},{"type":"text","value":" 直接报错。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"③ 不稳定 key / 索引 key"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"强制 rule："},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"v-for"}]},{"type":"text","value":" 的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":":key"}]},{"type":"text","value":" 只能用业务主键或 slug。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"eslint-plugin-vue 提供 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"require-v-for-key"}]},{"type":"text","value":"."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"④ 条件渲染分岔"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"任何 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"if (import.meta.client)"}]},{"type":"text","value":" 或 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"lazy show"}]},{"type":"text","value":" 行为，都要在 SSR 也输出相同占位，否则节点层级错位。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"可用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"<ClientOnly>"}]},{"type":"text","value":" 包裹纯浏览器组件，让 SSR 输出注释占位符。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"加分：把“供排查的 meta 数据”直接注入 DOM"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n在 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"app.vue"}]},{"type":"text","value":" 的根节点加："}]},{"type":"element","tag":"pre","props":{"className":"language-vue shiki shiki-themes material-theme-lighter github-light github-dark monokai","code":"<template>\n  <NuxtPage\n    :data-debug=\"import.meta.dev ? null : JSON.stringify({\n      build: process.env.NUXT_BUILD_ID,\n      tz: Intl.DateTimeFormat().resolvedOptions().timeZone,\n      locale: useI18n().locale.value\n    })\"\n/>\n</template>\n","language":"vue","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"template"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"  <"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"NuxtPage\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#9C3EDA;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":"    :data-debug"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"import.meta.dev ? null : JSON.stringify({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"      build: process.env.NUXT_BUILD_ID,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"      tz: Intl.DateTimeFormat().resolvedOptions().timeZone,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"      locale: useI18n().locale.value\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"    })"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"/>\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"</"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"template"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":">\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"出错时只需右键“查看元素”即可看到渲染侧使用的 build 号、时区、语言等信息，再结合 Sentry Breadcrumb，一步还原现场。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"总结："}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"生产监控：拦截 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"hydrateErrorHandler"}]},{"type":"text","value":" + Sentry → 立即告警。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"取证：后台存 SSR HTML，前台 dump CSR HTML → 自动化 diff。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"复现：HAR + MSW 锁接口。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Checklist：状态、浏览器 API、key、条件渲染四板斧。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"通过上述链路，即使线上复杂环境（CDN、Edge、异步数据）导致的 hydration mismatch，也能在分钟级确定“是哪一个组件、哪一种数据不一致”，把排查从“靠猜”变成“有据可循的机械化流程”。"}]},{"type":"element","tag":"h4","props":{"id":"lighthouse-cls-偏高nuxt-项目需要怎样优化"},"children":[{"type":"text","value":"Lighthouse CLS 偏高，Nuxt 项目需要怎样优化？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"CLS 偏高通常是“首屏元素尺寸不确定 + 资源加载时机不当”导致的可视区重排；在 Nuxt 项目中，可通过以下组合拳快速压低分数：首先，用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"<nuxt-img>"}]},{"type":"text","value":" 或 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"<img fetchpriority=\"high\">"}]},{"type":"text","value":" 并显式写 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"width"}]},{"type":"text","value":"/"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"height"}]},{"type":"text","value":"，同时在 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nuxt.config.ts"}]},{"type":"text","value":" 开启 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"image.sizes"}]},{"type":"text","value":" 自动填充，确保图片占位；其次，在 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"<head>"}]},{"type":"text","value":" 里 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"rel=\"preload\""}]},{"type":"text","value":" 关键 Web 字体并用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"font-display: optional"}]},{"type":"text","value":"，避免 FOUT/FOUT 引起文本跳动；第三，给组件骨架（Skeleton / Placeholder）设置与真实内容等高等宽的 CSS，配合 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"v-if=\"process.client\""}]},{"type":"text","value":" 延迟仅浏览器绘制的动画；第四，关闭或延后执行会异步注入 DOM 的第三方脚本（广告、A/B Testing），必要时放进 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"<ClientOnly>"}]},{"type":"text","value":" 并加 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"requestIdleCallback"}]},{"type":"text","value":"；最后，启用 Nuxt 3 的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"experimental.payloadExtraction"}]},{"type":"text","value":" 与 HTTP/2 Push，可让关键样式与 HTML 同步送达，减少回流窗口。"}]},{"type":"element","tag":"h4","props":{"id":"如何在-ssr-api-中安全地读取第三方密钥并下发前端"},"children":[{"type":"text","value":"如何在 SSR API 中安全地读取第三方密钥并下发前端？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 Nuxt 的 SSR API 中，正确做法是把第三方密钥仅存在服务器可见的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"runtimeConfig.private"}]},{"type":"text","value":"（通过环境变量注入），在 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"defineEventHandler"}]},{"type":"text","value":" 里读取后直接调用第三方接口或生成签名，再把“经过服务端加工的结果”——如短时签名 URL、掩码字段或业务数据——返回给前端，而绝不把原始密钥写入响应或 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"window.__NUXT__"}]},{"type":"text","value":" payload；如果前端必须拿到令牌，可改为在服务器端临时颁发一次性 Token（附失效时间）或以 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Set-Cookie; HttpOnly; Secure"}]},{"type":"text","value":" 下发，这样既保持了客户端可用性，又确保密钥始终留在服务器内存，避免任何静态打包、日志或浏览器泄露风险。"}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"知识大纲","depth":2,"text":"知识大纲"},{"id":"问题分类","depth":2,"text":"问题分类","children":[{"id":"基础与核心概念","depth":3,"text":"基础与核心概念"},{"id":"渲染机制与数据获取","depth":3,"text":"渲染机制与数据获取"},{"id":"状态管理与组合式-api","depth":3,"text":"状态管理与组合式 API"},{"id":"插件与中间件","depth":3,"text":"插件与中间件"},{"id":"nuxt-nitro-与部署","depth":3,"text":"Nuxt Nitro 与部署"},{"id":"性能安全与故障排查","depth":3,"text":"性能、安全与故障排查"},{"id":"综合实战-场景题","depth":3,"text":"综合实战 / 场景题"}]}]}},"_type":"markdown","_id":"content:6.maps:_interview:_frontend:nuxt.md","_source":"content","_file":"6.maps/_interview/_frontend/nuxt.md","_stem":"6.maps/_interview/_frontend/nuxt","_extension":"md"}