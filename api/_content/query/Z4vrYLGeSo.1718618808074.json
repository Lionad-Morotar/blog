{"_path":"/gists/kubernetes","_dir":"gists","_draft":false,"_partial":false,"_locale":"","title":"Kubernetes","description":"Kubernetes，K8s，是一个基于容器的集群管理平台，主要用于控制容器","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"kubernetes"},"children":[{"type":"text","value":"Kubernetes"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Kubernetes，K8s，是一个基于容器的集群管理平台，主要用于控制容器"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"可集群：容器的移动或删除，服务对外暴露的静态 IP 不变"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"扩缩容：根据资源负载，自动调整容器副本数"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"自修复：自动重启容器，或选择新的工作节点"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"零或限制：通过亲缘性控制容器运行在指定机器"}]}]},{"type":"element","tag":"h2","props":{"id":"整体架构"},"children":[{"type":"text","value":"整体架构"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"一个 K8s 系统，常常包括一个 Master 节点，用于管理和控制多个 Node 计算节点。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Master 节点大体包括："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"API Server：系统对外接口，比如用于处理外部的命令行交互"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Scheduler：调度器，用于分配 Pod"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Controller Manager：控制器，跟踪节点状态，复制 Pod"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://zhuanlan.zhihu.com/p/96428375","rel":["nofollow"]},"children":[{"type":"text","value":"ETCD"}]},{"type":"text","value":"：分布式数据存储，存集群配置文件；可用于服务发现（保证一个集群中的不同进程可以互相找到并建立链接），并通过 Raft 协议使各个节点的状态保持一致。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Node 节点由许多的 Pod 组成，每一个 Pod 都是集群中的一个进程。Node 通过以下几个组件管理 Pod："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Docker：容器运行时，用于拉取、创建、启动镜像"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Kubelet：用于中转 API Server 和 Docker 的交互行为，以进行 Pod 的创建、删除、修改、监控"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Kube-proxy：用于 Pod 的代理（？）"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Fluentd：用于日志收集、储存和查询"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Service：一组相同功能的 Pod 可以通过 Service 提供对外的接口"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Pod 写入磁盘的数据可能随时会丢失，它自身也随时可能被重启，如内存耗尽，进程崩溃，或存活指针返回失败。Pod 重启的时间以指数时间避退，直到满 5 分钟。"}]},{"type":"element","tag":"h2","props":{"id":"常用子指令"},"children":[{"type":"text","value":"常用子指令"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Apply：从配置文件更新对象，如 kubectl apply -f x.yaml；"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Delete：删除对象，如 kubectl delete deploy x；"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Describe：获取对象信息，如 kubectl describe pod x；"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Exec：执行容器的指令，如 kubectl exec -it pod x bash；"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Get：获取对象状态，如 kubectl get pods（获取所有 pods 状态）、kubectl get svc（获取所有服务及其状态，如端口和所在集群 IP）；"}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"整体架构","depth":2,"text":"整体架构"},{"id":"常用子指令","depth":2,"text":"常用子指令"}]}},"_type":"markdown","_id":"content:7.gists:kubernetes.md","_source":"content","_file":"7.gists/kubernetes.md","_extension":"md"}