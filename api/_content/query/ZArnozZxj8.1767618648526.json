{"_path":"/maps/_devops/git/pre-commit-hook","_dir":"git","_draft":false,"_partial":true,"_locale":"","title":"Pre Commit Hook","description":"title: 预提交钩子（Pre-commit hooks）\ndescription: Git 的 pre-commit hook 用来在提交代码前执行一些检查或操作","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"title: 预提交钩子（Pre-commit hooks）\ndescription: Git 的 pre-commit hook 用来在提交代码前执行一些检查或操作"}]},{"type":"element","tag":"h2","props":{"id":"brief"},"children":[{"type":"text","value":"Brief"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Git 钩子已经存在很久了，但我们认为它们依然没有被充分利用。随着 AI 辅助与智能体式编程（agentic coding）的兴起，意外提交密钥或有问题的代码的风险正在增加。虽然已有很多代码校验机制（比如持续集成 CI），但预提交钩子是一种简单而有效的安全防线，值得更多团队采用。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"不过，如果在钩子中塞入大量运行缓慢的检查，会让开发者不愿意使用它们。因此，最好保持预提交钩子“精简”和“聚焦”，只做那些在工作流的这一阶段最适合发现的高价值风险，比如密钥扫描（secret scanning）。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"来源：技术雷达"}]},{"type":"element","tag":"h2","props":{"id":"guide"},"children":[{"type":"text","value":"Guide"}]},{"type":"element","tag":"h3","props":{"id":"一为什么预提交钩子在-ai-时代更重要"},"children":[{"type":"text","value":"一、为什么预提交钩子在 AI 时代更重要？"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"AI 生成代码的“过度自信”问题"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nAI 工具（包括智能体型 Coding Agent）能快速生成大量代码、配置和脚本，其中可能包含："},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"硬编码的访问密钥、Token、密码"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"临时调试代码（如关闭鉴权、跳过校验）"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"不符合团队规范的接口调用或依赖"}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"在高速度迭代下，开发者很容易“复制-粘贴-提交”，预提交钩子相当于最后一道“本地闸门”。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"补充而不是替代 CI / 代码审查"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"CI 更适合：完整测试、构建、静态分析、复杂安全扫描。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Pre-commit 更适合："},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"极快速、与“变更内容”强绑定"}]},{"type":"text","value":"的检查。"}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"换句话说，预提交钩子是“低成本、即时反馈”；CI 是“高覆盖、稍延时反馈”。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"把错误截断在最便宜的阶段"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n错误在不同阶段被发现的成本呈指数上升：\n$$本地开发 < pre-commit < PR 代码审查 < CI < 生产环境$$"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n预提交钩子的目标就是："},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"在提交之前阻止显而易见的错误泄漏到后续环节"}]},{"type":"text","value":"。"}]}]},{"type":"element","tag":"h3","props":{"id":"二预提交钩子适合放哪些检查"},"children":[{"type":"text","value":"二、预提交钩子适合放哪些检查？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"原则："},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"秒级完成、直接作用于当前变更、价值高于打扰成本"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"密钥 / 凭证扫描（强烈推荐）"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"检查是否存在：\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"类似 $$AWS_SECRET_ACCESS_KEY$$、$$GITHUB_TOKEN$$ 等特征字符串"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"私钥文件：$$*.pem$$、$$*.key$$"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"高熵字符串（疑似随机生成的密钥）"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"可使用的工具：\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"git-secrets"}]},{"type":"text","value":"、"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"gitleaks"}]},{"type":"text","value":"、"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"trufflehog"}]},{"type":"text","value":" 等"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"策略：\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"提交前一旦发现疑似密钥，"},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"直接拒绝提交并给出清理建议"}]},{"type":"text","value":"。"}]}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"基础格式化与简单静态检查"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n目的不是“找出一切问题”，而是："},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"自动修正能自动修的（格式化、简单 lint）"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"减少 PR 上来回评论“多了个空格”这类低价值沟通"}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"例如："},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"自动格式化："},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"prettier"}]},{"type":"text","value":"、"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"black"}]},{"type":"text","value":"、"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"gofmt"}]},{"type":"text","value":" 等"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"关键的快速 Lint：例如只对变更文件执行 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"eslint --max-warnings=0"}]},{"type":"text","value":"（简单规则集）"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"禁止明显危险的文件 / 内容进入仓库"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"阻止：\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"大体积二进制文件（超过某阈值）"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"临时文件："},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"*.log"}]},{"type":"text","value":"、"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":".DS_Store"}]},{"type":"text","value":" 等"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"生成产物："},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"dist/"}]},{"type":"text","value":"、"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"build/"}]},{"type":"text","value":" 等"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"好处：控制仓库体积，避免把可再生成的内容纳入版本控制。"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"基础安全与合规性检查（轻量版）"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"示例：\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"在特定目录下禁止出现 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"eval"}]},{"type":"text","value":"、"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"exec"}]},{"type":"text","value":"（例如在用户输入可达路径）"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"禁止导入不允许使用的库（比如内部安全策略禁止的 HTTP 客户端）"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"要求：匹配规则简洁，运行极快（文本扫描级别，不要做复杂 AST 分析）。"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"三预提交钩子不适合放什么"},"children":[{"type":"text","value":"三、预提交钩子"},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"不适合"}]},{"type":"text","value":"放什么？"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"运行时间超过 5–10 秒的大型检查"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"例如：完整测试套件、全量 SAST、复杂依赖漏洞扫描等。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"放在 CI / CD 阶段更合理，否则开发者会想办法绕过 pre-commit（如 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"--no-verify"}]},{"type":"text","value":"）。"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"高误报、频繁中断开发流的规则"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"若触发率过高、规则解释不清晰，会引发：\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"团队抵触"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"滥用跳过选项、局部关闭规则"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"设计时要有“用户体验”意识："},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"每次打断都要值得"}]},{"type":"text","value":"。"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"与仓库无关或团队共识不足的强制规范"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"例如在项目里强制执行某些高度个人化的风格（无共识），容易引起反感。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"建议：与团队讨论达成共识后再固化到 pre-commit。"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"四如何设计一个精简而高效的-pre-commit-策略"},"children":[{"type":"text","value":"四、如何设计一个“精简而高效”的 pre-commit 策略？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"可以遵循一个三层分工模型："}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"本地 pre-commit：只做高速、高价值的检查"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"密钥 / 凭证扫描"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"格式化 + 基础 lint"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"阻止大文件、临时文件"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"CI 上的“变更集”检查"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"对 PR 改动文件做更深入的：\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"静态分析（更完整规则集）"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"单元测试 / 快速集成测试"}]}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Nightly / 定期全仓库扫描"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"完整安全扫描、许可证合规、依赖漏洞、全量代码质量评估等。"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"这样一来："},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n$$开发体验良好 \\ \\cap \\ 安全与质量门槛稳定提升$$"}]},{"type":"element","tag":"h3","props":{"id":"五示例使用-pre-commit-框架快速落地"},"children":[{"type":"text","value":"五、示例：使用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"pre-commit"}]},{"type":"text","value":" 框架快速落地"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"对多语言项目，可以使用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"pre-commit"}]},{"type":"text","value":"（Python 社区的那个工具），支持集中管理 Git 钩子。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"示例配置："}]},{"type":"text","value":" 在仓库根目录创建 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":".pre-commit-config.yaml"}]},{"type":"text","value":"："}]},{"type":"element","tag":"pre","props":{"className":"language-yaml shiki shiki-themes material-theme-lighter github-light github-dark monokai","code":"repos:\n  # 1. 清理无用空白、修正行尾换行等\n  - repo: https://github.com/pre-commit/pre-commit-hooks\n    rev: v4.6.0\n    hooks:\n      - id: trailing-whitespace\n      - id: end-of-file-fixer\n      - id: check-added-large-files   # 阈值可配置\n\n  # 2. 密钥扫描（示例使用 gitleaks）\n  - repo: https://github.com/gitleaks/gitleaks\n    rev: v8.18.0\n    hooks:\n      - id: gitleaks\n\n  # 3. 示例：对 JS/TS 使用 prettier 自动格式化\n  - repo: https://github.com/pre-commit/mirrors-prettier\n    rev: v4.0.0-alpha.8\n    hooks:\n      - id: prettier\n        files: \"\\\\.(js|jsx|ts|tsx|json|css|md)$\"\n","language":"yaml","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"repos"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit"},"children":[{"type":"text","value":"  # 1. 清理无用空白、修正行尾换行等\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"  -"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":" repo"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" https://github.com/pre-commit/pre-commit-hooks\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"    rev"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" v4.6.0\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"    hooks"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"      -"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":" id"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" trailing-whitespace\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"      -"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":" id"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" end-of-file-fixer\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"      -"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":" id"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" check-added-large-files"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit"},"children":[{"type":"text","value":"   # 阈值可配置\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit"},"children":[{"type":"text","value":"  # 2. 密钥扫描（示例使用 gitleaks）\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"  -"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":" repo"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" https://github.com/gitleaks/gitleaks\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"    rev"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" v8.18.0\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"    hooks"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"      -"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":" id"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" gitleaks\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit"},"children":[{"type":"text","value":"  # 3. 示例：对 JS/TS 使用 prettier 自动格式化\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"  -"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":" repo"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" https://github.com/pre-commit/mirrors-prettier\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"    rev"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" v4.0.0-alpha.8\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"    hooks"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"      -"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":" id"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" prettier\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"        files"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" \""}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF"},"children":[{"type":"text","value":"\\\\"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":".(js|jsx|ts|tsx|json|css|md)$"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"\"\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"安装并启用："}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes material-theme-lighter github-light github-dark monokai","code":"pip install pre-commit\npre-commit install   # 在 .git/hooks 配置 pre-commit\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#E2931D;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":"pip"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" install"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" pre-commit\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#E2931D;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":"pre-commit"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" install"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit"},"children":[{"type":"text","value":"   # 在 .git/hooks 配置 pre-commit\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"之后每次 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"git commit"}]},{"type":"text","value":"，这些检查都会在本地自动运行。"}]},{"type":"element","tag":"h3","props":{"id":"六团队落地与推广建议"},"children":[{"type":"text","value":"六、团队落地与推广建议"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"从最小可用集合开始"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"第一步只上：密钥扫描 + 基础格式化 + 大文件检查"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"观察一段时间后，根据反馈逐步添加其他规则。"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"给开发者提供“快速修复指引”"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"不只是报错信息，更要告诉开发者：\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"问题是什么？"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"如何一条命令修复（例如："},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"npm run lint-fix"}]},{"type":"text","value":"、"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"prettier --write ..."}]},{"type":"text","value":"）"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"若是疑似密钥，提示使用环境变量 / 密钥管理服务并从历史中清理。"}]}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"建立“允许临时跳过，但要留痕”的机制"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"比如约定：\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"只有在特殊情况下允许 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"git commit --no-verify"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"在 PR 描述中写明原因"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"这样在保持灵活性的同时，降低滥用风险。"}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"将 pre-commit 规则视为“团队契约”"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"不要个人随意修改；"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"通过 PR 调整，团队评审后合入，保证所有人理解这些检查的价值。"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"总结"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"预提交钩子是 AI 时代防止意外提交密钥、危险代码的一道“本地防线”。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"关键在于："},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"轻量、高频、高价值"}]},{"type":"text","value":"，而不是“把所有检查都塞进去”。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"推荐至少启用："},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n1）密钥 / 凭证扫描"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n2）基础格式化 & 简单 lint"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n3）阻止大文件、临时文件、生成产物进入仓库"}]}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"brief","depth":2,"text":"Brief"},{"id":"guide","depth":2,"text":"Guide","children":[{"id":"一为什么预提交钩子在-ai-时代更重要","depth":3,"text":"一、为什么预提交钩子在 AI 时代更重要？"},{"id":"二预提交钩子适合放哪些检查","depth":3,"text":"二、预提交钩子适合放哪些检查？"},{"id":"三预提交钩子不适合放什么","depth":3,"text":"三、预提交钩子不适合放什么？"},{"id":"四如何设计一个精简而高效的-pre-commit-策略","depth":3,"text":"四、如何设计一个“精简而高效”的 pre-commit 策略？"},{"id":"五示例使用-pre-commit-框架快速落地","depth":3,"text":"五、示例：使用 pre-commit 框架快速落地"},{"id":"六团队落地与推广建议","depth":3,"text":"六、团队落地与推广建议"}]}]}},"_type":"markdown","_id":"content:6.maps:_devops:git:pre-commit-hook.md","_source":"content","_file":"6.maps/_devops/git/pre-commit-hook.md","_stem":"6.maps/_devops/git/pre-commit-hook","_extension":"md"}