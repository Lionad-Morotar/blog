{"_path":"/maps/_web/performance","_dir":"_web","_draft":false,"_partial":true,"_locale":"","title":"页面性能","description":"","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"页面性能"},"children":[{"type":"text","value":"页面性能"}]},{"type":"element","tag":"h2","props":{"id":"指标与模型"},"children":[{"type":"text","value":"指标与模型"}]},{"type":"element","tag":"h4","props":{"id":"网页性能的上下游"},"children":[{"type":"text","value":"网页性能的上下游？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"选定合适的 API 收集数据，进行简单预处理后，通过 SDK 上报到后端或者云服务。为了展示收集到的数据，可以设置 99 线等图表，在某些特定的业务场景，还可以设置 A/B 图和告警。"}]},{"type":"element","tag":"h4","props":{"id":"性能指标和性能模型的不同"},"children":[{"type":"text","value":"性能指标和性能模型的不同？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"两个立场不同，性能指标如 Navigation Timing 使用绝对的量来衡量页面各项性能参数，性能模型如 Web Vitals 使用算法定性分析页面加载时的用户体验。"}]},{"type":"element","tag":"h4","props":{"id":"为什么需要性能模型"},"children":[{"type":"text","value":"为什么需要性能模型？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"用户体验很难用具体或者绝对的量来衡定，比如说在渐进式加载中，只对比白屏时间和 onload 时间只能说明用户提早看到了内容，却不能说明渐进式加载好在哪里，好了多少。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"页面渐进式加载示例","src":"https://mgear-image.oss-cn-shanghai.aliyuncs.com/image/other/progressive-rendering.png"},"children":[]}]},{"type":"element","tag":"h4","props":{"id":"合成监控和真实用户监控是什么"},"children":[{"type":"text","value":"合成监控和真实用户监控是什么？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"从技术上来说，可以把监控分为合成监控（Synthetic Monitoring，SYN）和真实用户监控（Real User Monitoring，RUM）。合成监控是在一个模拟的场景中，使用 Lighthouse 等工具，提取出性能指标并获得审计报告。真实用户监控是在真实用户访问时，通过数据源获取数据，再上报到日志服务器，以用来展示和分析这么一流程。"}]},{"type":"element","tag":"h4","props":{"id":"web-vitals-有哪些指标"},"children":[{"type":"text","value":"Web Vitals 有哪些指标？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Web Vitals 关注 "},{"type":"element","tag":"abbr","props":{"title":"Largest Contentful Paint"},"children":[{"type":"text","value":"LCP"}]},{"type":"text","value":"、"},{"type":"element","tag":"abbr","props":{"title":"First Input Delay"},"children":[{"type":"text","value":"FID"}]},{"type":"text","value":"、"},{"type":"element","tag":"abbr","props":{"title":"Cumulative Layout Shift"},"children":[{"type":"text","value":"CLS"}]},{"type":"text","value":" 的测量，分别描述最大内容渲染时间评分、页面可交互时间评分和布局偏移评分。"}]},{"type":"element","tag":"div","props":{"style":"display:flex; justify-content:space-evenly;"},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"img","props":{"src":"https://mgear-image.oss-cn-shanghai.aliyuncs.com/image/other/lcp_ux.svg","width":"33%","alt":"Largest Contentful Paint threshold recommendations"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tag":"img","props":{"src":"https://mgear-image.oss-cn-shanghai.aliyuncs.com/image/other/fid_ux.svg","width":"33%","alt":"First Input Delay threshold recommendations"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tag":"img","props":{"src":"https://mgear-image.oss-cn-shanghai.aliyuncs.com/image/other/cls_ux.svg","width":"33%","alt":"Cumulative Layout Shift threshold recommendations"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"见："},{"type":"element","tag":"a","props":{"href":"https://github.com/GoogleChrome/web-vitals","rel":["nofollow"]},"children":[{"type":"text","value":"Web Vitals"}]}]},{"type":"element","tag":"h4","props":{"id":"有哪些开发工具"},"children":[{"type":"text","value":"有哪些开发工具？"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/GoogleChrome/web-vitals","rel":["nofollow"]},"children":[{"type":"text","value":"Web Vitals"}]},{"type":"text","value":"，获取 Web Vitals 评分。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/cssmagic/simple-web-perf","rel":["nofollow"]},"children":[{"type":"text","value":"simple-web-perf"}]},{"type":"text","value":"，Navigation Timing 数据上报封装。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/Lionad-Morotar/webpack-lighthouse-plugin","rel":["nofollow"]},"children":[{"type":"text","value":"webpack-lighthouse-plugin"}]},{"type":"text","value":"，在打包结束后自动运行 Lighthouse 并输出报告。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/cloudfour/lighthouse-parade","rel":["nofollow"]},"children":[{"type":"text","value":"lighthouse-parade"}]},{"type":"text","value":"，递归抓取页面并评分，输出关于网站的完整报告。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"webpack-lighthouse-plugin","src":"https://github.com/Lionad-Morotar/webpack-lighthouse-plugin/blob/main/assets/example.gif?raw=true"},"children":[]}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://developer.mozilla.org/zh-CN/docs/Web/Performance","rel":["nofollow"]},"children":[{"type":"text","value":"TODO，Web Performance @MDN"}]}]}]},{"type":"element","tag":"h2","props":{"id":"如何测量性能指标"},"children":[{"type":"text","value":"如何测量性能指标"}]},{"type":"element","tag":"h4","props":{"id":"怎么测定页面帧率"},"children":[{"type":"text","value":"怎么测定页面帧率？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"可以使用 requestAnimationFrame，但是不推荐，因为脚本本身就会对性能造成影响。"}]},{"type":"element","tag":"h4","props":{"id":"可以使用哪些-api-测量性能"},"children":[{"type":"text","value":"可以使用哪些 API 测量性能？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Web Performance Related Specs","src":"https://mgear-image.oss-cn-shanghai.aliyuncs.com/image/other/20220630135906.png"},"children":[]}]},{"type":"element","tag":"h4","props":{"id":"performance-timing-被弃用了"},"children":[{"type":"text","value":"Performance Timing 被弃用了？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Performance Timing 被弃用了，取而代之的是 Performance Navigation Timing。不应该再使用 performance.navigation、performance.getEntries 等 API，这些旧的 API 没有办法肩检测如加载新脚本等情况，不支持新的性能指标如 Long Tasks API，此外可能干扰页面性能，所以推荐使用 Navigation Timing API 获取数据，并使用 Performance Observer 进行侦测。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Navigation Timing Level 2","src":"https://mgear-image.oss-cn-shanghai.aliyuncs.com/image/other/20220628165411.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"见："},{"type":"element","tag":"a","props":{"href":"https://www.w3.org/TR/navigation-timing-2/","rel":["nofollow"]},"children":[{"type":"text","value":"Navigation Timing Level 2"}]}]},{"type":"element","tag":"h4","props":{"id":"navigation-timing-中不同的阶段是连续的吗"},"children":[{"type":"text","value":"Navigation Timing 中不同的阶段是连续的吗？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"可能不是。如浏览器有同域下最多 6 个请求并行的限制，那么 domainLoopupEnd 到 requestStart 之间可能会出现较长的等待时间（Stalled Time）。此外，不一定每个阶段都会有数据，如：未发生跳转时，redirectCount 为 0；如果页面没有 service worker，那么 workerStart 为 0；DNS 从缓存中获取时，domainLoopupStart 和 domainLoopupEnd 可能相等。"}]},{"type":"element","tag":"h4","props":{"id":"performanceobserver-是什么"},"children":[{"type":"text","value":"PerformanceObserver 是什么？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"“有效的性能测量的第一条规则是确保性能测量技术本身不会导致性能问题”，使用 Performance Observer 可以获取某个具体类型的指标的同时不会干扰或影响页面性能，因为它会在浏览器空闲时期执行。"}]},{"type":"element","tag":"pre","props":{"className":"language-js shiki shiki-themes material-theme-lighter github-light github-dark monokai","code":"try {\n  // \"element\"、\"event\"、\"first-input\"、\n  // \"largest-contentful-paint\"、\"layout-shift\"、\n  // \"longtask\"、\"mark\"、\"measure\"、\n  // \"navigation\"、\"paint\"、\"resource\"\n    PerformanceObserver.supportedEntryTypes.map(type => {\n        new PerformanceObserver((list) => {\n          for (const entry of list.getEntries()) {\n            console.log(entry.toJSON())\n          }\n        }).observe({\n        type,\n        // 使用 buffered 可以在第一次回调时获取缓存区中的历史记录\n        buffered: true\n      })\n    })\n} catch {\n    // nothing  \n}\n","language":"js","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:inherit"},"children":[{"type":"text","value":"try"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#6A737D;--shiki-dark:#6A737D;--shiki-sepia:#88846F;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:inherit"},"children":[{"type":"text","value":"  // \"element\"、\"event\"、\"first-input\"、\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#6A737D;--shiki-dark:#6A737D;--shiki-sepia:#88846F;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:inherit"},"children":[{"type":"text","value":"  // \"largest-contentful-paint\"、\"layout-shift\"、\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#6A737D;--shiki-dark:#6A737D;--shiki-sepia:#88846F;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:inherit"},"children":[{"type":"text","value":"  // \"longtask\"、\"mark\"、\"measure\"、\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#6A737D;--shiki-dark:#6A737D;--shiki-sepia:#88846F;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:inherit"},"children":[{"type":"text","value":"  // \"navigation\"、\"paint\"、\"resource\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"    PerformanceObserver"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"supportedEntryTypes"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":"map"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#E36209;--shiki-dark:#FFAB70;--shiki-sepia:#FD971F;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic"},"children":[{"type":"text","value":"type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#9C3EDA;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#66D9EF;--shiki-light-font-style:inherit;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic"},"children":[{"type":"text","value":" =>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"        new"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":" PerformanceObserver"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#E36209;--shiki-dark:#FFAB70;--shiki-sepia:#FD971F;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic"},"children":[{"type":"text","value":"list"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":")"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#9C3EDA;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#66D9EF;--shiki-light-font-style:inherit;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic"},"children":[{"type":"text","value":" =>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:inherit"},"children":[{"type":"text","value":"          for"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#9C3EDA;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#66D9EF;--shiki-light-font-style:inherit;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" entry"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672"},"children":[{"type":"text","value":" of"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" list"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":"getEntries"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"()) "}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"{\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"            console"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"entry"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":"toJSON"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"())\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"          }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"        }"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":")"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":"observe"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"{\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"        type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#6A737D;--shiki-dark:#6A737D;--shiki-sepia:#88846F;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:inherit"},"children":[{"type":"text","value":"        // 使用 buffered 可以在第一次回调时获取缓存区中的历史记录\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"        buffered"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#FF5370;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF"},"children":[{"type":"text","value":" true\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"      }"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"    }"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"}"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:inherit"},"children":[{"type":"text","value":" catch"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#6A737D;--shiki-dark:#6A737D;--shiki-sepia:#88846F;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:inherit"},"children":[{"type":"text","value":"    // nothing  \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"见："},{"type":"element","tag":"a","props":{"href":"https://web.dev/custom-metrics/#","rel":["nofollow"]},"children":[{"type":"text","value":"Performance Observer"}]}]},{"type":"element","tag":"h4","props":{"id":"long-tasks-api-是什么"},"children":[{"type":"text","value":"Long Tasks API 是什么？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Long Tasks API 将会汇报使主线程阻塞超过 50ms 的任何任务。通过观测阻塞时长，可以获得诸如 TTI（Time To Interactive）、TBT（Total Blocking Time）等数据。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"见："},{"type":"element","tag":"a","props":{"href":"https://web.dev/custom-metrics/#long-tasks-api","rel":["nofollow"]},"children":[{"type":"text","value":"Long Tasks API"}]}]},{"type":"element","tag":"h4","props":{"id":"如何测量函数执行的时长"},"children":[{"type":"text","value":"如何测量函数执行的时长？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"可以使用 Date.now()、performance.now()，但是如果不考虑兼容性的话，使用 User Timing API 要更好一些，它可以和相关套件很好的结合：比如说在 Performance 面板中可视化，或通过 Performance Observer 进行观测。"}]},{"type":"element","tag":"pre","props":{"className":"language-js shiki shiki-themes material-theme-lighter github-light github-dark monokai","code":"performance.mark('myTask:start')\nawait task()\nperformance.mark('myTask:end')\nperformance.measure('myTask', 'myTask:start', 'myTask:end')\n","language":"js","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"performance"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":"mark"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"myTask:start"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:inherit"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":" task"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"performance"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":"mark"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"myTask:end"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"performance"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":"measure"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"myTask"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":","}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" '"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"myTask:start"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":","}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" '"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"myTask:end"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":")\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"见："},{"type":"element","tag":"a","props":{"href":"https://web.dev/custom-metrics/#user-timing-api","rel":["nofollow"]},"children":[{"type":"text","value":"User Timing API"}]}]},{"type":"element","tag":"h4","props":{"id":"如何测量元素的渲染时间"},"children":[{"type":"text","value":"如何测量元素的渲染时间？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"可以使用 Element Timing API。通过给 element 增加 elementtiming 属性，可以在注册 Performance Observer 后监听 element 类型的事件并获得元素渲染时间。LCP 指标就是建立在 ET API 基础上的，只是汇报的是最大内容元素的渲染时间。"}]},{"type":"element","tag":"pre","props":{"className":"language-html shiki shiki-themes material-theme-lighter github-light github-dark monokai","code":"<img elementtiming=\"hero-image\" />\n<script>\n  new PerformanceObserver(/* ... */)\n    .observe({ type: 'element', buffered: true })\n</script>\n","language":"html","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"img"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#9C3EDA;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":" elementtiming"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"hero-image"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" />\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"script"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"  new"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":" PerformanceObserver"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#6A737D;--shiki-dark:#6A737D;--shiki-sepia:#88846F;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:inherit"},"children":[{"type":"text","value":"/* ... */"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"    ."}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":"observe"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"{"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" '"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"element"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":","}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" buffered"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#FF5370;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF"},"children":[{"type":"text","value":" true"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" }"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"</"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#E53935;--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"script"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":">\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"见："},{"type":"element","tag":"a","props":{"href":"https://web.dev/custom-metrics/#element-timing-api","rel":["nofollow"]},"children":[{"type":"text","value":"Element Timing API"}]}]},{"type":"element","tag":"h4","props":{"id":"event-timing-api-是什么"},"children":[{"type":"text","value":"Event Timing API 是什么？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"见："},{"type":"element","tag":"a","props":{"href":"https://web.dev/custom-metrics/#event-timing-api","rel":["nofollow"]},"children":[{"type":"text","value":"Event Timing API"}]}]},{"type":"element","tag":"h4","props":{"id":"resource-timing-api-是什么"},"children":[{"type":"text","value":"Resource Timing API 是什么？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"见："},{"type":"element","tag":"a","props":{"href":"https://web.dev/custom-metrics/#resource-timing-api","rel":["nofollow"]},"children":[{"type":"text","value":"Resource Timing API"}]}]},{"type":"element","tag":"h4","props":{"id":"navigation-timing-api-是什么"},"children":[{"type":"text","value":"Navigation Timing API 是什么？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"类似于 Resource Timing API，但不同的地方在于它会在导航时被触发，还附带了 DOMContentLoaded 和 load 事件的触发事件。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"见："},{"type":"element","tag":"a","props":{"href":"https://web.dev/custom-metrics/#navigation-timing-api","rel":["nofollow"]},"children":[{"type":"text","value":"Navigation Timing API"}]}]},{"type":"element","tag":"h4","props":{"id":"除了规范定义数据还可以上报哪些"},"children":[{"type":"text","value":"除了规范定义数据，还可以上报哪些？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"5W"}]},{"type":"text","value":"：时间、地理位置、页面 URL、浏览器、系统、账号 ID、现场还原。"},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"网络"}]},{"type":"text","value":"：页面加载方式、Service Worker、HTTP 协议版本、资源压缩方式。"},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"其它"}]},{"type":"text","value":"：页面在前台还是后台。"}]},{"type":"element","tag":"h3","props":{"id":"links"},"children":[{"type":"text","value":"Links"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://mp.weixin.qq.com/s/pqFhhb5u6w7gmUutilH5xQ","rel":["nofollow"]},"children":[{"type":"text","value":"蚂蚁金服如何把前端性能监控做到极致?"}]}]}]},{"type":"element","tag":"h2","props":{"id":"性能优化"},"children":[{"type":"text","value":"性能优化"}]},{"type":"element","tag":"h4","props":{"id":"做性能优化的基本法则是什么"},"children":[{"type":"text","value":"做性能优化的基本法则是什么？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"编译层参见 webpack 优化；网络层减少请求；客户端预加载、预渲染、预执行。以及两句名言：“空间换时间”、“串行改并行”。"}]},{"type":"element","tag":"h2","props":{"id":"ssr-及混合应用优化"},"children":[{"type":"text","value":"SSR 及混合应用优化"}]},{"type":"element","tag":"h4","props":{"id":"csr-是什么"},"children":[{"type":"text","value":"CSR 是什么？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Client Side Rendering，和 SSR 相对应，指页面渲染、逻辑、路由、请求都是在浏览器发生的。想要提高 CSR 项目的用户体验，可以考虑在编译时通过预渲染首屏、骨架屏等形式对性能指标进行优化，或者，上 SSR。"}]},{"type":"element","tag":"h4","props":{"id":"从-csr-到-ssr-有哪些过渡方案"},"children":[{"type":"text","value":"从 CSR 到 SSR 有哪些过渡方案？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"CSP -> CSP with prerender -> SSR with hydration -> static SSR -> SSR"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"From CSP to SSR","src":"https://mgear-image.oss-cn-shanghai.aliyuncs.com/image/other/20220629020645.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"见："},{"type":"element","tag":"a","props":{"href":"https://web.dev/rendering-on-the-web/","rel":["nofollow"]},"children":[{"type":"text","value":"TODO，Rendering on the Web"}]},{"type":"text","value":"、"},{"type":"element","tag":"a","props":{"href":"https://blog.csdn.net/m0_37411791/article/details/106513195?utm_source=blogxgwz7","rel":["nofollow"]},"children":[{"type":"text","value":"CSR、SSR、NSR、ESR傻傻分不清楚"}]}]},{"type":"element","tag":"h4","props":{"id":"esr-是什么"},"children":[{"type":"text","value":"ESR 是什么？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"TODO，"},{"type":"element","tag":"a","props":{"href":"https://juejin.im/post/5ecf90b7f265da76e7651a96","rel":["nofollow"]},"children":[{"type":"text","value":"边缘计算听说过吗？淘宝用它提升了69%的首屏性能"}]}]},{"type":"element","tag":"h4","props":{"id":"经典直出方案是什么"},"children":[{"type":"text","value":"经典直出方案是什么？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"直出指在后端渲染好 HTML 后再回传给客户端这种方式，直出可以节约许多 HTML 渲染及 AJAX 请求的时间，对 Web 前端的侵入性最小。"}]},{"type":"element","tag":"h4","props":{"id":"离线包缓存是什么"},"children":[{"type":"text","value":"离线包缓存是什么？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"直出方案仍需要把时间花在请求、加载 HTML 上，离线包缓存意味着把 HTML、CSS、JS、数据提前缓存在本地，只有部分需要异步更新的页面才通过请求的方式加载新数据并重新渲染页面。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"直出 VS 离线包缓存","src":"https://mgear-image.oss-cn-shanghai.aliyuncs.com/image/other/20220628233615.png"},"children":[]}]},{"type":"element","tag":"h4","props":{"id":"容器化方案是什么"},"children":[{"type":"text","value":"容器化方案是什么？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"TODO，"},{"type":"element","tag":"a","props":{"href":"http://www.alloyteam.com/2020/06/fast-open-h5/","rel":["nofollow"]},"children":[{"type":"text","value":"http://www.alloyteam.com/2020/06/fast-open-h5/"}]}]},{"type":"element","tag":"h4","props":{"id":"pwa-怎么配合-ssr-做优化"},"children":[{"type":"text","value":"PWA 怎么配合 SSR 做优化？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"PWA 能够通过 Service Worker 对缓存进行精细化控制，在客户端使用无头浏览器提前加载 HTML，等到实际加载时请求的就是由 Service Worker 缓存下来的资源了。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"PWA + Headless Webview","src":"https://mgear-image.oss-cn-shanghai.aliyuncs.com/image/other/20220628235637.png?w=30"},"children":[]}]},{"type":"element","tag":"h4","props":{"id":"nsr-是什么"},"children":[{"type":"text","value":"NSR 是什么？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Native Side Render，GMTC 2019 UC 团队提到的一种“前端 SSR”方案，它借助浏览器启动一个额外的 JS Runtime，将提前下载好的 HTML 模板和数据预渲染出来。这种方案的瓶颈在于他会带来额外的流量和性能开销，所以如何预测用户行为，提高命中率是非常重要的事。"}]},{"type":"element","tag":"h3","props":{"id":"links-1"},"children":[{"type":"text","value":"Links"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://www.alloyteam.com/2019/10/h5-performance-optimize","rel":["nofollow"]},"children":[{"type":"text","value":"H5 秒开方案大全"}]}]}]},{"type":"element","tag":"h2","props":{"id":"阅读更多"},"children":[{"type":"text","value":"阅读更多"}]},{"type":"element","tag":"h5","props":{"id":"react-16-加载性能优化指南"},"children":[{"type":"element","tag":"link","props":{"type":"h5","to":"https://mgear-file.oss-cn-shanghai.aliyuncs.com/React%2016%20%E5%8A%A0%E8%BD%BD%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97.html","source":"https://zhuanlan.zhihu.com/p/37148975"},"children":[]},{"type":"text","value":"《React 16 加载性能优化指南》"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"作者把页面加载状态划分了四个步骤："}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"打开页面到首屏渲染（浏览器首次渲染可见的内容）"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"首屏渲染到首次内容渲染（相关业务的内容）"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"内容渲染到页面可交互"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"页面逐渐加载（诸如图片等元素）直到页面内容加载完毕"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在很多应用中，首屏渲染约等于首次内容渲染，这是因为加载 HTML 和 CSS 之后，要等待业务 JS 加载完毕才能看到有意义的内容。其实可以通过几种方法完善首屏加载的 HTML 和 CSS，增加加载状态，减少用户等待焦虑。"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"在 HTML 模板中使用 SVG 图案（比如通过 html-webpack-plugin 自动插入）"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"使用 pupeteer 等工具预渲染首屏"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"业务内容加载的过程中，JS 的影响最大。业务 JS 代码可以大致划分为：基础框架、垫片、业务基础库、业务代码这四大类，所以讲到优化 JS 其实是说如何通过分缓存去优化几种不同类型的 JS。"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"基础框架需要长时间缓存，适合强缓存"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"使用 polyfill.io，根据 UA 自动垫片"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"使用 SplitChunksPlugin 替代 CommonChunksPlugin"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"使用 TreeShaking"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"如果打包出来的 Bundle 体积巨大，可以考虑使用代码分割功能，比如 React Loadable 动态载入代码。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"为绝大多数用户提供 ES6+ 的代码，使用 nomodule 标志为老的浏览器保留 ES5 版本代码"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"最后，在页面可交互到页面加载完毕这个阶段，可以使用图片懒加载或者骨架屏等形式提高体验。"}]},{"type":"element","tag":"h5","props":{"id":"关于性能优化的9大策略和6大指标"},"children":[{"type":"element","tag":"a","props":{"href":"https://juejin.cn/post/6981673766178783262","rel":["nofollow"]},"children":[{"type":"text","value":"关于性能优化的9大策略和6大指标"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"网络层面\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"构建工具优化\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"include/exclude 避免不必要的查找，比如用在 babel-loader 可以避免不必要的转译"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"babel-loader 可配置 cache，只编译修改过的文件"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"alias 优化文件查找性能"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"thread-loader 多进程编译"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"BundleAnalyzer 分析文件体积"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"SplitChunks 替换 CommonChunks，渐进式加载"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"摇树优化"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"按需加载"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"动态垫片"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"变量提升"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"压缩，比如 "},{"type":"element","tag":"a","props":{"href":"https://webpack.docschina.org/plugins/terser-webpack-plugin/","rel":["nofollow"]},"children":[{"type":"text","value":"terser"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"图像策略"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"内容分发\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"域名分开，避免 Cookie"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"静态资源走 CDN"}]}]}]}]}]}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"指标与模型","depth":2,"text":"指标与模型"},{"id":"如何测量性能指标","depth":2,"text":"如何测量性能指标","children":[{"id":"links","depth":3,"text":"Links"}]},{"id":"性能优化","depth":2,"text":"性能优化"},{"id":"ssr-及混合应用优化","depth":2,"text":"SSR 及混合应用优化","children":[{"id":"links-1","depth":3,"text":"Links"}]},{"id":"阅读更多","depth":2,"text":"阅读更多"}]}},"_type":"markdown","_id":"content:6.maps:_web:performance.md","_source":"content","_file":"6.maps/_web/performance.md","_extension":"md"}