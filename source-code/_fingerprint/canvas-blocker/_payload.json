[{"data":1,"prerenderedAt":2095},["ShallowReactive",2],{"navigation":3,"/source-code/_fingerprint/canvas-blocker":155,"/source-code/_fingerprint/canvas-blocker-surround":2088},[4,35,86,92,119,125,149],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29,32],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🚝 四十二篇系列","/flows/fourty-two",{"title":15,"_path":16},"🌃 长夜梦","/flows/long-night-dream",{"title":18,"_path":19},"🌌 万物联结与幸福感","/flows/everything",{"title":21,"_path":22},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":24,"_path":25},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":27,"_path":28},"🌧️ 我的腼腆","/flows/shy",{"title":30,"_path":31},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":33,"_path":34},"📝 心流归档","/flows/archive",{"title":36,"_path":37,"children":38},"技术博客 / Coder","/articles",[39,41,44,47,50,53,56,59,62,65,68,71,74,77,80,83],{"title":40,"_path":37},"🦁 欢迎",{"title":42,"_path":43},"🥞 在 tailwind 中使用现代化 CSS Layers","/articles/tailwind-sass-and-css-layer",{"title":45,"_path":46},"💻 本地部署 Qwen 翻译网页","/articles/local-translator",{"title":48,"_path":49},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":51,"_path":52},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":54,"_path":55},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":57,"_path":58},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":60,"_path":61},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":63,"_path":64},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":66,"_path":67},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":69,"_path":70},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":72,"_path":73},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":75,"_path":76},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":78,"_path":79},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":81,"_path":82},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":84,"_path":85},"📝 技术博客归档","/articles/archive",{"title":87,"_path":88,"children":89},"读书笔记 / Notes","/books",[90],{"title":91,"_path":88},"📕 读书笔记",{"title":93,"_path":94,"children":95},"吉他剧场 / Music","/music",[96,98,101,104,107,110,113,116],{"title":97,"_path":94},"🎸 FingerStyle！",{"title":99,"_path":100},"🌬️ 等待的风","/music/wind",{"title":102,"_path":103},"💕 约定的海洋","/music/ocean",{"title":105,"_path":106},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":108,"_path":109},"🌏 残酷天使的行动纲领","/music/eva",{"title":111,"_path":112},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":114,"_path":115},"🍷 Wu Wei","/music/wu-wei",{"title":117,"_path":118},"🌅 无题","/music/untitled",{"title":120,"_path":121,"children":122},"知识地图 / Maps","/maps",[123],{"title":124,"_path":121},"🏁 知识地图",{"title":126,"_path":127,"children":128},"造物 / Make","/tools",[129,131,134,137,140,143,146],{"title":130,"_path":127},"🧰 工具收集",{"title":132,"_path":133},"📕 博客","/tools/blog",{"title":135,"_path":136},"🥥 Coconut","/tools/coconut",{"title":138,"_path":139},"🧶 网易云音乐歌单排序","/tools/netease-sorter",{"title":141,"_path":142},"🌐 AnySort","/tools/anysort",{"title":144,"_path":145},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":147,"_path":148},"👓 Crapto","/tools/crypto-inline",{"title":150,"_path":151,"children":152},"我 / About","/hire",[153],{"title":154,"_path":151},"📬 技术简历",{"_path":156,"_dir":157,"_draft":158,"_partial":159,"_locale":160,"title":161,"description":160,"body":162,"_type":2082,"_id":2083,"_source":2084,"_file":2085,"_stem":2086,"_extension":2087},"/source-code/_fingerprint/canvas-blocker","_fingerprint",false,true,"","Canvas Blocker",{"type":163,"children":164,"toc":2072},"root",[165,173,179,185,235,240,246,251,256,633,638,643,650,655,680,685,843,848,1431,1437,1442,1455,1460,2037,2043,2048,2053,2066],{"type":166,"tag":167,"props":168,"children":170},"element","h1",{"id":169},"canvas-blocker",[171],{"type":172,"value":161},"text",{"type":166,"tag":174,"props":175,"children":177},"h2",{"id":176},"前言",[178],{"type":172,"value":176},{"type":166,"tag":180,"props":181,"children":182},"p",{},[183],{"type":172,"value":184},"最近在看一些反反爬相关的东西，期间找到了 Canvas Blocker 这个神奇的库。他是一个浏览器扩展，声称能拦截以下几种类型的指纹追踪：",{"type":166,"tag":186,"props":187,"children":188},"ul",{},[189,195,200,205,210,215,220,225,230],{"type":166,"tag":190,"props":191,"children":192},"li",{},[193],{"type":172,"value":194},"Canvas 2D",{"type":166,"tag":190,"props":196,"children":197},{},[198],{"type":172,"value":199},"WebGL",{"type":166,"tag":190,"props":201,"children":202},{},[203],{"type":172,"value":204},"Web Audio",{"type":166,"tag":190,"props":206,"children":207},{},[208],{"type":172,"value":209},"History",{"type":166,"tag":190,"props":211,"children":212},{},[213],{"type":172,"value":214},"Window",{"type":166,"tag":190,"props":216,"children":217},{},[218],{"type":172,"value":219},"DOMRect",{"type":166,"tag":190,"props":221,"children":222},{},[223],{"type":172,"value":224},"TextMetrics",{"type":166,"tag":190,"props":226,"children":227},{},[228],{"type":172,"value":229},"Navigator",{"type":166,"tag":190,"props":231,"children":232},{},[233],{"type":172,"value":234},"Screen",{"type":166,"tag":180,"props":236,"children":237},{},[238],{"type":172,"value":239},"让我们大致拆解一下，看看其原理是什么。",{"type":166,"tag":174,"props":241,"children":243},{"id":242},"intercept",[244],{"type":172,"value":245},"Intercept",{"type":166,"tag":180,"props":247,"children":248},{},[249],{"type":172,"value":250},"Blocker 最主要的思路就是用伪造的函数篡改属性的 Getter 以及某些 API。",{"type":166,"tag":180,"props":252,"children":253},{},[254],{"type":172,"value":255},"篡改的入口在 intercept.js 中，先根据页面 URL 检查当前页面是否允许篡改，允许的话就通过 interceptFns、interceptGetters 实施具体步骤。",{"type":166,"tag":257,"props":258,"children":262},"pre",{"className":259,"code":260,"language":261,"meta":160,"style":160},"language-js shiki shiki-themes material-theme-lighter github-light github-dark monokai","scope.intercept = function intercept({subject: windowToProcess}, apis){\n  const siteStatus = apis.check({url: getURL(windowToProcess)})\n  logging.verbose(\"status for page\", windowToProcess, siteStatus)\n  if (siteStatus.mode !== \"allow\"){\n    interceptFunctions(windowToProcess, siteStatus, apis)\n    interceptGetters(windowToProcess, siteStatus, apis)\n  }\n}\n","js",[263],{"type":166,"tag":264,"props":265,"children":266},"code",{"__ignoreMap":160},[267,344,425,484,541,578,615,624],{"type":166,"tag":268,"props":269,"children":272},"span",{"class":270,"line":271},"line",1,[273,279,285,290,296,302,307,312,318,323,329,334,339],{"type":166,"tag":268,"props":274,"children":276},{"style":275},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[277],{"type":172,"value":278},"scope",{"type":166,"tag":268,"props":280,"children":282},{"style":281},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[283],{"type":172,"value":284},".",{"type":166,"tag":268,"props":286,"children":288},{"style":287},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[289],{"type":172,"value":242},{"type":166,"tag":268,"props":291,"children":293},{"style":292},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[294],{"type":172,"value":295}," =",{"type":166,"tag":268,"props":297,"children":299},{"style":298},"--shiki-light:#9C3EDA;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic",[300],{"type":172,"value":301}," function",{"type":166,"tag":268,"props":303,"children":304},{"style":287},[305],{"type":172,"value":306}," intercept",{"type":166,"tag":268,"props":308,"children":309},{"style":281},[310],{"type":172,"value":311},"({",{"type":166,"tag":268,"props":313,"children":315},{"style":314},"--shiki-light:#E53935;--shiki-default:#E36209;--shiki-dark:#FFAB70;--shiki-sepia:#F8F8F2",[316],{"type":172,"value":317},"subject",{"type":166,"tag":268,"props":319,"children":320},{"style":281},[321],{"type":172,"value":322},":",{"type":166,"tag":268,"props":324,"children":326},{"style":325},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#E36209;--shiki-default-font-style:inherit;--shiki-dark:#FFAB70;--shiki-dark-font-style:inherit;--shiki-sepia:#FD971F;--shiki-sepia-font-style:italic",[327],{"type":172,"value":328}," windowToProcess",{"type":166,"tag":268,"props":330,"children":331},{"style":281},[332],{"type":172,"value":333},"},",{"type":166,"tag":268,"props":335,"children":336},{"style":325},[337],{"type":172,"value":338}," apis",{"type":166,"tag":268,"props":340,"children":341},{"style":281},[342],{"type":172,"value":343},"){\n",{"type":166,"tag":268,"props":345,"children":347},{"class":270,"line":346},2,[348,353,359,363,367,371,376,382,387,392,396,401,405,410,415,420],{"type":166,"tag":268,"props":349,"children":350},{"style":298},[351],{"type":172,"value":352},"  const",{"type":166,"tag":268,"props":354,"children":356},{"style":355},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#F8F8F2",[357],{"type":172,"value":358}," siteStatus",{"type":166,"tag":268,"props":360,"children":361},{"style":292},[362],{"type":172,"value":295},{"type":166,"tag":268,"props":364,"children":365},{"style":275},[366],{"type":172,"value":338},{"type":166,"tag":268,"props":368,"children":369},{"style":281},[370],{"type":172,"value":284},{"type":166,"tag":268,"props":372,"children":373},{"style":287},[374],{"type":172,"value":375},"check",{"type":166,"tag":268,"props":377,"children":379},{"style":378},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[380],{"type":172,"value":381},"(",{"type":166,"tag":268,"props":383,"children":384},{"style":281},[385],{"type":172,"value":386},"{",{"type":166,"tag":268,"props":388,"children":389},{"style":378},[390],{"type":172,"value":391},"url",{"type":166,"tag":268,"props":393,"children":394},{"style":281},[395],{"type":172,"value":322},{"type":166,"tag":268,"props":397,"children":398},{"style":287},[399],{"type":172,"value":400}," getURL",{"type":166,"tag":268,"props":402,"children":403},{"style":378},[404],{"type":172,"value":381},{"type":166,"tag":268,"props":406,"children":407},{"style":275},[408],{"type":172,"value":409},"windowToProcess",{"type":166,"tag":268,"props":411,"children":412},{"style":378},[413],{"type":172,"value":414},")",{"type":166,"tag":268,"props":416,"children":417},{"style":281},[418],{"type":172,"value":419},"}",{"type":166,"tag":268,"props":421,"children":422},{"style":378},[423],{"type":172,"value":424},")\n",{"type":166,"tag":268,"props":426,"children":428},{"class":270,"line":427},3,[429,434,438,443,447,453,459,463,468,472,476,480],{"type":166,"tag":268,"props":430,"children":431},{"style":275},[432],{"type":172,"value":433},"  logging",{"type":166,"tag":268,"props":435,"children":436},{"style":281},[437],{"type":172,"value":284},{"type":166,"tag":268,"props":439,"children":440},{"style":287},[441],{"type":172,"value":442},"verbose",{"type":166,"tag":268,"props":444,"children":445},{"style":378},[446],{"type":172,"value":381},{"type":166,"tag":268,"props":448,"children":450},{"style":449},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[451],{"type":172,"value":452},"\"",{"type":166,"tag":268,"props":454,"children":456},{"style":455},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[457],{"type":172,"value":458},"status for page",{"type":166,"tag":268,"props":460,"children":461},{"style":449},[462],{"type":172,"value":452},{"type":166,"tag":268,"props":464,"children":465},{"style":281},[466],{"type":172,"value":467},",",{"type":166,"tag":268,"props":469,"children":470},{"style":275},[471],{"type":172,"value":328},{"type":166,"tag":268,"props":473,"children":474},{"style":281},[475],{"type":172,"value":467},{"type":166,"tag":268,"props":477,"children":478},{"style":275},[479],{"type":172,"value":358},{"type":166,"tag":268,"props":481,"children":482},{"style":378},[483],{"type":172,"value":424},{"type":166,"tag":268,"props":485,"children":487},{"class":270,"line":486},4,[488,494,499,504,508,513,518,523,528,532,536],{"type":166,"tag":268,"props":489,"children":491},{"style":490},"--shiki-light:#39ADB5;--shiki-light-font-style:italic;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#F92672;--shiki-sepia-font-style:inherit",[492],{"type":172,"value":493},"  if",{"type":166,"tag":268,"props":495,"children":496},{"style":378},[497],{"type":172,"value":498}," (",{"type":166,"tag":268,"props":500,"children":501},{"style":275},[502],{"type":172,"value":503},"siteStatus",{"type":166,"tag":268,"props":505,"children":506},{"style":281},[507],{"type":172,"value":284},{"type":166,"tag":268,"props":509,"children":510},{"style":275},[511],{"type":172,"value":512},"mode",{"type":166,"tag":268,"props":514,"children":515},{"style":292},[516],{"type":172,"value":517}," !==",{"type":166,"tag":268,"props":519,"children":520},{"style":449},[521],{"type":172,"value":522}," \"",{"type":166,"tag":268,"props":524,"children":525},{"style":455},[526],{"type":172,"value":527},"allow",{"type":166,"tag":268,"props":529,"children":530},{"style":449},[531],{"type":172,"value":452},{"type":166,"tag":268,"props":533,"children":534},{"style":378},[535],{"type":172,"value":414},{"type":166,"tag":268,"props":537,"children":538},{"style":281},[539],{"type":172,"value":540},"{\n",{"type":166,"tag":268,"props":542,"children":544},{"class":270,"line":543},5,[545,550,554,558,562,566,570,574],{"type":166,"tag":268,"props":546,"children":547},{"style":287},[548],{"type":172,"value":549},"    interceptFunctions",{"type":166,"tag":268,"props":551,"children":552},{"style":378},[553],{"type":172,"value":381},{"type":166,"tag":268,"props":555,"children":556},{"style":275},[557],{"type":172,"value":409},{"type":166,"tag":268,"props":559,"children":560},{"style":281},[561],{"type":172,"value":467},{"type":166,"tag":268,"props":563,"children":564},{"style":275},[565],{"type":172,"value":358},{"type":166,"tag":268,"props":567,"children":568},{"style":281},[569],{"type":172,"value":467},{"type":166,"tag":268,"props":571,"children":572},{"style":275},[573],{"type":172,"value":338},{"type":166,"tag":268,"props":575,"children":576},{"style":378},[577],{"type":172,"value":424},{"type":166,"tag":268,"props":579,"children":581},{"class":270,"line":580},6,[582,587,591,595,599,603,607,611],{"type":166,"tag":268,"props":583,"children":584},{"style":287},[585],{"type":172,"value":586},"    interceptGetters",{"type":166,"tag":268,"props":588,"children":589},{"style":378},[590],{"type":172,"value":381},{"type":166,"tag":268,"props":592,"children":593},{"style":275},[594],{"type":172,"value":409},{"type":166,"tag":268,"props":596,"children":597},{"style":281},[598],{"type":172,"value":467},{"type":166,"tag":268,"props":600,"children":601},{"style":275},[602],{"type":172,"value":358},{"type":166,"tag":268,"props":604,"children":605},{"style":281},[606],{"type":172,"value":467},{"type":166,"tag":268,"props":608,"children":609},{"style":275},[610],{"type":172,"value":338},{"type":166,"tag":268,"props":612,"children":613},{"style":378},[614],{"type":172,"value":424},{"type":166,"tag":268,"props":616,"children":618},{"class":270,"line":617},7,[619],{"type":166,"tag":268,"props":620,"children":621},{"style":281},[622],{"type":172,"value":623},"  }\n",{"type":166,"tag":268,"props":625,"children":627},{"class":270,"line":626},8,[628],{"type":166,"tag":268,"props":629,"children":630},{"style":281},[631],{"type":172,"value":632},"}\n",{"type":166,"tag":174,"props":634,"children":636},{"id":635},"window",[637],{"type":172,"value":214},{"type":166,"tag":180,"props":639,"children":640},{},[641],{"type":172,"value":642},"Blocker 篡改了 Window 的两个属性，window.name 和 window.opener。这两个属性和指纹没有直接关系，但却是一种“帮助函数”，能够帮助恶意网站追踪指纹以及窃取隐私。",{"type":166,"tag":644,"props":645,"children":647},"h3",{"id":646},"windowname",[648],{"type":172,"value":649},"window.name",{"type":166,"tag":180,"props":651,"children":652},{},[653],{"type":172,"value":654},"在过去的浏览器中，window.name 能够跨站点传输数据，并且能逃逸同源策略。从 Firefox 88 开始，用户通过点击超链接跳转到新页面时，window.name 将被置空，不过为了不造成更大的破坏，当用户从跳转后页面回到之前页面时，window.name 会被还原。",{"type":166,"tag":186,"props":656,"children":657},{},[658,670],{"type":166,"tag":190,"props":659,"children":660},{},[661],{"type":166,"tag":662,"props":663,"children":667},"a",{"href":664,"rel":665},"https://blog.mozilla.org/security/2021/04/19/firefox-88-combats-window-name-privacy-abuses/",[666],"nofollow",[668],{"type":172,"value":669},"Firefox 88 combats window.name privacy abuses",{"type":166,"tag":190,"props":671,"children":672},{},[673],{"type":166,"tag":662,"props":674,"children":677},{"href":675,"rel":676},"https://wpt.fyi/results/html/browsers/windows/clear-window-name.https.html?label=master&label=experimental&aligned",[666],[678],{"type":172,"value":679},"clear-window-name@web-platform-tests",{"type":166,"tag":180,"props":681,"children":682},{},[683],{"type":172,"value":684},"在使用 JS 设置 window.name 时，Blcoker 会记录下设置的值。original.call 调用原有的 window.name setter；windowNames 只做记录，稍后会用到。",{"type":166,"tag":257,"props":686,"children":688},{"className":259,"code":687,"language":261,"meta":160,"style":160},"{\n  set name(name){\n    // 调用原有 setting 设置 window.name\n    original.call(this, ...arguments)\n    // 把 name 记录下来\n    windowNames.set(this, name)\n  }\n}\n",[689],{"type":166,"tag":264,"props":690,"children":691},{"__ignoreMap":160},[692,699,729,738,784,792,829,836],{"type":166,"tag":268,"props":693,"children":694},{"class":270,"line":271},[695],{"type":166,"tag":268,"props":696,"children":697},{"style":281},[698],{"type":172,"value":540},{"type":166,"tag":268,"props":700,"children":701},{"class":270,"line":346},[702,707,712,716,721,725],{"type":166,"tag":268,"props":703,"children":704},{"style":275},[705],{"type":172,"value":706},"  set",{"type":166,"tag":268,"props":708,"children":709},{"style":287},[710],{"type":172,"value":711}," name",{"type":166,"tag":268,"props":713,"children":714},{"style":378},[715],{"type":172,"value":381},{"type":166,"tag":268,"props":717,"children":718},{"style":275},[719],{"type":172,"value":720},"name",{"type":166,"tag":268,"props":722,"children":723},{"style":378},[724],{"type":172,"value":414},{"type":166,"tag":268,"props":726,"children":727},{"style":281},[728],{"type":172,"value":540},{"type":166,"tag":268,"props":730,"children":731},{"class":270,"line":427},[732],{"type":166,"tag":268,"props":733,"children":735},{"style":734},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit",[736],{"type":172,"value":737},"    // 调用原有 setting 设置 window.name\n",{"type":166,"tag":268,"props":739,"children":740},{"class":270,"line":486},[741,746,750,755,759,765,769,774,780],{"type":166,"tag":268,"props":742,"children":743},{"style":275},[744],{"type":172,"value":745},"    original",{"type":166,"tag":268,"props":747,"children":748},{"style":281},[749],{"type":172,"value":284},{"type":166,"tag":268,"props":751,"children":752},{"style":287},[753],{"type":172,"value":754},"call",{"type":166,"tag":268,"props":756,"children":757},{"style":378},[758],{"type":172,"value":381},{"type":166,"tag":268,"props":760,"children":762},{"style":761},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[763],{"type":172,"value":764},"this",{"type":166,"tag":268,"props":766,"children":767},{"style":281},[768],{"type":172,"value":467},{"type":166,"tag":268,"props":770,"children":771},{"style":292},[772],{"type":172,"value":773}," ...",{"type":166,"tag":268,"props":775,"children":777},{"style":776},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[778],{"type":172,"value":779},"arguments",{"type":166,"tag":268,"props":781,"children":782},{"style":378},[783],{"type":172,"value":424},{"type":166,"tag":268,"props":785,"children":786},{"class":270,"line":543},[787],{"type":166,"tag":268,"props":788,"children":789},{"style":734},[790],{"type":172,"value":791},"    // 把 name 记录下来\n",{"type":166,"tag":268,"props":793,"children":794},{"class":270,"line":580},[795,800,804,809,813,817,821,825],{"type":166,"tag":268,"props":796,"children":797},{"style":275},[798],{"type":172,"value":799},"    windowNames",{"type":166,"tag":268,"props":801,"children":802},{"style":281},[803],{"type":172,"value":284},{"type":166,"tag":268,"props":805,"children":806},{"style":287},[807],{"type":172,"value":808},"set",{"type":166,"tag":268,"props":810,"children":811},{"style":378},[812],{"type":172,"value":381},{"type":166,"tag":268,"props":814,"children":815},{"style":761},[816],{"type":172,"value":764},{"type":166,"tag":268,"props":818,"children":819},{"style":281},[820],{"type":172,"value":467},{"type":166,"tag":268,"props":822,"children":823},{"style":275},[824],{"type":172,"value":711},{"type":166,"tag":268,"props":826,"children":827},{"style":378},[828],{"type":172,"value":424},{"type":166,"tag":268,"props":830,"children":831},{"class":270,"line":617},[832],{"type":166,"tag":268,"props":833,"children":834},{"style":281},[835],{"type":172,"value":623},{"type":166,"tag":268,"props":837,"children":838},{"class":270,"line":626},[839],{"type":166,"tag":268,"props":840,"children":841},{"style":281},[842],{"type":172,"value":632},{"type":166,"tag":180,"props":844,"children":845},{},[846],{"type":172,"value":847},"因为只有通过显式的 window.name = 'xxx' 才会触发 windowNames 中记录的值的改变，所以一旦在 b.com 读取到的 window.name 不是 windowNames 记录的值，就说明浏览器泄露了 window.name，此时需要返回伪造的值。",{"type":166,"tag":257,"props":849,"children":851},{"className":259,"code":850,"language":261,"meta":160,"style":160},"{\n  get name(){\n    return checkerWrapper(checker, this, arguments, function(args, check){\n      const {notify, original, prefs} = check\n\n      // 读取 b.com 的 window.name 可能会返回 a.com 的 window.name\n      const originalName = original.call(this, ...args)\n\n      // 根据配置，iframes 中返回的 window.name 可以赦免此伪造规则，\n      // this !== this.top 是一种快速检测当前 window 是否在 iframe 中的方法\n      if (\n        this !== this.top &&\n        prefs(\"allowWindowNameInFrames\", this.location)\n      ){\n        return originalName\n      }\n\n      // 只有通过显式的 window.name = 'xxx' 才会触发 windowNames 中记录的值的改变，\n      // 所以一旦 windowNames 记录的值和 originalName 不一样，\n      // 就说明当前浏览器犯了 window.name 泄露的错误\n      const returnedName = windowNames.get(this) || \"\"\n      if (originalName !== returnedName){\n        notify(\"fakedWindowReadout\")\n      }\n      return returnedName\n    });\n  }\n}\n",[852],{"type":166,"tag":264,"props":853,"children":854},{"__ignoreMap":160},[855,862,883,953,1002,1010,1018,1070,1077,1086,1095,1109,1140,1187,1200,1214,1223,1231,1240,1249,1258,1312,1345,1375,1383,1397,1415,1423],{"type":166,"tag":268,"props":856,"children":857},{"class":270,"line":271},[858],{"type":166,"tag":268,"props":859,"children":860},{"style":281},[861],{"type":172,"value":540},{"type":166,"tag":268,"props":863,"children":864},{"class":270,"line":346},[865,870,874,879],{"type":166,"tag":268,"props":866,"children":867},{"style":275},[868],{"type":172,"value":869},"  get",{"type":166,"tag":268,"props":871,"children":872},{"style":287},[873],{"type":172,"value":711},{"type":166,"tag":268,"props":875,"children":876},{"style":378},[877],{"type":172,"value":878},"()",{"type":166,"tag":268,"props":880,"children":881},{"style":281},[882],{"type":172,"value":540},{"type":166,"tag":268,"props":884,"children":885},{"class":270,"line":427},[886,891,896,900,905,909,914,918,923,927,931,935,940,944,949],{"type":166,"tag":268,"props":887,"children":888},{"style":490},[889],{"type":172,"value":890},"    return",{"type":166,"tag":268,"props":892,"children":893},{"style":287},[894],{"type":172,"value":895}," checkerWrapper",{"type":166,"tag":268,"props":897,"children":898},{"style":378},[899],{"type":172,"value":381},{"type":166,"tag":268,"props":901,"children":902},{"style":275},[903],{"type":172,"value":904},"checker",{"type":166,"tag":268,"props":906,"children":907},{"style":281},[908],{"type":172,"value":467},{"type":166,"tag":268,"props":910,"children":911},{"style":761},[912],{"type":172,"value":913}," this",{"type":166,"tag":268,"props":915,"children":916},{"style":281},[917],{"type":172,"value":467},{"type":166,"tag":268,"props":919,"children":920},{"style":776},[921],{"type":172,"value":922}," arguments",{"type":166,"tag":268,"props":924,"children":925},{"style":281},[926],{"type":172,"value":467},{"type":166,"tag":268,"props":928,"children":929},{"style":298},[930],{"type":172,"value":301},{"type":166,"tag":268,"props":932,"children":933},{"style":281},[934],{"type":172,"value":381},{"type":166,"tag":268,"props":936,"children":937},{"style":325},[938],{"type":172,"value":939},"args",{"type":166,"tag":268,"props":941,"children":942},{"style":281},[943],{"type":172,"value":467},{"type":166,"tag":268,"props":945,"children":946},{"style":325},[947],{"type":172,"value":948}," check",{"type":166,"tag":268,"props":950,"children":951},{"style":281},[952],{"type":172,"value":343},{"type":166,"tag":268,"props":954,"children":955},{"class":270,"line":486},[956,961,966,971,975,980,984,989,993,997],{"type":166,"tag":268,"props":957,"children":958},{"style":298},[959],{"type":172,"value":960},"      const",{"type":166,"tag":268,"props":962,"children":963},{"style":281},[964],{"type":172,"value":965}," {",{"type":166,"tag":268,"props":967,"children":968},{"style":355},[969],{"type":172,"value":970},"notify",{"type":166,"tag":268,"props":972,"children":973},{"style":281},[974],{"type":172,"value":467},{"type":166,"tag":268,"props":976,"children":977},{"style":355},[978],{"type":172,"value":979}," original",{"type":166,"tag":268,"props":981,"children":982},{"style":281},[983],{"type":172,"value":467},{"type":166,"tag":268,"props":985,"children":986},{"style":355},[987],{"type":172,"value":988}," prefs",{"type":166,"tag":268,"props":990,"children":991},{"style":281},[992],{"type":172,"value":419},{"type":166,"tag":268,"props":994,"children":995},{"style":292},[996],{"type":172,"value":295},{"type":166,"tag":268,"props":998,"children":999},{"style":275},[1000],{"type":172,"value":1001}," check\n",{"type":166,"tag":268,"props":1003,"children":1004},{"class":270,"line":543},[1005],{"type":166,"tag":268,"props":1006,"children":1007},{"emptyLinePlaceholder":159},[1008],{"type":172,"value":1009},"\n",{"type":166,"tag":268,"props":1011,"children":1012},{"class":270,"line":580},[1013],{"type":166,"tag":268,"props":1014,"children":1015},{"style":734},[1016],{"type":172,"value":1017},"      // 读取 b.com 的 window.name 可能会返回 a.com 的 window.name\n",{"type":166,"tag":268,"props":1019,"children":1020},{"class":270,"line":617},[1021,1025,1030,1034,1038,1042,1046,1050,1054,1058,1062,1066],{"type":166,"tag":268,"props":1022,"children":1023},{"style":298},[1024],{"type":172,"value":960},{"type":166,"tag":268,"props":1026,"children":1027},{"style":355},[1028],{"type":172,"value":1029}," originalName",{"type":166,"tag":268,"props":1031,"children":1032},{"style":292},[1033],{"type":172,"value":295},{"type":166,"tag":268,"props":1035,"children":1036},{"style":275},[1037],{"type":172,"value":979},{"type":166,"tag":268,"props":1039,"children":1040},{"style":281},[1041],{"type":172,"value":284},{"type":166,"tag":268,"props":1043,"children":1044},{"style":287},[1045],{"type":172,"value":754},{"type":166,"tag":268,"props":1047,"children":1048},{"style":378},[1049],{"type":172,"value":381},{"type":166,"tag":268,"props":1051,"children":1052},{"style":761},[1053],{"type":172,"value":764},{"type":166,"tag":268,"props":1055,"children":1056},{"style":281},[1057],{"type":172,"value":467},{"type":166,"tag":268,"props":1059,"children":1060},{"style":292},[1061],{"type":172,"value":773},{"type":166,"tag":268,"props":1063,"children":1064},{"style":275},[1065],{"type":172,"value":939},{"type":166,"tag":268,"props":1067,"children":1068},{"style":378},[1069],{"type":172,"value":424},{"type":166,"tag":268,"props":1071,"children":1072},{"class":270,"line":626},[1073],{"type":166,"tag":268,"props":1074,"children":1075},{"emptyLinePlaceholder":159},[1076],{"type":172,"value":1009},{"type":166,"tag":268,"props":1078,"children":1080},{"class":270,"line":1079},9,[1081],{"type":166,"tag":268,"props":1082,"children":1083},{"style":734},[1084],{"type":172,"value":1085},"      // 根据配置，iframes 中返回的 window.name 可以赦免此伪造规则，\n",{"type":166,"tag":268,"props":1087,"children":1089},{"class":270,"line":1088},10,[1090],{"type":166,"tag":268,"props":1091,"children":1092},{"style":734},[1093],{"type":172,"value":1094},"      // this !== this.top 是一种快速检测当前 window 是否在 iframe 中的方法\n",{"type":166,"tag":268,"props":1096,"children":1098},{"class":270,"line":1097},11,[1099,1104],{"type":166,"tag":268,"props":1100,"children":1101},{"style":490},[1102],{"type":172,"value":1103},"      if",{"type":166,"tag":268,"props":1105,"children":1106},{"style":378},[1107],{"type":172,"value":1108}," (\n",{"type":166,"tag":268,"props":1110,"children":1112},{"class":270,"line":1111},12,[1113,1118,1122,1126,1130,1135],{"type":166,"tag":268,"props":1114,"children":1115},{"style":761},[1116],{"type":172,"value":1117},"        this",{"type":166,"tag":268,"props":1119,"children":1120},{"style":292},[1121],{"type":172,"value":517},{"type":166,"tag":268,"props":1123,"children":1124},{"style":761},[1125],{"type":172,"value":913},{"type":166,"tag":268,"props":1127,"children":1128},{"style":281},[1129],{"type":172,"value":284},{"type":166,"tag":268,"props":1131,"children":1132},{"style":275},[1133],{"type":172,"value":1134},"top",{"type":166,"tag":268,"props":1136,"children":1137},{"style":292},[1138],{"type":172,"value":1139}," &&\n",{"type":166,"tag":268,"props":1141,"children":1143},{"class":270,"line":1142},13,[1144,1149,1153,1157,1162,1166,1170,1174,1178,1183],{"type":166,"tag":268,"props":1145,"children":1146},{"style":287},[1147],{"type":172,"value":1148},"        prefs",{"type":166,"tag":268,"props":1150,"children":1151},{"style":378},[1152],{"type":172,"value":381},{"type":166,"tag":268,"props":1154,"children":1155},{"style":449},[1156],{"type":172,"value":452},{"type":166,"tag":268,"props":1158,"children":1159},{"style":455},[1160],{"type":172,"value":1161},"allowWindowNameInFrames",{"type":166,"tag":268,"props":1163,"children":1164},{"style":449},[1165],{"type":172,"value":452},{"type":166,"tag":268,"props":1167,"children":1168},{"style":281},[1169],{"type":172,"value":467},{"type":166,"tag":268,"props":1171,"children":1172},{"style":761},[1173],{"type":172,"value":913},{"type":166,"tag":268,"props":1175,"children":1176},{"style":281},[1177],{"type":172,"value":284},{"type":166,"tag":268,"props":1179,"children":1180},{"style":275},[1181],{"type":172,"value":1182},"location",{"type":166,"tag":268,"props":1184,"children":1185},{"style":378},[1186],{"type":172,"value":424},{"type":166,"tag":268,"props":1188,"children":1190},{"class":270,"line":1189},14,[1191,1196],{"type":166,"tag":268,"props":1192,"children":1193},{"style":378},[1194],{"type":172,"value":1195},"      )",{"type":166,"tag":268,"props":1197,"children":1198},{"style":281},[1199],{"type":172,"value":540},{"type":166,"tag":268,"props":1201,"children":1203},{"class":270,"line":1202},15,[1204,1209],{"type":166,"tag":268,"props":1205,"children":1206},{"style":490},[1207],{"type":172,"value":1208},"        return",{"type":166,"tag":268,"props":1210,"children":1211},{"style":275},[1212],{"type":172,"value":1213}," originalName\n",{"type":166,"tag":268,"props":1215,"children":1217},{"class":270,"line":1216},16,[1218],{"type":166,"tag":268,"props":1219,"children":1220},{"style":281},[1221],{"type":172,"value":1222},"      }\n",{"type":166,"tag":268,"props":1224,"children":1226},{"class":270,"line":1225},17,[1227],{"type":166,"tag":268,"props":1228,"children":1229},{"emptyLinePlaceholder":159},[1230],{"type":172,"value":1009},{"type":166,"tag":268,"props":1232,"children":1234},{"class":270,"line":1233},18,[1235],{"type":166,"tag":268,"props":1236,"children":1237},{"style":734},[1238],{"type":172,"value":1239},"      // 只有通过显式的 window.name = 'xxx' 才会触发 windowNames 中记录的值的改变，\n",{"type":166,"tag":268,"props":1241,"children":1243},{"class":270,"line":1242},19,[1244],{"type":166,"tag":268,"props":1245,"children":1246},{"style":734},[1247],{"type":172,"value":1248},"      // 所以一旦 windowNames 记录的值和 originalName 不一样，\n",{"type":166,"tag":268,"props":1250,"children":1252},{"class":270,"line":1251},20,[1253],{"type":166,"tag":268,"props":1254,"children":1255},{"style":734},[1256],{"type":172,"value":1257},"      // 就说明当前浏览器犯了 window.name 泄露的错误\n",{"type":166,"tag":268,"props":1259,"children":1261},{"class":270,"line":1260},21,[1262,1266,1271,1275,1280,1284,1289,1293,1297,1302,1307],{"type":166,"tag":268,"props":1263,"children":1264},{"style":298},[1265],{"type":172,"value":960},{"type":166,"tag":268,"props":1267,"children":1268},{"style":355},[1269],{"type":172,"value":1270}," returnedName",{"type":166,"tag":268,"props":1272,"children":1273},{"style":292},[1274],{"type":172,"value":295},{"type":166,"tag":268,"props":1276,"children":1277},{"style":275},[1278],{"type":172,"value":1279}," windowNames",{"type":166,"tag":268,"props":1281,"children":1282},{"style":281},[1283],{"type":172,"value":284},{"type":166,"tag":268,"props":1285,"children":1286},{"style":287},[1287],{"type":172,"value":1288},"get",{"type":166,"tag":268,"props":1290,"children":1291},{"style":378},[1292],{"type":172,"value":381},{"type":166,"tag":268,"props":1294,"children":1295},{"style":761},[1296],{"type":172,"value":764},{"type":166,"tag":268,"props":1298,"children":1299},{"style":378},[1300],{"type":172,"value":1301},") ",{"type":166,"tag":268,"props":1303,"children":1304},{"style":292},[1305],{"type":172,"value":1306},"||",{"type":166,"tag":268,"props":1308,"children":1309},{"style":449},[1310],{"type":172,"value":1311}," \"\"\n",{"type":166,"tag":268,"props":1313,"children":1315},{"class":270,"line":1314},22,[1316,1320,1324,1329,1333,1337,1341],{"type":166,"tag":268,"props":1317,"children":1318},{"style":490},[1319],{"type":172,"value":1103},{"type":166,"tag":268,"props":1321,"children":1322},{"style":378},[1323],{"type":172,"value":498},{"type":166,"tag":268,"props":1325,"children":1326},{"style":275},[1327],{"type":172,"value":1328},"originalName",{"type":166,"tag":268,"props":1330,"children":1331},{"style":292},[1332],{"type":172,"value":517},{"type":166,"tag":268,"props":1334,"children":1335},{"style":275},[1336],{"type":172,"value":1270},{"type":166,"tag":268,"props":1338,"children":1339},{"style":378},[1340],{"type":172,"value":414},{"type":166,"tag":268,"props":1342,"children":1343},{"style":281},[1344],{"type":172,"value":540},{"type":166,"tag":268,"props":1346,"children":1348},{"class":270,"line":1347},23,[1349,1354,1358,1362,1367,1371],{"type":166,"tag":268,"props":1350,"children":1351},{"style":287},[1352],{"type":172,"value":1353},"        notify",{"type":166,"tag":268,"props":1355,"children":1356},{"style":378},[1357],{"type":172,"value":381},{"type":166,"tag":268,"props":1359,"children":1360},{"style":449},[1361],{"type":172,"value":452},{"type":166,"tag":268,"props":1363,"children":1364},{"style":455},[1365],{"type":172,"value":1366},"fakedWindowReadout",{"type":166,"tag":268,"props":1368,"children":1369},{"style":449},[1370],{"type":172,"value":452},{"type":166,"tag":268,"props":1372,"children":1373},{"style":378},[1374],{"type":172,"value":424},{"type":166,"tag":268,"props":1376,"children":1378},{"class":270,"line":1377},24,[1379],{"type":166,"tag":268,"props":1380,"children":1381},{"style":281},[1382],{"type":172,"value":1222},{"type":166,"tag":268,"props":1384,"children":1386},{"class":270,"line":1385},25,[1387,1392],{"type":166,"tag":268,"props":1388,"children":1389},{"style":490},[1390],{"type":172,"value":1391},"      return",{"type":166,"tag":268,"props":1393,"children":1394},{"style":275},[1395],{"type":172,"value":1396}," returnedName\n",{"type":166,"tag":268,"props":1398,"children":1400},{"class":270,"line":1399},26,[1401,1406,1410],{"type":166,"tag":268,"props":1402,"children":1403},{"style":281},[1404],{"type":172,"value":1405},"    }",{"type":166,"tag":268,"props":1407,"children":1408},{"style":378},[1409],{"type":172,"value":414},{"type":166,"tag":268,"props":1411,"children":1412},{"style":281},[1413],{"type":172,"value":1414},";\n",{"type":166,"tag":268,"props":1416,"children":1418},{"class":270,"line":1417},27,[1419],{"type":166,"tag":268,"props":1420,"children":1421},{"style":281},[1422],{"type":172,"value":623},{"type":166,"tag":268,"props":1424,"children":1426},{"class":270,"line":1425},28,[1427],{"type":166,"tag":268,"props":1428,"children":1429},{"style":281},[1430],{"type":172,"value":632},{"type":166,"tag":174,"props":1432,"children":1434},{"id":1433},"windowopener",[1435],{"type":172,"value":1436},"window.opener",{"type":166,"tag":180,"props":1438,"children":1439},{},[1440],{"type":172,"value":1441},"在过去的浏览器中，当页面通过超链接或 window.open 的方式从 A 网站跳转到 B 网站时，如果制定了 target 属性却没有指定 rel=\"norefer\" 属性，那么在 B 网站是可以使用 window.opener 获取到 A 网站的部分信息的。也就是说，在 B 网站中可以修改 window.opener.location.href = 'x' 从而让 A 网站自动跳转到 X 网站。如果页面跳转时使用 target=\"__blank\" 打开了新页面，那么用户更加不可能注意到 A 网站的恶意跳转。",{"type":166,"tag":186,"props":1443,"children":1444},{},[1445],{"type":166,"tag":190,"props":1446,"children":1447},{},[1448],{"type":166,"tag":662,"props":1449,"children":1452},{"href":1450,"rel":1451},"https://cwe.mitre.org/data/definitions/1022.html",[666],[1453],{"type":172,"value":1454},"CWE-1022: Use of Web Link to Untrusted Target with window.opener Access",{"type":166,"tag":180,"props":1456,"children":1457},{},[1458],{"type":172,"value":1459},"Blocker 对 window.opener 的防范比较简单，直接返回 null 就完事儿了。考虑到现代浏览器已经修复了这个漏洞，该篡改的设置的值默认是关闭的。",{"type":166,"tag":257,"props":1461,"children":1463},{"className":259,"code":1462,"language":261,"meta":160,"style":160},"{\n  // 修改 Getter 使 window.opener 一直返回 null\n  getterGenerator: function(checker){\n    const temp = {\n      get opener(){\n        return checkerWrapper(checker, this, arguments, function(args, check){\n          const {notify, original} = check\n          const originalOpener = original.call(this, ...args)\n          if (originalOpener !== null){\n            notify(\"fakedWindowReadout\")\n          }\n          return null\n        })\n      }\n    }\n    return Object.getOwnPropertyDescriptor(temp, \"opener\").get\n  },\n  // 修改 Descriptor.Value 使得 window.opener 一直返回 null，\n  // 这是一种兼容，在部分浏览器中，\n  //  window.opener 是通过 value 而不是 getter 获取的值\n  valueGenerator: function({original, notify}){\n    if (original !== null){\n      notify(\"fakedWindowReadout\")\n    }\n    return null\n  }\n}\n",[1464],{"type":166,"tag":264,"props":1465,"children":1466},{"__ignoreMap":160},[1467,1474,1482,1511,1533,1552,1615,1651,1703,1738,1766,1774,1787,1799,1806,1814,1874,1882,1890,1898,1906,1945,1977,2005,2012,2023,2030],{"type":166,"tag":268,"props":1468,"children":1469},{"class":270,"line":271},[1470],{"type":166,"tag":268,"props":1471,"children":1472},{"style":281},[1473],{"type":172,"value":540},{"type":166,"tag":268,"props":1475,"children":1476},{"class":270,"line":346},[1477],{"type":166,"tag":268,"props":1478,"children":1479},{"style":734},[1480],{"type":172,"value":1481},"  // 修改 Getter 使 window.opener 一直返回 null\n",{"type":166,"tag":268,"props":1483,"children":1484},{"class":270,"line":427},[1485,1491,1495,1499,1503,1507],{"type":166,"tag":268,"props":1486,"children":1488},{"style":1487},"--shiki-light:#E2931D;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#F8F8F2",[1489],{"type":172,"value":1490},"  getterGenerator",{"type":166,"tag":268,"props":1492,"children":1493},{"style":281},[1494],{"type":172,"value":322},{"type":166,"tag":268,"props":1496,"children":1497},{"style":298},[1498],{"type":172,"value":301},{"type":166,"tag":268,"props":1500,"children":1501},{"style":281},[1502],{"type":172,"value":381},{"type":166,"tag":268,"props":1504,"children":1505},{"style":325},[1506],{"type":172,"value":904},{"type":166,"tag":268,"props":1508,"children":1509},{"style":281},[1510],{"type":172,"value":343},{"type":166,"tag":268,"props":1512,"children":1513},{"class":270,"line":486},[1514,1519,1524,1528],{"type":166,"tag":268,"props":1515,"children":1516},{"style":298},[1517],{"type":172,"value":1518},"    const",{"type":166,"tag":268,"props":1520,"children":1521},{"style":355},[1522],{"type":172,"value":1523}," temp",{"type":166,"tag":268,"props":1525,"children":1526},{"style":292},[1527],{"type":172,"value":295},{"type":166,"tag":268,"props":1529,"children":1530},{"style":281},[1531],{"type":172,"value":1532}," {\n",{"type":166,"tag":268,"props":1534,"children":1535},{"class":270,"line":543},[1536,1541,1547],{"type":166,"tag":268,"props":1537,"children":1538},{"style":298},[1539],{"type":172,"value":1540},"      get",{"type":166,"tag":268,"props":1542,"children":1544},{"style":1543},"--shiki-light:#E53935;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[1545],{"type":172,"value":1546}," opener",{"type":166,"tag":268,"props":1548,"children":1549},{"style":281},[1550],{"type":172,"value":1551},"(){\n",{"type":166,"tag":268,"props":1553,"children":1554},{"class":270,"line":580},[1555,1559,1563,1567,1571,1575,1579,1583,1587,1591,1595,1599,1603,1607,1611],{"type":166,"tag":268,"props":1556,"children":1557},{"style":490},[1558],{"type":172,"value":1208},{"type":166,"tag":268,"props":1560,"children":1561},{"style":287},[1562],{"type":172,"value":895},{"type":166,"tag":268,"props":1564,"children":1565},{"style":378},[1566],{"type":172,"value":381},{"type":166,"tag":268,"props":1568,"children":1569},{"style":275},[1570],{"type":172,"value":904},{"type":166,"tag":268,"props":1572,"children":1573},{"style":281},[1574],{"type":172,"value":467},{"type":166,"tag":268,"props":1576,"children":1577},{"style":761},[1578],{"type":172,"value":913},{"type":166,"tag":268,"props":1580,"children":1581},{"style":281},[1582],{"type":172,"value":467},{"type":166,"tag":268,"props":1584,"children":1585},{"style":776},[1586],{"type":172,"value":922},{"type":166,"tag":268,"props":1588,"children":1589},{"style":281},[1590],{"type":172,"value":467},{"type":166,"tag":268,"props":1592,"children":1593},{"style":298},[1594],{"type":172,"value":301},{"type":166,"tag":268,"props":1596,"children":1597},{"style":281},[1598],{"type":172,"value":381},{"type":166,"tag":268,"props":1600,"children":1601},{"style":325},[1602],{"type":172,"value":939},{"type":166,"tag":268,"props":1604,"children":1605},{"style":281},[1606],{"type":172,"value":467},{"type":166,"tag":268,"props":1608,"children":1609},{"style":325},[1610],{"type":172,"value":948},{"type":166,"tag":268,"props":1612,"children":1613},{"style":281},[1614],{"type":172,"value":343},{"type":166,"tag":268,"props":1616,"children":1617},{"class":270,"line":617},[1618,1623,1627,1631,1635,1639,1643,1647],{"type":166,"tag":268,"props":1619,"children":1620},{"style":298},[1621],{"type":172,"value":1622},"          const",{"type":166,"tag":268,"props":1624,"children":1625},{"style":281},[1626],{"type":172,"value":965},{"type":166,"tag":268,"props":1628,"children":1629},{"style":355},[1630],{"type":172,"value":970},{"type":166,"tag":268,"props":1632,"children":1633},{"style":281},[1634],{"type":172,"value":467},{"type":166,"tag":268,"props":1636,"children":1637},{"style":355},[1638],{"type":172,"value":979},{"type":166,"tag":268,"props":1640,"children":1641},{"style":281},[1642],{"type":172,"value":419},{"type":166,"tag":268,"props":1644,"children":1645},{"style":292},[1646],{"type":172,"value":295},{"type":166,"tag":268,"props":1648,"children":1649},{"style":275},[1650],{"type":172,"value":1001},{"type":166,"tag":268,"props":1652,"children":1653},{"class":270,"line":626},[1654,1658,1663,1667,1671,1675,1679,1683,1687,1691,1695,1699],{"type":166,"tag":268,"props":1655,"children":1656},{"style":298},[1657],{"type":172,"value":1622},{"type":166,"tag":268,"props":1659,"children":1660},{"style":355},[1661],{"type":172,"value":1662}," originalOpener",{"type":166,"tag":268,"props":1664,"children":1665},{"style":292},[1666],{"type":172,"value":295},{"type":166,"tag":268,"props":1668,"children":1669},{"style":275},[1670],{"type":172,"value":979},{"type":166,"tag":268,"props":1672,"children":1673},{"style":281},[1674],{"type":172,"value":284},{"type":166,"tag":268,"props":1676,"children":1677},{"style":287},[1678],{"type":172,"value":754},{"type":166,"tag":268,"props":1680,"children":1681},{"style":378},[1682],{"type":172,"value":381},{"type":166,"tag":268,"props":1684,"children":1685},{"style":761},[1686],{"type":172,"value":764},{"type":166,"tag":268,"props":1688,"children":1689},{"style":281},[1690],{"type":172,"value":467},{"type":166,"tag":268,"props":1692,"children":1693},{"style":292},[1694],{"type":172,"value":773},{"type":166,"tag":268,"props":1696,"children":1697},{"style":275},[1698],{"type":172,"value":939},{"type":166,"tag":268,"props":1700,"children":1701},{"style":378},[1702],{"type":172,"value":424},{"type":166,"tag":268,"props":1704,"children":1705},{"class":270,"line":1079},[1706,1711,1715,1720,1724,1730,1734],{"type":166,"tag":268,"props":1707,"children":1708},{"style":490},[1709],{"type":172,"value":1710},"          if",{"type":166,"tag":268,"props":1712,"children":1713},{"style":378},[1714],{"type":172,"value":498},{"type":166,"tag":268,"props":1716,"children":1717},{"style":275},[1718],{"type":172,"value":1719},"originalOpener",{"type":166,"tag":268,"props":1721,"children":1722},{"style":292},[1723],{"type":172,"value":517},{"type":166,"tag":268,"props":1725,"children":1727},{"style":1726},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[1728],{"type":172,"value":1729}," null",{"type":166,"tag":268,"props":1731,"children":1732},{"style":378},[1733],{"type":172,"value":414},{"type":166,"tag":268,"props":1735,"children":1736},{"style":281},[1737],{"type":172,"value":540},{"type":166,"tag":268,"props":1739,"children":1740},{"class":270,"line":1088},[1741,1746,1750,1754,1758,1762],{"type":166,"tag":268,"props":1742,"children":1743},{"style":287},[1744],{"type":172,"value":1745},"            notify",{"type":166,"tag":268,"props":1747,"children":1748},{"style":378},[1749],{"type":172,"value":381},{"type":166,"tag":268,"props":1751,"children":1752},{"style":449},[1753],{"type":172,"value":452},{"type":166,"tag":268,"props":1755,"children":1756},{"style":455},[1757],{"type":172,"value":1366},{"type":166,"tag":268,"props":1759,"children":1760},{"style":449},[1761],{"type":172,"value":452},{"type":166,"tag":268,"props":1763,"children":1764},{"style":378},[1765],{"type":172,"value":424},{"type":166,"tag":268,"props":1767,"children":1768},{"class":270,"line":1097},[1769],{"type":166,"tag":268,"props":1770,"children":1771},{"style":281},[1772],{"type":172,"value":1773},"          }\n",{"type":166,"tag":268,"props":1775,"children":1776},{"class":270,"line":1111},[1777,1782],{"type":166,"tag":268,"props":1778,"children":1779},{"style":490},[1780],{"type":172,"value":1781},"          return",{"type":166,"tag":268,"props":1783,"children":1784},{"style":1726},[1785],{"type":172,"value":1786}," null\n",{"type":166,"tag":268,"props":1788,"children":1789},{"class":270,"line":1142},[1790,1795],{"type":166,"tag":268,"props":1791,"children":1792},{"style":281},[1793],{"type":172,"value":1794},"        }",{"type":166,"tag":268,"props":1796,"children":1797},{"style":378},[1798],{"type":172,"value":424},{"type":166,"tag":268,"props":1800,"children":1801},{"class":270,"line":1189},[1802],{"type":166,"tag":268,"props":1803,"children":1804},{"style":281},[1805],{"type":172,"value":1222},{"type":166,"tag":268,"props":1807,"children":1808},{"class":270,"line":1202},[1809],{"type":166,"tag":268,"props":1810,"children":1811},{"style":281},[1812],{"type":172,"value":1813},"    }\n",{"type":166,"tag":268,"props":1815,"children":1816},{"class":270,"line":1216},[1817,1821,1826,1830,1835,1839,1844,1848,1852,1857,1861,1865,1869],{"type":166,"tag":268,"props":1818,"children":1819},{"style":490},[1820],{"type":172,"value":890},{"type":166,"tag":268,"props":1822,"children":1823},{"style":275},[1824],{"type":172,"value":1825}," Object",{"type":166,"tag":268,"props":1827,"children":1828},{"style":281},[1829],{"type":172,"value":284},{"type":166,"tag":268,"props":1831,"children":1832},{"style":287},[1833],{"type":172,"value":1834},"getOwnPropertyDescriptor",{"type":166,"tag":268,"props":1836,"children":1837},{"style":378},[1838],{"type":172,"value":381},{"type":166,"tag":268,"props":1840,"children":1841},{"style":275},[1842],{"type":172,"value":1843},"temp",{"type":166,"tag":268,"props":1845,"children":1846},{"style":281},[1847],{"type":172,"value":467},{"type":166,"tag":268,"props":1849,"children":1850},{"style":449},[1851],{"type":172,"value":522},{"type":166,"tag":268,"props":1853,"children":1854},{"style":455},[1855],{"type":172,"value":1856},"opener",{"type":166,"tag":268,"props":1858,"children":1859},{"style":449},[1860],{"type":172,"value":452},{"type":166,"tag":268,"props":1862,"children":1863},{"style":378},[1864],{"type":172,"value":414},{"type":166,"tag":268,"props":1866,"children":1867},{"style":281},[1868],{"type":172,"value":284},{"type":166,"tag":268,"props":1870,"children":1871},{"style":275},[1872],{"type":172,"value":1873},"get\n",{"type":166,"tag":268,"props":1875,"children":1876},{"class":270,"line":1225},[1877],{"type":166,"tag":268,"props":1878,"children":1879},{"style":281},[1880],{"type":172,"value":1881},"  },\n",{"type":166,"tag":268,"props":1883,"children":1884},{"class":270,"line":1233},[1885],{"type":166,"tag":268,"props":1886,"children":1887},{"style":734},[1888],{"type":172,"value":1889},"  // 修改 Descriptor.Value 使得 window.opener 一直返回 null，\n",{"type":166,"tag":268,"props":1891,"children":1892},{"class":270,"line":1242},[1893],{"type":166,"tag":268,"props":1894,"children":1895},{"style":734},[1896],{"type":172,"value":1897},"  // 这是一种兼容，在部分浏览器中，\n",{"type":166,"tag":268,"props":1899,"children":1900},{"class":270,"line":1251},[1901],{"type":166,"tag":268,"props":1902,"children":1903},{"style":734},[1904],{"type":172,"value":1905},"  //  window.opener 是通过 value 而不是 getter 获取的值\n",{"type":166,"tag":268,"props":1907,"children":1908},{"class":270,"line":1260},[1909,1914,1918,1922,1926,1931,1935,1940],{"type":166,"tag":268,"props":1910,"children":1911},{"style":1487},[1912],{"type":172,"value":1913},"  valueGenerator",{"type":166,"tag":268,"props":1915,"children":1916},{"style":281},[1917],{"type":172,"value":322},{"type":166,"tag":268,"props":1919,"children":1920},{"style":298},[1921],{"type":172,"value":301},{"type":166,"tag":268,"props":1923,"children":1924},{"style":281},[1925],{"type":172,"value":311},{"type":166,"tag":268,"props":1927,"children":1928},{"style":325},[1929],{"type":172,"value":1930},"original",{"type":166,"tag":268,"props":1932,"children":1933},{"style":281},[1934],{"type":172,"value":467},{"type":166,"tag":268,"props":1936,"children":1937},{"style":325},[1938],{"type":172,"value":1939}," notify",{"type":166,"tag":268,"props":1941,"children":1942},{"style":281},[1943],{"type":172,"value":1944},"}){\n",{"type":166,"tag":268,"props":1946,"children":1947},{"class":270,"line":1314},[1948,1953,1957,1961,1965,1969,1973],{"type":166,"tag":268,"props":1949,"children":1950},{"style":490},[1951],{"type":172,"value":1952},"    if",{"type":166,"tag":268,"props":1954,"children":1955},{"style":378},[1956],{"type":172,"value":498},{"type":166,"tag":268,"props":1958,"children":1959},{"style":275},[1960],{"type":172,"value":1930},{"type":166,"tag":268,"props":1962,"children":1963},{"style":292},[1964],{"type":172,"value":517},{"type":166,"tag":268,"props":1966,"children":1967},{"style":1726},[1968],{"type":172,"value":1729},{"type":166,"tag":268,"props":1970,"children":1971},{"style":378},[1972],{"type":172,"value":414},{"type":166,"tag":268,"props":1974,"children":1975},{"style":281},[1976],{"type":172,"value":540},{"type":166,"tag":268,"props":1978,"children":1979},{"class":270,"line":1347},[1980,1985,1989,1993,1997,2001],{"type":166,"tag":268,"props":1981,"children":1982},{"style":287},[1983],{"type":172,"value":1984},"      notify",{"type":166,"tag":268,"props":1986,"children":1987},{"style":378},[1988],{"type":172,"value":381},{"type":166,"tag":268,"props":1990,"children":1991},{"style":449},[1992],{"type":172,"value":452},{"type":166,"tag":268,"props":1994,"children":1995},{"style":455},[1996],{"type":172,"value":1366},{"type":166,"tag":268,"props":1998,"children":1999},{"style":449},[2000],{"type":172,"value":452},{"type":166,"tag":268,"props":2002,"children":2003},{"style":378},[2004],{"type":172,"value":424},{"type":166,"tag":268,"props":2006,"children":2007},{"class":270,"line":1377},[2008],{"type":166,"tag":268,"props":2009,"children":2010},{"style":281},[2011],{"type":172,"value":1813},{"type":166,"tag":268,"props":2013,"children":2014},{"class":270,"line":1385},[2015,2019],{"type":166,"tag":268,"props":2016,"children":2017},{"style":490},[2018],{"type":172,"value":890},{"type":166,"tag":268,"props":2020,"children":2021},{"style":1726},[2022],{"type":172,"value":1786},{"type":166,"tag":268,"props":2024,"children":2025},{"class":270,"line":1399},[2026],{"type":166,"tag":268,"props":2027,"children":2028},{"style":281},[2029],{"type":172,"value":623},{"type":166,"tag":268,"props":2031,"children":2032},{"class":270,"line":1417},[2033],{"type":166,"tag":268,"props":2034,"children":2035},{"style":281},[2036],{"type":172,"value":632},{"type":166,"tag":174,"props":2038,"children":2040},{"id":2039},"canvas",[2041],{"type":172,"value":2042},"Canvas",{"type":166,"tag":180,"props":2044,"children":2045},{},[2046],{"type":172,"value":2047},"伪造了 getContext、getDataURL 等 API，并替代了原本正常的 API。",{"type":166,"tag":174,"props":2049,"children":2051},{"id":2050},"相关链接",[2052],{"type":172,"value":2050},{"type":166,"tag":186,"props":2054,"children":2055},{},[2056],{"type":166,"tag":190,"props":2057,"children":2058},{},[2059],{"type":166,"tag":662,"props":2060,"children":2063},{"href":2061,"rel":2062},"https://github.com/kkapsner/CanvasBlocker",[666],[2064],{"type":172,"value":2065},"CanvasBlocker",{"type":166,"tag":2067,"props":2068,"children":2069},"style",{},[2070],{"type":172,"value":2071},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":160,"searchDepth":346,"depth":346,"links":2073},[2074,2075,2076,2079,2080,2081],{"id":176,"depth":346,"text":176},{"id":242,"depth":346,"text":245},{"id":635,"depth":346,"text":214,"children":2077},[2078],{"id":646,"depth":427,"text":649},{"id":1433,"depth":346,"text":1436},{"id":2039,"depth":346,"text":2042},{"id":2050,"depth":346,"text":2050},"markdown","content:8.source-code:_fingerprint:canvas-blocker.md","content","8.source-code/_fingerprint/canvas-blocker.md","8.source-code/_fingerprint/canvas-blocker","md",[2089,2092],{"_path":2090,"title":2091,"description":160},"/source-code/_es/object-assign","Object.prototype.assign",{"_path":2093,"title":2094,"description":160},"/source-code/_js/element-plus","ElementPlus",1742745258238]