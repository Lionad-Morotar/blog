[{"data":1,"prerenderedAt":2098},["ShallowReactive",2],{"navigation":3,"/source-code/_fingerprint/canvas-blocker":158,"/source-code/_fingerprint/canvas-blocker-surround":2091},[4,35,89,95,122,128,152],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29,32],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🚝 四十二篇系列","/flows/fourty-two",{"title":15,"_path":16},"🌃 长夜梦","/flows/long-night-dream",{"title":18,"_path":19},"🌌 万物联结与幸福感","/flows/everything",{"title":21,"_path":22},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":24,"_path":25},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":27,"_path":28},"🌧️ 我的腼腆","/flows/shy",{"title":30,"_path":31},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":33,"_path":34},"📝 心流归档","/flows/archive",{"title":36,"_path":37,"children":38},"技术博客 / Coder","/articles",[39,41,44,47,50,53,56,59,62,65,68,71,74,77,80,83,86],{"title":40,"_path":37},"🦁 欢迎",{"title":42,"_path":43},"🌪️ tailwind4 如何兼容预处理器","/articles/tailwind4-with-sass",{"title":45,"_path":46},"🥞 在 tailwind 中使用现代化 CSS Layers","/articles/tailwind-sass-and-css-layer",{"title":48,"_path":49},"💻 本地部署 Qwen 翻译网页","/articles/local-translator",{"title":51,"_path":52},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":54,"_path":55},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":57,"_path":58},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":60,"_path":61},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":63,"_path":64},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":66,"_path":67},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":69,"_path":70},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":72,"_path":73},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":75,"_path":76},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":78,"_path":79},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":81,"_path":82},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":84,"_path":85},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":87,"_path":88},"📝 技术博客归档","/articles/archive",{"title":90,"_path":91,"children":92},"读书笔记 / Notes","/books",[93],{"title":94,"_path":91},"📕 读书笔记",{"title":96,"_path":97,"children":98},"吉他剧场 / Music","/music",[99,101,104,107,110,113,116,119],{"title":100,"_path":97},"🎸 FingerStyle！",{"title":102,"_path":103},"🌬️ 等待的风","/music/wind",{"title":105,"_path":106},"💕 约定的海洋","/music/ocean",{"title":108,"_path":109},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":111,"_path":112},"🌏 残酷天使的行动纲领","/music/eva",{"title":114,"_path":115},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":117,"_path":118},"🍷 Wu Wei","/music/wu-wei",{"title":120,"_path":121},"🌅 无题","/music/untitled",{"title":123,"_path":124,"children":125},"知识地图 / Maps","/maps",[126],{"title":127,"_path":124},"🏁 知识地图",{"title":129,"_path":130,"children":131},"造物 / Make","/tools",[132,134,137,140,143,146,149],{"title":133,"_path":130},"🧰 工具收集",{"title":135,"_path":136},"📕 博客","/tools/blog",{"title":138,"_path":139},"🥥 Coconut","/tools/coconut",{"title":141,"_path":142},"🧶 网易云音乐歌单排序","/tools/netease-sorter",{"title":144,"_path":145},"🌐 AnySort","/tools/anysort",{"title":147,"_path":148},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":150,"_path":151},"👓 Crapto","/tools/crypto-inline",{"title":153,"_path":154,"children":155},"我 / About","/hire",[156],{"title":157,"_path":154},"📬 技术简历",{"_path":159,"_dir":160,"_draft":161,"_partial":162,"_locale":163,"title":164,"description":163,"body":165,"_type":2085,"_id":2086,"_source":2087,"_file":2088,"_stem":2089,"_extension":2090},"/source-code/_fingerprint/canvas-blocker","_fingerprint",false,true,"","Canvas Blocker",{"type":166,"children":167,"toc":2075},"root",[168,176,182,188,238,243,249,254,259,636,641,646,653,658,683,688,846,851,1434,1440,1445,1458,1463,2040,2046,2051,2056,2069],{"type":169,"tag":170,"props":171,"children":173},"element","h1",{"id":172},"canvas-blocker",[174],{"type":175,"value":164},"text",{"type":169,"tag":177,"props":178,"children":180},"h2",{"id":179},"前言",[181],{"type":175,"value":179},{"type":169,"tag":183,"props":184,"children":185},"p",{},[186],{"type":175,"value":187},"最近在看一些反反爬相关的东西，期间找到了 Canvas Blocker 这个神奇的库。他是一个浏览器扩展，声称能拦截以下几种类型的指纹追踪：",{"type":169,"tag":189,"props":190,"children":191},"ul",{},[192,198,203,208,213,218,223,228,233],{"type":169,"tag":193,"props":194,"children":195},"li",{},[196],{"type":175,"value":197},"Canvas 2D",{"type":169,"tag":193,"props":199,"children":200},{},[201],{"type":175,"value":202},"WebGL",{"type":169,"tag":193,"props":204,"children":205},{},[206],{"type":175,"value":207},"Web Audio",{"type":169,"tag":193,"props":209,"children":210},{},[211],{"type":175,"value":212},"History",{"type":169,"tag":193,"props":214,"children":215},{},[216],{"type":175,"value":217},"Window",{"type":169,"tag":193,"props":219,"children":220},{},[221],{"type":175,"value":222},"DOMRect",{"type":169,"tag":193,"props":224,"children":225},{},[226],{"type":175,"value":227},"TextMetrics",{"type":169,"tag":193,"props":229,"children":230},{},[231],{"type":175,"value":232},"Navigator",{"type":169,"tag":193,"props":234,"children":235},{},[236],{"type":175,"value":237},"Screen",{"type":169,"tag":183,"props":239,"children":240},{},[241],{"type":175,"value":242},"让我们大致拆解一下，看看其原理是什么。",{"type":169,"tag":177,"props":244,"children":246},{"id":245},"intercept",[247],{"type":175,"value":248},"Intercept",{"type":169,"tag":183,"props":250,"children":251},{},[252],{"type":175,"value":253},"Blocker 最主要的思路就是用伪造的函数篡改属性的 Getter 以及某些 API。",{"type":169,"tag":183,"props":255,"children":256},{},[257],{"type":175,"value":258},"篡改的入口在 intercept.js 中，先根据页面 URL 检查当前页面是否允许篡改，允许的话就通过 interceptFns、interceptGetters 实施具体步骤。",{"type":169,"tag":260,"props":261,"children":265},"pre",{"className":262,"code":263,"language":264,"meta":163,"style":163},"language-js shiki shiki-themes material-theme-lighter github-light github-dark monokai","scope.intercept = function intercept({subject: windowToProcess}, apis){\n  const siteStatus = apis.check({url: getURL(windowToProcess)})\n  logging.verbose(\"status for page\", windowToProcess, siteStatus)\n  if (siteStatus.mode !== \"allow\"){\n    interceptFunctions(windowToProcess, siteStatus, apis)\n    interceptGetters(windowToProcess, siteStatus, apis)\n  }\n}\n","js",[266],{"type":169,"tag":267,"props":268,"children":269},"code",{"__ignoreMap":163},[270,347,428,487,544,581,618,627],{"type":169,"tag":271,"props":272,"children":275},"span",{"class":273,"line":274},"line",1,[276,282,288,293,299,305,310,315,321,326,332,337,342],{"type":169,"tag":271,"props":277,"children":279},{"style":278},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[280],{"type":175,"value":281},"scope",{"type":169,"tag":271,"props":283,"children":285},{"style":284},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[286],{"type":175,"value":287},".",{"type":169,"tag":271,"props":289,"children":291},{"style":290},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[292],{"type":175,"value":245},{"type":169,"tag":271,"props":294,"children":296},{"style":295},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[297],{"type":175,"value":298}," =",{"type":169,"tag":271,"props":300,"children":302},{"style":301},"--shiki-light:#9C3EDA;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic",[303],{"type":175,"value":304}," function",{"type":169,"tag":271,"props":306,"children":307},{"style":290},[308],{"type":175,"value":309}," intercept",{"type":169,"tag":271,"props":311,"children":312},{"style":284},[313],{"type":175,"value":314},"({",{"type":169,"tag":271,"props":316,"children":318},{"style":317},"--shiki-light:#E53935;--shiki-default:#E36209;--shiki-dark:#FFAB70;--shiki-sepia:#F8F8F2",[319],{"type":175,"value":320},"subject",{"type":169,"tag":271,"props":322,"children":323},{"style":284},[324],{"type":175,"value":325},":",{"type":169,"tag":271,"props":327,"children":329},{"style":328},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#E36209;--shiki-default-font-style:inherit;--shiki-dark:#FFAB70;--shiki-dark-font-style:inherit;--shiki-sepia:#FD971F;--shiki-sepia-font-style:italic",[330],{"type":175,"value":331}," windowToProcess",{"type":169,"tag":271,"props":333,"children":334},{"style":284},[335],{"type":175,"value":336},"},",{"type":169,"tag":271,"props":338,"children":339},{"style":328},[340],{"type":175,"value":341}," apis",{"type":169,"tag":271,"props":343,"children":344},{"style":284},[345],{"type":175,"value":346},"){\n",{"type":169,"tag":271,"props":348,"children":350},{"class":273,"line":349},2,[351,356,362,366,370,374,379,385,390,395,399,404,408,413,418,423],{"type":169,"tag":271,"props":352,"children":353},{"style":301},[354],{"type":175,"value":355},"  const",{"type":169,"tag":271,"props":357,"children":359},{"style":358},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#F8F8F2",[360],{"type":175,"value":361}," siteStatus",{"type":169,"tag":271,"props":363,"children":364},{"style":295},[365],{"type":175,"value":298},{"type":169,"tag":271,"props":367,"children":368},{"style":278},[369],{"type":175,"value":341},{"type":169,"tag":271,"props":371,"children":372},{"style":284},[373],{"type":175,"value":287},{"type":169,"tag":271,"props":375,"children":376},{"style":290},[377],{"type":175,"value":378},"check",{"type":169,"tag":271,"props":380,"children":382},{"style":381},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[383],{"type":175,"value":384},"(",{"type":169,"tag":271,"props":386,"children":387},{"style":284},[388],{"type":175,"value":389},"{",{"type":169,"tag":271,"props":391,"children":392},{"style":381},[393],{"type":175,"value":394},"url",{"type":169,"tag":271,"props":396,"children":397},{"style":284},[398],{"type":175,"value":325},{"type":169,"tag":271,"props":400,"children":401},{"style":290},[402],{"type":175,"value":403}," getURL",{"type":169,"tag":271,"props":405,"children":406},{"style":381},[407],{"type":175,"value":384},{"type":169,"tag":271,"props":409,"children":410},{"style":278},[411],{"type":175,"value":412},"windowToProcess",{"type":169,"tag":271,"props":414,"children":415},{"style":381},[416],{"type":175,"value":417},")",{"type":169,"tag":271,"props":419,"children":420},{"style":284},[421],{"type":175,"value":422},"}",{"type":169,"tag":271,"props":424,"children":425},{"style":381},[426],{"type":175,"value":427},")\n",{"type":169,"tag":271,"props":429,"children":431},{"class":273,"line":430},3,[432,437,441,446,450,456,462,466,471,475,479,483],{"type":169,"tag":271,"props":433,"children":434},{"style":278},[435],{"type":175,"value":436},"  logging",{"type":169,"tag":271,"props":438,"children":439},{"style":284},[440],{"type":175,"value":287},{"type":169,"tag":271,"props":442,"children":443},{"style":290},[444],{"type":175,"value":445},"verbose",{"type":169,"tag":271,"props":447,"children":448},{"style":381},[449],{"type":175,"value":384},{"type":169,"tag":271,"props":451,"children":453},{"style":452},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[454],{"type":175,"value":455},"\"",{"type":169,"tag":271,"props":457,"children":459},{"style":458},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[460],{"type":175,"value":461},"status for page",{"type":169,"tag":271,"props":463,"children":464},{"style":452},[465],{"type":175,"value":455},{"type":169,"tag":271,"props":467,"children":468},{"style":284},[469],{"type":175,"value":470},",",{"type":169,"tag":271,"props":472,"children":473},{"style":278},[474],{"type":175,"value":331},{"type":169,"tag":271,"props":476,"children":477},{"style":284},[478],{"type":175,"value":470},{"type":169,"tag":271,"props":480,"children":481},{"style":278},[482],{"type":175,"value":361},{"type":169,"tag":271,"props":484,"children":485},{"style":381},[486],{"type":175,"value":427},{"type":169,"tag":271,"props":488,"children":490},{"class":273,"line":489},4,[491,497,502,507,511,516,521,526,531,535,539],{"type":169,"tag":271,"props":492,"children":494},{"style":493},"--shiki-light:#39ADB5;--shiki-light-font-style:italic;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#F92672;--shiki-sepia-font-style:inherit",[495],{"type":175,"value":496},"  if",{"type":169,"tag":271,"props":498,"children":499},{"style":381},[500],{"type":175,"value":501}," (",{"type":169,"tag":271,"props":503,"children":504},{"style":278},[505],{"type":175,"value":506},"siteStatus",{"type":169,"tag":271,"props":508,"children":509},{"style":284},[510],{"type":175,"value":287},{"type":169,"tag":271,"props":512,"children":513},{"style":278},[514],{"type":175,"value":515},"mode",{"type":169,"tag":271,"props":517,"children":518},{"style":295},[519],{"type":175,"value":520}," !==",{"type":169,"tag":271,"props":522,"children":523},{"style":452},[524],{"type":175,"value":525}," \"",{"type":169,"tag":271,"props":527,"children":528},{"style":458},[529],{"type":175,"value":530},"allow",{"type":169,"tag":271,"props":532,"children":533},{"style":452},[534],{"type":175,"value":455},{"type":169,"tag":271,"props":536,"children":537},{"style":381},[538],{"type":175,"value":417},{"type":169,"tag":271,"props":540,"children":541},{"style":284},[542],{"type":175,"value":543},"{\n",{"type":169,"tag":271,"props":545,"children":547},{"class":273,"line":546},5,[548,553,557,561,565,569,573,577],{"type":169,"tag":271,"props":549,"children":550},{"style":290},[551],{"type":175,"value":552},"    interceptFunctions",{"type":169,"tag":271,"props":554,"children":555},{"style":381},[556],{"type":175,"value":384},{"type":169,"tag":271,"props":558,"children":559},{"style":278},[560],{"type":175,"value":412},{"type":169,"tag":271,"props":562,"children":563},{"style":284},[564],{"type":175,"value":470},{"type":169,"tag":271,"props":566,"children":567},{"style":278},[568],{"type":175,"value":361},{"type":169,"tag":271,"props":570,"children":571},{"style":284},[572],{"type":175,"value":470},{"type":169,"tag":271,"props":574,"children":575},{"style":278},[576],{"type":175,"value":341},{"type":169,"tag":271,"props":578,"children":579},{"style":381},[580],{"type":175,"value":427},{"type":169,"tag":271,"props":582,"children":584},{"class":273,"line":583},6,[585,590,594,598,602,606,610,614],{"type":169,"tag":271,"props":586,"children":587},{"style":290},[588],{"type":175,"value":589},"    interceptGetters",{"type":169,"tag":271,"props":591,"children":592},{"style":381},[593],{"type":175,"value":384},{"type":169,"tag":271,"props":595,"children":596},{"style":278},[597],{"type":175,"value":412},{"type":169,"tag":271,"props":599,"children":600},{"style":284},[601],{"type":175,"value":470},{"type":169,"tag":271,"props":603,"children":604},{"style":278},[605],{"type":175,"value":361},{"type":169,"tag":271,"props":607,"children":608},{"style":284},[609],{"type":175,"value":470},{"type":169,"tag":271,"props":611,"children":612},{"style":278},[613],{"type":175,"value":341},{"type":169,"tag":271,"props":615,"children":616},{"style":381},[617],{"type":175,"value":427},{"type":169,"tag":271,"props":619,"children":621},{"class":273,"line":620},7,[622],{"type":169,"tag":271,"props":623,"children":624},{"style":284},[625],{"type":175,"value":626},"  }\n",{"type":169,"tag":271,"props":628,"children":630},{"class":273,"line":629},8,[631],{"type":169,"tag":271,"props":632,"children":633},{"style":284},[634],{"type":175,"value":635},"}\n",{"type":169,"tag":177,"props":637,"children":639},{"id":638},"window",[640],{"type":175,"value":217},{"type":169,"tag":183,"props":642,"children":643},{},[644],{"type":175,"value":645},"Blocker 篡改了 Window 的两个属性，window.name 和 window.opener。这两个属性和指纹没有直接关系，但却是一种“帮助函数”，能够帮助恶意网站追踪指纹以及窃取隐私。",{"type":169,"tag":647,"props":648,"children":650},"h3",{"id":649},"windowname",[651],{"type":175,"value":652},"window.name",{"type":169,"tag":183,"props":654,"children":655},{},[656],{"type":175,"value":657},"在过去的浏览器中，window.name 能够跨站点传输数据，并且能逃逸同源策略。从 Firefox 88 开始，用户通过点击超链接跳转到新页面时，window.name 将被置空，不过为了不造成更大的破坏，当用户从跳转后页面回到之前页面时，window.name 会被还原。",{"type":169,"tag":189,"props":659,"children":660},{},[661,673],{"type":169,"tag":193,"props":662,"children":663},{},[664],{"type":169,"tag":665,"props":666,"children":670},"a",{"href":667,"rel":668},"https://blog.mozilla.org/security/2021/04/19/firefox-88-combats-window-name-privacy-abuses/",[669],"nofollow",[671],{"type":175,"value":672},"Firefox 88 combats window.name privacy abuses",{"type":169,"tag":193,"props":674,"children":675},{},[676],{"type":169,"tag":665,"props":677,"children":680},{"href":678,"rel":679},"https://wpt.fyi/results/html/browsers/windows/clear-window-name.https.html?label=master&label=experimental&aligned",[669],[681],{"type":175,"value":682},"clear-window-name@web-platform-tests",{"type":169,"tag":183,"props":684,"children":685},{},[686],{"type":175,"value":687},"在使用 JS 设置 window.name 时，Blcoker 会记录下设置的值。original.call 调用原有的 window.name setter；windowNames 只做记录，稍后会用到。",{"type":169,"tag":260,"props":689,"children":691},{"className":262,"code":690,"language":264,"meta":163,"style":163},"{\n  set name(name){\n    // 调用原有 setting 设置 window.name\n    original.call(this, ...arguments)\n    // 把 name 记录下来\n    windowNames.set(this, name)\n  }\n}\n",[692],{"type":169,"tag":267,"props":693,"children":694},{"__ignoreMap":163},[695,702,732,741,787,795,832,839],{"type":169,"tag":271,"props":696,"children":697},{"class":273,"line":274},[698],{"type":169,"tag":271,"props":699,"children":700},{"style":284},[701],{"type":175,"value":543},{"type":169,"tag":271,"props":703,"children":704},{"class":273,"line":349},[705,710,715,719,724,728],{"type":169,"tag":271,"props":706,"children":707},{"style":278},[708],{"type":175,"value":709},"  set",{"type":169,"tag":271,"props":711,"children":712},{"style":290},[713],{"type":175,"value":714}," name",{"type":169,"tag":271,"props":716,"children":717},{"style":381},[718],{"type":175,"value":384},{"type":169,"tag":271,"props":720,"children":721},{"style":278},[722],{"type":175,"value":723},"name",{"type":169,"tag":271,"props":725,"children":726},{"style":381},[727],{"type":175,"value":417},{"type":169,"tag":271,"props":729,"children":730},{"style":284},[731],{"type":175,"value":543},{"type":169,"tag":271,"props":733,"children":734},{"class":273,"line":430},[735],{"type":169,"tag":271,"props":736,"children":738},{"style":737},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit",[739],{"type":175,"value":740},"    // 调用原有 setting 设置 window.name\n",{"type":169,"tag":271,"props":742,"children":743},{"class":273,"line":489},[744,749,753,758,762,768,772,777,783],{"type":169,"tag":271,"props":745,"children":746},{"style":278},[747],{"type":175,"value":748},"    original",{"type":169,"tag":271,"props":750,"children":751},{"style":284},[752],{"type":175,"value":287},{"type":169,"tag":271,"props":754,"children":755},{"style":290},[756],{"type":175,"value":757},"call",{"type":169,"tag":271,"props":759,"children":760},{"style":381},[761],{"type":175,"value":384},{"type":169,"tag":271,"props":763,"children":765},{"style":764},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[766],{"type":175,"value":767},"this",{"type":169,"tag":271,"props":769,"children":770},{"style":284},[771],{"type":175,"value":470},{"type":169,"tag":271,"props":773,"children":774},{"style":295},[775],{"type":175,"value":776}," ...",{"type":169,"tag":271,"props":778,"children":780},{"style":779},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[781],{"type":175,"value":782},"arguments",{"type":169,"tag":271,"props":784,"children":785},{"style":381},[786],{"type":175,"value":427},{"type":169,"tag":271,"props":788,"children":789},{"class":273,"line":546},[790],{"type":169,"tag":271,"props":791,"children":792},{"style":737},[793],{"type":175,"value":794},"    // 把 name 记录下来\n",{"type":169,"tag":271,"props":796,"children":797},{"class":273,"line":583},[798,803,807,812,816,820,824,828],{"type":169,"tag":271,"props":799,"children":800},{"style":278},[801],{"type":175,"value":802},"    windowNames",{"type":169,"tag":271,"props":804,"children":805},{"style":284},[806],{"type":175,"value":287},{"type":169,"tag":271,"props":808,"children":809},{"style":290},[810],{"type":175,"value":811},"set",{"type":169,"tag":271,"props":813,"children":814},{"style":381},[815],{"type":175,"value":384},{"type":169,"tag":271,"props":817,"children":818},{"style":764},[819],{"type":175,"value":767},{"type":169,"tag":271,"props":821,"children":822},{"style":284},[823],{"type":175,"value":470},{"type":169,"tag":271,"props":825,"children":826},{"style":278},[827],{"type":175,"value":714},{"type":169,"tag":271,"props":829,"children":830},{"style":381},[831],{"type":175,"value":427},{"type":169,"tag":271,"props":833,"children":834},{"class":273,"line":620},[835],{"type":169,"tag":271,"props":836,"children":837},{"style":284},[838],{"type":175,"value":626},{"type":169,"tag":271,"props":840,"children":841},{"class":273,"line":629},[842],{"type":169,"tag":271,"props":843,"children":844},{"style":284},[845],{"type":175,"value":635},{"type":169,"tag":183,"props":847,"children":848},{},[849],{"type":175,"value":850},"因为只有通过显式的 window.name = 'xxx' 才会触发 windowNames 中记录的值的改变，所以一旦在 b.com 读取到的 window.name 不是 windowNames 记录的值，就说明浏览器泄露了 window.name，此时需要返回伪造的值。",{"type":169,"tag":260,"props":852,"children":854},{"className":262,"code":853,"language":264,"meta":163,"style":163},"{\n  get name(){\n    return checkerWrapper(checker, this, arguments, function(args, check){\n      const {notify, original, prefs} = check\n\n      // 读取 b.com 的 window.name 可能会返回 a.com 的 window.name\n      const originalName = original.call(this, ...args)\n\n      // 根据配置，iframes 中返回的 window.name 可以赦免此伪造规则，\n      // this !== this.top 是一种快速检测当前 window 是否在 iframe 中的方法\n      if (\n        this !== this.top &&\n        prefs(\"allowWindowNameInFrames\", this.location)\n      ){\n        return originalName\n      }\n\n      // 只有通过显式的 window.name = 'xxx' 才会触发 windowNames 中记录的值的改变，\n      // 所以一旦 windowNames 记录的值和 originalName 不一样，\n      // 就说明当前浏览器犯了 window.name 泄露的错误\n      const returnedName = windowNames.get(this) || \"\"\n      if (originalName !== returnedName){\n        notify(\"fakedWindowReadout\")\n      }\n      return returnedName\n    });\n  }\n}\n",[855],{"type":169,"tag":267,"props":856,"children":857},{"__ignoreMap":163},[858,865,886,956,1005,1013,1021,1073,1080,1089,1098,1112,1143,1190,1203,1217,1226,1234,1243,1252,1261,1315,1348,1378,1386,1400,1418,1426],{"type":169,"tag":271,"props":859,"children":860},{"class":273,"line":274},[861],{"type":169,"tag":271,"props":862,"children":863},{"style":284},[864],{"type":175,"value":543},{"type":169,"tag":271,"props":866,"children":867},{"class":273,"line":349},[868,873,877,882],{"type":169,"tag":271,"props":869,"children":870},{"style":278},[871],{"type":175,"value":872},"  get",{"type":169,"tag":271,"props":874,"children":875},{"style":290},[876],{"type":175,"value":714},{"type":169,"tag":271,"props":878,"children":879},{"style":381},[880],{"type":175,"value":881},"()",{"type":169,"tag":271,"props":883,"children":884},{"style":284},[885],{"type":175,"value":543},{"type":169,"tag":271,"props":887,"children":888},{"class":273,"line":430},[889,894,899,903,908,912,917,921,926,930,934,938,943,947,952],{"type":169,"tag":271,"props":890,"children":891},{"style":493},[892],{"type":175,"value":893},"    return",{"type":169,"tag":271,"props":895,"children":896},{"style":290},[897],{"type":175,"value":898}," checkerWrapper",{"type":169,"tag":271,"props":900,"children":901},{"style":381},[902],{"type":175,"value":384},{"type":169,"tag":271,"props":904,"children":905},{"style":278},[906],{"type":175,"value":907},"checker",{"type":169,"tag":271,"props":909,"children":910},{"style":284},[911],{"type":175,"value":470},{"type":169,"tag":271,"props":913,"children":914},{"style":764},[915],{"type":175,"value":916}," this",{"type":169,"tag":271,"props":918,"children":919},{"style":284},[920],{"type":175,"value":470},{"type":169,"tag":271,"props":922,"children":923},{"style":779},[924],{"type":175,"value":925}," arguments",{"type":169,"tag":271,"props":927,"children":928},{"style":284},[929],{"type":175,"value":470},{"type":169,"tag":271,"props":931,"children":932},{"style":301},[933],{"type":175,"value":304},{"type":169,"tag":271,"props":935,"children":936},{"style":284},[937],{"type":175,"value":384},{"type":169,"tag":271,"props":939,"children":940},{"style":328},[941],{"type":175,"value":942},"args",{"type":169,"tag":271,"props":944,"children":945},{"style":284},[946],{"type":175,"value":470},{"type":169,"tag":271,"props":948,"children":949},{"style":328},[950],{"type":175,"value":951}," check",{"type":169,"tag":271,"props":953,"children":954},{"style":284},[955],{"type":175,"value":346},{"type":169,"tag":271,"props":957,"children":958},{"class":273,"line":489},[959,964,969,974,978,983,987,992,996,1000],{"type":169,"tag":271,"props":960,"children":961},{"style":301},[962],{"type":175,"value":963},"      const",{"type":169,"tag":271,"props":965,"children":966},{"style":284},[967],{"type":175,"value":968}," {",{"type":169,"tag":271,"props":970,"children":971},{"style":358},[972],{"type":175,"value":973},"notify",{"type":169,"tag":271,"props":975,"children":976},{"style":284},[977],{"type":175,"value":470},{"type":169,"tag":271,"props":979,"children":980},{"style":358},[981],{"type":175,"value":982}," original",{"type":169,"tag":271,"props":984,"children":985},{"style":284},[986],{"type":175,"value":470},{"type":169,"tag":271,"props":988,"children":989},{"style":358},[990],{"type":175,"value":991}," prefs",{"type":169,"tag":271,"props":993,"children":994},{"style":284},[995],{"type":175,"value":422},{"type":169,"tag":271,"props":997,"children":998},{"style":295},[999],{"type":175,"value":298},{"type":169,"tag":271,"props":1001,"children":1002},{"style":278},[1003],{"type":175,"value":1004}," check\n",{"type":169,"tag":271,"props":1006,"children":1007},{"class":273,"line":546},[1008],{"type":169,"tag":271,"props":1009,"children":1010},{"emptyLinePlaceholder":162},[1011],{"type":175,"value":1012},"\n",{"type":169,"tag":271,"props":1014,"children":1015},{"class":273,"line":583},[1016],{"type":169,"tag":271,"props":1017,"children":1018},{"style":737},[1019],{"type":175,"value":1020},"      // 读取 b.com 的 window.name 可能会返回 a.com 的 window.name\n",{"type":169,"tag":271,"props":1022,"children":1023},{"class":273,"line":620},[1024,1028,1033,1037,1041,1045,1049,1053,1057,1061,1065,1069],{"type":169,"tag":271,"props":1025,"children":1026},{"style":301},[1027],{"type":175,"value":963},{"type":169,"tag":271,"props":1029,"children":1030},{"style":358},[1031],{"type":175,"value":1032}," originalName",{"type":169,"tag":271,"props":1034,"children":1035},{"style":295},[1036],{"type":175,"value":298},{"type":169,"tag":271,"props":1038,"children":1039},{"style":278},[1040],{"type":175,"value":982},{"type":169,"tag":271,"props":1042,"children":1043},{"style":284},[1044],{"type":175,"value":287},{"type":169,"tag":271,"props":1046,"children":1047},{"style":290},[1048],{"type":175,"value":757},{"type":169,"tag":271,"props":1050,"children":1051},{"style":381},[1052],{"type":175,"value":384},{"type":169,"tag":271,"props":1054,"children":1055},{"style":764},[1056],{"type":175,"value":767},{"type":169,"tag":271,"props":1058,"children":1059},{"style":284},[1060],{"type":175,"value":470},{"type":169,"tag":271,"props":1062,"children":1063},{"style":295},[1064],{"type":175,"value":776},{"type":169,"tag":271,"props":1066,"children":1067},{"style":278},[1068],{"type":175,"value":942},{"type":169,"tag":271,"props":1070,"children":1071},{"style":381},[1072],{"type":175,"value":427},{"type":169,"tag":271,"props":1074,"children":1075},{"class":273,"line":629},[1076],{"type":169,"tag":271,"props":1077,"children":1078},{"emptyLinePlaceholder":162},[1079],{"type":175,"value":1012},{"type":169,"tag":271,"props":1081,"children":1083},{"class":273,"line":1082},9,[1084],{"type":169,"tag":271,"props":1085,"children":1086},{"style":737},[1087],{"type":175,"value":1088},"      // 根据配置，iframes 中返回的 window.name 可以赦免此伪造规则，\n",{"type":169,"tag":271,"props":1090,"children":1092},{"class":273,"line":1091},10,[1093],{"type":169,"tag":271,"props":1094,"children":1095},{"style":737},[1096],{"type":175,"value":1097},"      // this !== this.top 是一种快速检测当前 window 是否在 iframe 中的方法\n",{"type":169,"tag":271,"props":1099,"children":1101},{"class":273,"line":1100},11,[1102,1107],{"type":169,"tag":271,"props":1103,"children":1104},{"style":493},[1105],{"type":175,"value":1106},"      if",{"type":169,"tag":271,"props":1108,"children":1109},{"style":381},[1110],{"type":175,"value":1111}," (\n",{"type":169,"tag":271,"props":1113,"children":1115},{"class":273,"line":1114},12,[1116,1121,1125,1129,1133,1138],{"type":169,"tag":271,"props":1117,"children":1118},{"style":764},[1119],{"type":175,"value":1120},"        this",{"type":169,"tag":271,"props":1122,"children":1123},{"style":295},[1124],{"type":175,"value":520},{"type":169,"tag":271,"props":1126,"children":1127},{"style":764},[1128],{"type":175,"value":916},{"type":169,"tag":271,"props":1130,"children":1131},{"style":284},[1132],{"type":175,"value":287},{"type":169,"tag":271,"props":1134,"children":1135},{"style":278},[1136],{"type":175,"value":1137},"top",{"type":169,"tag":271,"props":1139,"children":1140},{"style":295},[1141],{"type":175,"value":1142}," &&\n",{"type":169,"tag":271,"props":1144,"children":1146},{"class":273,"line":1145},13,[1147,1152,1156,1160,1165,1169,1173,1177,1181,1186],{"type":169,"tag":271,"props":1148,"children":1149},{"style":290},[1150],{"type":175,"value":1151},"        prefs",{"type":169,"tag":271,"props":1153,"children":1154},{"style":381},[1155],{"type":175,"value":384},{"type":169,"tag":271,"props":1157,"children":1158},{"style":452},[1159],{"type":175,"value":455},{"type":169,"tag":271,"props":1161,"children":1162},{"style":458},[1163],{"type":175,"value":1164},"allowWindowNameInFrames",{"type":169,"tag":271,"props":1166,"children":1167},{"style":452},[1168],{"type":175,"value":455},{"type":169,"tag":271,"props":1170,"children":1171},{"style":284},[1172],{"type":175,"value":470},{"type":169,"tag":271,"props":1174,"children":1175},{"style":764},[1176],{"type":175,"value":916},{"type":169,"tag":271,"props":1178,"children":1179},{"style":284},[1180],{"type":175,"value":287},{"type":169,"tag":271,"props":1182,"children":1183},{"style":278},[1184],{"type":175,"value":1185},"location",{"type":169,"tag":271,"props":1187,"children":1188},{"style":381},[1189],{"type":175,"value":427},{"type":169,"tag":271,"props":1191,"children":1193},{"class":273,"line":1192},14,[1194,1199],{"type":169,"tag":271,"props":1195,"children":1196},{"style":381},[1197],{"type":175,"value":1198},"      )",{"type":169,"tag":271,"props":1200,"children":1201},{"style":284},[1202],{"type":175,"value":543},{"type":169,"tag":271,"props":1204,"children":1206},{"class":273,"line":1205},15,[1207,1212],{"type":169,"tag":271,"props":1208,"children":1209},{"style":493},[1210],{"type":175,"value":1211},"        return",{"type":169,"tag":271,"props":1213,"children":1214},{"style":278},[1215],{"type":175,"value":1216}," originalName\n",{"type":169,"tag":271,"props":1218,"children":1220},{"class":273,"line":1219},16,[1221],{"type":169,"tag":271,"props":1222,"children":1223},{"style":284},[1224],{"type":175,"value":1225},"      }\n",{"type":169,"tag":271,"props":1227,"children":1229},{"class":273,"line":1228},17,[1230],{"type":169,"tag":271,"props":1231,"children":1232},{"emptyLinePlaceholder":162},[1233],{"type":175,"value":1012},{"type":169,"tag":271,"props":1235,"children":1237},{"class":273,"line":1236},18,[1238],{"type":169,"tag":271,"props":1239,"children":1240},{"style":737},[1241],{"type":175,"value":1242},"      // 只有通过显式的 window.name = 'xxx' 才会触发 windowNames 中记录的值的改变，\n",{"type":169,"tag":271,"props":1244,"children":1246},{"class":273,"line":1245},19,[1247],{"type":169,"tag":271,"props":1248,"children":1249},{"style":737},[1250],{"type":175,"value":1251},"      // 所以一旦 windowNames 记录的值和 originalName 不一样，\n",{"type":169,"tag":271,"props":1253,"children":1255},{"class":273,"line":1254},20,[1256],{"type":169,"tag":271,"props":1257,"children":1258},{"style":737},[1259],{"type":175,"value":1260},"      // 就说明当前浏览器犯了 window.name 泄露的错误\n",{"type":169,"tag":271,"props":1262,"children":1264},{"class":273,"line":1263},21,[1265,1269,1274,1278,1283,1287,1292,1296,1300,1305,1310],{"type":169,"tag":271,"props":1266,"children":1267},{"style":301},[1268],{"type":175,"value":963},{"type":169,"tag":271,"props":1270,"children":1271},{"style":358},[1272],{"type":175,"value":1273}," returnedName",{"type":169,"tag":271,"props":1275,"children":1276},{"style":295},[1277],{"type":175,"value":298},{"type":169,"tag":271,"props":1279,"children":1280},{"style":278},[1281],{"type":175,"value":1282}," windowNames",{"type":169,"tag":271,"props":1284,"children":1285},{"style":284},[1286],{"type":175,"value":287},{"type":169,"tag":271,"props":1288,"children":1289},{"style":290},[1290],{"type":175,"value":1291},"get",{"type":169,"tag":271,"props":1293,"children":1294},{"style":381},[1295],{"type":175,"value":384},{"type":169,"tag":271,"props":1297,"children":1298},{"style":764},[1299],{"type":175,"value":767},{"type":169,"tag":271,"props":1301,"children":1302},{"style":381},[1303],{"type":175,"value":1304},") ",{"type":169,"tag":271,"props":1306,"children":1307},{"style":295},[1308],{"type":175,"value":1309},"||",{"type":169,"tag":271,"props":1311,"children":1312},{"style":452},[1313],{"type":175,"value":1314}," \"\"\n",{"type":169,"tag":271,"props":1316,"children":1318},{"class":273,"line":1317},22,[1319,1323,1327,1332,1336,1340,1344],{"type":169,"tag":271,"props":1320,"children":1321},{"style":493},[1322],{"type":175,"value":1106},{"type":169,"tag":271,"props":1324,"children":1325},{"style":381},[1326],{"type":175,"value":501},{"type":169,"tag":271,"props":1328,"children":1329},{"style":278},[1330],{"type":175,"value":1331},"originalName",{"type":169,"tag":271,"props":1333,"children":1334},{"style":295},[1335],{"type":175,"value":520},{"type":169,"tag":271,"props":1337,"children":1338},{"style":278},[1339],{"type":175,"value":1273},{"type":169,"tag":271,"props":1341,"children":1342},{"style":381},[1343],{"type":175,"value":417},{"type":169,"tag":271,"props":1345,"children":1346},{"style":284},[1347],{"type":175,"value":543},{"type":169,"tag":271,"props":1349,"children":1351},{"class":273,"line":1350},23,[1352,1357,1361,1365,1370,1374],{"type":169,"tag":271,"props":1353,"children":1354},{"style":290},[1355],{"type":175,"value":1356},"        notify",{"type":169,"tag":271,"props":1358,"children":1359},{"style":381},[1360],{"type":175,"value":384},{"type":169,"tag":271,"props":1362,"children":1363},{"style":452},[1364],{"type":175,"value":455},{"type":169,"tag":271,"props":1366,"children":1367},{"style":458},[1368],{"type":175,"value":1369},"fakedWindowReadout",{"type":169,"tag":271,"props":1371,"children":1372},{"style":452},[1373],{"type":175,"value":455},{"type":169,"tag":271,"props":1375,"children":1376},{"style":381},[1377],{"type":175,"value":427},{"type":169,"tag":271,"props":1379,"children":1381},{"class":273,"line":1380},24,[1382],{"type":169,"tag":271,"props":1383,"children":1384},{"style":284},[1385],{"type":175,"value":1225},{"type":169,"tag":271,"props":1387,"children":1389},{"class":273,"line":1388},25,[1390,1395],{"type":169,"tag":271,"props":1391,"children":1392},{"style":493},[1393],{"type":175,"value":1394},"      return",{"type":169,"tag":271,"props":1396,"children":1397},{"style":278},[1398],{"type":175,"value":1399}," returnedName\n",{"type":169,"tag":271,"props":1401,"children":1403},{"class":273,"line":1402},26,[1404,1409,1413],{"type":169,"tag":271,"props":1405,"children":1406},{"style":284},[1407],{"type":175,"value":1408},"    }",{"type":169,"tag":271,"props":1410,"children":1411},{"style":381},[1412],{"type":175,"value":417},{"type":169,"tag":271,"props":1414,"children":1415},{"style":284},[1416],{"type":175,"value":1417},";\n",{"type":169,"tag":271,"props":1419,"children":1421},{"class":273,"line":1420},27,[1422],{"type":169,"tag":271,"props":1423,"children":1424},{"style":284},[1425],{"type":175,"value":626},{"type":169,"tag":271,"props":1427,"children":1429},{"class":273,"line":1428},28,[1430],{"type":169,"tag":271,"props":1431,"children":1432},{"style":284},[1433],{"type":175,"value":635},{"type":169,"tag":177,"props":1435,"children":1437},{"id":1436},"windowopener",[1438],{"type":175,"value":1439},"window.opener",{"type":169,"tag":183,"props":1441,"children":1442},{},[1443],{"type":175,"value":1444},"在过去的浏览器中，当页面通过超链接或 window.open 的方式从 A 网站跳转到 B 网站时，如果制定了 target 属性却没有指定 rel=\"norefer\" 属性，那么在 B 网站是可以使用 window.opener 获取到 A 网站的部分信息的。也就是说，在 B 网站中可以修改 window.opener.location.href = 'x' 从而让 A 网站自动跳转到 X 网站。如果页面跳转时使用 target=\"__blank\" 打开了新页面，那么用户更加不可能注意到 A 网站的恶意跳转。",{"type":169,"tag":189,"props":1446,"children":1447},{},[1448],{"type":169,"tag":193,"props":1449,"children":1450},{},[1451],{"type":169,"tag":665,"props":1452,"children":1455},{"href":1453,"rel":1454},"https://cwe.mitre.org/data/definitions/1022.html",[669],[1456],{"type":175,"value":1457},"CWE-1022: Use of Web Link to Untrusted Target with window.opener Access",{"type":169,"tag":183,"props":1459,"children":1460},{},[1461],{"type":175,"value":1462},"Blocker 对 window.opener 的防范比较简单，直接返回 null 就完事儿了。考虑到现代浏览器已经修复了这个漏洞，该篡改的设置的值默认是关闭的。",{"type":169,"tag":260,"props":1464,"children":1466},{"className":262,"code":1465,"language":264,"meta":163,"style":163},"{\n  // 修改 Getter 使 window.opener 一直返回 null\n  getterGenerator: function(checker){\n    const temp = {\n      get opener(){\n        return checkerWrapper(checker, this, arguments, function(args, check){\n          const {notify, original} = check\n          const originalOpener = original.call(this, ...args)\n          if (originalOpener !== null){\n            notify(\"fakedWindowReadout\")\n          }\n          return null\n        })\n      }\n    }\n    return Object.getOwnPropertyDescriptor(temp, \"opener\").get\n  },\n  // 修改 Descriptor.Value 使得 window.opener 一直返回 null，\n  // 这是一种兼容，在部分浏览器中，\n  //  window.opener 是通过 value 而不是 getter 获取的值\n  valueGenerator: function({original, notify}){\n    if (original !== null){\n      notify(\"fakedWindowReadout\")\n    }\n    return null\n  }\n}\n",[1467],{"type":169,"tag":267,"props":1468,"children":1469},{"__ignoreMap":163},[1470,1477,1485,1514,1536,1555,1618,1654,1706,1741,1769,1777,1790,1802,1809,1817,1877,1885,1893,1901,1909,1948,1980,2008,2015,2026,2033],{"type":169,"tag":271,"props":1471,"children":1472},{"class":273,"line":274},[1473],{"type":169,"tag":271,"props":1474,"children":1475},{"style":284},[1476],{"type":175,"value":543},{"type":169,"tag":271,"props":1478,"children":1479},{"class":273,"line":349},[1480],{"type":169,"tag":271,"props":1481,"children":1482},{"style":737},[1483],{"type":175,"value":1484},"  // 修改 Getter 使 window.opener 一直返回 null\n",{"type":169,"tag":271,"props":1486,"children":1487},{"class":273,"line":430},[1488,1494,1498,1502,1506,1510],{"type":169,"tag":271,"props":1489,"children":1491},{"style":1490},"--shiki-light:#E2931D;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#F8F8F2",[1492],{"type":175,"value":1493},"  getterGenerator",{"type":169,"tag":271,"props":1495,"children":1496},{"style":284},[1497],{"type":175,"value":325},{"type":169,"tag":271,"props":1499,"children":1500},{"style":301},[1501],{"type":175,"value":304},{"type":169,"tag":271,"props":1503,"children":1504},{"style":284},[1505],{"type":175,"value":384},{"type":169,"tag":271,"props":1507,"children":1508},{"style":328},[1509],{"type":175,"value":907},{"type":169,"tag":271,"props":1511,"children":1512},{"style":284},[1513],{"type":175,"value":346},{"type":169,"tag":271,"props":1515,"children":1516},{"class":273,"line":489},[1517,1522,1527,1531],{"type":169,"tag":271,"props":1518,"children":1519},{"style":301},[1520],{"type":175,"value":1521},"    const",{"type":169,"tag":271,"props":1523,"children":1524},{"style":358},[1525],{"type":175,"value":1526}," temp",{"type":169,"tag":271,"props":1528,"children":1529},{"style":295},[1530],{"type":175,"value":298},{"type":169,"tag":271,"props":1532,"children":1533},{"style":284},[1534],{"type":175,"value":1535}," {\n",{"type":169,"tag":271,"props":1537,"children":1538},{"class":273,"line":546},[1539,1544,1550],{"type":169,"tag":271,"props":1540,"children":1541},{"style":301},[1542],{"type":175,"value":1543},"      get",{"type":169,"tag":271,"props":1545,"children":1547},{"style":1546},"--shiki-light:#E53935;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[1548],{"type":175,"value":1549}," opener",{"type":169,"tag":271,"props":1551,"children":1552},{"style":284},[1553],{"type":175,"value":1554},"(){\n",{"type":169,"tag":271,"props":1556,"children":1557},{"class":273,"line":583},[1558,1562,1566,1570,1574,1578,1582,1586,1590,1594,1598,1602,1606,1610,1614],{"type":169,"tag":271,"props":1559,"children":1560},{"style":493},[1561],{"type":175,"value":1211},{"type":169,"tag":271,"props":1563,"children":1564},{"style":290},[1565],{"type":175,"value":898},{"type":169,"tag":271,"props":1567,"children":1568},{"style":381},[1569],{"type":175,"value":384},{"type":169,"tag":271,"props":1571,"children":1572},{"style":278},[1573],{"type":175,"value":907},{"type":169,"tag":271,"props":1575,"children":1576},{"style":284},[1577],{"type":175,"value":470},{"type":169,"tag":271,"props":1579,"children":1580},{"style":764},[1581],{"type":175,"value":916},{"type":169,"tag":271,"props":1583,"children":1584},{"style":284},[1585],{"type":175,"value":470},{"type":169,"tag":271,"props":1587,"children":1588},{"style":779},[1589],{"type":175,"value":925},{"type":169,"tag":271,"props":1591,"children":1592},{"style":284},[1593],{"type":175,"value":470},{"type":169,"tag":271,"props":1595,"children":1596},{"style":301},[1597],{"type":175,"value":304},{"type":169,"tag":271,"props":1599,"children":1600},{"style":284},[1601],{"type":175,"value":384},{"type":169,"tag":271,"props":1603,"children":1604},{"style":328},[1605],{"type":175,"value":942},{"type":169,"tag":271,"props":1607,"children":1608},{"style":284},[1609],{"type":175,"value":470},{"type":169,"tag":271,"props":1611,"children":1612},{"style":328},[1613],{"type":175,"value":951},{"type":169,"tag":271,"props":1615,"children":1616},{"style":284},[1617],{"type":175,"value":346},{"type":169,"tag":271,"props":1619,"children":1620},{"class":273,"line":620},[1621,1626,1630,1634,1638,1642,1646,1650],{"type":169,"tag":271,"props":1622,"children":1623},{"style":301},[1624],{"type":175,"value":1625},"          const",{"type":169,"tag":271,"props":1627,"children":1628},{"style":284},[1629],{"type":175,"value":968},{"type":169,"tag":271,"props":1631,"children":1632},{"style":358},[1633],{"type":175,"value":973},{"type":169,"tag":271,"props":1635,"children":1636},{"style":284},[1637],{"type":175,"value":470},{"type":169,"tag":271,"props":1639,"children":1640},{"style":358},[1641],{"type":175,"value":982},{"type":169,"tag":271,"props":1643,"children":1644},{"style":284},[1645],{"type":175,"value":422},{"type":169,"tag":271,"props":1647,"children":1648},{"style":295},[1649],{"type":175,"value":298},{"type":169,"tag":271,"props":1651,"children":1652},{"style":278},[1653],{"type":175,"value":1004},{"type":169,"tag":271,"props":1655,"children":1656},{"class":273,"line":629},[1657,1661,1666,1670,1674,1678,1682,1686,1690,1694,1698,1702],{"type":169,"tag":271,"props":1658,"children":1659},{"style":301},[1660],{"type":175,"value":1625},{"type":169,"tag":271,"props":1662,"children":1663},{"style":358},[1664],{"type":175,"value":1665}," originalOpener",{"type":169,"tag":271,"props":1667,"children":1668},{"style":295},[1669],{"type":175,"value":298},{"type":169,"tag":271,"props":1671,"children":1672},{"style":278},[1673],{"type":175,"value":982},{"type":169,"tag":271,"props":1675,"children":1676},{"style":284},[1677],{"type":175,"value":287},{"type":169,"tag":271,"props":1679,"children":1680},{"style":290},[1681],{"type":175,"value":757},{"type":169,"tag":271,"props":1683,"children":1684},{"style":381},[1685],{"type":175,"value":384},{"type":169,"tag":271,"props":1687,"children":1688},{"style":764},[1689],{"type":175,"value":767},{"type":169,"tag":271,"props":1691,"children":1692},{"style":284},[1693],{"type":175,"value":470},{"type":169,"tag":271,"props":1695,"children":1696},{"style":295},[1697],{"type":175,"value":776},{"type":169,"tag":271,"props":1699,"children":1700},{"style":278},[1701],{"type":175,"value":942},{"type":169,"tag":271,"props":1703,"children":1704},{"style":381},[1705],{"type":175,"value":427},{"type":169,"tag":271,"props":1707,"children":1708},{"class":273,"line":1082},[1709,1714,1718,1723,1727,1733,1737],{"type":169,"tag":271,"props":1710,"children":1711},{"style":493},[1712],{"type":175,"value":1713},"          if",{"type":169,"tag":271,"props":1715,"children":1716},{"style":381},[1717],{"type":175,"value":501},{"type":169,"tag":271,"props":1719,"children":1720},{"style":278},[1721],{"type":175,"value":1722},"originalOpener",{"type":169,"tag":271,"props":1724,"children":1725},{"style":295},[1726],{"type":175,"value":520},{"type":169,"tag":271,"props":1728,"children":1730},{"style":1729},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[1731],{"type":175,"value":1732}," null",{"type":169,"tag":271,"props":1734,"children":1735},{"style":381},[1736],{"type":175,"value":417},{"type":169,"tag":271,"props":1738,"children":1739},{"style":284},[1740],{"type":175,"value":543},{"type":169,"tag":271,"props":1742,"children":1743},{"class":273,"line":1091},[1744,1749,1753,1757,1761,1765],{"type":169,"tag":271,"props":1745,"children":1746},{"style":290},[1747],{"type":175,"value":1748},"            notify",{"type":169,"tag":271,"props":1750,"children":1751},{"style":381},[1752],{"type":175,"value":384},{"type":169,"tag":271,"props":1754,"children":1755},{"style":452},[1756],{"type":175,"value":455},{"type":169,"tag":271,"props":1758,"children":1759},{"style":458},[1760],{"type":175,"value":1369},{"type":169,"tag":271,"props":1762,"children":1763},{"style":452},[1764],{"type":175,"value":455},{"type":169,"tag":271,"props":1766,"children":1767},{"style":381},[1768],{"type":175,"value":427},{"type":169,"tag":271,"props":1770,"children":1771},{"class":273,"line":1100},[1772],{"type":169,"tag":271,"props":1773,"children":1774},{"style":284},[1775],{"type":175,"value":1776},"          }\n",{"type":169,"tag":271,"props":1778,"children":1779},{"class":273,"line":1114},[1780,1785],{"type":169,"tag":271,"props":1781,"children":1782},{"style":493},[1783],{"type":175,"value":1784},"          return",{"type":169,"tag":271,"props":1786,"children":1787},{"style":1729},[1788],{"type":175,"value":1789}," null\n",{"type":169,"tag":271,"props":1791,"children":1792},{"class":273,"line":1145},[1793,1798],{"type":169,"tag":271,"props":1794,"children":1795},{"style":284},[1796],{"type":175,"value":1797},"        }",{"type":169,"tag":271,"props":1799,"children":1800},{"style":381},[1801],{"type":175,"value":427},{"type":169,"tag":271,"props":1803,"children":1804},{"class":273,"line":1192},[1805],{"type":169,"tag":271,"props":1806,"children":1807},{"style":284},[1808],{"type":175,"value":1225},{"type":169,"tag":271,"props":1810,"children":1811},{"class":273,"line":1205},[1812],{"type":169,"tag":271,"props":1813,"children":1814},{"style":284},[1815],{"type":175,"value":1816},"    }\n",{"type":169,"tag":271,"props":1818,"children":1819},{"class":273,"line":1219},[1820,1824,1829,1833,1838,1842,1847,1851,1855,1860,1864,1868,1872],{"type":169,"tag":271,"props":1821,"children":1822},{"style":493},[1823],{"type":175,"value":893},{"type":169,"tag":271,"props":1825,"children":1826},{"style":278},[1827],{"type":175,"value":1828}," Object",{"type":169,"tag":271,"props":1830,"children":1831},{"style":284},[1832],{"type":175,"value":287},{"type":169,"tag":271,"props":1834,"children":1835},{"style":290},[1836],{"type":175,"value":1837},"getOwnPropertyDescriptor",{"type":169,"tag":271,"props":1839,"children":1840},{"style":381},[1841],{"type":175,"value":384},{"type":169,"tag":271,"props":1843,"children":1844},{"style":278},[1845],{"type":175,"value":1846},"temp",{"type":169,"tag":271,"props":1848,"children":1849},{"style":284},[1850],{"type":175,"value":470},{"type":169,"tag":271,"props":1852,"children":1853},{"style":452},[1854],{"type":175,"value":525},{"type":169,"tag":271,"props":1856,"children":1857},{"style":458},[1858],{"type":175,"value":1859},"opener",{"type":169,"tag":271,"props":1861,"children":1862},{"style":452},[1863],{"type":175,"value":455},{"type":169,"tag":271,"props":1865,"children":1866},{"style":381},[1867],{"type":175,"value":417},{"type":169,"tag":271,"props":1869,"children":1870},{"style":284},[1871],{"type":175,"value":287},{"type":169,"tag":271,"props":1873,"children":1874},{"style":278},[1875],{"type":175,"value":1876},"get\n",{"type":169,"tag":271,"props":1878,"children":1879},{"class":273,"line":1228},[1880],{"type":169,"tag":271,"props":1881,"children":1882},{"style":284},[1883],{"type":175,"value":1884},"  },\n",{"type":169,"tag":271,"props":1886,"children":1887},{"class":273,"line":1236},[1888],{"type":169,"tag":271,"props":1889,"children":1890},{"style":737},[1891],{"type":175,"value":1892},"  // 修改 Descriptor.Value 使得 window.opener 一直返回 null，\n",{"type":169,"tag":271,"props":1894,"children":1895},{"class":273,"line":1245},[1896],{"type":169,"tag":271,"props":1897,"children":1898},{"style":737},[1899],{"type":175,"value":1900},"  // 这是一种兼容，在部分浏览器中，\n",{"type":169,"tag":271,"props":1902,"children":1903},{"class":273,"line":1254},[1904],{"type":169,"tag":271,"props":1905,"children":1906},{"style":737},[1907],{"type":175,"value":1908},"  //  window.opener 是通过 value 而不是 getter 获取的值\n",{"type":169,"tag":271,"props":1910,"children":1911},{"class":273,"line":1263},[1912,1917,1921,1925,1929,1934,1938,1943],{"type":169,"tag":271,"props":1913,"children":1914},{"style":1490},[1915],{"type":175,"value":1916},"  valueGenerator",{"type":169,"tag":271,"props":1918,"children":1919},{"style":284},[1920],{"type":175,"value":325},{"type":169,"tag":271,"props":1922,"children":1923},{"style":301},[1924],{"type":175,"value":304},{"type":169,"tag":271,"props":1926,"children":1927},{"style":284},[1928],{"type":175,"value":314},{"type":169,"tag":271,"props":1930,"children":1931},{"style":328},[1932],{"type":175,"value":1933},"original",{"type":169,"tag":271,"props":1935,"children":1936},{"style":284},[1937],{"type":175,"value":470},{"type":169,"tag":271,"props":1939,"children":1940},{"style":328},[1941],{"type":175,"value":1942}," notify",{"type":169,"tag":271,"props":1944,"children":1945},{"style":284},[1946],{"type":175,"value":1947},"}){\n",{"type":169,"tag":271,"props":1949,"children":1950},{"class":273,"line":1317},[1951,1956,1960,1964,1968,1972,1976],{"type":169,"tag":271,"props":1952,"children":1953},{"style":493},[1954],{"type":175,"value":1955},"    if",{"type":169,"tag":271,"props":1957,"children":1958},{"style":381},[1959],{"type":175,"value":501},{"type":169,"tag":271,"props":1961,"children":1962},{"style":278},[1963],{"type":175,"value":1933},{"type":169,"tag":271,"props":1965,"children":1966},{"style":295},[1967],{"type":175,"value":520},{"type":169,"tag":271,"props":1969,"children":1970},{"style":1729},[1971],{"type":175,"value":1732},{"type":169,"tag":271,"props":1973,"children":1974},{"style":381},[1975],{"type":175,"value":417},{"type":169,"tag":271,"props":1977,"children":1978},{"style":284},[1979],{"type":175,"value":543},{"type":169,"tag":271,"props":1981,"children":1982},{"class":273,"line":1350},[1983,1988,1992,1996,2000,2004],{"type":169,"tag":271,"props":1984,"children":1985},{"style":290},[1986],{"type":175,"value":1987},"      notify",{"type":169,"tag":271,"props":1989,"children":1990},{"style":381},[1991],{"type":175,"value":384},{"type":169,"tag":271,"props":1993,"children":1994},{"style":452},[1995],{"type":175,"value":455},{"type":169,"tag":271,"props":1997,"children":1998},{"style":458},[1999],{"type":175,"value":1369},{"type":169,"tag":271,"props":2001,"children":2002},{"style":452},[2003],{"type":175,"value":455},{"type":169,"tag":271,"props":2005,"children":2006},{"style":381},[2007],{"type":175,"value":427},{"type":169,"tag":271,"props":2009,"children":2010},{"class":273,"line":1380},[2011],{"type":169,"tag":271,"props":2012,"children":2013},{"style":284},[2014],{"type":175,"value":1816},{"type":169,"tag":271,"props":2016,"children":2017},{"class":273,"line":1388},[2018,2022],{"type":169,"tag":271,"props":2019,"children":2020},{"style":493},[2021],{"type":175,"value":893},{"type":169,"tag":271,"props":2023,"children":2024},{"style":1729},[2025],{"type":175,"value":1789},{"type":169,"tag":271,"props":2027,"children":2028},{"class":273,"line":1402},[2029],{"type":169,"tag":271,"props":2030,"children":2031},{"style":284},[2032],{"type":175,"value":626},{"type":169,"tag":271,"props":2034,"children":2035},{"class":273,"line":1420},[2036],{"type":169,"tag":271,"props":2037,"children":2038},{"style":284},[2039],{"type":175,"value":635},{"type":169,"tag":177,"props":2041,"children":2043},{"id":2042},"canvas",[2044],{"type":175,"value":2045},"Canvas",{"type":169,"tag":183,"props":2047,"children":2048},{},[2049],{"type":175,"value":2050},"伪造了 getContext、getDataURL 等 API，并替代了原本正常的 API。",{"type":169,"tag":177,"props":2052,"children":2054},{"id":2053},"相关链接",[2055],{"type":175,"value":2053},{"type":169,"tag":189,"props":2057,"children":2058},{},[2059],{"type":169,"tag":193,"props":2060,"children":2061},{},[2062],{"type":169,"tag":665,"props":2063,"children":2066},{"href":2064,"rel":2065},"https://github.com/kkapsner/CanvasBlocker",[669],[2067],{"type":175,"value":2068},"CanvasBlocker",{"type":169,"tag":2070,"props":2071,"children":2072},"style",{},[2073],{"type":175,"value":2074},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":163,"searchDepth":349,"depth":349,"links":2076},[2077,2078,2079,2082,2083,2084],{"id":179,"depth":349,"text":179},{"id":245,"depth":349,"text":248},{"id":638,"depth":349,"text":217,"children":2080},[2081],{"id":649,"depth":430,"text":652},{"id":1436,"depth":349,"text":1439},{"id":2042,"depth":349,"text":2045},{"id":2053,"depth":349,"text":2053},"markdown","content:8.source-code:_fingerprint:canvas-blocker.md","content","8.source-code/_fingerprint/canvas-blocker.md","8.source-code/_fingerprint/canvas-blocker","md",[2092,2095],{"_path":2093,"title":2094,"description":163},"/source-code/_es/object-assign","Object.prototype.assign",{"_path":2096,"title":2097,"description":163},"/source-code/_js/element-plus","ElementPlus",1742808207307]