[{"data":1,"prerenderedAt":2101},["ShallowReactive",2],{"navigation":3,"/source-code/_fingerprint/canvas-blocker":161,"/source-code/_fingerprint/canvas-blocker-surround":2094},[4,35,92,98,125,131,155],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29,32],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🚝 四十二篇系列","/flows/fourty-two",{"title":15,"_path":16},"🌃 长夜梦","/flows/long-night-dream",{"title":18,"_path":19},"🌌 万物联结与幸福感","/flows/everything",{"title":21,"_path":22},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":24,"_path":25},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":27,"_path":28},"🌧️ 我的腼腆","/flows/shy",{"title":30,"_path":31},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":33,"_path":34},"📝 心流归档","/flows/archive",{"title":36,"_path":37,"children":38},"技术博客 / Coder","/articles",[39,41,44,47,50,53,56,59,62,65,68,71,74,77,80,83,86,89],{"title":40,"_path":37},"🦁 欢迎",{"title":42,"_path":43},"🖌️ Blockies Animation","/maps/_fe-framework/motion/blockies-animation",{"title":45,"_path":46},"🌪️ Tailwind v4 如何兼容预处理器","/articles/tailwind4-with-sass",{"title":48,"_path":49},"🥞 在 tailwind 中使用现代化 CSS Layers","/articles/tailwind-sass-and-css-layer",{"title":51,"_path":52},"💻 本地部署 Qwen 翻译网页","/articles/local-translator",{"title":54,"_path":55},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":57,"_path":58},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":60,"_path":61},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":63,"_path":64},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":66,"_path":67},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":69,"_path":70},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":72,"_path":73},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":75,"_path":76},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":78,"_path":79},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":81,"_path":82},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":84,"_path":85},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":87,"_path":88},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":90,"_path":91},"📝 技术博客归档","/articles/archive",{"title":93,"_path":94,"children":95},"读书笔记 / Notes","/books",[96],{"title":97,"_path":94},"📕 读书笔记",{"title":99,"_path":100,"children":101},"吉他剧场 / Music","/music",[102,104,107,110,113,116,119,122],{"title":103,"_path":100},"🎸 FingerStyle！",{"title":105,"_path":106},"🌬️ 等待的风","/music/wind",{"title":108,"_path":109},"💕 约定的海洋","/music/ocean",{"title":111,"_path":112},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":114,"_path":115},"🌏 残酷天使的行动纲领","/music/eva",{"title":117,"_path":118},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":120,"_path":121},"🍷 Wu Wei","/music/wu-wei",{"title":123,"_path":124},"🌅 无题","/music/untitled",{"title":126,"_path":127,"children":128},"知识地图 / Maps","/maps",[129],{"title":130,"_path":127},"🏁 知识地图",{"title":132,"_path":133,"children":134},"造物 / Make","/tools",[135,137,140,143,146,149,152],{"title":136,"_path":133},"🧰 工具收集",{"title":138,"_path":139},"📕 博客","/tools/blog",{"title":141,"_path":142},"🥥 Coconut","/tools/coconut",{"title":144,"_path":145},"🧶 网易云音乐歌单排序","/tools/netease-sorter",{"title":147,"_path":148},"🌐 AnySort","/tools/anysort",{"title":150,"_path":151},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":153,"_path":154},"👓 Crapto","/tools/crypto-inline",{"title":156,"_path":157,"children":158},"我 / About","/hire",[159],{"title":160,"_path":157},"📬 技术简历",{"_path":162,"_dir":163,"_draft":164,"_partial":165,"_locale":166,"title":167,"description":166,"body":168,"_type":2088,"_id":2089,"_source":2090,"_file":2091,"_stem":2092,"_extension":2093},"/source-code/_fingerprint/canvas-blocker","_fingerprint",false,true,"","Canvas Blocker",{"type":169,"children":170,"toc":2078},"root",[171,179,185,191,241,246,252,257,262,639,644,649,656,661,686,691,849,854,1437,1443,1448,1461,1466,2043,2049,2054,2059,2072],{"type":172,"tag":173,"props":174,"children":176},"element","h1",{"id":175},"canvas-blocker",[177],{"type":178,"value":167},"text",{"type":172,"tag":180,"props":181,"children":183},"h2",{"id":182},"前言",[184],{"type":178,"value":182},{"type":172,"tag":186,"props":187,"children":188},"p",{},[189],{"type":178,"value":190},"最近在看一些反反爬相关的东西，期间找到了 Canvas Blocker 这个神奇的库。他是一个浏览器扩展，声称能拦截以下几种类型的指纹追踪：",{"type":172,"tag":192,"props":193,"children":194},"ul",{},[195,201,206,211,216,221,226,231,236],{"type":172,"tag":196,"props":197,"children":198},"li",{},[199],{"type":178,"value":200},"Canvas 2D",{"type":172,"tag":196,"props":202,"children":203},{},[204],{"type":178,"value":205},"WebGL",{"type":172,"tag":196,"props":207,"children":208},{},[209],{"type":178,"value":210},"Web Audio",{"type":172,"tag":196,"props":212,"children":213},{},[214],{"type":178,"value":215},"History",{"type":172,"tag":196,"props":217,"children":218},{},[219],{"type":178,"value":220},"Window",{"type":172,"tag":196,"props":222,"children":223},{},[224],{"type":178,"value":225},"DOMRect",{"type":172,"tag":196,"props":227,"children":228},{},[229],{"type":178,"value":230},"TextMetrics",{"type":172,"tag":196,"props":232,"children":233},{},[234],{"type":178,"value":235},"Navigator",{"type":172,"tag":196,"props":237,"children":238},{},[239],{"type":178,"value":240},"Screen",{"type":172,"tag":186,"props":242,"children":243},{},[244],{"type":178,"value":245},"让我们大致拆解一下，看看其原理是什么。",{"type":172,"tag":180,"props":247,"children":249},{"id":248},"intercept",[250],{"type":178,"value":251},"Intercept",{"type":172,"tag":186,"props":253,"children":254},{},[255],{"type":178,"value":256},"Blocker 最主要的思路就是用伪造的函数篡改属性的 Getter 以及某些 API。",{"type":172,"tag":186,"props":258,"children":259},{},[260],{"type":178,"value":261},"篡改的入口在 intercept.js 中，先根据页面 URL 检查当前页面是否允许篡改，允许的话就通过 interceptFns、interceptGetters 实施具体步骤。",{"type":172,"tag":263,"props":264,"children":268},"pre",{"className":265,"code":266,"language":267,"meta":166,"style":166},"language-js shiki shiki-themes material-theme-lighter github-light github-dark monokai","scope.intercept = function intercept({subject: windowToProcess}, apis){\n  const siteStatus = apis.check({url: getURL(windowToProcess)})\n  logging.verbose(\"status for page\", windowToProcess, siteStatus)\n  if (siteStatus.mode !== \"allow\"){\n    interceptFunctions(windowToProcess, siteStatus, apis)\n    interceptGetters(windowToProcess, siteStatus, apis)\n  }\n}\n","js",[269],{"type":172,"tag":270,"props":271,"children":272},"code",{"__ignoreMap":166},[273,350,431,490,547,584,621,630],{"type":172,"tag":274,"props":275,"children":278},"span",{"class":276,"line":277},"line",1,[279,285,291,296,302,308,313,318,324,329,335,340,345],{"type":172,"tag":274,"props":280,"children":282},{"style":281},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[283],{"type":178,"value":284},"scope",{"type":172,"tag":274,"props":286,"children":288},{"style":287},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[289],{"type":178,"value":290},".",{"type":172,"tag":274,"props":292,"children":294},{"style":293},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[295],{"type":178,"value":248},{"type":172,"tag":274,"props":297,"children":299},{"style":298},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[300],{"type":178,"value":301}," =",{"type":172,"tag":274,"props":303,"children":305},{"style":304},"--shiki-light:#9C3EDA;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic",[306],{"type":178,"value":307}," function",{"type":172,"tag":274,"props":309,"children":310},{"style":293},[311],{"type":178,"value":312}," intercept",{"type":172,"tag":274,"props":314,"children":315},{"style":287},[316],{"type":178,"value":317},"({",{"type":172,"tag":274,"props":319,"children":321},{"style":320},"--shiki-light:#E53935;--shiki-default:#E36209;--shiki-dark:#FFAB70;--shiki-sepia:#F8F8F2",[322],{"type":178,"value":323},"subject",{"type":172,"tag":274,"props":325,"children":326},{"style":287},[327],{"type":178,"value":328},":",{"type":172,"tag":274,"props":330,"children":332},{"style":331},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#E36209;--shiki-default-font-style:inherit;--shiki-dark:#FFAB70;--shiki-dark-font-style:inherit;--shiki-sepia:#FD971F;--shiki-sepia-font-style:italic",[333],{"type":178,"value":334}," windowToProcess",{"type":172,"tag":274,"props":336,"children":337},{"style":287},[338],{"type":178,"value":339},"},",{"type":172,"tag":274,"props":341,"children":342},{"style":331},[343],{"type":178,"value":344}," apis",{"type":172,"tag":274,"props":346,"children":347},{"style":287},[348],{"type":178,"value":349},"){\n",{"type":172,"tag":274,"props":351,"children":353},{"class":276,"line":352},2,[354,359,365,369,373,377,382,388,393,398,402,407,411,416,421,426],{"type":172,"tag":274,"props":355,"children":356},{"style":304},[357],{"type":178,"value":358},"  const",{"type":172,"tag":274,"props":360,"children":362},{"style":361},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#F8F8F2",[363],{"type":178,"value":364}," siteStatus",{"type":172,"tag":274,"props":366,"children":367},{"style":298},[368],{"type":178,"value":301},{"type":172,"tag":274,"props":370,"children":371},{"style":281},[372],{"type":178,"value":344},{"type":172,"tag":274,"props":374,"children":375},{"style":287},[376],{"type":178,"value":290},{"type":172,"tag":274,"props":378,"children":379},{"style":293},[380],{"type":178,"value":381},"check",{"type":172,"tag":274,"props":383,"children":385},{"style":384},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[386],{"type":178,"value":387},"(",{"type":172,"tag":274,"props":389,"children":390},{"style":287},[391],{"type":178,"value":392},"{",{"type":172,"tag":274,"props":394,"children":395},{"style":384},[396],{"type":178,"value":397},"url",{"type":172,"tag":274,"props":399,"children":400},{"style":287},[401],{"type":178,"value":328},{"type":172,"tag":274,"props":403,"children":404},{"style":293},[405],{"type":178,"value":406}," getURL",{"type":172,"tag":274,"props":408,"children":409},{"style":384},[410],{"type":178,"value":387},{"type":172,"tag":274,"props":412,"children":413},{"style":281},[414],{"type":178,"value":415},"windowToProcess",{"type":172,"tag":274,"props":417,"children":418},{"style":384},[419],{"type":178,"value":420},")",{"type":172,"tag":274,"props":422,"children":423},{"style":287},[424],{"type":178,"value":425},"}",{"type":172,"tag":274,"props":427,"children":428},{"style":384},[429],{"type":178,"value":430},")\n",{"type":172,"tag":274,"props":432,"children":434},{"class":276,"line":433},3,[435,440,444,449,453,459,465,469,474,478,482,486],{"type":172,"tag":274,"props":436,"children":437},{"style":281},[438],{"type":178,"value":439},"  logging",{"type":172,"tag":274,"props":441,"children":442},{"style":287},[443],{"type":178,"value":290},{"type":172,"tag":274,"props":445,"children":446},{"style":293},[447],{"type":178,"value":448},"verbose",{"type":172,"tag":274,"props":450,"children":451},{"style":384},[452],{"type":178,"value":387},{"type":172,"tag":274,"props":454,"children":456},{"style":455},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[457],{"type":178,"value":458},"\"",{"type":172,"tag":274,"props":460,"children":462},{"style":461},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[463],{"type":178,"value":464},"status for page",{"type":172,"tag":274,"props":466,"children":467},{"style":455},[468],{"type":178,"value":458},{"type":172,"tag":274,"props":470,"children":471},{"style":287},[472],{"type":178,"value":473},",",{"type":172,"tag":274,"props":475,"children":476},{"style":281},[477],{"type":178,"value":334},{"type":172,"tag":274,"props":479,"children":480},{"style":287},[481],{"type":178,"value":473},{"type":172,"tag":274,"props":483,"children":484},{"style":281},[485],{"type":178,"value":364},{"type":172,"tag":274,"props":487,"children":488},{"style":384},[489],{"type":178,"value":430},{"type":172,"tag":274,"props":491,"children":493},{"class":276,"line":492},4,[494,500,505,510,514,519,524,529,534,538,542],{"type":172,"tag":274,"props":495,"children":497},{"style":496},"--shiki-light:#39ADB5;--shiki-light-font-style:italic;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#F92672;--shiki-sepia-font-style:inherit",[498],{"type":178,"value":499},"  if",{"type":172,"tag":274,"props":501,"children":502},{"style":384},[503],{"type":178,"value":504}," (",{"type":172,"tag":274,"props":506,"children":507},{"style":281},[508],{"type":178,"value":509},"siteStatus",{"type":172,"tag":274,"props":511,"children":512},{"style":287},[513],{"type":178,"value":290},{"type":172,"tag":274,"props":515,"children":516},{"style":281},[517],{"type":178,"value":518},"mode",{"type":172,"tag":274,"props":520,"children":521},{"style":298},[522],{"type":178,"value":523}," !==",{"type":172,"tag":274,"props":525,"children":526},{"style":455},[527],{"type":178,"value":528}," \"",{"type":172,"tag":274,"props":530,"children":531},{"style":461},[532],{"type":178,"value":533},"allow",{"type":172,"tag":274,"props":535,"children":536},{"style":455},[537],{"type":178,"value":458},{"type":172,"tag":274,"props":539,"children":540},{"style":384},[541],{"type":178,"value":420},{"type":172,"tag":274,"props":543,"children":544},{"style":287},[545],{"type":178,"value":546},"{\n",{"type":172,"tag":274,"props":548,"children":550},{"class":276,"line":549},5,[551,556,560,564,568,572,576,580],{"type":172,"tag":274,"props":552,"children":553},{"style":293},[554],{"type":178,"value":555},"    interceptFunctions",{"type":172,"tag":274,"props":557,"children":558},{"style":384},[559],{"type":178,"value":387},{"type":172,"tag":274,"props":561,"children":562},{"style":281},[563],{"type":178,"value":415},{"type":172,"tag":274,"props":565,"children":566},{"style":287},[567],{"type":178,"value":473},{"type":172,"tag":274,"props":569,"children":570},{"style":281},[571],{"type":178,"value":364},{"type":172,"tag":274,"props":573,"children":574},{"style":287},[575],{"type":178,"value":473},{"type":172,"tag":274,"props":577,"children":578},{"style":281},[579],{"type":178,"value":344},{"type":172,"tag":274,"props":581,"children":582},{"style":384},[583],{"type":178,"value":430},{"type":172,"tag":274,"props":585,"children":587},{"class":276,"line":586},6,[588,593,597,601,605,609,613,617],{"type":172,"tag":274,"props":589,"children":590},{"style":293},[591],{"type":178,"value":592},"    interceptGetters",{"type":172,"tag":274,"props":594,"children":595},{"style":384},[596],{"type":178,"value":387},{"type":172,"tag":274,"props":598,"children":599},{"style":281},[600],{"type":178,"value":415},{"type":172,"tag":274,"props":602,"children":603},{"style":287},[604],{"type":178,"value":473},{"type":172,"tag":274,"props":606,"children":607},{"style":281},[608],{"type":178,"value":364},{"type":172,"tag":274,"props":610,"children":611},{"style":287},[612],{"type":178,"value":473},{"type":172,"tag":274,"props":614,"children":615},{"style":281},[616],{"type":178,"value":344},{"type":172,"tag":274,"props":618,"children":619},{"style":384},[620],{"type":178,"value":430},{"type":172,"tag":274,"props":622,"children":624},{"class":276,"line":623},7,[625],{"type":172,"tag":274,"props":626,"children":627},{"style":287},[628],{"type":178,"value":629},"  }\n",{"type":172,"tag":274,"props":631,"children":633},{"class":276,"line":632},8,[634],{"type":172,"tag":274,"props":635,"children":636},{"style":287},[637],{"type":178,"value":638},"}\n",{"type":172,"tag":180,"props":640,"children":642},{"id":641},"window",[643],{"type":178,"value":220},{"type":172,"tag":186,"props":645,"children":646},{},[647],{"type":178,"value":648},"Blocker 篡改了 Window 的两个属性，window.name 和 window.opener。这两个属性和指纹没有直接关系，但却是一种“帮助函数”，能够帮助恶意网站追踪指纹以及窃取隐私。",{"type":172,"tag":650,"props":651,"children":653},"h3",{"id":652},"windowname",[654],{"type":178,"value":655},"window.name",{"type":172,"tag":186,"props":657,"children":658},{},[659],{"type":178,"value":660},"在过去的浏览器中，window.name 能够跨站点传输数据，并且能逃逸同源策略。从 Firefox 88 开始，用户通过点击超链接跳转到新页面时，window.name 将被置空，不过为了不造成更大的破坏，当用户从跳转后页面回到之前页面时，window.name 会被还原。",{"type":172,"tag":192,"props":662,"children":663},{},[664,676],{"type":172,"tag":196,"props":665,"children":666},{},[667],{"type":172,"tag":668,"props":669,"children":673},"a",{"href":670,"rel":671},"https://blog.mozilla.org/security/2021/04/19/firefox-88-combats-window-name-privacy-abuses/",[672],"nofollow",[674],{"type":178,"value":675},"Firefox 88 combats window.name privacy abuses",{"type":172,"tag":196,"props":677,"children":678},{},[679],{"type":172,"tag":668,"props":680,"children":683},{"href":681,"rel":682},"https://wpt.fyi/results/html/browsers/windows/clear-window-name.https.html?label=master&label=experimental&aligned",[672],[684],{"type":178,"value":685},"clear-window-name@web-platform-tests",{"type":172,"tag":186,"props":687,"children":688},{},[689],{"type":178,"value":690},"在使用 JS 设置 window.name 时，Blcoker 会记录下设置的值。original.call 调用原有的 window.name setter；windowNames 只做记录，稍后会用到。",{"type":172,"tag":263,"props":692,"children":694},{"className":265,"code":693,"language":267,"meta":166,"style":166},"{\n  set name(name){\n    // 调用原有 setting 设置 window.name\n    original.call(this, ...arguments)\n    // 把 name 记录下来\n    windowNames.set(this, name)\n  }\n}\n",[695],{"type":172,"tag":270,"props":696,"children":697},{"__ignoreMap":166},[698,705,735,744,790,798,835,842],{"type":172,"tag":274,"props":699,"children":700},{"class":276,"line":277},[701],{"type":172,"tag":274,"props":702,"children":703},{"style":287},[704],{"type":178,"value":546},{"type":172,"tag":274,"props":706,"children":707},{"class":276,"line":352},[708,713,718,722,727,731],{"type":172,"tag":274,"props":709,"children":710},{"style":281},[711],{"type":178,"value":712},"  set",{"type":172,"tag":274,"props":714,"children":715},{"style":293},[716],{"type":178,"value":717}," name",{"type":172,"tag":274,"props":719,"children":720},{"style":384},[721],{"type":178,"value":387},{"type":172,"tag":274,"props":723,"children":724},{"style":281},[725],{"type":178,"value":726},"name",{"type":172,"tag":274,"props":728,"children":729},{"style":384},[730],{"type":178,"value":420},{"type":172,"tag":274,"props":732,"children":733},{"style":287},[734],{"type":178,"value":546},{"type":172,"tag":274,"props":736,"children":737},{"class":276,"line":433},[738],{"type":172,"tag":274,"props":739,"children":741},{"style":740},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit",[742],{"type":178,"value":743},"    // 调用原有 setting 设置 window.name\n",{"type":172,"tag":274,"props":745,"children":746},{"class":276,"line":492},[747,752,756,761,765,771,775,780,786],{"type":172,"tag":274,"props":748,"children":749},{"style":281},[750],{"type":178,"value":751},"    original",{"type":172,"tag":274,"props":753,"children":754},{"style":287},[755],{"type":178,"value":290},{"type":172,"tag":274,"props":757,"children":758},{"style":293},[759],{"type":178,"value":760},"call",{"type":172,"tag":274,"props":762,"children":763},{"style":384},[764],{"type":178,"value":387},{"type":172,"tag":274,"props":766,"children":768},{"style":767},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[769],{"type":178,"value":770},"this",{"type":172,"tag":274,"props":772,"children":773},{"style":287},[774],{"type":178,"value":473},{"type":172,"tag":274,"props":776,"children":777},{"style":298},[778],{"type":178,"value":779}," ...",{"type":172,"tag":274,"props":781,"children":783},{"style":782},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[784],{"type":178,"value":785},"arguments",{"type":172,"tag":274,"props":787,"children":788},{"style":384},[789],{"type":178,"value":430},{"type":172,"tag":274,"props":791,"children":792},{"class":276,"line":549},[793],{"type":172,"tag":274,"props":794,"children":795},{"style":740},[796],{"type":178,"value":797},"    // 把 name 记录下来\n",{"type":172,"tag":274,"props":799,"children":800},{"class":276,"line":586},[801,806,810,815,819,823,827,831],{"type":172,"tag":274,"props":802,"children":803},{"style":281},[804],{"type":178,"value":805},"    windowNames",{"type":172,"tag":274,"props":807,"children":808},{"style":287},[809],{"type":178,"value":290},{"type":172,"tag":274,"props":811,"children":812},{"style":293},[813],{"type":178,"value":814},"set",{"type":172,"tag":274,"props":816,"children":817},{"style":384},[818],{"type":178,"value":387},{"type":172,"tag":274,"props":820,"children":821},{"style":767},[822],{"type":178,"value":770},{"type":172,"tag":274,"props":824,"children":825},{"style":287},[826],{"type":178,"value":473},{"type":172,"tag":274,"props":828,"children":829},{"style":281},[830],{"type":178,"value":717},{"type":172,"tag":274,"props":832,"children":833},{"style":384},[834],{"type":178,"value":430},{"type":172,"tag":274,"props":836,"children":837},{"class":276,"line":623},[838],{"type":172,"tag":274,"props":839,"children":840},{"style":287},[841],{"type":178,"value":629},{"type":172,"tag":274,"props":843,"children":844},{"class":276,"line":632},[845],{"type":172,"tag":274,"props":846,"children":847},{"style":287},[848],{"type":178,"value":638},{"type":172,"tag":186,"props":850,"children":851},{},[852],{"type":178,"value":853},"因为只有通过显式的 window.name = 'xxx' 才会触发 windowNames 中记录的值的改变，所以一旦在 b.com 读取到的 window.name 不是 windowNames 记录的值，就说明浏览器泄露了 window.name，此时需要返回伪造的值。",{"type":172,"tag":263,"props":855,"children":857},{"className":265,"code":856,"language":267,"meta":166,"style":166},"{\n  get name(){\n    return checkerWrapper(checker, this, arguments, function(args, check){\n      const {notify, original, prefs} = check\n\n      // 读取 b.com 的 window.name 可能会返回 a.com 的 window.name\n      const originalName = original.call(this, ...args)\n\n      // 根据配置，iframes 中返回的 window.name 可以赦免此伪造规则，\n      // this !== this.top 是一种快速检测当前 window 是否在 iframe 中的方法\n      if (\n        this !== this.top &&\n        prefs(\"allowWindowNameInFrames\", this.location)\n      ){\n        return originalName\n      }\n\n      // 只有通过显式的 window.name = 'xxx' 才会触发 windowNames 中记录的值的改变，\n      // 所以一旦 windowNames 记录的值和 originalName 不一样，\n      // 就说明当前浏览器犯了 window.name 泄露的错误\n      const returnedName = windowNames.get(this) || \"\"\n      if (originalName !== returnedName){\n        notify(\"fakedWindowReadout\")\n      }\n      return returnedName\n    });\n  }\n}\n",[858],{"type":172,"tag":270,"props":859,"children":860},{"__ignoreMap":166},[861,868,889,959,1008,1016,1024,1076,1083,1092,1101,1115,1146,1193,1206,1220,1229,1237,1246,1255,1264,1318,1351,1381,1389,1403,1421,1429],{"type":172,"tag":274,"props":862,"children":863},{"class":276,"line":277},[864],{"type":172,"tag":274,"props":865,"children":866},{"style":287},[867],{"type":178,"value":546},{"type":172,"tag":274,"props":869,"children":870},{"class":276,"line":352},[871,876,880,885],{"type":172,"tag":274,"props":872,"children":873},{"style":281},[874],{"type":178,"value":875},"  get",{"type":172,"tag":274,"props":877,"children":878},{"style":293},[879],{"type":178,"value":717},{"type":172,"tag":274,"props":881,"children":882},{"style":384},[883],{"type":178,"value":884},"()",{"type":172,"tag":274,"props":886,"children":887},{"style":287},[888],{"type":178,"value":546},{"type":172,"tag":274,"props":890,"children":891},{"class":276,"line":433},[892,897,902,906,911,915,920,924,929,933,937,941,946,950,955],{"type":172,"tag":274,"props":893,"children":894},{"style":496},[895],{"type":178,"value":896},"    return",{"type":172,"tag":274,"props":898,"children":899},{"style":293},[900],{"type":178,"value":901}," checkerWrapper",{"type":172,"tag":274,"props":903,"children":904},{"style":384},[905],{"type":178,"value":387},{"type":172,"tag":274,"props":907,"children":908},{"style":281},[909],{"type":178,"value":910},"checker",{"type":172,"tag":274,"props":912,"children":913},{"style":287},[914],{"type":178,"value":473},{"type":172,"tag":274,"props":916,"children":917},{"style":767},[918],{"type":178,"value":919}," this",{"type":172,"tag":274,"props":921,"children":922},{"style":287},[923],{"type":178,"value":473},{"type":172,"tag":274,"props":925,"children":926},{"style":782},[927],{"type":178,"value":928}," arguments",{"type":172,"tag":274,"props":930,"children":931},{"style":287},[932],{"type":178,"value":473},{"type":172,"tag":274,"props":934,"children":935},{"style":304},[936],{"type":178,"value":307},{"type":172,"tag":274,"props":938,"children":939},{"style":287},[940],{"type":178,"value":387},{"type":172,"tag":274,"props":942,"children":943},{"style":331},[944],{"type":178,"value":945},"args",{"type":172,"tag":274,"props":947,"children":948},{"style":287},[949],{"type":178,"value":473},{"type":172,"tag":274,"props":951,"children":952},{"style":331},[953],{"type":178,"value":954}," check",{"type":172,"tag":274,"props":956,"children":957},{"style":287},[958],{"type":178,"value":349},{"type":172,"tag":274,"props":960,"children":961},{"class":276,"line":492},[962,967,972,977,981,986,990,995,999,1003],{"type":172,"tag":274,"props":963,"children":964},{"style":304},[965],{"type":178,"value":966},"      const",{"type":172,"tag":274,"props":968,"children":969},{"style":287},[970],{"type":178,"value":971}," {",{"type":172,"tag":274,"props":973,"children":974},{"style":361},[975],{"type":178,"value":976},"notify",{"type":172,"tag":274,"props":978,"children":979},{"style":287},[980],{"type":178,"value":473},{"type":172,"tag":274,"props":982,"children":983},{"style":361},[984],{"type":178,"value":985}," original",{"type":172,"tag":274,"props":987,"children":988},{"style":287},[989],{"type":178,"value":473},{"type":172,"tag":274,"props":991,"children":992},{"style":361},[993],{"type":178,"value":994}," prefs",{"type":172,"tag":274,"props":996,"children":997},{"style":287},[998],{"type":178,"value":425},{"type":172,"tag":274,"props":1000,"children":1001},{"style":298},[1002],{"type":178,"value":301},{"type":172,"tag":274,"props":1004,"children":1005},{"style":281},[1006],{"type":178,"value":1007}," check\n",{"type":172,"tag":274,"props":1009,"children":1010},{"class":276,"line":549},[1011],{"type":172,"tag":274,"props":1012,"children":1013},{"emptyLinePlaceholder":165},[1014],{"type":178,"value":1015},"\n",{"type":172,"tag":274,"props":1017,"children":1018},{"class":276,"line":586},[1019],{"type":172,"tag":274,"props":1020,"children":1021},{"style":740},[1022],{"type":178,"value":1023},"      // 读取 b.com 的 window.name 可能会返回 a.com 的 window.name\n",{"type":172,"tag":274,"props":1025,"children":1026},{"class":276,"line":623},[1027,1031,1036,1040,1044,1048,1052,1056,1060,1064,1068,1072],{"type":172,"tag":274,"props":1028,"children":1029},{"style":304},[1030],{"type":178,"value":966},{"type":172,"tag":274,"props":1032,"children":1033},{"style":361},[1034],{"type":178,"value":1035}," originalName",{"type":172,"tag":274,"props":1037,"children":1038},{"style":298},[1039],{"type":178,"value":301},{"type":172,"tag":274,"props":1041,"children":1042},{"style":281},[1043],{"type":178,"value":985},{"type":172,"tag":274,"props":1045,"children":1046},{"style":287},[1047],{"type":178,"value":290},{"type":172,"tag":274,"props":1049,"children":1050},{"style":293},[1051],{"type":178,"value":760},{"type":172,"tag":274,"props":1053,"children":1054},{"style":384},[1055],{"type":178,"value":387},{"type":172,"tag":274,"props":1057,"children":1058},{"style":767},[1059],{"type":178,"value":770},{"type":172,"tag":274,"props":1061,"children":1062},{"style":287},[1063],{"type":178,"value":473},{"type":172,"tag":274,"props":1065,"children":1066},{"style":298},[1067],{"type":178,"value":779},{"type":172,"tag":274,"props":1069,"children":1070},{"style":281},[1071],{"type":178,"value":945},{"type":172,"tag":274,"props":1073,"children":1074},{"style":384},[1075],{"type":178,"value":430},{"type":172,"tag":274,"props":1077,"children":1078},{"class":276,"line":632},[1079],{"type":172,"tag":274,"props":1080,"children":1081},{"emptyLinePlaceholder":165},[1082],{"type":178,"value":1015},{"type":172,"tag":274,"props":1084,"children":1086},{"class":276,"line":1085},9,[1087],{"type":172,"tag":274,"props":1088,"children":1089},{"style":740},[1090],{"type":178,"value":1091},"      // 根据配置，iframes 中返回的 window.name 可以赦免此伪造规则，\n",{"type":172,"tag":274,"props":1093,"children":1095},{"class":276,"line":1094},10,[1096],{"type":172,"tag":274,"props":1097,"children":1098},{"style":740},[1099],{"type":178,"value":1100},"      // this !== this.top 是一种快速检测当前 window 是否在 iframe 中的方法\n",{"type":172,"tag":274,"props":1102,"children":1104},{"class":276,"line":1103},11,[1105,1110],{"type":172,"tag":274,"props":1106,"children":1107},{"style":496},[1108],{"type":178,"value":1109},"      if",{"type":172,"tag":274,"props":1111,"children":1112},{"style":384},[1113],{"type":178,"value":1114}," (\n",{"type":172,"tag":274,"props":1116,"children":1118},{"class":276,"line":1117},12,[1119,1124,1128,1132,1136,1141],{"type":172,"tag":274,"props":1120,"children":1121},{"style":767},[1122],{"type":178,"value":1123},"        this",{"type":172,"tag":274,"props":1125,"children":1126},{"style":298},[1127],{"type":178,"value":523},{"type":172,"tag":274,"props":1129,"children":1130},{"style":767},[1131],{"type":178,"value":919},{"type":172,"tag":274,"props":1133,"children":1134},{"style":287},[1135],{"type":178,"value":290},{"type":172,"tag":274,"props":1137,"children":1138},{"style":281},[1139],{"type":178,"value":1140},"top",{"type":172,"tag":274,"props":1142,"children":1143},{"style":298},[1144],{"type":178,"value":1145}," &&\n",{"type":172,"tag":274,"props":1147,"children":1149},{"class":276,"line":1148},13,[1150,1155,1159,1163,1168,1172,1176,1180,1184,1189],{"type":172,"tag":274,"props":1151,"children":1152},{"style":293},[1153],{"type":178,"value":1154},"        prefs",{"type":172,"tag":274,"props":1156,"children":1157},{"style":384},[1158],{"type":178,"value":387},{"type":172,"tag":274,"props":1160,"children":1161},{"style":455},[1162],{"type":178,"value":458},{"type":172,"tag":274,"props":1164,"children":1165},{"style":461},[1166],{"type":178,"value":1167},"allowWindowNameInFrames",{"type":172,"tag":274,"props":1169,"children":1170},{"style":455},[1171],{"type":178,"value":458},{"type":172,"tag":274,"props":1173,"children":1174},{"style":287},[1175],{"type":178,"value":473},{"type":172,"tag":274,"props":1177,"children":1178},{"style":767},[1179],{"type":178,"value":919},{"type":172,"tag":274,"props":1181,"children":1182},{"style":287},[1183],{"type":178,"value":290},{"type":172,"tag":274,"props":1185,"children":1186},{"style":281},[1187],{"type":178,"value":1188},"location",{"type":172,"tag":274,"props":1190,"children":1191},{"style":384},[1192],{"type":178,"value":430},{"type":172,"tag":274,"props":1194,"children":1196},{"class":276,"line":1195},14,[1197,1202],{"type":172,"tag":274,"props":1198,"children":1199},{"style":384},[1200],{"type":178,"value":1201},"      )",{"type":172,"tag":274,"props":1203,"children":1204},{"style":287},[1205],{"type":178,"value":546},{"type":172,"tag":274,"props":1207,"children":1209},{"class":276,"line":1208},15,[1210,1215],{"type":172,"tag":274,"props":1211,"children":1212},{"style":496},[1213],{"type":178,"value":1214},"        return",{"type":172,"tag":274,"props":1216,"children":1217},{"style":281},[1218],{"type":178,"value":1219}," originalName\n",{"type":172,"tag":274,"props":1221,"children":1223},{"class":276,"line":1222},16,[1224],{"type":172,"tag":274,"props":1225,"children":1226},{"style":287},[1227],{"type":178,"value":1228},"      }\n",{"type":172,"tag":274,"props":1230,"children":1232},{"class":276,"line":1231},17,[1233],{"type":172,"tag":274,"props":1234,"children":1235},{"emptyLinePlaceholder":165},[1236],{"type":178,"value":1015},{"type":172,"tag":274,"props":1238,"children":1240},{"class":276,"line":1239},18,[1241],{"type":172,"tag":274,"props":1242,"children":1243},{"style":740},[1244],{"type":178,"value":1245},"      // 只有通过显式的 window.name = 'xxx' 才会触发 windowNames 中记录的值的改变，\n",{"type":172,"tag":274,"props":1247,"children":1249},{"class":276,"line":1248},19,[1250],{"type":172,"tag":274,"props":1251,"children":1252},{"style":740},[1253],{"type":178,"value":1254},"      // 所以一旦 windowNames 记录的值和 originalName 不一样，\n",{"type":172,"tag":274,"props":1256,"children":1258},{"class":276,"line":1257},20,[1259],{"type":172,"tag":274,"props":1260,"children":1261},{"style":740},[1262],{"type":178,"value":1263},"      // 就说明当前浏览器犯了 window.name 泄露的错误\n",{"type":172,"tag":274,"props":1265,"children":1267},{"class":276,"line":1266},21,[1268,1272,1277,1281,1286,1290,1295,1299,1303,1308,1313],{"type":172,"tag":274,"props":1269,"children":1270},{"style":304},[1271],{"type":178,"value":966},{"type":172,"tag":274,"props":1273,"children":1274},{"style":361},[1275],{"type":178,"value":1276}," returnedName",{"type":172,"tag":274,"props":1278,"children":1279},{"style":298},[1280],{"type":178,"value":301},{"type":172,"tag":274,"props":1282,"children":1283},{"style":281},[1284],{"type":178,"value":1285}," windowNames",{"type":172,"tag":274,"props":1287,"children":1288},{"style":287},[1289],{"type":178,"value":290},{"type":172,"tag":274,"props":1291,"children":1292},{"style":293},[1293],{"type":178,"value":1294},"get",{"type":172,"tag":274,"props":1296,"children":1297},{"style":384},[1298],{"type":178,"value":387},{"type":172,"tag":274,"props":1300,"children":1301},{"style":767},[1302],{"type":178,"value":770},{"type":172,"tag":274,"props":1304,"children":1305},{"style":384},[1306],{"type":178,"value":1307},") ",{"type":172,"tag":274,"props":1309,"children":1310},{"style":298},[1311],{"type":178,"value":1312},"||",{"type":172,"tag":274,"props":1314,"children":1315},{"style":455},[1316],{"type":178,"value":1317}," \"\"\n",{"type":172,"tag":274,"props":1319,"children":1321},{"class":276,"line":1320},22,[1322,1326,1330,1335,1339,1343,1347],{"type":172,"tag":274,"props":1323,"children":1324},{"style":496},[1325],{"type":178,"value":1109},{"type":172,"tag":274,"props":1327,"children":1328},{"style":384},[1329],{"type":178,"value":504},{"type":172,"tag":274,"props":1331,"children":1332},{"style":281},[1333],{"type":178,"value":1334},"originalName",{"type":172,"tag":274,"props":1336,"children":1337},{"style":298},[1338],{"type":178,"value":523},{"type":172,"tag":274,"props":1340,"children":1341},{"style":281},[1342],{"type":178,"value":1276},{"type":172,"tag":274,"props":1344,"children":1345},{"style":384},[1346],{"type":178,"value":420},{"type":172,"tag":274,"props":1348,"children":1349},{"style":287},[1350],{"type":178,"value":546},{"type":172,"tag":274,"props":1352,"children":1354},{"class":276,"line":1353},23,[1355,1360,1364,1368,1373,1377],{"type":172,"tag":274,"props":1356,"children":1357},{"style":293},[1358],{"type":178,"value":1359},"        notify",{"type":172,"tag":274,"props":1361,"children":1362},{"style":384},[1363],{"type":178,"value":387},{"type":172,"tag":274,"props":1365,"children":1366},{"style":455},[1367],{"type":178,"value":458},{"type":172,"tag":274,"props":1369,"children":1370},{"style":461},[1371],{"type":178,"value":1372},"fakedWindowReadout",{"type":172,"tag":274,"props":1374,"children":1375},{"style":455},[1376],{"type":178,"value":458},{"type":172,"tag":274,"props":1378,"children":1379},{"style":384},[1380],{"type":178,"value":430},{"type":172,"tag":274,"props":1382,"children":1384},{"class":276,"line":1383},24,[1385],{"type":172,"tag":274,"props":1386,"children":1387},{"style":287},[1388],{"type":178,"value":1228},{"type":172,"tag":274,"props":1390,"children":1392},{"class":276,"line":1391},25,[1393,1398],{"type":172,"tag":274,"props":1394,"children":1395},{"style":496},[1396],{"type":178,"value":1397},"      return",{"type":172,"tag":274,"props":1399,"children":1400},{"style":281},[1401],{"type":178,"value":1402}," returnedName\n",{"type":172,"tag":274,"props":1404,"children":1406},{"class":276,"line":1405},26,[1407,1412,1416],{"type":172,"tag":274,"props":1408,"children":1409},{"style":287},[1410],{"type":178,"value":1411},"    }",{"type":172,"tag":274,"props":1413,"children":1414},{"style":384},[1415],{"type":178,"value":420},{"type":172,"tag":274,"props":1417,"children":1418},{"style":287},[1419],{"type":178,"value":1420},";\n",{"type":172,"tag":274,"props":1422,"children":1424},{"class":276,"line":1423},27,[1425],{"type":172,"tag":274,"props":1426,"children":1427},{"style":287},[1428],{"type":178,"value":629},{"type":172,"tag":274,"props":1430,"children":1432},{"class":276,"line":1431},28,[1433],{"type":172,"tag":274,"props":1434,"children":1435},{"style":287},[1436],{"type":178,"value":638},{"type":172,"tag":180,"props":1438,"children":1440},{"id":1439},"windowopener",[1441],{"type":178,"value":1442},"window.opener",{"type":172,"tag":186,"props":1444,"children":1445},{},[1446],{"type":178,"value":1447},"在过去的浏览器中，当页面通过超链接或 window.open 的方式从 A 网站跳转到 B 网站时，如果制定了 target 属性却没有指定 rel=\"norefer\" 属性，那么在 B 网站是可以使用 window.opener 获取到 A 网站的部分信息的。也就是说，在 B 网站中可以修改 window.opener.location.href = 'x' 从而让 A 网站自动跳转到 X 网站。如果页面跳转时使用 target=\"__blank\" 打开了新页面，那么用户更加不可能注意到 A 网站的恶意跳转。",{"type":172,"tag":192,"props":1449,"children":1450},{},[1451],{"type":172,"tag":196,"props":1452,"children":1453},{},[1454],{"type":172,"tag":668,"props":1455,"children":1458},{"href":1456,"rel":1457},"https://cwe.mitre.org/data/definitions/1022.html",[672],[1459],{"type":178,"value":1460},"CWE-1022: Use of Web Link to Untrusted Target with window.opener Access",{"type":172,"tag":186,"props":1462,"children":1463},{},[1464],{"type":178,"value":1465},"Blocker 对 window.opener 的防范比较简单，直接返回 null 就完事儿了。考虑到现代浏览器已经修复了这个漏洞，该篡改的设置的值默认是关闭的。",{"type":172,"tag":263,"props":1467,"children":1469},{"className":265,"code":1468,"language":267,"meta":166,"style":166},"{\n  // 修改 Getter 使 window.opener 一直返回 null\n  getterGenerator: function(checker){\n    const temp = {\n      get opener(){\n        return checkerWrapper(checker, this, arguments, function(args, check){\n          const {notify, original} = check\n          const originalOpener = original.call(this, ...args)\n          if (originalOpener !== null){\n            notify(\"fakedWindowReadout\")\n          }\n          return null\n        })\n      }\n    }\n    return Object.getOwnPropertyDescriptor(temp, \"opener\").get\n  },\n  // 修改 Descriptor.Value 使得 window.opener 一直返回 null，\n  // 这是一种兼容，在部分浏览器中，\n  //  window.opener 是通过 value 而不是 getter 获取的值\n  valueGenerator: function({original, notify}){\n    if (original !== null){\n      notify(\"fakedWindowReadout\")\n    }\n    return null\n  }\n}\n",[1470],{"type":172,"tag":270,"props":1471,"children":1472},{"__ignoreMap":166},[1473,1480,1488,1517,1539,1558,1621,1657,1709,1744,1772,1780,1793,1805,1812,1820,1880,1888,1896,1904,1912,1951,1983,2011,2018,2029,2036],{"type":172,"tag":274,"props":1474,"children":1475},{"class":276,"line":277},[1476],{"type":172,"tag":274,"props":1477,"children":1478},{"style":287},[1479],{"type":178,"value":546},{"type":172,"tag":274,"props":1481,"children":1482},{"class":276,"line":352},[1483],{"type":172,"tag":274,"props":1484,"children":1485},{"style":740},[1486],{"type":178,"value":1487},"  // 修改 Getter 使 window.opener 一直返回 null\n",{"type":172,"tag":274,"props":1489,"children":1490},{"class":276,"line":433},[1491,1497,1501,1505,1509,1513],{"type":172,"tag":274,"props":1492,"children":1494},{"style":1493},"--shiki-light:#E2931D;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#F8F8F2",[1495],{"type":178,"value":1496},"  getterGenerator",{"type":172,"tag":274,"props":1498,"children":1499},{"style":287},[1500],{"type":178,"value":328},{"type":172,"tag":274,"props":1502,"children":1503},{"style":304},[1504],{"type":178,"value":307},{"type":172,"tag":274,"props":1506,"children":1507},{"style":287},[1508],{"type":178,"value":387},{"type":172,"tag":274,"props":1510,"children":1511},{"style":331},[1512],{"type":178,"value":910},{"type":172,"tag":274,"props":1514,"children":1515},{"style":287},[1516],{"type":178,"value":349},{"type":172,"tag":274,"props":1518,"children":1519},{"class":276,"line":492},[1520,1525,1530,1534],{"type":172,"tag":274,"props":1521,"children":1522},{"style":304},[1523],{"type":178,"value":1524},"    const",{"type":172,"tag":274,"props":1526,"children":1527},{"style":361},[1528],{"type":178,"value":1529}," temp",{"type":172,"tag":274,"props":1531,"children":1532},{"style":298},[1533],{"type":178,"value":301},{"type":172,"tag":274,"props":1535,"children":1536},{"style":287},[1537],{"type":178,"value":1538}," {\n",{"type":172,"tag":274,"props":1540,"children":1541},{"class":276,"line":549},[1542,1547,1553],{"type":172,"tag":274,"props":1543,"children":1544},{"style":304},[1545],{"type":178,"value":1546},"      get",{"type":172,"tag":274,"props":1548,"children":1550},{"style":1549},"--shiki-light:#E53935;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[1551],{"type":178,"value":1552}," opener",{"type":172,"tag":274,"props":1554,"children":1555},{"style":287},[1556],{"type":178,"value":1557},"(){\n",{"type":172,"tag":274,"props":1559,"children":1560},{"class":276,"line":586},[1561,1565,1569,1573,1577,1581,1585,1589,1593,1597,1601,1605,1609,1613,1617],{"type":172,"tag":274,"props":1562,"children":1563},{"style":496},[1564],{"type":178,"value":1214},{"type":172,"tag":274,"props":1566,"children":1567},{"style":293},[1568],{"type":178,"value":901},{"type":172,"tag":274,"props":1570,"children":1571},{"style":384},[1572],{"type":178,"value":387},{"type":172,"tag":274,"props":1574,"children":1575},{"style":281},[1576],{"type":178,"value":910},{"type":172,"tag":274,"props":1578,"children":1579},{"style":287},[1580],{"type":178,"value":473},{"type":172,"tag":274,"props":1582,"children":1583},{"style":767},[1584],{"type":178,"value":919},{"type":172,"tag":274,"props":1586,"children":1587},{"style":287},[1588],{"type":178,"value":473},{"type":172,"tag":274,"props":1590,"children":1591},{"style":782},[1592],{"type":178,"value":928},{"type":172,"tag":274,"props":1594,"children":1595},{"style":287},[1596],{"type":178,"value":473},{"type":172,"tag":274,"props":1598,"children":1599},{"style":304},[1600],{"type":178,"value":307},{"type":172,"tag":274,"props":1602,"children":1603},{"style":287},[1604],{"type":178,"value":387},{"type":172,"tag":274,"props":1606,"children":1607},{"style":331},[1608],{"type":178,"value":945},{"type":172,"tag":274,"props":1610,"children":1611},{"style":287},[1612],{"type":178,"value":473},{"type":172,"tag":274,"props":1614,"children":1615},{"style":331},[1616],{"type":178,"value":954},{"type":172,"tag":274,"props":1618,"children":1619},{"style":287},[1620],{"type":178,"value":349},{"type":172,"tag":274,"props":1622,"children":1623},{"class":276,"line":623},[1624,1629,1633,1637,1641,1645,1649,1653],{"type":172,"tag":274,"props":1625,"children":1626},{"style":304},[1627],{"type":178,"value":1628},"          const",{"type":172,"tag":274,"props":1630,"children":1631},{"style":287},[1632],{"type":178,"value":971},{"type":172,"tag":274,"props":1634,"children":1635},{"style":361},[1636],{"type":178,"value":976},{"type":172,"tag":274,"props":1638,"children":1639},{"style":287},[1640],{"type":178,"value":473},{"type":172,"tag":274,"props":1642,"children":1643},{"style":361},[1644],{"type":178,"value":985},{"type":172,"tag":274,"props":1646,"children":1647},{"style":287},[1648],{"type":178,"value":425},{"type":172,"tag":274,"props":1650,"children":1651},{"style":298},[1652],{"type":178,"value":301},{"type":172,"tag":274,"props":1654,"children":1655},{"style":281},[1656],{"type":178,"value":1007},{"type":172,"tag":274,"props":1658,"children":1659},{"class":276,"line":632},[1660,1664,1669,1673,1677,1681,1685,1689,1693,1697,1701,1705],{"type":172,"tag":274,"props":1661,"children":1662},{"style":304},[1663],{"type":178,"value":1628},{"type":172,"tag":274,"props":1665,"children":1666},{"style":361},[1667],{"type":178,"value":1668}," originalOpener",{"type":172,"tag":274,"props":1670,"children":1671},{"style":298},[1672],{"type":178,"value":301},{"type":172,"tag":274,"props":1674,"children":1675},{"style":281},[1676],{"type":178,"value":985},{"type":172,"tag":274,"props":1678,"children":1679},{"style":287},[1680],{"type":178,"value":290},{"type":172,"tag":274,"props":1682,"children":1683},{"style":293},[1684],{"type":178,"value":760},{"type":172,"tag":274,"props":1686,"children":1687},{"style":384},[1688],{"type":178,"value":387},{"type":172,"tag":274,"props":1690,"children":1691},{"style":767},[1692],{"type":178,"value":770},{"type":172,"tag":274,"props":1694,"children":1695},{"style":287},[1696],{"type":178,"value":473},{"type":172,"tag":274,"props":1698,"children":1699},{"style":298},[1700],{"type":178,"value":779},{"type":172,"tag":274,"props":1702,"children":1703},{"style":281},[1704],{"type":178,"value":945},{"type":172,"tag":274,"props":1706,"children":1707},{"style":384},[1708],{"type":178,"value":430},{"type":172,"tag":274,"props":1710,"children":1711},{"class":276,"line":1085},[1712,1717,1721,1726,1730,1736,1740],{"type":172,"tag":274,"props":1713,"children":1714},{"style":496},[1715],{"type":178,"value":1716},"          if",{"type":172,"tag":274,"props":1718,"children":1719},{"style":384},[1720],{"type":178,"value":504},{"type":172,"tag":274,"props":1722,"children":1723},{"style":281},[1724],{"type":178,"value":1725},"originalOpener",{"type":172,"tag":274,"props":1727,"children":1728},{"style":298},[1729],{"type":178,"value":523},{"type":172,"tag":274,"props":1731,"children":1733},{"style":1732},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[1734],{"type":178,"value":1735}," null",{"type":172,"tag":274,"props":1737,"children":1738},{"style":384},[1739],{"type":178,"value":420},{"type":172,"tag":274,"props":1741,"children":1742},{"style":287},[1743],{"type":178,"value":546},{"type":172,"tag":274,"props":1745,"children":1746},{"class":276,"line":1094},[1747,1752,1756,1760,1764,1768],{"type":172,"tag":274,"props":1748,"children":1749},{"style":293},[1750],{"type":178,"value":1751},"            notify",{"type":172,"tag":274,"props":1753,"children":1754},{"style":384},[1755],{"type":178,"value":387},{"type":172,"tag":274,"props":1757,"children":1758},{"style":455},[1759],{"type":178,"value":458},{"type":172,"tag":274,"props":1761,"children":1762},{"style":461},[1763],{"type":178,"value":1372},{"type":172,"tag":274,"props":1765,"children":1766},{"style":455},[1767],{"type":178,"value":458},{"type":172,"tag":274,"props":1769,"children":1770},{"style":384},[1771],{"type":178,"value":430},{"type":172,"tag":274,"props":1773,"children":1774},{"class":276,"line":1103},[1775],{"type":172,"tag":274,"props":1776,"children":1777},{"style":287},[1778],{"type":178,"value":1779},"          }\n",{"type":172,"tag":274,"props":1781,"children":1782},{"class":276,"line":1117},[1783,1788],{"type":172,"tag":274,"props":1784,"children":1785},{"style":496},[1786],{"type":178,"value":1787},"          return",{"type":172,"tag":274,"props":1789,"children":1790},{"style":1732},[1791],{"type":178,"value":1792}," null\n",{"type":172,"tag":274,"props":1794,"children":1795},{"class":276,"line":1148},[1796,1801],{"type":172,"tag":274,"props":1797,"children":1798},{"style":287},[1799],{"type":178,"value":1800},"        }",{"type":172,"tag":274,"props":1802,"children":1803},{"style":384},[1804],{"type":178,"value":430},{"type":172,"tag":274,"props":1806,"children":1807},{"class":276,"line":1195},[1808],{"type":172,"tag":274,"props":1809,"children":1810},{"style":287},[1811],{"type":178,"value":1228},{"type":172,"tag":274,"props":1813,"children":1814},{"class":276,"line":1208},[1815],{"type":172,"tag":274,"props":1816,"children":1817},{"style":287},[1818],{"type":178,"value":1819},"    }\n",{"type":172,"tag":274,"props":1821,"children":1822},{"class":276,"line":1222},[1823,1827,1832,1836,1841,1845,1850,1854,1858,1863,1867,1871,1875],{"type":172,"tag":274,"props":1824,"children":1825},{"style":496},[1826],{"type":178,"value":896},{"type":172,"tag":274,"props":1828,"children":1829},{"style":281},[1830],{"type":178,"value":1831}," Object",{"type":172,"tag":274,"props":1833,"children":1834},{"style":287},[1835],{"type":178,"value":290},{"type":172,"tag":274,"props":1837,"children":1838},{"style":293},[1839],{"type":178,"value":1840},"getOwnPropertyDescriptor",{"type":172,"tag":274,"props":1842,"children":1843},{"style":384},[1844],{"type":178,"value":387},{"type":172,"tag":274,"props":1846,"children":1847},{"style":281},[1848],{"type":178,"value":1849},"temp",{"type":172,"tag":274,"props":1851,"children":1852},{"style":287},[1853],{"type":178,"value":473},{"type":172,"tag":274,"props":1855,"children":1856},{"style":455},[1857],{"type":178,"value":528},{"type":172,"tag":274,"props":1859,"children":1860},{"style":461},[1861],{"type":178,"value":1862},"opener",{"type":172,"tag":274,"props":1864,"children":1865},{"style":455},[1866],{"type":178,"value":458},{"type":172,"tag":274,"props":1868,"children":1869},{"style":384},[1870],{"type":178,"value":420},{"type":172,"tag":274,"props":1872,"children":1873},{"style":287},[1874],{"type":178,"value":290},{"type":172,"tag":274,"props":1876,"children":1877},{"style":281},[1878],{"type":178,"value":1879},"get\n",{"type":172,"tag":274,"props":1881,"children":1882},{"class":276,"line":1231},[1883],{"type":172,"tag":274,"props":1884,"children":1885},{"style":287},[1886],{"type":178,"value":1887},"  },\n",{"type":172,"tag":274,"props":1889,"children":1890},{"class":276,"line":1239},[1891],{"type":172,"tag":274,"props":1892,"children":1893},{"style":740},[1894],{"type":178,"value":1895},"  // 修改 Descriptor.Value 使得 window.opener 一直返回 null，\n",{"type":172,"tag":274,"props":1897,"children":1898},{"class":276,"line":1248},[1899],{"type":172,"tag":274,"props":1900,"children":1901},{"style":740},[1902],{"type":178,"value":1903},"  // 这是一种兼容，在部分浏览器中，\n",{"type":172,"tag":274,"props":1905,"children":1906},{"class":276,"line":1257},[1907],{"type":172,"tag":274,"props":1908,"children":1909},{"style":740},[1910],{"type":178,"value":1911},"  //  window.opener 是通过 value 而不是 getter 获取的值\n",{"type":172,"tag":274,"props":1913,"children":1914},{"class":276,"line":1266},[1915,1920,1924,1928,1932,1937,1941,1946],{"type":172,"tag":274,"props":1916,"children":1917},{"style":1493},[1918],{"type":178,"value":1919},"  valueGenerator",{"type":172,"tag":274,"props":1921,"children":1922},{"style":287},[1923],{"type":178,"value":328},{"type":172,"tag":274,"props":1925,"children":1926},{"style":304},[1927],{"type":178,"value":307},{"type":172,"tag":274,"props":1929,"children":1930},{"style":287},[1931],{"type":178,"value":317},{"type":172,"tag":274,"props":1933,"children":1934},{"style":331},[1935],{"type":178,"value":1936},"original",{"type":172,"tag":274,"props":1938,"children":1939},{"style":287},[1940],{"type":178,"value":473},{"type":172,"tag":274,"props":1942,"children":1943},{"style":331},[1944],{"type":178,"value":1945}," notify",{"type":172,"tag":274,"props":1947,"children":1948},{"style":287},[1949],{"type":178,"value":1950},"}){\n",{"type":172,"tag":274,"props":1952,"children":1953},{"class":276,"line":1320},[1954,1959,1963,1967,1971,1975,1979],{"type":172,"tag":274,"props":1955,"children":1956},{"style":496},[1957],{"type":178,"value":1958},"    if",{"type":172,"tag":274,"props":1960,"children":1961},{"style":384},[1962],{"type":178,"value":504},{"type":172,"tag":274,"props":1964,"children":1965},{"style":281},[1966],{"type":178,"value":1936},{"type":172,"tag":274,"props":1968,"children":1969},{"style":298},[1970],{"type":178,"value":523},{"type":172,"tag":274,"props":1972,"children":1973},{"style":1732},[1974],{"type":178,"value":1735},{"type":172,"tag":274,"props":1976,"children":1977},{"style":384},[1978],{"type":178,"value":420},{"type":172,"tag":274,"props":1980,"children":1981},{"style":287},[1982],{"type":178,"value":546},{"type":172,"tag":274,"props":1984,"children":1985},{"class":276,"line":1353},[1986,1991,1995,1999,2003,2007],{"type":172,"tag":274,"props":1987,"children":1988},{"style":293},[1989],{"type":178,"value":1990},"      notify",{"type":172,"tag":274,"props":1992,"children":1993},{"style":384},[1994],{"type":178,"value":387},{"type":172,"tag":274,"props":1996,"children":1997},{"style":455},[1998],{"type":178,"value":458},{"type":172,"tag":274,"props":2000,"children":2001},{"style":461},[2002],{"type":178,"value":1372},{"type":172,"tag":274,"props":2004,"children":2005},{"style":455},[2006],{"type":178,"value":458},{"type":172,"tag":274,"props":2008,"children":2009},{"style":384},[2010],{"type":178,"value":430},{"type":172,"tag":274,"props":2012,"children":2013},{"class":276,"line":1383},[2014],{"type":172,"tag":274,"props":2015,"children":2016},{"style":287},[2017],{"type":178,"value":1819},{"type":172,"tag":274,"props":2019,"children":2020},{"class":276,"line":1391},[2021,2025],{"type":172,"tag":274,"props":2022,"children":2023},{"style":496},[2024],{"type":178,"value":896},{"type":172,"tag":274,"props":2026,"children":2027},{"style":1732},[2028],{"type":178,"value":1792},{"type":172,"tag":274,"props":2030,"children":2031},{"class":276,"line":1405},[2032],{"type":172,"tag":274,"props":2033,"children":2034},{"style":287},[2035],{"type":178,"value":629},{"type":172,"tag":274,"props":2037,"children":2038},{"class":276,"line":1423},[2039],{"type":172,"tag":274,"props":2040,"children":2041},{"style":287},[2042],{"type":178,"value":638},{"type":172,"tag":180,"props":2044,"children":2046},{"id":2045},"canvas",[2047],{"type":178,"value":2048},"Canvas",{"type":172,"tag":186,"props":2050,"children":2051},{},[2052],{"type":178,"value":2053},"伪造了 getContext、getDataURL 等 API，并替代了原本正常的 API。",{"type":172,"tag":180,"props":2055,"children":2057},{"id":2056},"相关链接",[2058],{"type":178,"value":2056},{"type":172,"tag":192,"props":2060,"children":2061},{},[2062],{"type":172,"tag":196,"props":2063,"children":2064},{},[2065],{"type":172,"tag":668,"props":2066,"children":2069},{"href":2067,"rel":2068},"https://github.com/kkapsner/CanvasBlocker",[672],[2070],{"type":178,"value":2071},"CanvasBlocker",{"type":172,"tag":2073,"props":2074,"children":2075},"style",{},[2076],{"type":178,"value":2077},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":166,"searchDepth":352,"depth":352,"links":2079},[2080,2081,2082,2085,2086,2087],{"id":182,"depth":352,"text":182},{"id":248,"depth":352,"text":251},{"id":641,"depth":352,"text":220,"children":2083},[2084],{"id":652,"depth":433,"text":655},{"id":1439,"depth":352,"text":1442},{"id":2045,"depth":352,"text":2048},{"id":2056,"depth":352,"text":2056},"markdown","content:8.source-code:_fingerprint:canvas-blocker.md","content","8.source-code/_fingerprint/canvas-blocker.md","8.source-code/_fingerprint/canvas-blocker","md",[2095,2098],{"_path":2096,"title":2097,"description":166},"/source-code/_es/object-assign","Object.prototype.assign",{"_path":2099,"title":2100,"description":166},"/source-code/_js/element-plus","ElementPlus",1749721449327]