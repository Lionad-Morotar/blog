[{"data":1,"prerenderedAt":2328},["Reactive",2],{"navigation":3,"/source-code/_fingerprint/canvas-blocker":389,"/source-code/_fingerprint/canvas-blocker-surround":2321},[4,32,83,99,126,132,138,372,378,384],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🌃 长夜梦","/flows/long-night-dream",{"title":15,"_path":16},"🌌 万物联结与幸福感","/flows/everything",{"title":18,"_path":19},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":21,"_path":22},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":24,"_path":25},"🌧️ 我的腼腆","/flows/shy",{"title":27,"_path":28},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":30,"_path":31},"📝 心流归档","/flows/fold",{"title":33,"_path":34,"children":35},"技术博客 / Coder","/articles",[36,38,41,44,47,50,53,56,59,62,65,68,71,74,77,80],{"title":37,"_path":34},"🦁 为什么我要写博客",{"title":39,"_path":40},"💻 本地部署 Qwen 翻译网页","/articles/local-translator",{"title":42,"_path":43},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":45,"_path":46},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":48,"_path":49},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":51,"_path":52},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":54,"_path":55},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":57,"_path":58},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":60,"_path":61},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":63,"_path":64},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":66,"_path":67},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":69,"_path":70},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":72,"_path":73},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":75,"_path":76},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":78,"_path":79},"🚝 四十二篇系列","/articles/fourty-two",{"title":81,"_path":82},"📝 技术博客归档","/articles/fold",{"title":84,"_path":85,"children":86},"造物 / Make","/tools",[87,90,93,96],{"title":88,"_path":89},"🌐 AnySort","/tools/anysort",{"title":91,"_path":92},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":94,"_path":95},"👓 Crapto","/tools/crypto-inline",{"title":97,"_path":98},"🖨️ any-to-base64","/tools/any-to-base64",{"title":100,"_path":101,"children":102},"吉他剧场 / Music","/music",[103,105,108,111,114,117,120,123],{"title":104,"_path":101},"🎸 FingerStyle！",{"title":106,"_path":107},"🌬️ 等待的风","/music/wind",{"title":109,"_path":110},"💕 约定的海洋","/music/ocean",{"title":112,"_path":113},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":115,"_path":116},"🌏 残酷天使的行动纲领","/music/eva",{"title":118,"_path":119},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":121,"_path":122},"🍷 Wu Wei","/music/wu-wei",{"title":124,"_path":125},"🌅 无题","/music/untitled",{"title":127,"_path":128,"children":129},"画点什么 / Paint","/paint",[130],{"title":131,"_path":128},"🚧 正在施工",{"title":133,"_path":134,"children":135},"知识地图 / Maps","/maps",[136],{"title":137,"_path":134},"🏁 知识地图",{"title":139,"_path":140,"children":141},"零散的笔记 / Gists","/gists",[142,144,147,150,153,156,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255,258,261,264,267,270,273,276,279,282,285,288,291,294,297,300,303,306,309,312,315,318,321,324,327,330,333,336,339,342,345,348,351,354,357,360,363,366,369],{"title":143,"_path":140},"🧊 Gists",{"title":145,"_path":146},"网站的可访问性","/gists/accessibility",{"title":148,"_path":149},"Bit","/gists/bit",{"title":151,"_path":152},"图片模糊","/gists/blur",{"title":154,"_path":155},"渲染相关笔记","/gists/c4d",{"title":157,"_path":158},"CDN 问题记录","/gists/cdn",{"title":160,"_path":161},"消毒剂","/gists/cleaner",{"title":163,"_path":164},"Windows Command","/gists/cmd",{"title":166,"_path":167},"Command","/gists/command",{"title":169,"_path":170},"复杂科学","/gists/complexity-science",{"title":172,"_path":173},"宇宙","/gists/cosmos",{"title":175,"_path":176},"C++","/gists/cpp",{"title":178,"_path":179},"Data Structure","/gists/data-structure",{"title":181,"_path":182},"DEPRESSION","/gists/depression",{"title":184,"_path":185},"设计模式","/gists/design-patterns",{"title":187,"_path":188},"Developer Experience","/gists/developer-experience",{"title":190,"_path":191},"Device Metrics","/gists/device-metrix",{"title":193,"_path":194},"ECMAScript Language Specification","/gists/ecmascript-specification",{"title":196,"_path":197},"正则表达式","/gists/eegex",{"title":199,"_path":200},"Emoji","/gists/emoji",{"title":202,"_path":203},"工程","/gists/engineering",{"title":205,"_path":206},"熵","/gists/entropy",{"title":208,"_path":209},"Environment","/gists/environment",{"title":211,"_path":212},"Erlang","/gists/erlang",{"title":214,"_path":215},"逃离塔克夫","/gists/escape-from-tarkov",{"title":217,"_path":218},"ESNext (ES6-ES11)","/gists/esnext",{"title":220,"_path":221},"Eval！","/gists/eval",{"title":223,"_path":224},"Flutter","/gists/flutter",{"title":226,"_path":227},"字体","/gists/font",{"title":229,"_path":230},"JS 函数式编程","/gists/functional",{"title":232,"_path":233},"Google C++ Standard","/gists/google-cpp-standard",{"title":235,"_path":236},"双向链接完全体","/gists/graph",{"title":238,"_path":239},"Hardwares","/gists/hardwares",{"title":241,"_path":242},"哈希冲突","/gists/hash-collision",{"title":244,"_path":245},"信息设计","/gists/information-design",{"title":247,"_path":248},"InstantPage","/gists/instant.page",{"title":250,"_path":251},"ISUX 遇见大数据可视化系列","/gists/isux-data-visualization",{"title":253,"_path":254},"KVStore","/gists/key-value-db",{"title":256,"_path":257},"Kubernetes","/gists/kubernetes",{"title":259,"_path":260},"Makefile","/gists/makefile",{"title":262,"_path":263},"Markdown Inline Style","/gists/markdown-nice",{"title":265,"_path":266},"小程序","/gists/miniapp",{"title":268,"_path":269},"减小页面快照体积","/gists/minify-html",{"title":271,"_path":272},"mklink","/gists/mklink",{"title":274,"_path":275},"Mock","/gists/mock",{"title":277,"_path":278},"多端应用","/gists/multy-end-app",{"title":280,"_path":281},"神经科学","/gists/neuroscience",{"title":283,"_path":284},"OO","/gists/oo",{"title":286,"_path":287},"Opinioned Personal Folder","/gists/opinioned-personal-folder",{"title":289,"_path":290},"人物","/gists/person",{"title":292,"_path":293},"PInvoke","/gists/pinvoke",{"title":295,"_path":296},"像素","/gists/pixel",{"title":298,"_path":299},"PowerShell","/gists/powershell",{"title":301,"_path":302},"量子","/gists/quantum",{"title":304,"_path":305},"保持好奇心","/gists/questions",{"title":307,"_path":308},"React Native","/gists/react-native",{"title":310,"_path":311},"博客改版碰到的浏览器平滑滚动问题","/gists/scroll",{"title":313,"_path":314},"SEO","/gists/seo",{"title":316,"_path":317},"Shader","/gists/shader",{"title":319,"_path":320},"Shape Up","/gists/shape-up",{"title":322,"_path":323},"睡觉","/gists/sleep",{"title":325,"_path":326},"States","/gists/states",{"title":328,"_path":329},"Storage","/gists/storage",{"title":331,"_path":332},"音视频流处理","/gists/stream-cli",{"title":334,"_path":335},"Symbol","/gists/symbol",{"title":337,"_path":338},"系统论","/gists/systems-theory",{"title":340,"_path":341},"Taro","/gists/taro",{"title":343,"_path":344},"任务切片","/gists/task-slice",{"title":346,"_path":347},"技术偏好","/gists/tech-dudge",{"title":349,"_path":350},"Untitled","/gists/untitled",{"title":352,"_path":353},"可变字体","/gists/variable-font",{"title":355,"_path":356},"视觉错觉","/gists/visual-illusion",{"title":358,"_path":359},"SS(SSR)","/gists/vpn",{"title":361,"_path":362},"VS Code 插件开发","/gists/vscode-plugin",{"title":364,"_path":365},"Web Components","/gists/web-components",{"title":367,"_path":368},"Windows","/gists/windows",{"title":370,"_path":371},"查缺补漏","/gists/wrong",{"title":373,"_path":374,"children":375},"代码笔记 / Gists","/source-code",[376],{"title":377,"_path":374},"🚄 代码笔记",{"title":379,"_path":380,"children":381},"我 / Abount","/hire",[382],{"title":383,"_path":380},"📬 技术简历",{"title":385,"_path":386,"children":387},"todo","/todo",[388],{"title":385,"_path":386},{"_path":390,"_dir":391,"_draft":392,"_partial":393,"_locale":394,"title":395,"description":394,"body":396,"_type":2316,"_id":2317,"_source":2318,"_file":2319,"_extension":2320},"/source-code/_fingerprint/canvas-blocker","_fingerprint",false,true,"","Canvas Blocker",{"type":397,"children":398,"toc":2306},"root",[399,407,413,419,469,474,480,485,490,867,872,877,884,889,914,919,1077,1082,1665,1671,1676,1689,1694,2271,2277,2282,2287,2300],{"type":400,"tag":401,"props":402,"children":404},"element","h1",{"id":403},"canvas-blocker",[405],{"type":406,"value":395},"text",{"type":400,"tag":408,"props":409,"children":411},"h2",{"id":410},"前言",[412],{"type":406,"value":410},{"type":400,"tag":414,"props":415,"children":416},"p",{},[417],{"type":406,"value":418},"最近在看一些反反爬相关的东西，期间找到了 Canvas Blocker 这个神奇的库。他是一个浏览器扩展，声称能拦截以下几种类型的指纹追踪：",{"type":400,"tag":420,"props":421,"children":422},"ul",{},[423,429,434,439,444,449,454,459,464],{"type":400,"tag":424,"props":425,"children":426},"li",{},[427],{"type":406,"value":428},"Canvas 2D",{"type":400,"tag":424,"props":430,"children":431},{},[432],{"type":406,"value":433},"WebGL",{"type":400,"tag":424,"props":435,"children":436},{},[437],{"type":406,"value":438},"Web Audio",{"type":400,"tag":424,"props":440,"children":441},{},[442],{"type":406,"value":443},"History",{"type":400,"tag":424,"props":445,"children":446},{},[447],{"type":406,"value":448},"Window",{"type":400,"tag":424,"props":450,"children":451},{},[452],{"type":406,"value":453},"DOMRect",{"type":400,"tag":424,"props":455,"children":456},{},[457],{"type":406,"value":458},"TextMetrics",{"type":400,"tag":424,"props":460,"children":461},{},[462],{"type":406,"value":463},"Navigator",{"type":400,"tag":424,"props":465,"children":466},{},[467],{"type":406,"value":468},"Screen",{"type":400,"tag":414,"props":470,"children":471},{},[472],{"type":406,"value":473},"让我们大致拆解一下，看看其原理是什么。",{"type":400,"tag":408,"props":475,"children":477},{"id":476},"intercept",[478],{"type":406,"value":479},"Intercept",{"type":400,"tag":414,"props":481,"children":482},{},[483],{"type":406,"value":484},"Blocker 最主要的思路就是用伪造的函数篡改属性的 Getter 以及某些 API。",{"type":400,"tag":414,"props":486,"children":487},{},[488],{"type":406,"value":489},"篡改的入口在 intercept.js 中，先根据页面 URL 检查当前页面是否允许篡改，允许的话就通过 interceptFns、interceptGetters 实施具体步骤。",{"type":400,"tag":491,"props":492,"children":496},"pre",{"className":493,"code":494,"language":495,"meta":394,"style":394},"language-js shiki shiki-themes material-theme-lighter github-light github-dark monokai","scope.intercept = function intercept({subject: windowToProcess}, apis){\n  const siteStatus = apis.check({url: getURL(windowToProcess)})\n  logging.verbose(\"status for page\", windowToProcess, siteStatus)\n  if (siteStatus.mode !== \"allow\"){\n    interceptFunctions(windowToProcess, siteStatus, apis)\n    interceptGetters(windowToProcess, siteStatus, apis)\n  }\n}\n","js",[497],{"type":400,"tag":498,"props":499,"children":500},"code",{"__ignoreMap":394},[501,578,659,718,775,812,849,858],{"type":400,"tag":502,"props":503,"children":506},"span",{"class":504,"line":505},"line",1,[507,513,519,524,530,536,541,546,552,557,563,568,573],{"type":400,"tag":502,"props":508,"children":510},{"style":509},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[511],{"type":406,"value":512},"scope",{"type":400,"tag":502,"props":514,"children":516},{"style":515},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[517],{"type":406,"value":518},".",{"type":400,"tag":502,"props":520,"children":522},{"style":521},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[523],{"type":406,"value":476},{"type":400,"tag":502,"props":525,"children":527},{"style":526},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[528],{"type":406,"value":529}," =",{"type":400,"tag":502,"props":531,"children":533},{"style":532},"--shiki-light:#9C3EDA;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#66D9EF;--shiki-light-font-style:inherit;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[534],{"type":406,"value":535}," function",{"type":400,"tag":502,"props":537,"children":538},{"style":521},[539],{"type":406,"value":540}," intercept",{"type":400,"tag":502,"props":542,"children":543},{"style":515},[544],{"type":406,"value":545},"({",{"type":400,"tag":502,"props":547,"children":549},{"style":548},"--shiki-light:#E53935;--shiki-default:#E36209;--shiki-dark:#FFAB70;--shiki-sepia:#F8F8F2",[550],{"type":406,"value":551},"subject",{"type":400,"tag":502,"props":553,"children":554},{"style":515},[555],{"type":406,"value":556},":",{"type":400,"tag":502,"props":558,"children":560},{"style":559},"--shiki-light:#90A4AE;--shiki-default:#E36209;--shiki-dark:#FFAB70;--shiki-sepia:#FD971F;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[561],{"type":406,"value":562}," windowToProcess",{"type":400,"tag":502,"props":564,"children":565},{"style":515},[566],{"type":406,"value":567},"},",{"type":400,"tag":502,"props":569,"children":570},{"style":559},[571],{"type":406,"value":572}," apis",{"type":400,"tag":502,"props":574,"children":575},{"style":515},[576],{"type":406,"value":577},"){\n",{"type":400,"tag":502,"props":579,"children":581},{"class":504,"line":580},2,[582,587,593,597,601,605,610,616,621,626,630,635,639,644,649,654],{"type":400,"tag":502,"props":583,"children":584},{"style":532},[585],{"type":406,"value":586},"  const",{"type":400,"tag":502,"props":588,"children":590},{"style":589},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#F8F8F2",[591],{"type":406,"value":592}," siteStatus",{"type":400,"tag":502,"props":594,"children":595},{"style":526},[596],{"type":406,"value":529},{"type":400,"tag":502,"props":598,"children":599},{"style":509},[600],{"type":406,"value":572},{"type":400,"tag":502,"props":602,"children":603},{"style":515},[604],{"type":406,"value":518},{"type":400,"tag":502,"props":606,"children":607},{"style":521},[608],{"type":406,"value":609},"check",{"type":400,"tag":502,"props":611,"children":613},{"style":612},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[614],{"type":406,"value":615},"(",{"type":400,"tag":502,"props":617,"children":618},{"style":515},[619],{"type":406,"value":620},"{",{"type":400,"tag":502,"props":622,"children":623},{"style":612},[624],{"type":406,"value":625},"url",{"type":400,"tag":502,"props":627,"children":628},{"style":515},[629],{"type":406,"value":556},{"type":400,"tag":502,"props":631,"children":632},{"style":521},[633],{"type":406,"value":634}," getURL",{"type":400,"tag":502,"props":636,"children":637},{"style":612},[638],{"type":406,"value":615},{"type":400,"tag":502,"props":640,"children":641},{"style":509},[642],{"type":406,"value":643},"windowToProcess",{"type":400,"tag":502,"props":645,"children":646},{"style":612},[647],{"type":406,"value":648},")",{"type":400,"tag":502,"props":650,"children":651},{"style":515},[652],{"type":406,"value":653},"}",{"type":400,"tag":502,"props":655,"children":656},{"style":612},[657],{"type":406,"value":658},")\n",{"type":400,"tag":502,"props":660,"children":662},{"class":504,"line":661},3,[663,668,672,677,681,687,693,697,702,706,710,714],{"type":400,"tag":502,"props":664,"children":665},{"style":509},[666],{"type":406,"value":667},"  logging",{"type":400,"tag":502,"props":669,"children":670},{"style":515},[671],{"type":406,"value":518},{"type":400,"tag":502,"props":673,"children":674},{"style":521},[675],{"type":406,"value":676},"verbose",{"type":400,"tag":502,"props":678,"children":679},{"style":612},[680],{"type":406,"value":615},{"type":400,"tag":502,"props":682,"children":684},{"style":683},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[685],{"type":406,"value":686},"\"",{"type":400,"tag":502,"props":688,"children":690},{"style":689},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[691],{"type":406,"value":692},"status for page",{"type":400,"tag":502,"props":694,"children":695},{"style":683},[696],{"type":406,"value":686},{"type":400,"tag":502,"props":698,"children":699},{"style":515},[700],{"type":406,"value":701},",",{"type":400,"tag":502,"props":703,"children":704},{"style":509},[705],{"type":406,"value":562},{"type":400,"tag":502,"props":707,"children":708},{"style":515},[709],{"type":406,"value":701},{"type":400,"tag":502,"props":711,"children":712},{"style":509},[713],{"type":406,"value":592},{"type":400,"tag":502,"props":715,"children":716},{"style":612},[717],{"type":406,"value":658},{"type":400,"tag":502,"props":719,"children":721},{"class":504,"line":720},4,[722,728,733,738,742,747,752,757,762,766,770],{"type":400,"tag":502,"props":723,"children":725},{"style":724},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:inherit",[726],{"type":406,"value":727},"  if",{"type":400,"tag":502,"props":729,"children":730},{"style":612},[731],{"type":406,"value":732}," (",{"type":400,"tag":502,"props":734,"children":735},{"style":509},[736],{"type":406,"value":737},"siteStatus",{"type":400,"tag":502,"props":739,"children":740},{"style":515},[741],{"type":406,"value":518},{"type":400,"tag":502,"props":743,"children":744},{"style":509},[745],{"type":406,"value":746},"mode",{"type":400,"tag":502,"props":748,"children":749},{"style":526},[750],{"type":406,"value":751}," !==",{"type":400,"tag":502,"props":753,"children":754},{"style":683},[755],{"type":406,"value":756}," \"",{"type":400,"tag":502,"props":758,"children":759},{"style":689},[760],{"type":406,"value":761},"allow",{"type":400,"tag":502,"props":763,"children":764},{"style":683},[765],{"type":406,"value":686},{"type":400,"tag":502,"props":767,"children":768},{"style":612},[769],{"type":406,"value":648},{"type":400,"tag":502,"props":771,"children":772},{"style":515},[773],{"type":406,"value":774},"{\n",{"type":400,"tag":502,"props":776,"children":778},{"class":504,"line":777},5,[779,784,788,792,796,800,804,808],{"type":400,"tag":502,"props":780,"children":781},{"style":521},[782],{"type":406,"value":783},"    interceptFunctions",{"type":400,"tag":502,"props":785,"children":786},{"style":612},[787],{"type":406,"value":615},{"type":400,"tag":502,"props":789,"children":790},{"style":509},[791],{"type":406,"value":643},{"type":400,"tag":502,"props":793,"children":794},{"style":515},[795],{"type":406,"value":701},{"type":400,"tag":502,"props":797,"children":798},{"style":509},[799],{"type":406,"value":592},{"type":400,"tag":502,"props":801,"children":802},{"style":515},[803],{"type":406,"value":701},{"type":400,"tag":502,"props":805,"children":806},{"style":509},[807],{"type":406,"value":572},{"type":400,"tag":502,"props":809,"children":810},{"style":612},[811],{"type":406,"value":658},{"type":400,"tag":502,"props":813,"children":815},{"class":504,"line":814},6,[816,821,825,829,833,837,841,845],{"type":400,"tag":502,"props":817,"children":818},{"style":521},[819],{"type":406,"value":820},"    interceptGetters",{"type":400,"tag":502,"props":822,"children":823},{"style":612},[824],{"type":406,"value":615},{"type":400,"tag":502,"props":826,"children":827},{"style":509},[828],{"type":406,"value":643},{"type":400,"tag":502,"props":830,"children":831},{"style":515},[832],{"type":406,"value":701},{"type":400,"tag":502,"props":834,"children":835},{"style":509},[836],{"type":406,"value":592},{"type":400,"tag":502,"props":838,"children":839},{"style":515},[840],{"type":406,"value":701},{"type":400,"tag":502,"props":842,"children":843},{"style":509},[844],{"type":406,"value":572},{"type":400,"tag":502,"props":846,"children":847},{"style":612},[848],{"type":406,"value":658},{"type":400,"tag":502,"props":850,"children":852},{"class":504,"line":851},7,[853],{"type":400,"tag":502,"props":854,"children":855},{"style":515},[856],{"type":406,"value":857},"  }\n",{"type":400,"tag":502,"props":859,"children":861},{"class":504,"line":860},8,[862],{"type":400,"tag":502,"props":863,"children":864},{"style":515},[865],{"type":406,"value":866},"}\n",{"type":400,"tag":408,"props":868,"children":870},{"id":869},"window",[871],{"type":406,"value":448},{"type":400,"tag":414,"props":873,"children":874},{},[875],{"type":406,"value":876},"Blocker 篡改了 Window 的两个属性，window.name 和 window.opener。这两个属性和指纹没有直接关系，但却是一种“帮助函数”，能够帮助恶意网站追踪指纹以及窃取隐私。",{"type":400,"tag":878,"props":879,"children":881},"h3",{"id":880},"windowname",[882],{"type":406,"value":883},"window.name",{"type":400,"tag":414,"props":885,"children":886},{},[887],{"type":406,"value":888},"在过去的浏览器中，window.name 能够跨站点传输数据，并且能逃逸同源策略。从 Firefox 88 开始，用户通过点击超链接跳转到新页面时，window.name 将被置空，不过为了不造成更大的破坏，当用户从跳转后页面回到之前页面时，window.name 会被还原。",{"type":400,"tag":420,"props":890,"children":891},{},[892,904],{"type":400,"tag":424,"props":893,"children":894},{},[895],{"type":400,"tag":896,"props":897,"children":901},"a",{"href":898,"rel":899},"https://blog.mozilla.org/security/2021/04/19/firefox-88-combats-window-name-privacy-abuses/",[900],"nofollow",[902],{"type":406,"value":903},"Firefox 88 combats window.name privacy abuses",{"type":400,"tag":424,"props":905,"children":906},{},[907],{"type":400,"tag":896,"props":908,"children":911},{"href":909,"rel":910},"https://wpt.fyi/results/html/browsers/windows/clear-window-name.https.html?label=master&label=experimental&aligned",[900],[912],{"type":406,"value":913},"clear-window-name@web-platform-tests",{"type":400,"tag":414,"props":915,"children":916},{},[917],{"type":406,"value":918},"在使用 JS 设置 window.name 时，Blcoker 会记录下设置的值。original.call 调用原有的 window.name setter；windowNames 只做记录，稍后会用到。",{"type":400,"tag":491,"props":920,"children":922},{"className":493,"code":921,"language":495,"meta":394,"style":394},"{\n  set name(name){\n    // 调用原有 setting 设置 window.name\n    original.call(this, ...arguments)\n    // 把 name 记录下来\n    windowNames.set(this, name)\n  }\n}\n",[923],{"type":400,"tag":498,"props":924,"children":925},{"__ignoreMap":394},[926,933,963,972,1018,1026,1063,1070],{"type":400,"tag":502,"props":927,"children":928},{"class":504,"line":505},[929],{"type":400,"tag":502,"props":930,"children":931},{"style":515},[932],{"type":406,"value":774},{"type":400,"tag":502,"props":934,"children":935},{"class":504,"line":580},[936,941,946,950,955,959],{"type":400,"tag":502,"props":937,"children":938},{"style":509},[939],{"type":406,"value":940},"  set",{"type":400,"tag":502,"props":942,"children":943},{"style":521},[944],{"type":406,"value":945}," name",{"type":400,"tag":502,"props":947,"children":948},{"style":612},[949],{"type":406,"value":615},{"type":400,"tag":502,"props":951,"children":952},{"style":509},[953],{"type":406,"value":954},"name",{"type":400,"tag":502,"props":956,"children":957},{"style":612},[958],{"type":406,"value":648},{"type":400,"tag":502,"props":960,"children":961},{"style":515},[962],{"type":406,"value":774},{"type":400,"tag":502,"props":964,"children":965},{"class":504,"line":661},[966],{"type":400,"tag":502,"props":967,"children":969},{"style":968},"--shiki-light:#90A4AE;--shiki-default:#6A737D;--shiki-dark:#6A737D;--shiki-sepia:#88846F;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:inherit",[970],{"type":406,"value":971},"    // 调用原有 setting 设置 window.name\n",{"type":400,"tag":502,"props":973,"children":974},{"class":504,"line":720},[975,980,984,989,993,999,1003,1008,1014],{"type":400,"tag":502,"props":976,"children":977},{"style":509},[978],{"type":406,"value":979},"    original",{"type":400,"tag":502,"props":981,"children":982},{"style":515},[983],{"type":406,"value":518},{"type":400,"tag":502,"props":985,"children":986},{"style":521},[987],{"type":406,"value":988},"call",{"type":400,"tag":502,"props":990,"children":991},{"style":612},[992],{"type":406,"value":615},{"type":400,"tag":502,"props":994,"children":996},{"style":995},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[997],{"type":406,"value":998},"this",{"type":400,"tag":502,"props":1000,"children":1001},{"style":515},[1002],{"type":406,"value":701},{"type":400,"tag":502,"props":1004,"children":1005},{"style":526},[1006],{"type":406,"value":1007}," ...",{"type":400,"tag":502,"props":1009,"children":1011},{"style":1010},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[1012],{"type":406,"value":1013},"arguments",{"type":400,"tag":502,"props":1015,"children":1016},{"style":612},[1017],{"type":406,"value":658},{"type":400,"tag":502,"props":1019,"children":1020},{"class":504,"line":777},[1021],{"type":400,"tag":502,"props":1022,"children":1023},{"style":968},[1024],{"type":406,"value":1025},"    // 把 name 记录下来\n",{"type":400,"tag":502,"props":1027,"children":1028},{"class":504,"line":814},[1029,1034,1038,1043,1047,1051,1055,1059],{"type":400,"tag":502,"props":1030,"children":1031},{"style":509},[1032],{"type":406,"value":1033},"    windowNames",{"type":400,"tag":502,"props":1035,"children":1036},{"style":515},[1037],{"type":406,"value":518},{"type":400,"tag":502,"props":1039,"children":1040},{"style":521},[1041],{"type":406,"value":1042},"set",{"type":400,"tag":502,"props":1044,"children":1045},{"style":612},[1046],{"type":406,"value":615},{"type":400,"tag":502,"props":1048,"children":1049},{"style":995},[1050],{"type":406,"value":998},{"type":400,"tag":502,"props":1052,"children":1053},{"style":515},[1054],{"type":406,"value":701},{"type":400,"tag":502,"props":1056,"children":1057},{"style":509},[1058],{"type":406,"value":945},{"type":400,"tag":502,"props":1060,"children":1061},{"style":612},[1062],{"type":406,"value":658},{"type":400,"tag":502,"props":1064,"children":1065},{"class":504,"line":851},[1066],{"type":400,"tag":502,"props":1067,"children":1068},{"style":515},[1069],{"type":406,"value":857},{"type":400,"tag":502,"props":1071,"children":1072},{"class":504,"line":860},[1073],{"type":400,"tag":502,"props":1074,"children":1075},{"style":515},[1076],{"type":406,"value":866},{"type":400,"tag":414,"props":1078,"children":1079},{},[1080],{"type":406,"value":1081},"因为只有通过显式的 window.name = 'xxx' 才会触发 windowNames 中记录的值的改变，所以一旦在 b.com 读取到的 window.name 不是 windowNames 记录的值，就说明浏览器泄露了 window.name，此时需要返回伪造的值。",{"type":400,"tag":491,"props":1083,"children":1085},{"className":493,"code":1084,"language":495,"meta":394,"style":394},"{\n  get name(){\n    return checkerWrapper(checker, this, arguments, function(args, check){\n      const {notify, original, prefs} = check\n\n      // 读取 b.com 的 window.name 可能会返回 a.com 的 window.name\n      const originalName = original.call(this, ...args)\n\n      // 根据配置，iframes 中返回的 window.name 可以赦免此伪造规则，\n      // this !== this.top 是一种快速检测当前 window 是否在 iframe 中的方法\n      if (\n        this !== this.top &&\n        prefs(\"allowWindowNameInFrames\", this.location)\n      ){\n        return originalName\n      }\n\n      // 只有通过显式的 window.name = 'xxx' 才会触发 windowNames 中记录的值的改变，\n      // 所以一旦 windowNames 记录的值和 originalName 不一样，\n      // 就说明当前浏览器犯了 window.name 泄露的错误\n      const returnedName = windowNames.get(this) || \"\"\n      if (originalName !== returnedName){\n        notify(\"fakedWindowReadout\")\n      }\n      return returnedName\n    });\n  }\n}\n",[1086],{"type":400,"tag":498,"props":1087,"children":1088},{"__ignoreMap":394},[1089,1096,1117,1187,1236,1244,1252,1304,1311,1320,1329,1343,1374,1421,1434,1448,1457,1465,1474,1483,1492,1546,1579,1609,1617,1631,1649,1657],{"type":400,"tag":502,"props":1090,"children":1091},{"class":504,"line":505},[1092],{"type":400,"tag":502,"props":1093,"children":1094},{"style":515},[1095],{"type":406,"value":774},{"type":400,"tag":502,"props":1097,"children":1098},{"class":504,"line":580},[1099,1104,1108,1113],{"type":400,"tag":502,"props":1100,"children":1101},{"style":509},[1102],{"type":406,"value":1103},"  get",{"type":400,"tag":502,"props":1105,"children":1106},{"style":521},[1107],{"type":406,"value":945},{"type":400,"tag":502,"props":1109,"children":1110},{"style":612},[1111],{"type":406,"value":1112},"()",{"type":400,"tag":502,"props":1114,"children":1115},{"style":515},[1116],{"type":406,"value":774},{"type":400,"tag":502,"props":1118,"children":1119},{"class":504,"line":661},[1120,1125,1130,1134,1139,1143,1148,1152,1157,1161,1165,1169,1174,1178,1183],{"type":400,"tag":502,"props":1121,"children":1122},{"style":724},[1123],{"type":406,"value":1124},"    return",{"type":400,"tag":502,"props":1126,"children":1127},{"style":521},[1128],{"type":406,"value":1129}," checkerWrapper",{"type":400,"tag":502,"props":1131,"children":1132},{"style":612},[1133],{"type":406,"value":615},{"type":400,"tag":502,"props":1135,"children":1136},{"style":509},[1137],{"type":406,"value":1138},"checker",{"type":400,"tag":502,"props":1140,"children":1141},{"style":515},[1142],{"type":406,"value":701},{"type":400,"tag":502,"props":1144,"children":1145},{"style":995},[1146],{"type":406,"value":1147}," this",{"type":400,"tag":502,"props":1149,"children":1150},{"style":515},[1151],{"type":406,"value":701},{"type":400,"tag":502,"props":1153,"children":1154},{"style":1010},[1155],{"type":406,"value":1156}," arguments",{"type":400,"tag":502,"props":1158,"children":1159},{"style":515},[1160],{"type":406,"value":701},{"type":400,"tag":502,"props":1162,"children":1163},{"style":532},[1164],{"type":406,"value":535},{"type":400,"tag":502,"props":1166,"children":1167},{"style":515},[1168],{"type":406,"value":615},{"type":400,"tag":502,"props":1170,"children":1171},{"style":559},[1172],{"type":406,"value":1173},"args",{"type":400,"tag":502,"props":1175,"children":1176},{"style":515},[1177],{"type":406,"value":701},{"type":400,"tag":502,"props":1179,"children":1180},{"style":559},[1181],{"type":406,"value":1182}," check",{"type":400,"tag":502,"props":1184,"children":1185},{"style":515},[1186],{"type":406,"value":577},{"type":400,"tag":502,"props":1188,"children":1189},{"class":504,"line":720},[1190,1195,1200,1205,1209,1214,1218,1223,1227,1231],{"type":400,"tag":502,"props":1191,"children":1192},{"style":532},[1193],{"type":406,"value":1194},"      const",{"type":400,"tag":502,"props":1196,"children":1197},{"style":515},[1198],{"type":406,"value":1199}," {",{"type":400,"tag":502,"props":1201,"children":1202},{"style":589},[1203],{"type":406,"value":1204},"notify",{"type":400,"tag":502,"props":1206,"children":1207},{"style":515},[1208],{"type":406,"value":701},{"type":400,"tag":502,"props":1210,"children":1211},{"style":589},[1212],{"type":406,"value":1213}," original",{"type":400,"tag":502,"props":1215,"children":1216},{"style":515},[1217],{"type":406,"value":701},{"type":400,"tag":502,"props":1219,"children":1220},{"style":589},[1221],{"type":406,"value":1222}," prefs",{"type":400,"tag":502,"props":1224,"children":1225},{"style":515},[1226],{"type":406,"value":653},{"type":400,"tag":502,"props":1228,"children":1229},{"style":526},[1230],{"type":406,"value":529},{"type":400,"tag":502,"props":1232,"children":1233},{"style":509},[1234],{"type":406,"value":1235}," check\n",{"type":400,"tag":502,"props":1237,"children":1238},{"class":504,"line":777},[1239],{"type":400,"tag":502,"props":1240,"children":1241},{"emptyLinePlaceholder":393},[1242],{"type":406,"value":1243},"\n",{"type":400,"tag":502,"props":1245,"children":1246},{"class":504,"line":814},[1247],{"type":400,"tag":502,"props":1248,"children":1249},{"style":968},[1250],{"type":406,"value":1251},"      // 读取 b.com 的 window.name 可能会返回 a.com 的 window.name\n",{"type":400,"tag":502,"props":1253,"children":1254},{"class":504,"line":851},[1255,1259,1264,1268,1272,1276,1280,1284,1288,1292,1296,1300],{"type":400,"tag":502,"props":1256,"children":1257},{"style":532},[1258],{"type":406,"value":1194},{"type":400,"tag":502,"props":1260,"children":1261},{"style":589},[1262],{"type":406,"value":1263}," originalName",{"type":400,"tag":502,"props":1265,"children":1266},{"style":526},[1267],{"type":406,"value":529},{"type":400,"tag":502,"props":1269,"children":1270},{"style":509},[1271],{"type":406,"value":1213},{"type":400,"tag":502,"props":1273,"children":1274},{"style":515},[1275],{"type":406,"value":518},{"type":400,"tag":502,"props":1277,"children":1278},{"style":521},[1279],{"type":406,"value":988},{"type":400,"tag":502,"props":1281,"children":1282},{"style":612},[1283],{"type":406,"value":615},{"type":400,"tag":502,"props":1285,"children":1286},{"style":995},[1287],{"type":406,"value":998},{"type":400,"tag":502,"props":1289,"children":1290},{"style":515},[1291],{"type":406,"value":701},{"type":400,"tag":502,"props":1293,"children":1294},{"style":526},[1295],{"type":406,"value":1007},{"type":400,"tag":502,"props":1297,"children":1298},{"style":509},[1299],{"type":406,"value":1173},{"type":400,"tag":502,"props":1301,"children":1302},{"style":612},[1303],{"type":406,"value":658},{"type":400,"tag":502,"props":1305,"children":1306},{"class":504,"line":860},[1307],{"type":400,"tag":502,"props":1308,"children":1309},{"emptyLinePlaceholder":393},[1310],{"type":406,"value":1243},{"type":400,"tag":502,"props":1312,"children":1314},{"class":504,"line":1313},9,[1315],{"type":400,"tag":502,"props":1316,"children":1317},{"style":968},[1318],{"type":406,"value":1319},"      // 根据配置，iframes 中返回的 window.name 可以赦免此伪造规则，\n",{"type":400,"tag":502,"props":1321,"children":1323},{"class":504,"line":1322},10,[1324],{"type":400,"tag":502,"props":1325,"children":1326},{"style":968},[1327],{"type":406,"value":1328},"      // this !== this.top 是一种快速检测当前 window 是否在 iframe 中的方法\n",{"type":400,"tag":502,"props":1330,"children":1332},{"class":504,"line":1331},11,[1333,1338],{"type":400,"tag":502,"props":1334,"children":1335},{"style":724},[1336],{"type":406,"value":1337},"      if",{"type":400,"tag":502,"props":1339,"children":1340},{"style":612},[1341],{"type":406,"value":1342}," (\n",{"type":400,"tag":502,"props":1344,"children":1346},{"class":504,"line":1345},12,[1347,1352,1356,1360,1364,1369],{"type":400,"tag":502,"props":1348,"children":1349},{"style":995},[1350],{"type":406,"value":1351},"        this",{"type":400,"tag":502,"props":1353,"children":1354},{"style":526},[1355],{"type":406,"value":751},{"type":400,"tag":502,"props":1357,"children":1358},{"style":995},[1359],{"type":406,"value":1147},{"type":400,"tag":502,"props":1361,"children":1362},{"style":515},[1363],{"type":406,"value":518},{"type":400,"tag":502,"props":1365,"children":1366},{"style":509},[1367],{"type":406,"value":1368},"top",{"type":400,"tag":502,"props":1370,"children":1371},{"style":526},[1372],{"type":406,"value":1373}," &&\n",{"type":400,"tag":502,"props":1375,"children":1377},{"class":504,"line":1376},13,[1378,1383,1387,1391,1396,1400,1404,1408,1412,1417],{"type":400,"tag":502,"props":1379,"children":1380},{"style":521},[1381],{"type":406,"value":1382},"        prefs",{"type":400,"tag":502,"props":1384,"children":1385},{"style":612},[1386],{"type":406,"value":615},{"type":400,"tag":502,"props":1388,"children":1389},{"style":683},[1390],{"type":406,"value":686},{"type":400,"tag":502,"props":1392,"children":1393},{"style":689},[1394],{"type":406,"value":1395},"allowWindowNameInFrames",{"type":400,"tag":502,"props":1397,"children":1398},{"style":683},[1399],{"type":406,"value":686},{"type":400,"tag":502,"props":1401,"children":1402},{"style":515},[1403],{"type":406,"value":701},{"type":400,"tag":502,"props":1405,"children":1406},{"style":995},[1407],{"type":406,"value":1147},{"type":400,"tag":502,"props":1409,"children":1410},{"style":515},[1411],{"type":406,"value":518},{"type":400,"tag":502,"props":1413,"children":1414},{"style":509},[1415],{"type":406,"value":1416},"location",{"type":400,"tag":502,"props":1418,"children":1419},{"style":612},[1420],{"type":406,"value":658},{"type":400,"tag":502,"props":1422,"children":1424},{"class":504,"line":1423},14,[1425,1430],{"type":400,"tag":502,"props":1426,"children":1427},{"style":612},[1428],{"type":406,"value":1429},"      )",{"type":400,"tag":502,"props":1431,"children":1432},{"style":515},[1433],{"type":406,"value":774},{"type":400,"tag":502,"props":1435,"children":1437},{"class":504,"line":1436},15,[1438,1443],{"type":400,"tag":502,"props":1439,"children":1440},{"style":724},[1441],{"type":406,"value":1442},"        return",{"type":400,"tag":502,"props":1444,"children":1445},{"style":509},[1446],{"type":406,"value":1447}," originalName\n",{"type":400,"tag":502,"props":1449,"children":1451},{"class":504,"line":1450},16,[1452],{"type":400,"tag":502,"props":1453,"children":1454},{"style":515},[1455],{"type":406,"value":1456},"      }\n",{"type":400,"tag":502,"props":1458,"children":1460},{"class":504,"line":1459},17,[1461],{"type":400,"tag":502,"props":1462,"children":1463},{"emptyLinePlaceholder":393},[1464],{"type":406,"value":1243},{"type":400,"tag":502,"props":1466,"children":1468},{"class":504,"line":1467},18,[1469],{"type":400,"tag":502,"props":1470,"children":1471},{"style":968},[1472],{"type":406,"value":1473},"      // 只有通过显式的 window.name = 'xxx' 才会触发 windowNames 中记录的值的改变，\n",{"type":400,"tag":502,"props":1475,"children":1477},{"class":504,"line":1476},19,[1478],{"type":400,"tag":502,"props":1479,"children":1480},{"style":968},[1481],{"type":406,"value":1482},"      // 所以一旦 windowNames 记录的值和 originalName 不一样，\n",{"type":400,"tag":502,"props":1484,"children":1486},{"class":504,"line":1485},20,[1487],{"type":400,"tag":502,"props":1488,"children":1489},{"style":968},[1490],{"type":406,"value":1491},"      // 就说明当前浏览器犯了 window.name 泄露的错误\n",{"type":400,"tag":502,"props":1493,"children":1495},{"class":504,"line":1494},21,[1496,1500,1505,1509,1514,1518,1523,1527,1531,1536,1541],{"type":400,"tag":502,"props":1497,"children":1498},{"style":532},[1499],{"type":406,"value":1194},{"type":400,"tag":502,"props":1501,"children":1502},{"style":589},[1503],{"type":406,"value":1504}," returnedName",{"type":400,"tag":502,"props":1506,"children":1507},{"style":526},[1508],{"type":406,"value":529},{"type":400,"tag":502,"props":1510,"children":1511},{"style":509},[1512],{"type":406,"value":1513}," windowNames",{"type":400,"tag":502,"props":1515,"children":1516},{"style":515},[1517],{"type":406,"value":518},{"type":400,"tag":502,"props":1519,"children":1520},{"style":521},[1521],{"type":406,"value":1522},"get",{"type":400,"tag":502,"props":1524,"children":1525},{"style":612},[1526],{"type":406,"value":615},{"type":400,"tag":502,"props":1528,"children":1529},{"style":995},[1530],{"type":406,"value":998},{"type":400,"tag":502,"props":1532,"children":1533},{"style":612},[1534],{"type":406,"value":1535},") ",{"type":400,"tag":502,"props":1537,"children":1538},{"style":526},[1539],{"type":406,"value":1540},"||",{"type":400,"tag":502,"props":1542,"children":1543},{"style":683},[1544],{"type":406,"value":1545}," \"\"\n",{"type":400,"tag":502,"props":1547,"children":1549},{"class":504,"line":1548},22,[1550,1554,1558,1563,1567,1571,1575],{"type":400,"tag":502,"props":1551,"children":1552},{"style":724},[1553],{"type":406,"value":1337},{"type":400,"tag":502,"props":1555,"children":1556},{"style":612},[1557],{"type":406,"value":732},{"type":400,"tag":502,"props":1559,"children":1560},{"style":509},[1561],{"type":406,"value":1562},"originalName",{"type":400,"tag":502,"props":1564,"children":1565},{"style":526},[1566],{"type":406,"value":751},{"type":400,"tag":502,"props":1568,"children":1569},{"style":509},[1570],{"type":406,"value":1504},{"type":400,"tag":502,"props":1572,"children":1573},{"style":612},[1574],{"type":406,"value":648},{"type":400,"tag":502,"props":1576,"children":1577},{"style":515},[1578],{"type":406,"value":774},{"type":400,"tag":502,"props":1580,"children":1582},{"class":504,"line":1581},23,[1583,1588,1592,1596,1601,1605],{"type":400,"tag":502,"props":1584,"children":1585},{"style":521},[1586],{"type":406,"value":1587},"        notify",{"type":400,"tag":502,"props":1589,"children":1590},{"style":612},[1591],{"type":406,"value":615},{"type":400,"tag":502,"props":1593,"children":1594},{"style":683},[1595],{"type":406,"value":686},{"type":400,"tag":502,"props":1597,"children":1598},{"style":689},[1599],{"type":406,"value":1600},"fakedWindowReadout",{"type":400,"tag":502,"props":1602,"children":1603},{"style":683},[1604],{"type":406,"value":686},{"type":400,"tag":502,"props":1606,"children":1607},{"style":612},[1608],{"type":406,"value":658},{"type":400,"tag":502,"props":1610,"children":1612},{"class":504,"line":1611},24,[1613],{"type":400,"tag":502,"props":1614,"children":1615},{"style":515},[1616],{"type":406,"value":1456},{"type":400,"tag":502,"props":1618,"children":1620},{"class":504,"line":1619},25,[1621,1626],{"type":400,"tag":502,"props":1622,"children":1623},{"style":724},[1624],{"type":406,"value":1625},"      return",{"type":400,"tag":502,"props":1627,"children":1628},{"style":509},[1629],{"type":406,"value":1630}," returnedName\n",{"type":400,"tag":502,"props":1632,"children":1634},{"class":504,"line":1633},26,[1635,1640,1644],{"type":400,"tag":502,"props":1636,"children":1637},{"style":515},[1638],{"type":406,"value":1639},"    }",{"type":400,"tag":502,"props":1641,"children":1642},{"style":612},[1643],{"type":406,"value":648},{"type":400,"tag":502,"props":1645,"children":1646},{"style":515},[1647],{"type":406,"value":1648},";\n",{"type":400,"tag":502,"props":1650,"children":1652},{"class":504,"line":1651},27,[1653],{"type":400,"tag":502,"props":1654,"children":1655},{"style":515},[1656],{"type":406,"value":857},{"type":400,"tag":502,"props":1658,"children":1660},{"class":504,"line":1659},28,[1661],{"type":400,"tag":502,"props":1662,"children":1663},{"style":515},[1664],{"type":406,"value":866},{"type":400,"tag":408,"props":1666,"children":1668},{"id":1667},"windowopener",[1669],{"type":406,"value":1670},"window.opener",{"type":400,"tag":414,"props":1672,"children":1673},{},[1674],{"type":406,"value":1675},"在过去的浏览器中，当页面通过超链接或 window.open 的方式从 A 网站跳转到 B 网站时，如果制定了 target 属性却没有指定 rel=\"norefer\" 属性，那么在 B 网站是可以使用 window.opener 获取到 A 网站的部分信息的。也就是说，在 B 网站中可以修改 window.opener.location.href = 'x' 从而让 A 网站自动跳转到 X 网站。如果页面跳转时使用 target=\"__blank\" 打开了新页面，那么用户更加不可能注意到 A 网站的恶意跳转。",{"type":400,"tag":420,"props":1677,"children":1678},{},[1679],{"type":400,"tag":424,"props":1680,"children":1681},{},[1682],{"type":400,"tag":896,"props":1683,"children":1686},{"href":1684,"rel":1685},"https://cwe.mitre.org/data/definitions/1022.html",[900],[1687],{"type":406,"value":1688},"CWE-1022: Use of Web Link to Untrusted Target with window.opener Access",{"type":400,"tag":414,"props":1690,"children":1691},{},[1692],{"type":406,"value":1693},"Blocker 对 window.opener 的防范比较简单，直接返回 null 就完事儿了。考虑到现代浏览器已经修复了这个漏洞，该篡改的设置的值默认是关闭的。",{"type":400,"tag":491,"props":1695,"children":1697},{"className":493,"code":1696,"language":495,"meta":394,"style":394},"{\n  // 修改 Getter 使 window.opener 一直返回 null\n  getterGenerator: function(checker){\n    const temp = {\n      get opener(){\n        return checkerWrapper(checker, this, arguments, function(args, check){\n          const {notify, original} = check\n          const originalOpener = original.call(this, ...args)\n          if (originalOpener !== null){\n            notify(\"fakedWindowReadout\")\n          }\n          return null\n        })\n      }\n    }\n    return Object.getOwnPropertyDescriptor(temp, \"opener\").get\n  },\n  // 修改 Descriptor.Value 使得 window.opener 一直返回 null，\n  // 这是一种兼容，在部分浏览器中，\n  //  window.opener 是通过 value 而不是 getter 获取的值\n  valueGenerator: function({original, notify}){\n    if (original !== null){\n      notify(\"fakedWindowReadout\")\n    }\n    return null\n  }\n}\n",[1698],{"type":400,"tag":498,"props":1699,"children":1700},{"__ignoreMap":394},[1701,1708,1716,1745,1767,1786,1849,1885,1937,1972,2000,2008,2021,2033,2040,2048,2108,2116,2124,2132,2140,2179,2211,2239,2246,2257,2264],{"type":400,"tag":502,"props":1702,"children":1703},{"class":504,"line":505},[1704],{"type":400,"tag":502,"props":1705,"children":1706},{"style":515},[1707],{"type":406,"value":774},{"type":400,"tag":502,"props":1709,"children":1710},{"class":504,"line":580},[1711],{"type":400,"tag":502,"props":1712,"children":1713},{"style":968},[1714],{"type":406,"value":1715},"  // 修改 Getter 使 window.opener 一直返回 null\n",{"type":400,"tag":502,"props":1717,"children":1718},{"class":504,"line":661},[1719,1725,1729,1733,1737,1741],{"type":400,"tag":502,"props":1720,"children":1722},{"style":1721},"--shiki-light:#E2931D;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#F8F8F2",[1723],{"type":406,"value":1724},"  getterGenerator",{"type":400,"tag":502,"props":1726,"children":1727},{"style":515},[1728],{"type":406,"value":556},{"type":400,"tag":502,"props":1730,"children":1731},{"style":532},[1732],{"type":406,"value":535},{"type":400,"tag":502,"props":1734,"children":1735},{"style":515},[1736],{"type":406,"value":615},{"type":400,"tag":502,"props":1738,"children":1739},{"style":559},[1740],{"type":406,"value":1138},{"type":400,"tag":502,"props":1742,"children":1743},{"style":515},[1744],{"type":406,"value":577},{"type":400,"tag":502,"props":1746,"children":1747},{"class":504,"line":720},[1748,1753,1758,1762],{"type":400,"tag":502,"props":1749,"children":1750},{"style":532},[1751],{"type":406,"value":1752},"    const",{"type":400,"tag":502,"props":1754,"children":1755},{"style":589},[1756],{"type":406,"value":1757}," temp",{"type":400,"tag":502,"props":1759,"children":1760},{"style":526},[1761],{"type":406,"value":529},{"type":400,"tag":502,"props":1763,"children":1764},{"style":515},[1765],{"type":406,"value":1766}," {\n",{"type":400,"tag":502,"props":1768,"children":1769},{"class":504,"line":777},[1770,1775,1781],{"type":400,"tag":502,"props":1771,"children":1772},{"style":532},[1773],{"type":406,"value":1774},"      get",{"type":400,"tag":502,"props":1776,"children":1778},{"style":1777},"--shiki-light:#E53935;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[1779],{"type":406,"value":1780}," opener",{"type":400,"tag":502,"props":1782,"children":1783},{"style":515},[1784],{"type":406,"value":1785},"(){\n",{"type":400,"tag":502,"props":1787,"children":1788},{"class":504,"line":814},[1789,1793,1797,1801,1805,1809,1813,1817,1821,1825,1829,1833,1837,1841,1845],{"type":400,"tag":502,"props":1790,"children":1791},{"style":724},[1792],{"type":406,"value":1442},{"type":400,"tag":502,"props":1794,"children":1795},{"style":521},[1796],{"type":406,"value":1129},{"type":400,"tag":502,"props":1798,"children":1799},{"style":612},[1800],{"type":406,"value":615},{"type":400,"tag":502,"props":1802,"children":1803},{"style":509},[1804],{"type":406,"value":1138},{"type":400,"tag":502,"props":1806,"children":1807},{"style":515},[1808],{"type":406,"value":701},{"type":400,"tag":502,"props":1810,"children":1811},{"style":995},[1812],{"type":406,"value":1147},{"type":400,"tag":502,"props":1814,"children":1815},{"style":515},[1816],{"type":406,"value":701},{"type":400,"tag":502,"props":1818,"children":1819},{"style":1010},[1820],{"type":406,"value":1156},{"type":400,"tag":502,"props":1822,"children":1823},{"style":515},[1824],{"type":406,"value":701},{"type":400,"tag":502,"props":1826,"children":1827},{"style":532},[1828],{"type":406,"value":535},{"type":400,"tag":502,"props":1830,"children":1831},{"style":515},[1832],{"type":406,"value":615},{"type":400,"tag":502,"props":1834,"children":1835},{"style":559},[1836],{"type":406,"value":1173},{"type":400,"tag":502,"props":1838,"children":1839},{"style":515},[1840],{"type":406,"value":701},{"type":400,"tag":502,"props":1842,"children":1843},{"style":559},[1844],{"type":406,"value":1182},{"type":400,"tag":502,"props":1846,"children":1847},{"style":515},[1848],{"type":406,"value":577},{"type":400,"tag":502,"props":1850,"children":1851},{"class":504,"line":851},[1852,1857,1861,1865,1869,1873,1877,1881],{"type":400,"tag":502,"props":1853,"children":1854},{"style":532},[1855],{"type":406,"value":1856},"          const",{"type":400,"tag":502,"props":1858,"children":1859},{"style":515},[1860],{"type":406,"value":1199},{"type":400,"tag":502,"props":1862,"children":1863},{"style":589},[1864],{"type":406,"value":1204},{"type":400,"tag":502,"props":1866,"children":1867},{"style":515},[1868],{"type":406,"value":701},{"type":400,"tag":502,"props":1870,"children":1871},{"style":589},[1872],{"type":406,"value":1213},{"type":400,"tag":502,"props":1874,"children":1875},{"style":515},[1876],{"type":406,"value":653},{"type":400,"tag":502,"props":1878,"children":1879},{"style":526},[1880],{"type":406,"value":529},{"type":400,"tag":502,"props":1882,"children":1883},{"style":509},[1884],{"type":406,"value":1235},{"type":400,"tag":502,"props":1886,"children":1887},{"class":504,"line":860},[1888,1892,1897,1901,1905,1909,1913,1917,1921,1925,1929,1933],{"type":400,"tag":502,"props":1889,"children":1890},{"style":532},[1891],{"type":406,"value":1856},{"type":400,"tag":502,"props":1893,"children":1894},{"style":589},[1895],{"type":406,"value":1896}," originalOpener",{"type":400,"tag":502,"props":1898,"children":1899},{"style":526},[1900],{"type":406,"value":529},{"type":400,"tag":502,"props":1902,"children":1903},{"style":509},[1904],{"type":406,"value":1213},{"type":400,"tag":502,"props":1906,"children":1907},{"style":515},[1908],{"type":406,"value":518},{"type":400,"tag":502,"props":1910,"children":1911},{"style":521},[1912],{"type":406,"value":988},{"type":400,"tag":502,"props":1914,"children":1915},{"style":612},[1916],{"type":406,"value":615},{"type":400,"tag":502,"props":1918,"children":1919},{"style":995},[1920],{"type":406,"value":998},{"type":400,"tag":502,"props":1922,"children":1923},{"style":515},[1924],{"type":406,"value":701},{"type":400,"tag":502,"props":1926,"children":1927},{"style":526},[1928],{"type":406,"value":1007},{"type":400,"tag":502,"props":1930,"children":1931},{"style":509},[1932],{"type":406,"value":1173},{"type":400,"tag":502,"props":1934,"children":1935},{"style":612},[1936],{"type":406,"value":658},{"type":400,"tag":502,"props":1938,"children":1939},{"class":504,"line":1313},[1940,1945,1949,1954,1958,1964,1968],{"type":400,"tag":502,"props":1941,"children":1942},{"style":724},[1943],{"type":406,"value":1944},"          if",{"type":400,"tag":502,"props":1946,"children":1947},{"style":612},[1948],{"type":406,"value":732},{"type":400,"tag":502,"props":1950,"children":1951},{"style":509},[1952],{"type":406,"value":1953},"originalOpener",{"type":400,"tag":502,"props":1955,"children":1956},{"style":526},[1957],{"type":406,"value":751},{"type":400,"tag":502,"props":1959,"children":1961},{"style":1960},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[1962],{"type":406,"value":1963}," null",{"type":400,"tag":502,"props":1965,"children":1966},{"style":612},[1967],{"type":406,"value":648},{"type":400,"tag":502,"props":1969,"children":1970},{"style":515},[1971],{"type":406,"value":774},{"type":400,"tag":502,"props":1973,"children":1974},{"class":504,"line":1322},[1975,1980,1984,1988,1992,1996],{"type":400,"tag":502,"props":1976,"children":1977},{"style":521},[1978],{"type":406,"value":1979},"            notify",{"type":400,"tag":502,"props":1981,"children":1982},{"style":612},[1983],{"type":406,"value":615},{"type":400,"tag":502,"props":1985,"children":1986},{"style":683},[1987],{"type":406,"value":686},{"type":400,"tag":502,"props":1989,"children":1990},{"style":689},[1991],{"type":406,"value":1600},{"type":400,"tag":502,"props":1993,"children":1994},{"style":683},[1995],{"type":406,"value":686},{"type":400,"tag":502,"props":1997,"children":1998},{"style":612},[1999],{"type":406,"value":658},{"type":400,"tag":502,"props":2001,"children":2002},{"class":504,"line":1331},[2003],{"type":400,"tag":502,"props":2004,"children":2005},{"style":515},[2006],{"type":406,"value":2007},"          }\n",{"type":400,"tag":502,"props":2009,"children":2010},{"class":504,"line":1345},[2011,2016],{"type":400,"tag":502,"props":2012,"children":2013},{"style":724},[2014],{"type":406,"value":2015},"          return",{"type":400,"tag":502,"props":2017,"children":2018},{"style":1960},[2019],{"type":406,"value":2020}," null\n",{"type":400,"tag":502,"props":2022,"children":2023},{"class":504,"line":1376},[2024,2029],{"type":400,"tag":502,"props":2025,"children":2026},{"style":515},[2027],{"type":406,"value":2028},"        }",{"type":400,"tag":502,"props":2030,"children":2031},{"style":612},[2032],{"type":406,"value":658},{"type":400,"tag":502,"props":2034,"children":2035},{"class":504,"line":1423},[2036],{"type":400,"tag":502,"props":2037,"children":2038},{"style":515},[2039],{"type":406,"value":1456},{"type":400,"tag":502,"props":2041,"children":2042},{"class":504,"line":1436},[2043],{"type":400,"tag":502,"props":2044,"children":2045},{"style":515},[2046],{"type":406,"value":2047},"    }\n",{"type":400,"tag":502,"props":2049,"children":2050},{"class":504,"line":1450},[2051,2055,2060,2064,2069,2073,2078,2082,2086,2091,2095,2099,2103],{"type":400,"tag":502,"props":2052,"children":2053},{"style":724},[2054],{"type":406,"value":1124},{"type":400,"tag":502,"props":2056,"children":2057},{"style":509},[2058],{"type":406,"value":2059}," Object",{"type":400,"tag":502,"props":2061,"children":2062},{"style":515},[2063],{"type":406,"value":518},{"type":400,"tag":502,"props":2065,"children":2066},{"style":521},[2067],{"type":406,"value":2068},"getOwnPropertyDescriptor",{"type":400,"tag":502,"props":2070,"children":2071},{"style":612},[2072],{"type":406,"value":615},{"type":400,"tag":502,"props":2074,"children":2075},{"style":509},[2076],{"type":406,"value":2077},"temp",{"type":400,"tag":502,"props":2079,"children":2080},{"style":515},[2081],{"type":406,"value":701},{"type":400,"tag":502,"props":2083,"children":2084},{"style":683},[2085],{"type":406,"value":756},{"type":400,"tag":502,"props":2087,"children":2088},{"style":689},[2089],{"type":406,"value":2090},"opener",{"type":400,"tag":502,"props":2092,"children":2093},{"style":683},[2094],{"type":406,"value":686},{"type":400,"tag":502,"props":2096,"children":2097},{"style":612},[2098],{"type":406,"value":648},{"type":400,"tag":502,"props":2100,"children":2101},{"style":515},[2102],{"type":406,"value":518},{"type":400,"tag":502,"props":2104,"children":2105},{"style":509},[2106],{"type":406,"value":2107},"get\n",{"type":400,"tag":502,"props":2109,"children":2110},{"class":504,"line":1459},[2111],{"type":400,"tag":502,"props":2112,"children":2113},{"style":515},[2114],{"type":406,"value":2115},"  },\n",{"type":400,"tag":502,"props":2117,"children":2118},{"class":504,"line":1467},[2119],{"type":400,"tag":502,"props":2120,"children":2121},{"style":968},[2122],{"type":406,"value":2123},"  // 修改 Descriptor.Value 使得 window.opener 一直返回 null，\n",{"type":400,"tag":502,"props":2125,"children":2126},{"class":504,"line":1476},[2127],{"type":400,"tag":502,"props":2128,"children":2129},{"style":968},[2130],{"type":406,"value":2131},"  // 这是一种兼容，在部分浏览器中，\n",{"type":400,"tag":502,"props":2133,"children":2134},{"class":504,"line":1485},[2135],{"type":400,"tag":502,"props":2136,"children":2137},{"style":968},[2138],{"type":406,"value":2139},"  //  window.opener 是通过 value 而不是 getter 获取的值\n",{"type":400,"tag":502,"props":2141,"children":2142},{"class":504,"line":1494},[2143,2148,2152,2156,2160,2165,2169,2174],{"type":400,"tag":502,"props":2144,"children":2145},{"style":1721},[2146],{"type":406,"value":2147},"  valueGenerator",{"type":400,"tag":502,"props":2149,"children":2150},{"style":515},[2151],{"type":406,"value":556},{"type":400,"tag":502,"props":2153,"children":2154},{"style":532},[2155],{"type":406,"value":535},{"type":400,"tag":502,"props":2157,"children":2158},{"style":515},[2159],{"type":406,"value":545},{"type":400,"tag":502,"props":2161,"children":2162},{"style":559},[2163],{"type":406,"value":2164},"original",{"type":400,"tag":502,"props":2166,"children":2167},{"style":515},[2168],{"type":406,"value":701},{"type":400,"tag":502,"props":2170,"children":2171},{"style":559},[2172],{"type":406,"value":2173}," notify",{"type":400,"tag":502,"props":2175,"children":2176},{"style":515},[2177],{"type":406,"value":2178},"}){\n",{"type":400,"tag":502,"props":2180,"children":2181},{"class":504,"line":1548},[2182,2187,2191,2195,2199,2203,2207],{"type":400,"tag":502,"props":2183,"children":2184},{"style":724},[2185],{"type":406,"value":2186},"    if",{"type":400,"tag":502,"props":2188,"children":2189},{"style":612},[2190],{"type":406,"value":732},{"type":400,"tag":502,"props":2192,"children":2193},{"style":509},[2194],{"type":406,"value":2164},{"type":400,"tag":502,"props":2196,"children":2197},{"style":526},[2198],{"type":406,"value":751},{"type":400,"tag":502,"props":2200,"children":2201},{"style":1960},[2202],{"type":406,"value":1963},{"type":400,"tag":502,"props":2204,"children":2205},{"style":612},[2206],{"type":406,"value":648},{"type":400,"tag":502,"props":2208,"children":2209},{"style":515},[2210],{"type":406,"value":774},{"type":400,"tag":502,"props":2212,"children":2213},{"class":504,"line":1581},[2214,2219,2223,2227,2231,2235],{"type":400,"tag":502,"props":2215,"children":2216},{"style":521},[2217],{"type":406,"value":2218},"      notify",{"type":400,"tag":502,"props":2220,"children":2221},{"style":612},[2222],{"type":406,"value":615},{"type":400,"tag":502,"props":2224,"children":2225},{"style":683},[2226],{"type":406,"value":686},{"type":400,"tag":502,"props":2228,"children":2229},{"style":689},[2230],{"type":406,"value":1600},{"type":400,"tag":502,"props":2232,"children":2233},{"style":683},[2234],{"type":406,"value":686},{"type":400,"tag":502,"props":2236,"children":2237},{"style":612},[2238],{"type":406,"value":658},{"type":400,"tag":502,"props":2240,"children":2241},{"class":504,"line":1611},[2242],{"type":400,"tag":502,"props":2243,"children":2244},{"style":515},[2245],{"type":406,"value":2047},{"type":400,"tag":502,"props":2247,"children":2248},{"class":504,"line":1619},[2249,2253],{"type":400,"tag":502,"props":2250,"children":2251},{"style":724},[2252],{"type":406,"value":1124},{"type":400,"tag":502,"props":2254,"children":2255},{"style":1960},[2256],{"type":406,"value":2020},{"type":400,"tag":502,"props":2258,"children":2259},{"class":504,"line":1633},[2260],{"type":400,"tag":502,"props":2261,"children":2262},{"style":515},[2263],{"type":406,"value":857},{"type":400,"tag":502,"props":2265,"children":2266},{"class":504,"line":1651},[2267],{"type":400,"tag":502,"props":2268,"children":2269},{"style":515},[2270],{"type":406,"value":866},{"type":400,"tag":408,"props":2272,"children":2274},{"id":2273},"canvas",[2275],{"type":406,"value":2276},"Canvas",{"type":400,"tag":414,"props":2278,"children":2279},{},[2280],{"type":406,"value":2281},"伪造了 getContext、getDataURL 等 API，并替代了原本正常的 API。",{"type":400,"tag":408,"props":2283,"children":2285},{"id":2284},"相关链接",[2286],{"type":406,"value":2284},{"type":400,"tag":420,"props":2288,"children":2289},{},[2290],{"type":400,"tag":424,"props":2291,"children":2292},{},[2293],{"type":400,"tag":896,"props":2294,"children":2297},{"href":2295,"rel":2296},"https://github.com/kkapsner/CanvasBlocker",[900],[2298],{"type":406,"value":2299},"CanvasBlocker",{"type":400,"tag":2301,"props":2302,"children":2303},"style",{},[2304],{"type":406,"value":2305},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":394,"searchDepth":580,"depth":580,"links":2307},[2308,2309,2310,2313,2314,2315],{"id":410,"depth":580,"text":410},{"id":476,"depth":580,"text":479},{"id":869,"depth":580,"text":448,"children":2311},[2312],{"id":880,"depth":661,"text":883},{"id":1667,"depth":580,"text":1670},{"id":2273,"depth":580,"text":2276},{"id":2284,"depth":580,"text":2284},"markdown","content:8.source-code:_fingerprint:canvas-blocker.md","content","8.source-code/_fingerprint/canvas-blocker.md","md",[2322,2325],{"_path":2323,"title":2324,"description":394},"/source-code/_es/object-assign","Object.prototype.assign",{"_path":2326,"title":2327,"description":394},"/source-code/_js/element-plus","ElementPlus",1718204556245]