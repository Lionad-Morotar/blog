[{"data":1,"prerenderedAt":2324},["ShallowReactive",2],{"navigation":3,"/source-code/_fingerprint/canvas-blocker":384,"/source-code/_fingerprint/canvas-blocker-surround":2317},[4,35,86,105,132,138,144,150,378],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29,32],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🚝 四十二篇系列","/flows/fourty-two",{"title":15,"_path":16},"🌃 长夜梦","/flows/long-night-dream",{"title":18,"_path":19},"🌌 万物联结与幸福感","/flows/everything",{"title":21,"_path":22},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":24,"_path":25},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":27,"_path":28},"🌧️ 我的腼腆","/flows/shy",{"title":30,"_path":31},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":33,"_path":34},"📝 心流归档","/flows/archive",{"title":36,"_path":37,"children":38},"技术博客 / Coder","/articles",[39,41,44,47,50,53,56,59,62,65,68,71,74,77,80,83],{"title":40,"_path":37},"🦁 欢迎",{"title":42,"_path":43},"🥞 在 tailwind 中使用现代化 CSS Layers","/articles/tailwind-sass-and-css-layer",{"title":45,"_path":46},"💻 本地部署 Qwen 翻译网页","/articles/local-translator",{"title":48,"_path":49},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":51,"_path":52},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":54,"_path":55},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":57,"_path":58},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":60,"_path":61},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":63,"_path":64},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":66,"_path":67},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":69,"_path":70},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":72,"_path":73},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":75,"_path":76},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":78,"_path":79},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":81,"_path":82},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":84,"_path":85},"📝 技术博客归档","/articles/archive",{"title":87,"_path":88,"children":89},"造物 / Make","/tools",[90,93,96,99,102],{"title":91,"_path":92},"🥥 Coconut","/tools/coconut",{"title":94,"_path":95},"🧶 网易云音乐歌单排序","/tools/netease-sorter",{"title":97,"_path":98},"🌐 AnySort","/tools/anysort",{"title":100,"_path":101},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":103,"_path":104},"👓 Crapto","/tools/crypto-inline",{"title":106,"_path":107,"children":108},"吉他剧场 / Music","/music",[109,111,114,117,120,123,126,129],{"title":110,"_path":107},"🎸 FingerStyle！",{"title":112,"_path":113},"🌬️ 等待的风","/music/wind",{"title":115,"_path":116},"💕 约定的海洋","/music/ocean",{"title":118,"_path":119},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":121,"_path":122},"🌏 残酷天使的行动纲领","/music/eva",{"title":124,"_path":125},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":127,"_path":128},"🍷 Wu Wei","/music/wu-wei",{"title":130,"_path":131},"🌅 无题","/music/untitled",{"title":133,"_path":134,"children":135},"画点什么 / Paint","/paint",[136],{"title":137,"_path":134},"🚧 正在施工",{"title":139,"_path":140,"children":141},"读书笔记 / Notes","/books",[142],{"title":143,"_path":140},"📕 读书笔记",{"title":145,"_path":146,"children":147},"知识地图 / Maps","/maps",[148],{"title":149,"_path":146},"🏁 知识地图",{"title":151,"_path":152,"children":153},"零散的笔记 / Gists","/gists",[154,156,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255,258,261,264,267,270,273,276,279,282,285,288,291,294,297,300,303,306,309,312,315,318,321,324,327,330,333,336,339,342,345,348,351,354,357,360,363,366,369,372,375],{"title":155,"_path":152},"🧊 Gists",{"title":157,"_path":158},"网站的可访问性","/gists/accessibility",{"title":160,"_path":161},"Bit","/gists/bit",{"title":163,"_path":164},"图片模糊","/gists/blur",{"title":166,"_path":167},"渲染相关笔记","/gists/c4d",{"title":169,"_path":170},"CDN 问题记录","/gists/cdn",{"title":172,"_path":173},"消毒剂","/gists/cleaner",{"title":175,"_path":176},"Windows Command","/gists/cmd",{"title":178,"_path":179},"Command","/gists/command",{"title":181,"_path":182},"复杂科学","/gists/complexity-science",{"title":184,"_path":185},"GitHub Copilot","/gists/copilot",{"title":187,"_path":188},"宇宙","/gists/cosmos",{"title":190,"_path":191},"C++","/gists/cpp",{"title":193,"_path":194},"DEPRESSION","/gists/depression",{"title":196,"_path":197},"Developer Experience","/gists/developer-experience",{"title":199,"_path":200},"Device Metrics","/gists/device-metrix",{"title":202,"_path":203},"ECMAScript Language Specification","/gists/ecmascript-specification",{"title":205,"_path":206},"正则表达式","/gists/eegex",{"title":208,"_path":209},"Emoji","/gists/emoji",{"title":211,"_path":212},"工程","/gists/engineering",{"title":214,"_path":215},"熵","/gists/entropy",{"title":217,"_path":218},"Environment","/gists/environment",{"title":220,"_path":221},"Erlang","/gists/erlang",{"title":223,"_path":224},"逃离塔克夫","/gists/escape-from-tarkov",{"title":226,"_path":227},"ESNext (ES6-ES11)","/gists/esnext",{"title":229,"_path":230},"Eval！","/gists/eval",{"title":232,"_path":233},"Flutter","/gists/flutter",{"title":235,"_path":236},"字体","/gists/font",{"title":238,"_path":239},"JS 函数式编程","/gists/functional",{"title":241,"_path":242},"游戏化","/gists/gamification",{"title":244,"_path":245},"Google C++ Standard","/gists/google-cpp-standard",{"title":247,"_path":248},"双向链接完全体","/gists/graph",{"title":250,"_path":251},"Hardwares","/gists/hardwares",{"title":253,"_path":254},"哈希冲突","/gists/hash-collision",{"title":256,"_path":257},"信息设计","/gists/information-design",{"title":259,"_path":260},"InstantPage","/gists/instant.page",{"title":262,"_path":263},"ISUX 遇见大数据可视化系列","/gists/isux-data-visualization",{"title":265,"_path":266},"KVStore","/gists/key-value-db",{"title":268,"_path":269},"Kubernetes","/gists/kubernetes",{"title":271,"_path":272},"Makefile","/gists/makefile",{"title":274,"_path":275},"Markdown Inline Style","/gists/markdown-nice",{"title":277,"_path":278},"减小页面快照体积","/gists/minify-html",{"title":280,"_path":281},"mklink","/gists/mklink",{"title":283,"_path":284},"Mock","/gists/mock",{"title":286,"_path":287},"多人协作系统","/gists/multiplayer",{"title":289,"_path":290},"多端应用","/gists/multy-end-app",{"title":292,"_path":293},"神经科学","/gists/neuroscience",{"title":295,"_path":296},"Opinioned Personal Folder","/gists/opinioned-personal-folder",{"title":298,"_path":299},"PInvoke","/gists/pinvoke",{"title":301,"_path":302},"像素","/gists/pixel",{"title":304,"_path":305},"PowerShell","/gists/powershell",{"title":307,"_path":308},"量子","/gists/quantum",{"title":310,"_path":311},"保持好奇心","/gists/questions",{"title":313,"_path":314},"React Native","/gists/react-native",{"title":316,"_path":317},"博客改版碰到的浏览器平滑滚动问题","/gists/scroll",{"title":319,"_path":320},"SEO","/gists/seo",{"title":322,"_path":323},"Shader","/gists/shader",{"title":325,"_path":326},"Shape Up","/gists/shape-up",{"title":328,"_path":329},"睡觉","/gists/sleep",{"title":331,"_path":332},"记录奇怪的问题","/gists/solved",{"title":334,"_path":335},"States","/gists/states",{"title":337,"_path":338},"Storage","/gists/storage",{"title":340,"_path":341},"音视频流处理","/gists/stream-cli",{"title":343,"_path":344},"Symbol","/gists/symbol",{"title":346,"_path":347},"系统论","/gists/systems-theory",{"title":349,"_path":350},"任务切片","/gists/task-slice",{"title":352,"_path":353},"技术偏好","/gists/tech-dudge",{"title":355,"_path":356},"Untitled","/gists/untitled",{"title":358,"_path":359},"可变字体","/gists/variable-font",{"title":361,"_path":362},"视觉错觉","/gists/visual-illusion",{"title":364,"_path":365},"SS(SSR)","/gists/vpn",{"title":367,"_path":368},"VS Code 插件开发","/gists/vscode-plugin",{"title":370,"_path":371},"Web Components","/gists/web-components",{"title":373,"_path":374},"Windows","/gists/windows",{"title":376,"_path":377},"查缺补漏","/gists/wrong",{"title":379,"_path":380,"children":381},"我 / About","/hire",[382],{"title":383,"_path":380},"📬 技术简历",{"_path":385,"_dir":386,"_draft":387,"_partial":388,"_locale":389,"title":390,"description":389,"body":391,"_type":2311,"_id":2312,"_source":2313,"_file":2314,"_stem":2315,"_extension":2316},"/source-code/_fingerprint/canvas-blocker","_fingerprint",false,true,"","Canvas Blocker",{"type":392,"children":393,"toc":2301},"root",[394,402,408,414,464,469,475,480,485,862,867,872,879,884,909,914,1072,1077,1660,1666,1671,1684,1689,2266,2272,2277,2282,2295],{"type":395,"tag":396,"props":397,"children":399},"element","h1",{"id":398},"canvas-blocker",[400],{"type":401,"value":390},"text",{"type":395,"tag":403,"props":404,"children":406},"h2",{"id":405},"前言",[407],{"type":401,"value":405},{"type":395,"tag":409,"props":410,"children":411},"p",{},[412],{"type":401,"value":413},"最近在看一些反反爬相关的东西，期间找到了 Canvas Blocker 这个神奇的库。他是一个浏览器扩展，声称能拦截以下几种类型的指纹追踪：",{"type":395,"tag":415,"props":416,"children":417},"ul",{},[418,424,429,434,439,444,449,454,459],{"type":395,"tag":419,"props":420,"children":421},"li",{},[422],{"type":401,"value":423},"Canvas 2D",{"type":395,"tag":419,"props":425,"children":426},{},[427],{"type":401,"value":428},"WebGL",{"type":395,"tag":419,"props":430,"children":431},{},[432],{"type":401,"value":433},"Web Audio",{"type":395,"tag":419,"props":435,"children":436},{},[437],{"type":401,"value":438},"History",{"type":395,"tag":419,"props":440,"children":441},{},[442],{"type":401,"value":443},"Window",{"type":395,"tag":419,"props":445,"children":446},{},[447],{"type":401,"value":448},"DOMRect",{"type":395,"tag":419,"props":450,"children":451},{},[452],{"type":401,"value":453},"TextMetrics",{"type":395,"tag":419,"props":455,"children":456},{},[457],{"type":401,"value":458},"Navigator",{"type":395,"tag":419,"props":460,"children":461},{},[462],{"type":401,"value":463},"Screen",{"type":395,"tag":409,"props":465,"children":466},{},[467],{"type":401,"value":468},"让我们大致拆解一下，看看其原理是什么。",{"type":395,"tag":403,"props":470,"children":472},{"id":471},"intercept",[473],{"type":401,"value":474},"Intercept",{"type":395,"tag":409,"props":476,"children":477},{},[478],{"type":401,"value":479},"Blocker 最主要的思路就是用伪造的函数篡改属性的 Getter 以及某些 API。",{"type":395,"tag":409,"props":481,"children":482},{},[483],{"type":401,"value":484},"篡改的入口在 intercept.js 中，先根据页面 URL 检查当前页面是否允许篡改，允许的话就通过 interceptFns、interceptGetters 实施具体步骤。",{"type":395,"tag":486,"props":487,"children":491},"pre",{"className":488,"code":489,"language":490,"meta":389,"style":389},"language-js shiki shiki-themes material-theme-lighter github-light github-dark monokai","scope.intercept = function intercept({subject: windowToProcess}, apis){\n  const siteStatus = apis.check({url: getURL(windowToProcess)})\n  logging.verbose(\"status for page\", windowToProcess, siteStatus)\n  if (siteStatus.mode !== \"allow\"){\n    interceptFunctions(windowToProcess, siteStatus, apis)\n    interceptGetters(windowToProcess, siteStatus, apis)\n  }\n}\n","js",[492],{"type":395,"tag":493,"props":494,"children":495},"code",{"__ignoreMap":389},[496,573,654,713,770,807,844,853],{"type":395,"tag":497,"props":498,"children":501},"span",{"class":499,"line":500},"line",1,[502,508,514,519,525,531,536,541,547,552,558,563,568],{"type":395,"tag":497,"props":503,"children":505},{"style":504},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[506],{"type":401,"value":507},"scope",{"type":395,"tag":497,"props":509,"children":511},{"style":510},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[512],{"type":401,"value":513},".",{"type":395,"tag":497,"props":515,"children":517},{"style":516},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[518],{"type":401,"value":471},{"type":395,"tag":497,"props":520,"children":522},{"style":521},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[523],{"type":401,"value":524}," =",{"type":395,"tag":497,"props":526,"children":528},{"style":527},"--shiki-light:#9C3EDA;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic",[529],{"type":401,"value":530}," function",{"type":395,"tag":497,"props":532,"children":533},{"style":516},[534],{"type":401,"value":535}," intercept",{"type":395,"tag":497,"props":537,"children":538},{"style":510},[539],{"type":401,"value":540},"({",{"type":395,"tag":497,"props":542,"children":544},{"style":543},"--shiki-light:#E53935;--shiki-default:#E36209;--shiki-dark:#FFAB70;--shiki-sepia:#F8F8F2",[545],{"type":401,"value":546},"subject",{"type":395,"tag":497,"props":548,"children":549},{"style":510},[550],{"type":401,"value":551},":",{"type":395,"tag":497,"props":553,"children":555},{"style":554},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#E36209;--shiki-default-font-style:inherit;--shiki-dark:#FFAB70;--shiki-dark-font-style:inherit;--shiki-sepia:#FD971F;--shiki-sepia-font-style:italic",[556],{"type":401,"value":557}," windowToProcess",{"type":395,"tag":497,"props":559,"children":560},{"style":510},[561],{"type":401,"value":562},"},",{"type":395,"tag":497,"props":564,"children":565},{"style":554},[566],{"type":401,"value":567}," apis",{"type":395,"tag":497,"props":569,"children":570},{"style":510},[571],{"type":401,"value":572},"){\n",{"type":395,"tag":497,"props":574,"children":576},{"class":499,"line":575},2,[577,582,588,592,596,600,605,611,616,621,625,630,634,639,644,649],{"type":395,"tag":497,"props":578,"children":579},{"style":527},[580],{"type":401,"value":581},"  const",{"type":395,"tag":497,"props":583,"children":585},{"style":584},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#F8F8F2",[586],{"type":401,"value":587}," siteStatus",{"type":395,"tag":497,"props":589,"children":590},{"style":521},[591],{"type":401,"value":524},{"type":395,"tag":497,"props":593,"children":594},{"style":504},[595],{"type":401,"value":567},{"type":395,"tag":497,"props":597,"children":598},{"style":510},[599],{"type":401,"value":513},{"type":395,"tag":497,"props":601,"children":602},{"style":516},[603],{"type":401,"value":604},"check",{"type":395,"tag":497,"props":606,"children":608},{"style":607},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[609],{"type":401,"value":610},"(",{"type":395,"tag":497,"props":612,"children":613},{"style":510},[614],{"type":401,"value":615},"{",{"type":395,"tag":497,"props":617,"children":618},{"style":607},[619],{"type":401,"value":620},"url",{"type":395,"tag":497,"props":622,"children":623},{"style":510},[624],{"type":401,"value":551},{"type":395,"tag":497,"props":626,"children":627},{"style":516},[628],{"type":401,"value":629}," getURL",{"type":395,"tag":497,"props":631,"children":632},{"style":607},[633],{"type":401,"value":610},{"type":395,"tag":497,"props":635,"children":636},{"style":504},[637],{"type":401,"value":638},"windowToProcess",{"type":395,"tag":497,"props":640,"children":641},{"style":607},[642],{"type":401,"value":643},")",{"type":395,"tag":497,"props":645,"children":646},{"style":510},[647],{"type":401,"value":648},"}",{"type":395,"tag":497,"props":650,"children":651},{"style":607},[652],{"type":401,"value":653},")\n",{"type":395,"tag":497,"props":655,"children":657},{"class":499,"line":656},3,[658,663,667,672,676,682,688,692,697,701,705,709],{"type":395,"tag":497,"props":659,"children":660},{"style":504},[661],{"type":401,"value":662},"  logging",{"type":395,"tag":497,"props":664,"children":665},{"style":510},[666],{"type":401,"value":513},{"type":395,"tag":497,"props":668,"children":669},{"style":516},[670],{"type":401,"value":671},"verbose",{"type":395,"tag":497,"props":673,"children":674},{"style":607},[675],{"type":401,"value":610},{"type":395,"tag":497,"props":677,"children":679},{"style":678},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[680],{"type":401,"value":681},"\"",{"type":395,"tag":497,"props":683,"children":685},{"style":684},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[686],{"type":401,"value":687},"status for page",{"type":395,"tag":497,"props":689,"children":690},{"style":678},[691],{"type":401,"value":681},{"type":395,"tag":497,"props":693,"children":694},{"style":510},[695],{"type":401,"value":696},",",{"type":395,"tag":497,"props":698,"children":699},{"style":504},[700],{"type":401,"value":557},{"type":395,"tag":497,"props":702,"children":703},{"style":510},[704],{"type":401,"value":696},{"type":395,"tag":497,"props":706,"children":707},{"style":504},[708],{"type":401,"value":587},{"type":395,"tag":497,"props":710,"children":711},{"style":607},[712],{"type":401,"value":653},{"type":395,"tag":497,"props":714,"children":716},{"class":499,"line":715},4,[717,723,728,733,737,742,747,752,757,761,765],{"type":395,"tag":497,"props":718,"children":720},{"style":719},"--shiki-light:#39ADB5;--shiki-light-font-style:italic;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#F92672;--shiki-sepia-font-style:inherit",[721],{"type":401,"value":722},"  if",{"type":395,"tag":497,"props":724,"children":725},{"style":607},[726],{"type":401,"value":727}," (",{"type":395,"tag":497,"props":729,"children":730},{"style":504},[731],{"type":401,"value":732},"siteStatus",{"type":395,"tag":497,"props":734,"children":735},{"style":510},[736],{"type":401,"value":513},{"type":395,"tag":497,"props":738,"children":739},{"style":504},[740],{"type":401,"value":741},"mode",{"type":395,"tag":497,"props":743,"children":744},{"style":521},[745],{"type":401,"value":746}," !==",{"type":395,"tag":497,"props":748,"children":749},{"style":678},[750],{"type":401,"value":751}," \"",{"type":395,"tag":497,"props":753,"children":754},{"style":684},[755],{"type":401,"value":756},"allow",{"type":395,"tag":497,"props":758,"children":759},{"style":678},[760],{"type":401,"value":681},{"type":395,"tag":497,"props":762,"children":763},{"style":607},[764],{"type":401,"value":643},{"type":395,"tag":497,"props":766,"children":767},{"style":510},[768],{"type":401,"value":769},"{\n",{"type":395,"tag":497,"props":771,"children":773},{"class":499,"line":772},5,[774,779,783,787,791,795,799,803],{"type":395,"tag":497,"props":775,"children":776},{"style":516},[777],{"type":401,"value":778},"    interceptFunctions",{"type":395,"tag":497,"props":780,"children":781},{"style":607},[782],{"type":401,"value":610},{"type":395,"tag":497,"props":784,"children":785},{"style":504},[786],{"type":401,"value":638},{"type":395,"tag":497,"props":788,"children":789},{"style":510},[790],{"type":401,"value":696},{"type":395,"tag":497,"props":792,"children":793},{"style":504},[794],{"type":401,"value":587},{"type":395,"tag":497,"props":796,"children":797},{"style":510},[798],{"type":401,"value":696},{"type":395,"tag":497,"props":800,"children":801},{"style":504},[802],{"type":401,"value":567},{"type":395,"tag":497,"props":804,"children":805},{"style":607},[806],{"type":401,"value":653},{"type":395,"tag":497,"props":808,"children":810},{"class":499,"line":809},6,[811,816,820,824,828,832,836,840],{"type":395,"tag":497,"props":812,"children":813},{"style":516},[814],{"type":401,"value":815},"    interceptGetters",{"type":395,"tag":497,"props":817,"children":818},{"style":607},[819],{"type":401,"value":610},{"type":395,"tag":497,"props":821,"children":822},{"style":504},[823],{"type":401,"value":638},{"type":395,"tag":497,"props":825,"children":826},{"style":510},[827],{"type":401,"value":696},{"type":395,"tag":497,"props":829,"children":830},{"style":504},[831],{"type":401,"value":587},{"type":395,"tag":497,"props":833,"children":834},{"style":510},[835],{"type":401,"value":696},{"type":395,"tag":497,"props":837,"children":838},{"style":504},[839],{"type":401,"value":567},{"type":395,"tag":497,"props":841,"children":842},{"style":607},[843],{"type":401,"value":653},{"type":395,"tag":497,"props":845,"children":847},{"class":499,"line":846},7,[848],{"type":395,"tag":497,"props":849,"children":850},{"style":510},[851],{"type":401,"value":852},"  }\n",{"type":395,"tag":497,"props":854,"children":856},{"class":499,"line":855},8,[857],{"type":395,"tag":497,"props":858,"children":859},{"style":510},[860],{"type":401,"value":861},"}\n",{"type":395,"tag":403,"props":863,"children":865},{"id":864},"window",[866],{"type":401,"value":443},{"type":395,"tag":409,"props":868,"children":869},{},[870],{"type":401,"value":871},"Blocker 篡改了 Window 的两个属性，window.name 和 window.opener。这两个属性和指纹没有直接关系，但却是一种“帮助函数”，能够帮助恶意网站追踪指纹以及窃取隐私。",{"type":395,"tag":873,"props":874,"children":876},"h3",{"id":875},"windowname",[877],{"type":401,"value":878},"window.name",{"type":395,"tag":409,"props":880,"children":881},{},[882],{"type":401,"value":883},"在过去的浏览器中，window.name 能够跨站点传输数据，并且能逃逸同源策略。从 Firefox 88 开始，用户通过点击超链接跳转到新页面时，window.name 将被置空，不过为了不造成更大的破坏，当用户从跳转后页面回到之前页面时，window.name 会被还原。",{"type":395,"tag":415,"props":885,"children":886},{},[887,899],{"type":395,"tag":419,"props":888,"children":889},{},[890],{"type":395,"tag":891,"props":892,"children":896},"a",{"href":893,"rel":894},"https://blog.mozilla.org/security/2021/04/19/firefox-88-combats-window-name-privacy-abuses/",[895],"nofollow",[897],{"type":401,"value":898},"Firefox 88 combats window.name privacy abuses",{"type":395,"tag":419,"props":900,"children":901},{},[902],{"type":395,"tag":891,"props":903,"children":906},{"href":904,"rel":905},"https://wpt.fyi/results/html/browsers/windows/clear-window-name.https.html?label=master&label=experimental&aligned",[895],[907],{"type":401,"value":908},"clear-window-name@web-platform-tests",{"type":395,"tag":409,"props":910,"children":911},{},[912],{"type":401,"value":913},"在使用 JS 设置 window.name 时，Blcoker 会记录下设置的值。original.call 调用原有的 window.name setter；windowNames 只做记录，稍后会用到。",{"type":395,"tag":486,"props":915,"children":917},{"className":488,"code":916,"language":490,"meta":389,"style":389},"{\n  set name(name){\n    // 调用原有 setting 设置 window.name\n    original.call(this, ...arguments)\n    // 把 name 记录下来\n    windowNames.set(this, name)\n  }\n}\n",[918],{"type":395,"tag":493,"props":919,"children":920},{"__ignoreMap":389},[921,928,958,967,1013,1021,1058,1065],{"type":395,"tag":497,"props":922,"children":923},{"class":499,"line":500},[924],{"type":395,"tag":497,"props":925,"children":926},{"style":510},[927],{"type":401,"value":769},{"type":395,"tag":497,"props":929,"children":930},{"class":499,"line":575},[931,936,941,945,950,954],{"type":395,"tag":497,"props":932,"children":933},{"style":504},[934],{"type":401,"value":935},"  set",{"type":395,"tag":497,"props":937,"children":938},{"style":516},[939],{"type":401,"value":940}," name",{"type":395,"tag":497,"props":942,"children":943},{"style":607},[944],{"type":401,"value":610},{"type":395,"tag":497,"props":946,"children":947},{"style":504},[948],{"type":401,"value":949},"name",{"type":395,"tag":497,"props":951,"children":952},{"style":607},[953],{"type":401,"value":643},{"type":395,"tag":497,"props":955,"children":956},{"style":510},[957],{"type":401,"value":769},{"type":395,"tag":497,"props":959,"children":960},{"class":499,"line":656},[961],{"type":395,"tag":497,"props":962,"children":964},{"style":963},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit",[965],{"type":401,"value":966},"    // 调用原有 setting 设置 window.name\n",{"type":395,"tag":497,"props":968,"children":969},{"class":499,"line":715},[970,975,979,984,988,994,998,1003,1009],{"type":395,"tag":497,"props":971,"children":972},{"style":504},[973],{"type":401,"value":974},"    original",{"type":395,"tag":497,"props":976,"children":977},{"style":510},[978],{"type":401,"value":513},{"type":395,"tag":497,"props":980,"children":981},{"style":516},[982],{"type":401,"value":983},"call",{"type":395,"tag":497,"props":985,"children":986},{"style":607},[987],{"type":401,"value":610},{"type":395,"tag":497,"props":989,"children":991},{"style":990},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[992],{"type":401,"value":993},"this",{"type":395,"tag":497,"props":995,"children":996},{"style":510},[997],{"type":401,"value":696},{"type":395,"tag":497,"props":999,"children":1000},{"style":521},[1001],{"type":401,"value":1002}," ...",{"type":395,"tag":497,"props":1004,"children":1006},{"style":1005},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[1007],{"type":401,"value":1008},"arguments",{"type":395,"tag":497,"props":1010,"children":1011},{"style":607},[1012],{"type":401,"value":653},{"type":395,"tag":497,"props":1014,"children":1015},{"class":499,"line":772},[1016],{"type":395,"tag":497,"props":1017,"children":1018},{"style":963},[1019],{"type":401,"value":1020},"    // 把 name 记录下来\n",{"type":395,"tag":497,"props":1022,"children":1023},{"class":499,"line":809},[1024,1029,1033,1038,1042,1046,1050,1054],{"type":395,"tag":497,"props":1025,"children":1026},{"style":504},[1027],{"type":401,"value":1028},"    windowNames",{"type":395,"tag":497,"props":1030,"children":1031},{"style":510},[1032],{"type":401,"value":513},{"type":395,"tag":497,"props":1034,"children":1035},{"style":516},[1036],{"type":401,"value":1037},"set",{"type":395,"tag":497,"props":1039,"children":1040},{"style":607},[1041],{"type":401,"value":610},{"type":395,"tag":497,"props":1043,"children":1044},{"style":990},[1045],{"type":401,"value":993},{"type":395,"tag":497,"props":1047,"children":1048},{"style":510},[1049],{"type":401,"value":696},{"type":395,"tag":497,"props":1051,"children":1052},{"style":504},[1053],{"type":401,"value":940},{"type":395,"tag":497,"props":1055,"children":1056},{"style":607},[1057],{"type":401,"value":653},{"type":395,"tag":497,"props":1059,"children":1060},{"class":499,"line":846},[1061],{"type":395,"tag":497,"props":1062,"children":1063},{"style":510},[1064],{"type":401,"value":852},{"type":395,"tag":497,"props":1066,"children":1067},{"class":499,"line":855},[1068],{"type":395,"tag":497,"props":1069,"children":1070},{"style":510},[1071],{"type":401,"value":861},{"type":395,"tag":409,"props":1073,"children":1074},{},[1075],{"type":401,"value":1076},"因为只有通过显式的 window.name = 'xxx' 才会触发 windowNames 中记录的值的改变，所以一旦在 b.com 读取到的 window.name 不是 windowNames 记录的值，就说明浏览器泄露了 window.name，此时需要返回伪造的值。",{"type":395,"tag":486,"props":1078,"children":1080},{"className":488,"code":1079,"language":490,"meta":389,"style":389},"{\n  get name(){\n    return checkerWrapper(checker, this, arguments, function(args, check){\n      const {notify, original, prefs} = check\n\n      // 读取 b.com 的 window.name 可能会返回 a.com 的 window.name\n      const originalName = original.call(this, ...args)\n\n      // 根据配置，iframes 中返回的 window.name 可以赦免此伪造规则，\n      // this !== this.top 是一种快速检测当前 window 是否在 iframe 中的方法\n      if (\n        this !== this.top &&\n        prefs(\"allowWindowNameInFrames\", this.location)\n      ){\n        return originalName\n      }\n\n      // 只有通过显式的 window.name = 'xxx' 才会触发 windowNames 中记录的值的改变，\n      // 所以一旦 windowNames 记录的值和 originalName 不一样，\n      // 就说明当前浏览器犯了 window.name 泄露的错误\n      const returnedName = windowNames.get(this) || \"\"\n      if (originalName !== returnedName){\n        notify(\"fakedWindowReadout\")\n      }\n      return returnedName\n    });\n  }\n}\n",[1081],{"type":395,"tag":493,"props":1082,"children":1083},{"__ignoreMap":389},[1084,1091,1112,1182,1231,1239,1247,1299,1306,1315,1324,1338,1369,1416,1429,1443,1452,1460,1469,1478,1487,1541,1574,1604,1612,1626,1644,1652],{"type":395,"tag":497,"props":1085,"children":1086},{"class":499,"line":500},[1087],{"type":395,"tag":497,"props":1088,"children":1089},{"style":510},[1090],{"type":401,"value":769},{"type":395,"tag":497,"props":1092,"children":1093},{"class":499,"line":575},[1094,1099,1103,1108],{"type":395,"tag":497,"props":1095,"children":1096},{"style":504},[1097],{"type":401,"value":1098},"  get",{"type":395,"tag":497,"props":1100,"children":1101},{"style":516},[1102],{"type":401,"value":940},{"type":395,"tag":497,"props":1104,"children":1105},{"style":607},[1106],{"type":401,"value":1107},"()",{"type":395,"tag":497,"props":1109,"children":1110},{"style":510},[1111],{"type":401,"value":769},{"type":395,"tag":497,"props":1113,"children":1114},{"class":499,"line":656},[1115,1120,1125,1129,1134,1138,1143,1147,1152,1156,1160,1164,1169,1173,1178],{"type":395,"tag":497,"props":1116,"children":1117},{"style":719},[1118],{"type":401,"value":1119},"    return",{"type":395,"tag":497,"props":1121,"children":1122},{"style":516},[1123],{"type":401,"value":1124}," checkerWrapper",{"type":395,"tag":497,"props":1126,"children":1127},{"style":607},[1128],{"type":401,"value":610},{"type":395,"tag":497,"props":1130,"children":1131},{"style":504},[1132],{"type":401,"value":1133},"checker",{"type":395,"tag":497,"props":1135,"children":1136},{"style":510},[1137],{"type":401,"value":696},{"type":395,"tag":497,"props":1139,"children":1140},{"style":990},[1141],{"type":401,"value":1142}," this",{"type":395,"tag":497,"props":1144,"children":1145},{"style":510},[1146],{"type":401,"value":696},{"type":395,"tag":497,"props":1148,"children":1149},{"style":1005},[1150],{"type":401,"value":1151}," arguments",{"type":395,"tag":497,"props":1153,"children":1154},{"style":510},[1155],{"type":401,"value":696},{"type":395,"tag":497,"props":1157,"children":1158},{"style":527},[1159],{"type":401,"value":530},{"type":395,"tag":497,"props":1161,"children":1162},{"style":510},[1163],{"type":401,"value":610},{"type":395,"tag":497,"props":1165,"children":1166},{"style":554},[1167],{"type":401,"value":1168},"args",{"type":395,"tag":497,"props":1170,"children":1171},{"style":510},[1172],{"type":401,"value":696},{"type":395,"tag":497,"props":1174,"children":1175},{"style":554},[1176],{"type":401,"value":1177}," check",{"type":395,"tag":497,"props":1179,"children":1180},{"style":510},[1181],{"type":401,"value":572},{"type":395,"tag":497,"props":1183,"children":1184},{"class":499,"line":715},[1185,1190,1195,1200,1204,1209,1213,1218,1222,1226],{"type":395,"tag":497,"props":1186,"children":1187},{"style":527},[1188],{"type":401,"value":1189},"      const",{"type":395,"tag":497,"props":1191,"children":1192},{"style":510},[1193],{"type":401,"value":1194}," {",{"type":395,"tag":497,"props":1196,"children":1197},{"style":584},[1198],{"type":401,"value":1199},"notify",{"type":395,"tag":497,"props":1201,"children":1202},{"style":510},[1203],{"type":401,"value":696},{"type":395,"tag":497,"props":1205,"children":1206},{"style":584},[1207],{"type":401,"value":1208}," original",{"type":395,"tag":497,"props":1210,"children":1211},{"style":510},[1212],{"type":401,"value":696},{"type":395,"tag":497,"props":1214,"children":1215},{"style":584},[1216],{"type":401,"value":1217}," prefs",{"type":395,"tag":497,"props":1219,"children":1220},{"style":510},[1221],{"type":401,"value":648},{"type":395,"tag":497,"props":1223,"children":1224},{"style":521},[1225],{"type":401,"value":524},{"type":395,"tag":497,"props":1227,"children":1228},{"style":504},[1229],{"type":401,"value":1230}," check\n",{"type":395,"tag":497,"props":1232,"children":1233},{"class":499,"line":772},[1234],{"type":395,"tag":497,"props":1235,"children":1236},{"emptyLinePlaceholder":388},[1237],{"type":401,"value":1238},"\n",{"type":395,"tag":497,"props":1240,"children":1241},{"class":499,"line":809},[1242],{"type":395,"tag":497,"props":1243,"children":1244},{"style":963},[1245],{"type":401,"value":1246},"      // 读取 b.com 的 window.name 可能会返回 a.com 的 window.name\n",{"type":395,"tag":497,"props":1248,"children":1249},{"class":499,"line":846},[1250,1254,1259,1263,1267,1271,1275,1279,1283,1287,1291,1295],{"type":395,"tag":497,"props":1251,"children":1252},{"style":527},[1253],{"type":401,"value":1189},{"type":395,"tag":497,"props":1255,"children":1256},{"style":584},[1257],{"type":401,"value":1258}," originalName",{"type":395,"tag":497,"props":1260,"children":1261},{"style":521},[1262],{"type":401,"value":524},{"type":395,"tag":497,"props":1264,"children":1265},{"style":504},[1266],{"type":401,"value":1208},{"type":395,"tag":497,"props":1268,"children":1269},{"style":510},[1270],{"type":401,"value":513},{"type":395,"tag":497,"props":1272,"children":1273},{"style":516},[1274],{"type":401,"value":983},{"type":395,"tag":497,"props":1276,"children":1277},{"style":607},[1278],{"type":401,"value":610},{"type":395,"tag":497,"props":1280,"children":1281},{"style":990},[1282],{"type":401,"value":993},{"type":395,"tag":497,"props":1284,"children":1285},{"style":510},[1286],{"type":401,"value":696},{"type":395,"tag":497,"props":1288,"children":1289},{"style":521},[1290],{"type":401,"value":1002},{"type":395,"tag":497,"props":1292,"children":1293},{"style":504},[1294],{"type":401,"value":1168},{"type":395,"tag":497,"props":1296,"children":1297},{"style":607},[1298],{"type":401,"value":653},{"type":395,"tag":497,"props":1300,"children":1301},{"class":499,"line":855},[1302],{"type":395,"tag":497,"props":1303,"children":1304},{"emptyLinePlaceholder":388},[1305],{"type":401,"value":1238},{"type":395,"tag":497,"props":1307,"children":1309},{"class":499,"line":1308},9,[1310],{"type":395,"tag":497,"props":1311,"children":1312},{"style":963},[1313],{"type":401,"value":1314},"      // 根据配置，iframes 中返回的 window.name 可以赦免此伪造规则，\n",{"type":395,"tag":497,"props":1316,"children":1318},{"class":499,"line":1317},10,[1319],{"type":395,"tag":497,"props":1320,"children":1321},{"style":963},[1322],{"type":401,"value":1323},"      // this !== this.top 是一种快速检测当前 window 是否在 iframe 中的方法\n",{"type":395,"tag":497,"props":1325,"children":1327},{"class":499,"line":1326},11,[1328,1333],{"type":395,"tag":497,"props":1329,"children":1330},{"style":719},[1331],{"type":401,"value":1332},"      if",{"type":395,"tag":497,"props":1334,"children":1335},{"style":607},[1336],{"type":401,"value":1337}," (\n",{"type":395,"tag":497,"props":1339,"children":1341},{"class":499,"line":1340},12,[1342,1347,1351,1355,1359,1364],{"type":395,"tag":497,"props":1343,"children":1344},{"style":990},[1345],{"type":401,"value":1346},"        this",{"type":395,"tag":497,"props":1348,"children":1349},{"style":521},[1350],{"type":401,"value":746},{"type":395,"tag":497,"props":1352,"children":1353},{"style":990},[1354],{"type":401,"value":1142},{"type":395,"tag":497,"props":1356,"children":1357},{"style":510},[1358],{"type":401,"value":513},{"type":395,"tag":497,"props":1360,"children":1361},{"style":504},[1362],{"type":401,"value":1363},"top",{"type":395,"tag":497,"props":1365,"children":1366},{"style":521},[1367],{"type":401,"value":1368}," &&\n",{"type":395,"tag":497,"props":1370,"children":1372},{"class":499,"line":1371},13,[1373,1378,1382,1386,1391,1395,1399,1403,1407,1412],{"type":395,"tag":497,"props":1374,"children":1375},{"style":516},[1376],{"type":401,"value":1377},"        prefs",{"type":395,"tag":497,"props":1379,"children":1380},{"style":607},[1381],{"type":401,"value":610},{"type":395,"tag":497,"props":1383,"children":1384},{"style":678},[1385],{"type":401,"value":681},{"type":395,"tag":497,"props":1387,"children":1388},{"style":684},[1389],{"type":401,"value":1390},"allowWindowNameInFrames",{"type":395,"tag":497,"props":1392,"children":1393},{"style":678},[1394],{"type":401,"value":681},{"type":395,"tag":497,"props":1396,"children":1397},{"style":510},[1398],{"type":401,"value":696},{"type":395,"tag":497,"props":1400,"children":1401},{"style":990},[1402],{"type":401,"value":1142},{"type":395,"tag":497,"props":1404,"children":1405},{"style":510},[1406],{"type":401,"value":513},{"type":395,"tag":497,"props":1408,"children":1409},{"style":504},[1410],{"type":401,"value":1411},"location",{"type":395,"tag":497,"props":1413,"children":1414},{"style":607},[1415],{"type":401,"value":653},{"type":395,"tag":497,"props":1417,"children":1419},{"class":499,"line":1418},14,[1420,1425],{"type":395,"tag":497,"props":1421,"children":1422},{"style":607},[1423],{"type":401,"value":1424},"      )",{"type":395,"tag":497,"props":1426,"children":1427},{"style":510},[1428],{"type":401,"value":769},{"type":395,"tag":497,"props":1430,"children":1432},{"class":499,"line":1431},15,[1433,1438],{"type":395,"tag":497,"props":1434,"children":1435},{"style":719},[1436],{"type":401,"value":1437},"        return",{"type":395,"tag":497,"props":1439,"children":1440},{"style":504},[1441],{"type":401,"value":1442}," originalName\n",{"type":395,"tag":497,"props":1444,"children":1446},{"class":499,"line":1445},16,[1447],{"type":395,"tag":497,"props":1448,"children":1449},{"style":510},[1450],{"type":401,"value":1451},"      }\n",{"type":395,"tag":497,"props":1453,"children":1455},{"class":499,"line":1454},17,[1456],{"type":395,"tag":497,"props":1457,"children":1458},{"emptyLinePlaceholder":388},[1459],{"type":401,"value":1238},{"type":395,"tag":497,"props":1461,"children":1463},{"class":499,"line":1462},18,[1464],{"type":395,"tag":497,"props":1465,"children":1466},{"style":963},[1467],{"type":401,"value":1468},"      // 只有通过显式的 window.name = 'xxx' 才会触发 windowNames 中记录的值的改变，\n",{"type":395,"tag":497,"props":1470,"children":1472},{"class":499,"line":1471},19,[1473],{"type":395,"tag":497,"props":1474,"children":1475},{"style":963},[1476],{"type":401,"value":1477},"      // 所以一旦 windowNames 记录的值和 originalName 不一样，\n",{"type":395,"tag":497,"props":1479,"children":1481},{"class":499,"line":1480},20,[1482],{"type":395,"tag":497,"props":1483,"children":1484},{"style":963},[1485],{"type":401,"value":1486},"      // 就说明当前浏览器犯了 window.name 泄露的错误\n",{"type":395,"tag":497,"props":1488,"children":1490},{"class":499,"line":1489},21,[1491,1495,1500,1504,1509,1513,1518,1522,1526,1531,1536],{"type":395,"tag":497,"props":1492,"children":1493},{"style":527},[1494],{"type":401,"value":1189},{"type":395,"tag":497,"props":1496,"children":1497},{"style":584},[1498],{"type":401,"value":1499}," returnedName",{"type":395,"tag":497,"props":1501,"children":1502},{"style":521},[1503],{"type":401,"value":524},{"type":395,"tag":497,"props":1505,"children":1506},{"style":504},[1507],{"type":401,"value":1508}," windowNames",{"type":395,"tag":497,"props":1510,"children":1511},{"style":510},[1512],{"type":401,"value":513},{"type":395,"tag":497,"props":1514,"children":1515},{"style":516},[1516],{"type":401,"value":1517},"get",{"type":395,"tag":497,"props":1519,"children":1520},{"style":607},[1521],{"type":401,"value":610},{"type":395,"tag":497,"props":1523,"children":1524},{"style":990},[1525],{"type":401,"value":993},{"type":395,"tag":497,"props":1527,"children":1528},{"style":607},[1529],{"type":401,"value":1530},") ",{"type":395,"tag":497,"props":1532,"children":1533},{"style":521},[1534],{"type":401,"value":1535},"||",{"type":395,"tag":497,"props":1537,"children":1538},{"style":678},[1539],{"type":401,"value":1540}," \"\"\n",{"type":395,"tag":497,"props":1542,"children":1544},{"class":499,"line":1543},22,[1545,1549,1553,1558,1562,1566,1570],{"type":395,"tag":497,"props":1546,"children":1547},{"style":719},[1548],{"type":401,"value":1332},{"type":395,"tag":497,"props":1550,"children":1551},{"style":607},[1552],{"type":401,"value":727},{"type":395,"tag":497,"props":1554,"children":1555},{"style":504},[1556],{"type":401,"value":1557},"originalName",{"type":395,"tag":497,"props":1559,"children":1560},{"style":521},[1561],{"type":401,"value":746},{"type":395,"tag":497,"props":1563,"children":1564},{"style":504},[1565],{"type":401,"value":1499},{"type":395,"tag":497,"props":1567,"children":1568},{"style":607},[1569],{"type":401,"value":643},{"type":395,"tag":497,"props":1571,"children":1572},{"style":510},[1573],{"type":401,"value":769},{"type":395,"tag":497,"props":1575,"children":1577},{"class":499,"line":1576},23,[1578,1583,1587,1591,1596,1600],{"type":395,"tag":497,"props":1579,"children":1580},{"style":516},[1581],{"type":401,"value":1582},"        notify",{"type":395,"tag":497,"props":1584,"children":1585},{"style":607},[1586],{"type":401,"value":610},{"type":395,"tag":497,"props":1588,"children":1589},{"style":678},[1590],{"type":401,"value":681},{"type":395,"tag":497,"props":1592,"children":1593},{"style":684},[1594],{"type":401,"value":1595},"fakedWindowReadout",{"type":395,"tag":497,"props":1597,"children":1598},{"style":678},[1599],{"type":401,"value":681},{"type":395,"tag":497,"props":1601,"children":1602},{"style":607},[1603],{"type":401,"value":653},{"type":395,"tag":497,"props":1605,"children":1607},{"class":499,"line":1606},24,[1608],{"type":395,"tag":497,"props":1609,"children":1610},{"style":510},[1611],{"type":401,"value":1451},{"type":395,"tag":497,"props":1613,"children":1615},{"class":499,"line":1614},25,[1616,1621],{"type":395,"tag":497,"props":1617,"children":1618},{"style":719},[1619],{"type":401,"value":1620},"      return",{"type":395,"tag":497,"props":1622,"children":1623},{"style":504},[1624],{"type":401,"value":1625}," returnedName\n",{"type":395,"tag":497,"props":1627,"children":1629},{"class":499,"line":1628},26,[1630,1635,1639],{"type":395,"tag":497,"props":1631,"children":1632},{"style":510},[1633],{"type":401,"value":1634},"    }",{"type":395,"tag":497,"props":1636,"children":1637},{"style":607},[1638],{"type":401,"value":643},{"type":395,"tag":497,"props":1640,"children":1641},{"style":510},[1642],{"type":401,"value":1643},";\n",{"type":395,"tag":497,"props":1645,"children":1647},{"class":499,"line":1646},27,[1648],{"type":395,"tag":497,"props":1649,"children":1650},{"style":510},[1651],{"type":401,"value":852},{"type":395,"tag":497,"props":1653,"children":1655},{"class":499,"line":1654},28,[1656],{"type":395,"tag":497,"props":1657,"children":1658},{"style":510},[1659],{"type":401,"value":861},{"type":395,"tag":403,"props":1661,"children":1663},{"id":1662},"windowopener",[1664],{"type":401,"value":1665},"window.opener",{"type":395,"tag":409,"props":1667,"children":1668},{},[1669],{"type":401,"value":1670},"在过去的浏览器中，当页面通过超链接或 window.open 的方式从 A 网站跳转到 B 网站时，如果制定了 target 属性却没有指定 rel=\"norefer\" 属性，那么在 B 网站是可以使用 window.opener 获取到 A 网站的部分信息的。也就是说，在 B 网站中可以修改 window.opener.location.href = 'x' 从而让 A 网站自动跳转到 X 网站。如果页面跳转时使用 target=\"__blank\" 打开了新页面，那么用户更加不可能注意到 A 网站的恶意跳转。",{"type":395,"tag":415,"props":1672,"children":1673},{},[1674],{"type":395,"tag":419,"props":1675,"children":1676},{},[1677],{"type":395,"tag":891,"props":1678,"children":1681},{"href":1679,"rel":1680},"https://cwe.mitre.org/data/definitions/1022.html",[895],[1682],{"type":401,"value":1683},"CWE-1022: Use of Web Link to Untrusted Target with window.opener Access",{"type":395,"tag":409,"props":1685,"children":1686},{},[1687],{"type":401,"value":1688},"Blocker 对 window.opener 的防范比较简单，直接返回 null 就完事儿了。考虑到现代浏览器已经修复了这个漏洞，该篡改的设置的值默认是关闭的。",{"type":395,"tag":486,"props":1690,"children":1692},{"className":488,"code":1691,"language":490,"meta":389,"style":389},"{\n  // 修改 Getter 使 window.opener 一直返回 null\n  getterGenerator: function(checker){\n    const temp = {\n      get opener(){\n        return checkerWrapper(checker, this, arguments, function(args, check){\n          const {notify, original} = check\n          const originalOpener = original.call(this, ...args)\n          if (originalOpener !== null){\n            notify(\"fakedWindowReadout\")\n          }\n          return null\n        })\n      }\n    }\n    return Object.getOwnPropertyDescriptor(temp, \"opener\").get\n  },\n  // 修改 Descriptor.Value 使得 window.opener 一直返回 null，\n  // 这是一种兼容，在部分浏览器中，\n  //  window.opener 是通过 value 而不是 getter 获取的值\n  valueGenerator: function({original, notify}){\n    if (original !== null){\n      notify(\"fakedWindowReadout\")\n    }\n    return null\n  }\n}\n",[1693],{"type":395,"tag":493,"props":1694,"children":1695},{"__ignoreMap":389},[1696,1703,1711,1740,1762,1781,1844,1880,1932,1967,1995,2003,2016,2028,2035,2043,2103,2111,2119,2127,2135,2174,2206,2234,2241,2252,2259],{"type":395,"tag":497,"props":1697,"children":1698},{"class":499,"line":500},[1699],{"type":395,"tag":497,"props":1700,"children":1701},{"style":510},[1702],{"type":401,"value":769},{"type":395,"tag":497,"props":1704,"children":1705},{"class":499,"line":575},[1706],{"type":395,"tag":497,"props":1707,"children":1708},{"style":963},[1709],{"type":401,"value":1710},"  // 修改 Getter 使 window.opener 一直返回 null\n",{"type":395,"tag":497,"props":1712,"children":1713},{"class":499,"line":656},[1714,1720,1724,1728,1732,1736],{"type":395,"tag":497,"props":1715,"children":1717},{"style":1716},"--shiki-light:#E2931D;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#F8F8F2",[1718],{"type":401,"value":1719},"  getterGenerator",{"type":395,"tag":497,"props":1721,"children":1722},{"style":510},[1723],{"type":401,"value":551},{"type":395,"tag":497,"props":1725,"children":1726},{"style":527},[1727],{"type":401,"value":530},{"type":395,"tag":497,"props":1729,"children":1730},{"style":510},[1731],{"type":401,"value":610},{"type":395,"tag":497,"props":1733,"children":1734},{"style":554},[1735],{"type":401,"value":1133},{"type":395,"tag":497,"props":1737,"children":1738},{"style":510},[1739],{"type":401,"value":572},{"type":395,"tag":497,"props":1741,"children":1742},{"class":499,"line":715},[1743,1748,1753,1757],{"type":395,"tag":497,"props":1744,"children":1745},{"style":527},[1746],{"type":401,"value":1747},"    const",{"type":395,"tag":497,"props":1749,"children":1750},{"style":584},[1751],{"type":401,"value":1752}," temp",{"type":395,"tag":497,"props":1754,"children":1755},{"style":521},[1756],{"type":401,"value":524},{"type":395,"tag":497,"props":1758,"children":1759},{"style":510},[1760],{"type":401,"value":1761}," {\n",{"type":395,"tag":497,"props":1763,"children":1764},{"class":499,"line":772},[1765,1770,1776],{"type":395,"tag":497,"props":1766,"children":1767},{"style":527},[1768],{"type":401,"value":1769},"      get",{"type":395,"tag":497,"props":1771,"children":1773},{"style":1772},"--shiki-light:#E53935;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[1774],{"type":401,"value":1775}," opener",{"type":395,"tag":497,"props":1777,"children":1778},{"style":510},[1779],{"type":401,"value":1780},"(){\n",{"type":395,"tag":497,"props":1782,"children":1783},{"class":499,"line":809},[1784,1788,1792,1796,1800,1804,1808,1812,1816,1820,1824,1828,1832,1836,1840],{"type":395,"tag":497,"props":1785,"children":1786},{"style":719},[1787],{"type":401,"value":1437},{"type":395,"tag":497,"props":1789,"children":1790},{"style":516},[1791],{"type":401,"value":1124},{"type":395,"tag":497,"props":1793,"children":1794},{"style":607},[1795],{"type":401,"value":610},{"type":395,"tag":497,"props":1797,"children":1798},{"style":504},[1799],{"type":401,"value":1133},{"type":395,"tag":497,"props":1801,"children":1802},{"style":510},[1803],{"type":401,"value":696},{"type":395,"tag":497,"props":1805,"children":1806},{"style":990},[1807],{"type":401,"value":1142},{"type":395,"tag":497,"props":1809,"children":1810},{"style":510},[1811],{"type":401,"value":696},{"type":395,"tag":497,"props":1813,"children":1814},{"style":1005},[1815],{"type":401,"value":1151},{"type":395,"tag":497,"props":1817,"children":1818},{"style":510},[1819],{"type":401,"value":696},{"type":395,"tag":497,"props":1821,"children":1822},{"style":527},[1823],{"type":401,"value":530},{"type":395,"tag":497,"props":1825,"children":1826},{"style":510},[1827],{"type":401,"value":610},{"type":395,"tag":497,"props":1829,"children":1830},{"style":554},[1831],{"type":401,"value":1168},{"type":395,"tag":497,"props":1833,"children":1834},{"style":510},[1835],{"type":401,"value":696},{"type":395,"tag":497,"props":1837,"children":1838},{"style":554},[1839],{"type":401,"value":1177},{"type":395,"tag":497,"props":1841,"children":1842},{"style":510},[1843],{"type":401,"value":572},{"type":395,"tag":497,"props":1845,"children":1846},{"class":499,"line":846},[1847,1852,1856,1860,1864,1868,1872,1876],{"type":395,"tag":497,"props":1848,"children":1849},{"style":527},[1850],{"type":401,"value":1851},"          const",{"type":395,"tag":497,"props":1853,"children":1854},{"style":510},[1855],{"type":401,"value":1194},{"type":395,"tag":497,"props":1857,"children":1858},{"style":584},[1859],{"type":401,"value":1199},{"type":395,"tag":497,"props":1861,"children":1862},{"style":510},[1863],{"type":401,"value":696},{"type":395,"tag":497,"props":1865,"children":1866},{"style":584},[1867],{"type":401,"value":1208},{"type":395,"tag":497,"props":1869,"children":1870},{"style":510},[1871],{"type":401,"value":648},{"type":395,"tag":497,"props":1873,"children":1874},{"style":521},[1875],{"type":401,"value":524},{"type":395,"tag":497,"props":1877,"children":1878},{"style":504},[1879],{"type":401,"value":1230},{"type":395,"tag":497,"props":1881,"children":1882},{"class":499,"line":855},[1883,1887,1892,1896,1900,1904,1908,1912,1916,1920,1924,1928],{"type":395,"tag":497,"props":1884,"children":1885},{"style":527},[1886],{"type":401,"value":1851},{"type":395,"tag":497,"props":1888,"children":1889},{"style":584},[1890],{"type":401,"value":1891}," originalOpener",{"type":395,"tag":497,"props":1893,"children":1894},{"style":521},[1895],{"type":401,"value":524},{"type":395,"tag":497,"props":1897,"children":1898},{"style":504},[1899],{"type":401,"value":1208},{"type":395,"tag":497,"props":1901,"children":1902},{"style":510},[1903],{"type":401,"value":513},{"type":395,"tag":497,"props":1905,"children":1906},{"style":516},[1907],{"type":401,"value":983},{"type":395,"tag":497,"props":1909,"children":1910},{"style":607},[1911],{"type":401,"value":610},{"type":395,"tag":497,"props":1913,"children":1914},{"style":990},[1915],{"type":401,"value":993},{"type":395,"tag":497,"props":1917,"children":1918},{"style":510},[1919],{"type":401,"value":696},{"type":395,"tag":497,"props":1921,"children":1922},{"style":521},[1923],{"type":401,"value":1002},{"type":395,"tag":497,"props":1925,"children":1926},{"style":504},[1927],{"type":401,"value":1168},{"type":395,"tag":497,"props":1929,"children":1930},{"style":607},[1931],{"type":401,"value":653},{"type":395,"tag":497,"props":1933,"children":1934},{"class":499,"line":1308},[1935,1940,1944,1949,1953,1959,1963],{"type":395,"tag":497,"props":1936,"children":1937},{"style":719},[1938],{"type":401,"value":1939},"          if",{"type":395,"tag":497,"props":1941,"children":1942},{"style":607},[1943],{"type":401,"value":727},{"type":395,"tag":497,"props":1945,"children":1946},{"style":504},[1947],{"type":401,"value":1948},"originalOpener",{"type":395,"tag":497,"props":1950,"children":1951},{"style":521},[1952],{"type":401,"value":746},{"type":395,"tag":497,"props":1954,"children":1956},{"style":1955},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[1957],{"type":401,"value":1958}," null",{"type":395,"tag":497,"props":1960,"children":1961},{"style":607},[1962],{"type":401,"value":643},{"type":395,"tag":497,"props":1964,"children":1965},{"style":510},[1966],{"type":401,"value":769},{"type":395,"tag":497,"props":1968,"children":1969},{"class":499,"line":1317},[1970,1975,1979,1983,1987,1991],{"type":395,"tag":497,"props":1971,"children":1972},{"style":516},[1973],{"type":401,"value":1974},"            notify",{"type":395,"tag":497,"props":1976,"children":1977},{"style":607},[1978],{"type":401,"value":610},{"type":395,"tag":497,"props":1980,"children":1981},{"style":678},[1982],{"type":401,"value":681},{"type":395,"tag":497,"props":1984,"children":1985},{"style":684},[1986],{"type":401,"value":1595},{"type":395,"tag":497,"props":1988,"children":1989},{"style":678},[1990],{"type":401,"value":681},{"type":395,"tag":497,"props":1992,"children":1993},{"style":607},[1994],{"type":401,"value":653},{"type":395,"tag":497,"props":1996,"children":1997},{"class":499,"line":1326},[1998],{"type":395,"tag":497,"props":1999,"children":2000},{"style":510},[2001],{"type":401,"value":2002},"          }\n",{"type":395,"tag":497,"props":2004,"children":2005},{"class":499,"line":1340},[2006,2011],{"type":395,"tag":497,"props":2007,"children":2008},{"style":719},[2009],{"type":401,"value":2010},"          return",{"type":395,"tag":497,"props":2012,"children":2013},{"style":1955},[2014],{"type":401,"value":2015}," null\n",{"type":395,"tag":497,"props":2017,"children":2018},{"class":499,"line":1371},[2019,2024],{"type":395,"tag":497,"props":2020,"children":2021},{"style":510},[2022],{"type":401,"value":2023},"        }",{"type":395,"tag":497,"props":2025,"children":2026},{"style":607},[2027],{"type":401,"value":653},{"type":395,"tag":497,"props":2029,"children":2030},{"class":499,"line":1418},[2031],{"type":395,"tag":497,"props":2032,"children":2033},{"style":510},[2034],{"type":401,"value":1451},{"type":395,"tag":497,"props":2036,"children":2037},{"class":499,"line":1431},[2038],{"type":395,"tag":497,"props":2039,"children":2040},{"style":510},[2041],{"type":401,"value":2042},"    }\n",{"type":395,"tag":497,"props":2044,"children":2045},{"class":499,"line":1445},[2046,2050,2055,2059,2064,2068,2073,2077,2081,2086,2090,2094,2098],{"type":395,"tag":497,"props":2047,"children":2048},{"style":719},[2049],{"type":401,"value":1119},{"type":395,"tag":497,"props":2051,"children":2052},{"style":504},[2053],{"type":401,"value":2054}," Object",{"type":395,"tag":497,"props":2056,"children":2057},{"style":510},[2058],{"type":401,"value":513},{"type":395,"tag":497,"props":2060,"children":2061},{"style":516},[2062],{"type":401,"value":2063},"getOwnPropertyDescriptor",{"type":395,"tag":497,"props":2065,"children":2066},{"style":607},[2067],{"type":401,"value":610},{"type":395,"tag":497,"props":2069,"children":2070},{"style":504},[2071],{"type":401,"value":2072},"temp",{"type":395,"tag":497,"props":2074,"children":2075},{"style":510},[2076],{"type":401,"value":696},{"type":395,"tag":497,"props":2078,"children":2079},{"style":678},[2080],{"type":401,"value":751},{"type":395,"tag":497,"props":2082,"children":2083},{"style":684},[2084],{"type":401,"value":2085},"opener",{"type":395,"tag":497,"props":2087,"children":2088},{"style":678},[2089],{"type":401,"value":681},{"type":395,"tag":497,"props":2091,"children":2092},{"style":607},[2093],{"type":401,"value":643},{"type":395,"tag":497,"props":2095,"children":2096},{"style":510},[2097],{"type":401,"value":513},{"type":395,"tag":497,"props":2099,"children":2100},{"style":504},[2101],{"type":401,"value":2102},"get\n",{"type":395,"tag":497,"props":2104,"children":2105},{"class":499,"line":1454},[2106],{"type":395,"tag":497,"props":2107,"children":2108},{"style":510},[2109],{"type":401,"value":2110},"  },\n",{"type":395,"tag":497,"props":2112,"children":2113},{"class":499,"line":1462},[2114],{"type":395,"tag":497,"props":2115,"children":2116},{"style":963},[2117],{"type":401,"value":2118},"  // 修改 Descriptor.Value 使得 window.opener 一直返回 null，\n",{"type":395,"tag":497,"props":2120,"children":2121},{"class":499,"line":1471},[2122],{"type":395,"tag":497,"props":2123,"children":2124},{"style":963},[2125],{"type":401,"value":2126},"  // 这是一种兼容，在部分浏览器中，\n",{"type":395,"tag":497,"props":2128,"children":2129},{"class":499,"line":1480},[2130],{"type":395,"tag":497,"props":2131,"children":2132},{"style":963},[2133],{"type":401,"value":2134},"  //  window.opener 是通过 value 而不是 getter 获取的值\n",{"type":395,"tag":497,"props":2136,"children":2137},{"class":499,"line":1489},[2138,2143,2147,2151,2155,2160,2164,2169],{"type":395,"tag":497,"props":2139,"children":2140},{"style":1716},[2141],{"type":401,"value":2142},"  valueGenerator",{"type":395,"tag":497,"props":2144,"children":2145},{"style":510},[2146],{"type":401,"value":551},{"type":395,"tag":497,"props":2148,"children":2149},{"style":527},[2150],{"type":401,"value":530},{"type":395,"tag":497,"props":2152,"children":2153},{"style":510},[2154],{"type":401,"value":540},{"type":395,"tag":497,"props":2156,"children":2157},{"style":554},[2158],{"type":401,"value":2159},"original",{"type":395,"tag":497,"props":2161,"children":2162},{"style":510},[2163],{"type":401,"value":696},{"type":395,"tag":497,"props":2165,"children":2166},{"style":554},[2167],{"type":401,"value":2168}," notify",{"type":395,"tag":497,"props":2170,"children":2171},{"style":510},[2172],{"type":401,"value":2173},"}){\n",{"type":395,"tag":497,"props":2175,"children":2176},{"class":499,"line":1543},[2177,2182,2186,2190,2194,2198,2202],{"type":395,"tag":497,"props":2178,"children":2179},{"style":719},[2180],{"type":401,"value":2181},"    if",{"type":395,"tag":497,"props":2183,"children":2184},{"style":607},[2185],{"type":401,"value":727},{"type":395,"tag":497,"props":2187,"children":2188},{"style":504},[2189],{"type":401,"value":2159},{"type":395,"tag":497,"props":2191,"children":2192},{"style":521},[2193],{"type":401,"value":746},{"type":395,"tag":497,"props":2195,"children":2196},{"style":1955},[2197],{"type":401,"value":1958},{"type":395,"tag":497,"props":2199,"children":2200},{"style":607},[2201],{"type":401,"value":643},{"type":395,"tag":497,"props":2203,"children":2204},{"style":510},[2205],{"type":401,"value":769},{"type":395,"tag":497,"props":2207,"children":2208},{"class":499,"line":1576},[2209,2214,2218,2222,2226,2230],{"type":395,"tag":497,"props":2210,"children":2211},{"style":516},[2212],{"type":401,"value":2213},"      notify",{"type":395,"tag":497,"props":2215,"children":2216},{"style":607},[2217],{"type":401,"value":610},{"type":395,"tag":497,"props":2219,"children":2220},{"style":678},[2221],{"type":401,"value":681},{"type":395,"tag":497,"props":2223,"children":2224},{"style":684},[2225],{"type":401,"value":1595},{"type":395,"tag":497,"props":2227,"children":2228},{"style":678},[2229],{"type":401,"value":681},{"type":395,"tag":497,"props":2231,"children":2232},{"style":607},[2233],{"type":401,"value":653},{"type":395,"tag":497,"props":2235,"children":2236},{"class":499,"line":1606},[2237],{"type":395,"tag":497,"props":2238,"children":2239},{"style":510},[2240],{"type":401,"value":2042},{"type":395,"tag":497,"props":2242,"children":2243},{"class":499,"line":1614},[2244,2248],{"type":395,"tag":497,"props":2245,"children":2246},{"style":719},[2247],{"type":401,"value":1119},{"type":395,"tag":497,"props":2249,"children":2250},{"style":1955},[2251],{"type":401,"value":2015},{"type":395,"tag":497,"props":2253,"children":2254},{"class":499,"line":1628},[2255],{"type":395,"tag":497,"props":2256,"children":2257},{"style":510},[2258],{"type":401,"value":852},{"type":395,"tag":497,"props":2260,"children":2261},{"class":499,"line":1646},[2262],{"type":395,"tag":497,"props":2263,"children":2264},{"style":510},[2265],{"type":401,"value":861},{"type":395,"tag":403,"props":2267,"children":2269},{"id":2268},"canvas",[2270],{"type":401,"value":2271},"Canvas",{"type":395,"tag":409,"props":2273,"children":2274},{},[2275],{"type":401,"value":2276},"伪造了 getContext、getDataURL 等 API，并替代了原本正常的 API。",{"type":395,"tag":403,"props":2278,"children":2280},{"id":2279},"相关链接",[2281],{"type":401,"value":2279},{"type":395,"tag":415,"props":2283,"children":2284},{},[2285],{"type":395,"tag":419,"props":2286,"children":2287},{},[2288],{"type":395,"tag":891,"props":2289,"children":2292},{"href":2290,"rel":2291},"https://github.com/kkapsner/CanvasBlocker",[895],[2293],{"type":401,"value":2294},"CanvasBlocker",{"type":395,"tag":2296,"props":2297,"children":2298},"style",{},[2299],{"type":401,"value":2300},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":389,"searchDepth":575,"depth":575,"links":2302},[2303,2304,2305,2308,2309,2310],{"id":405,"depth":575,"text":405},{"id":471,"depth":575,"text":474},{"id":864,"depth":575,"text":443,"children":2306},[2307],{"id":875,"depth":656,"text":878},{"id":1662,"depth":575,"text":1665},{"id":2268,"depth":575,"text":2271},{"id":2279,"depth":575,"text":2279},"markdown","content:8.source-code:_fingerprint:canvas-blocker.md","content","8.source-code/_fingerprint/canvas-blocker.md","8.source-code/_fingerprint/canvas-blocker","md",[2318,2321],{"_path":2319,"title":2320,"description":389},"/source-code/_es/object-assign","Object.prototype.assign",{"_path":2322,"title":2323,"description":389},"/source-code/_js/element-plus","ElementPlus",1742039261776]