[{"data":1,"prerenderedAt":2333},["ShallowReactive",2],{"navigation":3,"/source-code/_fingerprint/canvas-blocker":393,"/source-code/_fingerprint/canvas-blocker-surround":2326},[4,35,86,105,132,138,144,150,387],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29,32],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🚝 四十二篇系列","/flows/fourty-two",{"title":15,"_path":16},"🌃 长夜梦","/flows/long-night-dream",{"title":18,"_path":19},"🌌 万物联结与幸福感","/flows/everything",{"title":21,"_path":22},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":24,"_path":25},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":27,"_path":28},"🌧️ 我的腼腆","/flows/shy",{"title":30,"_path":31},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":33,"_path":34},"📝 心流归档","/flows/archive",{"title":36,"_path":37,"children":38},"技术博客 / Coder","/articles",[39,41,44,47,50,53,56,59,62,65,68,71,74,77,80,83],{"title":40,"_path":37},"🦁 欢迎",{"title":42,"_path":43},"🥞 在 tailwind 中使用现代化 CSS Layers","/articles/tailwind-sass-and-css-layer",{"title":45,"_path":46},"💻 本地部署 Qwen 翻译网页","/articles/local-translator",{"title":48,"_path":49},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":51,"_path":52},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":54,"_path":55},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":57,"_path":58},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":60,"_path":61},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":63,"_path":64},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":66,"_path":67},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":69,"_path":70},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":72,"_path":73},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":75,"_path":76},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":78,"_path":79},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":81,"_path":82},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":84,"_path":85},"📝 技术博客归档","/articles/archive",{"title":87,"_path":88,"children":89},"造物 / Make","/tools",[90,93,96,99,102],{"title":91,"_path":92},"🥥 Coconut","/tools/coconut",{"title":94,"_path":95},"🧶 网易云音乐歌单排序","/tools/netease-sorter",{"title":97,"_path":98},"🌐 AnySort","/tools/anysort",{"title":100,"_path":101},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":103,"_path":104},"👓 Crapto","/tools/crypto-inline",{"title":106,"_path":107,"children":108},"吉他剧场 / Music","/music",[109,111,114,117,120,123,126,129],{"title":110,"_path":107},"🎸 FingerStyle！",{"title":112,"_path":113},"🌬️ 等待的风","/music/wind",{"title":115,"_path":116},"💕 约定的海洋","/music/ocean",{"title":118,"_path":119},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":121,"_path":122},"🌏 残酷天使的行动纲领","/music/eva",{"title":124,"_path":125},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":127,"_path":128},"🍷 Wu Wei","/music/wu-wei",{"title":130,"_path":131},"🌅 无题","/music/untitled",{"title":133,"_path":134,"children":135},"画点什么 / Paint","/paint",[136],{"title":137,"_path":134},"🚧 正在施工",{"title":139,"_path":140,"children":141},"读书笔记 / Notes","/books",[142],{"title":143,"_path":140},"📕 读书笔记",{"title":145,"_path":146,"children":147},"知识地图 / Maps","/maps",[148],{"title":149,"_path":146},"🏁 知识地图",{"title":151,"_path":152,"children":153},"零散的笔记 / Gists","/gists",[154,156,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255,258,261,264,267,270,273,276,279,282,285,288,291,294,297,300,303,306,309,312,315,318,321,324,327,330,333,336,339,342,345,348,351,354,357,360,363,366,369,372,375,378,381,384],{"title":155,"_path":152},"🧊 Gists",{"title":157,"_path":158},"网站的可访问性","/gists/accessibility",{"title":160,"_path":161},"Bit","/gists/bit",{"title":163,"_path":164},"图片模糊","/gists/blur",{"title":166,"_path":167},"渲染相关笔记","/gists/c4d",{"title":169,"_path":170},"CDN 问题记录","/gists/cdn",{"title":172,"_path":173},"消毒剂","/gists/cleaner",{"title":175,"_path":176},"Windows Command","/gists/cmd",{"title":178,"_path":179},"Command","/gists/command",{"title":181,"_path":182},"复杂科学","/gists/complexity-science",{"title":184,"_path":185},"GitHub Copilot","/gists/copilot",{"title":187,"_path":188},"宇宙","/gists/cosmos",{"title":190,"_path":191},"C++","/gists/cpp",{"title":193,"_path":194},"DEPRESSION","/gists/depression",{"title":196,"_path":197},"Developer Experience","/gists/developer-experience",{"title":199,"_path":200},"Device Metrics","/gists/device-metrix",{"title":202,"_path":203},"数字化转型","/gists/digital-transformation",{"title":205,"_path":206},"ECMAScript Language Specification","/gists/ecmascript-specification",{"title":208,"_path":209},"正则表达式","/gists/eegex",{"title":211,"_path":212},"Emoji","/gists/emoji",{"title":214,"_path":215},"工程","/gists/engineering",{"title":217,"_path":218},"熵","/gists/entropy",{"title":220,"_path":221},"Environment","/gists/environment",{"title":223,"_path":224},"Erlang","/gists/erlang",{"title":226,"_path":227},"逃离塔克夫","/gists/escape-from-tarkov",{"title":229,"_path":230},"ESNext (ES6-ES11)","/gists/esnext",{"title":232,"_path":233},"Eval！","/gists/eval",{"title":235,"_path":236},"Flutter","/gists/flutter",{"title":238,"_path":239},"字体","/gists/font",{"title":241,"_path":242},"JS 函数式编程","/gists/functional",{"title":244,"_path":245},"游戏化","/gists/gamification",{"title":247,"_path":248},"Google C++ Standard","/gists/google-cpp-standard",{"title":250,"_path":251},"双向链接完全体","/gists/graph",{"title":253,"_path":254},"Hardwares","/gists/hardwares",{"title":256,"_path":257},"哈希冲突","/gists/hash-collision",{"title":259,"_path":260},"信息设计","/gists/information-design",{"title":262,"_path":263},"InstantPage","/gists/instant.page",{"title":265,"_path":266},"ISUX 遇见大数据可视化系列","/gists/isux-data-visualization",{"title":268,"_path":269},"KVStore","/gists/key-value-db",{"title":271,"_path":272},"Kubernetes","/gists/kubernetes",{"title":274,"_path":275},"Makefile","/gists/makefile",{"title":277,"_path":278},"Markdown Inline Style","/gists/markdown-nice",{"title":280,"_path":281},"小程序","/gists/miniapp",{"title":283,"_path":284},"减小页面快照体积","/gists/minify-html",{"title":286,"_path":287},"mklink","/gists/mklink",{"title":289,"_path":290},"Mock","/gists/mock",{"title":292,"_path":293},"多人协作系统","/gists/multiplayer",{"title":295,"_path":296},"多端应用","/gists/multy-end-app",{"title":298,"_path":299},"神经科学","/gists/neuroscience",{"title":301,"_path":302},"Opinioned Personal Folder","/gists/opinioned-personal-folder",{"title":304,"_path":305},"PInvoke","/gists/pinvoke",{"title":307,"_path":308},"像素","/gists/pixel",{"title":310,"_path":311},"PowerShell","/gists/powershell",{"title":313,"_path":314},"量子","/gists/quantum",{"title":316,"_path":317},"保持好奇心","/gists/questions",{"title":319,"_path":320},"React Native","/gists/react-native",{"title":322,"_path":323},"博客改版碰到的浏览器平滑滚动问题","/gists/scroll",{"title":325,"_path":326},"SEO","/gists/seo",{"title":328,"_path":329},"Shader","/gists/shader",{"title":331,"_path":332},"Shape Up","/gists/shape-up",{"title":334,"_path":335},"睡觉","/gists/sleep",{"title":337,"_path":338},"记录奇怪的问题","/gists/solved",{"title":340,"_path":341},"States","/gists/states",{"title":343,"_path":344},"Storage","/gists/storage",{"title":346,"_path":347},"音视频流处理","/gists/stream-cli",{"title":349,"_path":350},"Symbol","/gists/symbol",{"title":352,"_path":353},"系统论","/gists/systems-theory",{"title":355,"_path":356},"Taro","/gists/taro",{"title":358,"_path":359},"任务切片","/gists/task-slice",{"title":361,"_path":362},"技术偏好","/gists/tech-dudge",{"title":364,"_path":365},"Untitled","/gists/untitled",{"title":367,"_path":368},"可变字体","/gists/variable-font",{"title":370,"_path":371},"视觉错觉","/gists/visual-illusion",{"title":373,"_path":374},"SS(SSR)","/gists/vpn",{"title":376,"_path":377},"VS Code 插件开发","/gists/vscode-plugin",{"title":379,"_path":380},"Web Components","/gists/web-components",{"title":382,"_path":383},"Windows","/gists/windows",{"title":385,"_path":386},"查缺补漏","/gists/wrong",{"title":388,"_path":389,"children":390},"我 / About","/hire",[391],{"title":392,"_path":389},"📬 技术简历",{"_path":394,"_dir":395,"_draft":396,"_partial":397,"_locale":398,"title":399,"description":398,"body":400,"_type":2320,"_id":2321,"_source":2322,"_file":2323,"_stem":2324,"_extension":2325},"/source-code/_fingerprint/canvas-blocker","_fingerprint",false,true,"","Canvas Blocker",{"type":401,"children":402,"toc":2310},"root",[403,411,417,423,473,478,484,489,494,871,876,881,888,893,918,923,1081,1086,1669,1675,1680,1693,1698,2275,2281,2286,2291,2304],{"type":404,"tag":405,"props":406,"children":408},"element","h1",{"id":407},"canvas-blocker",[409],{"type":410,"value":399},"text",{"type":404,"tag":412,"props":413,"children":415},"h2",{"id":414},"前言",[416],{"type":410,"value":414},{"type":404,"tag":418,"props":419,"children":420},"p",{},[421],{"type":410,"value":422},"最近在看一些反反爬相关的东西，期间找到了 Canvas Blocker 这个神奇的库。他是一个浏览器扩展，声称能拦截以下几种类型的指纹追踪：",{"type":404,"tag":424,"props":425,"children":426},"ul",{},[427,433,438,443,448,453,458,463,468],{"type":404,"tag":428,"props":429,"children":430},"li",{},[431],{"type":410,"value":432},"Canvas 2D",{"type":404,"tag":428,"props":434,"children":435},{},[436],{"type":410,"value":437},"WebGL",{"type":404,"tag":428,"props":439,"children":440},{},[441],{"type":410,"value":442},"Web Audio",{"type":404,"tag":428,"props":444,"children":445},{},[446],{"type":410,"value":447},"History",{"type":404,"tag":428,"props":449,"children":450},{},[451],{"type":410,"value":452},"Window",{"type":404,"tag":428,"props":454,"children":455},{},[456],{"type":410,"value":457},"DOMRect",{"type":404,"tag":428,"props":459,"children":460},{},[461],{"type":410,"value":462},"TextMetrics",{"type":404,"tag":428,"props":464,"children":465},{},[466],{"type":410,"value":467},"Navigator",{"type":404,"tag":428,"props":469,"children":470},{},[471],{"type":410,"value":472},"Screen",{"type":404,"tag":418,"props":474,"children":475},{},[476],{"type":410,"value":477},"让我们大致拆解一下，看看其原理是什么。",{"type":404,"tag":412,"props":479,"children":481},{"id":480},"intercept",[482],{"type":410,"value":483},"Intercept",{"type":404,"tag":418,"props":485,"children":486},{},[487],{"type":410,"value":488},"Blocker 最主要的思路就是用伪造的函数篡改属性的 Getter 以及某些 API。",{"type":404,"tag":418,"props":490,"children":491},{},[492],{"type":410,"value":493},"篡改的入口在 intercept.js 中，先根据页面 URL 检查当前页面是否允许篡改，允许的话就通过 interceptFns、interceptGetters 实施具体步骤。",{"type":404,"tag":495,"props":496,"children":500},"pre",{"className":497,"code":498,"language":499,"meta":398,"style":398},"language-js shiki shiki-themes material-theme-lighter github-light github-dark monokai","scope.intercept = function intercept({subject: windowToProcess}, apis){\n  const siteStatus = apis.check({url: getURL(windowToProcess)})\n  logging.verbose(\"status for page\", windowToProcess, siteStatus)\n  if (siteStatus.mode !== \"allow\"){\n    interceptFunctions(windowToProcess, siteStatus, apis)\n    interceptGetters(windowToProcess, siteStatus, apis)\n  }\n}\n","js",[501],{"type":404,"tag":502,"props":503,"children":504},"code",{"__ignoreMap":398},[505,582,663,722,779,816,853,862],{"type":404,"tag":506,"props":507,"children":510},"span",{"class":508,"line":509},"line",1,[511,517,523,528,534,540,545,550,556,561,567,572,577],{"type":404,"tag":506,"props":512,"children":514},{"style":513},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[515],{"type":410,"value":516},"scope",{"type":404,"tag":506,"props":518,"children":520},{"style":519},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[521],{"type":410,"value":522},".",{"type":404,"tag":506,"props":524,"children":526},{"style":525},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[527],{"type":410,"value":480},{"type":404,"tag":506,"props":529,"children":531},{"style":530},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[532],{"type":410,"value":533}," =",{"type":404,"tag":506,"props":535,"children":537},{"style":536},"--shiki-light:#9C3EDA;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic",[538],{"type":410,"value":539}," function",{"type":404,"tag":506,"props":541,"children":542},{"style":525},[543],{"type":410,"value":544}," intercept",{"type":404,"tag":506,"props":546,"children":547},{"style":519},[548],{"type":410,"value":549},"({",{"type":404,"tag":506,"props":551,"children":553},{"style":552},"--shiki-light:#E53935;--shiki-default:#E36209;--shiki-dark:#FFAB70;--shiki-sepia:#F8F8F2",[554],{"type":410,"value":555},"subject",{"type":404,"tag":506,"props":557,"children":558},{"style":519},[559],{"type":410,"value":560},":",{"type":404,"tag":506,"props":562,"children":564},{"style":563},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#E36209;--shiki-default-font-style:inherit;--shiki-dark:#FFAB70;--shiki-dark-font-style:inherit;--shiki-sepia:#FD971F;--shiki-sepia-font-style:italic",[565],{"type":410,"value":566}," windowToProcess",{"type":404,"tag":506,"props":568,"children":569},{"style":519},[570],{"type":410,"value":571},"},",{"type":404,"tag":506,"props":573,"children":574},{"style":563},[575],{"type":410,"value":576}," apis",{"type":404,"tag":506,"props":578,"children":579},{"style":519},[580],{"type":410,"value":581},"){\n",{"type":404,"tag":506,"props":583,"children":585},{"class":508,"line":584},2,[586,591,597,601,605,609,614,620,625,630,634,639,643,648,653,658],{"type":404,"tag":506,"props":587,"children":588},{"style":536},[589],{"type":410,"value":590},"  const",{"type":404,"tag":506,"props":592,"children":594},{"style":593},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#F8F8F2",[595],{"type":410,"value":596}," siteStatus",{"type":404,"tag":506,"props":598,"children":599},{"style":530},[600],{"type":410,"value":533},{"type":404,"tag":506,"props":602,"children":603},{"style":513},[604],{"type":410,"value":576},{"type":404,"tag":506,"props":606,"children":607},{"style":519},[608],{"type":410,"value":522},{"type":404,"tag":506,"props":610,"children":611},{"style":525},[612],{"type":410,"value":613},"check",{"type":404,"tag":506,"props":615,"children":617},{"style":616},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[618],{"type":410,"value":619},"(",{"type":404,"tag":506,"props":621,"children":622},{"style":519},[623],{"type":410,"value":624},"{",{"type":404,"tag":506,"props":626,"children":627},{"style":616},[628],{"type":410,"value":629},"url",{"type":404,"tag":506,"props":631,"children":632},{"style":519},[633],{"type":410,"value":560},{"type":404,"tag":506,"props":635,"children":636},{"style":525},[637],{"type":410,"value":638}," getURL",{"type":404,"tag":506,"props":640,"children":641},{"style":616},[642],{"type":410,"value":619},{"type":404,"tag":506,"props":644,"children":645},{"style":513},[646],{"type":410,"value":647},"windowToProcess",{"type":404,"tag":506,"props":649,"children":650},{"style":616},[651],{"type":410,"value":652},")",{"type":404,"tag":506,"props":654,"children":655},{"style":519},[656],{"type":410,"value":657},"}",{"type":404,"tag":506,"props":659,"children":660},{"style":616},[661],{"type":410,"value":662},")\n",{"type":404,"tag":506,"props":664,"children":666},{"class":508,"line":665},3,[667,672,676,681,685,691,697,701,706,710,714,718],{"type":404,"tag":506,"props":668,"children":669},{"style":513},[670],{"type":410,"value":671},"  logging",{"type":404,"tag":506,"props":673,"children":674},{"style":519},[675],{"type":410,"value":522},{"type":404,"tag":506,"props":677,"children":678},{"style":525},[679],{"type":410,"value":680},"verbose",{"type":404,"tag":506,"props":682,"children":683},{"style":616},[684],{"type":410,"value":619},{"type":404,"tag":506,"props":686,"children":688},{"style":687},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[689],{"type":410,"value":690},"\"",{"type":404,"tag":506,"props":692,"children":694},{"style":693},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[695],{"type":410,"value":696},"status for page",{"type":404,"tag":506,"props":698,"children":699},{"style":687},[700],{"type":410,"value":690},{"type":404,"tag":506,"props":702,"children":703},{"style":519},[704],{"type":410,"value":705},",",{"type":404,"tag":506,"props":707,"children":708},{"style":513},[709],{"type":410,"value":566},{"type":404,"tag":506,"props":711,"children":712},{"style":519},[713],{"type":410,"value":705},{"type":404,"tag":506,"props":715,"children":716},{"style":513},[717],{"type":410,"value":596},{"type":404,"tag":506,"props":719,"children":720},{"style":616},[721],{"type":410,"value":662},{"type":404,"tag":506,"props":723,"children":725},{"class":508,"line":724},4,[726,732,737,742,746,751,756,761,766,770,774],{"type":404,"tag":506,"props":727,"children":729},{"style":728},"--shiki-light:#39ADB5;--shiki-light-font-style:italic;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#F92672;--shiki-sepia-font-style:inherit",[730],{"type":410,"value":731},"  if",{"type":404,"tag":506,"props":733,"children":734},{"style":616},[735],{"type":410,"value":736}," (",{"type":404,"tag":506,"props":738,"children":739},{"style":513},[740],{"type":410,"value":741},"siteStatus",{"type":404,"tag":506,"props":743,"children":744},{"style":519},[745],{"type":410,"value":522},{"type":404,"tag":506,"props":747,"children":748},{"style":513},[749],{"type":410,"value":750},"mode",{"type":404,"tag":506,"props":752,"children":753},{"style":530},[754],{"type":410,"value":755}," !==",{"type":404,"tag":506,"props":757,"children":758},{"style":687},[759],{"type":410,"value":760}," \"",{"type":404,"tag":506,"props":762,"children":763},{"style":693},[764],{"type":410,"value":765},"allow",{"type":404,"tag":506,"props":767,"children":768},{"style":687},[769],{"type":410,"value":690},{"type":404,"tag":506,"props":771,"children":772},{"style":616},[773],{"type":410,"value":652},{"type":404,"tag":506,"props":775,"children":776},{"style":519},[777],{"type":410,"value":778},"{\n",{"type":404,"tag":506,"props":780,"children":782},{"class":508,"line":781},5,[783,788,792,796,800,804,808,812],{"type":404,"tag":506,"props":784,"children":785},{"style":525},[786],{"type":410,"value":787},"    interceptFunctions",{"type":404,"tag":506,"props":789,"children":790},{"style":616},[791],{"type":410,"value":619},{"type":404,"tag":506,"props":793,"children":794},{"style":513},[795],{"type":410,"value":647},{"type":404,"tag":506,"props":797,"children":798},{"style":519},[799],{"type":410,"value":705},{"type":404,"tag":506,"props":801,"children":802},{"style":513},[803],{"type":410,"value":596},{"type":404,"tag":506,"props":805,"children":806},{"style":519},[807],{"type":410,"value":705},{"type":404,"tag":506,"props":809,"children":810},{"style":513},[811],{"type":410,"value":576},{"type":404,"tag":506,"props":813,"children":814},{"style":616},[815],{"type":410,"value":662},{"type":404,"tag":506,"props":817,"children":819},{"class":508,"line":818},6,[820,825,829,833,837,841,845,849],{"type":404,"tag":506,"props":821,"children":822},{"style":525},[823],{"type":410,"value":824},"    interceptGetters",{"type":404,"tag":506,"props":826,"children":827},{"style":616},[828],{"type":410,"value":619},{"type":404,"tag":506,"props":830,"children":831},{"style":513},[832],{"type":410,"value":647},{"type":404,"tag":506,"props":834,"children":835},{"style":519},[836],{"type":410,"value":705},{"type":404,"tag":506,"props":838,"children":839},{"style":513},[840],{"type":410,"value":596},{"type":404,"tag":506,"props":842,"children":843},{"style":519},[844],{"type":410,"value":705},{"type":404,"tag":506,"props":846,"children":847},{"style":513},[848],{"type":410,"value":576},{"type":404,"tag":506,"props":850,"children":851},{"style":616},[852],{"type":410,"value":662},{"type":404,"tag":506,"props":854,"children":856},{"class":508,"line":855},7,[857],{"type":404,"tag":506,"props":858,"children":859},{"style":519},[860],{"type":410,"value":861},"  }\n",{"type":404,"tag":506,"props":863,"children":865},{"class":508,"line":864},8,[866],{"type":404,"tag":506,"props":867,"children":868},{"style":519},[869],{"type":410,"value":870},"}\n",{"type":404,"tag":412,"props":872,"children":874},{"id":873},"window",[875],{"type":410,"value":452},{"type":404,"tag":418,"props":877,"children":878},{},[879],{"type":410,"value":880},"Blocker 篡改了 Window 的两个属性，window.name 和 window.opener。这两个属性和指纹没有直接关系，但却是一种“帮助函数”，能够帮助恶意网站追踪指纹以及窃取隐私。",{"type":404,"tag":882,"props":883,"children":885},"h3",{"id":884},"windowname",[886],{"type":410,"value":887},"window.name",{"type":404,"tag":418,"props":889,"children":890},{},[891],{"type":410,"value":892},"在过去的浏览器中，window.name 能够跨站点传输数据，并且能逃逸同源策略。从 Firefox 88 开始，用户通过点击超链接跳转到新页面时，window.name 将被置空，不过为了不造成更大的破坏，当用户从跳转后页面回到之前页面时，window.name 会被还原。",{"type":404,"tag":424,"props":894,"children":895},{},[896,908],{"type":404,"tag":428,"props":897,"children":898},{},[899],{"type":404,"tag":900,"props":901,"children":905},"a",{"href":902,"rel":903},"https://blog.mozilla.org/security/2021/04/19/firefox-88-combats-window-name-privacy-abuses/",[904],"nofollow",[906],{"type":410,"value":907},"Firefox 88 combats window.name privacy abuses",{"type":404,"tag":428,"props":909,"children":910},{},[911],{"type":404,"tag":900,"props":912,"children":915},{"href":913,"rel":914},"https://wpt.fyi/results/html/browsers/windows/clear-window-name.https.html?label=master&label=experimental&aligned",[904],[916],{"type":410,"value":917},"clear-window-name@web-platform-tests",{"type":404,"tag":418,"props":919,"children":920},{},[921],{"type":410,"value":922},"在使用 JS 设置 window.name 时，Blcoker 会记录下设置的值。original.call 调用原有的 window.name setter；windowNames 只做记录，稍后会用到。",{"type":404,"tag":495,"props":924,"children":926},{"className":497,"code":925,"language":499,"meta":398,"style":398},"{\n  set name(name){\n    // 调用原有 setting 设置 window.name\n    original.call(this, ...arguments)\n    // 把 name 记录下来\n    windowNames.set(this, name)\n  }\n}\n",[927],{"type":404,"tag":502,"props":928,"children":929},{"__ignoreMap":398},[930,937,967,976,1022,1030,1067,1074],{"type":404,"tag":506,"props":931,"children":932},{"class":508,"line":509},[933],{"type":404,"tag":506,"props":934,"children":935},{"style":519},[936],{"type":410,"value":778},{"type":404,"tag":506,"props":938,"children":939},{"class":508,"line":584},[940,945,950,954,959,963],{"type":404,"tag":506,"props":941,"children":942},{"style":513},[943],{"type":410,"value":944},"  set",{"type":404,"tag":506,"props":946,"children":947},{"style":525},[948],{"type":410,"value":949}," name",{"type":404,"tag":506,"props":951,"children":952},{"style":616},[953],{"type":410,"value":619},{"type":404,"tag":506,"props":955,"children":956},{"style":513},[957],{"type":410,"value":958},"name",{"type":404,"tag":506,"props":960,"children":961},{"style":616},[962],{"type":410,"value":652},{"type":404,"tag":506,"props":964,"children":965},{"style":519},[966],{"type":410,"value":778},{"type":404,"tag":506,"props":968,"children":969},{"class":508,"line":665},[970],{"type":404,"tag":506,"props":971,"children":973},{"style":972},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit",[974],{"type":410,"value":975},"    // 调用原有 setting 设置 window.name\n",{"type":404,"tag":506,"props":977,"children":978},{"class":508,"line":724},[979,984,988,993,997,1003,1007,1012,1018],{"type":404,"tag":506,"props":980,"children":981},{"style":513},[982],{"type":410,"value":983},"    original",{"type":404,"tag":506,"props":985,"children":986},{"style":519},[987],{"type":410,"value":522},{"type":404,"tag":506,"props":989,"children":990},{"style":525},[991],{"type":410,"value":992},"call",{"type":404,"tag":506,"props":994,"children":995},{"style":616},[996],{"type":410,"value":619},{"type":404,"tag":506,"props":998,"children":1000},{"style":999},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[1001],{"type":410,"value":1002},"this",{"type":404,"tag":506,"props":1004,"children":1005},{"style":519},[1006],{"type":410,"value":705},{"type":404,"tag":506,"props":1008,"children":1009},{"style":530},[1010],{"type":410,"value":1011}," ...",{"type":404,"tag":506,"props":1013,"children":1015},{"style":1014},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[1016],{"type":410,"value":1017},"arguments",{"type":404,"tag":506,"props":1019,"children":1020},{"style":616},[1021],{"type":410,"value":662},{"type":404,"tag":506,"props":1023,"children":1024},{"class":508,"line":781},[1025],{"type":404,"tag":506,"props":1026,"children":1027},{"style":972},[1028],{"type":410,"value":1029},"    // 把 name 记录下来\n",{"type":404,"tag":506,"props":1031,"children":1032},{"class":508,"line":818},[1033,1038,1042,1047,1051,1055,1059,1063],{"type":404,"tag":506,"props":1034,"children":1035},{"style":513},[1036],{"type":410,"value":1037},"    windowNames",{"type":404,"tag":506,"props":1039,"children":1040},{"style":519},[1041],{"type":410,"value":522},{"type":404,"tag":506,"props":1043,"children":1044},{"style":525},[1045],{"type":410,"value":1046},"set",{"type":404,"tag":506,"props":1048,"children":1049},{"style":616},[1050],{"type":410,"value":619},{"type":404,"tag":506,"props":1052,"children":1053},{"style":999},[1054],{"type":410,"value":1002},{"type":404,"tag":506,"props":1056,"children":1057},{"style":519},[1058],{"type":410,"value":705},{"type":404,"tag":506,"props":1060,"children":1061},{"style":513},[1062],{"type":410,"value":949},{"type":404,"tag":506,"props":1064,"children":1065},{"style":616},[1066],{"type":410,"value":662},{"type":404,"tag":506,"props":1068,"children":1069},{"class":508,"line":855},[1070],{"type":404,"tag":506,"props":1071,"children":1072},{"style":519},[1073],{"type":410,"value":861},{"type":404,"tag":506,"props":1075,"children":1076},{"class":508,"line":864},[1077],{"type":404,"tag":506,"props":1078,"children":1079},{"style":519},[1080],{"type":410,"value":870},{"type":404,"tag":418,"props":1082,"children":1083},{},[1084],{"type":410,"value":1085},"因为只有通过显式的 window.name = 'xxx' 才会触发 windowNames 中记录的值的改变，所以一旦在 b.com 读取到的 window.name 不是 windowNames 记录的值，就说明浏览器泄露了 window.name，此时需要返回伪造的值。",{"type":404,"tag":495,"props":1087,"children":1089},{"className":497,"code":1088,"language":499,"meta":398,"style":398},"{\n  get name(){\n    return checkerWrapper(checker, this, arguments, function(args, check){\n      const {notify, original, prefs} = check\n\n      // 读取 b.com 的 window.name 可能会返回 a.com 的 window.name\n      const originalName = original.call(this, ...args)\n\n      // 根据配置，iframes 中返回的 window.name 可以赦免此伪造规则，\n      // this !== this.top 是一种快速检测当前 window 是否在 iframe 中的方法\n      if (\n        this !== this.top &&\n        prefs(\"allowWindowNameInFrames\", this.location)\n      ){\n        return originalName\n      }\n\n      // 只有通过显式的 window.name = 'xxx' 才会触发 windowNames 中记录的值的改变，\n      // 所以一旦 windowNames 记录的值和 originalName 不一样，\n      // 就说明当前浏览器犯了 window.name 泄露的错误\n      const returnedName = windowNames.get(this) || \"\"\n      if (originalName !== returnedName){\n        notify(\"fakedWindowReadout\")\n      }\n      return returnedName\n    });\n  }\n}\n",[1090],{"type":404,"tag":502,"props":1091,"children":1092},{"__ignoreMap":398},[1093,1100,1121,1191,1240,1248,1256,1308,1315,1324,1333,1347,1378,1425,1438,1452,1461,1469,1478,1487,1496,1550,1583,1613,1621,1635,1653,1661],{"type":404,"tag":506,"props":1094,"children":1095},{"class":508,"line":509},[1096],{"type":404,"tag":506,"props":1097,"children":1098},{"style":519},[1099],{"type":410,"value":778},{"type":404,"tag":506,"props":1101,"children":1102},{"class":508,"line":584},[1103,1108,1112,1117],{"type":404,"tag":506,"props":1104,"children":1105},{"style":513},[1106],{"type":410,"value":1107},"  get",{"type":404,"tag":506,"props":1109,"children":1110},{"style":525},[1111],{"type":410,"value":949},{"type":404,"tag":506,"props":1113,"children":1114},{"style":616},[1115],{"type":410,"value":1116},"()",{"type":404,"tag":506,"props":1118,"children":1119},{"style":519},[1120],{"type":410,"value":778},{"type":404,"tag":506,"props":1122,"children":1123},{"class":508,"line":665},[1124,1129,1134,1138,1143,1147,1152,1156,1161,1165,1169,1173,1178,1182,1187],{"type":404,"tag":506,"props":1125,"children":1126},{"style":728},[1127],{"type":410,"value":1128},"    return",{"type":404,"tag":506,"props":1130,"children":1131},{"style":525},[1132],{"type":410,"value":1133}," checkerWrapper",{"type":404,"tag":506,"props":1135,"children":1136},{"style":616},[1137],{"type":410,"value":619},{"type":404,"tag":506,"props":1139,"children":1140},{"style":513},[1141],{"type":410,"value":1142},"checker",{"type":404,"tag":506,"props":1144,"children":1145},{"style":519},[1146],{"type":410,"value":705},{"type":404,"tag":506,"props":1148,"children":1149},{"style":999},[1150],{"type":410,"value":1151}," this",{"type":404,"tag":506,"props":1153,"children":1154},{"style":519},[1155],{"type":410,"value":705},{"type":404,"tag":506,"props":1157,"children":1158},{"style":1014},[1159],{"type":410,"value":1160}," arguments",{"type":404,"tag":506,"props":1162,"children":1163},{"style":519},[1164],{"type":410,"value":705},{"type":404,"tag":506,"props":1166,"children":1167},{"style":536},[1168],{"type":410,"value":539},{"type":404,"tag":506,"props":1170,"children":1171},{"style":519},[1172],{"type":410,"value":619},{"type":404,"tag":506,"props":1174,"children":1175},{"style":563},[1176],{"type":410,"value":1177},"args",{"type":404,"tag":506,"props":1179,"children":1180},{"style":519},[1181],{"type":410,"value":705},{"type":404,"tag":506,"props":1183,"children":1184},{"style":563},[1185],{"type":410,"value":1186}," check",{"type":404,"tag":506,"props":1188,"children":1189},{"style":519},[1190],{"type":410,"value":581},{"type":404,"tag":506,"props":1192,"children":1193},{"class":508,"line":724},[1194,1199,1204,1209,1213,1218,1222,1227,1231,1235],{"type":404,"tag":506,"props":1195,"children":1196},{"style":536},[1197],{"type":410,"value":1198},"      const",{"type":404,"tag":506,"props":1200,"children":1201},{"style":519},[1202],{"type":410,"value":1203}," {",{"type":404,"tag":506,"props":1205,"children":1206},{"style":593},[1207],{"type":410,"value":1208},"notify",{"type":404,"tag":506,"props":1210,"children":1211},{"style":519},[1212],{"type":410,"value":705},{"type":404,"tag":506,"props":1214,"children":1215},{"style":593},[1216],{"type":410,"value":1217}," original",{"type":404,"tag":506,"props":1219,"children":1220},{"style":519},[1221],{"type":410,"value":705},{"type":404,"tag":506,"props":1223,"children":1224},{"style":593},[1225],{"type":410,"value":1226}," prefs",{"type":404,"tag":506,"props":1228,"children":1229},{"style":519},[1230],{"type":410,"value":657},{"type":404,"tag":506,"props":1232,"children":1233},{"style":530},[1234],{"type":410,"value":533},{"type":404,"tag":506,"props":1236,"children":1237},{"style":513},[1238],{"type":410,"value":1239}," check\n",{"type":404,"tag":506,"props":1241,"children":1242},{"class":508,"line":781},[1243],{"type":404,"tag":506,"props":1244,"children":1245},{"emptyLinePlaceholder":397},[1246],{"type":410,"value":1247},"\n",{"type":404,"tag":506,"props":1249,"children":1250},{"class":508,"line":818},[1251],{"type":404,"tag":506,"props":1252,"children":1253},{"style":972},[1254],{"type":410,"value":1255},"      // 读取 b.com 的 window.name 可能会返回 a.com 的 window.name\n",{"type":404,"tag":506,"props":1257,"children":1258},{"class":508,"line":855},[1259,1263,1268,1272,1276,1280,1284,1288,1292,1296,1300,1304],{"type":404,"tag":506,"props":1260,"children":1261},{"style":536},[1262],{"type":410,"value":1198},{"type":404,"tag":506,"props":1264,"children":1265},{"style":593},[1266],{"type":410,"value":1267}," originalName",{"type":404,"tag":506,"props":1269,"children":1270},{"style":530},[1271],{"type":410,"value":533},{"type":404,"tag":506,"props":1273,"children":1274},{"style":513},[1275],{"type":410,"value":1217},{"type":404,"tag":506,"props":1277,"children":1278},{"style":519},[1279],{"type":410,"value":522},{"type":404,"tag":506,"props":1281,"children":1282},{"style":525},[1283],{"type":410,"value":992},{"type":404,"tag":506,"props":1285,"children":1286},{"style":616},[1287],{"type":410,"value":619},{"type":404,"tag":506,"props":1289,"children":1290},{"style":999},[1291],{"type":410,"value":1002},{"type":404,"tag":506,"props":1293,"children":1294},{"style":519},[1295],{"type":410,"value":705},{"type":404,"tag":506,"props":1297,"children":1298},{"style":530},[1299],{"type":410,"value":1011},{"type":404,"tag":506,"props":1301,"children":1302},{"style":513},[1303],{"type":410,"value":1177},{"type":404,"tag":506,"props":1305,"children":1306},{"style":616},[1307],{"type":410,"value":662},{"type":404,"tag":506,"props":1309,"children":1310},{"class":508,"line":864},[1311],{"type":404,"tag":506,"props":1312,"children":1313},{"emptyLinePlaceholder":397},[1314],{"type":410,"value":1247},{"type":404,"tag":506,"props":1316,"children":1318},{"class":508,"line":1317},9,[1319],{"type":404,"tag":506,"props":1320,"children":1321},{"style":972},[1322],{"type":410,"value":1323},"      // 根据配置，iframes 中返回的 window.name 可以赦免此伪造规则，\n",{"type":404,"tag":506,"props":1325,"children":1327},{"class":508,"line":1326},10,[1328],{"type":404,"tag":506,"props":1329,"children":1330},{"style":972},[1331],{"type":410,"value":1332},"      // this !== this.top 是一种快速检测当前 window 是否在 iframe 中的方法\n",{"type":404,"tag":506,"props":1334,"children":1336},{"class":508,"line":1335},11,[1337,1342],{"type":404,"tag":506,"props":1338,"children":1339},{"style":728},[1340],{"type":410,"value":1341},"      if",{"type":404,"tag":506,"props":1343,"children":1344},{"style":616},[1345],{"type":410,"value":1346}," (\n",{"type":404,"tag":506,"props":1348,"children":1350},{"class":508,"line":1349},12,[1351,1356,1360,1364,1368,1373],{"type":404,"tag":506,"props":1352,"children":1353},{"style":999},[1354],{"type":410,"value":1355},"        this",{"type":404,"tag":506,"props":1357,"children":1358},{"style":530},[1359],{"type":410,"value":755},{"type":404,"tag":506,"props":1361,"children":1362},{"style":999},[1363],{"type":410,"value":1151},{"type":404,"tag":506,"props":1365,"children":1366},{"style":519},[1367],{"type":410,"value":522},{"type":404,"tag":506,"props":1369,"children":1370},{"style":513},[1371],{"type":410,"value":1372},"top",{"type":404,"tag":506,"props":1374,"children":1375},{"style":530},[1376],{"type":410,"value":1377}," &&\n",{"type":404,"tag":506,"props":1379,"children":1381},{"class":508,"line":1380},13,[1382,1387,1391,1395,1400,1404,1408,1412,1416,1421],{"type":404,"tag":506,"props":1383,"children":1384},{"style":525},[1385],{"type":410,"value":1386},"        prefs",{"type":404,"tag":506,"props":1388,"children":1389},{"style":616},[1390],{"type":410,"value":619},{"type":404,"tag":506,"props":1392,"children":1393},{"style":687},[1394],{"type":410,"value":690},{"type":404,"tag":506,"props":1396,"children":1397},{"style":693},[1398],{"type":410,"value":1399},"allowWindowNameInFrames",{"type":404,"tag":506,"props":1401,"children":1402},{"style":687},[1403],{"type":410,"value":690},{"type":404,"tag":506,"props":1405,"children":1406},{"style":519},[1407],{"type":410,"value":705},{"type":404,"tag":506,"props":1409,"children":1410},{"style":999},[1411],{"type":410,"value":1151},{"type":404,"tag":506,"props":1413,"children":1414},{"style":519},[1415],{"type":410,"value":522},{"type":404,"tag":506,"props":1417,"children":1418},{"style":513},[1419],{"type":410,"value":1420},"location",{"type":404,"tag":506,"props":1422,"children":1423},{"style":616},[1424],{"type":410,"value":662},{"type":404,"tag":506,"props":1426,"children":1428},{"class":508,"line":1427},14,[1429,1434],{"type":404,"tag":506,"props":1430,"children":1431},{"style":616},[1432],{"type":410,"value":1433},"      )",{"type":404,"tag":506,"props":1435,"children":1436},{"style":519},[1437],{"type":410,"value":778},{"type":404,"tag":506,"props":1439,"children":1441},{"class":508,"line":1440},15,[1442,1447],{"type":404,"tag":506,"props":1443,"children":1444},{"style":728},[1445],{"type":410,"value":1446},"        return",{"type":404,"tag":506,"props":1448,"children":1449},{"style":513},[1450],{"type":410,"value":1451}," originalName\n",{"type":404,"tag":506,"props":1453,"children":1455},{"class":508,"line":1454},16,[1456],{"type":404,"tag":506,"props":1457,"children":1458},{"style":519},[1459],{"type":410,"value":1460},"      }\n",{"type":404,"tag":506,"props":1462,"children":1464},{"class":508,"line":1463},17,[1465],{"type":404,"tag":506,"props":1466,"children":1467},{"emptyLinePlaceholder":397},[1468],{"type":410,"value":1247},{"type":404,"tag":506,"props":1470,"children":1472},{"class":508,"line":1471},18,[1473],{"type":404,"tag":506,"props":1474,"children":1475},{"style":972},[1476],{"type":410,"value":1477},"      // 只有通过显式的 window.name = 'xxx' 才会触发 windowNames 中记录的值的改变，\n",{"type":404,"tag":506,"props":1479,"children":1481},{"class":508,"line":1480},19,[1482],{"type":404,"tag":506,"props":1483,"children":1484},{"style":972},[1485],{"type":410,"value":1486},"      // 所以一旦 windowNames 记录的值和 originalName 不一样，\n",{"type":404,"tag":506,"props":1488,"children":1490},{"class":508,"line":1489},20,[1491],{"type":404,"tag":506,"props":1492,"children":1493},{"style":972},[1494],{"type":410,"value":1495},"      // 就说明当前浏览器犯了 window.name 泄露的错误\n",{"type":404,"tag":506,"props":1497,"children":1499},{"class":508,"line":1498},21,[1500,1504,1509,1513,1518,1522,1527,1531,1535,1540,1545],{"type":404,"tag":506,"props":1501,"children":1502},{"style":536},[1503],{"type":410,"value":1198},{"type":404,"tag":506,"props":1505,"children":1506},{"style":593},[1507],{"type":410,"value":1508}," returnedName",{"type":404,"tag":506,"props":1510,"children":1511},{"style":530},[1512],{"type":410,"value":533},{"type":404,"tag":506,"props":1514,"children":1515},{"style":513},[1516],{"type":410,"value":1517}," windowNames",{"type":404,"tag":506,"props":1519,"children":1520},{"style":519},[1521],{"type":410,"value":522},{"type":404,"tag":506,"props":1523,"children":1524},{"style":525},[1525],{"type":410,"value":1526},"get",{"type":404,"tag":506,"props":1528,"children":1529},{"style":616},[1530],{"type":410,"value":619},{"type":404,"tag":506,"props":1532,"children":1533},{"style":999},[1534],{"type":410,"value":1002},{"type":404,"tag":506,"props":1536,"children":1537},{"style":616},[1538],{"type":410,"value":1539},") ",{"type":404,"tag":506,"props":1541,"children":1542},{"style":530},[1543],{"type":410,"value":1544},"||",{"type":404,"tag":506,"props":1546,"children":1547},{"style":687},[1548],{"type":410,"value":1549}," \"\"\n",{"type":404,"tag":506,"props":1551,"children":1553},{"class":508,"line":1552},22,[1554,1558,1562,1567,1571,1575,1579],{"type":404,"tag":506,"props":1555,"children":1556},{"style":728},[1557],{"type":410,"value":1341},{"type":404,"tag":506,"props":1559,"children":1560},{"style":616},[1561],{"type":410,"value":736},{"type":404,"tag":506,"props":1563,"children":1564},{"style":513},[1565],{"type":410,"value":1566},"originalName",{"type":404,"tag":506,"props":1568,"children":1569},{"style":530},[1570],{"type":410,"value":755},{"type":404,"tag":506,"props":1572,"children":1573},{"style":513},[1574],{"type":410,"value":1508},{"type":404,"tag":506,"props":1576,"children":1577},{"style":616},[1578],{"type":410,"value":652},{"type":404,"tag":506,"props":1580,"children":1581},{"style":519},[1582],{"type":410,"value":778},{"type":404,"tag":506,"props":1584,"children":1586},{"class":508,"line":1585},23,[1587,1592,1596,1600,1605,1609],{"type":404,"tag":506,"props":1588,"children":1589},{"style":525},[1590],{"type":410,"value":1591},"        notify",{"type":404,"tag":506,"props":1593,"children":1594},{"style":616},[1595],{"type":410,"value":619},{"type":404,"tag":506,"props":1597,"children":1598},{"style":687},[1599],{"type":410,"value":690},{"type":404,"tag":506,"props":1601,"children":1602},{"style":693},[1603],{"type":410,"value":1604},"fakedWindowReadout",{"type":404,"tag":506,"props":1606,"children":1607},{"style":687},[1608],{"type":410,"value":690},{"type":404,"tag":506,"props":1610,"children":1611},{"style":616},[1612],{"type":410,"value":662},{"type":404,"tag":506,"props":1614,"children":1616},{"class":508,"line":1615},24,[1617],{"type":404,"tag":506,"props":1618,"children":1619},{"style":519},[1620],{"type":410,"value":1460},{"type":404,"tag":506,"props":1622,"children":1624},{"class":508,"line":1623},25,[1625,1630],{"type":404,"tag":506,"props":1626,"children":1627},{"style":728},[1628],{"type":410,"value":1629},"      return",{"type":404,"tag":506,"props":1631,"children":1632},{"style":513},[1633],{"type":410,"value":1634}," returnedName\n",{"type":404,"tag":506,"props":1636,"children":1638},{"class":508,"line":1637},26,[1639,1644,1648],{"type":404,"tag":506,"props":1640,"children":1641},{"style":519},[1642],{"type":410,"value":1643},"    }",{"type":404,"tag":506,"props":1645,"children":1646},{"style":616},[1647],{"type":410,"value":652},{"type":404,"tag":506,"props":1649,"children":1650},{"style":519},[1651],{"type":410,"value":1652},";\n",{"type":404,"tag":506,"props":1654,"children":1656},{"class":508,"line":1655},27,[1657],{"type":404,"tag":506,"props":1658,"children":1659},{"style":519},[1660],{"type":410,"value":861},{"type":404,"tag":506,"props":1662,"children":1664},{"class":508,"line":1663},28,[1665],{"type":404,"tag":506,"props":1666,"children":1667},{"style":519},[1668],{"type":410,"value":870},{"type":404,"tag":412,"props":1670,"children":1672},{"id":1671},"windowopener",[1673],{"type":410,"value":1674},"window.opener",{"type":404,"tag":418,"props":1676,"children":1677},{},[1678],{"type":410,"value":1679},"在过去的浏览器中，当页面通过超链接或 window.open 的方式从 A 网站跳转到 B 网站时，如果制定了 target 属性却没有指定 rel=\"norefer\" 属性，那么在 B 网站是可以使用 window.opener 获取到 A 网站的部分信息的。也就是说，在 B 网站中可以修改 window.opener.location.href = 'x' 从而让 A 网站自动跳转到 X 网站。如果页面跳转时使用 target=\"__blank\" 打开了新页面，那么用户更加不可能注意到 A 网站的恶意跳转。",{"type":404,"tag":424,"props":1681,"children":1682},{},[1683],{"type":404,"tag":428,"props":1684,"children":1685},{},[1686],{"type":404,"tag":900,"props":1687,"children":1690},{"href":1688,"rel":1689},"https://cwe.mitre.org/data/definitions/1022.html",[904],[1691],{"type":410,"value":1692},"CWE-1022: Use of Web Link to Untrusted Target with window.opener Access",{"type":404,"tag":418,"props":1694,"children":1695},{},[1696],{"type":410,"value":1697},"Blocker 对 window.opener 的防范比较简单，直接返回 null 就完事儿了。考虑到现代浏览器已经修复了这个漏洞，该篡改的设置的值默认是关闭的。",{"type":404,"tag":495,"props":1699,"children":1701},{"className":497,"code":1700,"language":499,"meta":398,"style":398},"{\n  // 修改 Getter 使 window.opener 一直返回 null\n  getterGenerator: function(checker){\n    const temp = {\n      get opener(){\n        return checkerWrapper(checker, this, arguments, function(args, check){\n          const {notify, original} = check\n          const originalOpener = original.call(this, ...args)\n          if (originalOpener !== null){\n            notify(\"fakedWindowReadout\")\n          }\n          return null\n        })\n      }\n    }\n    return Object.getOwnPropertyDescriptor(temp, \"opener\").get\n  },\n  // 修改 Descriptor.Value 使得 window.opener 一直返回 null，\n  // 这是一种兼容，在部分浏览器中，\n  //  window.opener 是通过 value 而不是 getter 获取的值\n  valueGenerator: function({original, notify}){\n    if (original !== null){\n      notify(\"fakedWindowReadout\")\n    }\n    return null\n  }\n}\n",[1702],{"type":404,"tag":502,"props":1703,"children":1704},{"__ignoreMap":398},[1705,1712,1720,1749,1771,1790,1853,1889,1941,1976,2004,2012,2025,2037,2044,2052,2112,2120,2128,2136,2144,2183,2215,2243,2250,2261,2268],{"type":404,"tag":506,"props":1706,"children":1707},{"class":508,"line":509},[1708],{"type":404,"tag":506,"props":1709,"children":1710},{"style":519},[1711],{"type":410,"value":778},{"type":404,"tag":506,"props":1713,"children":1714},{"class":508,"line":584},[1715],{"type":404,"tag":506,"props":1716,"children":1717},{"style":972},[1718],{"type":410,"value":1719},"  // 修改 Getter 使 window.opener 一直返回 null\n",{"type":404,"tag":506,"props":1721,"children":1722},{"class":508,"line":665},[1723,1729,1733,1737,1741,1745],{"type":404,"tag":506,"props":1724,"children":1726},{"style":1725},"--shiki-light:#E2931D;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#F8F8F2",[1727],{"type":410,"value":1728},"  getterGenerator",{"type":404,"tag":506,"props":1730,"children":1731},{"style":519},[1732],{"type":410,"value":560},{"type":404,"tag":506,"props":1734,"children":1735},{"style":536},[1736],{"type":410,"value":539},{"type":404,"tag":506,"props":1738,"children":1739},{"style":519},[1740],{"type":410,"value":619},{"type":404,"tag":506,"props":1742,"children":1743},{"style":563},[1744],{"type":410,"value":1142},{"type":404,"tag":506,"props":1746,"children":1747},{"style":519},[1748],{"type":410,"value":581},{"type":404,"tag":506,"props":1750,"children":1751},{"class":508,"line":724},[1752,1757,1762,1766],{"type":404,"tag":506,"props":1753,"children":1754},{"style":536},[1755],{"type":410,"value":1756},"    const",{"type":404,"tag":506,"props":1758,"children":1759},{"style":593},[1760],{"type":410,"value":1761}," temp",{"type":404,"tag":506,"props":1763,"children":1764},{"style":530},[1765],{"type":410,"value":533},{"type":404,"tag":506,"props":1767,"children":1768},{"style":519},[1769],{"type":410,"value":1770}," {\n",{"type":404,"tag":506,"props":1772,"children":1773},{"class":508,"line":781},[1774,1779,1785],{"type":404,"tag":506,"props":1775,"children":1776},{"style":536},[1777],{"type":410,"value":1778},"      get",{"type":404,"tag":506,"props":1780,"children":1782},{"style":1781},"--shiki-light:#E53935;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[1783],{"type":410,"value":1784}," opener",{"type":404,"tag":506,"props":1786,"children":1787},{"style":519},[1788],{"type":410,"value":1789},"(){\n",{"type":404,"tag":506,"props":1791,"children":1792},{"class":508,"line":818},[1793,1797,1801,1805,1809,1813,1817,1821,1825,1829,1833,1837,1841,1845,1849],{"type":404,"tag":506,"props":1794,"children":1795},{"style":728},[1796],{"type":410,"value":1446},{"type":404,"tag":506,"props":1798,"children":1799},{"style":525},[1800],{"type":410,"value":1133},{"type":404,"tag":506,"props":1802,"children":1803},{"style":616},[1804],{"type":410,"value":619},{"type":404,"tag":506,"props":1806,"children":1807},{"style":513},[1808],{"type":410,"value":1142},{"type":404,"tag":506,"props":1810,"children":1811},{"style":519},[1812],{"type":410,"value":705},{"type":404,"tag":506,"props":1814,"children":1815},{"style":999},[1816],{"type":410,"value":1151},{"type":404,"tag":506,"props":1818,"children":1819},{"style":519},[1820],{"type":410,"value":705},{"type":404,"tag":506,"props":1822,"children":1823},{"style":1014},[1824],{"type":410,"value":1160},{"type":404,"tag":506,"props":1826,"children":1827},{"style":519},[1828],{"type":410,"value":705},{"type":404,"tag":506,"props":1830,"children":1831},{"style":536},[1832],{"type":410,"value":539},{"type":404,"tag":506,"props":1834,"children":1835},{"style":519},[1836],{"type":410,"value":619},{"type":404,"tag":506,"props":1838,"children":1839},{"style":563},[1840],{"type":410,"value":1177},{"type":404,"tag":506,"props":1842,"children":1843},{"style":519},[1844],{"type":410,"value":705},{"type":404,"tag":506,"props":1846,"children":1847},{"style":563},[1848],{"type":410,"value":1186},{"type":404,"tag":506,"props":1850,"children":1851},{"style":519},[1852],{"type":410,"value":581},{"type":404,"tag":506,"props":1854,"children":1855},{"class":508,"line":855},[1856,1861,1865,1869,1873,1877,1881,1885],{"type":404,"tag":506,"props":1857,"children":1858},{"style":536},[1859],{"type":410,"value":1860},"          const",{"type":404,"tag":506,"props":1862,"children":1863},{"style":519},[1864],{"type":410,"value":1203},{"type":404,"tag":506,"props":1866,"children":1867},{"style":593},[1868],{"type":410,"value":1208},{"type":404,"tag":506,"props":1870,"children":1871},{"style":519},[1872],{"type":410,"value":705},{"type":404,"tag":506,"props":1874,"children":1875},{"style":593},[1876],{"type":410,"value":1217},{"type":404,"tag":506,"props":1878,"children":1879},{"style":519},[1880],{"type":410,"value":657},{"type":404,"tag":506,"props":1882,"children":1883},{"style":530},[1884],{"type":410,"value":533},{"type":404,"tag":506,"props":1886,"children":1887},{"style":513},[1888],{"type":410,"value":1239},{"type":404,"tag":506,"props":1890,"children":1891},{"class":508,"line":864},[1892,1896,1901,1905,1909,1913,1917,1921,1925,1929,1933,1937],{"type":404,"tag":506,"props":1893,"children":1894},{"style":536},[1895],{"type":410,"value":1860},{"type":404,"tag":506,"props":1897,"children":1898},{"style":593},[1899],{"type":410,"value":1900}," originalOpener",{"type":404,"tag":506,"props":1902,"children":1903},{"style":530},[1904],{"type":410,"value":533},{"type":404,"tag":506,"props":1906,"children":1907},{"style":513},[1908],{"type":410,"value":1217},{"type":404,"tag":506,"props":1910,"children":1911},{"style":519},[1912],{"type":410,"value":522},{"type":404,"tag":506,"props":1914,"children":1915},{"style":525},[1916],{"type":410,"value":992},{"type":404,"tag":506,"props":1918,"children":1919},{"style":616},[1920],{"type":410,"value":619},{"type":404,"tag":506,"props":1922,"children":1923},{"style":999},[1924],{"type":410,"value":1002},{"type":404,"tag":506,"props":1926,"children":1927},{"style":519},[1928],{"type":410,"value":705},{"type":404,"tag":506,"props":1930,"children":1931},{"style":530},[1932],{"type":410,"value":1011},{"type":404,"tag":506,"props":1934,"children":1935},{"style":513},[1936],{"type":410,"value":1177},{"type":404,"tag":506,"props":1938,"children":1939},{"style":616},[1940],{"type":410,"value":662},{"type":404,"tag":506,"props":1942,"children":1943},{"class":508,"line":1317},[1944,1949,1953,1958,1962,1968,1972],{"type":404,"tag":506,"props":1945,"children":1946},{"style":728},[1947],{"type":410,"value":1948},"          if",{"type":404,"tag":506,"props":1950,"children":1951},{"style":616},[1952],{"type":410,"value":736},{"type":404,"tag":506,"props":1954,"children":1955},{"style":513},[1956],{"type":410,"value":1957},"originalOpener",{"type":404,"tag":506,"props":1959,"children":1960},{"style":530},[1961],{"type":410,"value":755},{"type":404,"tag":506,"props":1963,"children":1965},{"style":1964},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[1966],{"type":410,"value":1967}," null",{"type":404,"tag":506,"props":1969,"children":1970},{"style":616},[1971],{"type":410,"value":652},{"type":404,"tag":506,"props":1973,"children":1974},{"style":519},[1975],{"type":410,"value":778},{"type":404,"tag":506,"props":1977,"children":1978},{"class":508,"line":1326},[1979,1984,1988,1992,1996,2000],{"type":404,"tag":506,"props":1980,"children":1981},{"style":525},[1982],{"type":410,"value":1983},"            notify",{"type":404,"tag":506,"props":1985,"children":1986},{"style":616},[1987],{"type":410,"value":619},{"type":404,"tag":506,"props":1989,"children":1990},{"style":687},[1991],{"type":410,"value":690},{"type":404,"tag":506,"props":1993,"children":1994},{"style":693},[1995],{"type":410,"value":1604},{"type":404,"tag":506,"props":1997,"children":1998},{"style":687},[1999],{"type":410,"value":690},{"type":404,"tag":506,"props":2001,"children":2002},{"style":616},[2003],{"type":410,"value":662},{"type":404,"tag":506,"props":2005,"children":2006},{"class":508,"line":1335},[2007],{"type":404,"tag":506,"props":2008,"children":2009},{"style":519},[2010],{"type":410,"value":2011},"          }\n",{"type":404,"tag":506,"props":2013,"children":2014},{"class":508,"line":1349},[2015,2020],{"type":404,"tag":506,"props":2016,"children":2017},{"style":728},[2018],{"type":410,"value":2019},"          return",{"type":404,"tag":506,"props":2021,"children":2022},{"style":1964},[2023],{"type":410,"value":2024}," null\n",{"type":404,"tag":506,"props":2026,"children":2027},{"class":508,"line":1380},[2028,2033],{"type":404,"tag":506,"props":2029,"children":2030},{"style":519},[2031],{"type":410,"value":2032},"        }",{"type":404,"tag":506,"props":2034,"children":2035},{"style":616},[2036],{"type":410,"value":662},{"type":404,"tag":506,"props":2038,"children":2039},{"class":508,"line":1427},[2040],{"type":404,"tag":506,"props":2041,"children":2042},{"style":519},[2043],{"type":410,"value":1460},{"type":404,"tag":506,"props":2045,"children":2046},{"class":508,"line":1440},[2047],{"type":404,"tag":506,"props":2048,"children":2049},{"style":519},[2050],{"type":410,"value":2051},"    }\n",{"type":404,"tag":506,"props":2053,"children":2054},{"class":508,"line":1454},[2055,2059,2064,2068,2073,2077,2082,2086,2090,2095,2099,2103,2107],{"type":404,"tag":506,"props":2056,"children":2057},{"style":728},[2058],{"type":410,"value":1128},{"type":404,"tag":506,"props":2060,"children":2061},{"style":513},[2062],{"type":410,"value":2063}," Object",{"type":404,"tag":506,"props":2065,"children":2066},{"style":519},[2067],{"type":410,"value":522},{"type":404,"tag":506,"props":2069,"children":2070},{"style":525},[2071],{"type":410,"value":2072},"getOwnPropertyDescriptor",{"type":404,"tag":506,"props":2074,"children":2075},{"style":616},[2076],{"type":410,"value":619},{"type":404,"tag":506,"props":2078,"children":2079},{"style":513},[2080],{"type":410,"value":2081},"temp",{"type":404,"tag":506,"props":2083,"children":2084},{"style":519},[2085],{"type":410,"value":705},{"type":404,"tag":506,"props":2087,"children":2088},{"style":687},[2089],{"type":410,"value":760},{"type":404,"tag":506,"props":2091,"children":2092},{"style":693},[2093],{"type":410,"value":2094},"opener",{"type":404,"tag":506,"props":2096,"children":2097},{"style":687},[2098],{"type":410,"value":690},{"type":404,"tag":506,"props":2100,"children":2101},{"style":616},[2102],{"type":410,"value":652},{"type":404,"tag":506,"props":2104,"children":2105},{"style":519},[2106],{"type":410,"value":522},{"type":404,"tag":506,"props":2108,"children":2109},{"style":513},[2110],{"type":410,"value":2111},"get\n",{"type":404,"tag":506,"props":2113,"children":2114},{"class":508,"line":1463},[2115],{"type":404,"tag":506,"props":2116,"children":2117},{"style":519},[2118],{"type":410,"value":2119},"  },\n",{"type":404,"tag":506,"props":2121,"children":2122},{"class":508,"line":1471},[2123],{"type":404,"tag":506,"props":2124,"children":2125},{"style":972},[2126],{"type":410,"value":2127},"  // 修改 Descriptor.Value 使得 window.opener 一直返回 null，\n",{"type":404,"tag":506,"props":2129,"children":2130},{"class":508,"line":1480},[2131],{"type":404,"tag":506,"props":2132,"children":2133},{"style":972},[2134],{"type":410,"value":2135},"  // 这是一种兼容，在部分浏览器中，\n",{"type":404,"tag":506,"props":2137,"children":2138},{"class":508,"line":1489},[2139],{"type":404,"tag":506,"props":2140,"children":2141},{"style":972},[2142],{"type":410,"value":2143},"  //  window.opener 是通过 value 而不是 getter 获取的值\n",{"type":404,"tag":506,"props":2145,"children":2146},{"class":508,"line":1498},[2147,2152,2156,2160,2164,2169,2173,2178],{"type":404,"tag":506,"props":2148,"children":2149},{"style":1725},[2150],{"type":410,"value":2151},"  valueGenerator",{"type":404,"tag":506,"props":2153,"children":2154},{"style":519},[2155],{"type":410,"value":560},{"type":404,"tag":506,"props":2157,"children":2158},{"style":536},[2159],{"type":410,"value":539},{"type":404,"tag":506,"props":2161,"children":2162},{"style":519},[2163],{"type":410,"value":549},{"type":404,"tag":506,"props":2165,"children":2166},{"style":563},[2167],{"type":410,"value":2168},"original",{"type":404,"tag":506,"props":2170,"children":2171},{"style":519},[2172],{"type":410,"value":705},{"type":404,"tag":506,"props":2174,"children":2175},{"style":563},[2176],{"type":410,"value":2177}," notify",{"type":404,"tag":506,"props":2179,"children":2180},{"style":519},[2181],{"type":410,"value":2182},"}){\n",{"type":404,"tag":506,"props":2184,"children":2185},{"class":508,"line":1552},[2186,2191,2195,2199,2203,2207,2211],{"type":404,"tag":506,"props":2187,"children":2188},{"style":728},[2189],{"type":410,"value":2190},"    if",{"type":404,"tag":506,"props":2192,"children":2193},{"style":616},[2194],{"type":410,"value":736},{"type":404,"tag":506,"props":2196,"children":2197},{"style":513},[2198],{"type":410,"value":2168},{"type":404,"tag":506,"props":2200,"children":2201},{"style":530},[2202],{"type":410,"value":755},{"type":404,"tag":506,"props":2204,"children":2205},{"style":1964},[2206],{"type":410,"value":1967},{"type":404,"tag":506,"props":2208,"children":2209},{"style":616},[2210],{"type":410,"value":652},{"type":404,"tag":506,"props":2212,"children":2213},{"style":519},[2214],{"type":410,"value":778},{"type":404,"tag":506,"props":2216,"children":2217},{"class":508,"line":1585},[2218,2223,2227,2231,2235,2239],{"type":404,"tag":506,"props":2219,"children":2220},{"style":525},[2221],{"type":410,"value":2222},"      notify",{"type":404,"tag":506,"props":2224,"children":2225},{"style":616},[2226],{"type":410,"value":619},{"type":404,"tag":506,"props":2228,"children":2229},{"style":687},[2230],{"type":410,"value":690},{"type":404,"tag":506,"props":2232,"children":2233},{"style":693},[2234],{"type":410,"value":1604},{"type":404,"tag":506,"props":2236,"children":2237},{"style":687},[2238],{"type":410,"value":690},{"type":404,"tag":506,"props":2240,"children":2241},{"style":616},[2242],{"type":410,"value":662},{"type":404,"tag":506,"props":2244,"children":2245},{"class":508,"line":1615},[2246],{"type":404,"tag":506,"props":2247,"children":2248},{"style":519},[2249],{"type":410,"value":2051},{"type":404,"tag":506,"props":2251,"children":2252},{"class":508,"line":1623},[2253,2257],{"type":404,"tag":506,"props":2254,"children":2255},{"style":728},[2256],{"type":410,"value":1128},{"type":404,"tag":506,"props":2258,"children":2259},{"style":1964},[2260],{"type":410,"value":2024},{"type":404,"tag":506,"props":2262,"children":2263},{"class":508,"line":1637},[2264],{"type":404,"tag":506,"props":2265,"children":2266},{"style":519},[2267],{"type":410,"value":861},{"type":404,"tag":506,"props":2269,"children":2270},{"class":508,"line":1655},[2271],{"type":404,"tag":506,"props":2272,"children":2273},{"style":519},[2274],{"type":410,"value":870},{"type":404,"tag":412,"props":2276,"children":2278},{"id":2277},"canvas",[2279],{"type":410,"value":2280},"Canvas",{"type":404,"tag":418,"props":2282,"children":2283},{},[2284],{"type":410,"value":2285},"伪造了 getContext、getDataURL 等 API，并替代了原本正常的 API。",{"type":404,"tag":412,"props":2287,"children":2289},{"id":2288},"相关链接",[2290],{"type":410,"value":2288},{"type":404,"tag":424,"props":2292,"children":2293},{},[2294],{"type":404,"tag":428,"props":2295,"children":2296},{},[2297],{"type":404,"tag":900,"props":2298,"children":2301},{"href":2299,"rel":2300},"https://github.com/kkapsner/CanvasBlocker",[904],[2302],{"type":410,"value":2303},"CanvasBlocker",{"type":404,"tag":2305,"props":2306,"children":2307},"style",{},[2308],{"type":410,"value":2309},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":398,"searchDepth":584,"depth":584,"links":2311},[2312,2313,2314,2317,2318,2319],{"id":414,"depth":584,"text":414},{"id":480,"depth":584,"text":483},{"id":873,"depth":584,"text":452,"children":2315},[2316],{"id":884,"depth":665,"text":887},{"id":1671,"depth":584,"text":1674},{"id":2277,"depth":584,"text":2280},{"id":2288,"depth":584,"text":2288},"markdown","content:8.source-code:_fingerprint:canvas-blocker.md","content","8.source-code/_fingerprint/canvas-blocker.md","8.source-code/_fingerprint/canvas-blocker","md",[2327,2330],{"_path":2328,"title":2329,"description":398},"/source-code/_es/object-assign","Object.prototype.assign",{"_path":2331,"title":2332,"description":398},"/source-code/_js/element-plus","ElementPlus",1741604970475]