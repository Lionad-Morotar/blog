[{"data":1,"prerenderedAt":2322},["Reactive",2],{"navigation":3,"/source-code/_fingerprint/canvas-blocker":383,"/source-code/_fingerprint/canvas-blocker-surround":2315},[4,32,80,96,123,129,135,366,372,378],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🌃 长夜梦","/flows/long-night-dream",{"title":15,"_path":16},"🌌 万物联结与幸福感","/flows/everything",{"title":18,"_path":19},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":21,"_path":22},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":24,"_path":25},"🌧️ 我的腼腆","/flows/shy",{"title":27,"_path":28},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":30,"_path":31},"📝 心流归档","/flows/fold",{"title":33,"_path":34,"children":35},"技术博客 / Coder","/articles",[36,38,41,44,47,50,53,56,59,62,65,68,71,74,77],{"title":37,"_path":34},"🦁 为什么我要写博客",{"title":39,"_path":40},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":42,"_path":43},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":45,"_path":46},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":48,"_path":49},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":51,"_path":52},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":54,"_path":55},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":57,"_path":58},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":60,"_path":61},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":63,"_path":64},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":66,"_path":67},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":69,"_path":70},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":72,"_path":73},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":75,"_path":76},"🚝 四十二篇系列","/articles/fourty-two",{"title":78,"_path":79},"📝 技术博客归档","/articles/fold",{"title":81,"_path":82,"children":83},"造物 / Make","/tools",[84,87,90,93],{"title":85,"_path":86},"🌐 AnySort","/tools/anysort",{"title":88,"_path":89},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":91,"_path":92},"👓 Crapto","/tools/crypto-inline",{"title":94,"_path":95},"🖨️ any-to-base64","/tools/any-to-base64",{"title":97,"_path":98,"children":99},"吉他剧场 / Music","/music",[100,102,105,108,111,114,117,120],{"title":101,"_path":98},"🎸 FingerStyle！",{"title":103,"_path":104},"🌬️ 等待的风","/music/wind",{"title":106,"_path":107},"💕 约定的海洋","/music/ocean",{"title":109,"_path":110},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":112,"_path":113},"🌏 残酷天使的行动纲领","/music/eva",{"title":115,"_path":116},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":118,"_path":119},"🍷 Wu Wei","/music/wu-wei",{"title":121,"_path":122},"🌅 无题","/music/untitled",{"title":124,"_path":125,"children":126},"画点什么 / Paint","/paint",[127],{"title":128,"_path":125},"🚧 正在施工",{"title":130,"_path":131,"children":132},"知识地图 / Maps","/maps",[133],{"title":134,"_path":131},"🏁 知识地图",{"title":136,"_path":137,"children":138},"零散的笔记 / Gists","/gists",[139,141,144,147,150,153,156,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255,258,261,264,267,270,273,276,279,282,285,288,291,294,297,300,303,306,309,312,315,318,321,324,327,330,333,336,339,342,345,348,351,354,357,360,363],{"title":140,"_path":137},"🧊 Gists",{"title":142,"_path":143},"网站的可访问性","/gists/accessibility",{"title":145,"_path":146},"图片模糊","/gists/blur",{"title":148,"_path":149},"渲染相关笔记","/gists/c4d",{"title":151,"_path":152},"CDN 问题记录","/gists/cdn",{"title":154,"_path":155},"消毒剂","/gists/cleaner",{"title":157,"_path":158},"Windows Command","/gists/cmd",{"title":160,"_path":161},"Command","/gists/command",{"title":163,"_path":164},"复杂科学","/gists/complexity-science",{"title":166,"_path":167},"宇宙","/gists/cosmos",{"title":169,"_path":170},"C++","/gists/cpp",{"title":172,"_path":173},"Data Structure","/gists/data-structure",{"title":175,"_path":176},"DEPRESSION","/gists/depression",{"title":178,"_path":179},"设计模式","/gists/design-patterns",{"title":181,"_path":182},"Developer Experience","/gists/developer-experience",{"title":184,"_path":185},"Device Metrics","/gists/device-metrix",{"title":187,"_path":188},"ECMAScript Language Specification","/gists/ecmascript-specification",{"title":190,"_path":191},"正则表达式","/gists/eegex",{"title":193,"_path":194},"Emoji","/gists/emoji",{"title":196,"_path":197},"工程","/gists/engineering",{"title":199,"_path":200},"熵","/gists/entropy",{"title":202,"_path":203},"Environment","/gists/environment",{"title":205,"_path":206},"Erlang","/gists/erlang",{"title":208,"_path":209},"逃离塔克夫","/gists/escape-from-tarkov",{"title":211,"_path":212},"ESNext (ES6-ES11)","/gists/esnext",{"title":214,"_path":215},"Eval！","/gists/eval",{"title":217,"_path":218},"Flutter","/gists/flutter",{"title":220,"_path":221},"字体","/gists/font",{"title":223,"_path":224},"JS 函数式编程","/gists/functional",{"title":226,"_path":227},"Google C++ Standard","/gists/google-cpp-standard",{"title":229,"_path":230},"双向链接完全体","/gists/graph",{"title":232,"_path":233},"Hardwares","/gists/hardwares",{"title":235,"_path":236},"哈希冲突","/gists/hash-collision",{"title":238,"_path":239},"信息设计","/gists/information-design",{"title":241,"_path":242},"InstantPage","/gists/instant.page",{"title":244,"_path":245},"ISUX 遇见大数据可视化系列","/gists/isux-data-visualization",{"title":247,"_path":248},"KVStore","/gists/key-value-db",{"title":250,"_path":251},"Kubernetes","/gists/kubernetes",{"title":253,"_path":254},"Makefile","/gists/makefile",{"title":256,"_path":257},"Markdown Inline Style","/gists/markdown-nice",{"title":259,"_path":260},"小程序","/gists/miniapp",{"title":262,"_path":263},"减小页面快照体积","/gists/minify-html",{"title":265,"_path":266},"mklink","/gists/mklink",{"title":268,"_path":269},"Mock","/gists/mock",{"title":271,"_path":272},"多端应用","/gists/multy-end-app",{"title":274,"_path":275},"神经科学","/gists/neuroscience",{"title":277,"_path":278},"OO","/gists/oo",{"title":280,"_path":281},"Opinioned Personal Folder","/gists/opinioned-personal-folder",{"title":283,"_path":284},"人物","/gists/person",{"title":286,"_path":287},"PInvoke","/gists/pinvoke",{"title":289,"_path":290},"像素","/gists/pixel",{"title":292,"_path":293},"PowerShell","/gists/powershell",{"title":295,"_path":296},"量子","/gists/quantum",{"title":298,"_path":299},"保持好奇心","/gists/questions",{"title":301,"_path":302},"React Native","/gists/react-native",{"title":304,"_path":305},"博客改版碰到的浏览器平滑滚动问题","/gists/scroll",{"title":307,"_path":308},"SEO","/gists/seo",{"title":310,"_path":311},"Shader","/gists/shader",{"title":313,"_path":314},"Shape Up","/gists/shape-up",{"title":316,"_path":317},"睡觉","/gists/sleep",{"title":319,"_path":320},"States","/gists/states",{"title":322,"_path":323},"Storage","/gists/storage",{"title":325,"_path":326},"音视频流处理","/gists/stream-cli",{"title":328,"_path":329},"Symbol","/gists/symbol",{"title":331,"_path":332},"系统论","/gists/systems-theory",{"title":334,"_path":335},"Taro","/gists/taro",{"title":337,"_path":338},"任务切片","/gists/task-slice",{"title":340,"_path":341},"技术偏好","/gists/tech-dudge",{"title":343,"_path":344},"Untitled","/gists/untitled",{"title":346,"_path":347},"可变字体","/gists/variable-font",{"title":349,"_path":350},"视觉错觉","/gists/visual-illusion",{"title":352,"_path":353},"SS(SSR)","/gists/vpn",{"title":355,"_path":356},"VS Code 插件开发","/gists/vscode-plugin",{"title":358,"_path":359},"Web Components","/gists/web-components",{"title":361,"_path":362},"Windows","/gists/windows",{"title":364,"_path":365},"查缺补漏","/gists/wrong",{"title":367,"_path":368,"children":369},"代码笔记 / Gists","/source-code",[370],{"title":371,"_path":368},"🚄 代码笔记",{"title":373,"_path":374,"children":375},"我 / Abount","/hire",[376],{"title":377,"_path":374},"📬 技术简历",{"title":379,"_path":380,"children":381},"todo","/todo",[382],{"title":379,"_path":380},{"_path":384,"_dir":385,"_draft":386,"_partial":387,"_locale":388,"title":389,"description":388,"body":390,"_type":2310,"_id":2311,"_source":2312,"_file":2313,"_extension":2314},"/source-code/_fingerprint/canvas-blocker","_fingerprint",false,true,"","Canvas Blocker",{"type":391,"children":392,"toc":2300},"root",[393,401,407,413,463,468,474,479,484,861,866,871,878,883,908,913,1071,1076,1659,1665,1670,1683,1688,2265,2271,2276,2281,2294],{"type":394,"tag":395,"props":396,"children":398},"element","h1",{"id":397},"canvas-blocker",[399],{"type":400,"value":389},"text",{"type":394,"tag":402,"props":403,"children":405},"h2",{"id":404},"前言",[406],{"type":400,"value":404},{"type":394,"tag":408,"props":409,"children":410},"p",{},[411],{"type":400,"value":412},"最近在看一些反反爬相关的东西，期间找到了 Canvas Blocker 这个神奇的库。他是一个浏览器扩展，声称能拦截以下几种类型的指纹追踪：",{"type":394,"tag":414,"props":415,"children":416},"ul",{},[417,423,428,433,438,443,448,453,458],{"type":394,"tag":418,"props":419,"children":420},"li",{},[421],{"type":400,"value":422},"Canvas 2D",{"type":394,"tag":418,"props":424,"children":425},{},[426],{"type":400,"value":427},"WebGL",{"type":394,"tag":418,"props":429,"children":430},{},[431],{"type":400,"value":432},"Web Audio",{"type":394,"tag":418,"props":434,"children":435},{},[436],{"type":400,"value":437},"History",{"type":394,"tag":418,"props":439,"children":440},{},[441],{"type":400,"value":442},"Window",{"type":394,"tag":418,"props":444,"children":445},{},[446],{"type":400,"value":447},"DOMRect",{"type":394,"tag":418,"props":449,"children":450},{},[451],{"type":400,"value":452},"TextMetrics",{"type":394,"tag":418,"props":454,"children":455},{},[456],{"type":400,"value":457},"Navigator",{"type":394,"tag":418,"props":459,"children":460},{},[461],{"type":400,"value":462},"Screen",{"type":394,"tag":408,"props":464,"children":465},{},[466],{"type":400,"value":467},"让我们大致拆解一下，看看其原理是什么。",{"type":394,"tag":402,"props":469,"children":471},{"id":470},"intercept",[472],{"type":400,"value":473},"Intercept",{"type":394,"tag":408,"props":475,"children":476},{},[477],{"type":400,"value":478},"Blocker 最主要的思路就是用伪造的函数篡改属性的 Getter 以及某些 API。",{"type":394,"tag":408,"props":480,"children":481},{},[482],{"type":400,"value":483},"篡改的入口在 intercept.js 中，先根据页面 URL 检查当前页面是否允许篡改，允许的话就通过 interceptFns、interceptGetters 实施具体步骤。",{"type":394,"tag":485,"props":486,"children":490},"pre",{"className":487,"code":488,"language":489,"meta":388,"style":388},"language-js shiki shiki-themes material-theme-lighter github-light github-dark monokai","scope.intercept = function intercept({subject: windowToProcess}, apis){\n  const siteStatus = apis.check({url: getURL(windowToProcess)})\n  logging.verbose(\"status for page\", windowToProcess, siteStatus)\n  if (siteStatus.mode !== \"allow\"){\n    interceptFunctions(windowToProcess, siteStatus, apis)\n    interceptGetters(windowToProcess, siteStatus, apis)\n  }\n}\n","js",[491],{"type":394,"tag":492,"props":493,"children":494},"code",{"__ignoreMap":388},[495,572,653,712,769,806,843,852],{"type":394,"tag":496,"props":497,"children":500},"span",{"class":498,"line":499},"line",1,[501,507,513,518,524,530,535,540,546,551,557,562,567],{"type":394,"tag":496,"props":502,"children":504},{"style":503},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[505],{"type":400,"value":506},"scope",{"type":394,"tag":496,"props":508,"children":510},{"style":509},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[511],{"type":400,"value":512},".",{"type":394,"tag":496,"props":514,"children":516},{"style":515},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[517],{"type":400,"value":470},{"type":394,"tag":496,"props":519,"children":521},{"style":520},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[522],{"type":400,"value":523}," =",{"type":394,"tag":496,"props":525,"children":527},{"style":526},"--shiki-light:#9C3EDA;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#66D9EF;--shiki-light-font-style:inherit;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[528],{"type":400,"value":529}," function",{"type":394,"tag":496,"props":531,"children":532},{"style":515},[533],{"type":400,"value":534}," intercept",{"type":394,"tag":496,"props":536,"children":537},{"style":509},[538],{"type":400,"value":539},"({",{"type":394,"tag":496,"props":541,"children":543},{"style":542},"--shiki-light:#E53935;--shiki-default:#E36209;--shiki-dark:#FFAB70;--shiki-sepia:#F8F8F2",[544],{"type":400,"value":545},"subject",{"type":394,"tag":496,"props":547,"children":548},{"style":509},[549],{"type":400,"value":550},":",{"type":394,"tag":496,"props":552,"children":554},{"style":553},"--shiki-light:#90A4AE;--shiki-default:#E36209;--shiki-dark:#FFAB70;--shiki-sepia:#FD971F;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[555],{"type":400,"value":556}," windowToProcess",{"type":394,"tag":496,"props":558,"children":559},{"style":509},[560],{"type":400,"value":561},"},",{"type":394,"tag":496,"props":563,"children":564},{"style":553},[565],{"type":400,"value":566}," apis",{"type":394,"tag":496,"props":568,"children":569},{"style":509},[570],{"type":400,"value":571},"){\n",{"type":394,"tag":496,"props":573,"children":575},{"class":498,"line":574},2,[576,581,587,591,595,599,604,610,615,620,624,629,633,638,643,648],{"type":394,"tag":496,"props":577,"children":578},{"style":526},[579],{"type":400,"value":580},"  const",{"type":394,"tag":496,"props":582,"children":584},{"style":583},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#F8F8F2",[585],{"type":400,"value":586}," siteStatus",{"type":394,"tag":496,"props":588,"children":589},{"style":520},[590],{"type":400,"value":523},{"type":394,"tag":496,"props":592,"children":593},{"style":503},[594],{"type":400,"value":566},{"type":394,"tag":496,"props":596,"children":597},{"style":509},[598],{"type":400,"value":512},{"type":394,"tag":496,"props":600,"children":601},{"style":515},[602],{"type":400,"value":603},"check",{"type":394,"tag":496,"props":605,"children":607},{"style":606},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[608],{"type":400,"value":609},"(",{"type":394,"tag":496,"props":611,"children":612},{"style":509},[613],{"type":400,"value":614},"{",{"type":394,"tag":496,"props":616,"children":617},{"style":606},[618],{"type":400,"value":619},"url",{"type":394,"tag":496,"props":621,"children":622},{"style":509},[623],{"type":400,"value":550},{"type":394,"tag":496,"props":625,"children":626},{"style":515},[627],{"type":400,"value":628}," getURL",{"type":394,"tag":496,"props":630,"children":631},{"style":606},[632],{"type":400,"value":609},{"type":394,"tag":496,"props":634,"children":635},{"style":503},[636],{"type":400,"value":637},"windowToProcess",{"type":394,"tag":496,"props":639,"children":640},{"style":606},[641],{"type":400,"value":642},")",{"type":394,"tag":496,"props":644,"children":645},{"style":509},[646],{"type":400,"value":647},"}",{"type":394,"tag":496,"props":649,"children":650},{"style":606},[651],{"type":400,"value":652},")\n",{"type":394,"tag":496,"props":654,"children":656},{"class":498,"line":655},3,[657,662,666,671,675,681,687,691,696,700,704,708],{"type":394,"tag":496,"props":658,"children":659},{"style":503},[660],{"type":400,"value":661},"  logging",{"type":394,"tag":496,"props":663,"children":664},{"style":509},[665],{"type":400,"value":512},{"type":394,"tag":496,"props":667,"children":668},{"style":515},[669],{"type":400,"value":670},"verbose",{"type":394,"tag":496,"props":672,"children":673},{"style":606},[674],{"type":400,"value":609},{"type":394,"tag":496,"props":676,"children":678},{"style":677},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[679],{"type":400,"value":680},"\"",{"type":394,"tag":496,"props":682,"children":684},{"style":683},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[685],{"type":400,"value":686},"status for page",{"type":394,"tag":496,"props":688,"children":689},{"style":677},[690],{"type":400,"value":680},{"type":394,"tag":496,"props":692,"children":693},{"style":509},[694],{"type":400,"value":695},",",{"type":394,"tag":496,"props":697,"children":698},{"style":503},[699],{"type":400,"value":556},{"type":394,"tag":496,"props":701,"children":702},{"style":509},[703],{"type":400,"value":695},{"type":394,"tag":496,"props":705,"children":706},{"style":503},[707],{"type":400,"value":586},{"type":394,"tag":496,"props":709,"children":710},{"style":606},[711],{"type":400,"value":652},{"type":394,"tag":496,"props":713,"children":715},{"class":498,"line":714},4,[716,722,727,732,736,741,746,751,756,760,764],{"type":394,"tag":496,"props":717,"children":719},{"style":718},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:inherit",[720],{"type":400,"value":721},"  if",{"type":394,"tag":496,"props":723,"children":724},{"style":606},[725],{"type":400,"value":726}," (",{"type":394,"tag":496,"props":728,"children":729},{"style":503},[730],{"type":400,"value":731},"siteStatus",{"type":394,"tag":496,"props":733,"children":734},{"style":509},[735],{"type":400,"value":512},{"type":394,"tag":496,"props":737,"children":738},{"style":503},[739],{"type":400,"value":740},"mode",{"type":394,"tag":496,"props":742,"children":743},{"style":520},[744],{"type":400,"value":745}," !==",{"type":394,"tag":496,"props":747,"children":748},{"style":677},[749],{"type":400,"value":750}," \"",{"type":394,"tag":496,"props":752,"children":753},{"style":683},[754],{"type":400,"value":755},"allow",{"type":394,"tag":496,"props":757,"children":758},{"style":677},[759],{"type":400,"value":680},{"type":394,"tag":496,"props":761,"children":762},{"style":606},[763],{"type":400,"value":642},{"type":394,"tag":496,"props":765,"children":766},{"style":509},[767],{"type":400,"value":768},"{\n",{"type":394,"tag":496,"props":770,"children":772},{"class":498,"line":771},5,[773,778,782,786,790,794,798,802],{"type":394,"tag":496,"props":774,"children":775},{"style":515},[776],{"type":400,"value":777},"    interceptFunctions",{"type":394,"tag":496,"props":779,"children":780},{"style":606},[781],{"type":400,"value":609},{"type":394,"tag":496,"props":783,"children":784},{"style":503},[785],{"type":400,"value":637},{"type":394,"tag":496,"props":787,"children":788},{"style":509},[789],{"type":400,"value":695},{"type":394,"tag":496,"props":791,"children":792},{"style":503},[793],{"type":400,"value":586},{"type":394,"tag":496,"props":795,"children":796},{"style":509},[797],{"type":400,"value":695},{"type":394,"tag":496,"props":799,"children":800},{"style":503},[801],{"type":400,"value":566},{"type":394,"tag":496,"props":803,"children":804},{"style":606},[805],{"type":400,"value":652},{"type":394,"tag":496,"props":807,"children":809},{"class":498,"line":808},6,[810,815,819,823,827,831,835,839],{"type":394,"tag":496,"props":811,"children":812},{"style":515},[813],{"type":400,"value":814},"    interceptGetters",{"type":394,"tag":496,"props":816,"children":817},{"style":606},[818],{"type":400,"value":609},{"type":394,"tag":496,"props":820,"children":821},{"style":503},[822],{"type":400,"value":637},{"type":394,"tag":496,"props":824,"children":825},{"style":509},[826],{"type":400,"value":695},{"type":394,"tag":496,"props":828,"children":829},{"style":503},[830],{"type":400,"value":586},{"type":394,"tag":496,"props":832,"children":833},{"style":509},[834],{"type":400,"value":695},{"type":394,"tag":496,"props":836,"children":837},{"style":503},[838],{"type":400,"value":566},{"type":394,"tag":496,"props":840,"children":841},{"style":606},[842],{"type":400,"value":652},{"type":394,"tag":496,"props":844,"children":846},{"class":498,"line":845},7,[847],{"type":394,"tag":496,"props":848,"children":849},{"style":509},[850],{"type":400,"value":851},"  }\n",{"type":394,"tag":496,"props":853,"children":855},{"class":498,"line":854},8,[856],{"type":394,"tag":496,"props":857,"children":858},{"style":509},[859],{"type":400,"value":860},"}\n",{"type":394,"tag":402,"props":862,"children":864},{"id":863},"window",[865],{"type":400,"value":442},{"type":394,"tag":408,"props":867,"children":868},{},[869],{"type":400,"value":870},"Blocker 篡改了 Window 的两个属性，window.name 和 window.opener。这两个属性和指纹没有直接关系，但却是一种“帮助函数”，能够帮助恶意网站追踪指纹以及窃取隐私。",{"type":394,"tag":872,"props":873,"children":875},"h3",{"id":874},"windowname",[876],{"type":400,"value":877},"window.name",{"type":394,"tag":408,"props":879,"children":880},{},[881],{"type":400,"value":882},"在过去的浏览器中，window.name 能够跨站点传输数据，并且能逃逸同源策略。从 Firefox 88 开始，用户通过点击超链接跳转到新页面时，window.name 将被置空，不过为了不造成更大的破坏，当用户从跳转后页面回到之前页面时，window.name 会被还原。",{"type":394,"tag":414,"props":884,"children":885},{},[886,898],{"type":394,"tag":418,"props":887,"children":888},{},[889],{"type":394,"tag":890,"props":891,"children":895},"a",{"href":892,"rel":893},"https://blog.mozilla.org/security/2021/04/19/firefox-88-combats-window-name-privacy-abuses/",[894],"nofollow",[896],{"type":400,"value":897},"Firefox 88 combats window.name privacy abuses",{"type":394,"tag":418,"props":899,"children":900},{},[901],{"type":394,"tag":890,"props":902,"children":905},{"href":903,"rel":904},"https://wpt.fyi/results/html/browsers/windows/clear-window-name.https.html?label=master&label=experimental&aligned",[894],[906],{"type":400,"value":907},"clear-window-name@web-platform-tests",{"type":394,"tag":408,"props":909,"children":910},{},[911],{"type":400,"value":912},"在使用 JS 设置 window.name 时，Blcoker 会记录下设置的值。original.call 调用原有的 window.name setter；windowNames 只做记录，稍后会用到。",{"type":394,"tag":485,"props":914,"children":916},{"className":487,"code":915,"language":489,"meta":388,"style":388},"{\n  set name(name){\n    // 调用原有 setting 设置 window.name\n    original.call(this, ...arguments)\n    // 把 name 记录下来\n    windowNames.set(this, name)\n  }\n}\n",[917],{"type":394,"tag":492,"props":918,"children":919},{"__ignoreMap":388},[920,927,957,966,1012,1020,1057,1064],{"type":394,"tag":496,"props":921,"children":922},{"class":498,"line":499},[923],{"type":394,"tag":496,"props":924,"children":925},{"style":509},[926],{"type":400,"value":768},{"type":394,"tag":496,"props":928,"children":929},{"class":498,"line":574},[930,935,940,944,949,953],{"type":394,"tag":496,"props":931,"children":932},{"style":503},[933],{"type":400,"value":934},"  set",{"type":394,"tag":496,"props":936,"children":937},{"style":515},[938],{"type":400,"value":939}," name",{"type":394,"tag":496,"props":941,"children":942},{"style":606},[943],{"type":400,"value":609},{"type":394,"tag":496,"props":945,"children":946},{"style":503},[947],{"type":400,"value":948},"name",{"type":394,"tag":496,"props":950,"children":951},{"style":606},[952],{"type":400,"value":642},{"type":394,"tag":496,"props":954,"children":955},{"style":509},[956],{"type":400,"value":768},{"type":394,"tag":496,"props":958,"children":959},{"class":498,"line":655},[960],{"type":394,"tag":496,"props":961,"children":963},{"style":962},"--shiki-light:#90A4AE;--shiki-default:#6A737D;--shiki-dark:#6A737D;--shiki-sepia:#88846F;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:inherit",[964],{"type":400,"value":965},"    // 调用原有 setting 设置 window.name\n",{"type":394,"tag":496,"props":967,"children":968},{"class":498,"line":714},[969,974,978,983,987,993,997,1002,1008],{"type":394,"tag":496,"props":970,"children":971},{"style":503},[972],{"type":400,"value":973},"    original",{"type":394,"tag":496,"props":975,"children":976},{"style":509},[977],{"type":400,"value":512},{"type":394,"tag":496,"props":979,"children":980},{"style":515},[981],{"type":400,"value":982},"call",{"type":394,"tag":496,"props":984,"children":985},{"style":606},[986],{"type":400,"value":609},{"type":394,"tag":496,"props":988,"children":990},{"style":989},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[991],{"type":400,"value":992},"this",{"type":394,"tag":496,"props":994,"children":995},{"style":509},[996],{"type":400,"value":695},{"type":394,"tag":496,"props":998,"children":999},{"style":520},[1000],{"type":400,"value":1001}," ...",{"type":394,"tag":496,"props":1003,"children":1005},{"style":1004},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[1006],{"type":400,"value":1007},"arguments",{"type":394,"tag":496,"props":1009,"children":1010},{"style":606},[1011],{"type":400,"value":652},{"type":394,"tag":496,"props":1013,"children":1014},{"class":498,"line":771},[1015],{"type":394,"tag":496,"props":1016,"children":1017},{"style":962},[1018],{"type":400,"value":1019},"    // 把 name 记录下来\n",{"type":394,"tag":496,"props":1021,"children":1022},{"class":498,"line":808},[1023,1028,1032,1037,1041,1045,1049,1053],{"type":394,"tag":496,"props":1024,"children":1025},{"style":503},[1026],{"type":400,"value":1027},"    windowNames",{"type":394,"tag":496,"props":1029,"children":1030},{"style":509},[1031],{"type":400,"value":512},{"type":394,"tag":496,"props":1033,"children":1034},{"style":515},[1035],{"type":400,"value":1036},"set",{"type":394,"tag":496,"props":1038,"children":1039},{"style":606},[1040],{"type":400,"value":609},{"type":394,"tag":496,"props":1042,"children":1043},{"style":989},[1044],{"type":400,"value":992},{"type":394,"tag":496,"props":1046,"children":1047},{"style":509},[1048],{"type":400,"value":695},{"type":394,"tag":496,"props":1050,"children":1051},{"style":503},[1052],{"type":400,"value":939},{"type":394,"tag":496,"props":1054,"children":1055},{"style":606},[1056],{"type":400,"value":652},{"type":394,"tag":496,"props":1058,"children":1059},{"class":498,"line":845},[1060],{"type":394,"tag":496,"props":1061,"children":1062},{"style":509},[1063],{"type":400,"value":851},{"type":394,"tag":496,"props":1065,"children":1066},{"class":498,"line":854},[1067],{"type":394,"tag":496,"props":1068,"children":1069},{"style":509},[1070],{"type":400,"value":860},{"type":394,"tag":408,"props":1072,"children":1073},{},[1074],{"type":400,"value":1075},"因为只有通过显式的 window.name = 'xxx' 才会触发 windowNames 中记录的值的改变，所以一旦在 b.com 读取到的 window.name 不是 windowNames 记录的值，就说明浏览器泄露了 window.name，此时需要返回伪造的值。",{"type":394,"tag":485,"props":1077,"children":1079},{"className":487,"code":1078,"language":489,"meta":388,"style":388},"{\n  get name(){\n    return checkerWrapper(checker, this, arguments, function(args, check){\n      const {notify, original, prefs} = check\n\n      // 读取 b.com 的 window.name 可能会返回 a.com 的 window.name\n      const originalName = original.call(this, ...args)\n\n      // 根据配置，iframes 中返回的 window.name 可以赦免此伪造规则，\n      // this !== this.top 是一种快速检测当前 window 是否在 iframe 中的方法\n      if (\n        this !== this.top &&\n        prefs(\"allowWindowNameInFrames\", this.location)\n      ){\n        return originalName\n      }\n\n      // 只有通过显式的 window.name = 'xxx' 才会触发 windowNames 中记录的值的改变，\n      // 所以一旦 windowNames 记录的值和 originalName 不一样，\n      // 就说明当前浏览器犯了 window.name 泄露的错误\n      const returnedName = windowNames.get(this) || \"\"\n      if (originalName !== returnedName){\n        notify(\"fakedWindowReadout\")\n      }\n      return returnedName\n    });\n  }\n}\n",[1080],{"type":394,"tag":492,"props":1081,"children":1082},{"__ignoreMap":388},[1083,1090,1111,1181,1230,1238,1246,1298,1305,1314,1323,1337,1368,1415,1428,1442,1451,1459,1468,1477,1486,1540,1573,1603,1611,1625,1643,1651],{"type":394,"tag":496,"props":1084,"children":1085},{"class":498,"line":499},[1086],{"type":394,"tag":496,"props":1087,"children":1088},{"style":509},[1089],{"type":400,"value":768},{"type":394,"tag":496,"props":1091,"children":1092},{"class":498,"line":574},[1093,1098,1102,1107],{"type":394,"tag":496,"props":1094,"children":1095},{"style":503},[1096],{"type":400,"value":1097},"  get",{"type":394,"tag":496,"props":1099,"children":1100},{"style":515},[1101],{"type":400,"value":939},{"type":394,"tag":496,"props":1103,"children":1104},{"style":606},[1105],{"type":400,"value":1106},"()",{"type":394,"tag":496,"props":1108,"children":1109},{"style":509},[1110],{"type":400,"value":768},{"type":394,"tag":496,"props":1112,"children":1113},{"class":498,"line":655},[1114,1119,1124,1128,1133,1137,1142,1146,1151,1155,1159,1163,1168,1172,1177],{"type":394,"tag":496,"props":1115,"children":1116},{"style":718},[1117],{"type":400,"value":1118},"    return",{"type":394,"tag":496,"props":1120,"children":1121},{"style":515},[1122],{"type":400,"value":1123}," checkerWrapper",{"type":394,"tag":496,"props":1125,"children":1126},{"style":606},[1127],{"type":400,"value":609},{"type":394,"tag":496,"props":1129,"children":1130},{"style":503},[1131],{"type":400,"value":1132},"checker",{"type":394,"tag":496,"props":1134,"children":1135},{"style":509},[1136],{"type":400,"value":695},{"type":394,"tag":496,"props":1138,"children":1139},{"style":989},[1140],{"type":400,"value":1141}," this",{"type":394,"tag":496,"props":1143,"children":1144},{"style":509},[1145],{"type":400,"value":695},{"type":394,"tag":496,"props":1147,"children":1148},{"style":1004},[1149],{"type":400,"value":1150}," arguments",{"type":394,"tag":496,"props":1152,"children":1153},{"style":509},[1154],{"type":400,"value":695},{"type":394,"tag":496,"props":1156,"children":1157},{"style":526},[1158],{"type":400,"value":529},{"type":394,"tag":496,"props":1160,"children":1161},{"style":509},[1162],{"type":400,"value":609},{"type":394,"tag":496,"props":1164,"children":1165},{"style":553},[1166],{"type":400,"value":1167},"args",{"type":394,"tag":496,"props":1169,"children":1170},{"style":509},[1171],{"type":400,"value":695},{"type":394,"tag":496,"props":1173,"children":1174},{"style":553},[1175],{"type":400,"value":1176}," check",{"type":394,"tag":496,"props":1178,"children":1179},{"style":509},[1180],{"type":400,"value":571},{"type":394,"tag":496,"props":1182,"children":1183},{"class":498,"line":714},[1184,1189,1194,1199,1203,1208,1212,1217,1221,1225],{"type":394,"tag":496,"props":1185,"children":1186},{"style":526},[1187],{"type":400,"value":1188},"      const",{"type":394,"tag":496,"props":1190,"children":1191},{"style":509},[1192],{"type":400,"value":1193}," {",{"type":394,"tag":496,"props":1195,"children":1196},{"style":583},[1197],{"type":400,"value":1198},"notify",{"type":394,"tag":496,"props":1200,"children":1201},{"style":509},[1202],{"type":400,"value":695},{"type":394,"tag":496,"props":1204,"children":1205},{"style":583},[1206],{"type":400,"value":1207}," original",{"type":394,"tag":496,"props":1209,"children":1210},{"style":509},[1211],{"type":400,"value":695},{"type":394,"tag":496,"props":1213,"children":1214},{"style":583},[1215],{"type":400,"value":1216}," prefs",{"type":394,"tag":496,"props":1218,"children":1219},{"style":509},[1220],{"type":400,"value":647},{"type":394,"tag":496,"props":1222,"children":1223},{"style":520},[1224],{"type":400,"value":523},{"type":394,"tag":496,"props":1226,"children":1227},{"style":503},[1228],{"type":400,"value":1229}," check\n",{"type":394,"tag":496,"props":1231,"children":1232},{"class":498,"line":771},[1233],{"type":394,"tag":496,"props":1234,"children":1235},{"emptyLinePlaceholder":387},[1236],{"type":400,"value":1237},"\n",{"type":394,"tag":496,"props":1239,"children":1240},{"class":498,"line":808},[1241],{"type":394,"tag":496,"props":1242,"children":1243},{"style":962},[1244],{"type":400,"value":1245},"      // 读取 b.com 的 window.name 可能会返回 a.com 的 window.name\n",{"type":394,"tag":496,"props":1247,"children":1248},{"class":498,"line":845},[1249,1253,1258,1262,1266,1270,1274,1278,1282,1286,1290,1294],{"type":394,"tag":496,"props":1250,"children":1251},{"style":526},[1252],{"type":400,"value":1188},{"type":394,"tag":496,"props":1254,"children":1255},{"style":583},[1256],{"type":400,"value":1257}," originalName",{"type":394,"tag":496,"props":1259,"children":1260},{"style":520},[1261],{"type":400,"value":523},{"type":394,"tag":496,"props":1263,"children":1264},{"style":503},[1265],{"type":400,"value":1207},{"type":394,"tag":496,"props":1267,"children":1268},{"style":509},[1269],{"type":400,"value":512},{"type":394,"tag":496,"props":1271,"children":1272},{"style":515},[1273],{"type":400,"value":982},{"type":394,"tag":496,"props":1275,"children":1276},{"style":606},[1277],{"type":400,"value":609},{"type":394,"tag":496,"props":1279,"children":1280},{"style":989},[1281],{"type":400,"value":992},{"type":394,"tag":496,"props":1283,"children":1284},{"style":509},[1285],{"type":400,"value":695},{"type":394,"tag":496,"props":1287,"children":1288},{"style":520},[1289],{"type":400,"value":1001},{"type":394,"tag":496,"props":1291,"children":1292},{"style":503},[1293],{"type":400,"value":1167},{"type":394,"tag":496,"props":1295,"children":1296},{"style":606},[1297],{"type":400,"value":652},{"type":394,"tag":496,"props":1299,"children":1300},{"class":498,"line":854},[1301],{"type":394,"tag":496,"props":1302,"children":1303},{"emptyLinePlaceholder":387},[1304],{"type":400,"value":1237},{"type":394,"tag":496,"props":1306,"children":1308},{"class":498,"line":1307},9,[1309],{"type":394,"tag":496,"props":1310,"children":1311},{"style":962},[1312],{"type":400,"value":1313},"      // 根据配置，iframes 中返回的 window.name 可以赦免此伪造规则，\n",{"type":394,"tag":496,"props":1315,"children":1317},{"class":498,"line":1316},10,[1318],{"type":394,"tag":496,"props":1319,"children":1320},{"style":962},[1321],{"type":400,"value":1322},"      // this !== this.top 是一种快速检测当前 window 是否在 iframe 中的方法\n",{"type":394,"tag":496,"props":1324,"children":1326},{"class":498,"line":1325},11,[1327,1332],{"type":394,"tag":496,"props":1328,"children":1329},{"style":718},[1330],{"type":400,"value":1331},"      if",{"type":394,"tag":496,"props":1333,"children":1334},{"style":606},[1335],{"type":400,"value":1336}," (\n",{"type":394,"tag":496,"props":1338,"children":1340},{"class":498,"line":1339},12,[1341,1346,1350,1354,1358,1363],{"type":394,"tag":496,"props":1342,"children":1343},{"style":989},[1344],{"type":400,"value":1345},"        this",{"type":394,"tag":496,"props":1347,"children":1348},{"style":520},[1349],{"type":400,"value":745},{"type":394,"tag":496,"props":1351,"children":1352},{"style":989},[1353],{"type":400,"value":1141},{"type":394,"tag":496,"props":1355,"children":1356},{"style":509},[1357],{"type":400,"value":512},{"type":394,"tag":496,"props":1359,"children":1360},{"style":503},[1361],{"type":400,"value":1362},"top",{"type":394,"tag":496,"props":1364,"children":1365},{"style":520},[1366],{"type":400,"value":1367}," &&\n",{"type":394,"tag":496,"props":1369,"children":1371},{"class":498,"line":1370},13,[1372,1377,1381,1385,1390,1394,1398,1402,1406,1411],{"type":394,"tag":496,"props":1373,"children":1374},{"style":515},[1375],{"type":400,"value":1376},"        prefs",{"type":394,"tag":496,"props":1378,"children":1379},{"style":606},[1380],{"type":400,"value":609},{"type":394,"tag":496,"props":1382,"children":1383},{"style":677},[1384],{"type":400,"value":680},{"type":394,"tag":496,"props":1386,"children":1387},{"style":683},[1388],{"type":400,"value":1389},"allowWindowNameInFrames",{"type":394,"tag":496,"props":1391,"children":1392},{"style":677},[1393],{"type":400,"value":680},{"type":394,"tag":496,"props":1395,"children":1396},{"style":509},[1397],{"type":400,"value":695},{"type":394,"tag":496,"props":1399,"children":1400},{"style":989},[1401],{"type":400,"value":1141},{"type":394,"tag":496,"props":1403,"children":1404},{"style":509},[1405],{"type":400,"value":512},{"type":394,"tag":496,"props":1407,"children":1408},{"style":503},[1409],{"type":400,"value":1410},"location",{"type":394,"tag":496,"props":1412,"children":1413},{"style":606},[1414],{"type":400,"value":652},{"type":394,"tag":496,"props":1416,"children":1418},{"class":498,"line":1417},14,[1419,1424],{"type":394,"tag":496,"props":1420,"children":1421},{"style":606},[1422],{"type":400,"value":1423},"      )",{"type":394,"tag":496,"props":1425,"children":1426},{"style":509},[1427],{"type":400,"value":768},{"type":394,"tag":496,"props":1429,"children":1431},{"class":498,"line":1430},15,[1432,1437],{"type":394,"tag":496,"props":1433,"children":1434},{"style":718},[1435],{"type":400,"value":1436},"        return",{"type":394,"tag":496,"props":1438,"children":1439},{"style":503},[1440],{"type":400,"value":1441}," originalName\n",{"type":394,"tag":496,"props":1443,"children":1445},{"class":498,"line":1444},16,[1446],{"type":394,"tag":496,"props":1447,"children":1448},{"style":509},[1449],{"type":400,"value":1450},"      }\n",{"type":394,"tag":496,"props":1452,"children":1454},{"class":498,"line":1453},17,[1455],{"type":394,"tag":496,"props":1456,"children":1457},{"emptyLinePlaceholder":387},[1458],{"type":400,"value":1237},{"type":394,"tag":496,"props":1460,"children":1462},{"class":498,"line":1461},18,[1463],{"type":394,"tag":496,"props":1464,"children":1465},{"style":962},[1466],{"type":400,"value":1467},"      // 只有通过显式的 window.name = 'xxx' 才会触发 windowNames 中记录的值的改变，\n",{"type":394,"tag":496,"props":1469,"children":1471},{"class":498,"line":1470},19,[1472],{"type":394,"tag":496,"props":1473,"children":1474},{"style":962},[1475],{"type":400,"value":1476},"      // 所以一旦 windowNames 记录的值和 originalName 不一样，\n",{"type":394,"tag":496,"props":1478,"children":1480},{"class":498,"line":1479},20,[1481],{"type":394,"tag":496,"props":1482,"children":1483},{"style":962},[1484],{"type":400,"value":1485},"      // 就说明当前浏览器犯了 window.name 泄露的错误\n",{"type":394,"tag":496,"props":1487,"children":1489},{"class":498,"line":1488},21,[1490,1494,1499,1503,1508,1512,1517,1521,1525,1530,1535],{"type":394,"tag":496,"props":1491,"children":1492},{"style":526},[1493],{"type":400,"value":1188},{"type":394,"tag":496,"props":1495,"children":1496},{"style":583},[1497],{"type":400,"value":1498}," returnedName",{"type":394,"tag":496,"props":1500,"children":1501},{"style":520},[1502],{"type":400,"value":523},{"type":394,"tag":496,"props":1504,"children":1505},{"style":503},[1506],{"type":400,"value":1507}," windowNames",{"type":394,"tag":496,"props":1509,"children":1510},{"style":509},[1511],{"type":400,"value":512},{"type":394,"tag":496,"props":1513,"children":1514},{"style":515},[1515],{"type":400,"value":1516},"get",{"type":394,"tag":496,"props":1518,"children":1519},{"style":606},[1520],{"type":400,"value":609},{"type":394,"tag":496,"props":1522,"children":1523},{"style":989},[1524],{"type":400,"value":992},{"type":394,"tag":496,"props":1526,"children":1527},{"style":606},[1528],{"type":400,"value":1529},") ",{"type":394,"tag":496,"props":1531,"children":1532},{"style":520},[1533],{"type":400,"value":1534},"||",{"type":394,"tag":496,"props":1536,"children":1537},{"style":677},[1538],{"type":400,"value":1539}," \"\"\n",{"type":394,"tag":496,"props":1541,"children":1543},{"class":498,"line":1542},22,[1544,1548,1552,1557,1561,1565,1569],{"type":394,"tag":496,"props":1545,"children":1546},{"style":718},[1547],{"type":400,"value":1331},{"type":394,"tag":496,"props":1549,"children":1550},{"style":606},[1551],{"type":400,"value":726},{"type":394,"tag":496,"props":1553,"children":1554},{"style":503},[1555],{"type":400,"value":1556},"originalName",{"type":394,"tag":496,"props":1558,"children":1559},{"style":520},[1560],{"type":400,"value":745},{"type":394,"tag":496,"props":1562,"children":1563},{"style":503},[1564],{"type":400,"value":1498},{"type":394,"tag":496,"props":1566,"children":1567},{"style":606},[1568],{"type":400,"value":642},{"type":394,"tag":496,"props":1570,"children":1571},{"style":509},[1572],{"type":400,"value":768},{"type":394,"tag":496,"props":1574,"children":1576},{"class":498,"line":1575},23,[1577,1582,1586,1590,1595,1599],{"type":394,"tag":496,"props":1578,"children":1579},{"style":515},[1580],{"type":400,"value":1581},"        notify",{"type":394,"tag":496,"props":1583,"children":1584},{"style":606},[1585],{"type":400,"value":609},{"type":394,"tag":496,"props":1587,"children":1588},{"style":677},[1589],{"type":400,"value":680},{"type":394,"tag":496,"props":1591,"children":1592},{"style":683},[1593],{"type":400,"value":1594},"fakedWindowReadout",{"type":394,"tag":496,"props":1596,"children":1597},{"style":677},[1598],{"type":400,"value":680},{"type":394,"tag":496,"props":1600,"children":1601},{"style":606},[1602],{"type":400,"value":652},{"type":394,"tag":496,"props":1604,"children":1606},{"class":498,"line":1605},24,[1607],{"type":394,"tag":496,"props":1608,"children":1609},{"style":509},[1610],{"type":400,"value":1450},{"type":394,"tag":496,"props":1612,"children":1614},{"class":498,"line":1613},25,[1615,1620],{"type":394,"tag":496,"props":1616,"children":1617},{"style":718},[1618],{"type":400,"value":1619},"      return",{"type":394,"tag":496,"props":1621,"children":1622},{"style":503},[1623],{"type":400,"value":1624}," returnedName\n",{"type":394,"tag":496,"props":1626,"children":1628},{"class":498,"line":1627},26,[1629,1634,1638],{"type":394,"tag":496,"props":1630,"children":1631},{"style":509},[1632],{"type":400,"value":1633},"    }",{"type":394,"tag":496,"props":1635,"children":1636},{"style":606},[1637],{"type":400,"value":642},{"type":394,"tag":496,"props":1639,"children":1640},{"style":509},[1641],{"type":400,"value":1642},";\n",{"type":394,"tag":496,"props":1644,"children":1646},{"class":498,"line":1645},27,[1647],{"type":394,"tag":496,"props":1648,"children":1649},{"style":509},[1650],{"type":400,"value":851},{"type":394,"tag":496,"props":1652,"children":1654},{"class":498,"line":1653},28,[1655],{"type":394,"tag":496,"props":1656,"children":1657},{"style":509},[1658],{"type":400,"value":860},{"type":394,"tag":402,"props":1660,"children":1662},{"id":1661},"windowopener",[1663],{"type":400,"value":1664},"window.opener",{"type":394,"tag":408,"props":1666,"children":1667},{},[1668],{"type":400,"value":1669},"在过去的浏览器中，当页面通过超链接或 window.open 的方式从 A 网站跳转到 B 网站时，如果制定了 target 属性却没有指定 rel=\"norefer\" 属性，那么在 B 网站是可以使用 window.opener 获取到 A 网站的部分信息的。也就是说，在 B 网站中可以修改 window.opener.location.href = 'x' 从而让 A 网站自动跳转到 X 网站。如果页面跳转时使用 target=\"__blank\" 打开了新页面，那么用户更加不可能注意到 A 网站的恶意跳转。",{"type":394,"tag":414,"props":1671,"children":1672},{},[1673],{"type":394,"tag":418,"props":1674,"children":1675},{},[1676],{"type":394,"tag":890,"props":1677,"children":1680},{"href":1678,"rel":1679},"https://cwe.mitre.org/data/definitions/1022.html",[894],[1681],{"type":400,"value":1682},"CWE-1022: Use of Web Link to Untrusted Target with window.opener Access",{"type":394,"tag":408,"props":1684,"children":1685},{},[1686],{"type":400,"value":1687},"Blocker 对 window.opener 的防范比较简单，直接返回 null 就完事儿了。考虑到现代浏览器已经修复了这个漏洞，该篡改的设置的值默认是关闭的。",{"type":394,"tag":485,"props":1689,"children":1691},{"className":487,"code":1690,"language":489,"meta":388,"style":388},"{\n  // 修改 Getter 使 window.opener 一直返回 null\n  getterGenerator: function(checker){\n    const temp = {\n      get opener(){\n        return checkerWrapper(checker, this, arguments, function(args, check){\n          const {notify, original} = check\n          const originalOpener = original.call(this, ...args)\n          if (originalOpener !== null){\n            notify(\"fakedWindowReadout\")\n          }\n          return null\n        })\n      }\n    }\n    return Object.getOwnPropertyDescriptor(temp, \"opener\").get\n  },\n  // 修改 Descriptor.Value 使得 window.opener 一直返回 null，\n  // 这是一种兼容，在部分浏览器中，\n  //  window.opener 是通过 value 而不是 getter 获取的值\n  valueGenerator: function({original, notify}){\n    if (original !== null){\n      notify(\"fakedWindowReadout\")\n    }\n    return null\n  }\n}\n",[1692],{"type":394,"tag":492,"props":1693,"children":1694},{"__ignoreMap":388},[1695,1702,1710,1739,1761,1780,1843,1879,1931,1966,1994,2002,2015,2027,2034,2042,2102,2110,2118,2126,2134,2173,2205,2233,2240,2251,2258],{"type":394,"tag":496,"props":1696,"children":1697},{"class":498,"line":499},[1698],{"type":394,"tag":496,"props":1699,"children":1700},{"style":509},[1701],{"type":400,"value":768},{"type":394,"tag":496,"props":1703,"children":1704},{"class":498,"line":574},[1705],{"type":394,"tag":496,"props":1706,"children":1707},{"style":962},[1708],{"type":400,"value":1709},"  // 修改 Getter 使 window.opener 一直返回 null\n",{"type":394,"tag":496,"props":1711,"children":1712},{"class":498,"line":655},[1713,1719,1723,1727,1731,1735],{"type":394,"tag":496,"props":1714,"children":1716},{"style":1715},"--shiki-light:#E2931D;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#F8F8F2",[1717],{"type":400,"value":1718},"  getterGenerator",{"type":394,"tag":496,"props":1720,"children":1721},{"style":509},[1722],{"type":400,"value":550},{"type":394,"tag":496,"props":1724,"children":1725},{"style":526},[1726],{"type":400,"value":529},{"type":394,"tag":496,"props":1728,"children":1729},{"style":509},[1730],{"type":400,"value":609},{"type":394,"tag":496,"props":1732,"children":1733},{"style":553},[1734],{"type":400,"value":1132},{"type":394,"tag":496,"props":1736,"children":1737},{"style":509},[1738],{"type":400,"value":571},{"type":394,"tag":496,"props":1740,"children":1741},{"class":498,"line":714},[1742,1747,1752,1756],{"type":394,"tag":496,"props":1743,"children":1744},{"style":526},[1745],{"type":400,"value":1746},"    const",{"type":394,"tag":496,"props":1748,"children":1749},{"style":583},[1750],{"type":400,"value":1751}," temp",{"type":394,"tag":496,"props":1753,"children":1754},{"style":520},[1755],{"type":400,"value":523},{"type":394,"tag":496,"props":1757,"children":1758},{"style":509},[1759],{"type":400,"value":1760}," {\n",{"type":394,"tag":496,"props":1762,"children":1763},{"class":498,"line":771},[1764,1769,1775],{"type":394,"tag":496,"props":1765,"children":1766},{"style":526},[1767],{"type":400,"value":1768},"      get",{"type":394,"tag":496,"props":1770,"children":1772},{"style":1771},"--shiki-light:#E53935;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[1773],{"type":400,"value":1774}," opener",{"type":394,"tag":496,"props":1776,"children":1777},{"style":509},[1778],{"type":400,"value":1779},"(){\n",{"type":394,"tag":496,"props":1781,"children":1782},{"class":498,"line":808},[1783,1787,1791,1795,1799,1803,1807,1811,1815,1819,1823,1827,1831,1835,1839],{"type":394,"tag":496,"props":1784,"children":1785},{"style":718},[1786],{"type":400,"value":1436},{"type":394,"tag":496,"props":1788,"children":1789},{"style":515},[1790],{"type":400,"value":1123},{"type":394,"tag":496,"props":1792,"children":1793},{"style":606},[1794],{"type":400,"value":609},{"type":394,"tag":496,"props":1796,"children":1797},{"style":503},[1798],{"type":400,"value":1132},{"type":394,"tag":496,"props":1800,"children":1801},{"style":509},[1802],{"type":400,"value":695},{"type":394,"tag":496,"props":1804,"children":1805},{"style":989},[1806],{"type":400,"value":1141},{"type":394,"tag":496,"props":1808,"children":1809},{"style":509},[1810],{"type":400,"value":695},{"type":394,"tag":496,"props":1812,"children":1813},{"style":1004},[1814],{"type":400,"value":1150},{"type":394,"tag":496,"props":1816,"children":1817},{"style":509},[1818],{"type":400,"value":695},{"type":394,"tag":496,"props":1820,"children":1821},{"style":526},[1822],{"type":400,"value":529},{"type":394,"tag":496,"props":1824,"children":1825},{"style":509},[1826],{"type":400,"value":609},{"type":394,"tag":496,"props":1828,"children":1829},{"style":553},[1830],{"type":400,"value":1167},{"type":394,"tag":496,"props":1832,"children":1833},{"style":509},[1834],{"type":400,"value":695},{"type":394,"tag":496,"props":1836,"children":1837},{"style":553},[1838],{"type":400,"value":1176},{"type":394,"tag":496,"props":1840,"children":1841},{"style":509},[1842],{"type":400,"value":571},{"type":394,"tag":496,"props":1844,"children":1845},{"class":498,"line":845},[1846,1851,1855,1859,1863,1867,1871,1875],{"type":394,"tag":496,"props":1847,"children":1848},{"style":526},[1849],{"type":400,"value":1850},"          const",{"type":394,"tag":496,"props":1852,"children":1853},{"style":509},[1854],{"type":400,"value":1193},{"type":394,"tag":496,"props":1856,"children":1857},{"style":583},[1858],{"type":400,"value":1198},{"type":394,"tag":496,"props":1860,"children":1861},{"style":509},[1862],{"type":400,"value":695},{"type":394,"tag":496,"props":1864,"children":1865},{"style":583},[1866],{"type":400,"value":1207},{"type":394,"tag":496,"props":1868,"children":1869},{"style":509},[1870],{"type":400,"value":647},{"type":394,"tag":496,"props":1872,"children":1873},{"style":520},[1874],{"type":400,"value":523},{"type":394,"tag":496,"props":1876,"children":1877},{"style":503},[1878],{"type":400,"value":1229},{"type":394,"tag":496,"props":1880,"children":1881},{"class":498,"line":854},[1882,1886,1891,1895,1899,1903,1907,1911,1915,1919,1923,1927],{"type":394,"tag":496,"props":1883,"children":1884},{"style":526},[1885],{"type":400,"value":1850},{"type":394,"tag":496,"props":1887,"children":1888},{"style":583},[1889],{"type":400,"value":1890}," originalOpener",{"type":394,"tag":496,"props":1892,"children":1893},{"style":520},[1894],{"type":400,"value":523},{"type":394,"tag":496,"props":1896,"children":1897},{"style":503},[1898],{"type":400,"value":1207},{"type":394,"tag":496,"props":1900,"children":1901},{"style":509},[1902],{"type":400,"value":512},{"type":394,"tag":496,"props":1904,"children":1905},{"style":515},[1906],{"type":400,"value":982},{"type":394,"tag":496,"props":1908,"children":1909},{"style":606},[1910],{"type":400,"value":609},{"type":394,"tag":496,"props":1912,"children":1913},{"style":989},[1914],{"type":400,"value":992},{"type":394,"tag":496,"props":1916,"children":1917},{"style":509},[1918],{"type":400,"value":695},{"type":394,"tag":496,"props":1920,"children":1921},{"style":520},[1922],{"type":400,"value":1001},{"type":394,"tag":496,"props":1924,"children":1925},{"style":503},[1926],{"type":400,"value":1167},{"type":394,"tag":496,"props":1928,"children":1929},{"style":606},[1930],{"type":400,"value":652},{"type":394,"tag":496,"props":1932,"children":1933},{"class":498,"line":1307},[1934,1939,1943,1948,1952,1958,1962],{"type":394,"tag":496,"props":1935,"children":1936},{"style":718},[1937],{"type":400,"value":1938},"          if",{"type":394,"tag":496,"props":1940,"children":1941},{"style":606},[1942],{"type":400,"value":726},{"type":394,"tag":496,"props":1944,"children":1945},{"style":503},[1946],{"type":400,"value":1947},"originalOpener",{"type":394,"tag":496,"props":1949,"children":1950},{"style":520},[1951],{"type":400,"value":745},{"type":394,"tag":496,"props":1953,"children":1955},{"style":1954},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[1956],{"type":400,"value":1957}," null",{"type":394,"tag":496,"props":1959,"children":1960},{"style":606},[1961],{"type":400,"value":642},{"type":394,"tag":496,"props":1963,"children":1964},{"style":509},[1965],{"type":400,"value":768},{"type":394,"tag":496,"props":1967,"children":1968},{"class":498,"line":1316},[1969,1974,1978,1982,1986,1990],{"type":394,"tag":496,"props":1970,"children":1971},{"style":515},[1972],{"type":400,"value":1973},"            notify",{"type":394,"tag":496,"props":1975,"children":1976},{"style":606},[1977],{"type":400,"value":609},{"type":394,"tag":496,"props":1979,"children":1980},{"style":677},[1981],{"type":400,"value":680},{"type":394,"tag":496,"props":1983,"children":1984},{"style":683},[1985],{"type":400,"value":1594},{"type":394,"tag":496,"props":1987,"children":1988},{"style":677},[1989],{"type":400,"value":680},{"type":394,"tag":496,"props":1991,"children":1992},{"style":606},[1993],{"type":400,"value":652},{"type":394,"tag":496,"props":1995,"children":1996},{"class":498,"line":1325},[1997],{"type":394,"tag":496,"props":1998,"children":1999},{"style":509},[2000],{"type":400,"value":2001},"          }\n",{"type":394,"tag":496,"props":2003,"children":2004},{"class":498,"line":1339},[2005,2010],{"type":394,"tag":496,"props":2006,"children":2007},{"style":718},[2008],{"type":400,"value":2009},"          return",{"type":394,"tag":496,"props":2011,"children":2012},{"style":1954},[2013],{"type":400,"value":2014}," null\n",{"type":394,"tag":496,"props":2016,"children":2017},{"class":498,"line":1370},[2018,2023],{"type":394,"tag":496,"props":2019,"children":2020},{"style":509},[2021],{"type":400,"value":2022},"        }",{"type":394,"tag":496,"props":2024,"children":2025},{"style":606},[2026],{"type":400,"value":652},{"type":394,"tag":496,"props":2028,"children":2029},{"class":498,"line":1417},[2030],{"type":394,"tag":496,"props":2031,"children":2032},{"style":509},[2033],{"type":400,"value":1450},{"type":394,"tag":496,"props":2035,"children":2036},{"class":498,"line":1430},[2037],{"type":394,"tag":496,"props":2038,"children":2039},{"style":509},[2040],{"type":400,"value":2041},"    }\n",{"type":394,"tag":496,"props":2043,"children":2044},{"class":498,"line":1444},[2045,2049,2054,2058,2063,2067,2072,2076,2080,2085,2089,2093,2097],{"type":394,"tag":496,"props":2046,"children":2047},{"style":718},[2048],{"type":400,"value":1118},{"type":394,"tag":496,"props":2050,"children":2051},{"style":503},[2052],{"type":400,"value":2053}," Object",{"type":394,"tag":496,"props":2055,"children":2056},{"style":509},[2057],{"type":400,"value":512},{"type":394,"tag":496,"props":2059,"children":2060},{"style":515},[2061],{"type":400,"value":2062},"getOwnPropertyDescriptor",{"type":394,"tag":496,"props":2064,"children":2065},{"style":606},[2066],{"type":400,"value":609},{"type":394,"tag":496,"props":2068,"children":2069},{"style":503},[2070],{"type":400,"value":2071},"temp",{"type":394,"tag":496,"props":2073,"children":2074},{"style":509},[2075],{"type":400,"value":695},{"type":394,"tag":496,"props":2077,"children":2078},{"style":677},[2079],{"type":400,"value":750},{"type":394,"tag":496,"props":2081,"children":2082},{"style":683},[2083],{"type":400,"value":2084},"opener",{"type":394,"tag":496,"props":2086,"children":2087},{"style":677},[2088],{"type":400,"value":680},{"type":394,"tag":496,"props":2090,"children":2091},{"style":606},[2092],{"type":400,"value":642},{"type":394,"tag":496,"props":2094,"children":2095},{"style":509},[2096],{"type":400,"value":512},{"type":394,"tag":496,"props":2098,"children":2099},{"style":503},[2100],{"type":400,"value":2101},"get\n",{"type":394,"tag":496,"props":2103,"children":2104},{"class":498,"line":1453},[2105],{"type":394,"tag":496,"props":2106,"children":2107},{"style":509},[2108],{"type":400,"value":2109},"  },\n",{"type":394,"tag":496,"props":2111,"children":2112},{"class":498,"line":1461},[2113],{"type":394,"tag":496,"props":2114,"children":2115},{"style":962},[2116],{"type":400,"value":2117},"  // 修改 Descriptor.Value 使得 window.opener 一直返回 null，\n",{"type":394,"tag":496,"props":2119,"children":2120},{"class":498,"line":1470},[2121],{"type":394,"tag":496,"props":2122,"children":2123},{"style":962},[2124],{"type":400,"value":2125},"  // 这是一种兼容，在部分浏览器中，\n",{"type":394,"tag":496,"props":2127,"children":2128},{"class":498,"line":1479},[2129],{"type":394,"tag":496,"props":2130,"children":2131},{"style":962},[2132],{"type":400,"value":2133},"  //  window.opener 是通过 value 而不是 getter 获取的值\n",{"type":394,"tag":496,"props":2135,"children":2136},{"class":498,"line":1488},[2137,2142,2146,2150,2154,2159,2163,2168],{"type":394,"tag":496,"props":2138,"children":2139},{"style":1715},[2140],{"type":400,"value":2141},"  valueGenerator",{"type":394,"tag":496,"props":2143,"children":2144},{"style":509},[2145],{"type":400,"value":550},{"type":394,"tag":496,"props":2147,"children":2148},{"style":526},[2149],{"type":400,"value":529},{"type":394,"tag":496,"props":2151,"children":2152},{"style":509},[2153],{"type":400,"value":539},{"type":394,"tag":496,"props":2155,"children":2156},{"style":553},[2157],{"type":400,"value":2158},"original",{"type":394,"tag":496,"props":2160,"children":2161},{"style":509},[2162],{"type":400,"value":695},{"type":394,"tag":496,"props":2164,"children":2165},{"style":553},[2166],{"type":400,"value":2167}," notify",{"type":394,"tag":496,"props":2169,"children":2170},{"style":509},[2171],{"type":400,"value":2172},"}){\n",{"type":394,"tag":496,"props":2174,"children":2175},{"class":498,"line":1542},[2176,2181,2185,2189,2193,2197,2201],{"type":394,"tag":496,"props":2177,"children":2178},{"style":718},[2179],{"type":400,"value":2180},"    if",{"type":394,"tag":496,"props":2182,"children":2183},{"style":606},[2184],{"type":400,"value":726},{"type":394,"tag":496,"props":2186,"children":2187},{"style":503},[2188],{"type":400,"value":2158},{"type":394,"tag":496,"props":2190,"children":2191},{"style":520},[2192],{"type":400,"value":745},{"type":394,"tag":496,"props":2194,"children":2195},{"style":1954},[2196],{"type":400,"value":1957},{"type":394,"tag":496,"props":2198,"children":2199},{"style":606},[2200],{"type":400,"value":642},{"type":394,"tag":496,"props":2202,"children":2203},{"style":509},[2204],{"type":400,"value":768},{"type":394,"tag":496,"props":2206,"children":2207},{"class":498,"line":1575},[2208,2213,2217,2221,2225,2229],{"type":394,"tag":496,"props":2209,"children":2210},{"style":515},[2211],{"type":400,"value":2212},"      notify",{"type":394,"tag":496,"props":2214,"children":2215},{"style":606},[2216],{"type":400,"value":609},{"type":394,"tag":496,"props":2218,"children":2219},{"style":677},[2220],{"type":400,"value":680},{"type":394,"tag":496,"props":2222,"children":2223},{"style":683},[2224],{"type":400,"value":1594},{"type":394,"tag":496,"props":2226,"children":2227},{"style":677},[2228],{"type":400,"value":680},{"type":394,"tag":496,"props":2230,"children":2231},{"style":606},[2232],{"type":400,"value":652},{"type":394,"tag":496,"props":2234,"children":2235},{"class":498,"line":1605},[2236],{"type":394,"tag":496,"props":2237,"children":2238},{"style":509},[2239],{"type":400,"value":2041},{"type":394,"tag":496,"props":2241,"children":2242},{"class":498,"line":1613},[2243,2247],{"type":394,"tag":496,"props":2244,"children":2245},{"style":718},[2246],{"type":400,"value":1118},{"type":394,"tag":496,"props":2248,"children":2249},{"style":1954},[2250],{"type":400,"value":2014},{"type":394,"tag":496,"props":2252,"children":2253},{"class":498,"line":1627},[2254],{"type":394,"tag":496,"props":2255,"children":2256},{"style":509},[2257],{"type":400,"value":851},{"type":394,"tag":496,"props":2259,"children":2260},{"class":498,"line":1645},[2261],{"type":394,"tag":496,"props":2262,"children":2263},{"style":509},[2264],{"type":400,"value":860},{"type":394,"tag":402,"props":2266,"children":2268},{"id":2267},"canvas",[2269],{"type":400,"value":2270},"Canvas",{"type":394,"tag":408,"props":2272,"children":2273},{},[2274],{"type":400,"value":2275},"伪造了 getContext、getDataURL 等 API，并替代了原本正常的 API。",{"type":394,"tag":402,"props":2277,"children":2279},{"id":2278},"相关链接",[2280],{"type":400,"value":2278},{"type":394,"tag":414,"props":2282,"children":2283},{},[2284],{"type":394,"tag":418,"props":2285,"children":2286},{},[2287],{"type":394,"tag":890,"props":2288,"children":2291},{"href":2289,"rel":2290},"https://github.com/kkapsner/CanvasBlocker",[894],[2292],{"type":400,"value":2293},"CanvasBlocker",{"type":394,"tag":2295,"props":2296,"children":2297},"style",{},[2298],{"type":400,"value":2299},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":388,"searchDepth":574,"depth":574,"links":2301},[2302,2303,2304,2307,2308,2309],{"id":404,"depth":574,"text":404},{"id":470,"depth":574,"text":473},{"id":863,"depth":574,"text":442,"children":2305},[2306],{"id":874,"depth":655,"text":877},{"id":1661,"depth":574,"text":1664},{"id":2267,"depth":574,"text":2270},{"id":2278,"depth":574,"text":2278},"markdown","content:8.source-code:_fingerprint:canvas-blocker.md","content","8.source-code/_fingerprint/canvas-blocker.md","md",[2316,2319],{"_path":2317,"title":2318,"description":388},"/source-code/_es/object-assign","Object.prototype.assign",{"_path":2320,"title":2321,"description":388},"/source-code/_js/element-plus","ElementPlus",1708107586156]