[{"data":1,"prerenderedAt":2350},["ShallowReactive",2],{"navigation":3,"/source-code/_fingerprint/canvas-blocker":410,"/source-code/_fingerprint/canvas-blocker-surround":2343},[4,32,83,102,129,135,141,147,393,399,405],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🌃 长夜梦","/flows/long-night-dream",{"title":15,"_path":16},"🌌 万物联结与幸福感","/flows/everything",{"title":18,"_path":19},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":21,"_path":22},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":24,"_path":25},"🌧️ 我的腼腆","/flows/shy",{"title":27,"_path":28},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":30,"_path":31},"📝 心流归档","/flows/fold",{"title":33,"_path":34,"children":35},"技术博客 / Coder","/articles",[36,38,41,44,47,50,53,56,59,62,65,68,71,74,77,80],{"title":37,"_path":34},"🦁 为什么我要写博客",{"title":39,"_path":40},"💻 本地部署 Qwen 翻译网页","/articles/local-translator",{"title":42,"_path":43},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":45,"_path":46},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":48,"_path":49},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":51,"_path":52},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":54,"_path":55},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":57,"_path":58},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":60,"_path":61},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":63,"_path":64},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":66,"_path":67},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":69,"_path":70},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":72,"_path":73},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":75,"_path":76},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":78,"_path":79},"🚝 四十二篇系列","/articles/fourty-two",{"title":81,"_path":82},"📝 技术博客归档","/articles/fold",{"title":84,"_path":85,"children":86},"造物 / Make","/tools",[87,90,93,96,99],{"title":88,"_path":89},"🧶 网易云音乐歌单排序","/tools/netease-sorter",{"title":91,"_path":92},"🌐 AnySort","/tools/anysort",{"title":94,"_path":95},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":97,"_path":98},"👓 Crapto","/tools/crypto-inline",{"title":100,"_path":101},"🖨️ any-to-base64","/tools/any-to-base64",{"title":103,"_path":104,"children":105},"吉他剧场 / Music","/music",[106,108,111,114,117,120,123,126],{"title":107,"_path":104},"🎸 FingerStyle！",{"title":109,"_path":110},"🌬️ 等待的风","/music/wind",{"title":112,"_path":113},"💕 约定的海洋","/music/ocean",{"title":115,"_path":116},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":118,"_path":119},"🌏 残酷天使的行动纲领","/music/eva",{"title":121,"_path":122},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":124,"_path":125},"🍷 Wu Wei","/music/wu-wei",{"title":127,"_path":128},"🌅 无题","/music/untitled",{"title":130,"_path":131,"children":132},"画点什么 / Paint","/paint",[133],{"title":134,"_path":131},"🚧 正在施工",{"title":136,"_path":137,"children":138},"读书笔记 / Notes","/books",[139],{"title":140,"_path":137},"📕 读书笔记",{"title":142,"_path":143,"children":144},"知识地图 / Maps","/maps",[145],{"title":146,"_path":143},"🏁 知识地图",{"title":148,"_path":149,"children":150},"零散的笔记 / Gists","/gists",[151,153,156,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255,258,261,264,267,270,273,276,279,282,285,288,291,294,297,300,303,306,309,312,315,318,321,324,327,330,333,336,339,342,345,348,351,354,357,360,363,366,369,372,375,378,381,384,387,390],{"title":152,"_path":149},"🧊 Gists",{"title":154,"_path":155},"网站的可访问性","/gists/accessibility",{"title":157,"_path":158},"Bit","/gists/bit",{"title":160,"_path":161},"图片模糊","/gists/blur",{"title":163,"_path":164},"渲染相关笔记","/gists/c4d",{"title":166,"_path":167},"CDN 问题记录","/gists/cdn",{"title":169,"_path":170},"消毒剂","/gists/cleaner",{"title":172,"_path":173},"Windows Command","/gists/cmd",{"title":175,"_path":176},"Command","/gists/command",{"title":178,"_path":179},"复杂科学","/gists/complexity-science",{"title":181,"_path":182},"GitHub Copilot","/gists/copilot",{"title":184,"_path":185},"宇宙","/gists/cosmos",{"title":187,"_path":188},"C++","/gists/cpp",{"title":190,"_path":191},"Data Structure","/gists/data-structure",{"title":193,"_path":194},"DEPRESSION","/gists/depression",{"title":196,"_path":197},"设计模式","/gists/design-patterns",{"title":199,"_path":200},"Developer Experience","/gists/developer-experience",{"title":202,"_path":203},"Device Metrics","/gists/device-metrix",{"title":205,"_path":206},"数字化转型","/gists/digital-transformation",{"title":208,"_path":209},"ECMAScript Language Specification","/gists/ecmascript-specification",{"title":211,"_path":212},"正则表达式","/gists/eegex",{"title":214,"_path":215},"Emoji","/gists/emoji",{"title":217,"_path":218},"工程","/gists/engineering",{"title":220,"_path":221},"熵","/gists/entropy",{"title":223,"_path":224},"Environment","/gists/environment",{"title":226,"_path":227},"Erlang","/gists/erlang",{"title":229,"_path":230},"逃离塔克夫","/gists/escape-from-tarkov",{"title":232,"_path":233},"ESNext (ES6-ES11)","/gists/esnext",{"title":235,"_path":236},"Eval！","/gists/eval",{"title":238,"_path":239},"Flutter","/gists/flutter",{"title":241,"_path":242},"字体","/gists/font",{"title":244,"_path":245},"JS 函数式编程","/gists/functional",{"title":247,"_path":248},"游戏化","/gists/gamification",{"title":250,"_path":251},"Google C++ Standard","/gists/google-cpp-standard",{"title":253,"_path":254},"双向链接完全体","/gists/graph",{"title":256,"_path":257},"Hardwares","/gists/hardwares",{"title":259,"_path":260},"哈希冲突","/gists/hash-collision",{"title":262,"_path":263},"信息设计","/gists/information-design",{"title":265,"_path":266},"InstantPage","/gists/instant.page",{"title":268,"_path":269},"ISUX 遇见大数据可视化系列","/gists/isux-data-visualization",{"title":271,"_path":272},"KVStore","/gists/key-value-db",{"title":274,"_path":275},"Kubernetes","/gists/kubernetes",{"title":277,"_path":278},"Makefile","/gists/makefile",{"title":280,"_path":281},"Markdown Inline Style","/gists/markdown-nice",{"title":283,"_path":284},"小程序","/gists/miniapp",{"title":286,"_path":287},"减小页面快照体积","/gists/minify-html",{"title":289,"_path":290},"mklink","/gists/mklink",{"title":292,"_path":293},"Mock","/gists/mock",{"title":295,"_path":296},"多人协作系统","/gists/multiplayer",{"title":298,"_path":299},"多端应用","/gists/multy-end-app",{"title":301,"_path":302},"神经科学","/gists/neuroscience",{"title":304,"_path":305},"OO","/gists/oo",{"title":307,"_path":308},"Opinioned Personal Folder","/gists/opinioned-personal-folder",{"title":310,"_path":311},"PInvoke","/gists/pinvoke",{"title":313,"_path":314},"像素","/gists/pixel",{"title":316,"_path":317},"PowerShell","/gists/powershell",{"title":319,"_path":320},"量子","/gists/quantum",{"title":322,"_path":323},"保持好奇心","/gists/questions",{"title":325,"_path":326},"React Native","/gists/react-native",{"title":328,"_path":329},"博客改版碰到的浏览器平滑滚动问题","/gists/scroll",{"title":331,"_path":332},"SEO","/gists/seo",{"title":334,"_path":335},"Shader","/gists/shader",{"title":337,"_path":338},"Shape Up","/gists/shape-up",{"title":340,"_path":341},"睡觉","/gists/sleep",{"title":343,"_path":344},"记录奇怪的问题","/gists/solved",{"title":346,"_path":347},"States","/gists/states",{"title":349,"_path":350},"Storage","/gists/storage",{"title":352,"_path":353},"音视频流处理","/gists/stream-cli",{"title":355,"_path":356},"Symbol","/gists/symbol",{"title":358,"_path":359},"系统论","/gists/systems-theory",{"title":361,"_path":362},"Taro","/gists/taro",{"title":364,"_path":365},"任务切片","/gists/task-slice",{"title":367,"_path":368},"技术偏好","/gists/tech-dudge",{"title":370,"_path":371},"Untitled","/gists/untitled",{"title":373,"_path":374},"可变字体","/gists/variable-font",{"title":376,"_path":377},"视觉错觉","/gists/visual-illusion",{"title":379,"_path":380},"SS(SSR)","/gists/vpn",{"title":382,"_path":383},"VS Code 插件开发","/gists/vscode-plugin",{"title":385,"_path":386},"Web Components","/gists/web-components",{"title":388,"_path":389},"Windows","/gists/windows",{"title":391,"_path":392},"查缺补漏","/gists/wrong",{"title":394,"_path":395,"children":396},"代码笔记 / Gists","/source-code",[397],{"title":398,"_path":395},"🚄 代码笔记",{"title":400,"_path":401,"children":402},"我 / Abount","/hire",[403],{"title":404,"_path":401},"📬 技术简历",{"title":406,"_path":407,"children":408},"todo","/todo",[409],{"title":406,"_path":407},{"_path":411,"_dir":412,"_draft":413,"_partial":414,"_locale":415,"title":416,"description":415,"body":417,"_type":2337,"_id":2338,"_source":2339,"_file":2340,"_stem":2341,"_extension":2342},"/source-code/_fingerprint/canvas-blocker","_fingerprint",false,true,"","Canvas Blocker",{"type":418,"children":419,"toc":2327},"root",[420,428,434,440,490,495,501,506,511,888,893,898,905,910,935,940,1098,1103,1686,1692,1697,1710,1715,2292,2298,2303,2308,2321],{"type":421,"tag":422,"props":423,"children":425},"element","h1",{"id":424},"canvas-blocker",[426],{"type":427,"value":416},"text",{"type":421,"tag":429,"props":430,"children":432},"h2",{"id":431},"前言",[433],{"type":427,"value":431},{"type":421,"tag":435,"props":436,"children":437},"p",{},[438],{"type":427,"value":439},"最近在看一些反反爬相关的东西，期间找到了 Canvas Blocker 这个神奇的库。他是一个浏览器扩展，声称能拦截以下几种类型的指纹追踪：",{"type":421,"tag":441,"props":442,"children":443},"ul",{},[444,450,455,460,465,470,475,480,485],{"type":421,"tag":445,"props":446,"children":447},"li",{},[448],{"type":427,"value":449},"Canvas 2D",{"type":421,"tag":445,"props":451,"children":452},{},[453],{"type":427,"value":454},"WebGL",{"type":421,"tag":445,"props":456,"children":457},{},[458],{"type":427,"value":459},"Web Audio",{"type":421,"tag":445,"props":461,"children":462},{},[463],{"type":427,"value":464},"History",{"type":421,"tag":445,"props":466,"children":467},{},[468],{"type":427,"value":469},"Window",{"type":421,"tag":445,"props":471,"children":472},{},[473],{"type":427,"value":474},"DOMRect",{"type":421,"tag":445,"props":476,"children":477},{},[478],{"type":427,"value":479},"TextMetrics",{"type":421,"tag":445,"props":481,"children":482},{},[483],{"type":427,"value":484},"Navigator",{"type":421,"tag":445,"props":486,"children":487},{},[488],{"type":427,"value":489},"Screen",{"type":421,"tag":435,"props":491,"children":492},{},[493],{"type":427,"value":494},"让我们大致拆解一下，看看其原理是什么。",{"type":421,"tag":429,"props":496,"children":498},{"id":497},"intercept",[499],{"type":427,"value":500},"Intercept",{"type":421,"tag":435,"props":502,"children":503},{},[504],{"type":427,"value":505},"Blocker 最主要的思路就是用伪造的函数篡改属性的 Getter 以及某些 API。",{"type":421,"tag":435,"props":507,"children":508},{},[509],{"type":427,"value":510},"篡改的入口在 intercept.js 中，先根据页面 URL 检查当前页面是否允许篡改，允许的话就通过 interceptFns、interceptGetters 实施具体步骤。",{"type":421,"tag":512,"props":513,"children":517},"pre",{"className":514,"code":515,"language":516,"meta":415,"style":415},"language-js shiki shiki-themes material-theme-lighter github-light github-dark monokai","scope.intercept = function intercept({subject: windowToProcess}, apis){\n  const siteStatus = apis.check({url: getURL(windowToProcess)})\n  logging.verbose(\"status for page\", windowToProcess, siteStatus)\n  if (siteStatus.mode !== \"allow\"){\n    interceptFunctions(windowToProcess, siteStatus, apis)\n    interceptGetters(windowToProcess, siteStatus, apis)\n  }\n}\n","js",[518],{"type":421,"tag":519,"props":520,"children":521},"code",{"__ignoreMap":415},[522,599,680,739,796,833,870,879],{"type":421,"tag":523,"props":524,"children":527},"span",{"class":525,"line":526},"line",1,[528,534,540,545,551,557,562,567,573,578,584,589,594],{"type":421,"tag":523,"props":529,"children":531},{"style":530},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[532],{"type":427,"value":533},"scope",{"type":421,"tag":523,"props":535,"children":537},{"style":536},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[538],{"type":427,"value":539},".",{"type":421,"tag":523,"props":541,"children":543},{"style":542},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[544],{"type":427,"value":497},{"type":421,"tag":523,"props":546,"children":548},{"style":547},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[549],{"type":427,"value":550}," =",{"type":421,"tag":523,"props":552,"children":554},{"style":553},"--shiki-light:#9C3EDA;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic",[555],{"type":427,"value":556}," function",{"type":421,"tag":523,"props":558,"children":559},{"style":542},[560],{"type":427,"value":561}," intercept",{"type":421,"tag":523,"props":563,"children":564},{"style":536},[565],{"type":427,"value":566},"({",{"type":421,"tag":523,"props":568,"children":570},{"style":569},"--shiki-light:#E53935;--shiki-default:#E36209;--shiki-dark:#FFAB70;--shiki-sepia:#F8F8F2",[571],{"type":427,"value":572},"subject",{"type":421,"tag":523,"props":574,"children":575},{"style":536},[576],{"type":427,"value":577},":",{"type":421,"tag":523,"props":579,"children":581},{"style":580},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#E36209;--shiki-default-font-style:inherit;--shiki-dark:#FFAB70;--shiki-dark-font-style:inherit;--shiki-sepia:#FD971F;--shiki-sepia-font-style:italic",[582],{"type":427,"value":583}," windowToProcess",{"type":421,"tag":523,"props":585,"children":586},{"style":536},[587],{"type":427,"value":588},"},",{"type":421,"tag":523,"props":590,"children":591},{"style":580},[592],{"type":427,"value":593}," apis",{"type":421,"tag":523,"props":595,"children":596},{"style":536},[597],{"type":427,"value":598},"){\n",{"type":421,"tag":523,"props":600,"children":602},{"class":525,"line":601},2,[603,608,614,618,622,626,631,637,642,647,651,656,660,665,670,675],{"type":421,"tag":523,"props":604,"children":605},{"style":553},[606],{"type":427,"value":607},"  const",{"type":421,"tag":523,"props":609,"children":611},{"style":610},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#F8F8F2",[612],{"type":427,"value":613}," siteStatus",{"type":421,"tag":523,"props":615,"children":616},{"style":547},[617],{"type":427,"value":550},{"type":421,"tag":523,"props":619,"children":620},{"style":530},[621],{"type":427,"value":593},{"type":421,"tag":523,"props":623,"children":624},{"style":536},[625],{"type":427,"value":539},{"type":421,"tag":523,"props":627,"children":628},{"style":542},[629],{"type":427,"value":630},"check",{"type":421,"tag":523,"props":632,"children":634},{"style":633},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[635],{"type":427,"value":636},"(",{"type":421,"tag":523,"props":638,"children":639},{"style":536},[640],{"type":427,"value":641},"{",{"type":421,"tag":523,"props":643,"children":644},{"style":633},[645],{"type":427,"value":646},"url",{"type":421,"tag":523,"props":648,"children":649},{"style":536},[650],{"type":427,"value":577},{"type":421,"tag":523,"props":652,"children":653},{"style":542},[654],{"type":427,"value":655}," getURL",{"type":421,"tag":523,"props":657,"children":658},{"style":633},[659],{"type":427,"value":636},{"type":421,"tag":523,"props":661,"children":662},{"style":530},[663],{"type":427,"value":664},"windowToProcess",{"type":421,"tag":523,"props":666,"children":667},{"style":633},[668],{"type":427,"value":669},")",{"type":421,"tag":523,"props":671,"children":672},{"style":536},[673],{"type":427,"value":674},"}",{"type":421,"tag":523,"props":676,"children":677},{"style":633},[678],{"type":427,"value":679},")\n",{"type":421,"tag":523,"props":681,"children":683},{"class":525,"line":682},3,[684,689,693,698,702,708,714,718,723,727,731,735],{"type":421,"tag":523,"props":685,"children":686},{"style":530},[687],{"type":427,"value":688},"  logging",{"type":421,"tag":523,"props":690,"children":691},{"style":536},[692],{"type":427,"value":539},{"type":421,"tag":523,"props":694,"children":695},{"style":542},[696],{"type":427,"value":697},"verbose",{"type":421,"tag":523,"props":699,"children":700},{"style":633},[701],{"type":427,"value":636},{"type":421,"tag":523,"props":703,"children":705},{"style":704},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[706],{"type":427,"value":707},"\"",{"type":421,"tag":523,"props":709,"children":711},{"style":710},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[712],{"type":427,"value":713},"status for page",{"type":421,"tag":523,"props":715,"children":716},{"style":704},[717],{"type":427,"value":707},{"type":421,"tag":523,"props":719,"children":720},{"style":536},[721],{"type":427,"value":722},",",{"type":421,"tag":523,"props":724,"children":725},{"style":530},[726],{"type":427,"value":583},{"type":421,"tag":523,"props":728,"children":729},{"style":536},[730],{"type":427,"value":722},{"type":421,"tag":523,"props":732,"children":733},{"style":530},[734],{"type":427,"value":613},{"type":421,"tag":523,"props":736,"children":737},{"style":633},[738],{"type":427,"value":679},{"type":421,"tag":523,"props":740,"children":742},{"class":525,"line":741},4,[743,749,754,759,763,768,773,778,783,787,791],{"type":421,"tag":523,"props":744,"children":746},{"style":745},"--shiki-light:#39ADB5;--shiki-light-font-style:italic;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#F92672;--shiki-sepia-font-style:inherit",[747],{"type":427,"value":748},"  if",{"type":421,"tag":523,"props":750,"children":751},{"style":633},[752],{"type":427,"value":753}," (",{"type":421,"tag":523,"props":755,"children":756},{"style":530},[757],{"type":427,"value":758},"siteStatus",{"type":421,"tag":523,"props":760,"children":761},{"style":536},[762],{"type":427,"value":539},{"type":421,"tag":523,"props":764,"children":765},{"style":530},[766],{"type":427,"value":767},"mode",{"type":421,"tag":523,"props":769,"children":770},{"style":547},[771],{"type":427,"value":772}," !==",{"type":421,"tag":523,"props":774,"children":775},{"style":704},[776],{"type":427,"value":777}," \"",{"type":421,"tag":523,"props":779,"children":780},{"style":710},[781],{"type":427,"value":782},"allow",{"type":421,"tag":523,"props":784,"children":785},{"style":704},[786],{"type":427,"value":707},{"type":421,"tag":523,"props":788,"children":789},{"style":633},[790],{"type":427,"value":669},{"type":421,"tag":523,"props":792,"children":793},{"style":536},[794],{"type":427,"value":795},"{\n",{"type":421,"tag":523,"props":797,"children":799},{"class":525,"line":798},5,[800,805,809,813,817,821,825,829],{"type":421,"tag":523,"props":801,"children":802},{"style":542},[803],{"type":427,"value":804},"    interceptFunctions",{"type":421,"tag":523,"props":806,"children":807},{"style":633},[808],{"type":427,"value":636},{"type":421,"tag":523,"props":810,"children":811},{"style":530},[812],{"type":427,"value":664},{"type":421,"tag":523,"props":814,"children":815},{"style":536},[816],{"type":427,"value":722},{"type":421,"tag":523,"props":818,"children":819},{"style":530},[820],{"type":427,"value":613},{"type":421,"tag":523,"props":822,"children":823},{"style":536},[824],{"type":427,"value":722},{"type":421,"tag":523,"props":826,"children":827},{"style":530},[828],{"type":427,"value":593},{"type":421,"tag":523,"props":830,"children":831},{"style":633},[832],{"type":427,"value":679},{"type":421,"tag":523,"props":834,"children":836},{"class":525,"line":835},6,[837,842,846,850,854,858,862,866],{"type":421,"tag":523,"props":838,"children":839},{"style":542},[840],{"type":427,"value":841},"    interceptGetters",{"type":421,"tag":523,"props":843,"children":844},{"style":633},[845],{"type":427,"value":636},{"type":421,"tag":523,"props":847,"children":848},{"style":530},[849],{"type":427,"value":664},{"type":421,"tag":523,"props":851,"children":852},{"style":536},[853],{"type":427,"value":722},{"type":421,"tag":523,"props":855,"children":856},{"style":530},[857],{"type":427,"value":613},{"type":421,"tag":523,"props":859,"children":860},{"style":536},[861],{"type":427,"value":722},{"type":421,"tag":523,"props":863,"children":864},{"style":530},[865],{"type":427,"value":593},{"type":421,"tag":523,"props":867,"children":868},{"style":633},[869],{"type":427,"value":679},{"type":421,"tag":523,"props":871,"children":873},{"class":525,"line":872},7,[874],{"type":421,"tag":523,"props":875,"children":876},{"style":536},[877],{"type":427,"value":878},"  }\n",{"type":421,"tag":523,"props":880,"children":882},{"class":525,"line":881},8,[883],{"type":421,"tag":523,"props":884,"children":885},{"style":536},[886],{"type":427,"value":887},"}\n",{"type":421,"tag":429,"props":889,"children":891},{"id":890},"window",[892],{"type":427,"value":469},{"type":421,"tag":435,"props":894,"children":895},{},[896],{"type":427,"value":897},"Blocker 篡改了 Window 的两个属性，window.name 和 window.opener。这两个属性和指纹没有直接关系，但却是一种“帮助函数”，能够帮助恶意网站追踪指纹以及窃取隐私。",{"type":421,"tag":899,"props":900,"children":902},"h3",{"id":901},"windowname",[903],{"type":427,"value":904},"window.name",{"type":421,"tag":435,"props":906,"children":907},{},[908],{"type":427,"value":909},"在过去的浏览器中，window.name 能够跨站点传输数据，并且能逃逸同源策略。从 Firefox 88 开始，用户通过点击超链接跳转到新页面时，window.name 将被置空，不过为了不造成更大的破坏，当用户从跳转后页面回到之前页面时，window.name 会被还原。",{"type":421,"tag":441,"props":911,"children":912},{},[913,925],{"type":421,"tag":445,"props":914,"children":915},{},[916],{"type":421,"tag":917,"props":918,"children":922},"a",{"href":919,"rel":920},"https://blog.mozilla.org/security/2021/04/19/firefox-88-combats-window-name-privacy-abuses/",[921],"nofollow",[923],{"type":427,"value":924},"Firefox 88 combats window.name privacy abuses",{"type":421,"tag":445,"props":926,"children":927},{},[928],{"type":421,"tag":917,"props":929,"children":932},{"href":930,"rel":931},"https://wpt.fyi/results/html/browsers/windows/clear-window-name.https.html?label=master&label=experimental&aligned",[921],[933],{"type":427,"value":934},"clear-window-name@web-platform-tests",{"type":421,"tag":435,"props":936,"children":937},{},[938],{"type":427,"value":939},"在使用 JS 设置 window.name 时，Blcoker 会记录下设置的值。original.call 调用原有的 window.name setter；windowNames 只做记录，稍后会用到。",{"type":421,"tag":512,"props":941,"children":943},{"className":514,"code":942,"language":516,"meta":415,"style":415},"{\n  set name(name){\n    // 调用原有 setting 设置 window.name\n    original.call(this, ...arguments)\n    // 把 name 记录下来\n    windowNames.set(this, name)\n  }\n}\n",[944],{"type":421,"tag":519,"props":945,"children":946},{"__ignoreMap":415},[947,954,984,993,1039,1047,1084,1091],{"type":421,"tag":523,"props":948,"children":949},{"class":525,"line":526},[950],{"type":421,"tag":523,"props":951,"children":952},{"style":536},[953],{"type":427,"value":795},{"type":421,"tag":523,"props":955,"children":956},{"class":525,"line":601},[957,962,967,971,976,980],{"type":421,"tag":523,"props":958,"children":959},{"style":530},[960],{"type":427,"value":961},"  set",{"type":421,"tag":523,"props":963,"children":964},{"style":542},[965],{"type":427,"value":966}," name",{"type":421,"tag":523,"props":968,"children":969},{"style":633},[970],{"type":427,"value":636},{"type":421,"tag":523,"props":972,"children":973},{"style":530},[974],{"type":427,"value":975},"name",{"type":421,"tag":523,"props":977,"children":978},{"style":633},[979],{"type":427,"value":669},{"type":421,"tag":523,"props":981,"children":982},{"style":536},[983],{"type":427,"value":795},{"type":421,"tag":523,"props":985,"children":986},{"class":525,"line":682},[987],{"type":421,"tag":523,"props":988,"children":990},{"style":989},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit",[991],{"type":427,"value":992},"    // 调用原有 setting 设置 window.name\n",{"type":421,"tag":523,"props":994,"children":995},{"class":525,"line":741},[996,1001,1005,1010,1014,1020,1024,1029,1035],{"type":421,"tag":523,"props":997,"children":998},{"style":530},[999],{"type":427,"value":1000},"    original",{"type":421,"tag":523,"props":1002,"children":1003},{"style":536},[1004],{"type":427,"value":539},{"type":421,"tag":523,"props":1006,"children":1007},{"style":542},[1008],{"type":427,"value":1009},"call",{"type":421,"tag":523,"props":1011,"children":1012},{"style":633},[1013],{"type":427,"value":636},{"type":421,"tag":523,"props":1015,"children":1017},{"style":1016},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[1018],{"type":427,"value":1019},"this",{"type":421,"tag":523,"props":1021,"children":1022},{"style":536},[1023],{"type":427,"value":722},{"type":421,"tag":523,"props":1025,"children":1026},{"style":547},[1027],{"type":427,"value":1028}," ...",{"type":421,"tag":523,"props":1030,"children":1032},{"style":1031},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[1033],{"type":427,"value":1034},"arguments",{"type":421,"tag":523,"props":1036,"children":1037},{"style":633},[1038],{"type":427,"value":679},{"type":421,"tag":523,"props":1040,"children":1041},{"class":525,"line":798},[1042],{"type":421,"tag":523,"props":1043,"children":1044},{"style":989},[1045],{"type":427,"value":1046},"    // 把 name 记录下来\n",{"type":421,"tag":523,"props":1048,"children":1049},{"class":525,"line":835},[1050,1055,1059,1064,1068,1072,1076,1080],{"type":421,"tag":523,"props":1051,"children":1052},{"style":530},[1053],{"type":427,"value":1054},"    windowNames",{"type":421,"tag":523,"props":1056,"children":1057},{"style":536},[1058],{"type":427,"value":539},{"type":421,"tag":523,"props":1060,"children":1061},{"style":542},[1062],{"type":427,"value":1063},"set",{"type":421,"tag":523,"props":1065,"children":1066},{"style":633},[1067],{"type":427,"value":636},{"type":421,"tag":523,"props":1069,"children":1070},{"style":1016},[1071],{"type":427,"value":1019},{"type":421,"tag":523,"props":1073,"children":1074},{"style":536},[1075],{"type":427,"value":722},{"type":421,"tag":523,"props":1077,"children":1078},{"style":530},[1079],{"type":427,"value":966},{"type":421,"tag":523,"props":1081,"children":1082},{"style":633},[1083],{"type":427,"value":679},{"type":421,"tag":523,"props":1085,"children":1086},{"class":525,"line":872},[1087],{"type":421,"tag":523,"props":1088,"children":1089},{"style":536},[1090],{"type":427,"value":878},{"type":421,"tag":523,"props":1092,"children":1093},{"class":525,"line":881},[1094],{"type":421,"tag":523,"props":1095,"children":1096},{"style":536},[1097],{"type":427,"value":887},{"type":421,"tag":435,"props":1099,"children":1100},{},[1101],{"type":427,"value":1102},"因为只有通过显式的 window.name = 'xxx' 才会触发 windowNames 中记录的值的改变，所以一旦在 b.com 读取到的 window.name 不是 windowNames 记录的值，就说明浏览器泄露了 window.name，此时需要返回伪造的值。",{"type":421,"tag":512,"props":1104,"children":1106},{"className":514,"code":1105,"language":516,"meta":415,"style":415},"{\n  get name(){\n    return checkerWrapper(checker, this, arguments, function(args, check){\n      const {notify, original, prefs} = check\n\n      // 读取 b.com 的 window.name 可能会返回 a.com 的 window.name\n      const originalName = original.call(this, ...args)\n\n      // 根据配置，iframes 中返回的 window.name 可以赦免此伪造规则，\n      // this !== this.top 是一种快速检测当前 window 是否在 iframe 中的方法\n      if (\n        this !== this.top &&\n        prefs(\"allowWindowNameInFrames\", this.location)\n      ){\n        return originalName\n      }\n\n      // 只有通过显式的 window.name = 'xxx' 才会触发 windowNames 中记录的值的改变，\n      // 所以一旦 windowNames 记录的值和 originalName 不一样，\n      // 就说明当前浏览器犯了 window.name 泄露的错误\n      const returnedName = windowNames.get(this) || \"\"\n      if (originalName !== returnedName){\n        notify(\"fakedWindowReadout\")\n      }\n      return returnedName\n    });\n  }\n}\n",[1107],{"type":421,"tag":519,"props":1108,"children":1109},{"__ignoreMap":415},[1110,1117,1138,1208,1257,1265,1273,1325,1332,1341,1350,1364,1395,1442,1455,1469,1478,1486,1495,1504,1513,1567,1600,1630,1638,1652,1670,1678],{"type":421,"tag":523,"props":1111,"children":1112},{"class":525,"line":526},[1113],{"type":421,"tag":523,"props":1114,"children":1115},{"style":536},[1116],{"type":427,"value":795},{"type":421,"tag":523,"props":1118,"children":1119},{"class":525,"line":601},[1120,1125,1129,1134],{"type":421,"tag":523,"props":1121,"children":1122},{"style":530},[1123],{"type":427,"value":1124},"  get",{"type":421,"tag":523,"props":1126,"children":1127},{"style":542},[1128],{"type":427,"value":966},{"type":421,"tag":523,"props":1130,"children":1131},{"style":633},[1132],{"type":427,"value":1133},"()",{"type":421,"tag":523,"props":1135,"children":1136},{"style":536},[1137],{"type":427,"value":795},{"type":421,"tag":523,"props":1139,"children":1140},{"class":525,"line":682},[1141,1146,1151,1155,1160,1164,1169,1173,1178,1182,1186,1190,1195,1199,1204],{"type":421,"tag":523,"props":1142,"children":1143},{"style":745},[1144],{"type":427,"value":1145},"    return",{"type":421,"tag":523,"props":1147,"children":1148},{"style":542},[1149],{"type":427,"value":1150}," checkerWrapper",{"type":421,"tag":523,"props":1152,"children":1153},{"style":633},[1154],{"type":427,"value":636},{"type":421,"tag":523,"props":1156,"children":1157},{"style":530},[1158],{"type":427,"value":1159},"checker",{"type":421,"tag":523,"props":1161,"children":1162},{"style":536},[1163],{"type":427,"value":722},{"type":421,"tag":523,"props":1165,"children":1166},{"style":1016},[1167],{"type":427,"value":1168}," this",{"type":421,"tag":523,"props":1170,"children":1171},{"style":536},[1172],{"type":427,"value":722},{"type":421,"tag":523,"props":1174,"children":1175},{"style":1031},[1176],{"type":427,"value":1177}," arguments",{"type":421,"tag":523,"props":1179,"children":1180},{"style":536},[1181],{"type":427,"value":722},{"type":421,"tag":523,"props":1183,"children":1184},{"style":553},[1185],{"type":427,"value":556},{"type":421,"tag":523,"props":1187,"children":1188},{"style":536},[1189],{"type":427,"value":636},{"type":421,"tag":523,"props":1191,"children":1192},{"style":580},[1193],{"type":427,"value":1194},"args",{"type":421,"tag":523,"props":1196,"children":1197},{"style":536},[1198],{"type":427,"value":722},{"type":421,"tag":523,"props":1200,"children":1201},{"style":580},[1202],{"type":427,"value":1203}," check",{"type":421,"tag":523,"props":1205,"children":1206},{"style":536},[1207],{"type":427,"value":598},{"type":421,"tag":523,"props":1209,"children":1210},{"class":525,"line":741},[1211,1216,1221,1226,1230,1235,1239,1244,1248,1252],{"type":421,"tag":523,"props":1212,"children":1213},{"style":553},[1214],{"type":427,"value":1215},"      const",{"type":421,"tag":523,"props":1217,"children":1218},{"style":536},[1219],{"type":427,"value":1220}," {",{"type":421,"tag":523,"props":1222,"children":1223},{"style":610},[1224],{"type":427,"value":1225},"notify",{"type":421,"tag":523,"props":1227,"children":1228},{"style":536},[1229],{"type":427,"value":722},{"type":421,"tag":523,"props":1231,"children":1232},{"style":610},[1233],{"type":427,"value":1234}," original",{"type":421,"tag":523,"props":1236,"children":1237},{"style":536},[1238],{"type":427,"value":722},{"type":421,"tag":523,"props":1240,"children":1241},{"style":610},[1242],{"type":427,"value":1243}," prefs",{"type":421,"tag":523,"props":1245,"children":1246},{"style":536},[1247],{"type":427,"value":674},{"type":421,"tag":523,"props":1249,"children":1250},{"style":547},[1251],{"type":427,"value":550},{"type":421,"tag":523,"props":1253,"children":1254},{"style":530},[1255],{"type":427,"value":1256}," check\n",{"type":421,"tag":523,"props":1258,"children":1259},{"class":525,"line":798},[1260],{"type":421,"tag":523,"props":1261,"children":1262},{"emptyLinePlaceholder":414},[1263],{"type":427,"value":1264},"\n",{"type":421,"tag":523,"props":1266,"children":1267},{"class":525,"line":835},[1268],{"type":421,"tag":523,"props":1269,"children":1270},{"style":989},[1271],{"type":427,"value":1272},"      // 读取 b.com 的 window.name 可能会返回 a.com 的 window.name\n",{"type":421,"tag":523,"props":1274,"children":1275},{"class":525,"line":872},[1276,1280,1285,1289,1293,1297,1301,1305,1309,1313,1317,1321],{"type":421,"tag":523,"props":1277,"children":1278},{"style":553},[1279],{"type":427,"value":1215},{"type":421,"tag":523,"props":1281,"children":1282},{"style":610},[1283],{"type":427,"value":1284}," originalName",{"type":421,"tag":523,"props":1286,"children":1287},{"style":547},[1288],{"type":427,"value":550},{"type":421,"tag":523,"props":1290,"children":1291},{"style":530},[1292],{"type":427,"value":1234},{"type":421,"tag":523,"props":1294,"children":1295},{"style":536},[1296],{"type":427,"value":539},{"type":421,"tag":523,"props":1298,"children":1299},{"style":542},[1300],{"type":427,"value":1009},{"type":421,"tag":523,"props":1302,"children":1303},{"style":633},[1304],{"type":427,"value":636},{"type":421,"tag":523,"props":1306,"children":1307},{"style":1016},[1308],{"type":427,"value":1019},{"type":421,"tag":523,"props":1310,"children":1311},{"style":536},[1312],{"type":427,"value":722},{"type":421,"tag":523,"props":1314,"children":1315},{"style":547},[1316],{"type":427,"value":1028},{"type":421,"tag":523,"props":1318,"children":1319},{"style":530},[1320],{"type":427,"value":1194},{"type":421,"tag":523,"props":1322,"children":1323},{"style":633},[1324],{"type":427,"value":679},{"type":421,"tag":523,"props":1326,"children":1327},{"class":525,"line":881},[1328],{"type":421,"tag":523,"props":1329,"children":1330},{"emptyLinePlaceholder":414},[1331],{"type":427,"value":1264},{"type":421,"tag":523,"props":1333,"children":1335},{"class":525,"line":1334},9,[1336],{"type":421,"tag":523,"props":1337,"children":1338},{"style":989},[1339],{"type":427,"value":1340},"      // 根据配置，iframes 中返回的 window.name 可以赦免此伪造规则，\n",{"type":421,"tag":523,"props":1342,"children":1344},{"class":525,"line":1343},10,[1345],{"type":421,"tag":523,"props":1346,"children":1347},{"style":989},[1348],{"type":427,"value":1349},"      // this !== this.top 是一种快速检测当前 window 是否在 iframe 中的方法\n",{"type":421,"tag":523,"props":1351,"children":1353},{"class":525,"line":1352},11,[1354,1359],{"type":421,"tag":523,"props":1355,"children":1356},{"style":745},[1357],{"type":427,"value":1358},"      if",{"type":421,"tag":523,"props":1360,"children":1361},{"style":633},[1362],{"type":427,"value":1363}," (\n",{"type":421,"tag":523,"props":1365,"children":1367},{"class":525,"line":1366},12,[1368,1373,1377,1381,1385,1390],{"type":421,"tag":523,"props":1369,"children":1370},{"style":1016},[1371],{"type":427,"value":1372},"        this",{"type":421,"tag":523,"props":1374,"children":1375},{"style":547},[1376],{"type":427,"value":772},{"type":421,"tag":523,"props":1378,"children":1379},{"style":1016},[1380],{"type":427,"value":1168},{"type":421,"tag":523,"props":1382,"children":1383},{"style":536},[1384],{"type":427,"value":539},{"type":421,"tag":523,"props":1386,"children":1387},{"style":530},[1388],{"type":427,"value":1389},"top",{"type":421,"tag":523,"props":1391,"children":1392},{"style":547},[1393],{"type":427,"value":1394}," &&\n",{"type":421,"tag":523,"props":1396,"children":1398},{"class":525,"line":1397},13,[1399,1404,1408,1412,1417,1421,1425,1429,1433,1438],{"type":421,"tag":523,"props":1400,"children":1401},{"style":542},[1402],{"type":427,"value":1403},"        prefs",{"type":421,"tag":523,"props":1405,"children":1406},{"style":633},[1407],{"type":427,"value":636},{"type":421,"tag":523,"props":1409,"children":1410},{"style":704},[1411],{"type":427,"value":707},{"type":421,"tag":523,"props":1413,"children":1414},{"style":710},[1415],{"type":427,"value":1416},"allowWindowNameInFrames",{"type":421,"tag":523,"props":1418,"children":1419},{"style":704},[1420],{"type":427,"value":707},{"type":421,"tag":523,"props":1422,"children":1423},{"style":536},[1424],{"type":427,"value":722},{"type":421,"tag":523,"props":1426,"children":1427},{"style":1016},[1428],{"type":427,"value":1168},{"type":421,"tag":523,"props":1430,"children":1431},{"style":536},[1432],{"type":427,"value":539},{"type":421,"tag":523,"props":1434,"children":1435},{"style":530},[1436],{"type":427,"value":1437},"location",{"type":421,"tag":523,"props":1439,"children":1440},{"style":633},[1441],{"type":427,"value":679},{"type":421,"tag":523,"props":1443,"children":1445},{"class":525,"line":1444},14,[1446,1451],{"type":421,"tag":523,"props":1447,"children":1448},{"style":633},[1449],{"type":427,"value":1450},"      )",{"type":421,"tag":523,"props":1452,"children":1453},{"style":536},[1454],{"type":427,"value":795},{"type":421,"tag":523,"props":1456,"children":1458},{"class":525,"line":1457},15,[1459,1464],{"type":421,"tag":523,"props":1460,"children":1461},{"style":745},[1462],{"type":427,"value":1463},"        return",{"type":421,"tag":523,"props":1465,"children":1466},{"style":530},[1467],{"type":427,"value":1468}," originalName\n",{"type":421,"tag":523,"props":1470,"children":1472},{"class":525,"line":1471},16,[1473],{"type":421,"tag":523,"props":1474,"children":1475},{"style":536},[1476],{"type":427,"value":1477},"      }\n",{"type":421,"tag":523,"props":1479,"children":1481},{"class":525,"line":1480},17,[1482],{"type":421,"tag":523,"props":1483,"children":1484},{"emptyLinePlaceholder":414},[1485],{"type":427,"value":1264},{"type":421,"tag":523,"props":1487,"children":1489},{"class":525,"line":1488},18,[1490],{"type":421,"tag":523,"props":1491,"children":1492},{"style":989},[1493],{"type":427,"value":1494},"      // 只有通过显式的 window.name = 'xxx' 才会触发 windowNames 中记录的值的改变，\n",{"type":421,"tag":523,"props":1496,"children":1498},{"class":525,"line":1497},19,[1499],{"type":421,"tag":523,"props":1500,"children":1501},{"style":989},[1502],{"type":427,"value":1503},"      // 所以一旦 windowNames 记录的值和 originalName 不一样，\n",{"type":421,"tag":523,"props":1505,"children":1507},{"class":525,"line":1506},20,[1508],{"type":421,"tag":523,"props":1509,"children":1510},{"style":989},[1511],{"type":427,"value":1512},"      // 就说明当前浏览器犯了 window.name 泄露的错误\n",{"type":421,"tag":523,"props":1514,"children":1516},{"class":525,"line":1515},21,[1517,1521,1526,1530,1535,1539,1544,1548,1552,1557,1562],{"type":421,"tag":523,"props":1518,"children":1519},{"style":553},[1520],{"type":427,"value":1215},{"type":421,"tag":523,"props":1522,"children":1523},{"style":610},[1524],{"type":427,"value":1525}," returnedName",{"type":421,"tag":523,"props":1527,"children":1528},{"style":547},[1529],{"type":427,"value":550},{"type":421,"tag":523,"props":1531,"children":1532},{"style":530},[1533],{"type":427,"value":1534}," windowNames",{"type":421,"tag":523,"props":1536,"children":1537},{"style":536},[1538],{"type":427,"value":539},{"type":421,"tag":523,"props":1540,"children":1541},{"style":542},[1542],{"type":427,"value":1543},"get",{"type":421,"tag":523,"props":1545,"children":1546},{"style":633},[1547],{"type":427,"value":636},{"type":421,"tag":523,"props":1549,"children":1550},{"style":1016},[1551],{"type":427,"value":1019},{"type":421,"tag":523,"props":1553,"children":1554},{"style":633},[1555],{"type":427,"value":1556},") ",{"type":421,"tag":523,"props":1558,"children":1559},{"style":547},[1560],{"type":427,"value":1561},"||",{"type":421,"tag":523,"props":1563,"children":1564},{"style":704},[1565],{"type":427,"value":1566}," \"\"\n",{"type":421,"tag":523,"props":1568,"children":1570},{"class":525,"line":1569},22,[1571,1575,1579,1584,1588,1592,1596],{"type":421,"tag":523,"props":1572,"children":1573},{"style":745},[1574],{"type":427,"value":1358},{"type":421,"tag":523,"props":1576,"children":1577},{"style":633},[1578],{"type":427,"value":753},{"type":421,"tag":523,"props":1580,"children":1581},{"style":530},[1582],{"type":427,"value":1583},"originalName",{"type":421,"tag":523,"props":1585,"children":1586},{"style":547},[1587],{"type":427,"value":772},{"type":421,"tag":523,"props":1589,"children":1590},{"style":530},[1591],{"type":427,"value":1525},{"type":421,"tag":523,"props":1593,"children":1594},{"style":633},[1595],{"type":427,"value":669},{"type":421,"tag":523,"props":1597,"children":1598},{"style":536},[1599],{"type":427,"value":795},{"type":421,"tag":523,"props":1601,"children":1603},{"class":525,"line":1602},23,[1604,1609,1613,1617,1622,1626],{"type":421,"tag":523,"props":1605,"children":1606},{"style":542},[1607],{"type":427,"value":1608},"        notify",{"type":421,"tag":523,"props":1610,"children":1611},{"style":633},[1612],{"type":427,"value":636},{"type":421,"tag":523,"props":1614,"children":1615},{"style":704},[1616],{"type":427,"value":707},{"type":421,"tag":523,"props":1618,"children":1619},{"style":710},[1620],{"type":427,"value":1621},"fakedWindowReadout",{"type":421,"tag":523,"props":1623,"children":1624},{"style":704},[1625],{"type":427,"value":707},{"type":421,"tag":523,"props":1627,"children":1628},{"style":633},[1629],{"type":427,"value":679},{"type":421,"tag":523,"props":1631,"children":1633},{"class":525,"line":1632},24,[1634],{"type":421,"tag":523,"props":1635,"children":1636},{"style":536},[1637],{"type":427,"value":1477},{"type":421,"tag":523,"props":1639,"children":1641},{"class":525,"line":1640},25,[1642,1647],{"type":421,"tag":523,"props":1643,"children":1644},{"style":745},[1645],{"type":427,"value":1646},"      return",{"type":421,"tag":523,"props":1648,"children":1649},{"style":530},[1650],{"type":427,"value":1651}," returnedName\n",{"type":421,"tag":523,"props":1653,"children":1655},{"class":525,"line":1654},26,[1656,1661,1665],{"type":421,"tag":523,"props":1657,"children":1658},{"style":536},[1659],{"type":427,"value":1660},"    }",{"type":421,"tag":523,"props":1662,"children":1663},{"style":633},[1664],{"type":427,"value":669},{"type":421,"tag":523,"props":1666,"children":1667},{"style":536},[1668],{"type":427,"value":1669},";\n",{"type":421,"tag":523,"props":1671,"children":1673},{"class":525,"line":1672},27,[1674],{"type":421,"tag":523,"props":1675,"children":1676},{"style":536},[1677],{"type":427,"value":878},{"type":421,"tag":523,"props":1679,"children":1681},{"class":525,"line":1680},28,[1682],{"type":421,"tag":523,"props":1683,"children":1684},{"style":536},[1685],{"type":427,"value":887},{"type":421,"tag":429,"props":1687,"children":1689},{"id":1688},"windowopener",[1690],{"type":427,"value":1691},"window.opener",{"type":421,"tag":435,"props":1693,"children":1694},{},[1695],{"type":427,"value":1696},"在过去的浏览器中，当页面通过超链接或 window.open 的方式从 A 网站跳转到 B 网站时，如果制定了 target 属性却没有指定 rel=\"norefer\" 属性，那么在 B 网站是可以使用 window.opener 获取到 A 网站的部分信息的。也就是说，在 B 网站中可以修改 window.opener.location.href = 'x' 从而让 A 网站自动跳转到 X 网站。如果页面跳转时使用 target=\"__blank\" 打开了新页面，那么用户更加不可能注意到 A 网站的恶意跳转。",{"type":421,"tag":441,"props":1698,"children":1699},{},[1700],{"type":421,"tag":445,"props":1701,"children":1702},{},[1703],{"type":421,"tag":917,"props":1704,"children":1707},{"href":1705,"rel":1706},"https://cwe.mitre.org/data/definitions/1022.html",[921],[1708],{"type":427,"value":1709},"CWE-1022: Use of Web Link to Untrusted Target with window.opener Access",{"type":421,"tag":435,"props":1711,"children":1712},{},[1713],{"type":427,"value":1714},"Blocker 对 window.opener 的防范比较简单，直接返回 null 就完事儿了。考虑到现代浏览器已经修复了这个漏洞，该篡改的设置的值默认是关闭的。",{"type":421,"tag":512,"props":1716,"children":1718},{"className":514,"code":1717,"language":516,"meta":415,"style":415},"{\n  // 修改 Getter 使 window.opener 一直返回 null\n  getterGenerator: function(checker){\n    const temp = {\n      get opener(){\n        return checkerWrapper(checker, this, arguments, function(args, check){\n          const {notify, original} = check\n          const originalOpener = original.call(this, ...args)\n          if (originalOpener !== null){\n            notify(\"fakedWindowReadout\")\n          }\n          return null\n        })\n      }\n    }\n    return Object.getOwnPropertyDescriptor(temp, \"opener\").get\n  },\n  // 修改 Descriptor.Value 使得 window.opener 一直返回 null，\n  // 这是一种兼容，在部分浏览器中，\n  //  window.opener 是通过 value 而不是 getter 获取的值\n  valueGenerator: function({original, notify}){\n    if (original !== null){\n      notify(\"fakedWindowReadout\")\n    }\n    return null\n  }\n}\n",[1719],{"type":421,"tag":519,"props":1720,"children":1721},{"__ignoreMap":415},[1722,1729,1737,1766,1788,1807,1870,1906,1958,1993,2021,2029,2042,2054,2061,2069,2129,2137,2145,2153,2161,2200,2232,2260,2267,2278,2285],{"type":421,"tag":523,"props":1723,"children":1724},{"class":525,"line":526},[1725],{"type":421,"tag":523,"props":1726,"children":1727},{"style":536},[1728],{"type":427,"value":795},{"type":421,"tag":523,"props":1730,"children":1731},{"class":525,"line":601},[1732],{"type":421,"tag":523,"props":1733,"children":1734},{"style":989},[1735],{"type":427,"value":1736},"  // 修改 Getter 使 window.opener 一直返回 null\n",{"type":421,"tag":523,"props":1738,"children":1739},{"class":525,"line":682},[1740,1746,1750,1754,1758,1762],{"type":421,"tag":523,"props":1741,"children":1743},{"style":1742},"--shiki-light:#E2931D;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#F8F8F2",[1744],{"type":427,"value":1745},"  getterGenerator",{"type":421,"tag":523,"props":1747,"children":1748},{"style":536},[1749],{"type":427,"value":577},{"type":421,"tag":523,"props":1751,"children":1752},{"style":553},[1753],{"type":427,"value":556},{"type":421,"tag":523,"props":1755,"children":1756},{"style":536},[1757],{"type":427,"value":636},{"type":421,"tag":523,"props":1759,"children":1760},{"style":580},[1761],{"type":427,"value":1159},{"type":421,"tag":523,"props":1763,"children":1764},{"style":536},[1765],{"type":427,"value":598},{"type":421,"tag":523,"props":1767,"children":1768},{"class":525,"line":741},[1769,1774,1779,1783],{"type":421,"tag":523,"props":1770,"children":1771},{"style":553},[1772],{"type":427,"value":1773},"    const",{"type":421,"tag":523,"props":1775,"children":1776},{"style":610},[1777],{"type":427,"value":1778}," temp",{"type":421,"tag":523,"props":1780,"children":1781},{"style":547},[1782],{"type":427,"value":550},{"type":421,"tag":523,"props":1784,"children":1785},{"style":536},[1786],{"type":427,"value":1787}," {\n",{"type":421,"tag":523,"props":1789,"children":1790},{"class":525,"line":798},[1791,1796,1802],{"type":421,"tag":523,"props":1792,"children":1793},{"style":553},[1794],{"type":427,"value":1795},"      get",{"type":421,"tag":523,"props":1797,"children":1799},{"style":1798},"--shiki-light:#E53935;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[1800],{"type":427,"value":1801}," opener",{"type":421,"tag":523,"props":1803,"children":1804},{"style":536},[1805],{"type":427,"value":1806},"(){\n",{"type":421,"tag":523,"props":1808,"children":1809},{"class":525,"line":835},[1810,1814,1818,1822,1826,1830,1834,1838,1842,1846,1850,1854,1858,1862,1866],{"type":421,"tag":523,"props":1811,"children":1812},{"style":745},[1813],{"type":427,"value":1463},{"type":421,"tag":523,"props":1815,"children":1816},{"style":542},[1817],{"type":427,"value":1150},{"type":421,"tag":523,"props":1819,"children":1820},{"style":633},[1821],{"type":427,"value":636},{"type":421,"tag":523,"props":1823,"children":1824},{"style":530},[1825],{"type":427,"value":1159},{"type":421,"tag":523,"props":1827,"children":1828},{"style":536},[1829],{"type":427,"value":722},{"type":421,"tag":523,"props":1831,"children":1832},{"style":1016},[1833],{"type":427,"value":1168},{"type":421,"tag":523,"props":1835,"children":1836},{"style":536},[1837],{"type":427,"value":722},{"type":421,"tag":523,"props":1839,"children":1840},{"style":1031},[1841],{"type":427,"value":1177},{"type":421,"tag":523,"props":1843,"children":1844},{"style":536},[1845],{"type":427,"value":722},{"type":421,"tag":523,"props":1847,"children":1848},{"style":553},[1849],{"type":427,"value":556},{"type":421,"tag":523,"props":1851,"children":1852},{"style":536},[1853],{"type":427,"value":636},{"type":421,"tag":523,"props":1855,"children":1856},{"style":580},[1857],{"type":427,"value":1194},{"type":421,"tag":523,"props":1859,"children":1860},{"style":536},[1861],{"type":427,"value":722},{"type":421,"tag":523,"props":1863,"children":1864},{"style":580},[1865],{"type":427,"value":1203},{"type":421,"tag":523,"props":1867,"children":1868},{"style":536},[1869],{"type":427,"value":598},{"type":421,"tag":523,"props":1871,"children":1872},{"class":525,"line":872},[1873,1878,1882,1886,1890,1894,1898,1902],{"type":421,"tag":523,"props":1874,"children":1875},{"style":553},[1876],{"type":427,"value":1877},"          const",{"type":421,"tag":523,"props":1879,"children":1880},{"style":536},[1881],{"type":427,"value":1220},{"type":421,"tag":523,"props":1883,"children":1884},{"style":610},[1885],{"type":427,"value":1225},{"type":421,"tag":523,"props":1887,"children":1888},{"style":536},[1889],{"type":427,"value":722},{"type":421,"tag":523,"props":1891,"children":1892},{"style":610},[1893],{"type":427,"value":1234},{"type":421,"tag":523,"props":1895,"children":1896},{"style":536},[1897],{"type":427,"value":674},{"type":421,"tag":523,"props":1899,"children":1900},{"style":547},[1901],{"type":427,"value":550},{"type":421,"tag":523,"props":1903,"children":1904},{"style":530},[1905],{"type":427,"value":1256},{"type":421,"tag":523,"props":1907,"children":1908},{"class":525,"line":881},[1909,1913,1918,1922,1926,1930,1934,1938,1942,1946,1950,1954],{"type":421,"tag":523,"props":1910,"children":1911},{"style":553},[1912],{"type":427,"value":1877},{"type":421,"tag":523,"props":1914,"children":1915},{"style":610},[1916],{"type":427,"value":1917}," originalOpener",{"type":421,"tag":523,"props":1919,"children":1920},{"style":547},[1921],{"type":427,"value":550},{"type":421,"tag":523,"props":1923,"children":1924},{"style":530},[1925],{"type":427,"value":1234},{"type":421,"tag":523,"props":1927,"children":1928},{"style":536},[1929],{"type":427,"value":539},{"type":421,"tag":523,"props":1931,"children":1932},{"style":542},[1933],{"type":427,"value":1009},{"type":421,"tag":523,"props":1935,"children":1936},{"style":633},[1937],{"type":427,"value":636},{"type":421,"tag":523,"props":1939,"children":1940},{"style":1016},[1941],{"type":427,"value":1019},{"type":421,"tag":523,"props":1943,"children":1944},{"style":536},[1945],{"type":427,"value":722},{"type":421,"tag":523,"props":1947,"children":1948},{"style":547},[1949],{"type":427,"value":1028},{"type":421,"tag":523,"props":1951,"children":1952},{"style":530},[1953],{"type":427,"value":1194},{"type":421,"tag":523,"props":1955,"children":1956},{"style":633},[1957],{"type":427,"value":679},{"type":421,"tag":523,"props":1959,"children":1960},{"class":525,"line":1334},[1961,1966,1970,1975,1979,1985,1989],{"type":421,"tag":523,"props":1962,"children":1963},{"style":745},[1964],{"type":427,"value":1965},"          if",{"type":421,"tag":523,"props":1967,"children":1968},{"style":633},[1969],{"type":427,"value":753},{"type":421,"tag":523,"props":1971,"children":1972},{"style":530},[1973],{"type":427,"value":1974},"originalOpener",{"type":421,"tag":523,"props":1976,"children":1977},{"style":547},[1978],{"type":427,"value":772},{"type":421,"tag":523,"props":1980,"children":1982},{"style":1981},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[1983],{"type":427,"value":1984}," null",{"type":421,"tag":523,"props":1986,"children":1987},{"style":633},[1988],{"type":427,"value":669},{"type":421,"tag":523,"props":1990,"children":1991},{"style":536},[1992],{"type":427,"value":795},{"type":421,"tag":523,"props":1994,"children":1995},{"class":525,"line":1343},[1996,2001,2005,2009,2013,2017],{"type":421,"tag":523,"props":1997,"children":1998},{"style":542},[1999],{"type":427,"value":2000},"            notify",{"type":421,"tag":523,"props":2002,"children":2003},{"style":633},[2004],{"type":427,"value":636},{"type":421,"tag":523,"props":2006,"children":2007},{"style":704},[2008],{"type":427,"value":707},{"type":421,"tag":523,"props":2010,"children":2011},{"style":710},[2012],{"type":427,"value":1621},{"type":421,"tag":523,"props":2014,"children":2015},{"style":704},[2016],{"type":427,"value":707},{"type":421,"tag":523,"props":2018,"children":2019},{"style":633},[2020],{"type":427,"value":679},{"type":421,"tag":523,"props":2022,"children":2023},{"class":525,"line":1352},[2024],{"type":421,"tag":523,"props":2025,"children":2026},{"style":536},[2027],{"type":427,"value":2028},"          }\n",{"type":421,"tag":523,"props":2030,"children":2031},{"class":525,"line":1366},[2032,2037],{"type":421,"tag":523,"props":2033,"children":2034},{"style":745},[2035],{"type":427,"value":2036},"          return",{"type":421,"tag":523,"props":2038,"children":2039},{"style":1981},[2040],{"type":427,"value":2041}," null\n",{"type":421,"tag":523,"props":2043,"children":2044},{"class":525,"line":1397},[2045,2050],{"type":421,"tag":523,"props":2046,"children":2047},{"style":536},[2048],{"type":427,"value":2049},"        }",{"type":421,"tag":523,"props":2051,"children":2052},{"style":633},[2053],{"type":427,"value":679},{"type":421,"tag":523,"props":2055,"children":2056},{"class":525,"line":1444},[2057],{"type":421,"tag":523,"props":2058,"children":2059},{"style":536},[2060],{"type":427,"value":1477},{"type":421,"tag":523,"props":2062,"children":2063},{"class":525,"line":1457},[2064],{"type":421,"tag":523,"props":2065,"children":2066},{"style":536},[2067],{"type":427,"value":2068},"    }\n",{"type":421,"tag":523,"props":2070,"children":2071},{"class":525,"line":1471},[2072,2076,2081,2085,2090,2094,2099,2103,2107,2112,2116,2120,2124],{"type":421,"tag":523,"props":2073,"children":2074},{"style":745},[2075],{"type":427,"value":1145},{"type":421,"tag":523,"props":2077,"children":2078},{"style":530},[2079],{"type":427,"value":2080}," Object",{"type":421,"tag":523,"props":2082,"children":2083},{"style":536},[2084],{"type":427,"value":539},{"type":421,"tag":523,"props":2086,"children":2087},{"style":542},[2088],{"type":427,"value":2089},"getOwnPropertyDescriptor",{"type":421,"tag":523,"props":2091,"children":2092},{"style":633},[2093],{"type":427,"value":636},{"type":421,"tag":523,"props":2095,"children":2096},{"style":530},[2097],{"type":427,"value":2098},"temp",{"type":421,"tag":523,"props":2100,"children":2101},{"style":536},[2102],{"type":427,"value":722},{"type":421,"tag":523,"props":2104,"children":2105},{"style":704},[2106],{"type":427,"value":777},{"type":421,"tag":523,"props":2108,"children":2109},{"style":710},[2110],{"type":427,"value":2111},"opener",{"type":421,"tag":523,"props":2113,"children":2114},{"style":704},[2115],{"type":427,"value":707},{"type":421,"tag":523,"props":2117,"children":2118},{"style":633},[2119],{"type":427,"value":669},{"type":421,"tag":523,"props":2121,"children":2122},{"style":536},[2123],{"type":427,"value":539},{"type":421,"tag":523,"props":2125,"children":2126},{"style":530},[2127],{"type":427,"value":2128},"get\n",{"type":421,"tag":523,"props":2130,"children":2131},{"class":525,"line":1480},[2132],{"type":421,"tag":523,"props":2133,"children":2134},{"style":536},[2135],{"type":427,"value":2136},"  },\n",{"type":421,"tag":523,"props":2138,"children":2139},{"class":525,"line":1488},[2140],{"type":421,"tag":523,"props":2141,"children":2142},{"style":989},[2143],{"type":427,"value":2144},"  // 修改 Descriptor.Value 使得 window.opener 一直返回 null，\n",{"type":421,"tag":523,"props":2146,"children":2147},{"class":525,"line":1497},[2148],{"type":421,"tag":523,"props":2149,"children":2150},{"style":989},[2151],{"type":427,"value":2152},"  // 这是一种兼容，在部分浏览器中，\n",{"type":421,"tag":523,"props":2154,"children":2155},{"class":525,"line":1506},[2156],{"type":421,"tag":523,"props":2157,"children":2158},{"style":989},[2159],{"type":427,"value":2160},"  //  window.opener 是通过 value 而不是 getter 获取的值\n",{"type":421,"tag":523,"props":2162,"children":2163},{"class":525,"line":1515},[2164,2169,2173,2177,2181,2186,2190,2195],{"type":421,"tag":523,"props":2165,"children":2166},{"style":1742},[2167],{"type":427,"value":2168},"  valueGenerator",{"type":421,"tag":523,"props":2170,"children":2171},{"style":536},[2172],{"type":427,"value":577},{"type":421,"tag":523,"props":2174,"children":2175},{"style":553},[2176],{"type":427,"value":556},{"type":421,"tag":523,"props":2178,"children":2179},{"style":536},[2180],{"type":427,"value":566},{"type":421,"tag":523,"props":2182,"children":2183},{"style":580},[2184],{"type":427,"value":2185},"original",{"type":421,"tag":523,"props":2187,"children":2188},{"style":536},[2189],{"type":427,"value":722},{"type":421,"tag":523,"props":2191,"children":2192},{"style":580},[2193],{"type":427,"value":2194}," notify",{"type":421,"tag":523,"props":2196,"children":2197},{"style":536},[2198],{"type":427,"value":2199},"}){\n",{"type":421,"tag":523,"props":2201,"children":2202},{"class":525,"line":1569},[2203,2208,2212,2216,2220,2224,2228],{"type":421,"tag":523,"props":2204,"children":2205},{"style":745},[2206],{"type":427,"value":2207},"    if",{"type":421,"tag":523,"props":2209,"children":2210},{"style":633},[2211],{"type":427,"value":753},{"type":421,"tag":523,"props":2213,"children":2214},{"style":530},[2215],{"type":427,"value":2185},{"type":421,"tag":523,"props":2217,"children":2218},{"style":547},[2219],{"type":427,"value":772},{"type":421,"tag":523,"props":2221,"children":2222},{"style":1981},[2223],{"type":427,"value":1984},{"type":421,"tag":523,"props":2225,"children":2226},{"style":633},[2227],{"type":427,"value":669},{"type":421,"tag":523,"props":2229,"children":2230},{"style":536},[2231],{"type":427,"value":795},{"type":421,"tag":523,"props":2233,"children":2234},{"class":525,"line":1602},[2235,2240,2244,2248,2252,2256],{"type":421,"tag":523,"props":2236,"children":2237},{"style":542},[2238],{"type":427,"value":2239},"      notify",{"type":421,"tag":523,"props":2241,"children":2242},{"style":633},[2243],{"type":427,"value":636},{"type":421,"tag":523,"props":2245,"children":2246},{"style":704},[2247],{"type":427,"value":707},{"type":421,"tag":523,"props":2249,"children":2250},{"style":710},[2251],{"type":427,"value":1621},{"type":421,"tag":523,"props":2253,"children":2254},{"style":704},[2255],{"type":427,"value":707},{"type":421,"tag":523,"props":2257,"children":2258},{"style":633},[2259],{"type":427,"value":679},{"type":421,"tag":523,"props":2261,"children":2262},{"class":525,"line":1632},[2263],{"type":421,"tag":523,"props":2264,"children":2265},{"style":536},[2266],{"type":427,"value":2068},{"type":421,"tag":523,"props":2268,"children":2269},{"class":525,"line":1640},[2270,2274],{"type":421,"tag":523,"props":2271,"children":2272},{"style":745},[2273],{"type":427,"value":1145},{"type":421,"tag":523,"props":2275,"children":2276},{"style":1981},[2277],{"type":427,"value":2041},{"type":421,"tag":523,"props":2279,"children":2280},{"class":525,"line":1654},[2281],{"type":421,"tag":523,"props":2282,"children":2283},{"style":536},[2284],{"type":427,"value":878},{"type":421,"tag":523,"props":2286,"children":2287},{"class":525,"line":1672},[2288],{"type":421,"tag":523,"props":2289,"children":2290},{"style":536},[2291],{"type":427,"value":887},{"type":421,"tag":429,"props":2293,"children":2295},{"id":2294},"canvas",[2296],{"type":427,"value":2297},"Canvas",{"type":421,"tag":435,"props":2299,"children":2300},{},[2301],{"type":427,"value":2302},"伪造了 getContext、getDataURL 等 API，并替代了原本正常的 API。",{"type":421,"tag":429,"props":2304,"children":2306},{"id":2305},"相关链接",[2307],{"type":427,"value":2305},{"type":421,"tag":441,"props":2309,"children":2310},{},[2311],{"type":421,"tag":445,"props":2312,"children":2313},{},[2314],{"type":421,"tag":917,"props":2315,"children":2318},{"href":2316,"rel":2317},"https://github.com/kkapsner/CanvasBlocker",[921],[2319],{"type":427,"value":2320},"CanvasBlocker",{"type":421,"tag":2322,"props":2323,"children":2324},"style",{},[2325],{"type":427,"value":2326},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":415,"searchDepth":601,"depth":601,"links":2328},[2329,2330,2331,2334,2335,2336],{"id":431,"depth":601,"text":431},{"id":497,"depth":601,"text":500},{"id":890,"depth":601,"text":469,"children":2332},[2333],{"id":901,"depth":682,"text":904},{"id":1688,"depth":601,"text":1691},{"id":2294,"depth":601,"text":2297},{"id":2305,"depth":601,"text":2305},"markdown","content:8.source-code:_fingerprint:canvas-blocker.md","content","8.source-code/_fingerprint/canvas-blocker.md","8.source-code/_fingerprint/canvas-blocker","md",[2344,2347],{"_path":2345,"title":2346,"description":415},"/source-code/_es/object-assign","Object.prototype.assign",{"_path":2348,"title":2349,"description":415},"/source-code/_js/element-plus","ElementPlus",1732808130239]