[{"data":1,"prerenderedAt":6461},["Reactive",2],{"navigation":3,"/source-code/_cpp/kingdb":386,"/source-code/_cpp/kingdb-surround":6456},[4,32,80,96,123,129,135,369,375,381],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🌃 长夜梦","/flows/long-night-dream",{"title":15,"_path":16},"🌌 万物联结与幸福感","/flows/everything",{"title":18,"_path":19},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":21,"_path":22},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":24,"_path":25},"🌧️ 我的腼腆","/flows/shy",{"title":27,"_path":28},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":30,"_path":31},"📝 心流归档","/flows/fold",{"title":33,"_path":34,"children":35},"技术博客 / Coder","/articles",[36,38,41,44,47,50,53,56,59,62,65,68,71,74,77],{"title":37,"_path":34},"🦁 为什么我要写博客",{"title":39,"_path":40},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":42,"_path":43},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":45,"_path":46},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":48,"_path":49},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":51,"_path":52},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":54,"_path":55},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":57,"_path":58},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":60,"_path":61},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":63,"_path":64},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":66,"_path":67},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":69,"_path":70},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":72,"_path":73},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":75,"_path":76},"🚝 四十二篇系列","/articles/fourty-two",{"title":78,"_path":79},"📝 技术博客归档","/articles/fold",{"title":81,"_path":82,"children":83},"造物 / Make","/tools",[84,87,90,93],{"title":85,"_path":86},"🌐 AnySort","/tools/anysort",{"title":88,"_path":89},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":91,"_path":92},"👓 Crapto","/tools/crypto-inline",{"title":94,"_path":95},"🖨️ any-to-base64","/tools/any-to-base64",{"title":97,"_path":98,"children":99},"吉他剧场 / Music","/music",[100,102,105,108,111,114,117,120],{"title":101,"_path":98},"🎸 FingerStyle！",{"title":103,"_path":104},"🌬️ 等待的风","/music/wind",{"title":106,"_path":107},"💕 约定的海洋","/music/ocean",{"title":109,"_path":110},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":112,"_path":113},"🌏 残酷天使的行动纲领","/music/eva",{"title":115,"_path":116},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":118,"_path":119},"🍷 Wu Wei","/music/wu-wei",{"title":121,"_path":122},"🌅 无题","/music/untitled",{"title":124,"_path":125,"children":126},"画点什么 / Paint","/paint",[127],{"title":128,"_path":125},"🚧 正在施工",{"title":130,"_path":131,"children":132},"知识地图 / Maps","/maps",[133],{"title":134,"_path":131},"🏁 知识地图",{"title":136,"_path":137,"children":138},"零散的笔记 / Gists","/gists",[139,141,144,147,150,153,156,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255,258,261,264,267,270,273,276,279,282,285,288,291,294,297,300,303,306,309,312,315,318,321,324,327,330,333,336,339,342,345,348,351,354,357,360,363,366],{"title":140,"_path":137},"🧊 Gists",{"title":142,"_path":143},"网站的可访问性","/gists/accessibility",{"title":145,"_path":146},"Bit","/gists/bit",{"title":148,"_path":149},"图片模糊","/gists/blur",{"title":151,"_path":152},"渲染相关笔记","/gists/c4d",{"title":154,"_path":155},"CDN 问题记录","/gists/cdn",{"title":157,"_path":158},"消毒剂","/gists/cleaner",{"title":160,"_path":161},"Windows Command","/gists/cmd",{"title":163,"_path":164},"Command","/gists/command",{"title":166,"_path":167},"复杂科学","/gists/complexity-science",{"title":169,"_path":170},"宇宙","/gists/cosmos",{"title":172,"_path":173},"C++","/gists/cpp",{"title":175,"_path":176},"Data Structure","/gists/data-structure",{"title":178,"_path":179},"DEPRESSION","/gists/depression",{"title":181,"_path":182},"设计模式","/gists/design-patterns",{"title":184,"_path":185},"Developer Experience","/gists/developer-experience",{"title":187,"_path":188},"Device Metrics","/gists/device-metrix",{"title":190,"_path":191},"ECMAScript Language Specification","/gists/ecmascript-specification",{"title":193,"_path":194},"正则表达式","/gists/eegex",{"title":196,"_path":197},"Emoji","/gists/emoji",{"title":199,"_path":200},"工程","/gists/engineering",{"title":202,"_path":203},"熵","/gists/entropy",{"title":205,"_path":206},"Environment","/gists/environment",{"title":208,"_path":209},"Erlang","/gists/erlang",{"title":211,"_path":212},"逃离塔克夫","/gists/escape-from-tarkov",{"title":214,"_path":215},"ESNext (ES6-ES11)","/gists/esnext",{"title":217,"_path":218},"Eval！","/gists/eval",{"title":220,"_path":221},"Flutter","/gists/flutter",{"title":223,"_path":224},"字体","/gists/font",{"title":226,"_path":227},"JS 函数式编程","/gists/functional",{"title":229,"_path":230},"Google C++ Standard","/gists/google-cpp-standard",{"title":232,"_path":233},"双向链接完全体","/gists/graph",{"title":235,"_path":236},"Hardwares","/gists/hardwares",{"title":238,"_path":239},"哈希冲突","/gists/hash-collision",{"title":241,"_path":242},"信息设计","/gists/information-design",{"title":244,"_path":245},"InstantPage","/gists/instant.page",{"title":247,"_path":248},"ISUX 遇见大数据可视化系列","/gists/isux-data-visualization",{"title":250,"_path":251},"KVStore","/gists/key-value-db",{"title":253,"_path":254},"Kubernetes","/gists/kubernetes",{"title":256,"_path":257},"Makefile","/gists/makefile",{"title":259,"_path":260},"Markdown Inline Style","/gists/markdown-nice",{"title":262,"_path":263},"小程序","/gists/miniapp",{"title":265,"_path":266},"减小页面快照体积","/gists/minify-html",{"title":268,"_path":269},"mklink","/gists/mklink",{"title":271,"_path":272},"Mock","/gists/mock",{"title":274,"_path":275},"多端应用","/gists/multy-end-app",{"title":277,"_path":278},"神经科学","/gists/neuroscience",{"title":280,"_path":281},"OO","/gists/oo",{"title":283,"_path":284},"Opinioned Personal Folder","/gists/opinioned-personal-folder",{"title":286,"_path":287},"人物","/gists/person",{"title":289,"_path":290},"PInvoke","/gists/pinvoke",{"title":292,"_path":293},"像素","/gists/pixel",{"title":295,"_path":296},"PowerShell","/gists/powershell",{"title":298,"_path":299},"量子","/gists/quantum",{"title":301,"_path":302},"保持好奇心","/gists/questions",{"title":304,"_path":305},"React Native","/gists/react-native",{"title":307,"_path":308},"博客改版碰到的浏览器平滑滚动问题","/gists/scroll",{"title":310,"_path":311},"SEO","/gists/seo",{"title":313,"_path":314},"Shader","/gists/shader",{"title":316,"_path":317},"Shape Up","/gists/shape-up",{"title":319,"_path":320},"睡觉","/gists/sleep",{"title":322,"_path":323},"States","/gists/states",{"title":325,"_path":326},"Storage","/gists/storage",{"title":328,"_path":329},"音视频流处理","/gists/stream-cli",{"title":331,"_path":332},"Symbol","/gists/symbol",{"title":334,"_path":335},"系统论","/gists/systems-theory",{"title":337,"_path":338},"Taro","/gists/taro",{"title":340,"_path":341},"任务切片","/gists/task-slice",{"title":343,"_path":344},"技术偏好","/gists/tech-dudge",{"title":346,"_path":347},"Untitled","/gists/untitled",{"title":349,"_path":350},"可变字体","/gists/variable-font",{"title":352,"_path":353},"视觉错觉","/gists/visual-illusion",{"title":355,"_path":356},"SS(SSR)","/gists/vpn",{"title":358,"_path":359},"VS Code 插件开发","/gists/vscode-plugin",{"title":361,"_path":362},"Web Components","/gists/web-components",{"title":364,"_path":365},"Windows","/gists/windows",{"title":367,"_path":368},"查缺补漏","/gists/wrong",{"title":370,"_path":371,"children":372},"代码笔记 / Gists","/source-code",[373],{"title":374,"_path":371},"🚄 代码笔记",{"title":376,"_path":377,"children":378},"我 / Abount","/hire",[379],{"title":380,"_path":377},"📬 技术简历",{"title":382,"_path":383,"children":384},"todo","/todo",[385],{"title":382,"_path":383},{"_path":387,"_dir":388,"_draft":389,"_partial":390,"_locale":391,"title":392,"description":391,"body":393,"_type":6451,"_id":6452,"_source":6453,"_file":6454,"_extension":6455},"/source-code/_cpp/kingdb","_cpp",false,true,"","KingDB",{"type":394,"children":395,"toc":6445},"root",[396,404,410,416,432,437,461,466,471,476,1335,1340,1348,1353,1358,1363,1369,1374,1795,1800,1805,2255,2260,2361,2366,2371,2376,2914,2920,2925,3192,3198,3203,3448,3453,3466,3471,3738,3743,3748,4459,4464,4645,4649,4654,5272,5277,5282,5335,5340,5359,5732,5737,5902,5907,5912,6439],{"type":397,"tag":398,"props":399,"children":401},"element","h1",{"id":400},"kingdb",[402],{"type":403,"value":392},"text",{"type":397,"tag":405,"props":406,"children":408},"h2",{"id":407},"概述",[409],{"type":403,"value":407},{"type":397,"tag":411,"props":412,"children":413},"p",{},[414],{"type":403,"value":415},"源码分两部分，从相关的测试文件，到核心源码。参考 IKVS 系列文章给的架构图，核心源码的阅读顺序沿着 Put、Delete、Get 三个接口，由 Database 一路向 Buffer、Event Manager、Storage Engine、HSTable Manager、File System 相关、Index 前进。最好再看相关快照、迭代器、Multipart 等部分。期间如果遇到简单的帮助函数会先讲帮助函数。",{"type":397,"tag":411,"props":417,"children":418},{},[419,421,430],{"type":403,"value":420},"本来想从第一个 Git Commit 开始看起的。但我 checkout 过去之后，碰到了一堆编译问题，根本跑不通，索性就直接回到 master 来看最新代码了。本文章的源码快照见 ",{"type":397,"tag":422,"props":423,"children":427},"a",{"href":424,"rel":425},"https://github.com/goossaert/kingdb/tree/58994280e789fc7248d61371f03a6c04c844c197",[426],"nofollow",[428],{"type":403,"value":429},"KingDB@58994",{"type":403,"value":431},"。阅读源码前可以先看一下 KingDB 的 Readme：doc/kingdb.md 以及 doc/kingserver.md。",{"type":397,"tag":411,"props":433,"children":434},{},[435],{"type":403,"value":436},"下文可能出现的缩写：",{"type":397,"tag":438,"props":439,"children":440},"ul",{},[441,447],{"type":397,"tag":442,"props":443,"children":444},"li",{},[445],{"type":403,"value":446},"KDB：KingDB，泛指，有时指 KingDB 程序，有时指 KingDB 源码。",{"type":397,"tag":442,"props":448,"children":449},{},[450,452,459],{"type":403,"value":451},"IKVS：作者相关 KingDB 做的一些调研及笔记的博客系列。这个系列从 13 年开始写，现在还没写完... 见 ",{"type":397,"tag":422,"props":453,"children":456},{"href":454,"rel":455},"https://codecapsule.com/2012/11/07/ikvs-implementing-a-key-value-store-table-of-contents/",[426],[457],{"type":403,"value":458},"IKVS",{"type":403,"value":460},"。",{"type":397,"tag":411,"props":462,"children":463},{},[464],{"type":403,"value":465},"另，为了简便起见，下文给出的代码很可能并非原本的代码，而是截取或经过剔除后的部分代码。比如说，去除了某函数中的错误处理，使之代码更短，更容易展示。",{"type":397,"tag":405,"props":467,"children":469},{"id":468},"从测试开始",[470],{"type":403,"value":468},{"type":397,"tag":411,"props":472,"children":473},{},[474],{"type":403,"value":475},"Emmanuel 给了一个典型的 KDB 用户使用示例，见 unit-tests/kingdb_user.cc。通过此示例，能大概了解 KDB 的接口及如何使用该接口。创建数据库、存入、读取前都需要创建对应的参数配置 Options；这些动作通过 Status 对象来回传操作成功与否。",{"type":397,"tag":477,"props":478,"children":482},"pre",{"code":479,"language":480,"meta":391,"className":481,"style":391},"#include \u003Ckingdb/kdb.h>\n\nint main() {\n  kdb::Status s;\n  kdb::DatabaseOptions db_options;\n  kdb::Database db(db_options, \"mylocaldb\");\n  s = db.Open();\n  if (!s.IsOK()) {\n    fprintf(stderr, \"Could not open the database: %s\\n\", s.ToString().c_str());\n    exit(1);\n  }\n\n  std::string key1(\"key1\");\n  std::string value1(\"value1\");\n\n  kdb::WriteOptions write_options;\n  s = db.Put(write_options, key1, value1);\n\n  kdb::ReadOptions read_options;\n  std::string out_str;\n  s = db.Get(read_options, key1, &out_str);\n  if (s.IsOK() && out_str == \"value1\") {\n    printf(\"Data successfully stored and retrieved\\n\"); \n  } else {\n    printf(\"An error occurred\\n\"); \n  }\n\n  return 0;\n}\n","cpp","language-cpp shiki shiki-themes material-theme-lighter github-light github-dark monokai",[483],{"type":397,"tag":484,"props":485,"children":486},"code",{"__ignoreMap":391},[487,516,525,552,578,599,656,691,733,814,837,846,854,897,938,946,967,1023,1031,1052,1073,1133,1197,1237,1255,1292,1300,1308,1326],{"type":397,"tag":488,"props":489,"children":492},"span",{"class":490,"line":491},"line",1,[493,499,505,511],{"type":397,"tag":488,"props":494,"children":496},{"style":495},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:inherit",[497],{"type":403,"value":498},"#include",{"type":397,"tag":488,"props":500,"children":502},{"style":501},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[503],{"type":403,"value":504}," \u003C",{"type":397,"tag":488,"props":506,"children":508},{"style":507},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[509],{"type":403,"value":510},"kingdb/kdb.h",{"type":397,"tag":488,"props":512,"children":513},{"style":501},[514],{"type":403,"value":515},">\n",{"type":397,"tag":488,"props":517,"children":519},{"class":490,"line":518},2,[520],{"type":397,"tag":488,"props":521,"children":522},{"emptyLinePlaceholder":390},[523],{"type":403,"value":524},"\n",{"type":397,"tag":488,"props":526,"children":528},{"class":490,"line":527},3,[529,535,541,547],{"type":397,"tag":488,"props":530,"children":532},{"style":531},"--shiki-light:#9C3EDA;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#66D9EF;--shiki-light-font-style:inherit;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[533],{"type":403,"value":534},"int",{"type":397,"tag":488,"props":536,"children":538},{"style":537},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[539],{"type":403,"value":540}," main",{"type":397,"tag":488,"props":542,"children":544},{"style":543},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[545],{"type":403,"value":546},"()",{"type":397,"tag":488,"props":548,"children":549},{"style":543},[550],{"type":403,"value":551}," {\n",{"type":397,"tag":488,"props":553,"children":555},{"class":490,"line":554},4,[556,562,567,573],{"type":397,"tag":488,"props":557,"children":559},{"style":558},"--shiki-light:#E2931D;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E;--shiki-light-text-decoration:inherit;--shiki-default-text-decoration:inherit;--shiki-dark-text-decoration:inherit;--shiki-sepia-text-decoration:underline",[560],{"type":403,"value":561},"  kdb",{"type":397,"tag":488,"props":563,"children":564},{"style":543},[565],{"type":403,"value":566},"::",{"type":397,"tag":488,"props":568,"children":570},{"style":569},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[571],{"type":403,"value":572},"Status s",{"type":397,"tag":488,"props":574,"children":575},{"style":543},[576],{"type":403,"value":577},";\n",{"type":397,"tag":488,"props":579,"children":581},{"class":490,"line":580},5,[582,586,590,595],{"type":397,"tag":488,"props":583,"children":584},{"style":558},[585],{"type":403,"value":561},{"type":397,"tag":488,"props":587,"children":588},{"style":543},[589],{"type":403,"value":566},{"type":397,"tag":488,"props":591,"children":592},{"style":569},[593],{"type":403,"value":594},"DatabaseOptions db_options",{"type":397,"tag":488,"props":596,"children":597},{"style":543},[598],{"type":403,"value":577},{"type":397,"tag":488,"props":600,"children":602},{"class":490,"line":601},6,[603,607,611,616,621,626,631,636,641,646,651],{"type":397,"tag":488,"props":604,"children":605},{"style":558},[606],{"type":403,"value":561},{"type":397,"tag":488,"props":608,"children":609},{"style":543},[610],{"type":403,"value":566},{"type":397,"tag":488,"props":612,"children":613},{"style":569},[614],{"type":403,"value":615},"Database ",{"type":397,"tag":488,"props":617,"children":618},{"style":537},[619],{"type":403,"value":620},"db",{"type":397,"tag":488,"props":622,"children":623},{"style":543},[624],{"type":403,"value":625},"(",{"type":397,"tag":488,"props":627,"children":628},{"style":569},[629],{"type":403,"value":630},"db_options",{"type":397,"tag":488,"props":632,"children":633},{"style":543},[634],{"type":403,"value":635},",",{"type":397,"tag":488,"props":637,"children":638},{"style":501},[639],{"type":403,"value":640}," \"",{"type":397,"tag":488,"props":642,"children":643},{"style":507},[644],{"type":403,"value":645},"mylocaldb",{"type":397,"tag":488,"props":647,"children":648},{"style":501},[649],{"type":403,"value":650},"\"",{"type":397,"tag":488,"props":652,"children":653},{"style":543},[654],{"type":403,"value":655},");\n",{"type":397,"tag":488,"props":657,"children":659},{"class":490,"line":658},7,[660,665,671,676,681,686],{"type":397,"tag":488,"props":661,"children":662},{"style":569},[663],{"type":403,"value":664},"  s ",{"type":397,"tag":488,"props":666,"children":668},{"style":667},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[669],{"type":403,"value":670},"=",{"type":397,"tag":488,"props":672,"children":673},{"style":569},[674],{"type":403,"value":675}," db",{"type":397,"tag":488,"props":677,"children":678},{"style":543},[679],{"type":403,"value":680},".",{"type":397,"tag":488,"props":682,"children":683},{"style":537},[684],{"type":403,"value":685},"Open",{"type":397,"tag":488,"props":687,"children":688},{"style":543},[689],{"type":403,"value":690},"();\n",{"type":397,"tag":488,"props":692,"children":694},{"class":490,"line":693},8,[695,700,705,710,715,719,724,729],{"type":397,"tag":488,"props":696,"children":697},{"style":495},[698],{"type":403,"value":699},"  if",{"type":397,"tag":488,"props":701,"children":702},{"style":543},[703],{"type":403,"value":704}," (",{"type":397,"tag":488,"props":706,"children":707},{"style":667},[708],{"type":403,"value":709},"!",{"type":397,"tag":488,"props":711,"children":712},{"style":569},[713],{"type":403,"value":714},"s",{"type":397,"tag":488,"props":716,"children":717},{"style":543},[718],{"type":403,"value":680},{"type":397,"tag":488,"props":720,"children":721},{"style":537},[722],{"type":403,"value":723},"IsOK",{"type":397,"tag":488,"props":725,"children":726},{"style":543},[727],{"type":403,"value":728},"())",{"type":397,"tag":488,"props":730,"children":731},{"style":543},[732],{"type":403,"value":551},{"type":397,"tag":488,"props":734,"children":736},{"class":490,"line":735},9,[737,742,746,752,756,760,765,771,777,781,785,790,794,799,804,809],{"type":397,"tag":488,"props":738,"children":739},{"style":537},[740],{"type":403,"value":741},"    fprintf",{"type":397,"tag":488,"props":743,"children":744},{"style":543},[745],{"type":403,"value":625},{"type":397,"tag":488,"props":747,"children":749},{"style":748},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[750],{"type":403,"value":751},"stderr",{"type":397,"tag":488,"props":753,"children":754},{"style":543},[755],{"type":403,"value":635},{"type":397,"tag":488,"props":757,"children":758},{"style":501},[759],{"type":403,"value":640},{"type":397,"tag":488,"props":761,"children":762},{"style":507},[763],{"type":403,"value":764},"Could not open the database: ",{"type":397,"tag":488,"props":766,"children":768},{"style":767},"--shiki-light:#E53935;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[769],{"type":403,"value":770},"%s",{"type":397,"tag":488,"props":772,"children":774},{"style":773},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[775],{"type":403,"value":776},"\\n",{"type":397,"tag":488,"props":778,"children":779},{"style":501},[780],{"type":403,"value":650},{"type":397,"tag":488,"props":782,"children":783},{"style":543},[784],{"type":403,"value":635},{"type":397,"tag":488,"props":786,"children":787},{"style":569},[788],{"type":403,"value":789}," s",{"type":397,"tag":488,"props":791,"children":792},{"style":543},[793],{"type":403,"value":680},{"type":397,"tag":488,"props":795,"children":796},{"style":537},[797],{"type":403,"value":798},"ToString",{"type":397,"tag":488,"props":800,"children":801},{"style":543},[802],{"type":403,"value":803},"().",{"type":397,"tag":488,"props":805,"children":806},{"style":537},[807],{"type":403,"value":808},"c_str",{"type":397,"tag":488,"props":810,"children":811},{"style":543},[812],{"type":403,"value":813},"());\n",{"type":397,"tag":488,"props":815,"children":817},{"class":490,"line":816},10,[818,823,827,833],{"type":397,"tag":488,"props":819,"children":820},{"style":537},[821],{"type":403,"value":822},"    exit",{"type":397,"tag":488,"props":824,"children":825},{"style":543},[826],{"type":403,"value":625},{"type":397,"tag":488,"props":828,"children":830},{"style":829},"--shiki-light:#F76D47;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[831],{"type":403,"value":832},"1",{"type":397,"tag":488,"props":834,"children":835},{"style":543},[836],{"type":403,"value":655},{"type":397,"tag":488,"props":838,"children":840},{"class":490,"line":839},11,[841],{"type":397,"tag":488,"props":842,"children":843},{"style":543},[844],{"type":403,"value":845},"  }\n",{"type":397,"tag":488,"props":847,"children":849},{"class":490,"line":848},12,[850],{"type":397,"tag":488,"props":851,"children":852},{"emptyLinePlaceholder":390},[853],{"type":403,"value":524},{"type":397,"tag":488,"props":855,"children":857},{"class":490,"line":856},13,[858,863,867,872,877,881,885,889,893],{"type":397,"tag":488,"props":859,"children":860},{"style":558},[861],{"type":403,"value":862},"  std",{"type":397,"tag":488,"props":864,"children":865},{"style":543},[866],{"type":403,"value":566},{"type":397,"tag":488,"props":868,"children":869},{"style":569},[870],{"type":403,"value":871},"string ",{"type":397,"tag":488,"props":873,"children":874},{"style":537},[875],{"type":403,"value":876},"key1",{"type":397,"tag":488,"props":878,"children":879},{"style":543},[880],{"type":403,"value":625},{"type":397,"tag":488,"props":882,"children":883},{"style":501},[884],{"type":403,"value":650},{"type":397,"tag":488,"props":886,"children":887},{"style":507},[888],{"type":403,"value":876},{"type":397,"tag":488,"props":890,"children":891},{"style":501},[892],{"type":403,"value":650},{"type":397,"tag":488,"props":894,"children":895},{"style":543},[896],{"type":403,"value":655},{"type":397,"tag":488,"props":898,"children":900},{"class":490,"line":899},14,[901,905,909,913,918,922,926,930,934],{"type":397,"tag":488,"props":902,"children":903},{"style":558},[904],{"type":403,"value":862},{"type":397,"tag":488,"props":906,"children":907},{"style":543},[908],{"type":403,"value":566},{"type":397,"tag":488,"props":910,"children":911},{"style":569},[912],{"type":403,"value":871},{"type":397,"tag":488,"props":914,"children":915},{"style":537},[916],{"type":403,"value":917},"value1",{"type":397,"tag":488,"props":919,"children":920},{"style":543},[921],{"type":403,"value":625},{"type":397,"tag":488,"props":923,"children":924},{"style":501},[925],{"type":403,"value":650},{"type":397,"tag":488,"props":927,"children":928},{"style":507},[929],{"type":403,"value":917},{"type":397,"tag":488,"props":931,"children":932},{"style":501},[933],{"type":403,"value":650},{"type":397,"tag":488,"props":935,"children":936},{"style":543},[937],{"type":403,"value":655},{"type":397,"tag":488,"props":939,"children":941},{"class":490,"line":940},15,[942],{"type":397,"tag":488,"props":943,"children":944},{"emptyLinePlaceholder":390},[945],{"type":403,"value":524},{"type":397,"tag":488,"props":947,"children":949},{"class":490,"line":948},16,[950,954,958,963],{"type":397,"tag":488,"props":951,"children":952},{"style":558},[953],{"type":403,"value":561},{"type":397,"tag":488,"props":955,"children":956},{"style":543},[957],{"type":403,"value":566},{"type":397,"tag":488,"props":959,"children":960},{"style":569},[961],{"type":403,"value":962},"WriteOptions write_options",{"type":397,"tag":488,"props":964,"children":965},{"style":543},[966],{"type":403,"value":577},{"type":397,"tag":488,"props":968,"children":970},{"class":490,"line":969},17,[971,975,979,983,987,992,996,1001,1005,1010,1014,1019],{"type":397,"tag":488,"props":972,"children":973},{"style":569},[974],{"type":403,"value":664},{"type":397,"tag":488,"props":976,"children":977},{"style":667},[978],{"type":403,"value":670},{"type":397,"tag":488,"props":980,"children":981},{"style":569},[982],{"type":403,"value":675},{"type":397,"tag":488,"props":984,"children":985},{"style":543},[986],{"type":403,"value":680},{"type":397,"tag":488,"props":988,"children":989},{"style":537},[990],{"type":403,"value":991},"Put",{"type":397,"tag":488,"props":993,"children":994},{"style":543},[995],{"type":403,"value":625},{"type":397,"tag":488,"props":997,"children":998},{"style":569},[999],{"type":403,"value":1000},"write_options",{"type":397,"tag":488,"props":1002,"children":1003},{"style":543},[1004],{"type":403,"value":635},{"type":397,"tag":488,"props":1006,"children":1007},{"style":569},[1008],{"type":403,"value":1009}," key1",{"type":397,"tag":488,"props":1011,"children":1012},{"style":543},[1013],{"type":403,"value":635},{"type":397,"tag":488,"props":1015,"children":1016},{"style":569},[1017],{"type":403,"value":1018}," value1",{"type":397,"tag":488,"props":1020,"children":1021},{"style":543},[1022],{"type":403,"value":655},{"type":397,"tag":488,"props":1024,"children":1026},{"class":490,"line":1025},18,[1027],{"type":397,"tag":488,"props":1028,"children":1029},{"emptyLinePlaceholder":390},[1030],{"type":403,"value":524},{"type":397,"tag":488,"props":1032,"children":1034},{"class":490,"line":1033},19,[1035,1039,1043,1048],{"type":397,"tag":488,"props":1036,"children":1037},{"style":558},[1038],{"type":403,"value":561},{"type":397,"tag":488,"props":1040,"children":1041},{"style":543},[1042],{"type":403,"value":566},{"type":397,"tag":488,"props":1044,"children":1045},{"style":569},[1046],{"type":403,"value":1047},"ReadOptions read_options",{"type":397,"tag":488,"props":1049,"children":1050},{"style":543},[1051],{"type":403,"value":577},{"type":397,"tag":488,"props":1053,"children":1055},{"class":490,"line":1054},20,[1056,1060,1064,1069],{"type":397,"tag":488,"props":1057,"children":1058},{"style":558},[1059],{"type":403,"value":862},{"type":397,"tag":488,"props":1061,"children":1062},{"style":543},[1063],{"type":403,"value":566},{"type":397,"tag":488,"props":1065,"children":1066},{"style":569},[1067],{"type":403,"value":1068},"string out_str",{"type":397,"tag":488,"props":1070,"children":1071},{"style":543},[1072],{"type":403,"value":577},{"type":397,"tag":488,"props":1074,"children":1076},{"class":490,"line":1075},21,[1077,1081,1085,1089,1093,1098,1102,1107,1111,1115,1119,1124,1129],{"type":397,"tag":488,"props":1078,"children":1079},{"style":569},[1080],{"type":403,"value":664},{"type":397,"tag":488,"props":1082,"children":1083},{"style":667},[1084],{"type":403,"value":670},{"type":397,"tag":488,"props":1086,"children":1087},{"style":569},[1088],{"type":403,"value":675},{"type":397,"tag":488,"props":1090,"children":1091},{"style":543},[1092],{"type":403,"value":680},{"type":397,"tag":488,"props":1094,"children":1095},{"style":537},[1096],{"type":403,"value":1097},"Get",{"type":397,"tag":488,"props":1099,"children":1100},{"style":543},[1101],{"type":403,"value":625},{"type":397,"tag":488,"props":1103,"children":1104},{"style":569},[1105],{"type":403,"value":1106},"read_options",{"type":397,"tag":488,"props":1108,"children":1109},{"style":543},[1110],{"type":403,"value":635},{"type":397,"tag":488,"props":1112,"children":1113},{"style":569},[1114],{"type":403,"value":1009},{"type":397,"tag":488,"props":1116,"children":1117},{"style":543},[1118],{"type":403,"value":635},{"type":397,"tag":488,"props":1120,"children":1121},{"style":667},[1122],{"type":403,"value":1123}," &",{"type":397,"tag":488,"props":1125,"children":1126},{"style":569},[1127],{"type":403,"value":1128},"out_str",{"type":397,"tag":488,"props":1130,"children":1131},{"style":543},[1132],{"type":403,"value":655},{"type":397,"tag":488,"props":1134,"children":1136},{"class":490,"line":1135},22,[1137,1141,1145,1149,1153,1157,1161,1166,1171,1176,1180,1184,1188,1193],{"type":397,"tag":488,"props":1138,"children":1139},{"style":495},[1140],{"type":403,"value":699},{"type":397,"tag":488,"props":1142,"children":1143},{"style":543},[1144],{"type":403,"value":704},{"type":397,"tag":488,"props":1146,"children":1147},{"style":569},[1148],{"type":403,"value":714},{"type":397,"tag":488,"props":1150,"children":1151},{"style":543},[1152],{"type":403,"value":680},{"type":397,"tag":488,"props":1154,"children":1155},{"style":537},[1156],{"type":403,"value":723},{"type":397,"tag":488,"props":1158,"children":1159},{"style":543},[1160],{"type":403,"value":546},{"type":397,"tag":488,"props":1162,"children":1163},{"style":667},[1164],{"type":403,"value":1165}," &&",{"type":397,"tag":488,"props":1167,"children":1168},{"style":569},[1169],{"type":403,"value":1170}," out_str ",{"type":397,"tag":488,"props":1172,"children":1173},{"style":667},[1174],{"type":403,"value":1175},"==",{"type":397,"tag":488,"props":1177,"children":1178},{"style":501},[1179],{"type":403,"value":640},{"type":397,"tag":488,"props":1181,"children":1182},{"style":507},[1183],{"type":403,"value":917},{"type":397,"tag":488,"props":1185,"children":1186},{"style":501},[1187],{"type":403,"value":650},{"type":397,"tag":488,"props":1189,"children":1190},{"style":543},[1191],{"type":403,"value":1192},")",{"type":397,"tag":488,"props":1194,"children":1195},{"style":543},[1196],{"type":403,"value":551},{"type":397,"tag":488,"props":1198,"children":1200},{"class":490,"line":1199},23,[1201,1206,1210,1214,1219,1223,1227,1232],{"type":397,"tag":488,"props":1202,"children":1203},{"style":537},[1204],{"type":403,"value":1205},"    printf",{"type":397,"tag":488,"props":1207,"children":1208},{"style":543},[1209],{"type":403,"value":625},{"type":397,"tag":488,"props":1211,"children":1212},{"style":501},[1213],{"type":403,"value":650},{"type":397,"tag":488,"props":1215,"children":1216},{"style":507},[1217],{"type":403,"value":1218},"Data successfully stored and retrieved",{"type":397,"tag":488,"props":1220,"children":1221},{"style":773},[1222],{"type":403,"value":776},{"type":397,"tag":488,"props":1224,"children":1225},{"style":501},[1226],{"type":403,"value":650},{"type":397,"tag":488,"props":1228,"children":1229},{"style":543},[1230],{"type":403,"value":1231},");",{"type":397,"tag":488,"props":1233,"children":1234},{"style":748},[1235],{"type":403,"value":1236}," \n",{"type":397,"tag":488,"props":1238,"children":1240},{"class":490,"line":1239},24,[1241,1246,1251],{"type":397,"tag":488,"props":1242,"children":1243},{"style":543},[1244],{"type":403,"value":1245},"  }",{"type":397,"tag":488,"props":1247,"children":1248},{"style":495},[1249],{"type":403,"value":1250}," else",{"type":397,"tag":488,"props":1252,"children":1253},{"style":543},[1254],{"type":403,"value":551},{"type":397,"tag":488,"props":1256,"children":1258},{"class":490,"line":1257},25,[1259,1263,1267,1271,1276,1280,1284,1288],{"type":397,"tag":488,"props":1260,"children":1261},{"style":537},[1262],{"type":403,"value":1205},{"type":397,"tag":488,"props":1264,"children":1265},{"style":543},[1266],{"type":403,"value":625},{"type":397,"tag":488,"props":1268,"children":1269},{"style":501},[1270],{"type":403,"value":650},{"type":397,"tag":488,"props":1272,"children":1273},{"style":507},[1274],{"type":403,"value":1275},"An error occurred",{"type":397,"tag":488,"props":1277,"children":1278},{"style":773},[1279],{"type":403,"value":776},{"type":397,"tag":488,"props":1281,"children":1282},{"style":501},[1283],{"type":403,"value":650},{"type":397,"tag":488,"props":1285,"children":1286},{"style":543},[1287],{"type":403,"value":1231},{"type":397,"tag":488,"props":1289,"children":1290},{"style":748},[1291],{"type":403,"value":1236},{"type":397,"tag":488,"props":1293,"children":1295},{"class":490,"line":1294},26,[1296],{"type":397,"tag":488,"props":1297,"children":1298},{"style":543},[1299],{"type":403,"value":845},{"type":397,"tag":488,"props":1301,"children":1303},{"class":490,"line":1302},27,[1304],{"type":397,"tag":488,"props":1305,"children":1306},{"emptyLinePlaceholder":390},[1307],{"type":403,"value":524},{"type":397,"tag":488,"props":1309,"children":1311},{"class":490,"line":1310},28,[1312,1317,1322],{"type":397,"tag":488,"props":1313,"children":1314},{"style":495},[1315],{"type":403,"value":1316},"  return",{"type":397,"tag":488,"props":1318,"children":1319},{"style":829},[1320],{"type":403,"value":1321}," 0",{"type":397,"tag":488,"props":1323,"children":1324},{"style":543},[1325],{"type":403,"value":577},{"type":397,"tag":488,"props":1327,"children":1329},{"class":490,"line":1328},29,[1330],{"type":397,"tag":488,"props":1331,"children":1332},{"style":543},[1333],{"type":403,"value":1334},"}\n",{"type":397,"tag":411,"props":1336,"children":1337},{},[1338],{"type":403,"value":1339},"测试的入口文件是 unit-tests/test_db.cc。以我看过的 JS 库来看，这是一个基本的功能测试。编译好 KDB 之后，运行编译出的二进制文件 test_db 可以开始测试。测试结果输出到控制台，如下代码所示。",{"type":397,"tag":477,"props":1341,"children":1343},{"code":1342},"==== Test DBTest.CloseAndReopen\n==== Test DBTest.RepairInvalidDatabaseOptionFile\n==== Test DBTest.KeysWithNullBytes\n==== Test DBTest.TestStringInterface\nDatabase Options: Stage 0 - Incompressible data with LZ4 compression enabled\nDatabase Options: Stage 1 - Compressible data with LZ4 compression enabled\nDatabase Options: Stage 2 - Compression disabled\nDatabase Options: Stage 3 - 64-bit MurmurHash3\nDatabase Options: Stage 4 - Checksum verification with incompressible data\nDatabase Options: Stage 5 - Checksum verification with compressible data\nDatabase Options: Stage 6 - Checksum verification with compression disabled\nDatabase Options: Stage 7 - Synced writes\nDatabase Options: Stage 8 - Small-sized HSTables with compression disabled\nDatabase Options: Stage 9 - Small-sized HSTables with incompressible data and LZ4 compression\nDatabase Options: Stage 10 - Small-sized HSTables with compressible data and LZ4 compression\nDatabase Options: Stage 11 - Direct mode for Write Buffer (incompressible data with LZ4 compression enabled)\nDatabase Options: Stage 12 - Direct mode for Write Buffer (compressible data with LZ4 compression enabled)\n==== Test DBTest.MultipartReader\n// the same with last stages\n==== Test DBTest.SingleThreadSmallEntries\n// the same with last stages\n==== Test DBTest.SingleThreadSnapshot\n// the same with last stages\n==== Test DBTest.SingleThreadSmallEntriesCompaction\n// the same with last stages\n==== Test DBTest.SequentialIterator\n// the same with last stages\n==== Test DBTest.SingleThreadSingleLargeEntry\n// the same with last stages\n==== Test DBTest.FileUtil\nmysize: 268435456\nOK\n89 ms\nFree size: 944 GB\n==== PASSED 11 tests\n",[1344],{"type":397,"tag":484,"props":1345,"children":1346},{"__ignoreMap":391},[1347],{"type":403,"value":1342},{"type":397,"tag":411,"props":1349,"children":1350},{},[1351],{"type":403,"value":1352},"每个功能点如数据库初始化和关闭 CloseAndReopen、存入带结束符的键 KeysWithNullBytes 都使用对应继承了 DBTest 的测试类进行测试。涉及到与数据库交互的功能部分如 TestStringInterface 使用循环，遍历了所有数据库 Options 可以设置的情况（但是只是二维循环，没有测试参数间的组合）。即对应上文的 Stage 1、Stage 2...",{"type":397,"tag":411,"props":1354,"children":1355},{},[1356],{"type":403,"value":1357},"在 test_db 创建相应的测试类时，会自动调用测试套件（unit-tests/testharness.cc）中的 RegisterTest 把测试函数储存起来。以便运行测试时，通过读取环境变量来判断是否要跳过某类测试。",{"type":397,"tag":411,"props":1359,"children":1360},{},[1361],{"type":403,"value":1362},"测试代码的实现还有一些有意思的地方，以下提及。",{"type":397,"tag":1364,"props":1365,"children":1367},"h4",{"id":1366},"信号处理",[1368],{"type":403,"value":1366},{"type":397,"tag":411,"props":1370,"children":1371},{},[1372],{"type":403,"value":1373},"和数据库核心的入口函数一样，使用 signal 挂载了对 SIGSEGV、SIGABRT 信号的处理。这两个信号分别指代系统内存错误和系统中断。而处理函数非常简单，就是 IKVS 中提到的“let it die”风格：输出调用栈，立马结束程序。",{"type":397,"tag":477,"props":1375,"children":1377},{"code":1376,"language":480,"meta":391,"className":481,"style":391},"void handler(int sig) {\n  int depth_max = 20;\n  void *array[depth_max];\n  size_t depth;\n  // backtrace 将前 depth_max 层栈帧记录到 array 数组中，\n  // 再通过 backtrace_symbols_fd 输出到 stderr。\n  // 文档见：https://man7.org/linux/man-pages/man3/backtrace.3.html\n  depth = backtrace(array, depth_max);\n  fprintf(stderr, \"Error: signal %d:\\n\", sig);\n  backtrace_symbols_fd(array, depth, STDERR_FILENO);\n  exit(1);\n}\nint main() {\n  signal(SIGSEGV, handler);\n  signal(SIGABRT, handler);\n  return kdb::test::RunAllTests();\n}\n",[1378],{"type":397,"tag":484,"props":1379,"children":1380},{"__ignoreMap":391},[1381,1416,1442,1475,1492,1501,1509,1517,1555,1614,1651,1671,1678,1697,1726,1754,1788],{"type":397,"tag":488,"props":1382,"children":1383},{"class":490,"line":491},[1384,1389,1394,1398,1402,1408,1412],{"type":397,"tag":488,"props":1385,"children":1386},{"style":531},[1387],{"type":403,"value":1388},"void",{"type":397,"tag":488,"props":1390,"children":1391},{"style":537},[1392],{"type":403,"value":1393}," handler",{"type":397,"tag":488,"props":1395,"children":1396},{"style":543},[1397],{"type":403,"value":625},{"type":397,"tag":488,"props":1399,"children":1400},{"style":531},[1401],{"type":403,"value":534},{"type":397,"tag":488,"props":1403,"children":1405},{"style":1404},"--shiki-light:#90A4AE;--shiki-default:#E36209;--shiki-dark:#FFAB70;--shiki-sepia:#FD971F;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[1406],{"type":403,"value":1407}," sig",{"type":397,"tag":488,"props":1409,"children":1410},{"style":543},[1411],{"type":403,"value":1192},{"type":397,"tag":488,"props":1413,"children":1414},{"style":543},[1415],{"type":403,"value":551},{"type":397,"tag":488,"props":1417,"children":1418},{"class":490,"line":518},[1419,1424,1429,1433,1438],{"type":397,"tag":488,"props":1420,"children":1421},{"style":531},[1422],{"type":403,"value":1423},"  int",{"type":397,"tag":488,"props":1425,"children":1426},{"style":569},[1427],{"type":403,"value":1428}," depth_max ",{"type":397,"tag":488,"props":1430,"children":1431},{"style":667},[1432],{"type":403,"value":670},{"type":397,"tag":488,"props":1434,"children":1435},{"style":829},[1436],{"type":403,"value":1437}," 20",{"type":397,"tag":488,"props":1439,"children":1440},{"style":543},[1441],{"type":403,"value":577},{"type":397,"tag":488,"props":1443,"children":1444},{"class":490,"line":527},[1445,1450,1455,1460,1465,1470],{"type":397,"tag":488,"props":1446,"children":1447},{"style":531},[1448],{"type":403,"value":1449},"  void",{"type":397,"tag":488,"props":1451,"children":1452},{"style":667},[1453],{"type":403,"value":1454}," *",{"type":397,"tag":488,"props":1456,"children":1457},{"style":569},[1458],{"type":403,"value":1459},"array",{"type":397,"tag":488,"props":1461,"children":1462},{"style":543},[1463],{"type":403,"value":1464},"[",{"type":397,"tag":488,"props":1466,"children":1467},{"style":569},[1468],{"type":403,"value":1469},"depth_max",{"type":397,"tag":488,"props":1471,"children":1472},{"style":543},[1473],{"type":403,"value":1474},"];\n",{"type":397,"tag":488,"props":1476,"children":1477},{"class":490,"line":554},[1478,1483,1488],{"type":397,"tag":488,"props":1479,"children":1480},{"style":531},[1481],{"type":403,"value":1482},"  size_t",{"type":397,"tag":488,"props":1484,"children":1485},{"style":569},[1486],{"type":403,"value":1487}," depth",{"type":397,"tag":488,"props":1489,"children":1490},{"style":543},[1491],{"type":403,"value":577},{"type":397,"tag":488,"props":1493,"children":1494},{"class":490,"line":580},[1495],{"type":397,"tag":488,"props":1496,"children":1498},{"style":1497},"--shiki-light:#90A4AE;--shiki-default:#6A737D;--shiki-dark:#6A737D;--shiki-sepia:#88846F;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:inherit",[1499],{"type":403,"value":1500},"  // backtrace 将前 depth_max 层栈帧记录到 array 数组中，\n",{"type":397,"tag":488,"props":1502,"children":1503},{"class":490,"line":601},[1504],{"type":397,"tag":488,"props":1505,"children":1506},{"style":1497},[1507],{"type":403,"value":1508},"  // 再通过 backtrace_symbols_fd 输出到 stderr。\n",{"type":397,"tag":488,"props":1510,"children":1511},{"class":490,"line":658},[1512],{"type":397,"tag":488,"props":1513,"children":1514},{"style":1497},[1515],{"type":403,"value":1516},"  // 文档见：https://man7.org/linux/man-pages/man3/backtrace.3.html\n",{"type":397,"tag":488,"props":1518,"children":1519},{"class":490,"line":693},[1520,1525,1529,1534,1538,1542,1546,1551],{"type":397,"tag":488,"props":1521,"children":1522},{"style":569},[1523],{"type":403,"value":1524},"  depth ",{"type":397,"tag":488,"props":1526,"children":1527},{"style":667},[1528],{"type":403,"value":670},{"type":397,"tag":488,"props":1530,"children":1531},{"style":537},[1532],{"type":403,"value":1533}," backtrace",{"type":397,"tag":488,"props":1535,"children":1536},{"style":543},[1537],{"type":403,"value":625},{"type":397,"tag":488,"props":1539,"children":1540},{"style":569},[1541],{"type":403,"value":1459},{"type":397,"tag":488,"props":1543,"children":1544},{"style":543},[1545],{"type":403,"value":635},{"type":397,"tag":488,"props":1547,"children":1548},{"style":569},[1549],{"type":403,"value":1550}," depth_max",{"type":397,"tag":488,"props":1552,"children":1553},{"style":543},[1554],{"type":403,"value":655},{"type":397,"tag":488,"props":1556,"children":1557},{"class":490,"line":735},[1558,1563,1567,1571,1575,1579,1584,1589,1594,1598,1602,1606,1610],{"type":397,"tag":488,"props":1559,"children":1560},{"style":537},[1561],{"type":403,"value":1562},"  fprintf",{"type":397,"tag":488,"props":1564,"children":1565},{"style":543},[1566],{"type":403,"value":625},{"type":397,"tag":488,"props":1568,"children":1569},{"style":569},[1570],{"type":403,"value":751},{"type":397,"tag":488,"props":1572,"children":1573},{"style":543},[1574],{"type":403,"value":635},{"type":397,"tag":488,"props":1576,"children":1577},{"style":501},[1578],{"type":403,"value":640},{"type":397,"tag":488,"props":1580,"children":1581},{"style":507},[1582],{"type":403,"value":1583},"Error: signal ",{"type":397,"tag":488,"props":1585,"children":1586},{"style":767},[1587],{"type":403,"value":1588},"%d",{"type":397,"tag":488,"props":1590,"children":1591},{"style":507},[1592],{"type":403,"value":1593},":",{"type":397,"tag":488,"props":1595,"children":1596},{"style":773},[1597],{"type":403,"value":776},{"type":397,"tag":488,"props":1599,"children":1600},{"style":501},[1601],{"type":403,"value":650},{"type":397,"tag":488,"props":1603,"children":1604},{"style":543},[1605],{"type":403,"value":635},{"type":397,"tag":488,"props":1607,"children":1608},{"style":569},[1609],{"type":403,"value":1407},{"type":397,"tag":488,"props":1611,"children":1612},{"style":543},[1613],{"type":403,"value":655},{"type":397,"tag":488,"props":1615,"children":1616},{"class":490,"line":816},[1617,1622,1626,1630,1634,1638,1642,1647],{"type":397,"tag":488,"props":1618,"children":1619},{"style":537},[1620],{"type":403,"value":1621},"  backtrace_symbols_fd",{"type":397,"tag":488,"props":1623,"children":1624},{"style":543},[1625],{"type":403,"value":625},{"type":397,"tag":488,"props":1627,"children":1628},{"style":569},[1629],{"type":403,"value":1459},{"type":397,"tag":488,"props":1631,"children":1632},{"style":543},[1633],{"type":403,"value":635},{"type":397,"tag":488,"props":1635,"children":1636},{"style":569},[1637],{"type":403,"value":1487},{"type":397,"tag":488,"props":1639,"children":1640},{"style":543},[1641],{"type":403,"value":635},{"type":397,"tag":488,"props":1643,"children":1644},{"style":569},[1645],{"type":403,"value":1646}," STDERR_FILENO",{"type":397,"tag":488,"props":1648,"children":1649},{"style":543},[1650],{"type":403,"value":655},{"type":397,"tag":488,"props":1652,"children":1653},{"class":490,"line":839},[1654,1659,1663,1667],{"type":397,"tag":488,"props":1655,"children":1656},{"style":537},[1657],{"type":403,"value":1658},"  exit",{"type":397,"tag":488,"props":1660,"children":1661},{"style":543},[1662],{"type":403,"value":625},{"type":397,"tag":488,"props":1664,"children":1665},{"style":829},[1666],{"type":403,"value":832},{"type":397,"tag":488,"props":1668,"children":1669},{"style":543},[1670],{"type":403,"value":655},{"type":397,"tag":488,"props":1672,"children":1673},{"class":490,"line":848},[1674],{"type":397,"tag":488,"props":1675,"children":1676},{"style":543},[1677],{"type":403,"value":1334},{"type":397,"tag":488,"props":1679,"children":1680},{"class":490,"line":856},[1681,1685,1689,1693],{"type":397,"tag":488,"props":1682,"children":1683},{"style":531},[1684],{"type":403,"value":534},{"type":397,"tag":488,"props":1686,"children":1687},{"style":537},[1688],{"type":403,"value":540},{"type":397,"tag":488,"props":1690,"children":1691},{"style":543},[1692],{"type":403,"value":546},{"type":397,"tag":488,"props":1694,"children":1695},{"style":543},[1696],{"type":403,"value":551},{"type":397,"tag":488,"props":1698,"children":1699},{"class":490,"line":899},[1700,1705,1709,1714,1718,1722],{"type":397,"tag":488,"props":1701,"children":1702},{"style":537},[1703],{"type":403,"value":1704},"  signal",{"type":397,"tag":488,"props":1706,"children":1707},{"style":543},[1708],{"type":403,"value":625},{"type":397,"tag":488,"props":1710,"children":1711},{"style":569},[1712],{"type":403,"value":1713},"SIGSEGV",{"type":397,"tag":488,"props":1715,"children":1716},{"style":543},[1717],{"type":403,"value":635},{"type":397,"tag":488,"props":1719,"children":1720},{"style":569},[1721],{"type":403,"value":1393},{"type":397,"tag":488,"props":1723,"children":1724},{"style":543},[1725],{"type":403,"value":655},{"type":397,"tag":488,"props":1727,"children":1728},{"class":490,"line":940},[1729,1733,1737,1742,1746,1750],{"type":397,"tag":488,"props":1730,"children":1731},{"style":537},[1732],{"type":403,"value":1704},{"type":397,"tag":488,"props":1734,"children":1735},{"style":543},[1736],{"type":403,"value":625},{"type":397,"tag":488,"props":1738,"children":1739},{"style":569},[1740],{"type":403,"value":1741},"SIGABRT",{"type":397,"tag":488,"props":1743,"children":1744},{"style":543},[1745],{"type":403,"value":635},{"type":397,"tag":488,"props":1747,"children":1748},{"style":569},[1749],{"type":403,"value":1393},{"type":397,"tag":488,"props":1751,"children":1752},{"style":543},[1753],{"type":403,"value":655},{"type":397,"tag":488,"props":1755,"children":1756},{"class":490,"line":948},[1757,1761,1766,1770,1775,1779,1784],{"type":397,"tag":488,"props":1758,"children":1759},{"style":495},[1760],{"type":403,"value":1316},{"type":397,"tag":488,"props":1762,"children":1763},{"style":558},[1764],{"type":403,"value":1765}," kdb",{"type":397,"tag":488,"props":1767,"children":1768},{"style":543},[1769],{"type":403,"value":566},{"type":397,"tag":488,"props":1771,"children":1772},{"style":558},[1773],{"type":403,"value":1774},"test",{"type":397,"tag":488,"props":1776,"children":1777},{"style":543},[1778],{"type":403,"value":566},{"type":397,"tag":488,"props":1780,"children":1781},{"style":537},[1782],{"type":403,"value":1783},"RunAllTests",{"type":397,"tag":488,"props":1785,"children":1786},{"style":543},[1787],{"type":403,"value":690},{"type":397,"tag":488,"props":1789,"children":1790},{"class":490,"line":969},[1791],{"type":397,"tag":488,"props":1792,"children":1793},{"style":543},[1794],{"type":403,"value":1334},{"type":397,"tag":1364,"props":1796,"children":1798},{"id":1797},"使用宏创建测试类",[1799],{"type":403,"value":1797},{"type":397,"tag":411,"props":1801,"children":1802},{},[1803],{"type":403,"value":1804},"test_db 中的类是使用宏定义的。如下代码，TEST 展开的新类，继承了 DBTest，实现了 _RunIt 接口以便调用测试函数。TCONCAT 宏顾名思义就是连接，使用标记黏贴运算符把两个字符串或实参连接在一起并视为一个新的标记。_Test_ 和 name 连接在一起后，就是新类的名称，如 _Test_CloseAndReopen。",{"type":397,"tag":477,"props":1806,"children":1808},{"code":1807,"language":480,"meta":391,"className":481,"style":391},"TEST(DBTest, CloseAndReopen) {\n  // ...\n}\n#define TEST(base,name)                                                 \\\nclass TCONCAT(_Test_,name) : public base {                              \\\n public:                                                                \\\n  void _Run();                                                          \\\n  static void _RunIt() {                                                \\\n    TCONCAT(_Test_,name) t;                                             \\\n    t._Run();                                                           \\\n  }                                                                     \\\n};                                                                      \\\nbool TCONCAT(_Test_ignored_,name) =                                     \\\n  ::kdb::test::RegisterTest(#base, #name, &TCONCAT(_Test_,name)::_RunIt); \\\n",[1809],{"type":397,"tag":484,"props":1810,"children":1811},{"__ignoreMap":391},[1812,1846,1854,1861,1901,1950,1968,1990,2023,2066,2092,2104,2117,2160],{"type":397,"tag":488,"props":1813,"children":1814},{"class":490,"line":491},[1815,1820,1824,1829,1833,1838,1842],{"type":397,"tag":488,"props":1816,"children":1817},{"style":537},[1818],{"type":403,"value":1819},"TEST",{"type":397,"tag":488,"props":1821,"children":1822},{"style":543},[1823],{"type":403,"value":625},{"type":397,"tag":488,"props":1825,"children":1826},{"style":569},[1827],{"type":403,"value":1828},"DBTest",{"type":397,"tag":488,"props":1830,"children":1831},{"style":543},[1832],{"type":403,"value":635},{"type":397,"tag":488,"props":1834,"children":1835},{"style":569},[1836],{"type":403,"value":1837}," CloseAndReopen",{"type":397,"tag":488,"props":1839,"children":1840},{"style":543},[1841],{"type":403,"value":1192},{"type":397,"tag":488,"props":1843,"children":1844},{"style":543},[1845],{"type":403,"value":551},{"type":397,"tag":488,"props":1847,"children":1848},{"class":490,"line":518},[1849],{"type":397,"tag":488,"props":1850,"children":1851},{"style":1497},[1852],{"type":403,"value":1853},"  // ...\n",{"type":397,"tag":488,"props":1855,"children":1856},{"class":490,"line":527},[1857],{"type":397,"tag":488,"props":1858,"children":1859},{"style":543},[1860],{"type":403,"value":1334},{"type":397,"tag":488,"props":1862,"children":1863},{"class":490,"line":554},[1864,1869,1874,1878,1883,1887,1892,1896],{"type":397,"tag":488,"props":1865,"children":1866},{"style":495},[1867],{"type":403,"value":1868},"#define",{"type":397,"tag":488,"props":1870,"children":1871},{"style":537},[1872],{"type":403,"value":1873}," TEST",{"type":397,"tag":488,"props":1875,"children":1876},{"style":543},[1877],{"type":403,"value":625},{"type":397,"tag":488,"props":1879,"children":1880},{"style":1404},[1881],{"type":403,"value":1882},"base",{"type":397,"tag":488,"props":1884,"children":1885},{"style":543},[1886],{"type":403,"value":635},{"type":397,"tag":488,"props":1888,"children":1889},{"style":1404},[1890],{"type":403,"value":1891},"name",{"type":397,"tag":488,"props":1893,"children":1894},{"style":543},[1895],{"type":403,"value":1192},{"type":397,"tag":488,"props":1897,"children":1898},{"style":773},[1899],{"type":403,"value":1900},"                                                 \\\n",{"type":397,"tag":488,"props":1902,"children":1903},{"class":490,"line":580},[1904,1909,1914,1918,1923,1927,1931,1935,1940,1945],{"type":397,"tag":488,"props":1905,"children":1906},{"style":531},[1907],{"type":403,"value":1908},"class",{"type":397,"tag":488,"props":1910,"children":1911},{"style":537},[1912],{"type":403,"value":1913}," TCONCAT",{"type":397,"tag":488,"props":1915,"children":1916},{"style":543},[1917],{"type":403,"value":625},{"type":397,"tag":488,"props":1919,"children":1920},{"style":558},[1921],{"type":403,"value":1922},"_Test_",{"type":397,"tag":488,"props":1924,"children":1925},{"style":543},[1926],{"type":403,"value":635},{"type":397,"tag":488,"props":1928,"children":1929},{"style":558},[1930],{"type":403,"value":1891},{"type":397,"tag":488,"props":1932,"children":1933},{"style":543},[1934],{"type":403,"value":1192},{"type":397,"tag":488,"props":1936,"children":1937},{"style":569},[1938],{"type":403,"value":1939}," : public base ",{"type":397,"tag":488,"props":1941,"children":1942},{"style":543},[1943],{"type":403,"value":1944},"{",{"type":397,"tag":488,"props":1946,"children":1947},{"style":773},[1948],{"type":403,"value":1949},"                              \\\n",{"type":397,"tag":488,"props":1951,"children":1952},{"class":490,"line":601},[1953,1958,1963],{"type":397,"tag":488,"props":1954,"children":1955},{"style":531},[1956],{"type":403,"value":1957}," public",{"type":397,"tag":488,"props":1959,"children":1961},{"style":1960},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#66D9EF;--shiki-light-font-style:inherit;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[1962],{"type":403,"value":1593},{"type":397,"tag":488,"props":1964,"children":1965},{"style":773},[1966],{"type":403,"value":1967},"                                                                \\\n",{"type":397,"tag":488,"props":1969,"children":1970},{"class":490,"line":658},[1971,1975,1980,1985],{"type":397,"tag":488,"props":1972,"children":1973},{"style":531},[1974],{"type":403,"value":1449},{"type":397,"tag":488,"props":1976,"children":1977},{"style":537},[1978],{"type":403,"value":1979}," _Run",{"type":397,"tag":488,"props":1981,"children":1982},{"style":543},[1983],{"type":403,"value":1984},"();",{"type":397,"tag":488,"props":1986,"children":1987},{"style":773},[1988],{"type":403,"value":1989},"                                                          \\\n",{"type":397,"tag":488,"props":1991,"children":1992},{"class":490,"line":693},[1993,1999,2004,2009,2013,2018],{"type":397,"tag":488,"props":1994,"children":1996},{"style":1995},"--shiki-light:#9C3EDA;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[1997],{"type":403,"value":1998},"  static",{"type":397,"tag":488,"props":2000,"children":2001},{"style":531},[2002],{"type":403,"value":2003}," void",{"type":397,"tag":488,"props":2005,"children":2006},{"style":537},[2007],{"type":403,"value":2008}," _RunIt",{"type":397,"tag":488,"props":2010,"children":2011},{"style":543},[2012],{"type":403,"value":546},{"type":397,"tag":488,"props":2014,"children":2015},{"style":543},[2016],{"type":403,"value":2017}," {",{"type":397,"tag":488,"props":2019,"children":2020},{"style":773},[2021],{"type":403,"value":2022},"                                                \\\n",{"type":397,"tag":488,"props":2024,"children":2025},{"class":490,"line":735},[2026,2031,2035,2039,2043,2047,2051,2056,2061],{"type":397,"tag":488,"props":2027,"children":2028},{"style":537},[2029],{"type":403,"value":2030},"    TCONCAT",{"type":397,"tag":488,"props":2032,"children":2033},{"style":543},[2034],{"type":403,"value":625},{"type":397,"tag":488,"props":2036,"children":2037},{"style":748},[2038],{"type":403,"value":1922},{"type":397,"tag":488,"props":2040,"children":2041},{"style":543},[2042],{"type":403,"value":635},{"type":397,"tag":488,"props":2044,"children":2045},{"style":748},[2046],{"type":403,"value":1891},{"type":397,"tag":488,"props":2048,"children":2049},{"style":543},[2050],{"type":403,"value":1192},{"type":397,"tag":488,"props":2052,"children":2053},{"style":748},[2054],{"type":403,"value":2055}," t",{"type":397,"tag":488,"props":2057,"children":2058},{"style":543},[2059],{"type":403,"value":2060},";",{"type":397,"tag":488,"props":2062,"children":2063},{"style":773},[2064],{"type":403,"value":2065},"                                             \\\n",{"type":397,"tag":488,"props":2067,"children":2068},{"class":490,"line":816},[2069,2074,2078,2083,2087],{"type":397,"tag":488,"props":2070,"children":2071},{"style":569},[2072],{"type":403,"value":2073},"    t",{"type":397,"tag":488,"props":2075,"children":2076},{"style":543},[2077],{"type":403,"value":680},{"type":397,"tag":488,"props":2079,"children":2080},{"style":537},[2081],{"type":403,"value":2082},"_Run",{"type":397,"tag":488,"props":2084,"children":2085},{"style":543},[2086],{"type":403,"value":1984},{"type":397,"tag":488,"props":2088,"children":2089},{"style":773},[2090],{"type":403,"value":2091},"                                                           \\\n",{"type":397,"tag":488,"props":2093,"children":2094},{"class":490,"line":839},[2095,2099],{"type":397,"tag":488,"props":2096,"children":2097},{"style":543},[2098],{"type":403,"value":1245},{"type":397,"tag":488,"props":2100,"children":2101},{"style":773},[2102],{"type":403,"value":2103},"                                                                     \\\n",{"type":397,"tag":488,"props":2105,"children":2106},{"class":490,"line":848},[2107,2112],{"type":397,"tag":488,"props":2108,"children":2109},{"style":543},[2110],{"type":403,"value":2111},"};",{"type":397,"tag":488,"props":2113,"children":2114},{"style":773},[2115],{"type":403,"value":2116},"                                                                      \\\n",{"type":397,"tag":488,"props":2118,"children":2119},{"class":490,"line":856},[2120,2125,2129,2133,2138,2142,2146,2150,2155],{"type":397,"tag":488,"props":2121,"children":2122},{"style":531},[2123],{"type":403,"value":2124},"bool",{"type":397,"tag":488,"props":2126,"children":2127},{"style":537},[2128],{"type":403,"value":1913},{"type":397,"tag":488,"props":2130,"children":2131},{"style":543},[2132],{"type":403,"value":625},{"type":397,"tag":488,"props":2134,"children":2135},{"style":558},[2136],{"type":403,"value":2137},"_Test_ignored_",{"type":397,"tag":488,"props":2139,"children":2140},{"style":543},[2141],{"type":403,"value":635},{"type":397,"tag":488,"props":2143,"children":2144},{"style":558},[2145],{"type":403,"value":1891},{"type":397,"tag":488,"props":2147,"children":2148},{"style":543},[2149],{"type":403,"value":1192},{"type":397,"tag":488,"props":2151,"children":2152},{"style":667},[2153],{"type":403,"value":2154}," =",{"type":397,"tag":488,"props":2156,"children":2157},{"style":773},[2158],{"type":403,"value":2159},"                                     \\\n",{"type":397,"tag":488,"props":2161,"children":2162},{"class":490,"line":899},[2163,2168,2173,2177,2181,2185,2190,2194,2199,2203,2208,2212,2216,2221,2225,2229,2233,2237,2241,2246,2250],{"type":397,"tag":488,"props":2164,"children":2165},{"style":569},[2166],{"type":403,"value":2167},"  ::",{"type":397,"tag":488,"props":2169,"children":2170},{"style":558},[2171],{"type":403,"value":2172},"kdb",{"type":397,"tag":488,"props":2174,"children":2175},{"style":543},[2176],{"type":403,"value":566},{"type":397,"tag":488,"props":2178,"children":2179},{"style":558},[2180],{"type":403,"value":1774},{"type":397,"tag":488,"props":2182,"children":2183},{"style":543},[2184],{"type":403,"value":566},{"type":397,"tag":488,"props":2186,"children":2187},{"style":537},[2188],{"type":403,"value":2189},"RegisterTest",{"type":397,"tag":488,"props":2191,"children":2192},{"style":543},[2193],{"type":403,"value":625},{"type":397,"tag":488,"props":2195,"children":2196},{"style":569},[2197],{"type":403,"value":2198},"#base",{"type":397,"tag":488,"props":2200,"children":2201},{"style":543},[2202],{"type":403,"value":635},{"type":397,"tag":488,"props":2204,"children":2205},{"style":569},[2206],{"type":403,"value":2207}," #name",{"type":397,"tag":488,"props":2209,"children":2210},{"style":543},[2211],{"type":403,"value":635},{"type":397,"tag":488,"props":2213,"children":2214},{"style":667},[2215],{"type":403,"value":1123},{"type":397,"tag":488,"props":2217,"children":2218},{"style":537},[2219],{"type":403,"value":2220},"TCONCAT",{"type":397,"tag":488,"props":2222,"children":2223},{"style":543},[2224],{"type":403,"value":625},{"type":397,"tag":488,"props":2226,"children":2227},{"style":569},[2228],{"type":403,"value":1922},{"type":397,"tag":488,"props":2230,"children":2231},{"style":543},[2232],{"type":403,"value":635},{"type":397,"tag":488,"props":2234,"children":2235},{"style":569},[2236],{"type":403,"value":1891},{"type":397,"tag":488,"props":2238,"children":2239},{"style":543},[2240],{"type":403,"value":1192},{"type":397,"tag":488,"props":2242,"children":2243},{"style":569},[2244],{"type":403,"value":2245},"::_RunIt",{"type":397,"tag":488,"props":2247,"children":2248},{"style":543},[2249],{"type":403,"value":1231},{"type":397,"tag":488,"props":2251,"children":2252},{"style":773},[2253],{"type":403,"value":2254}," \\\n",{"type":397,"tag":411,"props":2256,"children":2257},{},[2258],{"type":403,"value":2259},"可是，既然有 TCONCAT，为什么还要定义一个 TCONCAT1 宏呢？",{"type":397,"tag":477,"props":2261,"children":2263},{"code":2262,"language":480,"meta":391,"className":481,"style":391},"#define TCONCAT(a,b) TCONCAT1(a,b)\n#define TCONCAT1(a,b) a##b\n",[2264],{"type":397,"tag":484,"props":2265,"children":2266},{"__ignoreMap":391},[2267,2325],{"type":397,"tag":488,"props":2268,"children":2269},{"class":490,"line":491},[2270,2274,2278,2282,2286,2290,2295,2299,2304,2308,2312,2316,2320],{"type":397,"tag":488,"props":2271,"children":2272},{"style":495},[2273],{"type":403,"value":1868},{"type":397,"tag":488,"props":2275,"children":2276},{"style":537},[2277],{"type":403,"value":1913},{"type":397,"tag":488,"props":2279,"children":2280},{"style":543},[2281],{"type":403,"value":625},{"type":397,"tag":488,"props":2283,"children":2284},{"style":1404},[2285],{"type":403,"value":422},{"type":397,"tag":488,"props":2287,"children":2288},{"style":543},[2289],{"type":403,"value":635},{"type":397,"tag":488,"props":2291,"children":2292},{"style":1404},[2293],{"type":403,"value":2294},"b",{"type":397,"tag":488,"props":2296,"children":2297},{"style":543},[2298],{"type":403,"value":1192},{"type":397,"tag":488,"props":2300,"children":2301},{"style":537},[2302],{"type":403,"value":2303}," TCONCAT1",{"type":397,"tag":488,"props":2305,"children":2306},{"style":543},[2307],{"type":403,"value":625},{"type":397,"tag":488,"props":2309,"children":2310},{"style":569},[2311],{"type":403,"value":422},{"type":397,"tag":488,"props":2313,"children":2314},{"style":543},[2315],{"type":403,"value":635},{"type":397,"tag":488,"props":2317,"children":2318},{"style":569},[2319],{"type":403,"value":2294},{"type":397,"tag":488,"props":2321,"children":2322},{"style":543},[2323],{"type":403,"value":2324},")\n",{"type":397,"tag":488,"props":2326,"children":2327},{"class":490,"line":518},[2328,2332,2336,2340,2344,2348,2352,2356],{"type":397,"tag":488,"props":2329,"children":2330},{"style":495},[2331],{"type":403,"value":1868},{"type":397,"tag":488,"props":2333,"children":2334},{"style":537},[2335],{"type":403,"value":2303},{"type":397,"tag":488,"props":2337,"children":2338},{"style":543},[2339],{"type":403,"value":625},{"type":397,"tag":488,"props":2341,"children":2342},{"style":1404},[2343],{"type":403,"value":422},{"type":397,"tag":488,"props":2345,"children":2346},{"style":543},[2347],{"type":403,"value":635},{"type":397,"tag":488,"props":2349,"children":2350},{"style":1404},[2351],{"type":403,"value":2294},{"type":397,"tag":488,"props":2353,"children":2354},{"style":543},[2355],{"type":403,"value":1192},{"type":397,"tag":488,"props":2357,"children":2358},{"style":569},[2359],{"type":403,"value":2360}," a##b\n",{"type":397,"tag":411,"props":2362,"children":2363},{},[2364],{"type":403,"value":2365},"这就要提到宏的一个特殊规则了，如果宏参数使用了字符串化运算符（#）或标记黏贴运算符（##），那么即便参数是宏也不会展开。所以需要一个间接宏 TCONCAT1，以达到先展开参数（如果参数是宏的化），再调用标记黏贴运算符的目的。从 test_db 可以看到，测试类的名词都不是宏，所以这里本不需要 TCONCAT1 这个间接宏。但是考虑到程序的健壮性，加上更好。",{"type":397,"tag":1364,"props":2367,"children":2369},{"id":2368},"断言宏",[2370],{"type":403,"value":2368},{"type":397,"tag":411,"props":2372,"children":2373},{},[2374],{"type":403,"value":2375},"测试代码中的断言也是使用的宏来定义的。相比 TCONCAT 简单很多了，但其特点是可以记录抛错的文件以及行号。以下代码实现了 ASSERT_EQ 的定义。Tester 用于记录宏展开时所在的文件 __FILE__、行号 __LINE__ 以及断言结果。一但断言失败，记录到 ok_ 成员变量中。在 Tester 析构时，会把相关信息一并打印出来。",{"type":397,"tag":477,"props":2377,"children":2379},{"code":2378,"language":480,"meta":391,"className":481,"style":391},"class Tester {\n#define BINARY_OP(name,op)                              \\\n  template \u003Cclass X, class Y>                           \\\n  Tester& name(const X& x, const Y& y) {                \\\n    if (! (x op y)) {                                   \\\n      ss_ \u003C\u003C \" failed: \" \u003C\u003C x \u003C\u003C (\" \" #op \" \") \u003C\u003C y;    \\\n      ok_ = false;                                      \\\n    }                                                   \\\n    return *this;                                       \\\n  }\n  BINARY_OP(IsEq, ==)\n#undef BINARY_OP\n}\n#define ASSERT_EQ(a,b) ::kdb::test::Tester(__FILE__, __LINE__).IsEq((a),(b))\n",[2380],{"type":397,"tag":484,"props":2381,"children":2382},{"__ignoreMap":391},[2383,2399,2436,2481,2556,2595,2681,2708,2721,2748,2755,2785,2798,2805],{"type":397,"tag":488,"props":2384,"children":2385},{"class":490,"line":491},[2386,2390,2395],{"type":397,"tag":488,"props":2387,"children":2388},{"style":531},[2389],{"type":403,"value":1908},{"type":397,"tag":488,"props":2391,"children":2392},{"style":558},[2393],{"type":403,"value":2394}," Tester",{"type":397,"tag":488,"props":2396,"children":2397},{"style":543},[2398],{"type":403,"value":551},{"type":397,"tag":488,"props":2400,"children":2401},{"class":490,"line":518},[2402,2406,2411,2415,2419,2423,2428,2432],{"type":397,"tag":488,"props":2403,"children":2404},{"style":495},[2405],{"type":403,"value":1868},{"type":397,"tag":488,"props":2407,"children":2408},{"style":537},[2409],{"type":403,"value":2410}," BINARY_OP",{"type":397,"tag":488,"props":2412,"children":2413},{"style":543},[2414],{"type":403,"value":625},{"type":397,"tag":488,"props":2416,"children":2417},{"style":1404},[2418],{"type":403,"value":1891},{"type":397,"tag":488,"props":2420,"children":2421},{"style":543},[2422],{"type":403,"value":635},{"type":397,"tag":488,"props":2424,"children":2425},{"style":1404},[2426],{"type":403,"value":2427},"op",{"type":397,"tag":488,"props":2429,"children":2430},{"style":543},[2431],{"type":403,"value":1192},{"type":397,"tag":488,"props":2433,"children":2434},{"style":773},[2435],{"type":403,"value":1949},{"type":397,"tag":488,"props":2437,"children":2438},{"class":490,"line":527},[2439,2444,2448,2452,2457,2461,2466,2471,2476],{"type":397,"tag":488,"props":2440,"children":2441},{"style":531},[2442],{"type":403,"value":2443},"  template",{"type":397,"tag":488,"props":2445,"children":2446},{"style":543},[2447],{"type":403,"value":504},{"type":397,"tag":488,"props":2449,"children":2450},{"style":531},[2451],{"type":403,"value":1908},{"type":397,"tag":488,"props":2453,"children":2454},{"style":558},[2455],{"type":403,"value":2456}," X",{"type":397,"tag":488,"props":2458,"children":2459},{"style":543},[2460],{"type":403,"value":635},{"type":397,"tag":488,"props":2462,"children":2463},{"style":531},[2464],{"type":403,"value":2465}," class",{"type":397,"tag":488,"props":2467,"children":2468},{"style":558},[2469],{"type":403,"value":2470}," Y",{"type":397,"tag":488,"props":2472,"children":2473},{"style":543},[2474],{"type":403,"value":2475},">",{"type":397,"tag":488,"props":2477,"children":2478},{"style":773},[2479],{"type":403,"value":2480},"                           \\\n",{"type":397,"tag":488,"props":2482,"children":2483},{"class":490,"line":554},[2484,2489,2494,2499,2503,2508,2512,2516,2521,2525,2530,2534,2538,2543,2547,2551],{"type":397,"tag":488,"props":2485,"children":2486},{"style":558},[2487],{"type":403,"value":2488},"  Tester",{"type":397,"tag":488,"props":2490,"children":2491},{"style":1995},[2492],{"type":403,"value":2493},"&",{"type":397,"tag":488,"props":2495,"children":2496},{"style":537},[2497],{"type":403,"value":2498}," name",{"type":397,"tag":488,"props":2500,"children":2501},{"style":543},[2502],{"type":403,"value":625},{"type":397,"tag":488,"props":2504,"children":2505},{"style":1995},[2506],{"type":403,"value":2507},"const",{"type":397,"tag":488,"props":2509,"children":2510},{"style":558},[2511],{"type":403,"value":2456},{"type":397,"tag":488,"props":2513,"children":2514},{"style":1995},[2515],{"type":403,"value":2493},{"type":397,"tag":488,"props":2517,"children":2518},{"style":1404},[2519],{"type":403,"value":2520}," x",{"type":397,"tag":488,"props":2522,"children":2523},{"style":543},[2524],{"type":403,"value":635},{"type":397,"tag":488,"props":2526,"children":2527},{"style":1995},[2528],{"type":403,"value":2529}," const",{"type":397,"tag":488,"props":2531,"children":2532},{"style":558},[2533],{"type":403,"value":2470},{"type":397,"tag":488,"props":2535,"children":2536},{"style":1995},[2537],{"type":403,"value":2493},{"type":397,"tag":488,"props":2539,"children":2540},{"style":1404},[2541],{"type":403,"value":2542}," y",{"type":397,"tag":488,"props":2544,"children":2545},{"style":543},[2546],{"type":403,"value":1192},{"type":397,"tag":488,"props":2548,"children":2549},{"style":543},[2550],{"type":403,"value":2017},{"type":397,"tag":488,"props":2552,"children":2553},{"style":773},[2554],{"type":403,"value":2555},"                \\\n",{"type":397,"tag":488,"props":2557,"children":2558},{"class":490,"line":580},[2559,2564,2568,2572,2576,2581,2586,2590],{"type":397,"tag":488,"props":2560,"children":2561},{"style":495},[2562],{"type":403,"value":2563},"    if",{"type":397,"tag":488,"props":2565,"children":2566},{"style":543},[2567],{"type":403,"value":704},{"type":397,"tag":488,"props":2569,"children":2570},{"style":667},[2571],{"type":403,"value":709},{"type":397,"tag":488,"props":2573,"children":2574},{"style":543},[2575],{"type":403,"value":704},{"type":397,"tag":488,"props":2577,"children":2578},{"style":748},[2579],{"type":403,"value":2580},"x op y",{"type":397,"tag":488,"props":2582,"children":2583},{"style":543},[2584],{"type":403,"value":2585},"))",{"type":397,"tag":488,"props":2587,"children":2588},{"style":543},[2589],{"type":403,"value":2017},{"type":397,"tag":488,"props":2591,"children":2592},{"style":773},[2593],{"type":403,"value":2594},"                                   \\\n",{"type":397,"tag":488,"props":2596,"children":2597},{"class":490,"line":601},[2598,2603,2608,2612,2617,2621,2626,2631,2635,2639,2643,2647,2652,2656,2660,2664,2668,2672,2676],{"type":397,"tag":488,"props":2599,"children":2600},{"style":748},[2601],{"type":403,"value":2602},"      ss_ ",{"type":397,"tag":488,"props":2604,"children":2605},{"style":667},[2606],{"type":403,"value":2607},"\u003C\u003C",{"type":397,"tag":488,"props":2609,"children":2610},{"style":501},[2611],{"type":403,"value":640},{"type":397,"tag":488,"props":2613,"children":2614},{"style":507},[2615],{"type":403,"value":2616}," failed: ",{"type":397,"tag":488,"props":2618,"children":2619},{"style":501},[2620],{"type":403,"value":650},{"type":397,"tag":488,"props":2622,"children":2623},{"style":667},[2624],{"type":403,"value":2625}," \u003C\u003C",{"type":397,"tag":488,"props":2627,"children":2628},{"style":748},[2629],{"type":403,"value":2630}," x ",{"type":397,"tag":488,"props":2632,"children":2633},{"style":667},[2634],{"type":403,"value":2607},{"type":397,"tag":488,"props":2636,"children":2637},{"style":543},[2638],{"type":403,"value":704},{"type":397,"tag":488,"props":2640,"children":2641},{"style":501},[2642],{"type":403,"value":650},{"type":397,"tag":488,"props":2644,"children":2645},{"style":501},[2646],{"type":403,"value":640},{"type":397,"tag":488,"props":2648,"children":2649},{"style":569},[2650],{"type":403,"value":2651}," #op",{"type":397,"tag":488,"props":2653,"children":2654},{"style":501},[2655],{"type":403,"value":640},{"type":397,"tag":488,"props":2657,"children":2658},{"style":501},[2659],{"type":403,"value":640},{"type":397,"tag":488,"props":2661,"children":2662},{"style":543},[2663],{"type":403,"value":1192},{"type":397,"tag":488,"props":2665,"children":2666},{"style":667},[2667],{"type":403,"value":2625},{"type":397,"tag":488,"props":2669,"children":2670},{"style":748},[2671],{"type":403,"value":2542},{"type":397,"tag":488,"props":2673,"children":2674},{"style":543},[2675],{"type":403,"value":2060},{"type":397,"tag":488,"props":2677,"children":2678},{"style":773},[2679],{"type":403,"value":2680},"    \\\n",{"type":397,"tag":488,"props":2682,"children":2683},{"class":490,"line":658},[2684,2689,2693,2699,2703],{"type":397,"tag":488,"props":2685,"children":2686},{"style":748},[2687],{"type":403,"value":2688},"      ok_ ",{"type":397,"tag":488,"props":2690,"children":2691},{"style":667},[2692],{"type":403,"value":670},{"type":397,"tag":488,"props":2694,"children":2696},{"style":2695},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[2697],{"type":403,"value":2698}," false",{"type":397,"tag":488,"props":2700,"children":2701},{"style":543},[2702],{"type":403,"value":2060},{"type":397,"tag":488,"props":2704,"children":2705},{"style":773},[2706],{"type":403,"value":2707},"                                      \\\n",{"type":397,"tag":488,"props":2709,"children":2710},{"class":490,"line":693},[2711,2716],{"type":397,"tag":488,"props":2712,"children":2713},{"style":543},[2714],{"type":403,"value":2715},"    }",{"type":397,"tag":488,"props":2717,"children":2718},{"style":773},[2719],{"type":403,"value":2720},"                                                   \\\n",{"type":397,"tag":488,"props":2722,"children":2723},{"class":490,"line":735},[2724,2729,2733,2739,2743],{"type":397,"tag":488,"props":2725,"children":2726},{"style":495},[2727],{"type":403,"value":2728},"    return",{"type":397,"tag":488,"props":2730,"children":2731},{"style":667},[2732],{"type":403,"value":1454},{"type":397,"tag":488,"props":2734,"children":2736},{"style":2735},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[2737],{"type":403,"value":2738},"this",{"type":397,"tag":488,"props":2740,"children":2741},{"style":543},[2742],{"type":403,"value":2060},{"type":397,"tag":488,"props":2744,"children":2745},{"style":773},[2746],{"type":403,"value":2747},"                                       \\\n",{"type":397,"tag":488,"props":2749,"children":2750},{"class":490,"line":816},[2751],{"type":397,"tag":488,"props":2752,"children":2753},{"style":543},[2754],{"type":403,"value":845},{"type":397,"tag":488,"props":2756,"children":2757},{"class":490,"line":839},[2758,2763,2767,2772,2776,2781],{"type":397,"tag":488,"props":2759,"children":2760},{"style":537},[2761],{"type":403,"value":2762},"  BINARY_OP",{"type":397,"tag":488,"props":2764,"children":2765},{"style":543},[2766],{"type":403,"value":625},{"type":397,"tag":488,"props":2768,"children":2769},{"style":558},[2770],{"type":403,"value":2771},"IsEq",{"type":397,"tag":488,"props":2773,"children":2774},{"style":543},[2775],{"type":403,"value":635},{"type":397,"tag":488,"props":2777,"children":2778},{"style":667},[2779],{"type":403,"value":2780}," ==",{"type":397,"tag":488,"props":2782,"children":2783},{"style":543},[2784],{"type":403,"value":2324},{"type":397,"tag":488,"props":2786,"children":2787},{"class":490,"line":848},[2788,2793],{"type":397,"tag":488,"props":2789,"children":2790},{"style":495},[2791],{"type":403,"value":2792},"#undef",{"type":397,"tag":488,"props":2794,"children":2795},{"style":537},[2796],{"type":403,"value":2797}," BINARY_OP\n",{"type":397,"tag":488,"props":2799,"children":2800},{"class":490,"line":856},[2801],{"type":397,"tag":488,"props":2802,"children":2803},{"style":748},[2804],{"type":403,"value":1334},{"type":397,"tag":488,"props":2806,"children":2807},{"class":490,"line":899},[2808,2812,2817,2821,2825,2829,2833,2837,2842,2846,2850,2854,2858,2863,2867,2873,2877,2882,2887,2891,2896,2900,2905,2909],{"type":397,"tag":488,"props":2809,"children":2810},{"style":495},[2811],{"type":403,"value":1868},{"type":397,"tag":488,"props":2813,"children":2814},{"style":537},[2815],{"type":403,"value":2816}," ASSERT_EQ",{"type":397,"tag":488,"props":2818,"children":2819},{"style":543},[2820],{"type":403,"value":625},{"type":397,"tag":488,"props":2822,"children":2823},{"style":1404},[2824],{"type":403,"value":422},{"type":397,"tag":488,"props":2826,"children":2827},{"style":543},[2828],{"type":403,"value":635},{"type":397,"tag":488,"props":2830,"children":2831},{"style":1404},[2832],{"type":403,"value":2294},{"type":397,"tag":488,"props":2834,"children":2835},{"style":543},[2836],{"type":403,"value":1192},{"type":397,"tag":488,"props":2838,"children":2839},{"style":748},[2840],{"type":403,"value":2841}," ::",{"type":397,"tag":488,"props":2843,"children":2844},{"style":558},[2845],{"type":403,"value":2172},{"type":397,"tag":488,"props":2847,"children":2848},{"style":543},[2849],{"type":403,"value":566},{"type":397,"tag":488,"props":2851,"children":2852},{"style":558},[2853],{"type":403,"value":1774},{"type":397,"tag":488,"props":2855,"children":2856},{"style":543},[2857],{"type":403,"value":566},{"type":397,"tag":488,"props":2859,"children":2860},{"style":537},[2861],{"type":403,"value":2862},"Tester",{"type":397,"tag":488,"props":2864,"children":2865},{"style":543},[2866],{"type":403,"value":625},{"type":397,"tag":488,"props":2868,"children":2870},{"style":2869},"--shiki-light:#E2931D;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#F8F8F2",[2871],{"type":403,"value":2872},"__FILE__",{"type":397,"tag":488,"props":2874,"children":2875},{"style":543},[2876],{"type":403,"value":635},{"type":397,"tag":488,"props":2878,"children":2879},{"style":2869},[2880],{"type":403,"value":2881}," __LINE__",{"type":397,"tag":488,"props":2883,"children":2884},{"style":543},[2885],{"type":403,"value":2886},").",{"type":397,"tag":488,"props":2888,"children":2889},{"style":537},[2890],{"type":403,"value":2771},{"type":397,"tag":488,"props":2892,"children":2893},{"style":543},[2894],{"type":403,"value":2895},"((",{"type":397,"tag":488,"props":2897,"children":2898},{"style":748},[2899],{"type":403,"value":422},{"type":397,"tag":488,"props":2901,"children":2902},{"style":543},[2903],{"type":403,"value":2904},"),(",{"type":397,"tag":488,"props":2906,"children":2907},{"style":748},[2908],{"type":403,"value":2294},{"type":397,"tag":488,"props":2910,"children":2911},{"style":543},[2912],{"type":403,"value":2913},"))\n",{"type":397,"tag":1364,"props":2915,"children":2917},{"id":2916},"stringrepeatntimes",[2918],{"type":403,"value":2919},"string.repeat(ntimes)",{"type":397,"tag":411,"props":2921,"children":2922},{},[2923],{"type":403,"value":2924},"写 JavaScript 时经常用到 String 的原型方法 repeat，用来把 n 个内容重复的字符串拼接为一个新字符串。也许是 C++ 标准库没有提供相应的算法，KDB 使用了一种和 repeat 完全不一样的处理思路。KDB 使用 StringStream 填充一定位数内容，还可以不用考虑值的长度。",{"type":397,"tag":477,"props":2926,"children":2928},{"code":2927,"language":480,"meta":391,"className":481,"style":391},"std::stringstream ss;\nss \u003C\u003C std::setfill ('0') \u003C\u003C std::setw (16);\nss \u003C\u003C 1;\nss.str(); // result is: \"0000000000000001\"\nss \u003C\u003C std::setfill ('0') \u003C\u003C std::setw (16);\nss \u003C\u003C 1123;\nss.str(); // result is: \"0000000000001123\"\n",[2929],{"type":397,"tag":484,"props":2930,"children":2931},{"__ignoreMap":391},[2932,2953,3031,3051,3077,3148,3168],{"type":397,"tag":488,"props":2933,"children":2934},{"class":490,"line":491},[2935,2940,2944,2949],{"type":397,"tag":488,"props":2936,"children":2937},{"style":558},[2938],{"type":403,"value":2939},"std",{"type":397,"tag":488,"props":2941,"children":2942},{"style":543},[2943],{"type":403,"value":566},{"type":397,"tag":488,"props":2945,"children":2946},{"style":569},[2947],{"type":403,"value":2948},"stringstream ss",{"type":397,"tag":488,"props":2950,"children":2951},{"style":543},[2952],{"type":403,"value":577},{"type":397,"tag":488,"props":2954,"children":2955},{"class":490,"line":518},[2956,2961,2965,2970,2974,2979,2983,2988,2993,2997,3001,3005,3009,3013,3018,3022,3027],{"type":397,"tag":488,"props":2957,"children":2958},{"style":569},[2959],{"type":403,"value":2960},"ss ",{"type":397,"tag":488,"props":2962,"children":2963},{"style":667},[2964],{"type":403,"value":2607},{"type":397,"tag":488,"props":2966,"children":2967},{"style":558},[2968],{"type":403,"value":2969}," std",{"type":397,"tag":488,"props":2971,"children":2972},{"style":543},[2973],{"type":403,"value":566},{"type":397,"tag":488,"props":2975,"children":2976},{"style":537},[2977],{"type":403,"value":2978},"setfill",{"type":397,"tag":488,"props":2980,"children":2981},{"style":543},[2982],{"type":403,"value":704},{"type":397,"tag":488,"props":2984,"children":2985},{"style":501},[2986],{"type":403,"value":2987},"'",{"type":397,"tag":488,"props":2989,"children":2990},{"style":507},[2991],{"type":403,"value":2992},"0",{"type":397,"tag":488,"props":2994,"children":2995},{"style":501},[2996],{"type":403,"value":2987},{"type":397,"tag":488,"props":2998,"children":2999},{"style":543},[3000],{"type":403,"value":1192},{"type":397,"tag":488,"props":3002,"children":3003},{"style":667},[3004],{"type":403,"value":2625},{"type":397,"tag":488,"props":3006,"children":3007},{"style":558},[3008],{"type":403,"value":2969},{"type":397,"tag":488,"props":3010,"children":3011},{"style":543},[3012],{"type":403,"value":566},{"type":397,"tag":488,"props":3014,"children":3015},{"style":537},[3016],{"type":403,"value":3017},"setw",{"type":397,"tag":488,"props":3019,"children":3020},{"style":543},[3021],{"type":403,"value":704},{"type":397,"tag":488,"props":3023,"children":3024},{"style":829},[3025],{"type":403,"value":3026},"16",{"type":397,"tag":488,"props":3028,"children":3029},{"style":543},[3030],{"type":403,"value":655},{"type":397,"tag":488,"props":3032,"children":3033},{"class":490,"line":527},[3034,3038,3042,3047],{"type":397,"tag":488,"props":3035,"children":3036},{"style":569},[3037],{"type":403,"value":2960},{"type":397,"tag":488,"props":3039,"children":3040},{"style":667},[3041],{"type":403,"value":2607},{"type":397,"tag":488,"props":3043,"children":3044},{"style":829},[3045],{"type":403,"value":3046}," 1",{"type":397,"tag":488,"props":3048,"children":3049},{"style":543},[3050],{"type":403,"value":577},{"type":397,"tag":488,"props":3052,"children":3053},{"class":490,"line":554},[3054,3059,3063,3068,3072],{"type":397,"tag":488,"props":3055,"children":3056},{"style":569},[3057],{"type":403,"value":3058},"ss",{"type":397,"tag":488,"props":3060,"children":3061},{"style":543},[3062],{"type":403,"value":680},{"type":397,"tag":488,"props":3064,"children":3065},{"style":537},[3066],{"type":403,"value":3067},"str",{"type":397,"tag":488,"props":3069,"children":3070},{"style":543},[3071],{"type":403,"value":1984},{"type":397,"tag":488,"props":3073,"children":3074},{"style":1497},[3075],{"type":403,"value":3076}," // result is: \"0000000000000001\"\n",{"type":397,"tag":488,"props":3078,"children":3079},{"class":490,"line":580},[3080,3084,3088,3092,3096,3100,3104,3108,3112,3116,3120,3124,3128,3132,3136,3140,3144],{"type":397,"tag":488,"props":3081,"children":3082},{"style":569},[3083],{"type":403,"value":2960},{"type":397,"tag":488,"props":3085,"children":3086},{"style":667},[3087],{"type":403,"value":2607},{"type":397,"tag":488,"props":3089,"children":3090},{"style":558},[3091],{"type":403,"value":2969},{"type":397,"tag":488,"props":3093,"children":3094},{"style":543},[3095],{"type":403,"value":566},{"type":397,"tag":488,"props":3097,"children":3098},{"style":537},[3099],{"type":403,"value":2978},{"type":397,"tag":488,"props":3101,"children":3102},{"style":543},[3103],{"type":403,"value":704},{"type":397,"tag":488,"props":3105,"children":3106},{"style":501},[3107],{"type":403,"value":2987},{"type":397,"tag":488,"props":3109,"children":3110},{"style":507},[3111],{"type":403,"value":2992},{"type":397,"tag":488,"props":3113,"children":3114},{"style":501},[3115],{"type":403,"value":2987},{"type":397,"tag":488,"props":3117,"children":3118},{"style":543},[3119],{"type":403,"value":1192},{"type":397,"tag":488,"props":3121,"children":3122},{"style":667},[3123],{"type":403,"value":2625},{"type":397,"tag":488,"props":3125,"children":3126},{"style":558},[3127],{"type":403,"value":2969},{"type":397,"tag":488,"props":3129,"children":3130},{"style":543},[3131],{"type":403,"value":566},{"type":397,"tag":488,"props":3133,"children":3134},{"style":537},[3135],{"type":403,"value":3017},{"type":397,"tag":488,"props":3137,"children":3138},{"style":543},[3139],{"type":403,"value":704},{"type":397,"tag":488,"props":3141,"children":3142},{"style":829},[3143],{"type":403,"value":3026},{"type":397,"tag":488,"props":3145,"children":3146},{"style":543},[3147],{"type":403,"value":655},{"type":397,"tag":488,"props":3149,"children":3150},{"class":490,"line":601},[3151,3155,3159,3164],{"type":397,"tag":488,"props":3152,"children":3153},{"style":569},[3154],{"type":403,"value":2960},{"type":397,"tag":488,"props":3156,"children":3157},{"style":667},[3158],{"type":403,"value":2607},{"type":397,"tag":488,"props":3160,"children":3161},{"style":829},[3162],{"type":403,"value":3163}," 1123",{"type":397,"tag":488,"props":3165,"children":3166},{"style":543},[3167],{"type":403,"value":577},{"type":397,"tag":488,"props":3169,"children":3170},{"class":490,"line":658},[3171,3175,3179,3183,3187],{"type":397,"tag":488,"props":3172,"children":3173},{"style":569},[3174],{"type":403,"value":3058},{"type":397,"tag":488,"props":3176,"children":3177},{"style":543},[3178],{"type":403,"value":680},{"type":397,"tag":488,"props":3180,"children":3181},{"style":537},[3182],{"type":403,"value":3067},{"type":397,"tag":488,"props":3184,"children":3185},{"style":543},[3186],{"type":403,"value":1984},{"type":397,"tag":488,"props":3188,"children":3189},{"style":1497},[3190],{"type":403,"value":3191}," // result is: \"0000000000001123\"\n",{"type":397,"tag":1364,"props":3193,"children":3195},{"id":3194},"c-风格的随机数",[3196],{"type":403,"value":3197},"C++ 风格的随机数",{"type":397,"tag":411,"props":3199,"children":3200},{},[3201],{"type":403,"value":3202},"一个有意思的地方时，KDB 代码中随处可见 C 编程风格的源码。但是测试用例中生成随机数确实 C++ 风格的。",{"type":397,"tag":477,"props":3204,"children":3206},{"code":3205,"language":480,"meta":391,"className":481,"style":391},"std::mt19937 generator = std::mt19937();\nstd::uniform_int_distribution\u003Cint> random_dist(0,255);\n// ...\nfor (int i = 0; i \u003C size; i++) {\n  str[i] = static_cast\u003Cchar>(random_dist(generator));\n}\n",[3207],{"type":397,"tag":484,"props":3208,"children":3209},{"__ignoreMap":391},[3210,3247,3302,3310,3378,3441],{"type":397,"tag":488,"props":3211,"children":3212},{"class":490,"line":491},[3213,3217,3221,3226,3230,3234,3238,3243],{"type":397,"tag":488,"props":3214,"children":3215},{"style":558},[3216],{"type":403,"value":2939},{"type":397,"tag":488,"props":3218,"children":3219},{"style":543},[3220],{"type":403,"value":566},{"type":397,"tag":488,"props":3222,"children":3223},{"style":569},[3224],{"type":403,"value":3225},"mt19937 generator ",{"type":397,"tag":488,"props":3227,"children":3228},{"style":667},[3229],{"type":403,"value":670},{"type":397,"tag":488,"props":3231,"children":3232},{"style":558},[3233],{"type":403,"value":2969},{"type":397,"tag":488,"props":3235,"children":3236},{"style":543},[3237],{"type":403,"value":566},{"type":397,"tag":488,"props":3239,"children":3240},{"style":537},[3241],{"type":403,"value":3242},"mt19937",{"type":397,"tag":488,"props":3244,"children":3245},{"style":543},[3246],{"type":403,"value":690},{"type":397,"tag":488,"props":3248,"children":3249},{"class":490,"line":518},[3250,3254,3258,3263,3268,3272,3276,3281,3285,3289,3293,3298],{"type":397,"tag":488,"props":3251,"children":3252},{"style":558},[3253],{"type":403,"value":2939},{"type":397,"tag":488,"props":3255,"children":3256},{"style":543},[3257],{"type":403,"value":566},{"type":397,"tag":488,"props":3259,"children":3260},{"style":558},[3261],{"type":403,"value":3262},"uniform_int_distribution",{"type":397,"tag":488,"props":3264,"children":3265},{"style":543},[3266],{"type":403,"value":3267},"\u003C",{"type":397,"tag":488,"props":3269,"children":3270},{"style":531},[3271],{"type":403,"value":534},{"type":397,"tag":488,"props":3273,"children":3274},{"style":543},[3275],{"type":403,"value":2475},{"type":397,"tag":488,"props":3277,"children":3278},{"style":537},[3279],{"type":403,"value":3280}," random_dist",{"type":397,"tag":488,"props":3282,"children":3283},{"style":543},[3284],{"type":403,"value":625},{"type":397,"tag":488,"props":3286,"children":3287},{"style":829},[3288],{"type":403,"value":2992},{"type":397,"tag":488,"props":3290,"children":3291},{"style":543},[3292],{"type":403,"value":635},{"type":397,"tag":488,"props":3294,"children":3295},{"style":829},[3296],{"type":403,"value":3297},"255",{"type":397,"tag":488,"props":3299,"children":3300},{"style":543},[3301],{"type":403,"value":655},{"type":397,"tag":488,"props":3303,"children":3304},{"class":490,"line":527},[3305],{"type":397,"tag":488,"props":3306,"children":3307},{"style":1497},[3308],{"type":403,"value":3309},"// ...\n",{"type":397,"tag":488,"props":3311,"children":3312},{"class":490,"line":554},[3313,3318,3322,3326,3331,3335,3339,3343,3347,3351,3356,3360,3365,3370,3374],{"type":397,"tag":488,"props":3314,"children":3315},{"style":495},[3316],{"type":403,"value":3317},"for",{"type":397,"tag":488,"props":3319,"children":3320},{"style":543},[3321],{"type":403,"value":704},{"type":397,"tag":488,"props":3323,"children":3324},{"style":531},[3325],{"type":403,"value":534},{"type":397,"tag":488,"props":3327,"children":3328},{"style":569},[3329],{"type":403,"value":3330}," i ",{"type":397,"tag":488,"props":3332,"children":3333},{"style":667},[3334],{"type":403,"value":670},{"type":397,"tag":488,"props":3336,"children":3337},{"style":829},[3338],{"type":403,"value":1321},{"type":397,"tag":488,"props":3340,"children":3341},{"style":543},[3342],{"type":403,"value":2060},{"type":397,"tag":488,"props":3344,"children":3345},{"style":569},[3346],{"type":403,"value":3330},{"type":397,"tag":488,"props":3348,"children":3349},{"style":667},[3350],{"type":403,"value":3267},{"type":397,"tag":488,"props":3352,"children":3353},{"style":569},[3354],{"type":403,"value":3355}," size",{"type":397,"tag":488,"props":3357,"children":3358},{"style":543},[3359],{"type":403,"value":2060},{"type":397,"tag":488,"props":3361,"children":3362},{"style":569},[3363],{"type":403,"value":3364}," i",{"type":397,"tag":488,"props":3366,"children":3367},{"style":667},[3368],{"type":403,"value":3369},"++",{"type":397,"tag":488,"props":3371,"children":3372},{"style":543},[3373],{"type":403,"value":1192},{"type":397,"tag":488,"props":3375,"children":3376},{"style":543},[3377],{"type":403,"value":551},{"type":397,"tag":488,"props":3379,"children":3380},{"class":490,"line":580},[3381,3386,3390,3395,3400,3404,3409,3414,3418,3422,3427,3431,3436],{"type":397,"tag":488,"props":3382,"children":3383},{"style":569},[3384],{"type":403,"value":3385},"  str",{"type":397,"tag":488,"props":3387,"children":3388},{"style":543},[3389],{"type":403,"value":1464},{"type":397,"tag":488,"props":3391,"children":3392},{"style":748},[3393],{"type":403,"value":3394},"i",{"type":397,"tag":488,"props":3396,"children":3397},{"style":543},[3398],{"type":403,"value":3399},"]",{"type":397,"tag":488,"props":3401,"children":3402},{"style":667},[3403],{"type":403,"value":2154},{"type":397,"tag":488,"props":3405,"children":3406},{"style":667},[3407],{"type":403,"value":3408}," static_cast\u003C",{"type":397,"tag":488,"props":3410,"children":3411},{"style":531},[3412],{"type":403,"value":3413},"char",{"type":397,"tag":488,"props":3415,"children":3416},{"style":667},[3417],{"type":403,"value":2475},{"type":397,"tag":488,"props":3419,"children":3420},{"style":543},[3421],{"type":403,"value":625},{"type":397,"tag":488,"props":3423,"children":3424},{"style":537},[3425],{"type":403,"value":3426},"random_dist",{"type":397,"tag":488,"props":3428,"children":3429},{"style":543},[3430],{"type":403,"value":625},{"type":397,"tag":488,"props":3432,"children":3433},{"style":748},[3434],{"type":403,"value":3435},"generator",{"type":397,"tag":488,"props":3437,"children":3438},{"style":543},[3439],{"type":403,"value":3440},"));\n",{"type":397,"tag":488,"props":3442,"children":3443},{"class":490,"line":601},[3444],{"type":397,"tag":488,"props":3445,"children":3446},{"style":543},[3447],{"type":403,"value":1334},{"type":397,"tag":405,"props":3449,"children":3451},{"id":3450},"接口层",[3452],{"type":403,"value":3450},{"type":397,"tag":411,"props":3454,"children":3455},{},[3456,3458,3464],{"type":403,"value":3457},"接口的声明位于 interface/kingdb.h，实现则是 interface/kingdb.cc。KingDB 类给 Database 和 Snapshot 定义了要求实现的 Get、Put、Delete、NewIterater、Open、Close、Flush、Compact、NewMultipartReader 接口。KDB 有自己的数据传输格式 ByteArray，诸如 Get、Put 这些接口在 KingDB 类中对应方法得到了重载，以实现通过 std::string 来传递键、值或者两者，可视为为接受 ByteArray 的方法的包装。所有数据库操作方法都返回 Status 对象，相关异常部分的简介见",{"type":397,"tag":422,"props":3459,"children":3461},{"href":3460},"#%E5%BC%82%E5%B8%B8%E4%B8%8E%E6%97%A5%E5%BF%97",[3462],{"type":403,"value":3463},"异常与日志",{"type":403,"value":3465},"小节。",{"type":397,"tag":411,"props":3467,"children":3468},{},[3469],{"type":403,"value":3470},"重载方法的实现示例如下，即先把 std::string 转回 ByteArray 再调用子类（Database 或 Snapshot）的实现。",{"type":397,"tag":477,"props":3472,"children":3474},{"code":3473,"language":480,"meta":391,"className":481,"style":391},"virtual Status Put(WriteOptions& write_options, const std::string& key, const std::string& chunk) {\n  ByteArray byte_array_key = NewDeepCopyByteArray(key.c_str(), key.size());\n  ByteArray byte_array_chunk = NewDeepCopyByteArray(chunk.c_str(), chunk.size());\n  return Put(write_options, byte_array_key, byte_array_chunk);\n}\n",[3475],{"type":397,"tag":484,"props":3476,"children":3477},{"__ignoreMap":391},[3478,3581,3637,3690,3731],{"type":397,"tag":488,"props":3479,"children":3480},{"class":490,"line":491},[3481,3486,3491,3496,3500,3505,3509,3514,3518,3522,3526,3530,3535,3539,3544,3548,3552,3556,3560,3564,3568,3573,3577],{"type":397,"tag":488,"props":3482,"children":3483},{"style":1995},[3484],{"type":403,"value":3485},"virtual",{"type":397,"tag":488,"props":3487,"children":3488},{"style":558},[3489],{"type":403,"value":3490}," Status",{"type":397,"tag":488,"props":3492,"children":3493},{"style":537},[3494],{"type":403,"value":3495}," Put",{"type":397,"tag":488,"props":3497,"children":3498},{"style":543},[3499],{"type":403,"value":625},{"type":397,"tag":488,"props":3501,"children":3502},{"style":558},[3503],{"type":403,"value":3504},"WriteOptions",{"type":397,"tag":488,"props":3506,"children":3507},{"style":1995},[3508],{"type":403,"value":2493},{"type":397,"tag":488,"props":3510,"children":3511},{"style":1404},[3512],{"type":403,"value":3513}," write_options",{"type":397,"tag":488,"props":3515,"children":3516},{"style":543},[3517],{"type":403,"value":635},{"type":397,"tag":488,"props":3519,"children":3520},{"style":1995},[3521],{"type":403,"value":2529},{"type":397,"tag":488,"props":3523,"children":3524},{"style":558},[3525],{"type":403,"value":2969},{"type":397,"tag":488,"props":3527,"children":3528},{"style":543},[3529],{"type":403,"value":566},{"type":397,"tag":488,"props":3531,"children":3532},{"style":558},[3533],{"type":403,"value":3534},"string",{"type":397,"tag":488,"props":3536,"children":3537},{"style":1995},[3538],{"type":403,"value":2493},{"type":397,"tag":488,"props":3540,"children":3541},{"style":1404},[3542],{"type":403,"value":3543}," key",{"type":397,"tag":488,"props":3545,"children":3546},{"style":543},[3547],{"type":403,"value":635},{"type":397,"tag":488,"props":3549,"children":3550},{"style":1995},[3551],{"type":403,"value":2529},{"type":397,"tag":488,"props":3553,"children":3554},{"style":558},[3555],{"type":403,"value":2969},{"type":397,"tag":488,"props":3557,"children":3558},{"style":543},[3559],{"type":403,"value":566},{"type":397,"tag":488,"props":3561,"children":3562},{"style":558},[3563],{"type":403,"value":3534},{"type":397,"tag":488,"props":3565,"children":3566},{"style":1995},[3567],{"type":403,"value":2493},{"type":397,"tag":488,"props":3569,"children":3570},{"style":1404},[3571],{"type":403,"value":3572}," chunk",{"type":397,"tag":488,"props":3574,"children":3575},{"style":543},[3576],{"type":403,"value":1192},{"type":397,"tag":488,"props":3578,"children":3579},{"style":543},[3580],{"type":403,"value":551},{"type":397,"tag":488,"props":3582,"children":3583},{"class":490,"line":518},[3584,3589,3593,3598,3602,3607,3611,3615,3620,3624,3628,3633],{"type":397,"tag":488,"props":3585,"children":3586},{"style":569},[3587],{"type":403,"value":3588},"  ByteArray byte_array_key ",{"type":397,"tag":488,"props":3590,"children":3591},{"style":667},[3592],{"type":403,"value":670},{"type":397,"tag":488,"props":3594,"children":3595},{"style":537},[3596],{"type":403,"value":3597}," NewDeepCopyByteArray",{"type":397,"tag":488,"props":3599,"children":3600},{"style":543},[3601],{"type":403,"value":625},{"type":397,"tag":488,"props":3603,"children":3604},{"style":569},[3605],{"type":403,"value":3606},"key",{"type":397,"tag":488,"props":3608,"children":3609},{"style":543},[3610],{"type":403,"value":680},{"type":397,"tag":488,"props":3612,"children":3613},{"style":537},[3614],{"type":403,"value":808},{"type":397,"tag":488,"props":3616,"children":3617},{"style":543},[3618],{"type":403,"value":3619},"(),",{"type":397,"tag":488,"props":3621,"children":3622},{"style":569},[3623],{"type":403,"value":3543},{"type":397,"tag":488,"props":3625,"children":3626},{"style":543},[3627],{"type":403,"value":680},{"type":397,"tag":488,"props":3629,"children":3630},{"style":537},[3631],{"type":403,"value":3632},"size",{"type":397,"tag":488,"props":3634,"children":3635},{"style":543},[3636],{"type":403,"value":813},{"type":397,"tag":488,"props":3638,"children":3639},{"class":490,"line":527},[3640,3645,3649,3653,3657,3662,3666,3670,3674,3678,3682,3686],{"type":397,"tag":488,"props":3641,"children":3642},{"style":569},[3643],{"type":403,"value":3644},"  ByteArray byte_array_chunk ",{"type":397,"tag":488,"props":3646,"children":3647},{"style":667},[3648],{"type":403,"value":670},{"type":397,"tag":488,"props":3650,"children":3651},{"style":537},[3652],{"type":403,"value":3597},{"type":397,"tag":488,"props":3654,"children":3655},{"style":543},[3656],{"type":403,"value":625},{"type":397,"tag":488,"props":3658,"children":3659},{"style":569},[3660],{"type":403,"value":3661},"chunk",{"type":397,"tag":488,"props":3663,"children":3664},{"style":543},[3665],{"type":403,"value":680},{"type":397,"tag":488,"props":3667,"children":3668},{"style":537},[3669],{"type":403,"value":808},{"type":397,"tag":488,"props":3671,"children":3672},{"style":543},[3673],{"type":403,"value":3619},{"type":397,"tag":488,"props":3675,"children":3676},{"style":569},[3677],{"type":403,"value":3572},{"type":397,"tag":488,"props":3679,"children":3680},{"style":543},[3681],{"type":403,"value":680},{"type":397,"tag":488,"props":3683,"children":3684},{"style":537},[3685],{"type":403,"value":3632},{"type":397,"tag":488,"props":3687,"children":3688},{"style":543},[3689],{"type":403,"value":813},{"type":397,"tag":488,"props":3691,"children":3692},{"class":490,"line":554},[3693,3697,3701,3705,3709,3713,3718,3722,3727],{"type":397,"tag":488,"props":3694,"children":3695},{"style":495},[3696],{"type":403,"value":1316},{"type":397,"tag":488,"props":3698,"children":3699},{"style":537},[3700],{"type":403,"value":3495},{"type":397,"tag":488,"props":3702,"children":3703},{"style":543},[3704],{"type":403,"value":625},{"type":397,"tag":488,"props":3706,"children":3707},{"style":569},[3708],{"type":403,"value":1000},{"type":397,"tag":488,"props":3710,"children":3711},{"style":543},[3712],{"type":403,"value":635},{"type":397,"tag":488,"props":3714,"children":3715},{"style":569},[3716],{"type":403,"value":3717}," byte_array_key",{"type":397,"tag":488,"props":3719,"children":3720},{"style":543},[3721],{"type":403,"value":635},{"type":397,"tag":488,"props":3723,"children":3724},{"style":569},[3725],{"type":403,"value":3726}," byte_array_chunk",{"type":397,"tag":488,"props":3728,"children":3729},{"style":543},[3730],{"type":403,"value":655},{"type":397,"tag":488,"props":3732,"children":3733},{"class":490,"line":580},[3734],{"type":397,"tag":488,"props":3735,"children":3736},{"style":543},[3737],{"type":403,"value":1334},{"type":397,"tag":1364,"props":3739,"children":3741},{"id":3740},"数据库开关",[3742],{"type":403,"value":3740},{"type":397,"tag":411,"props":3744,"children":3745},{},[3746],{"type":403,"value":3747},"数据库的开启与关闭，分别对应 Database 类的 Open 和 Close 方法。开启时，通过 stat 库函数找到数据库路径以及配置文件，使用 open 库函数获取其文件描述符。配置文件须先用 flock 锁住，使用 mmap 映射后再读取；如果没有那么分情况写入。之后，创建好 EventManager、WriteBuffer 和 StorageEngine 的实例，就完成了。关闭时过程类似，锁定住配置文件后再关闭，同时删除以上创建的实例。可以发现，资源申请全放在了 Open 中，而资源的销毁放在了 Close 中，而 Database 类析构时会自动调用 Close，所以这是一个类似 RAII 的资源管理过程。",{"type":397,"tag":477,"props":3749,"children":3751},{"code":3750,"language":480,"meta":391,"className":481,"style":391},"class Database: public KingDB {\n  virtual ~Database() { Close(); }\n  virtual Status Open() override {\n    std::string filepath_dboptions = DatabaseOptions::GetPath(dbname_);\n    fd_dboptions_ = open(filepath_dboptions.c_str(), O_RDONLY, 0644);\n    flock(fd_dboptions_, LOCK_EX | LOCK_NB);\n    Mmap mmap(filepath_dboptions, info.st_size);\n    Status status_dboptions = DatabaseOptionEncoder::DecodeFrom(mmap.datafile(), mmap.filesize(), &db_options_candidate);\n    // ...\n    em_ = new EventManager();\n    wb_ = new WriteBuffer(db_options_, em_);\n    se_ = new StorageEngine(db_options_, em_, dbname_);\n    return Status::OK(); \n  }\n  virtual void Close() override {\n    flock(fd_dboptions_, LOCK_UN);\n    close(fd_dboptions_);\n    wb_->Close();\n    se_->Close();\n    delete wb_;\n    delete se_;\n    delete em_;\n  }\n}\n",[3752],{"type":397,"tag":484,"props":3753,"children":3754},{"__ignoreMap":391},[3755,3784,3819,3848,3896,3957,3997,4040,4118,4126,4152,4195,4245,4273,4280,4307,4335,4355,4377,4397,4414,4430,4445,4452],{"type":397,"tag":488,"props":3756,"children":3757},{"class":490,"line":491},[3758,3762,3767,3771,3775,3780],{"type":397,"tag":488,"props":3759,"children":3760},{"style":531},[3761],{"type":403,"value":1908},{"type":397,"tag":488,"props":3763,"children":3764},{"style":558},[3765],{"type":403,"value":3766}," Database",{"type":397,"tag":488,"props":3768,"children":3769},{"style":543},[3770],{"type":403,"value":1593},{"type":397,"tag":488,"props":3772,"children":3773},{"style":531},[3774],{"type":403,"value":1957},{"type":397,"tag":488,"props":3776,"children":3777},{"style":558},[3778],{"type":403,"value":3779}," KingDB",{"type":397,"tag":488,"props":3781,"children":3782},{"style":543},[3783],{"type":403,"value":551},{"type":397,"tag":488,"props":3785,"children":3786},{"class":490,"line":518},[3787,3792,3797,3801,3805,3810,3814],{"type":397,"tag":488,"props":3788,"children":3789},{"style":1995},[3790],{"type":403,"value":3791},"  virtual",{"type":397,"tag":488,"props":3793,"children":3794},{"style":537},[3795],{"type":403,"value":3796}," ~Database",{"type":397,"tag":488,"props":3798,"children":3799},{"style":543},[3800],{"type":403,"value":546},{"type":397,"tag":488,"props":3802,"children":3803},{"style":543},[3804],{"type":403,"value":2017},{"type":397,"tag":488,"props":3806,"children":3807},{"style":537},[3808],{"type":403,"value":3809}," Close",{"type":397,"tag":488,"props":3811,"children":3812},{"style":543},[3813],{"type":403,"value":1984},{"type":397,"tag":488,"props":3815,"children":3816},{"style":543},[3817],{"type":403,"value":3818}," }\n",{"type":397,"tag":488,"props":3820,"children":3821},{"class":490,"line":527},[3822,3826,3830,3835,3839,3844],{"type":397,"tag":488,"props":3823,"children":3824},{"style":1995},[3825],{"type":403,"value":3791},{"type":397,"tag":488,"props":3827,"children":3828},{"style":558},[3829],{"type":403,"value":3490},{"type":397,"tag":488,"props":3831,"children":3832},{"style":537},[3833],{"type":403,"value":3834}," Open",{"type":397,"tag":488,"props":3836,"children":3837},{"style":543},[3838],{"type":403,"value":546},{"type":397,"tag":488,"props":3840,"children":3841},{"style":1995},[3842],{"type":403,"value":3843}," override",{"type":397,"tag":488,"props":3845,"children":3846},{"style":543},[3847],{"type":403,"value":551},{"type":397,"tag":488,"props":3849,"children":3850},{"class":490,"line":554},[3851,3856,3860,3865,3869,3874,3878,3883,3887,3892],{"type":397,"tag":488,"props":3852,"children":3853},{"style":558},[3854],{"type":403,"value":3855},"    std",{"type":397,"tag":488,"props":3857,"children":3858},{"style":543},[3859],{"type":403,"value":566},{"type":397,"tag":488,"props":3861,"children":3862},{"style":748},[3863],{"type":403,"value":3864},"string filepath_dboptions ",{"type":397,"tag":488,"props":3866,"children":3867},{"style":667},[3868],{"type":403,"value":670},{"type":397,"tag":488,"props":3870,"children":3871},{"style":558},[3872],{"type":403,"value":3873}," DatabaseOptions",{"type":397,"tag":488,"props":3875,"children":3876},{"style":543},[3877],{"type":403,"value":566},{"type":397,"tag":488,"props":3879,"children":3880},{"style":537},[3881],{"type":403,"value":3882},"GetPath",{"type":397,"tag":488,"props":3884,"children":3885},{"style":543},[3886],{"type":403,"value":625},{"type":397,"tag":488,"props":3888,"children":3889},{"style":748},[3890],{"type":403,"value":3891},"dbname_",{"type":397,"tag":488,"props":3893,"children":3894},{"style":543},[3895],{"type":403,"value":655},{"type":397,"tag":488,"props":3897,"children":3898},{"class":490,"line":580},[3899,3904,3908,3913,3917,3922,3926,3930,3934,3939,3943,3948,3953],{"type":397,"tag":488,"props":3900,"children":3901},{"style":748},[3902],{"type":403,"value":3903},"    fd_dboptions_ ",{"type":397,"tag":488,"props":3905,"children":3906},{"style":667},[3907],{"type":403,"value":670},{"type":397,"tag":488,"props":3909,"children":3910},{"style":537},[3911],{"type":403,"value":3912}," open",{"type":397,"tag":488,"props":3914,"children":3915},{"style":543},[3916],{"type":403,"value":625},{"type":397,"tag":488,"props":3918,"children":3919},{"style":569},[3920],{"type":403,"value":3921},"filepath_dboptions",{"type":397,"tag":488,"props":3923,"children":3924},{"style":543},[3925],{"type":403,"value":680},{"type":397,"tag":488,"props":3927,"children":3928},{"style":537},[3929],{"type":403,"value":808},{"type":397,"tag":488,"props":3931,"children":3932},{"style":543},[3933],{"type":403,"value":3619},{"type":397,"tag":488,"props":3935,"children":3936},{"style":748},[3937],{"type":403,"value":3938}," O_RDONLY",{"type":397,"tag":488,"props":3940,"children":3941},{"style":543},[3942],{"type":403,"value":635},{"type":397,"tag":488,"props":3944,"children":3946},{"style":3945},"--shiki-light:#F76D47;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[3947],{"type":403,"value":1321},{"type":397,"tag":488,"props":3949,"children":3950},{"style":829},[3951],{"type":403,"value":3952},"644",{"type":397,"tag":488,"props":3954,"children":3955},{"style":543},[3956],{"type":403,"value":655},{"type":397,"tag":488,"props":3958,"children":3959},{"class":490,"line":601},[3960,3965,3969,3974,3978,3983,3988,3993],{"type":397,"tag":488,"props":3961,"children":3962},{"style":537},[3963],{"type":403,"value":3964},"    flock",{"type":397,"tag":488,"props":3966,"children":3967},{"style":543},[3968],{"type":403,"value":625},{"type":397,"tag":488,"props":3970,"children":3971},{"style":748},[3972],{"type":403,"value":3973},"fd_dboptions_",{"type":397,"tag":488,"props":3975,"children":3976},{"style":543},[3977],{"type":403,"value":635},{"type":397,"tag":488,"props":3979,"children":3980},{"style":748},[3981],{"type":403,"value":3982}," LOCK_EX ",{"type":397,"tag":488,"props":3984,"children":3985},{"style":667},[3986],{"type":403,"value":3987},"|",{"type":397,"tag":488,"props":3989,"children":3990},{"style":748},[3991],{"type":403,"value":3992}," LOCK_NB",{"type":397,"tag":488,"props":3994,"children":3995},{"style":543},[3996],{"type":403,"value":655},{"type":397,"tag":488,"props":3998,"children":3999},{"class":490,"line":658},[4000,4005,4010,4014,4018,4022,4027,4031,4036],{"type":397,"tag":488,"props":4001,"children":4002},{"style":748},[4003],{"type":403,"value":4004},"    Mmap ",{"type":397,"tag":488,"props":4006,"children":4007},{"style":537},[4008],{"type":403,"value":4009},"mmap",{"type":397,"tag":488,"props":4011,"children":4012},{"style":543},[4013],{"type":403,"value":625},{"type":397,"tag":488,"props":4015,"children":4016},{"style":748},[4017],{"type":403,"value":3921},{"type":397,"tag":488,"props":4019,"children":4020},{"style":543},[4021],{"type":403,"value":635},{"type":397,"tag":488,"props":4023,"children":4024},{"style":569},[4025],{"type":403,"value":4026}," info",{"type":397,"tag":488,"props":4028,"children":4029},{"style":543},[4030],{"type":403,"value":680},{"type":397,"tag":488,"props":4032,"children":4033},{"style":569},[4034],{"type":403,"value":4035},"st_size",{"type":397,"tag":488,"props":4037,"children":4038},{"style":543},[4039],{"type":403,"value":655},{"type":397,"tag":488,"props":4041,"children":4042},{"class":490,"line":693},[4043,4048,4052,4057,4061,4066,4070,4074,4078,4083,4087,4092,4096,4101,4105,4109,4114],{"type":397,"tag":488,"props":4044,"children":4045},{"style":748},[4046],{"type":403,"value":4047},"    Status status_dboptions ",{"type":397,"tag":488,"props":4049,"children":4050},{"style":667},[4051],{"type":403,"value":670},{"type":397,"tag":488,"props":4053,"children":4054},{"style":558},[4055],{"type":403,"value":4056}," DatabaseOptionEncoder",{"type":397,"tag":488,"props":4058,"children":4059},{"style":543},[4060],{"type":403,"value":566},{"type":397,"tag":488,"props":4062,"children":4063},{"style":537},[4064],{"type":403,"value":4065},"DecodeFrom",{"type":397,"tag":488,"props":4067,"children":4068},{"style":543},[4069],{"type":403,"value":625},{"type":397,"tag":488,"props":4071,"children":4072},{"style":569},[4073],{"type":403,"value":4009},{"type":397,"tag":488,"props":4075,"children":4076},{"style":543},[4077],{"type":403,"value":680},{"type":397,"tag":488,"props":4079,"children":4080},{"style":537},[4081],{"type":403,"value":4082},"datafile",{"type":397,"tag":488,"props":4084,"children":4085},{"style":543},[4086],{"type":403,"value":3619},{"type":397,"tag":488,"props":4088,"children":4089},{"style":569},[4090],{"type":403,"value":4091}," mmap",{"type":397,"tag":488,"props":4093,"children":4094},{"style":543},[4095],{"type":403,"value":680},{"type":397,"tag":488,"props":4097,"children":4098},{"style":537},[4099],{"type":403,"value":4100},"filesize",{"type":397,"tag":488,"props":4102,"children":4103},{"style":543},[4104],{"type":403,"value":3619},{"type":397,"tag":488,"props":4106,"children":4107},{"style":667},[4108],{"type":403,"value":1123},{"type":397,"tag":488,"props":4110,"children":4111},{"style":748},[4112],{"type":403,"value":4113},"db_options_candidate",{"type":397,"tag":488,"props":4115,"children":4116},{"style":543},[4117],{"type":403,"value":655},{"type":397,"tag":488,"props":4119,"children":4120},{"class":490,"line":735},[4121],{"type":397,"tag":488,"props":4122,"children":4123},{"style":1497},[4124],{"type":403,"value":4125},"    // ...\n",{"type":397,"tag":488,"props":4127,"children":4128},{"class":490,"line":816},[4129,4134,4138,4143,4148],{"type":397,"tag":488,"props":4130,"children":4131},{"style":748},[4132],{"type":403,"value":4133},"    em_ ",{"type":397,"tag":488,"props":4135,"children":4136},{"style":667},[4137],{"type":403,"value":670},{"type":397,"tag":488,"props":4139,"children":4140},{"style":667},[4141],{"type":403,"value":4142}," new",{"type":397,"tag":488,"props":4144,"children":4145},{"style":537},[4146],{"type":403,"value":4147}," EventManager",{"type":397,"tag":488,"props":4149,"children":4150},{"style":543},[4151],{"type":403,"value":690},{"type":397,"tag":488,"props":4153,"children":4154},{"class":490,"line":839},[4155,4160,4164,4168,4173,4177,4182,4186,4191],{"type":397,"tag":488,"props":4156,"children":4157},{"style":748},[4158],{"type":403,"value":4159},"    wb_ ",{"type":397,"tag":488,"props":4161,"children":4162},{"style":667},[4163],{"type":403,"value":670},{"type":397,"tag":488,"props":4165,"children":4166},{"style":667},[4167],{"type":403,"value":4142},{"type":397,"tag":488,"props":4169,"children":4170},{"style":537},[4171],{"type":403,"value":4172}," WriteBuffer",{"type":397,"tag":488,"props":4174,"children":4175},{"style":543},[4176],{"type":403,"value":625},{"type":397,"tag":488,"props":4178,"children":4179},{"style":748},[4180],{"type":403,"value":4181},"db_options_",{"type":397,"tag":488,"props":4183,"children":4184},{"style":543},[4185],{"type":403,"value":635},{"type":397,"tag":488,"props":4187,"children":4188},{"style":748},[4189],{"type":403,"value":4190}," em_",{"type":397,"tag":488,"props":4192,"children":4193},{"style":543},[4194],{"type":403,"value":655},{"type":397,"tag":488,"props":4196,"children":4197},{"class":490,"line":848},[4198,4203,4207,4211,4216,4220,4224,4228,4232,4236,4241],{"type":397,"tag":488,"props":4199,"children":4200},{"style":748},[4201],{"type":403,"value":4202},"    se_ ",{"type":397,"tag":488,"props":4204,"children":4205},{"style":667},[4206],{"type":403,"value":670},{"type":397,"tag":488,"props":4208,"children":4209},{"style":667},[4210],{"type":403,"value":4142},{"type":397,"tag":488,"props":4212,"children":4213},{"style":537},[4214],{"type":403,"value":4215}," StorageEngine",{"type":397,"tag":488,"props":4217,"children":4218},{"style":543},[4219],{"type":403,"value":625},{"type":397,"tag":488,"props":4221,"children":4222},{"style":748},[4223],{"type":403,"value":4181},{"type":397,"tag":488,"props":4225,"children":4226},{"style":543},[4227],{"type":403,"value":635},{"type":397,"tag":488,"props":4229,"children":4230},{"style":748},[4231],{"type":403,"value":4190},{"type":397,"tag":488,"props":4233,"children":4234},{"style":543},[4235],{"type":403,"value":635},{"type":397,"tag":488,"props":4237,"children":4238},{"style":748},[4239],{"type":403,"value":4240}," dbname_",{"type":397,"tag":488,"props":4242,"children":4243},{"style":543},[4244],{"type":403,"value":655},{"type":397,"tag":488,"props":4246,"children":4247},{"class":490,"line":856},[4248,4252,4256,4260,4265,4269],{"type":397,"tag":488,"props":4249,"children":4250},{"style":495},[4251],{"type":403,"value":2728},{"type":397,"tag":488,"props":4253,"children":4254},{"style":558},[4255],{"type":403,"value":3490},{"type":397,"tag":488,"props":4257,"children":4258},{"style":543},[4259],{"type":403,"value":566},{"type":397,"tag":488,"props":4261,"children":4262},{"style":537},[4263],{"type":403,"value":4264},"OK",{"type":397,"tag":488,"props":4266,"children":4267},{"style":543},[4268],{"type":403,"value":1984},{"type":397,"tag":488,"props":4270,"children":4271},{"style":748},[4272],{"type":403,"value":1236},{"type":397,"tag":488,"props":4274,"children":4275},{"class":490,"line":899},[4276],{"type":397,"tag":488,"props":4277,"children":4278},{"style":543},[4279],{"type":403,"value":845},{"type":397,"tag":488,"props":4281,"children":4282},{"class":490,"line":940},[4283,4287,4291,4295,4299,4303],{"type":397,"tag":488,"props":4284,"children":4285},{"style":1995},[4286],{"type":403,"value":3791},{"type":397,"tag":488,"props":4288,"children":4289},{"style":531},[4290],{"type":403,"value":2003},{"type":397,"tag":488,"props":4292,"children":4293},{"style":537},[4294],{"type":403,"value":3809},{"type":397,"tag":488,"props":4296,"children":4297},{"style":543},[4298],{"type":403,"value":546},{"type":397,"tag":488,"props":4300,"children":4301},{"style":1995},[4302],{"type":403,"value":3843},{"type":397,"tag":488,"props":4304,"children":4305},{"style":543},[4306],{"type":403,"value":551},{"type":397,"tag":488,"props":4308,"children":4309},{"class":490,"line":948},[4310,4314,4318,4322,4326,4331],{"type":397,"tag":488,"props":4311,"children":4312},{"style":537},[4313],{"type":403,"value":3964},{"type":397,"tag":488,"props":4315,"children":4316},{"style":543},[4317],{"type":403,"value":625},{"type":397,"tag":488,"props":4319,"children":4320},{"style":748},[4321],{"type":403,"value":3973},{"type":397,"tag":488,"props":4323,"children":4324},{"style":543},[4325],{"type":403,"value":635},{"type":397,"tag":488,"props":4327,"children":4328},{"style":748},[4329],{"type":403,"value":4330}," LOCK_UN",{"type":397,"tag":488,"props":4332,"children":4333},{"style":543},[4334],{"type":403,"value":655},{"type":397,"tag":488,"props":4336,"children":4337},{"class":490,"line":969},[4338,4343,4347,4351],{"type":397,"tag":488,"props":4339,"children":4340},{"style":537},[4341],{"type":403,"value":4342},"    close",{"type":397,"tag":488,"props":4344,"children":4345},{"style":543},[4346],{"type":403,"value":625},{"type":397,"tag":488,"props":4348,"children":4349},{"style":748},[4350],{"type":403,"value":3973},{"type":397,"tag":488,"props":4352,"children":4353},{"style":543},[4354],{"type":403,"value":655},{"type":397,"tag":488,"props":4356,"children":4357},{"class":490,"line":1025},[4358,4363,4368,4373],{"type":397,"tag":488,"props":4359,"children":4360},{"style":569},[4361],{"type":403,"value":4362},"    wb_",{"type":397,"tag":488,"props":4364,"children":4365},{"style":543},[4366],{"type":403,"value":4367},"->",{"type":397,"tag":488,"props":4369,"children":4370},{"style":537},[4371],{"type":403,"value":4372},"Close",{"type":397,"tag":488,"props":4374,"children":4375},{"style":543},[4376],{"type":403,"value":690},{"type":397,"tag":488,"props":4378,"children":4379},{"class":490,"line":1033},[4380,4385,4389,4393],{"type":397,"tag":488,"props":4381,"children":4382},{"style":569},[4383],{"type":403,"value":4384},"    se_",{"type":397,"tag":488,"props":4386,"children":4387},{"style":543},[4388],{"type":403,"value":4367},{"type":397,"tag":488,"props":4390,"children":4391},{"style":537},[4392],{"type":403,"value":4372},{"type":397,"tag":488,"props":4394,"children":4395},{"style":543},[4396],{"type":403,"value":690},{"type":397,"tag":488,"props":4398,"children":4399},{"class":490,"line":1054},[4400,4405,4410],{"type":397,"tag":488,"props":4401,"children":4402},{"style":667},[4403],{"type":403,"value":4404},"    delete",{"type":397,"tag":488,"props":4406,"children":4407},{"style":748},[4408],{"type":403,"value":4409}," wb_",{"type":397,"tag":488,"props":4411,"children":4412},{"style":543},[4413],{"type":403,"value":577},{"type":397,"tag":488,"props":4415,"children":4416},{"class":490,"line":1075},[4417,4421,4426],{"type":397,"tag":488,"props":4418,"children":4419},{"style":667},[4420],{"type":403,"value":4404},{"type":397,"tag":488,"props":4422,"children":4423},{"style":748},[4424],{"type":403,"value":4425}," se_",{"type":397,"tag":488,"props":4427,"children":4428},{"style":543},[4429],{"type":403,"value":577},{"type":397,"tag":488,"props":4431,"children":4432},{"class":490,"line":1135},[4433,4437,4441],{"type":397,"tag":488,"props":4434,"children":4435},{"style":667},[4436],{"type":403,"value":4404},{"type":397,"tag":488,"props":4438,"children":4439},{"style":748},[4440],{"type":403,"value":4190},{"type":397,"tag":488,"props":4442,"children":4443},{"style":543},[4444],{"type":403,"value":577},{"type":397,"tag":488,"props":4446,"children":4447},{"class":490,"line":1199},[4448],{"type":397,"tag":488,"props":4449,"children":4450},{"style":543},[4451],{"type":403,"value":845},{"type":397,"tag":488,"props":4453,"children":4454},{"class":490,"line":1239},[4455],{"type":397,"tag":488,"props":4456,"children":4457},{"style":543},[4458],{"type":403,"value":1334},{"type":397,"tag":411,"props":4460,"children":4461},{},[4462],{"type":403,"value":4463},"因为数据库不能同时关闭或是开启，所以 Open 以及 Close 中都使用了 std::unique_lock 进行锁定。",{"type":397,"tag":477,"props":4465,"children":4467},{"code":4466,"language":480,"meta":391,"className":481,"style":391},"virtual Status Open() override {\n  std::unique_lock\u003Cstd::mutex> lock(mutex_close_);\n}\nvirtual void Close() override {\n  std::unique_lock\u003Cstd::mutex> lock(mutex_close_);\n}\n",[4468],{"type":397,"tag":484,"props":4469,"children":4470},{"__ignoreMap":391},[4471,4498,4553,4560,4587,4638],{"type":397,"tag":488,"props":4472,"children":4473},{"class":490,"line":491},[4474,4478,4482,4486,4490,4494],{"type":397,"tag":488,"props":4475,"children":4476},{"style":1995},[4477],{"type":403,"value":3485},{"type":397,"tag":488,"props":4479,"children":4480},{"style":558},[4481],{"type":403,"value":3490},{"type":397,"tag":488,"props":4483,"children":4484},{"style":537},[4485],{"type":403,"value":3834},{"type":397,"tag":488,"props":4487,"children":4488},{"style":543},[4489],{"type":403,"value":546},{"type":397,"tag":488,"props":4491,"children":4492},{"style":1995},[4493],{"type":403,"value":3843},{"type":397,"tag":488,"props":4495,"children":4496},{"style":543},[4497],{"type":403,"value":551},{"type":397,"tag":488,"props":4499,"children":4500},{"class":490,"line":518},[4501,4505,4509,4514,4518,4522,4526,4531,4535,4540,4544,4549],{"type":397,"tag":488,"props":4502,"children":4503},{"style":558},[4504],{"type":403,"value":862},{"type":397,"tag":488,"props":4506,"children":4507},{"style":543},[4508],{"type":403,"value":566},{"type":397,"tag":488,"props":4510,"children":4511},{"style":569},[4512],{"type":403,"value":4513},"unique_lock",{"type":397,"tag":488,"props":4515,"children":4516},{"style":667},[4517],{"type":403,"value":3267},{"type":397,"tag":488,"props":4519,"children":4520},{"style":558},[4521],{"type":403,"value":2939},{"type":397,"tag":488,"props":4523,"children":4524},{"style":543},[4525],{"type":403,"value":566},{"type":397,"tag":488,"props":4527,"children":4528},{"style":569},[4529],{"type":403,"value":4530},"mutex",{"type":397,"tag":488,"props":4532,"children":4533},{"style":667},[4534],{"type":403,"value":2475},{"type":397,"tag":488,"props":4536,"children":4537},{"style":537},[4538],{"type":403,"value":4539}," lock",{"type":397,"tag":488,"props":4541,"children":4542},{"style":543},[4543],{"type":403,"value":625},{"type":397,"tag":488,"props":4545,"children":4546},{"style":569},[4547],{"type":403,"value":4548},"mutex_close_",{"type":397,"tag":488,"props":4550,"children":4551},{"style":543},[4552],{"type":403,"value":655},{"type":397,"tag":488,"props":4554,"children":4555},{"class":490,"line":527},[4556],{"type":397,"tag":488,"props":4557,"children":4558},{"style":543},[4559],{"type":403,"value":1334},{"type":397,"tag":488,"props":4561,"children":4562},{"class":490,"line":554},[4563,4567,4571,4575,4579,4583],{"type":397,"tag":488,"props":4564,"children":4565},{"style":1995},[4566],{"type":403,"value":3485},{"type":397,"tag":488,"props":4568,"children":4569},{"style":531},[4570],{"type":403,"value":2003},{"type":397,"tag":488,"props":4572,"children":4573},{"style":537},[4574],{"type":403,"value":3809},{"type":397,"tag":488,"props":4576,"children":4577},{"style":543},[4578],{"type":403,"value":546},{"type":397,"tag":488,"props":4580,"children":4581},{"style":1995},[4582],{"type":403,"value":3843},{"type":397,"tag":488,"props":4584,"children":4585},{"style":543},[4586],{"type":403,"value":551},{"type":397,"tag":488,"props":4588,"children":4589},{"class":490,"line":580},[4590,4594,4598,4602,4606,4610,4614,4618,4622,4626,4630,4634],{"type":397,"tag":488,"props":4591,"children":4592},{"style":558},[4593],{"type":403,"value":862},{"type":397,"tag":488,"props":4595,"children":4596},{"style":543},[4597],{"type":403,"value":566},{"type":397,"tag":488,"props":4599,"children":4600},{"style":569},[4601],{"type":403,"value":4513},{"type":397,"tag":488,"props":4603,"children":4604},{"style":667},[4605],{"type":403,"value":3267},{"type":397,"tag":488,"props":4607,"children":4608},{"style":558},[4609],{"type":403,"value":2939},{"type":397,"tag":488,"props":4611,"children":4612},{"style":543},[4613],{"type":403,"value":566},{"type":397,"tag":488,"props":4615,"children":4616},{"style":569},[4617],{"type":403,"value":4530},{"type":397,"tag":488,"props":4619,"children":4620},{"style":667},[4621],{"type":403,"value":2475},{"type":397,"tag":488,"props":4623,"children":4624},{"style":537},[4625],{"type":403,"value":4539},{"type":397,"tag":488,"props":4627,"children":4628},{"style":543},[4629],{"type":403,"value":625},{"type":397,"tag":488,"props":4631,"children":4632},{"style":569},[4633],{"type":403,"value":4548},{"type":397,"tag":488,"props":4635,"children":4636},{"style":543},[4637],{"type":403,"value":655},{"type":397,"tag":488,"props":4639,"children":4640},{"class":490,"line":601},[4641],{"type":397,"tag":488,"props":4642,"children":4643},{"style":543},[4644],{"type":403,"value":1334},{"type":397,"tag":405,"props":4646,"children":4647},{"id":3463},[4648],{"type":403,"value":3463},{"type":397,"tag":411,"props":4650,"children":4651},{},[4652],{"type":403,"value":4653},"代码没有使用 C++ 风格的异常捕获，取而代之的是设计了状态类 Status。就像 kingdb_user 示例展示的，所有数据库操作都会返回一个状态实例，通过调用其 IsOK 方法，调用者可以判断处出操作有没有成功；如果失败了，可以使用 ToString 方法把出错原因输出。尽管这种设计会带来额外的内存开销，且使每次调用都带来轻微的性能消耗，不过这种消耗可以避免魔法数值，它将错误码和核心解耦，使代码有更佳的可读性。",{"type":397,"tag":477,"props":4655,"children":4657},{"code":4656,"language":480,"meta":391,"className":481,"style":391},"class Status {\n  // ...\n  static Status OK() { return Status(); }\n  bool IsOK() const { return (code_ == kOK); }\n  // ...\n  enum Code {\n    kOK = 0, \n    kNotFound = 1,\n    kDeleteOrder = 2,\n    kInvalidArgument = 3,\n    kIOError = 4,\n    kDone = 5,\n    kMultipartRequired = 6\n  };\n  // ...\n}\nstd::string Status::ToString() const {\n  if (message1_ == \"\") {\n    return \"OK\";\n  } else {\n    char tmp[30];\n    const char* type;\n    switch (code()) {\n      case kOK:\n        type = \"OK\";\n        break;\n      // ...\n    }\n    // ...\n    return result;\n  }\n}\n",[4658],{"type":397,"tag":484,"props":4659,"children":4660},{"__ignoreMap":391},[4661,4676,4683,4724,4779,4786,4803,4828,4849,4870,4891,4912,4933,4950,4958,4965,4972,5011,5044,5067,5082,5108,5135,5159,5176,5204,5216,5224,5232,5239,5256,5264],{"type":397,"tag":488,"props":4662,"children":4663},{"class":490,"line":491},[4664,4668,4672],{"type":397,"tag":488,"props":4665,"children":4666},{"style":531},[4667],{"type":403,"value":1908},{"type":397,"tag":488,"props":4669,"children":4670},{"style":558},[4671],{"type":403,"value":3490},{"type":397,"tag":488,"props":4673,"children":4674},{"style":543},[4675],{"type":403,"value":551},{"type":397,"tag":488,"props":4677,"children":4678},{"class":490,"line":518},[4679],{"type":397,"tag":488,"props":4680,"children":4681},{"style":1497},[4682],{"type":403,"value":1853},{"type":397,"tag":488,"props":4684,"children":4685},{"class":490,"line":527},[4686,4690,4694,4699,4703,4707,4712,4716,4720],{"type":397,"tag":488,"props":4687,"children":4688},{"style":1995},[4689],{"type":403,"value":1998},{"type":397,"tag":488,"props":4691,"children":4692},{"style":558},[4693],{"type":403,"value":3490},{"type":397,"tag":488,"props":4695,"children":4696},{"style":537},[4697],{"type":403,"value":4698}," OK",{"type":397,"tag":488,"props":4700,"children":4701},{"style":543},[4702],{"type":403,"value":546},{"type":397,"tag":488,"props":4704,"children":4705},{"style":543},[4706],{"type":403,"value":2017},{"type":397,"tag":488,"props":4708,"children":4709},{"style":495},[4710],{"type":403,"value":4711}," return",{"type":397,"tag":488,"props":4713,"children":4714},{"style":537},[4715],{"type":403,"value":3490},{"type":397,"tag":488,"props":4717,"children":4718},{"style":543},[4719],{"type":403,"value":1984},{"type":397,"tag":488,"props":4721,"children":4722},{"style":543},[4723],{"type":403,"value":3818},{"type":397,"tag":488,"props":4725,"children":4726},{"class":490,"line":554},[4727,4732,4737,4741,4745,4749,4753,4757,4762,4766,4771,4775],{"type":397,"tag":488,"props":4728,"children":4729},{"style":531},[4730],{"type":403,"value":4731},"  bool",{"type":397,"tag":488,"props":4733,"children":4734},{"style":537},[4735],{"type":403,"value":4736}," IsOK",{"type":397,"tag":488,"props":4738,"children":4739},{"style":543},[4740],{"type":403,"value":546},{"type":397,"tag":488,"props":4742,"children":4743},{"style":1995},[4744],{"type":403,"value":2529},{"type":397,"tag":488,"props":4746,"children":4747},{"style":543},[4748],{"type":403,"value":2017},{"type":397,"tag":488,"props":4750,"children":4751},{"style":495},[4752],{"type":403,"value":4711},{"type":397,"tag":488,"props":4754,"children":4755},{"style":543},[4756],{"type":403,"value":704},{"type":397,"tag":488,"props":4758,"children":4759},{"style":748},[4760],{"type":403,"value":4761},"code_ ",{"type":397,"tag":488,"props":4763,"children":4764},{"style":667},[4765],{"type":403,"value":1175},{"type":397,"tag":488,"props":4767,"children":4768},{"style":748},[4769],{"type":403,"value":4770}," kOK",{"type":397,"tag":488,"props":4772,"children":4773},{"style":543},[4774],{"type":403,"value":1231},{"type":397,"tag":488,"props":4776,"children":4777},{"style":543},[4778],{"type":403,"value":3818},{"type":397,"tag":488,"props":4780,"children":4781},{"class":490,"line":580},[4782],{"type":397,"tag":488,"props":4783,"children":4784},{"style":1497},[4785],{"type":403,"value":1853},{"type":397,"tag":488,"props":4787,"children":4788},{"class":490,"line":601},[4789,4794,4799],{"type":397,"tag":488,"props":4790,"children":4791},{"style":531},[4792],{"type":403,"value":4793},"  enum",{"type":397,"tag":488,"props":4795,"children":4796},{"style":558},[4797],{"type":403,"value":4798}," Code",{"type":397,"tag":488,"props":4800,"children":4801},{"style":543},[4802],{"type":403,"value":551},{"type":397,"tag":488,"props":4804,"children":4805},{"class":490,"line":658},[4806,4812,4816,4820,4824],{"type":397,"tag":488,"props":4807,"children":4809},{"style":4808},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#F8F8F2",[4810],{"type":403,"value":4811},"    kOK",{"type":397,"tag":488,"props":4813,"children":4814},{"style":667},[4815],{"type":403,"value":2154},{"type":397,"tag":488,"props":4817,"children":4818},{"style":829},[4819],{"type":403,"value":1321},{"type":397,"tag":488,"props":4821,"children":4822},{"style":543},[4823],{"type":403,"value":635},{"type":397,"tag":488,"props":4825,"children":4826},{"style":748},[4827],{"type":403,"value":1236},{"type":397,"tag":488,"props":4829,"children":4830},{"class":490,"line":693},[4831,4836,4840,4844],{"type":397,"tag":488,"props":4832,"children":4833},{"style":4808},[4834],{"type":403,"value":4835},"    kNotFound",{"type":397,"tag":488,"props":4837,"children":4838},{"style":667},[4839],{"type":403,"value":2154},{"type":397,"tag":488,"props":4841,"children":4842},{"style":829},[4843],{"type":403,"value":3046},{"type":397,"tag":488,"props":4845,"children":4846},{"style":543},[4847],{"type":403,"value":4848},",\n",{"type":397,"tag":488,"props":4850,"children":4851},{"class":490,"line":735},[4852,4857,4861,4866],{"type":397,"tag":488,"props":4853,"children":4854},{"style":4808},[4855],{"type":403,"value":4856},"    kDeleteOrder",{"type":397,"tag":488,"props":4858,"children":4859},{"style":667},[4860],{"type":403,"value":2154},{"type":397,"tag":488,"props":4862,"children":4863},{"style":829},[4864],{"type":403,"value":4865}," 2",{"type":397,"tag":488,"props":4867,"children":4868},{"style":543},[4869],{"type":403,"value":4848},{"type":397,"tag":488,"props":4871,"children":4872},{"class":490,"line":816},[4873,4878,4882,4887],{"type":397,"tag":488,"props":4874,"children":4875},{"style":4808},[4876],{"type":403,"value":4877},"    kInvalidArgument",{"type":397,"tag":488,"props":4879,"children":4880},{"style":667},[4881],{"type":403,"value":2154},{"type":397,"tag":488,"props":4883,"children":4884},{"style":829},[4885],{"type":403,"value":4886}," 3",{"type":397,"tag":488,"props":4888,"children":4889},{"style":543},[4890],{"type":403,"value":4848},{"type":397,"tag":488,"props":4892,"children":4893},{"class":490,"line":839},[4894,4899,4903,4908],{"type":397,"tag":488,"props":4895,"children":4896},{"style":4808},[4897],{"type":403,"value":4898},"    kIOError",{"type":397,"tag":488,"props":4900,"children":4901},{"style":667},[4902],{"type":403,"value":2154},{"type":397,"tag":488,"props":4904,"children":4905},{"style":829},[4906],{"type":403,"value":4907}," 4",{"type":397,"tag":488,"props":4909,"children":4910},{"style":543},[4911],{"type":403,"value":4848},{"type":397,"tag":488,"props":4913,"children":4914},{"class":490,"line":848},[4915,4920,4924,4929],{"type":397,"tag":488,"props":4916,"children":4917},{"style":4808},[4918],{"type":403,"value":4919},"    kDone",{"type":397,"tag":488,"props":4921,"children":4922},{"style":667},[4923],{"type":403,"value":2154},{"type":397,"tag":488,"props":4925,"children":4926},{"style":829},[4927],{"type":403,"value":4928}," 5",{"type":397,"tag":488,"props":4930,"children":4931},{"style":543},[4932],{"type":403,"value":4848},{"type":397,"tag":488,"props":4934,"children":4935},{"class":490,"line":856},[4936,4941,4945],{"type":397,"tag":488,"props":4937,"children":4938},{"style":4808},[4939],{"type":403,"value":4940},"    kMultipartRequired",{"type":397,"tag":488,"props":4942,"children":4943},{"style":667},[4944],{"type":403,"value":2154},{"type":397,"tag":488,"props":4946,"children":4947},{"style":829},[4948],{"type":403,"value":4949}," 6\n",{"type":397,"tag":488,"props":4951,"children":4952},{"class":490,"line":899},[4953],{"type":397,"tag":488,"props":4954,"children":4955},{"style":543},[4956],{"type":403,"value":4957},"  };\n",{"type":397,"tag":488,"props":4959,"children":4960},{"class":490,"line":940},[4961],{"type":397,"tag":488,"props":4962,"children":4963},{"style":1497},[4964],{"type":403,"value":1853},{"type":397,"tag":488,"props":4966,"children":4967},{"class":490,"line":948},[4968],{"type":397,"tag":488,"props":4969,"children":4970},{"style":543},[4971],{"type":403,"value":1334},{"type":397,"tag":488,"props":4973,"children":4974},{"class":490,"line":969},[4975,4979,4983,4987,4991,4995,4999,5003,5007],{"type":397,"tag":488,"props":4976,"children":4977},{"style":558},[4978],{"type":403,"value":2939},{"type":397,"tag":488,"props":4980,"children":4981},{"style":543},[4982],{"type":403,"value":566},{"type":397,"tag":488,"props":4984,"children":4985},{"style":558},[4986],{"type":403,"value":3534},{"type":397,"tag":488,"props":4988,"children":4989},{"style":558},[4990],{"type":403,"value":3490},{"type":397,"tag":488,"props":4992,"children":4993},{"style":543},[4994],{"type":403,"value":566},{"type":397,"tag":488,"props":4996,"children":4997},{"style":537},[4998],{"type":403,"value":798},{"type":397,"tag":488,"props":5000,"children":5001},{"style":543},[5002],{"type":403,"value":546},{"type":397,"tag":488,"props":5004,"children":5005},{"style":1995},[5006],{"type":403,"value":2529},{"type":397,"tag":488,"props":5008,"children":5009},{"style":543},[5010],{"type":403,"value":551},{"type":397,"tag":488,"props":5012,"children":5013},{"class":490,"line":1025},[5014,5018,5022,5027,5031,5036,5040],{"type":397,"tag":488,"props":5015,"children":5016},{"style":495},[5017],{"type":403,"value":699},{"type":397,"tag":488,"props":5019,"children":5020},{"style":543},[5021],{"type":403,"value":704},{"type":397,"tag":488,"props":5023,"children":5024},{"style":748},[5025],{"type":403,"value":5026},"message1_ ",{"type":397,"tag":488,"props":5028,"children":5029},{"style":667},[5030],{"type":403,"value":1175},{"type":397,"tag":488,"props":5032,"children":5033},{"style":501},[5034],{"type":403,"value":5035}," \"\"",{"type":397,"tag":488,"props":5037,"children":5038},{"style":543},[5039],{"type":403,"value":1192},{"type":397,"tag":488,"props":5041,"children":5042},{"style":543},[5043],{"type":403,"value":551},{"type":397,"tag":488,"props":5045,"children":5046},{"class":490,"line":1033},[5047,5051,5055,5059,5063],{"type":397,"tag":488,"props":5048,"children":5049},{"style":495},[5050],{"type":403,"value":2728},{"type":397,"tag":488,"props":5052,"children":5053},{"style":501},[5054],{"type":403,"value":640},{"type":397,"tag":488,"props":5056,"children":5057},{"style":507},[5058],{"type":403,"value":4264},{"type":397,"tag":488,"props":5060,"children":5061},{"style":501},[5062],{"type":403,"value":650},{"type":397,"tag":488,"props":5064,"children":5065},{"style":543},[5066],{"type":403,"value":577},{"type":397,"tag":488,"props":5068,"children":5069},{"class":490,"line":1054},[5070,5074,5078],{"type":397,"tag":488,"props":5071,"children":5072},{"style":543},[5073],{"type":403,"value":1245},{"type":397,"tag":488,"props":5075,"children":5076},{"style":495},[5077],{"type":403,"value":1250},{"type":397,"tag":488,"props":5079,"children":5080},{"style":543},[5081],{"type":403,"value":551},{"type":397,"tag":488,"props":5083,"children":5084},{"class":490,"line":1075},[5085,5090,5095,5099,5104],{"type":397,"tag":488,"props":5086,"children":5087},{"style":531},[5088],{"type":403,"value":5089},"    char",{"type":397,"tag":488,"props":5091,"children":5092},{"style":569},[5093],{"type":403,"value":5094}," tmp",{"type":397,"tag":488,"props":5096,"children":5097},{"style":543},[5098],{"type":403,"value":1464},{"type":397,"tag":488,"props":5100,"children":5101},{"style":829},[5102],{"type":403,"value":5103},"30",{"type":397,"tag":488,"props":5105,"children":5106},{"style":543},[5107],{"type":403,"value":1474},{"type":397,"tag":488,"props":5109,"children":5110},{"class":490,"line":1135},[5111,5116,5121,5126,5131],{"type":397,"tag":488,"props":5112,"children":5113},{"style":1995},[5114],{"type":403,"value":5115},"    const",{"type":397,"tag":488,"props":5117,"children":5118},{"style":531},[5119],{"type":403,"value":5120}," char",{"type":397,"tag":488,"props":5122,"children":5123},{"style":667},[5124],{"type":403,"value":5125},"*",{"type":397,"tag":488,"props":5127,"children":5128},{"style":748},[5129],{"type":403,"value":5130}," type",{"type":397,"tag":488,"props":5132,"children":5133},{"style":543},[5134],{"type":403,"value":577},{"type":397,"tag":488,"props":5136,"children":5137},{"class":490,"line":1199},[5138,5143,5147,5151,5155],{"type":397,"tag":488,"props":5139,"children":5140},{"style":495},[5141],{"type":403,"value":5142},"    switch",{"type":397,"tag":488,"props":5144,"children":5145},{"style":543},[5146],{"type":403,"value":704},{"type":397,"tag":488,"props":5148,"children":5149},{"style":537},[5150],{"type":403,"value":484},{"type":397,"tag":488,"props":5152,"children":5153},{"style":543},[5154],{"type":403,"value":728},{"type":397,"tag":488,"props":5156,"children":5157},{"style":543},[5158],{"type":403,"value":551},{"type":397,"tag":488,"props":5160,"children":5161},{"class":490,"line":1239},[5162,5167,5171],{"type":397,"tag":488,"props":5163,"children":5164},{"style":495},[5165],{"type":403,"value":5166},"      case",{"type":397,"tag":488,"props":5168,"children":5169},{"style":748},[5170],{"type":403,"value":4770},{"type":397,"tag":488,"props":5172,"children":5173},{"style":543},[5174],{"type":403,"value":5175},":\n",{"type":397,"tag":488,"props":5177,"children":5178},{"class":490,"line":1257},[5179,5184,5188,5192,5196,5200],{"type":397,"tag":488,"props":5180,"children":5181},{"style":748},[5182],{"type":403,"value":5183},"        type ",{"type":397,"tag":488,"props":5185,"children":5186},{"style":667},[5187],{"type":403,"value":670},{"type":397,"tag":488,"props":5189,"children":5190},{"style":501},[5191],{"type":403,"value":640},{"type":397,"tag":488,"props":5193,"children":5194},{"style":507},[5195],{"type":403,"value":4264},{"type":397,"tag":488,"props":5197,"children":5198},{"style":501},[5199],{"type":403,"value":650},{"type":397,"tag":488,"props":5201,"children":5202},{"style":543},[5203],{"type":403,"value":577},{"type":397,"tag":488,"props":5205,"children":5206},{"class":490,"line":1294},[5207,5212],{"type":397,"tag":488,"props":5208,"children":5209},{"style":495},[5210],{"type":403,"value":5211},"        break",{"type":397,"tag":488,"props":5213,"children":5214},{"style":543},[5215],{"type":403,"value":577},{"type":397,"tag":488,"props":5217,"children":5218},{"class":490,"line":1302},[5219],{"type":397,"tag":488,"props":5220,"children":5221},{"style":1497},[5222],{"type":403,"value":5223},"      // ...\n",{"type":397,"tag":488,"props":5225,"children":5226},{"class":490,"line":1310},[5227],{"type":397,"tag":488,"props":5228,"children":5229},{"style":543},[5230],{"type":403,"value":5231},"    }\n",{"type":397,"tag":488,"props":5233,"children":5234},{"class":490,"line":1328},[5235],{"type":397,"tag":488,"props":5236,"children":5237},{"style":1497},[5238],{"type":403,"value":4125},{"type":397,"tag":488,"props":5240,"children":5242},{"class":490,"line":5241},30,[5243,5247,5252],{"type":397,"tag":488,"props":5244,"children":5245},{"style":495},[5246],{"type":403,"value":2728},{"type":397,"tag":488,"props":5248,"children":5249},{"style":748},[5250],{"type":403,"value":5251}," result",{"type":397,"tag":488,"props":5253,"children":5254},{"style":543},[5255],{"type":403,"value":577},{"type":397,"tag":488,"props":5257,"children":5259},{"class":490,"line":5258},31,[5260],{"type":397,"tag":488,"props":5261,"children":5262},{"style":543},[5263],{"type":403,"value":845},{"type":397,"tag":488,"props":5265,"children":5267},{"class":490,"line":5266},32,[5268],{"type":397,"tag":488,"props":5269,"children":5270},{"style":543},[5271],{"type":403,"value":1334},{"type":397,"tag":411,"props":5273,"children":5274},{},[5275],{"type":403,"value":5276},"KDB 内部代码出现异常时会使用日志将其记录下来。如果没有日志，那么在排查代码问题时简直就是噩梦。KDB 有两套日志的输出目标，分别是系统输出和标准输出设备。日志类记录输出目标、日志级别、线程锁等成员，并通过静态方法 Logv 实现记录日志。锁的最大用处是保证记录顺序。仅有当出现最高级别的日志（kLogLevelEMERG）时，才会跳过锁直接写入。出现 kLogLevelEMERG 时意味着程序遇到了紧急问题，通常会直接退出或是返回 Status 异常，所以这个时候需要及时记录。",{"type":397,"tag":411,"props":5278,"children":5279},{},[5280],{"type":403,"value":5281},"日志级别的划分参考了 Syslog：",{"type":397,"tag":438,"props":5283,"children":5284},{},[5285,5290,5295,5300,5305,5310,5315,5320,5325,5330],{"type":397,"tag":442,"props":5286,"children":5287},{},[5288],{"type":403,"value":5289},"silent: all logging is turned off",{"type":397,"tag":442,"props":5291,"children":5292},{},[5293],{"type":403,"value":5294},"emerg: system is unusable, imminent crash",{"type":397,"tag":442,"props":5296,"children":5297},{},[5298],{"type":403,"value":5299},"alert: error event, immediate action required",{"type":397,"tag":442,"props":5301,"children":5302},{},[5303],{"type":403,"value":5304},"crit: error event, immediate action required",{"type":397,"tag":442,"props":5306,"children":5307},{},[5308],{"type":403,"value":5309},"error: error event, action is required but is not urgent",{"type":397,"tag":442,"props":5311,"children":5312},{},[5313],{"type":403,"value":5314},"warn: events that can be harmful if no action is taken",{"type":397,"tag":442,"props":5316,"children":5317},{},[5318],{"type":403,"value":5319},"notice: unusual events, but no immediate action required",{"type":397,"tag":442,"props":5321,"children":5322},{},[5323],{"type":403,"value":5324},"info: normal operation events, no action required",{"type":397,"tag":442,"props":5326,"children":5327},{},[5328],{"type":403,"value":5329},"debug: events used for debugging, no action required",{"type":397,"tag":442,"props":5331,"children":5332},{},[5333],{"type":403,"value":5334},"trace: fine-grained events used for debugging, no action required",{"type":397,"tag":1364,"props":5336,"children":5338},{"id":5337},"日志调用用宏还是函数",[5339],{"type":403,"value":5337},{"type":397,"tag":411,"props":5341,"children":5342},{},[5343,5345,5351,5353,5357],{"type":403,"value":5344},"原先的提交中，日志调用被定义在了宏里，直接调用 Logger::Logv 去记录。日志宏中使用子宏 ",{"type":397,"tag":5346,"props":5347,"children":5348},"strong",{},[5349],{"type":403,"value":5350},"VA_ARGS",{"type":403,"value":5352}," 来记录可变参数。",{"type":397,"tag":5346,"props":5354,"children":5355},{},[5356],{"type":403,"value":5350},{"type":403,"value":5358}," 前面有标记黏贴运算符的原因是当日志宏的可变参数为空时，可以把末尾的逗号去掉。",{"type":397,"tag":477,"props":5360,"children":5362},{"code":5361,"language":480,"meta":391,"className":481,"style":391},"class log {\n  static void emerg(const char* logname, const char* format, ...) {\n    va_list args;\n    va_start(args, format);\n    Logger::Logv(false, Logger::kLogLevelEMERG, LOG_EMERG, logname, format, args);\n    va_end(args);\n  }\n}\n// ...\n#define LOG_EMERG(logname, fmt, ...) \\\n        Logger::Logv(false, Logger::kLogLevelEMERG, logname, fmt, ##__VA_ARGS__)\n",[5363],{"type":397,"tag":484,"props":5364,"children":5365},{"__ignoreMap":391},[5366,5382,5457,5469,5498,5580,5600,5607,5614,5621,5663],{"type":397,"tag":488,"props":5367,"children":5368},{"class":490,"line":491},[5369,5373,5378],{"type":397,"tag":488,"props":5370,"children":5371},{"style":531},[5372],{"type":403,"value":1908},{"type":397,"tag":488,"props":5374,"children":5375},{"style":558},[5376],{"type":403,"value":5377}," log",{"type":397,"tag":488,"props":5379,"children":5380},{"style":543},[5381],{"type":403,"value":551},{"type":397,"tag":488,"props":5383,"children":5384},{"class":490,"line":518},[5385,5389,5393,5398,5402,5406,5410,5414,5419,5423,5427,5431,5435,5440,5444,5449,5453],{"type":397,"tag":488,"props":5386,"children":5387},{"style":1995},[5388],{"type":403,"value":1998},{"type":397,"tag":488,"props":5390,"children":5391},{"style":531},[5392],{"type":403,"value":2003},{"type":397,"tag":488,"props":5394,"children":5395},{"style":537},[5396],{"type":403,"value":5397}," emerg",{"type":397,"tag":488,"props":5399,"children":5400},{"style":543},[5401],{"type":403,"value":625},{"type":397,"tag":488,"props":5403,"children":5404},{"style":1995},[5405],{"type":403,"value":2507},{"type":397,"tag":488,"props":5407,"children":5408},{"style":531},[5409],{"type":403,"value":5120},{"type":397,"tag":488,"props":5411,"children":5412},{"style":1995},[5413],{"type":403,"value":5125},{"type":397,"tag":488,"props":5415,"children":5416},{"style":1404},[5417],{"type":403,"value":5418}," logname",{"type":397,"tag":488,"props":5420,"children":5421},{"style":543},[5422],{"type":403,"value":635},{"type":397,"tag":488,"props":5424,"children":5425},{"style":1995},[5426],{"type":403,"value":2529},{"type":397,"tag":488,"props":5428,"children":5429},{"style":531},[5430],{"type":403,"value":5120},{"type":397,"tag":488,"props":5432,"children":5433},{"style":1995},[5434],{"type":403,"value":5125},{"type":397,"tag":488,"props":5436,"children":5437},{"style":1404},[5438],{"type":403,"value":5439}," format",{"type":397,"tag":488,"props":5441,"children":5442},{"style":543},[5443],{"type":403,"value":635},{"type":397,"tag":488,"props":5445,"children":5446},{"style":748},[5447],{"type":403,"value":5448}," ...",{"type":397,"tag":488,"props":5450,"children":5451},{"style":543},[5452],{"type":403,"value":1192},{"type":397,"tag":488,"props":5454,"children":5455},{"style":543},[5456],{"type":403,"value":551},{"type":397,"tag":488,"props":5458,"children":5459},{"class":490,"line":527},[5460,5465],{"type":397,"tag":488,"props":5461,"children":5462},{"style":748},[5463],{"type":403,"value":5464},"    va_list args",{"type":397,"tag":488,"props":5466,"children":5467},{"style":543},[5468],{"type":403,"value":577},{"type":397,"tag":488,"props":5470,"children":5471},{"class":490,"line":554},[5472,5477,5481,5486,5490,5494],{"type":397,"tag":488,"props":5473,"children":5474},{"style":537},[5475],{"type":403,"value":5476},"    va_start",{"type":397,"tag":488,"props":5478,"children":5479},{"style":543},[5480],{"type":403,"value":625},{"type":397,"tag":488,"props":5482,"children":5483},{"style":748},[5484],{"type":403,"value":5485},"args",{"type":397,"tag":488,"props":5487,"children":5488},{"style":543},[5489],{"type":403,"value":635},{"type":397,"tag":488,"props":5491,"children":5492},{"style":748},[5493],{"type":403,"value":5439},{"type":397,"tag":488,"props":5495,"children":5496},{"style":543},[5497],{"type":403,"value":655},{"type":397,"tag":488,"props":5499,"children":5500},{"class":490,"line":580},[5501,5506,5510,5515,5519,5524,5528,5533,5537,5542,5546,5551,5555,5559,5563,5567,5571,5576],{"type":397,"tag":488,"props":5502,"children":5503},{"style":558},[5504],{"type":403,"value":5505},"    Logger",{"type":397,"tag":488,"props":5507,"children":5508},{"style":543},[5509],{"type":403,"value":566},{"type":397,"tag":488,"props":5511,"children":5512},{"style":537},[5513],{"type":403,"value":5514},"Logv",{"type":397,"tag":488,"props":5516,"children":5517},{"style":543},[5518],{"type":403,"value":625},{"type":397,"tag":488,"props":5520,"children":5521},{"style":2695},[5522],{"type":403,"value":5523},"false",{"type":397,"tag":488,"props":5525,"children":5526},{"style":543},[5527],{"type":403,"value":635},{"type":397,"tag":488,"props":5529,"children":5530},{"style":558},[5531],{"type":403,"value":5532}," Logger",{"type":397,"tag":488,"props":5534,"children":5535},{"style":543},[5536],{"type":403,"value":566},{"type":397,"tag":488,"props":5538,"children":5539},{"style":748},[5540],{"type":403,"value":5541},"kLogLevelEMERG",{"type":397,"tag":488,"props":5543,"children":5544},{"style":543},[5545],{"type":403,"value":635},{"type":397,"tag":488,"props":5547,"children":5548},{"style":748},[5549],{"type":403,"value":5550}," LOG_EMERG",{"type":397,"tag":488,"props":5552,"children":5553},{"style":543},[5554],{"type":403,"value":635},{"type":397,"tag":488,"props":5556,"children":5557},{"style":748},[5558],{"type":403,"value":5418},{"type":397,"tag":488,"props":5560,"children":5561},{"style":543},[5562],{"type":403,"value":635},{"type":397,"tag":488,"props":5564,"children":5565},{"style":748},[5566],{"type":403,"value":5439},{"type":397,"tag":488,"props":5568,"children":5569},{"style":543},[5570],{"type":403,"value":635},{"type":397,"tag":488,"props":5572,"children":5573},{"style":748},[5574],{"type":403,"value":5575}," args",{"type":397,"tag":488,"props":5577,"children":5578},{"style":543},[5579],{"type":403,"value":655},{"type":397,"tag":488,"props":5581,"children":5582},{"class":490,"line":601},[5583,5588,5592,5596],{"type":397,"tag":488,"props":5584,"children":5585},{"style":537},[5586],{"type":403,"value":5587},"    va_end",{"type":397,"tag":488,"props":5589,"children":5590},{"style":543},[5591],{"type":403,"value":625},{"type":397,"tag":488,"props":5593,"children":5594},{"style":748},[5595],{"type":403,"value":5485},{"type":397,"tag":488,"props":5597,"children":5598},{"style":543},[5599],{"type":403,"value":655},{"type":397,"tag":488,"props":5601,"children":5602},{"class":490,"line":658},[5603],{"type":397,"tag":488,"props":5604,"children":5605},{"style":543},[5606],{"type":403,"value":845},{"type":397,"tag":488,"props":5608,"children":5609},{"class":490,"line":693},[5610],{"type":397,"tag":488,"props":5611,"children":5612},{"style":543},[5613],{"type":403,"value":1334},{"type":397,"tag":488,"props":5615,"children":5616},{"class":490,"line":735},[5617],{"type":397,"tag":488,"props":5618,"children":5619},{"style":1497},[5620],{"type":403,"value":3309},{"type":397,"tag":488,"props":5622,"children":5623},{"class":490,"line":816},[5624,5628,5632,5636,5641,5645,5650,5654,5659],{"type":397,"tag":488,"props":5625,"children":5626},{"style":495},[5627],{"type":403,"value":1868},{"type":397,"tag":488,"props":5629,"children":5630},{"style":537},[5631],{"type":403,"value":5550},{"type":397,"tag":488,"props":5633,"children":5634},{"style":543},[5635],{"type":403,"value":625},{"type":397,"tag":488,"props":5637,"children":5638},{"style":1404},[5639],{"type":403,"value":5640},"logname",{"type":397,"tag":488,"props":5642,"children":5643},{"style":543},[5644],{"type":403,"value":635},{"type":397,"tag":488,"props":5646,"children":5647},{"style":1404},[5648],{"type":403,"value":5649}," fmt",{"type":397,"tag":488,"props":5651,"children":5652},{"style":543},[5653],{"type":403,"value":635},{"type":397,"tag":488,"props":5655,"children":5656},{"style":543},[5657],{"type":403,"value":5658}," ...)",{"type":397,"tag":488,"props":5660,"children":5661},{"style":773},[5662],{"type":403,"value":2254},{"type":397,"tag":488,"props":5664,"children":5665},{"class":490,"line":839},[5666,5671,5675,5679,5683,5687,5691,5695,5699,5703,5707,5711,5715,5719,5723,5728],{"type":397,"tag":488,"props":5667,"children":5668},{"style":558},[5669],{"type":403,"value":5670},"        Logger",{"type":397,"tag":488,"props":5672,"children":5673},{"style":543},[5674],{"type":403,"value":566},{"type":397,"tag":488,"props":5676,"children":5677},{"style":537},[5678],{"type":403,"value":5514},{"type":397,"tag":488,"props":5680,"children":5681},{"style":543},[5682],{"type":403,"value":625},{"type":397,"tag":488,"props":5684,"children":5685},{"style":2695},[5686],{"type":403,"value":5523},{"type":397,"tag":488,"props":5688,"children":5689},{"style":543},[5690],{"type":403,"value":635},{"type":397,"tag":488,"props":5692,"children":5693},{"style":558},[5694],{"type":403,"value":5532},{"type":397,"tag":488,"props":5696,"children":5697},{"style":543},[5698],{"type":403,"value":566},{"type":397,"tag":488,"props":5700,"children":5701},{"style":748},[5702],{"type":403,"value":5541},{"type":397,"tag":488,"props":5704,"children":5705},{"style":543},[5706],{"type":403,"value":635},{"type":397,"tag":488,"props":5708,"children":5709},{"style":748},[5710],{"type":403,"value":5418},{"type":397,"tag":488,"props":5712,"children":5713},{"style":543},[5714],{"type":403,"value":635},{"type":397,"tag":488,"props":5716,"children":5717},{"style":748},[5718],{"type":403,"value":5649},{"type":397,"tag":488,"props":5720,"children":5721},{"style":543},[5722],{"type":403,"value":635},{"type":397,"tag":488,"props":5724,"children":5725},{"style":569},[5726],{"type":403,"value":5727}," ##__VA_ARGS__",{"type":397,"tag":488,"props":5729,"children":5730},{"style":543},[5731],{"type":403,"value":2324},{"type":397,"tag":411,"props":5733,"children":5734},{},[5735],{"type":403,"value":5736},"尚不清楚为什么不用宏，而是使用运行时的方法调用（即 log 的 public 方法）。猜测可能是因为宏不能跨行？因为我看到了这种很长的调用。",{"type":397,"tag":477,"props":5738,"children":5740},{"code":5739,"language":480,"meta":391,"className":481,"style":391},"log::trace(\n  \"Database::PutPartValidSize()\",\n  \"[%s] size_chunk:%\" PRIu64 \" offset_chunk:%\" PRIu64,\n  key.ToString().c_str(),\n  chunk.size(),\n  offset_chunk\n);\n",[5741],{"type":397,"tag":484,"props":5742,"children":5743},{"__ignoreMap":391},[5744,5766,5787,5838,5867,5887,5895],{"type":397,"tag":488,"props":5745,"children":5746},{"class":490,"line":491},[5747,5752,5756,5761],{"type":397,"tag":488,"props":5748,"children":5749},{"style":558},[5750],{"type":403,"value":5751},"log",{"type":397,"tag":488,"props":5753,"children":5754},{"style":543},[5755],{"type":403,"value":566},{"type":397,"tag":488,"props":5757,"children":5758},{"style":537},[5759],{"type":403,"value":5760},"trace",{"type":397,"tag":488,"props":5762,"children":5763},{"style":543},[5764],{"type":403,"value":5765},"(\n",{"type":397,"tag":488,"props":5767,"children":5768},{"class":490,"line":518},[5769,5774,5779,5783],{"type":397,"tag":488,"props":5770,"children":5771},{"style":501},[5772],{"type":403,"value":5773},"  \"",{"type":397,"tag":488,"props":5775,"children":5776},{"style":507},[5777],{"type":403,"value":5778},"Database::PutPartValidSize()",{"type":397,"tag":488,"props":5780,"children":5781},{"style":501},[5782],{"type":403,"value":650},{"type":397,"tag":488,"props":5784,"children":5785},{"style":543},[5786],{"type":403,"value":4848},{"type":397,"tag":488,"props":5788,"children":5789},{"class":490,"line":527},[5790,5794,5798,5802,5807,5811,5816,5820,5825,5829,5834],{"type":397,"tag":488,"props":5791,"children":5792},{"style":501},[5793],{"type":403,"value":5773},{"type":397,"tag":488,"props":5795,"children":5796},{"style":507},[5797],{"type":403,"value":1464},{"type":397,"tag":488,"props":5799,"children":5800},{"style":767},[5801],{"type":403,"value":770},{"type":397,"tag":488,"props":5803,"children":5804},{"style":507},[5805],{"type":403,"value":5806},"] size_chunk:%",{"type":397,"tag":488,"props":5808,"children":5809},{"style":501},[5810],{"type":403,"value":650},{"type":397,"tag":488,"props":5812,"children":5813},{"style":569},[5814],{"type":403,"value":5815}," PRIu64 ",{"type":397,"tag":488,"props":5817,"children":5818},{"style":501},[5819],{"type":403,"value":650},{"type":397,"tag":488,"props":5821,"children":5822},{"style":507},[5823],{"type":403,"value":5824}," offset_chunk:%",{"type":397,"tag":488,"props":5826,"children":5827},{"style":501},[5828],{"type":403,"value":650},{"type":397,"tag":488,"props":5830,"children":5831},{"style":569},[5832],{"type":403,"value":5833}," PRIu64",{"type":397,"tag":488,"props":5835,"children":5836},{"style":543},[5837],{"type":403,"value":4848},{"type":397,"tag":488,"props":5839,"children":5840},{"class":490,"line":554},[5841,5846,5850,5854,5858,5862],{"type":397,"tag":488,"props":5842,"children":5843},{"style":569},[5844],{"type":403,"value":5845},"  key",{"type":397,"tag":488,"props":5847,"children":5848},{"style":543},[5849],{"type":403,"value":680},{"type":397,"tag":488,"props":5851,"children":5852},{"style":537},[5853],{"type":403,"value":798},{"type":397,"tag":488,"props":5855,"children":5856},{"style":543},[5857],{"type":403,"value":803},{"type":397,"tag":488,"props":5859,"children":5860},{"style":537},[5861],{"type":403,"value":808},{"type":397,"tag":488,"props":5863,"children":5864},{"style":543},[5865],{"type":403,"value":5866},"(),\n",{"type":397,"tag":488,"props":5868,"children":5869},{"class":490,"line":580},[5870,5875,5879,5883],{"type":397,"tag":488,"props":5871,"children":5872},{"style":569},[5873],{"type":403,"value":5874},"  chunk",{"type":397,"tag":488,"props":5876,"children":5877},{"style":543},[5878],{"type":403,"value":680},{"type":397,"tag":488,"props":5880,"children":5881},{"style":537},[5882],{"type":403,"value":3632},{"type":397,"tag":488,"props":5884,"children":5885},{"style":543},[5886],{"type":403,"value":5866},{"type":397,"tag":488,"props":5888,"children":5889},{"class":490,"line":601},[5890],{"type":397,"tag":488,"props":5891,"children":5892},{"style":569},[5893],{"type":403,"value":5894},"  offset_chunk\n",{"type":397,"tag":488,"props":5896,"children":5897},{"class":490,"line":658},[5898],{"type":397,"tag":488,"props":5899,"children":5900},{"style":543},[5901],{"type":403,"value":655},{"type":397,"tag":1364,"props":5903,"children":5905},{"id":5904},"日志时间",[5906],{"type":403,"value":5904},{"type":397,"tag":411,"props":5908,"children":5909},{},[5910],{"type":403,"value":5911},"使用系统输出（syslog）时不需要手动记录时间，但是把日志打印出来时却是要的。尤其是在调试时，精确时间非常有用。KDB 使用 Linux 的 timeval、tm 两个结构体，分别拿到精确时间及可读时间，再格式化输出。",{"type":397,"tag":477,"props":5913,"children":5915},{"code":5914,"language":480,"meta":391,"className":481,"style":391},"struct timeval now_tv;\ngettimeofday(&now_tv, NULL);\nconst time_t seconds = now_tv.tv_sec;\nstruct tm t;\n// 初始化 tm 时需要用到当前秒数，\n// 所以需要提前初始化 now_tv\nlocaltime_r(&seconds, &t);\np += snprintf(p, limit - p,\n              \"%04d/%02d/%02d-%02d:%02d:%02d.%06d %s %s \",\n              t.tm_year + 1900,\n              t.tm_mon + 1,\n              t.tm_mday,\n              t.tm_hour,\n              t.tm_min,\n              t.tm_sec,\n              static_cast\u003Cint>(now_tv.tv_usec), // 毫秒\n              ss.str().c_str(),\n              logname);\n",[5916],{"type":397,"tag":484,"props":5917,"children":5918},{"__ignoreMap":391},[5919,5941,5975,6013,6033,6041,6049,6087,6136,6217,6248,6276,6296,6316,6336,6356,6399,6427],{"type":397,"tag":488,"props":5920,"children":5921},{"class":490,"line":491},[5922,5927,5932,5937],{"type":397,"tag":488,"props":5923,"children":5924},{"style":531},[5925],{"type":403,"value":5926},"struct",{"type":397,"tag":488,"props":5928,"children":5929},{"style":558},[5930],{"type":403,"value":5931}," timeval",{"type":397,"tag":488,"props":5933,"children":5934},{"style":569},[5935],{"type":403,"value":5936}," now_tv",{"type":397,"tag":488,"props":5938,"children":5939},{"style":543},[5940],{"type":403,"value":577},{"type":397,"tag":488,"props":5942,"children":5943},{"class":490,"line":518},[5944,5949,5953,5957,5962,5966,5971],{"type":397,"tag":488,"props":5945,"children":5946},{"style":537},[5947],{"type":403,"value":5948},"gettimeofday",{"type":397,"tag":488,"props":5950,"children":5951},{"style":543},[5952],{"type":403,"value":625},{"type":397,"tag":488,"props":5954,"children":5955},{"style":667},[5956],{"type":403,"value":2493},{"type":397,"tag":488,"props":5958,"children":5959},{"style":569},[5960],{"type":403,"value":5961},"now_tv",{"type":397,"tag":488,"props":5963,"children":5964},{"style":543},[5965],{"type":403,"value":635},{"type":397,"tag":488,"props":5967,"children":5968},{"style":2695},[5969],{"type":403,"value":5970}," NULL",{"type":397,"tag":488,"props":5972,"children":5973},{"style":543},[5974],{"type":403,"value":655},{"type":397,"tag":488,"props":5976,"children":5977},{"class":490,"line":527},[5978,5982,5987,5992,5996,6000,6004,6009],{"type":397,"tag":488,"props":5979,"children":5980},{"style":1995},[5981],{"type":403,"value":2507},{"type":397,"tag":488,"props":5983,"children":5984},{"style":531},[5985],{"type":403,"value":5986}," time_t",{"type":397,"tag":488,"props":5988,"children":5989},{"style":569},[5990],{"type":403,"value":5991}," seconds ",{"type":397,"tag":488,"props":5993,"children":5994},{"style":667},[5995],{"type":403,"value":670},{"type":397,"tag":488,"props":5997,"children":5998},{"style":569},[5999],{"type":403,"value":5936},{"type":397,"tag":488,"props":6001,"children":6002},{"style":543},[6003],{"type":403,"value":680},{"type":397,"tag":488,"props":6005,"children":6006},{"style":569},[6007],{"type":403,"value":6008},"tv_sec",{"type":397,"tag":488,"props":6010,"children":6011},{"style":543},[6012],{"type":403,"value":577},{"type":397,"tag":488,"props":6014,"children":6015},{"class":490,"line":554},[6016,6020,6025,6029],{"type":397,"tag":488,"props":6017,"children":6018},{"style":531},[6019],{"type":403,"value":5926},{"type":397,"tag":488,"props":6021,"children":6022},{"style":558},[6023],{"type":403,"value":6024}," tm",{"type":397,"tag":488,"props":6026,"children":6027},{"style":569},[6028],{"type":403,"value":2055},{"type":397,"tag":488,"props":6030,"children":6031},{"style":543},[6032],{"type":403,"value":577},{"type":397,"tag":488,"props":6034,"children":6035},{"class":490,"line":580},[6036],{"type":397,"tag":488,"props":6037,"children":6038},{"style":1497},[6039],{"type":403,"value":6040},"// 初始化 tm 时需要用到当前秒数，\n",{"type":397,"tag":488,"props":6042,"children":6043},{"class":490,"line":601},[6044],{"type":397,"tag":488,"props":6045,"children":6046},{"style":1497},[6047],{"type":403,"value":6048},"// 所以需要提前初始化 now_tv\n",{"type":397,"tag":488,"props":6050,"children":6051},{"class":490,"line":658},[6052,6057,6061,6065,6070,6074,6078,6083],{"type":397,"tag":488,"props":6053,"children":6054},{"style":537},[6055],{"type":403,"value":6056},"localtime_r",{"type":397,"tag":488,"props":6058,"children":6059},{"style":543},[6060],{"type":403,"value":625},{"type":397,"tag":488,"props":6062,"children":6063},{"style":667},[6064],{"type":403,"value":2493},{"type":397,"tag":488,"props":6066,"children":6067},{"style":569},[6068],{"type":403,"value":6069},"seconds",{"type":397,"tag":488,"props":6071,"children":6072},{"style":543},[6073],{"type":403,"value":635},{"type":397,"tag":488,"props":6075,"children":6076},{"style":667},[6077],{"type":403,"value":1123},{"type":397,"tag":488,"props":6079,"children":6080},{"style":569},[6081],{"type":403,"value":6082},"t",{"type":397,"tag":488,"props":6084,"children":6085},{"style":543},[6086],{"type":403,"value":655},{"type":397,"tag":488,"props":6088,"children":6089},{"class":490,"line":693},[6090,6095,6100,6105,6109,6113,6117,6122,6127,6132],{"type":397,"tag":488,"props":6091,"children":6092},{"style":569},[6093],{"type":403,"value":6094},"p ",{"type":397,"tag":488,"props":6096,"children":6097},{"style":667},[6098],{"type":403,"value":6099},"+=",{"type":397,"tag":488,"props":6101,"children":6102},{"style":537},[6103],{"type":403,"value":6104}," snprintf",{"type":397,"tag":488,"props":6106,"children":6107},{"style":543},[6108],{"type":403,"value":625},{"type":397,"tag":488,"props":6110,"children":6111},{"style":569},[6112],{"type":403,"value":411},{"type":397,"tag":488,"props":6114,"children":6115},{"style":543},[6116],{"type":403,"value":635},{"type":397,"tag":488,"props":6118,"children":6119},{"style":569},[6120],{"type":403,"value":6121}," limit ",{"type":397,"tag":488,"props":6123,"children":6124},{"style":667},[6125],{"type":403,"value":6126},"-",{"type":397,"tag":488,"props":6128,"children":6129},{"style":569},[6130],{"type":403,"value":6131}," p",{"type":397,"tag":488,"props":6133,"children":6134},{"style":543},[6135],{"type":403,"value":4848},{"type":397,"tag":488,"props":6137,"children":6138},{"class":490,"line":735},[6139,6144,6149,6154,6159,6163,6167,6171,6175,6179,6183,6187,6191,6195,6200,6205,6209,6213],{"type":397,"tag":488,"props":6140,"children":6141},{"style":501},[6142],{"type":403,"value":6143},"              \"",{"type":397,"tag":488,"props":6145,"children":6146},{"style":767},[6147],{"type":403,"value":6148},"%04d",{"type":397,"tag":488,"props":6150,"children":6151},{"style":507},[6152],{"type":403,"value":6153},"/",{"type":397,"tag":488,"props":6155,"children":6156},{"style":767},[6157],{"type":403,"value":6158},"%02d",{"type":397,"tag":488,"props":6160,"children":6161},{"style":507},[6162],{"type":403,"value":6153},{"type":397,"tag":488,"props":6164,"children":6165},{"style":767},[6166],{"type":403,"value":6158},{"type":397,"tag":488,"props":6168,"children":6169},{"style":507},[6170],{"type":403,"value":6126},{"type":397,"tag":488,"props":6172,"children":6173},{"style":767},[6174],{"type":403,"value":6158},{"type":397,"tag":488,"props":6176,"children":6177},{"style":507},[6178],{"type":403,"value":1593},{"type":397,"tag":488,"props":6180,"children":6181},{"style":767},[6182],{"type":403,"value":6158},{"type":397,"tag":488,"props":6184,"children":6185},{"style":507},[6186],{"type":403,"value":1593},{"type":397,"tag":488,"props":6188,"children":6189},{"style":767},[6190],{"type":403,"value":6158},{"type":397,"tag":488,"props":6192,"children":6193},{"style":507},[6194],{"type":403,"value":680},{"type":397,"tag":488,"props":6196,"children":6197},{"style":767},[6198],{"type":403,"value":6199},"%06d",{"type":397,"tag":488,"props":6201,"children":6202},{"style":767},[6203],{"type":403,"value":6204}," %s",{"type":397,"tag":488,"props":6206,"children":6207},{"style":767},[6208],{"type":403,"value":6204},{"type":397,"tag":488,"props":6210,"children":6211},{"style":501},[6212],{"type":403,"value":640},{"type":397,"tag":488,"props":6214,"children":6215},{"style":543},[6216],{"type":403,"value":4848},{"type":397,"tag":488,"props":6218,"children":6219},{"class":490,"line":816},[6220,6225,6229,6234,6239,6244],{"type":397,"tag":488,"props":6221,"children":6222},{"style":569},[6223],{"type":403,"value":6224},"              t",{"type":397,"tag":488,"props":6226,"children":6227},{"style":543},[6228],{"type":403,"value":680},{"type":397,"tag":488,"props":6230,"children":6231},{"style":569},[6232],{"type":403,"value":6233},"tm_year ",{"type":397,"tag":488,"props":6235,"children":6236},{"style":667},[6237],{"type":403,"value":6238},"+",{"type":397,"tag":488,"props":6240,"children":6241},{"style":829},[6242],{"type":403,"value":6243}," 1900",{"type":397,"tag":488,"props":6245,"children":6246},{"style":543},[6247],{"type":403,"value":4848},{"type":397,"tag":488,"props":6249,"children":6250},{"class":490,"line":839},[6251,6255,6259,6264,6268,6272],{"type":397,"tag":488,"props":6252,"children":6253},{"style":569},[6254],{"type":403,"value":6224},{"type":397,"tag":488,"props":6256,"children":6257},{"style":543},[6258],{"type":403,"value":680},{"type":397,"tag":488,"props":6260,"children":6261},{"style":569},[6262],{"type":403,"value":6263},"tm_mon ",{"type":397,"tag":488,"props":6265,"children":6266},{"style":667},[6267],{"type":403,"value":6238},{"type":397,"tag":488,"props":6269,"children":6270},{"style":829},[6271],{"type":403,"value":3046},{"type":397,"tag":488,"props":6273,"children":6274},{"style":543},[6275],{"type":403,"value":4848},{"type":397,"tag":488,"props":6277,"children":6278},{"class":490,"line":848},[6279,6283,6287,6292],{"type":397,"tag":488,"props":6280,"children":6281},{"style":569},[6282],{"type":403,"value":6224},{"type":397,"tag":488,"props":6284,"children":6285},{"style":543},[6286],{"type":403,"value":680},{"type":397,"tag":488,"props":6288,"children":6289},{"style":569},[6290],{"type":403,"value":6291},"tm_mday",{"type":397,"tag":488,"props":6293,"children":6294},{"style":543},[6295],{"type":403,"value":4848},{"type":397,"tag":488,"props":6297,"children":6298},{"class":490,"line":856},[6299,6303,6307,6312],{"type":397,"tag":488,"props":6300,"children":6301},{"style":569},[6302],{"type":403,"value":6224},{"type":397,"tag":488,"props":6304,"children":6305},{"style":543},[6306],{"type":403,"value":680},{"type":397,"tag":488,"props":6308,"children":6309},{"style":569},[6310],{"type":403,"value":6311},"tm_hour",{"type":397,"tag":488,"props":6313,"children":6314},{"style":543},[6315],{"type":403,"value":4848},{"type":397,"tag":488,"props":6317,"children":6318},{"class":490,"line":899},[6319,6323,6327,6332],{"type":397,"tag":488,"props":6320,"children":6321},{"style":569},[6322],{"type":403,"value":6224},{"type":397,"tag":488,"props":6324,"children":6325},{"style":543},[6326],{"type":403,"value":680},{"type":397,"tag":488,"props":6328,"children":6329},{"style":569},[6330],{"type":403,"value":6331},"tm_min",{"type":397,"tag":488,"props":6333,"children":6334},{"style":543},[6335],{"type":403,"value":4848},{"type":397,"tag":488,"props":6337,"children":6338},{"class":490,"line":940},[6339,6343,6347,6352],{"type":397,"tag":488,"props":6340,"children":6341},{"style":569},[6342],{"type":403,"value":6224},{"type":397,"tag":488,"props":6344,"children":6345},{"style":543},[6346],{"type":403,"value":680},{"type":397,"tag":488,"props":6348,"children":6349},{"style":569},[6350],{"type":403,"value":6351},"tm_sec",{"type":397,"tag":488,"props":6353,"children":6354},{"style":543},[6355],{"type":403,"value":4848},{"type":397,"tag":488,"props":6357,"children":6358},{"class":490,"line":948},[6359,6364,6368,6372,6376,6380,6384,6389,6394],{"type":397,"tag":488,"props":6360,"children":6361},{"style":667},[6362],{"type":403,"value":6363},"              static_cast\u003C",{"type":397,"tag":488,"props":6365,"children":6366},{"style":531},[6367],{"type":403,"value":534},{"type":397,"tag":488,"props":6369,"children":6370},{"style":667},[6371],{"type":403,"value":2475},{"type":397,"tag":488,"props":6373,"children":6374},{"style":543},[6375],{"type":403,"value":625},{"type":397,"tag":488,"props":6377,"children":6378},{"style":569},[6379],{"type":403,"value":5961},{"type":397,"tag":488,"props":6381,"children":6382},{"style":543},[6383],{"type":403,"value":680},{"type":397,"tag":488,"props":6385,"children":6386},{"style":569},[6387],{"type":403,"value":6388},"tv_usec",{"type":397,"tag":488,"props":6390,"children":6391},{"style":543},[6392],{"type":403,"value":6393},"),",{"type":397,"tag":488,"props":6395,"children":6396},{"style":1497},[6397],{"type":403,"value":6398}," // 毫秒\n",{"type":397,"tag":488,"props":6400,"children":6401},{"class":490,"line":969},[6402,6407,6411,6415,6419,6423],{"type":397,"tag":488,"props":6403,"children":6404},{"style":569},[6405],{"type":403,"value":6406},"              ss",{"type":397,"tag":488,"props":6408,"children":6409},{"style":543},[6410],{"type":403,"value":680},{"type":397,"tag":488,"props":6412,"children":6413},{"style":537},[6414],{"type":403,"value":3067},{"type":397,"tag":488,"props":6416,"children":6417},{"style":543},[6418],{"type":403,"value":803},{"type":397,"tag":488,"props":6420,"children":6421},{"style":537},[6422],{"type":403,"value":808},{"type":397,"tag":488,"props":6424,"children":6425},{"style":543},[6426],{"type":403,"value":5866},{"type":397,"tag":488,"props":6428,"children":6429},{"class":490,"line":1025},[6430,6435],{"type":397,"tag":488,"props":6431,"children":6432},{"style":569},[6433],{"type":403,"value":6434},"              logname",{"type":397,"tag":488,"props":6436,"children":6437},{"style":543},[6438],{"type":403,"value":655},{"type":397,"tag":6440,"props":6441,"children":6442},"style",{},[6443],{"type":403,"value":6444},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":391,"searchDepth":518,"depth":518,"links":6446},[6447,6448,6449,6450],{"id":407,"depth":518,"text":407},{"id":468,"depth":518,"text":468},{"id":3450,"depth":518,"text":3450},{"id":3463,"depth":518,"text":3463},"markdown","content:8.source-code:_cpp:kingdb.md","content","8.source-code/_cpp/kingdb.md","md",[6457,6458],{"_path":368,"title":367,"description":391},{"_path":6459,"title":6460,"description":391},"/source-code/_es/array-slice","Array.prototype.slice",1710257726912]