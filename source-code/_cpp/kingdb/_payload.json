[{"data":1,"prerenderedAt":6486},["ShallowReactive",2],{"navigation":3,"/source-code/_cpp/kingdb":410,"/source-code/_cpp/kingdb-surround":6481},[4,32,83,102,129,135,141,147,393,399,405],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🌃 长夜梦","/flows/long-night-dream",{"title":15,"_path":16},"🌌 万物联结与幸福感","/flows/everything",{"title":18,"_path":19},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":21,"_path":22},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":24,"_path":25},"🌧️ 我的腼腆","/flows/shy",{"title":27,"_path":28},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":30,"_path":31},"📝 心流归档","/flows/fold",{"title":33,"_path":34,"children":35},"技术博客 / Coder","/articles",[36,38,41,44,47,50,53,56,59,62,65,68,71,74,77,80],{"title":37,"_path":34},"🦁 为什么我要写博客",{"title":39,"_path":40},"💻 本地部署 Qwen 翻译网页","/articles/local-translator",{"title":42,"_path":43},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":45,"_path":46},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":48,"_path":49},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":51,"_path":52},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":54,"_path":55},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":57,"_path":58},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":60,"_path":61},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":63,"_path":64},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":66,"_path":67},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":69,"_path":70},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":72,"_path":73},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":75,"_path":76},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":78,"_path":79},"🚝 四十二篇系列","/articles/fourty-two",{"title":81,"_path":82},"📝 技术博客归档","/articles/fold",{"title":84,"_path":85,"children":86},"造物 / Make","/tools",[87,90,93,96,99],{"title":88,"_path":89},"🧶 网易云音乐歌单排序","/tools/netease-sorter",{"title":91,"_path":92},"🌐 AnySort","/tools/anysort",{"title":94,"_path":95},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":97,"_path":98},"👓 Crapto","/tools/crypto-inline",{"title":100,"_path":101},"🖨️ any-to-base64","/tools/any-to-base64",{"title":103,"_path":104,"children":105},"吉他剧场 / Music","/music",[106,108,111,114,117,120,123,126],{"title":107,"_path":104},"🎸 FingerStyle！",{"title":109,"_path":110},"🌬️ 等待的风","/music/wind",{"title":112,"_path":113},"💕 约定的海洋","/music/ocean",{"title":115,"_path":116},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":118,"_path":119},"🌏 残酷天使的行动纲领","/music/eva",{"title":121,"_path":122},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":124,"_path":125},"🍷 Wu Wei","/music/wu-wei",{"title":127,"_path":128},"🌅 无题","/music/untitled",{"title":130,"_path":131,"children":132},"画点什么 / Paint","/paint",[133],{"title":134,"_path":131},"🚧 正在施工",{"title":136,"_path":137,"children":138},"读书笔记 / Notes","/books",[139],{"title":140,"_path":137},"📕 读书笔记",{"title":142,"_path":143,"children":144},"知识地图 / Maps","/maps",[145],{"title":146,"_path":143},"🏁 知识地图",{"title":148,"_path":149,"children":150},"零散的笔记 / Gists","/gists",[151,153,156,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255,258,261,264,267,270,273,276,279,282,285,288,291,294,297,300,303,306,309,312,315,318,321,324,327,330,333,336,339,342,345,348,351,354,357,360,363,366,369,372,375,378,381,384,387,390],{"title":152,"_path":149},"🧊 Gists",{"title":154,"_path":155},"网站的可访问性","/gists/accessibility",{"title":157,"_path":158},"Bit","/gists/bit",{"title":160,"_path":161},"图片模糊","/gists/blur",{"title":163,"_path":164},"渲染相关笔记","/gists/c4d",{"title":166,"_path":167},"CDN 问题记录","/gists/cdn",{"title":169,"_path":170},"消毒剂","/gists/cleaner",{"title":172,"_path":173},"Windows Command","/gists/cmd",{"title":175,"_path":176},"Command","/gists/command",{"title":178,"_path":179},"复杂科学","/gists/complexity-science",{"title":181,"_path":182},"GitHub Copilot","/gists/copilot",{"title":184,"_path":185},"宇宙","/gists/cosmos",{"title":187,"_path":188},"C++","/gists/cpp",{"title":190,"_path":191},"Data Structure","/gists/data-structure",{"title":193,"_path":194},"DEPRESSION","/gists/depression",{"title":196,"_path":197},"设计模式","/gists/design-patterns",{"title":199,"_path":200},"Developer Experience","/gists/developer-experience",{"title":202,"_path":203},"Device Metrics","/gists/device-metrix",{"title":205,"_path":206},"数字化转型","/gists/digital-transformation",{"title":208,"_path":209},"ECMAScript Language Specification","/gists/ecmascript-specification",{"title":211,"_path":212},"正则表达式","/gists/eegex",{"title":214,"_path":215},"Emoji","/gists/emoji",{"title":217,"_path":218},"工程","/gists/engineering",{"title":220,"_path":221},"熵","/gists/entropy",{"title":223,"_path":224},"Environment","/gists/environment",{"title":226,"_path":227},"Erlang","/gists/erlang",{"title":229,"_path":230},"逃离塔克夫","/gists/escape-from-tarkov",{"title":232,"_path":233},"ESNext (ES6-ES11)","/gists/esnext",{"title":235,"_path":236},"Eval！","/gists/eval",{"title":238,"_path":239},"Flutter","/gists/flutter",{"title":241,"_path":242},"字体","/gists/font",{"title":244,"_path":245},"JS 函数式编程","/gists/functional",{"title":247,"_path":248},"游戏化","/gists/gamification",{"title":250,"_path":251},"Google C++ Standard","/gists/google-cpp-standard",{"title":253,"_path":254},"双向链接完全体","/gists/graph",{"title":256,"_path":257},"Hardwares","/gists/hardwares",{"title":259,"_path":260},"哈希冲突","/gists/hash-collision",{"title":262,"_path":263},"信息设计","/gists/information-design",{"title":265,"_path":266},"InstantPage","/gists/instant.page",{"title":268,"_path":269},"ISUX 遇见大数据可视化系列","/gists/isux-data-visualization",{"title":271,"_path":272},"KVStore","/gists/key-value-db",{"title":274,"_path":275},"Kubernetes","/gists/kubernetes",{"title":277,"_path":278},"Makefile","/gists/makefile",{"title":280,"_path":281},"Markdown Inline Style","/gists/markdown-nice",{"title":283,"_path":284},"小程序","/gists/miniapp",{"title":286,"_path":287},"减小页面快照体积","/gists/minify-html",{"title":289,"_path":290},"mklink","/gists/mklink",{"title":292,"_path":293},"Mock","/gists/mock",{"title":295,"_path":296},"多人协作系统","/gists/multiplayer",{"title":298,"_path":299},"多端应用","/gists/multy-end-app",{"title":301,"_path":302},"神经科学","/gists/neuroscience",{"title":304,"_path":305},"OO","/gists/oo",{"title":307,"_path":308},"Opinioned Personal Folder","/gists/opinioned-personal-folder",{"title":310,"_path":311},"PInvoke","/gists/pinvoke",{"title":313,"_path":314},"像素","/gists/pixel",{"title":316,"_path":317},"PowerShell","/gists/powershell",{"title":319,"_path":320},"量子","/gists/quantum",{"title":322,"_path":323},"保持好奇心","/gists/questions",{"title":325,"_path":326},"React Native","/gists/react-native",{"title":328,"_path":329},"博客改版碰到的浏览器平滑滚动问题","/gists/scroll",{"title":331,"_path":332},"SEO","/gists/seo",{"title":334,"_path":335},"Shader","/gists/shader",{"title":337,"_path":338},"Shape Up","/gists/shape-up",{"title":340,"_path":341},"睡觉","/gists/sleep",{"title":343,"_path":344},"记录奇怪的问题","/gists/solved",{"title":346,"_path":347},"States","/gists/states",{"title":349,"_path":350},"Storage","/gists/storage",{"title":352,"_path":353},"音视频流处理","/gists/stream-cli",{"title":355,"_path":356},"Symbol","/gists/symbol",{"title":358,"_path":359},"系统论","/gists/systems-theory",{"title":361,"_path":362},"Taro","/gists/taro",{"title":364,"_path":365},"任务切片","/gists/task-slice",{"title":367,"_path":368},"技术偏好","/gists/tech-dudge",{"title":370,"_path":371},"Untitled","/gists/untitled",{"title":373,"_path":374},"可变字体","/gists/variable-font",{"title":376,"_path":377},"视觉错觉","/gists/visual-illusion",{"title":379,"_path":380},"SS(SSR)","/gists/vpn",{"title":382,"_path":383},"VS Code 插件开发","/gists/vscode-plugin",{"title":385,"_path":386},"Web Components","/gists/web-components",{"title":388,"_path":389},"Windows","/gists/windows",{"title":391,"_path":392},"查缺补漏","/gists/wrong",{"title":394,"_path":395,"children":396},"代码笔记 / Gists","/source-code",[397],{"title":398,"_path":395},"🚄 代码笔记",{"title":400,"_path":401,"children":402},"我 / Abount","/hire",[403],{"title":404,"_path":401},"📬 技术简历",{"title":406,"_path":407,"children":408},"todo","/todo",[409],{"title":406,"_path":407},{"_path":411,"_dir":412,"_draft":413,"_partial":414,"_locale":415,"title":416,"description":415,"body":417,"_type":6475,"_id":6476,"_source":6477,"_file":6478,"_stem":6479,"_extension":6480},"/source-code/_cpp/kingdb","_cpp",false,true,"","KingDB",{"type":418,"children":419,"toc":6469},"root",[420,428,434,440,456,461,485,490,495,500,1359,1364,1372,1377,1382,1387,1393,1398,1819,1824,1829,2279,2284,2385,2390,2395,2400,2938,2944,2949,3216,3222,3227,3472,3477,3490,3495,3762,3767,3772,4483,4488,4669,4673,4678,5296,5301,5306,5359,5364,5383,5756,5761,5926,5931,5936,6463],{"type":421,"tag":422,"props":423,"children":425},"element","h1",{"id":424},"kingdb",[426],{"type":427,"value":416},"text",{"type":421,"tag":429,"props":430,"children":432},"h2",{"id":431},"概述",[433],{"type":427,"value":431},{"type":421,"tag":435,"props":436,"children":437},"p",{},[438],{"type":427,"value":439},"源码分两部分，从相关的测试文件，到核心源码。参考 IKVS 系列文章给的架构图，核心源码的阅读顺序沿着 Put、Delete、Get 三个接口，由 Database 一路向 Buffer、Event Manager、Storage Engine、HSTable Manager、File System 相关、Index 前进。最好再看相关快照、迭代器、Multipart 等部分。期间如果遇到简单的帮助函数会先讲帮助函数。",{"type":421,"tag":435,"props":441,"children":442},{},[443,445,454],{"type":427,"value":444},"本来想从第一个 Git Commit 开始看起的。但我 checkout 过去之后，碰到了一堆编译问题，根本跑不通，索性就直接回到 master 来看最新代码了。本文章的源码快照见 ",{"type":421,"tag":446,"props":447,"children":451},"a",{"href":448,"rel":449},"https://github.com/goossaert/kingdb/tree/58994280e789fc7248d61371f03a6c04c844c197",[450],"nofollow",[452],{"type":427,"value":453},"KingDB@58994",{"type":427,"value":455},"。阅读源码前可以先看一下 KingDB 的 Readme：doc/kingdb.md 以及 doc/kingserver.md。",{"type":421,"tag":435,"props":457,"children":458},{},[459],{"type":427,"value":460},"下文可能出现的缩写：",{"type":421,"tag":462,"props":463,"children":464},"ul",{},[465,471],{"type":421,"tag":466,"props":467,"children":468},"li",{},[469],{"type":427,"value":470},"KDB：KingDB，泛指，有时指 KingDB 程序，有时指 KingDB 源码。",{"type":421,"tag":466,"props":472,"children":473},{},[474,476,483],{"type":427,"value":475},"IKVS：作者相关 KingDB 做的一些调研及笔记的博客系列。这个系列从 13 年开始写，现在还没写完... 见 ",{"type":421,"tag":446,"props":477,"children":480},{"href":478,"rel":479},"https://codecapsule.com/2012/11/07/ikvs-implementing-a-key-value-store-table-of-contents/",[450],[481],{"type":427,"value":482},"IKVS",{"type":427,"value":484},"。",{"type":421,"tag":435,"props":486,"children":487},{},[488],{"type":427,"value":489},"另，为了简便起见，下文给出的代码很可能并非原本的代码，而是截取或经过剔除后的部分代码。比如说，去除了某函数中的错误处理，使之代码更短，更容易展示。",{"type":421,"tag":429,"props":491,"children":493},{"id":492},"从测试开始",[494],{"type":427,"value":492},{"type":421,"tag":435,"props":496,"children":497},{},[498],{"type":427,"value":499},"Emmanuel 给了一个典型的 KDB 用户使用示例，见 unit-tests/kingdb_user.cc。通过此示例，能大概了解 KDB 的接口及如何使用该接口。创建数据库、存入、读取前都需要创建对应的参数配置 Options；这些动作通过 Status 对象来回传操作成功与否。",{"type":421,"tag":501,"props":502,"children":506},"pre",{"code":503,"language":504,"meta":415,"className":505,"style":415},"#include \u003Ckingdb/kdb.h>\n\nint main() {\n  kdb::Status s;\n  kdb::DatabaseOptions db_options;\n  kdb::Database db(db_options, \"mylocaldb\");\n  s = db.Open();\n  if (!s.IsOK()) {\n    fprintf(stderr, \"Could not open the database: %s\\n\", s.ToString().c_str());\n    exit(1);\n  }\n\n  std::string key1(\"key1\");\n  std::string value1(\"value1\");\n\n  kdb::WriteOptions write_options;\n  s = db.Put(write_options, key1, value1);\n\n  kdb::ReadOptions read_options;\n  std::string out_str;\n  s = db.Get(read_options, key1, &out_str);\n  if (s.IsOK() && out_str == \"value1\") {\n    printf(\"Data successfully stored and retrieved\\n\"); \n  } else {\n    printf(\"An error occurred\\n\"); \n  }\n\n  return 0;\n}\n","cpp","language-cpp shiki shiki-themes material-theme-lighter github-light github-dark monokai",[507],{"type":421,"tag":508,"props":509,"children":510},"code",{"__ignoreMap":415},[511,540,549,576,602,623,680,715,757,838,861,870,878,921,962,970,991,1047,1055,1076,1097,1157,1221,1261,1279,1316,1324,1332,1350],{"type":421,"tag":512,"props":513,"children":516},"span",{"class":514,"line":515},"line",1,[517,523,529,535],{"type":421,"tag":512,"props":518,"children":520},{"style":519},"--shiki-light:#39ADB5;--shiki-light-font-style:italic;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#F92672;--shiki-sepia-font-style:inherit",[521],{"type":427,"value":522},"#include",{"type":421,"tag":512,"props":524,"children":526},{"style":525},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[527],{"type":427,"value":528}," \u003C",{"type":421,"tag":512,"props":530,"children":532},{"style":531},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[533],{"type":427,"value":534},"kingdb/kdb.h",{"type":421,"tag":512,"props":536,"children":537},{"style":525},[538],{"type":427,"value":539},">\n",{"type":421,"tag":512,"props":541,"children":543},{"class":514,"line":542},2,[544],{"type":421,"tag":512,"props":545,"children":546},{"emptyLinePlaceholder":414},[547],{"type":427,"value":548},"\n",{"type":421,"tag":512,"props":550,"children":552},{"class":514,"line":551},3,[553,559,565,571],{"type":421,"tag":512,"props":554,"children":556},{"style":555},"--shiki-light:#9C3EDA;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic",[557],{"type":427,"value":558},"int",{"type":421,"tag":512,"props":560,"children":562},{"style":561},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[563],{"type":427,"value":564}," main",{"type":421,"tag":512,"props":566,"children":568},{"style":567},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[569],{"type":427,"value":570},"()",{"type":421,"tag":512,"props":572,"children":573},{"style":567},[574],{"type":427,"value":575}," {\n",{"type":421,"tag":512,"props":577,"children":579},{"class":514,"line":578},4,[580,586,591,597],{"type":421,"tag":512,"props":581,"children":583},{"style":582},"--shiki-light:#E2931D;--shiki-light-text-decoration:inherit;--shiki-default:#6F42C1;--shiki-default-text-decoration:inherit;--shiki-dark:#B392F0;--shiki-dark-text-decoration:inherit;--shiki-sepia:#A6E22E;--shiki-sepia-text-decoration:underline",[584],{"type":427,"value":585},"  kdb",{"type":421,"tag":512,"props":587,"children":588},{"style":567},[589],{"type":427,"value":590},"::",{"type":421,"tag":512,"props":592,"children":594},{"style":593},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[595],{"type":427,"value":596},"Status s",{"type":421,"tag":512,"props":598,"children":599},{"style":567},[600],{"type":427,"value":601},";\n",{"type":421,"tag":512,"props":603,"children":605},{"class":514,"line":604},5,[606,610,614,619],{"type":421,"tag":512,"props":607,"children":608},{"style":582},[609],{"type":427,"value":585},{"type":421,"tag":512,"props":611,"children":612},{"style":567},[613],{"type":427,"value":590},{"type":421,"tag":512,"props":615,"children":616},{"style":593},[617],{"type":427,"value":618},"DatabaseOptions db_options",{"type":421,"tag":512,"props":620,"children":621},{"style":567},[622],{"type":427,"value":601},{"type":421,"tag":512,"props":624,"children":626},{"class":514,"line":625},6,[627,631,635,640,645,650,655,660,665,670,675],{"type":421,"tag":512,"props":628,"children":629},{"style":582},[630],{"type":427,"value":585},{"type":421,"tag":512,"props":632,"children":633},{"style":567},[634],{"type":427,"value":590},{"type":421,"tag":512,"props":636,"children":637},{"style":593},[638],{"type":427,"value":639},"Database ",{"type":421,"tag":512,"props":641,"children":642},{"style":561},[643],{"type":427,"value":644},"db",{"type":421,"tag":512,"props":646,"children":647},{"style":567},[648],{"type":427,"value":649},"(",{"type":421,"tag":512,"props":651,"children":652},{"style":593},[653],{"type":427,"value":654},"db_options",{"type":421,"tag":512,"props":656,"children":657},{"style":567},[658],{"type":427,"value":659},",",{"type":421,"tag":512,"props":661,"children":662},{"style":525},[663],{"type":427,"value":664}," \"",{"type":421,"tag":512,"props":666,"children":667},{"style":531},[668],{"type":427,"value":669},"mylocaldb",{"type":421,"tag":512,"props":671,"children":672},{"style":525},[673],{"type":427,"value":674},"\"",{"type":421,"tag":512,"props":676,"children":677},{"style":567},[678],{"type":427,"value":679},");\n",{"type":421,"tag":512,"props":681,"children":683},{"class":514,"line":682},7,[684,689,695,700,705,710],{"type":421,"tag":512,"props":685,"children":686},{"style":593},[687],{"type":427,"value":688},"  s ",{"type":421,"tag":512,"props":690,"children":692},{"style":691},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[693],{"type":427,"value":694},"=",{"type":421,"tag":512,"props":696,"children":697},{"style":593},[698],{"type":427,"value":699}," db",{"type":421,"tag":512,"props":701,"children":702},{"style":567},[703],{"type":427,"value":704},".",{"type":421,"tag":512,"props":706,"children":707},{"style":561},[708],{"type":427,"value":709},"Open",{"type":421,"tag":512,"props":711,"children":712},{"style":567},[713],{"type":427,"value":714},"();\n",{"type":421,"tag":512,"props":716,"children":718},{"class":514,"line":717},8,[719,724,729,734,739,743,748,753],{"type":421,"tag":512,"props":720,"children":721},{"style":519},[722],{"type":427,"value":723},"  if",{"type":421,"tag":512,"props":725,"children":726},{"style":567},[727],{"type":427,"value":728}," (",{"type":421,"tag":512,"props":730,"children":731},{"style":691},[732],{"type":427,"value":733},"!",{"type":421,"tag":512,"props":735,"children":736},{"style":593},[737],{"type":427,"value":738},"s",{"type":421,"tag":512,"props":740,"children":741},{"style":567},[742],{"type":427,"value":704},{"type":421,"tag":512,"props":744,"children":745},{"style":561},[746],{"type":427,"value":747},"IsOK",{"type":421,"tag":512,"props":749,"children":750},{"style":567},[751],{"type":427,"value":752},"())",{"type":421,"tag":512,"props":754,"children":755},{"style":567},[756],{"type":427,"value":575},{"type":421,"tag":512,"props":758,"children":760},{"class":514,"line":759},9,[761,766,770,776,780,784,789,795,801,805,809,814,818,823,828,833],{"type":421,"tag":512,"props":762,"children":763},{"style":561},[764],{"type":427,"value":765},"    fprintf",{"type":421,"tag":512,"props":767,"children":768},{"style":567},[769],{"type":427,"value":649},{"type":421,"tag":512,"props":771,"children":773},{"style":772},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[774],{"type":427,"value":775},"stderr",{"type":421,"tag":512,"props":777,"children":778},{"style":567},[779],{"type":427,"value":659},{"type":421,"tag":512,"props":781,"children":782},{"style":525},[783],{"type":427,"value":664},{"type":421,"tag":512,"props":785,"children":786},{"style":531},[787],{"type":427,"value":788},"Could not open the database: ",{"type":421,"tag":512,"props":790,"children":792},{"style":791},"--shiki-light:#E53935;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[793],{"type":427,"value":794},"%s",{"type":421,"tag":512,"props":796,"children":798},{"style":797},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[799],{"type":427,"value":800},"\\n",{"type":421,"tag":512,"props":802,"children":803},{"style":525},[804],{"type":427,"value":674},{"type":421,"tag":512,"props":806,"children":807},{"style":567},[808],{"type":427,"value":659},{"type":421,"tag":512,"props":810,"children":811},{"style":593},[812],{"type":427,"value":813}," s",{"type":421,"tag":512,"props":815,"children":816},{"style":567},[817],{"type":427,"value":704},{"type":421,"tag":512,"props":819,"children":820},{"style":561},[821],{"type":427,"value":822},"ToString",{"type":421,"tag":512,"props":824,"children":825},{"style":567},[826],{"type":427,"value":827},"().",{"type":421,"tag":512,"props":829,"children":830},{"style":561},[831],{"type":427,"value":832},"c_str",{"type":421,"tag":512,"props":834,"children":835},{"style":567},[836],{"type":427,"value":837},"());\n",{"type":421,"tag":512,"props":839,"children":841},{"class":514,"line":840},10,[842,847,851,857],{"type":421,"tag":512,"props":843,"children":844},{"style":561},[845],{"type":427,"value":846},"    exit",{"type":421,"tag":512,"props":848,"children":849},{"style":567},[850],{"type":427,"value":649},{"type":421,"tag":512,"props":852,"children":854},{"style":853},"--shiki-light:#F76D47;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[855],{"type":427,"value":856},"1",{"type":421,"tag":512,"props":858,"children":859},{"style":567},[860],{"type":427,"value":679},{"type":421,"tag":512,"props":862,"children":864},{"class":514,"line":863},11,[865],{"type":421,"tag":512,"props":866,"children":867},{"style":567},[868],{"type":427,"value":869},"  }\n",{"type":421,"tag":512,"props":871,"children":873},{"class":514,"line":872},12,[874],{"type":421,"tag":512,"props":875,"children":876},{"emptyLinePlaceholder":414},[877],{"type":427,"value":548},{"type":421,"tag":512,"props":879,"children":881},{"class":514,"line":880},13,[882,887,891,896,901,905,909,913,917],{"type":421,"tag":512,"props":883,"children":884},{"style":582},[885],{"type":427,"value":886},"  std",{"type":421,"tag":512,"props":888,"children":889},{"style":567},[890],{"type":427,"value":590},{"type":421,"tag":512,"props":892,"children":893},{"style":593},[894],{"type":427,"value":895},"string ",{"type":421,"tag":512,"props":897,"children":898},{"style":561},[899],{"type":427,"value":900},"key1",{"type":421,"tag":512,"props":902,"children":903},{"style":567},[904],{"type":427,"value":649},{"type":421,"tag":512,"props":906,"children":907},{"style":525},[908],{"type":427,"value":674},{"type":421,"tag":512,"props":910,"children":911},{"style":531},[912],{"type":427,"value":900},{"type":421,"tag":512,"props":914,"children":915},{"style":525},[916],{"type":427,"value":674},{"type":421,"tag":512,"props":918,"children":919},{"style":567},[920],{"type":427,"value":679},{"type":421,"tag":512,"props":922,"children":924},{"class":514,"line":923},14,[925,929,933,937,942,946,950,954,958],{"type":421,"tag":512,"props":926,"children":927},{"style":582},[928],{"type":427,"value":886},{"type":421,"tag":512,"props":930,"children":931},{"style":567},[932],{"type":427,"value":590},{"type":421,"tag":512,"props":934,"children":935},{"style":593},[936],{"type":427,"value":895},{"type":421,"tag":512,"props":938,"children":939},{"style":561},[940],{"type":427,"value":941},"value1",{"type":421,"tag":512,"props":943,"children":944},{"style":567},[945],{"type":427,"value":649},{"type":421,"tag":512,"props":947,"children":948},{"style":525},[949],{"type":427,"value":674},{"type":421,"tag":512,"props":951,"children":952},{"style":531},[953],{"type":427,"value":941},{"type":421,"tag":512,"props":955,"children":956},{"style":525},[957],{"type":427,"value":674},{"type":421,"tag":512,"props":959,"children":960},{"style":567},[961],{"type":427,"value":679},{"type":421,"tag":512,"props":963,"children":965},{"class":514,"line":964},15,[966],{"type":421,"tag":512,"props":967,"children":968},{"emptyLinePlaceholder":414},[969],{"type":427,"value":548},{"type":421,"tag":512,"props":971,"children":973},{"class":514,"line":972},16,[974,978,982,987],{"type":421,"tag":512,"props":975,"children":976},{"style":582},[977],{"type":427,"value":585},{"type":421,"tag":512,"props":979,"children":980},{"style":567},[981],{"type":427,"value":590},{"type":421,"tag":512,"props":983,"children":984},{"style":593},[985],{"type":427,"value":986},"WriteOptions write_options",{"type":421,"tag":512,"props":988,"children":989},{"style":567},[990],{"type":427,"value":601},{"type":421,"tag":512,"props":992,"children":994},{"class":514,"line":993},17,[995,999,1003,1007,1011,1016,1020,1025,1029,1034,1038,1043],{"type":421,"tag":512,"props":996,"children":997},{"style":593},[998],{"type":427,"value":688},{"type":421,"tag":512,"props":1000,"children":1001},{"style":691},[1002],{"type":427,"value":694},{"type":421,"tag":512,"props":1004,"children":1005},{"style":593},[1006],{"type":427,"value":699},{"type":421,"tag":512,"props":1008,"children":1009},{"style":567},[1010],{"type":427,"value":704},{"type":421,"tag":512,"props":1012,"children":1013},{"style":561},[1014],{"type":427,"value":1015},"Put",{"type":421,"tag":512,"props":1017,"children":1018},{"style":567},[1019],{"type":427,"value":649},{"type":421,"tag":512,"props":1021,"children":1022},{"style":593},[1023],{"type":427,"value":1024},"write_options",{"type":421,"tag":512,"props":1026,"children":1027},{"style":567},[1028],{"type":427,"value":659},{"type":421,"tag":512,"props":1030,"children":1031},{"style":593},[1032],{"type":427,"value":1033}," key1",{"type":421,"tag":512,"props":1035,"children":1036},{"style":567},[1037],{"type":427,"value":659},{"type":421,"tag":512,"props":1039,"children":1040},{"style":593},[1041],{"type":427,"value":1042}," value1",{"type":421,"tag":512,"props":1044,"children":1045},{"style":567},[1046],{"type":427,"value":679},{"type":421,"tag":512,"props":1048,"children":1050},{"class":514,"line":1049},18,[1051],{"type":421,"tag":512,"props":1052,"children":1053},{"emptyLinePlaceholder":414},[1054],{"type":427,"value":548},{"type":421,"tag":512,"props":1056,"children":1058},{"class":514,"line":1057},19,[1059,1063,1067,1072],{"type":421,"tag":512,"props":1060,"children":1061},{"style":582},[1062],{"type":427,"value":585},{"type":421,"tag":512,"props":1064,"children":1065},{"style":567},[1066],{"type":427,"value":590},{"type":421,"tag":512,"props":1068,"children":1069},{"style":593},[1070],{"type":427,"value":1071},"ReadOptions read_options",{"type":421,"tag":512,"props":1073,"children":1074},{"style":567},[1075],{"type":427,"value":601},{"type":421,"tag":512,"props":1077,"children":1079},{"class":514,"line":1078},20,[1080,1084,1088,1093],{"type":421,"tag":512,"props":1081,"children":1082},{"style":582},[1083],{"type":427,"value":886},{"type":421,"tag":512,"props":1085,"children":1086},{"style":567},[1087],{"type":427,"value":590},{"type":421,"tag":512,"props":1089,"children":1090},{"style":593},[1091],{"type":427,"value":1092},"string out_str",{"type":421,"tag":512,"props":1094,"children":1095},{"style":567},[1096],{"type":427,"value":601},{"type":421,"tag":512,"props":1098,"children":1100},{"class":514,"line":1099},21,[1101,1105,1109,1113,1117,1122,1126,1131,1135,1139,1143,1148,1153],{"type":421,"tag":512,"props":1102,"children":1103},{"style":593},[1104],{"type":427,"value":688},{"type":421,"tag":512,"props":1106,"children":1107},{"style":691},[1108],{"type":427,"value":694},{"type":421,"tag":512,"props":1110,"children":1111},{"style":593},[1112],{"type":427,"value":699},{"type":421,"tag":512,"props":1114,"children":1115},{"style":567},[1116],{"type":427,"value":704},{"type":421,"tag":512,"props":1118,"children":1119},{"style":561},[1120],{"type":427,"value":1121},"Get",{"type":421,"tag":512,"props":1123,"children":1124},{"style":567},[1125],{"type":427,"value":649},{"type":421,"tag":512,"props":1127,"children":1128},{"style":593},[1129],{"type":427,"value":1130},"read_options",{"type":421,"tag":512,"props":1132,"children":1133},{"style":567},[1134],{"type":427,"value":659},{"type":421,"tag":512,"props":1136,"children":1137},{"style":593},[1138],{"type":427,"value":1033},{"type":421,"tag":512,"props":1140,"children":1141},{"style":567},[1142],{"type":427,"value":659},{"type":421,"tag":512,"props":1144,"children":1145},{"style":691},[1146],{"type":427,"value":1147}," &",{"type":421,"tag":512,"props":1149,"children":1150},{"style":593},[1151],{"type":427,"value":1152},"out_str",{"type":421,"tag":512,"props":1154,"children":1155},{"style":567},[1156],{"type":427,"value":679},{"type":421,"tag":512,"props":1158,"children":1160},{"class":514,"line":1159},22,[1161,1165,1169,1173,1177,1181,1185,1190,1195,1200,1204,1208,1212,1217],{"type":421,"tag":512,"props":1162,"children":1163},{"style":519},[1164],{"type":427,"value":723},{"type":421,"tag":512,"props":1166,"children":1167},{"style":567},[1168],{"type":427,"value":728},{"type":421,"tag":512,"props":1170,"children":1171},{"style":593},[1172],{"type":427,"value":738},{"type":421,"tag":512,"props":1174,"children":1175},{"style":567},[1176],{"type":427,"value":704},{"type":421,"tag":512,"props":1178,"children":1179},{"style":561},[1180],{"type":427,"value":747},{"type":421,"tag":512,"props":1182,"children":1183},{"style":567},[1184],{"type":427,"value":570},{"type":421,"tag":512,"props":1186,"children":1187},{"style":691},[1188],{"type":427,"value":1189}," &&",{"type":421,"tag":512,"props":1191,"children":1192},{"style":593},[1193],{"type":427,"value":1194}," out_str ",{"type":421,"tag":512,"props":1196,"children":1197},{"style":691},[1198],{"type":427,"value":1199},"==",{"type":421,"tag":512,"props":1201,"children":1202},{"style":525},[1203],{"type":427,"value":664},{"type":421,"tag":512,"props":1205,"children":1206},{"style":531},[1207],{"type":427,"value":941},{"type":421,"tag":512,"props":1209,"children":1210},{"style":525},[1211],{"type":427,"value":674},{"type":421,"tag":512,"props":1213,"children":1214},{"style":567},[1215],{"type":427,"value":1216},")",{"type":421,"tag":512,"props":1218,"children":1219},{"style":567},[1220],{"type":427,"value":575},{"type":421,"tag":512,"props":1222,"children":1224},{"class":514,"line":1223},23,[1225,1230,1234,1238,1243,1247,1251,1256],{"type":421,"tag":512,"props":1226,"children":1227},{"style":561},[1228],{"type":427,"value":1229},"    printf",{"type":421,"tag":512,"props":1231,"children":1232},{"style":567},[1233],{"type":427,"value":649},{"type":421,"tag":512,"props":1235,"children":1236},{"style":525},[1237],{"type":427,"value":674},{"type":421,"tag":512,"props":1239,"children":1240},{"style":531},[1241],{"type":427,"value":1242},"Data successfully stored and retrieved",{"type":421,"tag":512,"props":1244,"children":1245},{"style":797},[1246],{"type":427,"value":800},{"type":421,"tag":512,"props":1248,"children":1249},{"style":525},[1250],{"type":427,"value":674},{"type":421,"tag":512,"props":1252,"children":1253},{"style":567},[1254],{"type":427,"value":1255},");",{"type":421,"tag":512,"props":1257,"children":1258},{"style":772},[1259],{"type":427,"value":1260}," \n",{"type":421,"tag":512,"props":1262,"children":1264},{"class":514,"line":1263},24,[1265,1270,1275],{"type":421,"tag":512,"props":1266,"children":1267},{"style":567},[1268],{"type":427,"value":1269},"  }",{"type":421,"tag":512,"props":1271,"children":1272},{"style":519},[1273],{"type":427,"value":1274}," else",{"type":421,"tag":512,"props":1276,"children":1277},{"style":567},[1278],{"type":427,"value":575},{"type":421,"tag":512,"props":1280,"children":1282},{"class":514,"line":1281},25,[1283,1287,1291,1295,1300,1304,1308,1312],{"type":421,"tag":512,"props":1284,"children":1285},{"style":561},[1286],{"type":427,"value":1229},{"type":421,"tag":512,"props":1288,"children":1289},{"style":567},[1290],{"type":427,"value":649},{"type":421,"tag":512,"props":1292,"children":1293},{"style":525},[1294],{"type":427,"value":674},{"type":421,"tag":512,"props":1296,"children":1297},{"style":531},[1298],{"type":427,"value":1299},"An error occurred",{"type":421,"tag":512,"props":1301,"children":1302},{"style":797},[1303],{"type":427,"value":800},{"type":421,"tag":512,"props":1305,"children":1306},{"style":525},[1307],{"type":427,"value":674},{"type":421,"tag":512,"props":1309,"children":1310},{"style":567},[1311],{"type":427,"value":1255},{"type":421,"tag":512,"props":1313,"children":1314},{"style":772},[1315],{"type":427,"value":1260},{"type":421,"tag":512,"props":1317,"children":1319},{"class":514,"line":1318},26,[1320],{"type":421,"tag":512,"props":1321,"children":1322},{"style":567},[1323],{"type":427,"value":869},{"type":421,"tag":512,"props":1325,"children":1327},{"class":514,"line":1326},27,[1328],{"type":421,"tag":512,"props":1329,"children":1330},{"emptyLinePlaceholder":414},[1331],{"type":427,"value":548},{"type":421,"tag":512,"props":1333,"children":1335},{"class":514,"line":1334},28,[1336,1341,1346],{"type":421,"tag":512,"props":1337,"children":1338},{"style":519},[1339],{"type":427,"value":1340},"  return",{"type":421,"tag":512,"props":1342,"children":1343},{"style":853},[1344],{"type":427,"value":1345}," 0",{"type":421,"tag":512,"props":1347,"children":1348},{"style":567},[1349],{"type":427,"value":601},{"type":421,"tag":512,"props":1351,"children":1353},{"class":514,"line":1352},29,[1354],{"type":421,"tag":512,"props":1355,"children":1356},{"style":567},[1357],{"type":427,"value":1358},"}\n",{"type":421,"tag":435,"props":1360,"children":1361},{},[1362],{"type":427,"value":1363},"测试的入口文件是 unit-tests/test_db.cc。以我看过的 JS 库来看，这是一个基本的功能测试。编译好 KDB 之后，运行编译出的二进制文件 test_db 可以开始测试。测试结果输出到控制台，如下代码所示。",{"type":421,"tag":501,"props":1365,"children":1367},{"code":1366},"==== Test DBTest.CloseAndReopen\n==== Test DBTest.RepairInvalidDatabaseOptionFile\n==== Test DBTest.KeysWithNullBytes\n==== Test DBTest.TestStringInterface\nDatabase Options: Stage 0 - Incompressible data with LZ4 compression enabled\nDatabase Options: Stage 1 - Compressible data with LZ4 compression enabled\nDatabase Options: Stage 2 - Compression disabled\nDatabase Options: Stage 3 - 64-bit MurmurHash3\nDatabase Options: Stage 4 - Checksum verification with incompressible data\nDatabase Options: Stage 5 - Checksum verification with compressible data\nDatabase Options: Stage 6 - Checksum verification with compression disabled\nDatabase Options: Stage 7 - Synced writes\nDatabase Options: Stage 8 - Small-sized HSTables with compression disabled\nDatabase Options: Stage 9 - Small-sized HSTables with incompressible data and LZ4 compression\nDatabase Options: Stage 10 - Small-sized HSTables with compressible data and LZ4 compression\nDatabase Options: Stage 11 - Direct mode for Write Buffer (incompressible data with LZ4 compression enabled)\nDatabase Options: Stage 12 - Direct mode for Write Buffer (compressible data with LZ4 compression enabled)\n==== Test DBTest.MultipartReader\n// the same with last stages\n==== Test DBTest.SingleThreadSmallEntries\n// the same with last stages\n==== Test DBTest.SingleThreadSnapshot\n// the same with last stages\n==== Test DBTest.SingleThreadSmallEntriesCompaction\n// the same with last stages\n==== Test DBTest.SequentialIterator\n// the same with last stages\n==== Test DBTest.SingleThreadSingleLargeEntry\n// the same with last stages\n==== Test DBTest.FileUtil\nmysize: 268435456\nOK\n89 ms\nFree size: 944 GB\n==== PASSED 11 tests\n",[1368],{"type":421,"tag":508,"props":1369,"children":1370},{"__ignoreMap":415},[1371],{"type":427,"value":1366},{"type":421,"tag":435,"props":1373,"children":1374},{},[1375],{"type":427,"value":1376},"每个功能点如数据库初始化和关闭 CloseAndReopen、存入带结束符的键 KeysWithNullBytes 都使用对应继承了 DBTest 的测试类进行测试。涉及到与数据库交互的功能部分如 TestStringInterface 使用循环，遍历了所有数据库 Options 可以设置的情况（但是只是二维循环，没有测试参数间的组合）。即对应上文的 Stage 1、Stage 2...",{"type":421,"tag":435,"props":1378,"children":1379},{},[1380],{"type":427,"value":1381},"在 test_db 创建相应的测试类时，会自动调用测试套件（unit-tests/testharness.cc）中的 RegisterTest 把测试函数储存起来。以便运行测试时，通过读取环境变量来判断是否要跳过某类测试。",{"type":421,"tag":435,"props":1383,"children":1384},{},[1385],{"type":427,"value":1386},"测试代码的实现还有一些有意思的地方，以下提及。",{"type":421,"tag":1388,"props":1389,"children":1391},"h4",{"id":1390},"信号处理",[1392],{"type":427,"value":1390},{"type":421,"tag":435,"props":1394,"children":1395},{},[1396],{"type":427,"value":1397},"和数据库核心的入口函数一样，使用 signal 挂载了对 SIGSEGV、SIGABRT 信号的处理。这两个信号分别指代系统内存错误和系统中断。而处理函数非常简单，就是 IKVS 中提到的“let it die”风格：输出调用栈，立马结束程序。",{"type":421,"tag":501,"props":1399,"children":1401},{"code":1400,"language":504,"meta":415,"className":505,"style":415},"void handler(int sig) {\n  int depth_max = 20;\n  void *array[depth_max];\n  size_t depth;\n  // backtrace 将前 depth_max 层栈帧记录到 array 数组中，\n  // 再通过 backtrace_symbols_fd 输出到 stderr。\n  // 文档见：https://man7.org/linux/man-pages/man3/backtrace.3.html\n  depth = backtrace(array, depth_max);\n  fprintf(stderr, \"Error: signal %d:\\n\", sig);\n  backtrace_symbols_fd(array, depth, STDERR_FILENO);\n  exit(1);\n}\nint main() {\n  signal(SIGSEGV, handler);\n  signal(SIGABRT, handler);\n  return kdb::test::RunAllTests();\n}\n",[1402],{"type":421,"tag":508,"props":1403,"children":1404},{"__ignoreMap":415},[1405,1440,1466,1499,1516,1525,1533,1541,1579,1638,1675,1695,1702,1721,1750,1778,1812],{"type":421,"tag":512,"props":1406,"children":1407},{"class":514,"line":515},[1408,1413,1418,1422,1426,1432,1436],{"type":421,"tag":512,"props":1409,"children":1410},{"style":555},[1411],{"type":427,"value":1412},"void",{"type":421,"tag":512,"props":1414,"children":1415},{"style":561},[1416],{"type":427,"value":1417}," handler",{"type":421,"tag":512,"props":1419,"children":1420},{"style":567},[1421],{"type":427,"value":649},{"type":421,"tag":512,"props":1423,"children":1424},{"style":555},[1425],{"type":427,"value":558},{"type":421,"tag":512,"props":1427,"children":1429},{"style":1428},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#E36209;--shiki-default-font-style:inherit;--shiki-dark:#FFAB70;--shiki-dark-font-style:inherit;--shiki-sepia:#FD971F;--shiki-sepia-font-style:italic",[1430],{"type":427,"value":1431}," sig",{"type":421,"tag":512,"props":1433,"children":1434},{"style":567},[1435],{"type":427,"value":1216},{"type":421,"tag":512,"props":1437,"children":1438},{"style":567},[1439],{"type":427,"value":575},{"type":421,"tag":512,"props":1441,"children":1442},{"class":514,"line":542},[1443,1448,1453,1457,1462],{"type":421,"tag":512,"props":1444,"children":1445},{"style":555},[1446],{"type":427,"value":1447},"  int",{"type":421,"tag":512,"props":1449,"children":1450},{"style":593},[1451],{"type":427,"value":1452}," depth_max ",{"type":421,"tag":512,"props":1454,"children":1455},{"style":691},[1456],{"type":427,"value":694},{"type":421,"tag":512,"props":1458,"children":1459},{"style":853},[1460],{"type":427,"value":1461}," 20",{"type":421,"tag":512,"props":1463,"children":1464},{"style":567},[1465],{"type":427,"value":601},{"type":421,"tag":512,"props":1467,"children":1468},{"class":514,"line":551},[1469,1474,1479,1484,1489,1494],{"type":421,"tag":512,"props":1470,"children":1471},{"style":555},[1472],{"type":427,"value":1473},"  void",{"type":421,"tag":512,"props":1475,"children":1476},{"style":691},[1477],{"type":427,"value":1478}," *",{"type":421,"tag":512,"props":1480,"children":1481},{"style":593},[1482],{"type":427,"value":1483},"array",{"type":421,"tag":512,"props":1485,"children":1486},{"style":567},[1487],{"type":427,"value":1488},"[",{"type":421,"tag":512,"props":1490,"children":1491},{"style":593},[1492],{"type":427,"value":1493},"depth_max",{"type":421,"tag":512,"props":1495,"children":1496},{"style":567},[1497],{"type":427,"value":1498},"];\n",{"type":421,"tag":512,"props":1500,"children":1501},{"class":514,"line":578},[1502,1507,1512],{"type":421,"tag":512,"props":1503,"children":1504},{"style":555},[1505],{"type":427,"value":1506},"  size_t",{"type":421,"tag":512,"props":1508,"children":1509},{"style":593},[1510],{"type":427,"value":1511}," depth",{"type":421,"tag":512,"props":1513,"children":1514},{"style":567},[1515],{"type":427,"value":601},{"type":421,"tag":512,"props":1517,"children":1518},{"class":514,"line":604},[1519],{"type":421,"tag":512,"props":1520,"children":1522},{"style":1521},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit",[1523],{"type":427,"value":1524},"  // backtrace 将前 depth_max 层栈帧记录到 array 数组中，\n",{"type":421,"tag":512,"props":1526,"children":1527},{"class":514,"line":625},[1528],{"type":421,"tag":512,"props":1529,"children":1530},{"style":1521},[1531],{"type":427,"value":1532},"  // 再通过 backtrace_symbols_fd 输出到 stderr。\n",{"type":421,"tag":512,"props":1534,"children":1535},{"class":514,"line":682},[1536],{"type":421,"tag":512,"props":1537,"children":1538},{"style":1521},[1539],{"type":427,"value":1540},"  // 文档见：https://man7.org/linux/man-pages/man3/backtrace.3.html\n",{"type":421,"tag":512,"props":1542,"children":1543},{"class":514,"line":717},[1544,1549,1553,1558,1562,1566,1570,1575],{"type":421,"tag":512,"props":1545,"children":1546},{"style":593},[1547],{"type":427,"value":1548},"  depth ",{"type":421,"tag":512,"props":1550,"children":1551},{"style":691},[1552],{"type":427,"value":694},{"type":421,"tag":512,"props":1554,"children":1555},{"style":561},[1556],{"type":427,"value":1557}," backtrace",{"type":421,"tag":512,"props":1559,"children":1560},{"style":567},[1561],{"type":427,"value":649},{"type":421,"tag":512,"props":1563,"children":1564},{"style":593},[1565],{"type":427,"value":1483},{"type":421,"tag":512,"props":1567,"children":1568},{"style":567},[1569],{"type":427,"value":659},{"type":421,"tag":512,"props":1571,"children":1572},{"style":593},[1573],{"type":427,"value":1574}," depth_max",{"type":421,"tag":512,"props":1576,"children":1577},{"style":567},[1578],{"type":427,"value":679},{"type":421,"tag":512,"props":1580,"children":1581},{"class":514,"line":759},[1582,1587,1591,1595,1599,1603,1608,1613,1618,1622,1626,1630,1634],{"type":421,"tag":512,"props":1583,"children":1584},{"style":561},[1585],{"type":427,"value":1586},"  fprintf",{"type":421,"tag":512,"props":1588,"children":1589},{"style":567},[1590],{"type":427,"value":649},{"type":421,"tag":512,"props":1592,"children":1593},{"style":593},[1594],{"type":427,"value":775},{"type":421,"tag":512,"props":1596,"children":1597},{"style":567},[1598],{"type":427,"value":659},{"type":421,"tag":512,"props":1600,"children":1601},{"style":525},[1602],{"type":427,"value":664},{"type":421,"tag":512,"props":1604,"children":1605},{"style":531},[1606],{"type":427,"value":1607},"Error: signal ",{"type":421,"tag":512,"props":1609,"children":1610},{"style":791},[1611],{"type":427,"value":1612},"%d",{"type":421,"tag":512,"props":1614,"children":1615},{"style":531},[1616],{"type":427,"value":1617},":",{"type":421,"tag":512,"props":1619,"children":1620},{"style":797},[1621],{"type":427,"value":800},{"type":421,"tag":512,"props":1623,"children":1624},{"style":525},[1625],{"type":427,"value":674},{"type":421,"tag":512,"props":1627,"children":1628},{"style":567},[1629],{"type":427,"value":659},{"type":421,"tag":512,"props":1631,"children":1632},{"style":593},[1633],{"type":427,"value":1431},{"type":421,"tag":512,"props":1635,"children":1636},{"style":567},[1637],{"type":427,"value":679},{"type":421,"tag":512,"props":1639,"children":1640},{"class":514,"line":840},[1641,1646,1650,1654,1658,1662,1666,1671],{"type":421,"tag":512,"props":1642,"children":1643},{"style":561},[1644],{"type":427,"value":1645},"  backtrace_symbols_fd",{"type":421,"tag":512,"props":1647,"children":1648},{"style":567},[1649],{"type":427,"value":649},{"type":421,"tag":512,"props":1651,"children":1652},{"style":593},[1653],{"type":427,"value":1483},{"type":421,"tag":512,"props":1655,"children":1656},{"style":567},[1657],{"type":427,"value":659},{"type":421,"tag":512,"props":1659,"children":1660},{"style":593},[1661],{"type":427,"value":1511},{"type":421,"tag":512,"props":1663,"children":1664},{"style":567},[1665],{"type":427,"value":659},{"type":421,"tag":512,"props":1667,"children":1668},{"style":593},[1669],{"type":427,"value":1670}," STDERR_FILENO",{"type":421,"tag":512,"props":1672,"children":1673},{"style":567},[1674],{"type":427,"value":679},{"type":421,"tag":512,"props":1676,"children":1677},{"class":514,"line":863},[1678,1683,1687,1691],{"type":421,"tag":512,"props":1679,"children":1680},{"style":561},[1681],{"type":427,"value":1682},"  exit",{"type":421,"tag":512,"props":1684,"children":1685},{"style":567},[1686],{"type":427,"value":649},{"type":421,"tag":512,"props":1688,"children":1689},{"style":853},[1690],{"type":427,"value":856},{"type":421,"tag":512,"props":1692,"children":1693},{"style":567},[1694],{"type":427,"value":679},{"type":421,"tag":512,"props":1696,"children":1697},{"class":514,"line":872},[1698],{"type":421,"tag":512,"props":1699,"children":1700},{"style":567},[1701],{"type":427,"value":1358},{"type":421,"tag":512,"props":1703,"children":1704},{"class":514,"line":880},[1705,1709,1713,1717],{"type":421,"tag":512,"props":1706,"children":1707},{"style":555},[1708],{"type":427,"value":558},{"type":421,"tag":512,"props":1710,"children":1711},{"style":561},[1712],{"type":427,"value":564},{"type":421,"tag":512,"props":1714,"children":1715},{"style":567},[1716],{"type":427,"value":570},{"type":421,"tag":512,"props":1718,"children":1719},{"style":567},[1720],{"type":427,"value":575},{"type":421,"tag":512,"props":1722,"children":1723},{"class":514,"line":923},[1724,1729,1733,1738,1742,1746],{"type":421,"tag":512,"props":1725,"children":1726},{"style":561},[1727],{"type":427,"value":1728},"  signal",{"type":421,"tag":512,"props":1730,"children":1731},{"style":567},[1732],{"type":427,"value":649},{"type":421,"tag":512,"props":1734,"children":1735},{"style":593},[1736],{"type":427,"value":1737},"SIGSEGV",{"type":421,"tag":512,"props":1739,"children":1740},{"style":567},[1741],{"type":427,"value":659},{"type":421,"tag":512,"props":1743,"children":1744},{"style":593},[1745],{"type":427,"value":1417},{"type":421,"tag":512,"props":1747,"children":1748},{"style":567},[1749],{"type":427,"value":679},{"type":421,"tag":512,"props":1751,"children":1752},{"class":514,"line":964},[1753,1757,1761,1766,1770,1774],{"type":421,"tag":512,"props":1754,"children":1755},{"style":561},[1756],{"type":427,"value":1728},{"type":421,"tag":512,"props":1758,"children":1759},{"style":567},[1760],{"type":427,"value":649},{"type":421,"tag":512,"props":1762,"children":1763},{"style":593},[1764],{"type":427,"value":1765},"SIGABRT",{"type":421,"tag":512,"props":1767,"children":1768},{"style":567},[1769],{"type":427,"value":659},{"type":421,"tag":512,"props":1771,"children":1772},{"style":593},[1773],{"type":427,"value":1417},{"type":421,"tag":512,"props":1775,"children":1776},{"style":567},[1777],{"type":427,"value":679},{"type":421,"tag":512,"props":1779,"children":1780},{"class":514,"line":972},[1781,1785,1790,1794,1799,1803,1808],{"type":421,"tag":512,"props":1782,"children":1783},{"style":519},[1784],{"type":427,"value":1340},{"type":421,"tag":512,"props":1786,"children":1787},{"style":582},[1788],{"type":427,"value":1789}," kdb",{"type":421,"tag":512,"props":1791,"children":1792},{"style":567},[1793],{"type":427,"value":590},{"type":421,"tag":512,"props":1795,"children":1796},{"style":582},[1797],{"type":427,"value":1798},"test",{"type":421,"tag":512,"props":1800,"children":1801},{"style":567},[1802],{"type":427,"value":590},{"type":421,"tag":512,"props":1804,"children":1805},{"style":561},[1806],{"type":427,"value":1807},"RunAllTests",{"type":421,"tag":512,"props":1809,"children":1810},{"style":567},[1811],{"type":427,"value":714},{"type":421,"tag":512,"props":1813,"children":1814},{"class":514,"line":993},[1815],{"type":421,"tag":512,"props":1816,"children":1817},{"style":567},[1818],{"type":427,"value":1358},{"type":421,"tag":1388,"props":1820,"children":1822},{"id":1821},"使用宏创建测试类",[1823],{"type":427,"value":1821},{"type":421,"tag":435,"props":1825,"children":1826},{},[1827],{"type":427,"value":1828},"test_db 中的类是使用宏定义的。如下代码，TEST 展开的新类，继承了 DBTest，实现了 _RunIt 接口以便调用测试函数。TCONCAT 宏顾名思义就是连接，使用标记黏贴运算符把两个字符串或实参连接在一起并视为一个新的标记。_Test_ 和 name 连接在一起后，就是新类的名称，如 _Test_CloseAndReopen。",{"type":421,"tag":501,"props":1830,"children":1832},{"code":1831,"language":504,"meta":415,"className":505,"style":415},"TEST(DBTest, CloseAndReopen) {\n  // ...\n}\n#define TEST(base,name)                                                 \\\nclass TCONCAT(_Test_,name) : public base {                              \\\n public:                                                                \\\n  void _Run();                                                          \\\n  static void _RunIt() {                                                \\\n    TCONCAT(_Test_,name) t;                                             \\\n    t._Run();                                                           \\\n  }                                                                     \\\n};                                                                      \\\nbool TCONCAT(_Test_ignored_,name) =                                     \\\n  ::kdb::test::RegisterTest(#base, #name, &TCONCAT(_Test_,name)::_RunIt); \\\n",[1833],{"type":421,"tag":508,"props":1834,"children":1835},{"__ignoreMap":415},[1836,1870,1878,1885,1925,1974,1992,2014,2047,2090,2116,2128,2141,2184],{"type":421,"tag":512,"props":1837,"children":1838},{"class":514,"line":515},[1839,1844,1848,1853,1857,1862,1866],{"type":421,"tag":512,"props":1840,"children":1841},{"style":561},[1842],{"type":427,"value":1843},"TEST",{"type":421,"tag":512,"props":1845,"children":1846},{"style":567},[1847],{"type":427,"value":649},{"type":421,"tag":512,"props":1849,"children":1850},{"style":593},[1851],{"type":427,"value":1852},"DBTest",{"type":421,"tag":512,"props":1854,"children":1855},{"style":567},[1856],{"type":427,"value":659},{"type":421,"tag":512,"props":1858,"children":1859},{"style":593},[1860],{"type":427,"value":1861}," CloseAndReopen",{"type":421,"tag":512,"props":1863,"children":1864},{"style":567},[1865],{"type":427,"value":1216},{"type":421,"tag":512,"props":1867,"children":1868},{"style":567},[1869],{"type":427,"value":575},{"type":421,"tag":512,"props":1871,"children":1872},{"class":514,"line":542},[1873],{"type":421,"tag":512,"props":1874,"children":1875},{"style":1521},[1876],{"type":427,"value":1877},"  // ...\n",{"type":421,"tag":512,"props":1879,"children":1880},{"class":514,"line":551},[1881],{"type":421,"tag":512,"props":1882,"children":1883},{"style":567},[1884],{"type":427,"value":1358},{"type":421,"tag":512,"props":1886,"children":1887},{"class":514,"line":578},[1888,1893,1898,1902,1907,1911,1916,1920],{"type":421,"tag":512,"props":1889,"children":1890},{"style":519},[1891],{"type":427,"value":1892},"#define",{"type":421,"tag":512,"props":1894,"children":1895},{"style":561},[1896],{"type":427,"value":1897}," TEST",{"type":421,"tag":512,"props":1899,"children":1900},{"style":567},[1901],{"type":427,"value":649},{"type":421,"tag":512,"props":1903,"children":1904},{"style":1428},[1905],{"type":427,"value":1906},"base",{"type":421,"tag":512,"props":1908,"children":1909},{"style":567},[1910],{"type":427,"value":659},{"type":421,"tag":512,"props":1912,"children":1913},{"style":1428},[1914],{"type":427,"value":1915},"name",{"type":421,"tag":512,"props":1917,"children":1918},{"style":567},[1919],{"type":427,"value":1216},{"type":421,"tag":512,"props":1921,"children":1922},{"style":797},[1923],{"type":427,"value":1924},"                                                 \\\n",{"type":421,"tag":512,"props":1926,"children":1927},{"class":514,"line":604},[1928,1933,1938,1942,1947,1951,1955,1959,1964,1969],{"type":421,"tag":512,"props":1929,"children":1930},{"style":555},[1931],{"type":427,"value":1932},"class",{"type":421,"tag":512,"props":1934,"children":1935},{"style":561},[1936],{"type":427,"value":1937}," TCONCAT",{"type":421,"tag":512,"props":1939,"children":1940},{"style":567},[1941],{"type":427,"value":649},{"type":421,"tag":512,"props":1943,"children":1944},{"style":582},[1945],{"type":427,"value":1946},"_Test_",{"type":421,"tag":512,"props":1948,"children":1949},{"style":567},[1950],{"type":427,"value":659},{"type":421,"tag":512,"props":1952,"children":1953},{"style":582},[1954],{"type":427,"value":1915},{"type":421,"tag":512,"props":1956,"children":1957},{"style":567},[1958],{"type":427,"value":1216},{"type":421,"tag":512,"props":1960,"children":1961},{"style":593},[1962],{"type":427,"value":1963}," : public base ",{"type":421,"tag":512,"props":1965,"children":1966},{"style":567},[1967],{"type":427,"value":1968},"{",{"type":421,"tag":512,"props":1970,"children":1971},{"style":797},[1972],{"type":427,"value":1973},"                              \\\n",{"type":421,"tag":512,"props":1975,"children":1976},{"class":514,"line":625},[1977,1982,1987],{"type":421,"tag":512,"props":1978,"children":1979},{"style":555},[1980],{"type":427,"value":1981}," public",{"type":421,"tag":512,"props":1983,"children":1985},{"style":1984},"--shiki-light:#39ADB5;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic",[1986],{"type":427,"value":1617},{"type":421,"tag":512,"props":1988,"children":1989},{"style":797},[1990],{"type":427,"value":1991},"                                                                \\\n",{"type":421,"tag":512,"props":1993,"children":1994},{"class":514,"line":682},[1995,1999,2004,2009],{"type":421,"tag":512,"props":1996,"children":1997},{"style":555},[1998],{"type":427,"value":1473},{"type":421,"tag":512,"props":2000,"children":2001},{"style":561},[2002],{"type":427,"value":2003}," _Run",{"type":421,"tag":512,"props":2005,"children":2006},{"style":567},[2007],{"type":427,"value":2008},"();",{"type":421,"tag":512,"props":2010,"children":2011},{"style":797},[2012],{"type":427,"value":2013},"                                                          \\\n",{"type":421,"tag":512,"props":2015,"children":2016},{"class":514,"line":717},[2017,2023,2028,2033,2037,2042],{"type":421,"tag":512,"props":2018,"children":2020},{"style":2019},"--shiki-light:#9C3EDA;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[2021],{"type":427,"value":2022},"  static",{"type":421,"tag":512,"props":2024,"children":2025},{"style":555},[2026],{"type":427,"value":2027}," void",{"type":421,"tag":512,"props":2029,"children":2030},{"style":561},[2031],{"type":427,"value":2032}," _RunIt",{"type":421,"tag":512,"props":2034,"children":2035},{"style":567},[2036],{"type":427,"value":570},{"type":421,"tag":512,"props":2038,"children":2039},{"style":567},[2040],{"type":427,"value":2041}," {",{"type":421,"tag":512,"props":2043,"children":2044},{"style":797},[2045],{"type":427,"value":2046},"                                                \\\n",{"type":421,"tag":512,"props":2048,"children":2049},{"class":514,"line":759},[2050,2055,2059,2063,2067,2071,2075,2080,2085],{"type":421,"tag":512,"props":2051,"children":2052},{"style":561},[2053],{"type":427,"value":2054},"    TCONCAT",{"type":421,"tag":512,"props":2056,"children":2057},{"style":567},[2058],{"type":427,"value":649},{"type":421,"tag":512,"props":2060,"children":2061},{"style":772},[2062],{"type":427,"value":1946},{"type":421,"tag":512,"props":2064,"children":2065},{"style":567},[2066],{"type":427,"value":659},{"type":421,"tag":512,"props":2068,"children":2069},{"style":772},[2070],{"type":427,"value":1915},{"type":421,"tag":512,"props":2072,"children":2073},{"style":567},[2074],{"type":427,"value":1216},{"type":421,"tag":512,"props":2076,"children":2077},{"style":772},[2078],{"type":427,"value":2079}," t",{"type":421,"tag":512,"props":2081,"children":2082},{"style":567},[2083],{"type":427,"value":2084},";",{"type":421,"tag":512,"props":2086,"children":2087},{"style":797},[2088],{"type":427,"value":2089},"                                             \\\n",{"type":421,"tag":512,"props":2091,"children":2092},{"class":514,"line":840},[2093,2098,2102,2107,2111],{"type":421,"tag":512,"props":2094,"children":2095},{"style":593},[2096],{"type":427,"value":2097},"    t",{"type":421,"tag":512,"props":2099,"children":2100},{"style":567},[2101],{"type":427,"value":704},{"type":421,"tag":512,"props":2103,"children":2104},{"style":561},[2105],{"type":427,"value":2106},"_Run",{"type":421,"tag":512,"props":2108,"children":2109},{"style":567},[2110],{"type":427,"value":2008},{"type":421,"tag":512,"props":2112,"children":2113},{"style":797},[2114],{"type":427,"value":2115},"                                                           \\\n",{"type":421,"tag":512,"props":2117,"children":2118},{"class":514,"line":863},[2119,2123],{"type":421,"tag":512,"props":2120,"children":2121},{"style":567},[2122],{"type":427,"value":1269},{"type":421,"tag":512,"props":2124,"children":2125},{"style":797},[2126],{"type":427,"value":2127},"                                                                     \\\n",{"type":421,"tag":512,"props":2129,"children":2130},{"class":514,"line":872},[2131,2136],{"type":421,"tag":512,"props":2132,"children":2133},{"style":567},[2134],{"type":427,"value":2135},"};",{"type":421,"tag":512,"props":2137,"children":2138},{"style":797},[2139],{"type":427,"value":2140},"                                                                      \\\n",{"type":421,"tag":512,"props":2142,"children":2143},{"class":514,"line":880},[2144,2149,2153,2157,2162,2166,2170,2174,2179],{"type":421,"tag":512,"props":2145,"children":2146},{"style":555},[2147],{"type":427,"value":2148},"bool",{"type":421,"tag":512,"props":2150,"children":2151},{"style":561},[2152],{"type":427,"value":1937},{"type":421,"tag":512,"props":2154,"children":2155},{"style":567},[2156],{"type":427,"value":649},{"type":421,"tag":512,"props":2158,"children":2159},{"style":582},[2160],{"type":427,"value":2161},"_Test_ignored_",{"type":421,"tag":512,"props":2163,"children":2164},{"style":567},[2165],{"type":427,"value":659},{"type":421,"tag":512,"props":2167,"children":2168},{"style":582},[2169],{"type":427,"value":1915},{"type":421,"tag":512,"props":2171,"children":2172},{"style":567},[2173],{"type":427,"value":1216},{"type":421,"tag":512,"props":2175,"children":2176},{"style":691},[2177],{"type":427,"value":2178}," =",{"type":421,"tag":512,"props":2180,"children":2181},{"style":797},[2182],{"type":427,"value":2183},"                                     \\\n",{"type":421,"tag":512,"props":2185,"children":2186},{"class":514,"line":923},[2187,2192,2197,2201,2205,2209,2214,2218,2223,2227,2232,2236,2240,2245,2249,2253,2257,2261,2265,2270,2274],{"type":421,"tag":512,"props":2188,"children":2189},{"style":593},[2190],{"type":427,"value":2191},"  ::",{"type":421,"tag":512,"props":2193,"children":2194},{"style":582},[2195],{"type":427,"value":2196},"kdb",{"type":421,"tag":512,"props":2198,"children":2199},{"style":567},[2200],{"type":427,"value":590},{"type":421,"tag":512,"props":2202,"children":2203},{"style":582},[2204],{"type":427,"value":1798},{"type":421,"tag":512,"props":2206,"children":2207},{"style":567},[2208],{"type":427,"value":590},{"type":421,"tag":512,"props":2210,"children":2211},{"style":561},[2212],{"type":427,"value":2213},"RegisterTest",{"type":421,"tag":512,"props":2215,"children":2216},{"style":567},[2217],{"type":427,"value":649},{"type":421,"tag":512,"props":2219,"children":2220},{"style":593},[2221],{"type":427,"value":2222},"#base",{"type":421,"tag":512,"props":2224,"children":2225},{"style":567},[2226],{"type":427,"value":659},{"type":421,"tag":512,"props":2228,"children":2229},{"style":593},[2230],{"type":427,"value":2231}," #name",{"type":421,"tag":512,"props":2233,"children":2234},{"style":567},[2235],{"type":427,"value":659},{"type":421,"tag":512,"props":2237,"children":2238},{"style":691},[2239],{"type":427,"value":1147},{"type":421,"tag":512,"props":2241,"children":2242},{"style":561},[2243],{"type":427,"value":2244},"TCONCAT",{"type":421,"tag":512,"props":2246,"children":2247},{"style":567},[2248],{"type":427,"value":649},{"type":421,"tag":512,"props":2250,"children":2251},{"style":593},[2252],{"type":427,"value":1946},{"type":421,"tag":512,"props":2254,"children":2255},{"style":567},[2256],{"type":427,"value":659},{"type":421,"tag":512,"props":2258,"children":2259},{"style":593},[2260],{"type":427,"value":1915},{"type":421,"tag":512,"props":2262,"children":2263},{"style":567},[2264],{"type":427,"value":1216},{"type":421,"tag":512,"props":2266,"children":2267},{"style":593},[2268],{"type":427,"value":2269},"::_RunIt",{"type":421,"tag":512,"props":2271,"children":2272},{"style":567},[2273],{"type":427,"value":1255},{"type":421,"tag":512,"props":2275,"children":2276},{"style":797},[2277],{"type":427,"value":2278}," \\\n",{"type":421,"tag":435,"props":2280,"children":2281},{},[2282],{"type":427,"value":2283},"可是，既然有 TCONCAT，为什么还要定义一个 TCONCAT1 宏呢？",{"type":421,"tag":501,"props":2285,"children":2287},{"code":2286,"language":504,"meta":415,"className":505,"style":415},"#define TCONCAT(a,b) TCONCAT1(a,b)\n#define TCONCAT1(a,b) a##b\n",[2288],{"type":421,"tag":508,"props":2289,"children":2290},{"__ignoreMap":415},[2291,2349],{"type":421,"tag":512,"props":2292,"children":2293},{"class":514,"line":515},[2294,2298,2302,2306,2310,2314,2319,2323,2328,2332,2336,2340,2344],{"type":421,"tag":512,"props":2295,"children":2296},{"style":519},[2297],{"type":427,"value":1892},{"type":421,"tag":512,"props":2299,"children":2300},{"style":561},[2301],{"type":427,"value":1937},{"type":421,"tag":512,"props":2303,"children":2304},{"style":567},[2305],{"type":427,"value":649},{"type":421,"tag":512,"props":2307,"children":2308},{"style":1428},[2309],{"type":427,"value":446},{"type":421,"tag":512,"props":2311,"children":2312},{"style":567},[2313],{"type":427,"value":659},{"type":421,"tag":512,"props":2315,"children":2316},{"style":1428},[2317],{"type":427,"value":2318},"b",{"type":421,"tag":512,"props":2320,"children":2321},{"style":567},[2322],{"type":427,"value":1216},{"type":421,"tag":512,"props":2324,"children":2325},{"style":561},[2326],{"type":427,"value":2327}," TCONCAT1",{"type":421,"tag":512,"props":2329,"children":2330},{"style":567},[2331],{"type":427,"value":649},{"type":421,"tag":512,"props":2333,"children":2334},{"style":593},[2335],{"type":427,"value":446},{"type":421,"tag":512,"props":2337,"children":2338},{"style":567},[2339],{"type":427,"value":659},{"type":421,"tag":512,"props":2341,"children":2342},{"style":593},[2343],{"type":427,"value":2318},{"type":421,"tag":512,"props":2345,"children":2346},{"style":567},[2347],{"type":427,"value":2348},")\n",{"type":421,"tag":512,"props":2350,"children":2351},{"class":514,"line":542},[2352,2356,2360,2364,2368,2372,2376,2380],{"type":421,"tag":512,"props":2353,"children":2354},{"style":519},[2355],{"type":427,"value":1892},{"type":421,"tag":512,"props":2357,"children":2358},{"style":561},[2359],{"type":427,"value":2327},{"type":421,"tag":512,"props":2361,"children":2362},{"style":567},[2363],{"type":427,"value":649},{"type":421,"tag":512,"props":2365,"children":2366},{"style":1428},[2367],{"type":427,"value":446},{"type":421,"tag":512,"props":2369,"children":2370},{"style":567},[2371],{"type":427,"value":659},{"type":421,"tag":512,"props":2373,"children":2374},{"style":1428},[2375],{"type":427,"value":2318},{"type":421,"tag":512,"props":2377,"children":2378},{"style":567},[2379],{"type":427,"value":1216},{"type":421,"tag":512,"props":2381,"children":2382},{"style":593},[2383],{"type":427,"value":2384}," a##b\n",{"type":421,"tag":435,"props":2386,"children":2387},{},[2388],{"type":427,"value":2389},"这就要提到宏的一个特殊规则了，如果宏参数使用了字符串化运算符（#）或标记黏贴运算符（##），那么即便参数是宏也不会展开。所以需要一个间接宏 TCONCAT1，以达到先展开参数（如果参数是宏的化），再调用标记黏贴运算符的目的。从 test_db 可以看到，测试类的名词都不是宏，所以这里本不需要 TCONCAT1 这个间接宏。但是考虑到程序的健壮性，加上更好。",{"type":421,"tag":1388,"props":2391,"children":2393},{"id":2392},"断言宏",[2394],{"type":427,"value":2392},{"type":421,"tag":435,"props":2396,"children":2397},{},[2398],{"type":427,"value":2399},"测试代码中的断言也是使用的宏来定义的。相比 TCONCAT 简单很多了，但其特点是可以记录抛错的文件以及行号。以下代码实现了 ASSERT_EQ 的定义。Tester 用于记录宏展开时所在的文件 __FILE__、行号 __LINE__ 以及断言结果。一但断言失败，记录到 ok_ 成员变量中。在 Tester 析构时，会把相关信息一并打印出来。",{"type":421,"tag":501,"props":2401,"children":2403},{"code":2402,"language":504,"meta":415,"className":505,"style":415},"class Tester {\n#define BINARY_OP(name,op)                              \\\n  template \u003Cclass X, class Y>                           \\\n  Tester& name(const X& x, const Y& y) {                \\\n    if (! (x op y)) {                                   \\\n      ss_ \u003C\u003C \" failed: \" \u003C\u003C x \u003C\u003C (\" \" #op \" \") \u003C\u003C y;    \\\n      ok_ = false;                                      \\\n    }                                                   \\\n    return *this;                                       \\\n  }\n  BINARY_OP(IsEq, ==)\n#undef BINARY_OP\n}\n#define ASSERT_EQ(a,b) ::kdb::test::Tester(__FILE__, __LINE__).IsEq((a),(b))\n",[2404],{"type":421,"tag":508,"props":2405,"children":2406},{"__ignoreMap":415},[2407,2423,2460,2505,2580,2619,2705,2732,2745,2772,2779,2809,2822,2829],{"type":421,"tag":512,"props":2408,"children":2409},{"class":514,"line":515},[2410,2414,2419],{"type":421,"tag":512,"props":2411,"children":2412},{"style":555},[2413],{"type":427,"value":1932},{"type":421,"tag":512,"props":2415,"children":2416},{"style":582},[2417],{"type":427,"value":2418}," Tester",{"type":421,"tag":512,"props":2420,"children":2421},{"style":567},[2422],{"type":427,"value":575},{"type":421,"tag":512,"props":2424,"children":2425},{"class":514,"line":542},[2426,2430,2435,2439,2443,2447,2452,2456],{"type":421,"tag":512,"props":2427,"children":2428},{"style":519},[2429],{"type":427,"value":1892},{"type":421,"tag":512,"props":2431,"children":2432},{"style":561},[2433],{"type":427,"value":2434}," BINARY_OP",{"type":421,"tag":512,"props":2436,"children":2437},{"style":567},[2438],{"type":427,"value":649},{"type":421,"tag":512,"props":2440,"children":2441},{"style":1428},[2442],{"type":427,"value":1915},{"type":421,"tag":512,"props":2444,"children":2445},{"style":567},[2446],{"type":427,"value":659},{"type":421,"tag":512,"props":2448,"children":2449},{"style":1428},[2450],{"type":427,"value":2451},"op",{"type":421,"tag":512,"props":2453,"children":2454},{"style":567},[2455],{"type":427,"value":1216},{"type":421,"tag":512,"props":2457,"children":2458},{"style":797},[2459],{"type":427,"value":1973},{"type":421,"tag":512,"props":2461,"children":2462},{"class":514,"line":551},[2463,2468,2472,2476,2481,2485,2490,2495,2500],{"type":421,"tag":512,"props":2464,"children":2465},{"style":555},[2466],{"type":427,"value":2467},"  template",{"type":421,"tag":512,"props":2469,"children":2470},{"style":567},[2471],{"type":427,"value":528},{"type":421,"tag":512,"props":2473,"children":2474},{"style":555},[2475],{"type":427,"value":1932},{"type":421,"tag":512,"props":2477,"children":2478},{"style":582},[2479],{"type":427,"value":2480}," X",{"type":421,"tag":512,"props":2482,"children":2483},{"style":567},[2484],{"type":427,"value":659},{"type":421,"tag":512,"props":2486,"children":2487},{"style":555},[2488],{"type":427,"value":2489}," class",{"type":421,"tag":512,"props":2491,"children":2492},{"style":582},[2493],{"type":427,"value":2494}," Y",{"type":421,"tag":512,"props":2496,"children":2497},{"style":567},[2498],{"type":427,"value":2499},">",{"type":421,"tag":512,"props":2501,"children":2502},{"style":797},[2503],{"type":427,"value":2504},"                           \\\n",{"type":421,"tag":512,"props":2506,"children":2507},{"class":514,"line":578},[2508,2513,2518,2523,2527,2532,2536,2540,2545,2549,2554,2558,2562,2567,2571,2575],{"type":421,"tag":512,"props":2509,"children":2510},{"style":582},[2511],{"type":427,"value":2512},"  Tester",{"type":421,"tag":512,"props":2514,"children":2515},{"style":2019},[2516],{"type":427,"value":2517},"&",{"type":421,"tag":512,"props":2519,"children":2520},{"style":561},[2521],{"type":427,"value":2522}," name",{"type":421,"tag":512,"props":2524,"children":2525},{"style":567},[2526],{"type":427,"value":649},{"type":421,"tag":512,"props":2528,"children":2529},{"style":2019},[2530],{"type":427,"value":2531},"const",{"type":421,"tag":512,"props":2533,"children":2534},{"style":582},[2535],{"type":427,"value":2480},{"type":421,"tag":512,"props":2537,"children":2538},{"style":2019},[2539],{"type":427,"value":2517},{"type":421,"tag":512,"props":2541,"children":2542},{"style":1428},[2543],{"type":427,"value":2544}," x",{"type":421,"tag":512,"props":2546,"children":2547},{"style":567},[2548],{"type":427,"value":659},{"type":421,"tag":512,"props":2550,"children":2551},{"style":2019},[2552],{"type":427,"value":2553}," const",{"type":421,"tag":512,"props":2555,"children":2556},{"style":582},[2557],{"type":427,"value":2494},{"type":421,"tag":512,"props":2559,"children":2560},{"style":2019},[2561],{"type":427,"value":2517},{"type":421,"tag":512,"props":2563,"children":2564},{"style":1428},[2565],{"type":427,"value":2566}," y",{"type":421,"tag":512,"props":2568,"children":2569},{"style":567},[2570],{"type":427,"value":1216},{"type":421,"tag":512,"props":2572,"children":2573},{"style":567},[2574],{"type":427,"value":2041},{"type":421,"tag":512,"props":2576,"children":2577},{"style":797},[2578],{"type":427,"value":2579},"                \\\n",{"type":421,"tag":512,"props":2581,"children":2582},{"class":514,"line":604},[2583,2588,2592,2596,2600,2605,2610,2614],{"type":421,"tag":512,"props":2584,"children":2585},{"style":519},[2586],{"type":427,"value":2587},"    if",{"type":421,"tag":512,"props":2589,"children":2590},{"style":567},[2591],{"type":427,"value":728},{"type":421,"tag":512,"props":2593,"children":2594},{"style":691},[2595],{"type":427,"value":733},{"type":421,"tag":512,"props":2597,"children":2598},{"style":567},[2599],{"type":427,"value":728},{"type":421,"tag":512,"props":2601,"children":2602},{"style":772},[2603],{"type":427,"value":2604},"x op y",{"type":421,"tag":512,"props":2606,"children":2607},{"style":567},[2608],{"type":427,"value":2609},"))",{"type":421,"tag":512,"props":2611,"children":2612},{"style":567},[2613],{"type":427,"value":2041},{"type":421,"tag":512,"props":2615,"children":2616},{"style":797},[2617],{"type":427,"value":2618},"                                   \\\n",{"type":421,"tag":512,"props":2620,"children":2621},{"class":514,"line":625},[2622,2627,2632,2636,2641,2645,2650,2655,2659,2663,2667,2671,2676,2680,2684,2688,2692,2696,2700],{"type":421,"tag":512,"props":2623,"children":2624},{"style":772},[2625],{"type":427,"value":2626},"      ss_ ",{"type":421,"tag":512,"props":2628,"children":2629},{"style":691},[2630],{"type":427,"value":2631},"\u003C\u003C",{"type":421,"tag":512,"props":2633,"children":2634},{"style":525},[2635],{"type":427,"value":664},{"type":421,"tag":512,"props":2637,"children":2638},{"style":531},[2639],{"type":427,"value":2640}," failed: ",{"type":421,"tag":512,"props":2642,"children":2643},{"style":525},[2644],{"type":427,"value":674},{"type":421,"tag":512,"props":2646,"children":2647},{"style":691},[2648],{"type":427,"value":2649}," \u003C\u003C",{"type":421,"tag":512,"props":2651,"children":2652},{"style":772},[2653],{"type":427,"value":2654}," x ",{"type":421,"tag":512,"props":2656,"children":2657},{"style":691},[2658],{"type":427,"value":2631},{"type":421,"tag":512,"props":2660,"children":2661},{"style":567},[2662],{"type":427,"value":728},{"type":421,"tag":512,"props":2664,"children":2665},{"style":525},[2666],{"type":427,"value":674},{"type":421,"tag":512,"props":2668,"children":2669},{"style":525},[2670],{"type":427,"value":664},{"type":421,"tag":512,"props":2672,"children":2673},{"style":593},[2674],{"type":427,"value":2675}," #op",{"type":421,"tag":512,"props":2677,"children":2678},{"style":525},[2679],{"type":427,"value":664},{"type":421,"tag":512,"props":2681,"children":2682},{"style":525},[2683],{"type":427,"value":664},{"type":421,"tag":512,"props":2685,"children":2686},{"style":567},[2687],{"type":427,"value":1216},{"type":421,"tag":512,"props":2689,"children":2690},{"style":691},[2691],{"type":427,"value":2649},{"type":421,"tag":512,"props":2693,"children":2694},{"style":772},[2695],{"type":427,"value":2566},{"type":421,"tag":512,"props":2697,"children":2698},{"style":567},[2699],{"type":427,"value":2084},{"type":421,"tag":512,"props":2701,"children":2702},{"style":797},[2703],{"type":427,"value":2704},"    \\\n",{"type":421,"tag":512,"props":2706,"children":2707},{"class":514,"line":682},[2708,2713,2717,2723,2727],{"type":421,"tag":512,"props":2709,"children":2710},{"style":772},[2711],{"type":427,"value":2712},"      ok_ ",{"type":421,"tag":512,"props":2714,"children":2715},{"style":691},[2716],{"type":427,"value":694},{"type":421,"tag":512,"props":2718,"children":2720},{"style":2719},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[2721],{"type":427,"value":2722}," false",{"type":421,"tag":512,"props":2724,"children":2725},{"style":567},[2726],{"type":427,"value":2084},{"type":421,"tag":512,"props":2728,"children":2729},{"style":797},[2730],{"type":427,"value":2731},"                                      \\\n",{"type":421,"tag":512,"props":2733,"children":2734},{"class":514,"line":717},[2735,2740],{"type":421,"tag":512,"props":2736,"children":2737},{"style":567},[2738],{"type":427,"value":2739},"    }",{"type":421,"tag":512,"props":2741,"children":2742},{"style":797},[2743],{"type":427,"value":2744},"                                                   \\\n",{"type":421,"tag":512,"props":2746,"children":2747},{"class":514,"line":759},[2748,2753,2757,2763,2767],{"type":421,"tag":512,"props":2749,"children":2750},{"style":519},[2751],{"type":427,"value":2752},"    return",{"type":421,"tag":512,"props":2754,"children":2755},{"style":691},[2756],{"type":427,"value":1478},{"type":421,"tag":512,"props":2758,"children":2760},{"style":2759},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[2761],{"type":427,"value":2762},"this",{"type":421,"tag":512,"props":2764,"children":2765},{"style":567},[2766],{"type":427,"value":2084},{"type":421,"tag":512,"props":2768,"children":2769},{"style":797},[2770],{"type":427,"value":2771},"                                       \\\n",{"type":421,"tag":512,"props":2773,"children":2774},{"class":514,"line":840},[2775],{"type":421,"tag":512,"props":2776,"children":2777},{"style":567},[2778],{"type":427,"value":869},{"type":421,"tag":512,"props":2780,"children":2781},{"class":514,"line":863},[2782,2787,2791,2796,2800,2805],{"type":421,"tag":512,"props":2783,"children":2784},{"style":561},[2785],{"type":427,"value":2786},"  BINARY_OP",{"type":421,"tag":512,"props":2788,"children":2789},{"style":567},[2790],{"type":427,"value":649},{"type":421,"tag":512,"props":2792,"children":2793},{"style":582},[2794],{"type":427,"value":2795},"IsEq",{"type":421,"tag":512,"props":2797,"children":2798},{"style":567},[2799],{"type":427,"value":659},{"type":421,"tag":512,"props":2801,"children":2802},{"style":691},[2803],{"type":427,"value":2804}," ==",{"type":421,"tag":512,"props":2806,"children":2807},{"style":567},[2808],{"type":427,"value":2348},{"type":421,"tag":512,"props":2810,"children":2811},{"class":514,"line":872},[2812,2817],{"type":421,"tag":512,"props":2813,"children":2814},{"style":519},[2815],{"type":427,"value":2816},"#undef",{"type":421,"tag":512,"props":2818,"children":2819},{"style":561},[2820],{"type":427,"value":2821}," BINARY_OP\n",{"type":421,"tag":512,"props":2823,"children":2824},{"class":514,"line":880},[2825],{"type":421,"tag":512,"props":2826,"children":2827},{"style":772},[2828],{"type":427,"value":1358},{"type":421,"tag":512,"props":2830,"children":2831},{"class":514,"line":923},[2832,2836,2841,2845,2849,2853,2857,2861,2866,2870,2874,2878,2882,2887,2891,2897,2901,2906,2911,2915,2920,2924,2929,2933],{"type":421,"tag":512,"props":2833,"children":2834},{"style":519},[2835],{"type":427,"value":1892},{"type":421,"tag":512,"props":2837,"children":2838},{"style":561},[2839],{"type":427,"value":2840}," ASSERT_EQ",{"type":421,"tag":512,"props":2842,"children":2843},{"style":567},[2844],{"type":427,"value":649},{"type":421,"tag":512,"props":2846,"children":2847},{"style":1428},[2848],{"type":427,"value":446},{"type":421,"tag":512,"props":2850,"children":2851},{"style":567},[2852],{"type":427,"value":659},{"type":421,"tag":512,"props":2854,"children":2855},{"style":1428},[2856],{"type":427,"value":2318},{"type":421,"tag":512,"props":2858,"children":2859},{"style":567},[2860],{"type":427,"value":1216},{"type":421,"tag":512,"props":2862,"children":2863},{"style":772},[2864],{"type":427,"value":2865}," ::",{"type":421,"tag":512,"props":2867,"children":2868},{"style":582},[2869],{"type":427,"value":2196},{"type":421,"tag":512,"props":2871,"children":2872},{"style":567},[2873],{"type":427,"value":590},{"type":421,"tag":512,"props":2875,"children":2876},{"style":582},[2877],{"type":427,"value":1798},{"type":421,"tag":512,"props":2879,"children":2880},{"style":567},[2881],{"type":427,"value":590},{"type":421,"tag":512,"props":2883,"children":2884},{"style":561},[2885],{"type":427,"value":2886},"Tester",{"type":421,"tag":512,"props":2888,"children":2889},{"style":567},[2890],{"type":427,"value":649},{"type":421,"tag":512,"props":2892,"children":2894},{"style":2893},"--shiki-light:#E2931D;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#F8F8F2",[2895],{"type":427,"value":2896},"__FILE__",{"type":421,"tag":512,"props":2898,"children":2899},{"style":567},[2900],{"type":427,"value":659},{"type":421,"tag":512,"props":2902,"children":2903},{"style":2893},[2904],{"type":427,"value":2905}," __LINE__",{"type":421,"tag":512,"props":2907,"children":2908},{"style":567},[2909],{"type":427,"value":2910},").",{"type":421,"tag":512,"props":2912,"children":2913},{"style":561},[2914],{"type":427,"value":2795},{"type":421,"tag":512,"props":2916,"children":2917},{"style":567},[2918],{"type":427,"value":2919},"((",{"type":421,"tag":512,"props":2921,"children":2922},{"style":772},[2923],{"type":427,"value":446},{"type":421,"tag":512,"props":2925,"children":2926},{"style":567},[2927],{"type":427,"value":2928},"),(",{"type":421,"tag":512,"props":2930,"children":2931},{"style":772},[2932],{"type":427,"value":2318},{"type":421,"tag":512,"props":2934,"children":2935},{"style":567},[2936],{"type":427,"value":2937},"))\n",{"type":421,"tag":1388,"props":2939,"children":2941},{"id":2940},"stringrepeatntimes",[2942],{"type":427,"value":2943},"string.repeat(ntimes)",{"type":421,"tag":435,"props":2945,"children":2946},{},[2947],{"type":427,"value":2948},"写 JavaScript 时经常用到 String 的原型方法 repeat，用来把 n 个内容重复的字符串拼接为一个新字符串。也许是 C++ 标准库没有提供相应的算法，KDB 使用了一种和 repeat 完全不一样的处理思路。KDB 使用 StringStream 填充一定位数内容，还可以不用考虑值的长度。",{"type":421,"tag":501,"props":2950,"children":2952},{"code":2951,"language":504,"meta":415,"className":505,"style":415},"std::stringstream ss;\nss \u003C\u003C std::setfill ('0') \u003C\u003C std::setw (16);\nss \u003C\u003C 1;\nss.str(); // result is: \"0000000000000001\"\nss \u003C\u003C std::setfill ('0') \u003C\u003C std::setw (16);\nss \u003C\u003C 1123;\nss.str(); // result is: \"0000000000001123\"\n",[2953],{"type":421,"tag":508,"props":2954,"children":2955},{"__ignoreMap":415},[2956,2977,3055,3075,3101,3172,3192],{"type":421,"tag":512,"props":2957,"children":2958},{"class":514,"line":515},[2959,2964,2968,2973],{"type":421,"tag":512,"props":2960,"children":2961},{"style":582},[2962],{"type":427,"value":2963},"std",{"type":421,"tag":512,"props":2965,"children":2966},{"style":567},[2967],{"type":427,"value":590},{"type":421,"tag":512,"props":2969,"children":2970},{"style":593},[2971],{"type":427,"value":2972},"stringstream ss",{"type":421,"tag":512,"props":2974,"children":2975},{"style":567},[2976],{"type":427,"value":601},{"type":421,"tag":512,"props":2978,"children":2979},{"class":514,"line":542},[2980,2985,2989,2994,2998,3003,3007,3012,3017,3021,3025,3029,3033,3037,3042,3046,3051],{"type":421,"tag":512,"props":2981,"children":2982},{"style":593},[2983],{"type":427,"value":2984},"ss ",{"type":421,"tag":512,"props":2986,"children":2987},{"style":691},[2988],{"type":427,"value":2631},{"type":421,"tag":512,"props":2990,"children":2991},{"style":582},[2992],{"type":427,"value":2993}," std",{"type":421,"tag":512,"props":2995,"children":2996},{"style":567},[2997],{"type":427,"value":590},{"type":421,"tag":512,"props":2999,"children":3000},{"style":561},[3001],{"type":427,"value":3002},"setfill",{"type":421,"tag":512,"props":3004,"children":3005},{"style":567},[3006],{"type":427,"value":728},{"type":421,"tag":512,"props":3008,"children":3009},{"style":525},[3010],{"type":427,"value":3011},"'",{"type":421,"tag":512,"props":3013,"children":3014},{"style":531},[3015],{"type":427,"value":3016},"0",{"type":421,"tag":512,"props":3018,"children":3019},{"style":525},[3020],{"type":427,"value":3011},{"type":421,"tag":512,"props":3022,"children":3023},{"style":567},[3024],{"type":427,"value":1216},{"type":421,"tag":512,"props":3026,"children":3027},{"style":691},[3028],{"type":427,"value":2649},{"type":421,"tag":512,"props":3030,"children":3031},{"style":582},[3032],{"type":427,"value":2993},{"type":421,"tag":512,"props":3034,"children":3035},{"style":567},[3036],{"type":427,"value":590},{"type":421,"tag":512,"props":3038,"children":3039},{"style":561},[3040],{"type":427,"value":3041},"setw",{"type":421,"tag":512,"props":3043,"children":3044},{"style":567},[3045],{"type":427,"value":728},{"type":421,"tag":512,"props":3047,"children":3048},{"style":853},[3049],{"type":427,"value":3050},"16",{"type":421,"tag":512,"props":3052,"children":3053},{"style":567},[3054],{"type":427,"value":679},{"type":421,"tag":512,"props":3056,"children":3057},{"class":514,"line":551},[3058,3062,3066,3071],{"type":421,"tag":512,"props":3059,"children":3060},{"style":593},[3061],{"type":427,"value":2984},{"type":421,"tag":512,"props":3063,"children":3064},{"style":691},[3065],{"type":427,"value":2631},{"type":421,"tag":512,"props":3067,"children":3068},{"style":853},[3069],{"type":427,"value":3070}," 1",{"type":421,"tag":512,"props":3072,"children":3073},{"style":567},[3074],{"type":427,"value":601},{"type":421,"tag":512,"props":3076,"children":3077},{"class":514,"line":578},[3078,3083,3087,3092,3096],{"type":421,"tag":512,"props":3079,"children":3080},{"style":593},[3081],{"type":427,"value":3082},"ss",{"type":421,"tag":512,"props":3084,"children":3085},{"style":567},[3086],{"type":427,"value":704},{"type":421,"tag":512,"props":3088,"children":3089},{"style":561},[3090],{"type":427,"value":3091},"str",{"type":421,"tag":512,"props":3093,"children":3094},{"style":567},[3095],{"type":427,"value":2008},{"type":421,"tag":512,"props":3097,"children":3098},{"style":1521},[3099],{"type":427,"value":3100}," // result is: \"0000000000000001\"\n",{"type":421,"tag":512,"props":3102,"children":3103},{"class":514,"line":604},[3104,3108,3112,3116,3120,3124,3128,3132,3136,3140,3144,3148,3152,3156,3160,3164,3168],{"type":421,"tag":512,"props":3105,"children":3106},{"style":593},[3107],{"type":427,"value":2984},{"type":421,"tag":512,"props":3109,"children":3110},{"style":691},[3111],{"type":427,"value":2631},{"type":421,"tag":512,"props":3113,"children":3114},{"style":582},[3115],{"type":427,"value":2993},{"type":421,"tag":512,"props":3117,"children":3118},{"style":567},[3119],{"type":427,"value":590},{"type":421,"tag":512,"props":3121,"children":3122},{"style":561},[3123],{"type":427,"value":3002},{"type":421,"tag":512,"props":3125,"children":3126},{"style":567},[3127],{"type":427,"value":728},{"type":421,"tag":512,"props":3129,"children":3130},{"style":525},[3131],{"type":427,"value":3011},{"type":421,"tag":512,"props":3133,"children":3134},{"style":531},[3135],{"type":427,"value":3016},{"type":421,"tag":512,"props":3137,"children":3138},{"style":525},[3139],{"type":427,"value":3011},{"type":421,"tag":512,"props":3141,"children":3142},{"style":567},[3143],{"type":427,"value":1216},{"type":421,"tag":512,"props":3145,"children":3146},{"style":691},[3147],{"type":427,"value":2649},{"type":421,"tag":512,"props":3149,"children":3150},{"style":582},[3151],{"type":427,"value":2993},{"type":421,"tag":512,"props":3153,"children":3154},{"style":567},[3155],{"type":427,"value":590},{"type":421,"tag":512,"props":3157,"children":3158},{"style":561},[3159],{"type":427,"value":3041},{"type":421,"tag":512,"props":3161,"children":3162},{"style":567},[3163],{"type":427,"value":728},{"type":421,"tag":512,"props":3165,"children":3166},{"style":853},[3167],{"type":427,"value":3050},{"type":421,"tag":512,"props":3169,"children":3170},{"style":567},[3171],{"type":427,"value":679},{"type":421,"tag":512,"props":3173,"children":3174},{"class":514,"line":625},[3175,3179,3183,3188],{"type":421,"tag":512,"props":3176,"children":3177},{"style":593},[3178],{"type":427,"value":2984},{"type":421,"tag":512,"props":3180,"children":3181},{"style":691},[3182],{"type":427,"value":2631},{"type":421,"tag":512,"props":3184,"children":3185},{"style":853},[3186],{"type":427,"value":3187}," 1123",{"type":421,"tag":512,"props":3189,"children":3190},{"style":567},[3191],{"type":427,"value":601},{"type":421,"tag":512,"props":3193,"children":3194},{"class":514,"line":682},[3195,3199,3203,3207,3211],{"type":421,"tag":512,"props":3196,"children":3197},{"style":593},[3198],{"type":427,"value":3082},{"type":421,"tag":512,"props":3200,"children":3201},{"style":567},[3202],{"type":427,"value":704},{"type":421,"tag":512,"props":3204,"children":3205},{"style":561},[3206],{"type":427,"value":3091},{"type":421,"tag":512,"props":3208,"children":3209},{"style":567},[3210],{"type":427,"value":2008},{"type":421,"tag":512,"props":3212,"children":3213},{"style":1521},[3214],{"type":427,"value":3215}," // result is: \"0000000000001123\"\n",{"type":421,"tag":1388,"props":3217,"children":3219},{"id":3218},"c-风格的随机数",[3220],{"type":427,"value":3221},"C++ 风格的随机数",{"type":421,"tag":435,"props":3223,"children":3224},{},[3225],{"type":427,"value":3226},"一个有意思的地方时，KDB 代码中随处可见 C 编程风格的源码。但是测试用例中生成随机数确实 C++ 风格的。",{"type":421,"tag":501,"props":3228,"children":3230},{"code":3229,"language":504,"meta":415,"className":505,"style":415},"std::mt19937 generator = std::mt19937();\nstd::uniform_int_distribution\u003Cint> random_dist(0,255);\n// ...\nfor (int i = 0; i \u003C size; i++) {\n  str[i] = static_cast\u003Cchar>(random_dist(generator));\n}\n",[3231],{"type":421,"tag":508,"props":3232,"children":3233},{"__ignoreMap":415},[3234,3271,3326,3334,3402,3465],{"type":421,"tag":512,"props":3235,"children":3236},{"class":514,"line":515},[3237,3241,3245,3250,3254,3258,3262,3267],{"type":421,"tag":512,"props":3238,"children":3239},{"style":582},[3240],{"type":427,"value":2963},{"type":421,"tag":512,"props":3242,"children":3243},{"style":567},[3244],{"type":427,"value":590},{"type":421,"tag":512,"props":3246,"children":3247},{"style":593},[3248],{"type":427,"value":3249},"mt19937 generator ",{"type":421,"tag":512,"props":3251,"children":3252},{"style":691},[3253],{"type":427,"value":694},{"type":421,"tag":512,"props":3255,"children":3256},{"style":582},[3257],{"type":427,"value":2993},{"type":421,"tag":512,"props":3259,"children":3260},{"style":567},[3261],{"type":427,"value":590},{"type":421,"tag":512,"props":3263,"children":3264},{"style":561},[3265],{"type":427,"value":3266},"mt19937",{"type":421,"tag":512,"props":3268,"children":3269},{"style":567},[3270],{"type":427,"value":714},{"type":421,"tag":512,"props":3272,"children":3273},{"class":514,"line":542},[3274,3278,3282,3287,3292,3296,3300,3305,3309,3313,3317,3322],{"type":421,"tag":512,"props":3275,"children":3276},{"style":582},[3277],{"type":427,"value":2963},{"type":421,"tag":512,"props":3279,"children":3280},{"style":567},[3281],{"type":427,"value":590},{"type":421,"tag":512,"props":3283,"children":3284},{"style":582},[3285],{"type":427,"value":3286},"uniform_int_distribution",{"type":421,"tag":512,"props":3288,"children":3289},{"style":567},[3290],{"type":427,"value":3291},"\u003C",{"type":421,"tag":512,"props":3293,"children":3294},{"style":555},[3295],{"type":427,"value":558},{"type":421,"tag":512,"props":3297,"children":3298},{"style":567},[3299],{"type":427,"value":2499},{"type":421,"tag":512,"props":3301,"children":3302},{"style":561},[3303],{"type":427,"value":3304}," random_dist",{"type":421,"tag":512,"props":3306,"children":3307},{"style":567},[3308],{"type":427,"value":649},{"type":421,"tag":512,"props":3310,"children":3311},{"style":853},[3312],{"type":427,"value":3016},{"type":421,"tag":512,"props":3314,"children":3315},{"style":567},[3316],{"type":427,"value":659},{"type":421,"tag":512,"props":3318,"children":3319},{"style":853},[3320],{"type":427,"value":3321},"255",{"type":421,"tag":512,"props":3323,"children":3324},{"style":567},[3325],{"type":427,"value":679},{"type":421,"tag":512,"props":3327,"children":3328},{"class":514,"line":551},[3329],{"type":421,"tag":512,"props":3330,"children":3331},{"style":1521},[3332],{"type":427,"value":3333},"// ...\n",{"type":421,"tag":512,"props":3335,"children":3336},{"class":514,"line":578},[3337,3342,3346,3350,3355,3359,3363,3367,3371,3375,3380,3384,3389,3394,3398],{"type":421,"tag":512,"props":3338,"children":3339},{"style":519},[3340],{"type":427,"value":3341},"for",{"type":421,"tag":512,"props":3343,"children":3344},{"style":567},[3345],{"type":427,"value":728},{"type":421,"tag":512,"props":3347,"children":3348},{"style":555},[3349],{"type":427,"value":558},{"type":421,"tag":512,"props":3351,"children":3352},{"style":593},[3353],{"type":427,"value":3354}," i ",{"type":421,"tag":512,"props":3356,"children":3357},{"style":691},[3358],{"type":427,"value":694},{"type":421,"tag":512,"props":3360,"children":3361},{"style":853},[3362],{"type":427,"value":1345},{"type":421,"tag":512,"props":3364,"children":3365},{"style":567},[3366],{"type":427,"value":2084},{"type":421,"tag":512,"props":3368,"children":3369},{"style":593},[3370],{"type":427,"value":3354},{"type":421,"tag":512,"props":3372,"children":3373},{"style":691},[3374],{"type":427,"value":3291},{"type":421,"tag":512,"props":3376,"children":3377},{"style":593},[3378],{"type":427,"value":3379}," size",{"type":421,"tag":512,"props":3381,"children":3382},{"style":567},[3383],{"type":427,"value":2084},{"type":421,"tag":512,"props":3385,"children":3386},{"style":593},[3387],{"type":427,"value":3388}," i",{"type":421,"tag":512,"props":3390,"children":3391},{"style":691},[3392],{"type":427,"value":3393},"++",{"type":421,"tag":512,"props":3395,"children":3396},{"style":567},[3397],{"type":427,"value":1216},{"type":421,"tag":512,"props":3399,"children":3400},{"style":567},[3401],{"type":427,"value":575},{"type":421,"tag":512,"props":3403,"children":3404},{"class":514,"line":604},[3405,3410,3414,3419,3424,3428,3433,3438,3442,3446,3451,3455,3460],{"type":421,"tag":512,"props":3406,"children":3407},{"style":593},[3408],{"type":427,"value":3409},"  str",{"type":421,"tag":512,"props":3411,"children":3412},{"style":567},[3413],{"type":427,"value":1488},{"type":421,"tag":512,"props":3415,"children":3416},{"style":772},[3417],{"type":427,"value":3418},"i",{"type":421,"tag":512,"props":3420,"children":3421},{"style":567},[3422],{"type":427,"value":3423},"]",{"type":421,"tag":512,"props":3425,"children":3426},{"style":691},[3427],{"type":427,"value":2178},{"type":421,"tag":512,"props":3429,"children":3430},{"style":691},[3431],{"type":427,"value":3432}," static_cast\u003C",{"type":421,"tag":512,"props":3434,"children":3435},{"style":555},[3436],{"type":427,"value":3437},"char",{"type":421,"tag":512,"props":3439,"children":3440},{"style":691},[3441],{"type":427,"value":2499},{"type":421,"tag":512,"props":3443,"children":3444},{"style":567},[3445],{"type":427,"value":649},{"type":421,"tag":512,"props":3447,"children":3448},{"style":561},[3449],{"type":427,"value":3450},"random_dist",{"type":421,"tag":512,"props":3452,"children":3453},{"style":567},[3454],{"type":427,"value":649},{"type":421,"tag":512,"props":3456,"children":3457},{"style":772},[3458],{"type":427,"value":3459},"generator",{"type":421,"tag":512,"props":3461,"children":3462},{"style":567},[3463],{"type":427,"value":3464},"));\n",{"type":421,"tag":512,"props":3466,"children":3467},{"class":514,"line":625},[3468],{"type":421,"tag":512,"props":3469,"children":3470},{"style":567},[3471],{"type":427,"value":1358},{"type":421,"tag":429,"props":3473,"children":3475},{"id":3474},"接口层",[3476],{"type":427,"value":3474},{"type":421,"tag":435,"props":3478,"children":3479},{},[3480,3482,3488],{"type":427,"value":3481},"接口的声明位于 interface/kingdb.h，实现则是 interface/kingdb.cc。KingDB 类给 Database 和 Snapshot 定义了要求实现的 Get、Put、Delete、NewIterater、Open、Close、Flush、Compact、NewMultipartReader 接口。KDB 有自己的数据传输格式 ByteArray，诸如 Get、Put 这些接口在 KingDB 类中对应方法得到了重载，以实现通过 std::string 来传递键、值或者两者，可视为为接受 ByteArray 的方法的包装。所有数据库操作方法都返回 Status 对象，相关异常部分的简介见",{"type":421,"tag":446,"props":3483,"children":3485},{"href":3484},"#%E5%BC%82%E5%B8%B8%E4%B8%8E%E6%97%A5%E5%BF%97",[3486],{"type":427,"value":3487},"异常与日志",{"type":427,"value":3489},"小节。",{"type":421,"tag":435,"props":3491,"children":3492},{},[3493],{"type":427,"value":3494},"重载方法的实现示例如下，即先把 std::string 转回 ByteArray 再调用子类（Database 或 Snapshot）的实现。",{"type":421,"tag":501,"props":3496,"children":3498},{"code":3497,"language":504,"meta":415,"className":505,"style":415},"virtual Status Put(WriteOptions& write_options, const std::string& key, const std::string& chunk) {\n  ByteArray byte_array_key = NewDeepCopyByteArray(key.c_str(), key.size());\n  ByteArray byte_array_chunk = NewDeepCopyByteArray(chunk.c_str(), chunk.size());\n  return Put(write_options, byte_array_key, byte_array_chunk);\n}\n",[3499],{"type":421,"tag":508,"props":3500,"children":3501},{"__ignoreMap":415},[3502,3605,3661,3714,3755],{"type":421,"tag":512,"props":3503,"children":3504},{"class":514,"line":515},[3505,3510,3515,3520,3524,3529,3533,3538,3542,3546,3550,3554,3559,3563,3568,3572,3576,3580,3584,3588,3592,3597,3601],{"type":421,"tag":512,"props":3506,"children":3507},{"style":2019},[3508],{"type":427,"value":3509},"virtual",{"type":421,"tag":512,"props":3511,"children":3512},{"style":582},[3513],{"type":427,"value":3514}," Status",{"type":421,"tag":512,"props":3516,"children":3517},{"style":561},[3518],{"type":427,"value":3519}," Put",{"type":421,"tag":512,"props":3521,"children":3522},{"style":567},[3523],{"type":427,"value":649},{"type":421,"tag":512,"props":3525,"children":3526},{"style":582},[3527],{"type":427,"value":3528},"WriteOptions",{"type":421,"tag":512,"props":3530,"children":3531},{"style":2019},[3532],{"type":427,"value":2517},{"type":421,"tag":512,"props":3534,"children":3535},{"style":1428},[3536],{"type":427,"value":3537}," write_options",{"type":421,"tag":512,"props":3539,"children":3540},{"style":567},[3541],{"type":427,"value":659},{"type":421,"tag":512,"props":3543,"children":3544},{"style":2019},[3545],{"type":427,"value":2553},{"type":421,"tag":512,"props":3547,"children":3548},{"style":582},[3549],{"type":427,"value":2993},{"type":421,"tag":512,"props":3551,"children":3552},{"style":567},[3553],{"type":427,"value":590},{"type":421,"tag":512,"props":3555,"children":3556},{"style":582},[3557],{"type":427,"value":3558},"string",{"type":421,"tag":512,"props":3560,"children":3561},{"style":2019},[3562],{"type":427,"value":2517},{"type":421,"tag":512,"props":3564,"children":3565},{"style":1428},[3566],{"type":427,"value":3567}," key",{"type":421,"tag":512,"props":3569,"children":3570},{"style":567},[3571],{"type":427,"value":659},{"type":421,"tag":512,"props":3573,"children":3574},{"style":2019},[3575],{"type":427,"value":2553},{"type":421,"tag":512,"props":3577,"children":3578},{"style":582},[3579],{"type":427,"value":2993},{"type":421,"tag":512,"props":3581,"children":3582},{"style":567},[3583],{"type":427,"value":590},{"type":421,"tag":512,"props":3585,"children":3586},{"style":582},[3587],{"type":427,"value":3558},{"type":421,"tag":512,"props":3589,"children":3590},{"style":2019},[3591],{"type":427,"value":2517},{"type":421,"tag":512,"props":3593,"children":3594},{"style":1428},[3595],{"type":427,"value":3596}," chunk",{"type":421,"tag":512,"props":3598,"children":3599},{"style":567},[3600],{"type":427,"value":1216},{"type":421,"tag":512,"props":3602,"children":3603},{"style":567},[3604],{"type":427,"value":575},{"type":421,"tag":512,"props":3606,"children":3607},{"class":514,"line":542},[3608,3613,3617,3622,3626,3631,3635,3639,3644,3648,3652,3657],{"type":421,"tag":512,"props":3609,"children":3610},{"style":593},[3611],{"type":427,"value":3612},"  ByteArray byte_array_key ",{"type":421,"tag":512,"props":3614,"children":3615},{"style":691},[3616],{"type":427,"value":694},{"type":421,"tag":512,"props":3618,"children":3619},{"style":561},[3620],{"type":427,"value":3621}," NewDeepCopyByteArray",{"type":421,"tag":512,"props":3623,"children":3624},{"style":567},[3625],{"type":427,"value":649},{"type":421,"tag":512,"props":3627,"children":3628},{"style":593},[3629],{"type":427,"value":3630},"key",{"type":421,"tag":512,"props":3632,"children":3633},{"style":567},[3634],{"type":427,"value":704},{"type":421,"tag":512,"props":3636,"children":3637},{"style":561},[3638],{"type":427,"value":832},{"type":421,"tag":512,"props":3640,"children":3641},{"style":567},[3642],{"type":427,"value":3643},"(),",{"type":421,"tag":512,"props":3645,"children":3646},{"style":593},[3647],{"type":427,"value":3567},{"type":421,"tag":512,"props":3649,"children":3650},{"style":567},[3651],{"type":427,"value":704},{"type":421,"tag":512,"props":3653,"children":3654},{"style":561},[3655],{"type":427,"value":3656},"size",{"type":421,"tag":512,"props":3658,"children":3659},{"style":567},[3660],{"type":427,"value":837},{"type":421,"tag":512,"props":3662,"children":3663},{"class":514,"line":551},[3664,3669,3673,3677,3681,3686,3690,3694,3698,3702,3706,3710],{"type":421,"tag":512,"props":3665,"children":3666},{"style":593},[3667],{"type":427,"value":3668},"  ByteArray byte_array_chunk ",{"type":421,"tag":512,"props":3670,"children":3671},{"style":691},[3672],{"type":427,"value":694},{"type":421,"tag":512,"props":3674,"children":3675},{"style":561},[3676],{"type":427,"value":3621},{"type":421,"tag":512,"props":3678,"children":3679},{"style":567},[3680],{"type":427,"value":649},{"type":421,"tag":512,"props":3682,"children":3683},{"style":593},[3684],{"type":427,"value":3685},"chunk",{"type":421,"tag":512,"props":3687,"children":3688},{"style":567},[3689],{"type":427,"value":704},{"type":421,"tag":512,"props":3691,"children":3692},{"style":561},[3693],{"type":427,"value":832},{"type":421,"tag":512,"props":3695,"children":3696},{"style":567},[3697],{"type":427,"value":3643},{"type":421,"tag":512,"props":3699,"children":3700},{"style":593},[3701],{"type":427,"value":3596},{"type":421,"tag":512,"props":3703,"children":3704},{"style":567},[3705],{"type":427,"value":704},{"type":421,"tag":512,"props":3707,"children":3708},{"style":561},[3709],{"type":427,"value":3656},{"type":421,"tag":512,"props":3711,"children":3712},{"style":567},[3713],{"type":427,"value":837},{"type":421,"tag":512,"props":3715,"children":3716},{"class":514,"line":578},[3717,3721,3725,3729,3733,3737,3742,3746,3751],{"type":421,"tag":512,"props":3718,"children":3719},{"style":519},[3720],{"type":427,"value":1340},{"type":421,"tag":512,"props":3722,"children":3723},{"style":561},[3724],{"type":427,"value":3519},{"type":421,"tag":512,"props":3726,"children":3727},{"style":567},[3728],{"type":427,"value":649},{"type":421,"tag":512,"props":3730,"children":3731},{"style":593},[3732],{"type":427,"value":1024},{"type":421,"tag":512,"props":3734,"children":3735},{"style":567},[3736],{"type":427,"value":659},{"type":421,"tag":512,"props":3738,"children":3739},{"style":593},[3740],{"type":427,"value":3741}," byte_array_key",{"type":421,"tag":512,"props":3743,"children":3744},{"style":567},[3745],{"type":427,"value":659},{"type":421,"tag":512,"props":3747,"children":3748},{"style":593},[3749],{"type":427,"value":3750}," byte_array_chunk",{"type":421,"tag":512,"props":3752,"children":3753},{"style":567},[3754],{"type":427,"value":679},{"type":421,"tag":512,"props":3756,"children":3757},{"class":514,"line":604},[3758],{"type":421,"tag":512,"props":3759,"children":3760},{"style":567},[3761],{"type":427,"value":1358},{"type":421,"tag":1388,"props":3763,"children":3765},{"id":3764},"数据库开关",[3766],{"type":427,"value":3764},{"type":421,"tag":435,"props":3768,"children":3769},{},[3770],{"type":427,"value":3771},"数据库的开启与关闭，分别对应 Database 类的 Open 和 Close 方法。开启时，通过 stat 库函数找到数据库路径以及配置文件，使用 open 库函数获取其文件描述符。配置文件须先用 flock 锁住，使用 mmap 映射后再读取；如果没有那么分情况写入。之后，创建好 EventManager、WriteBuffer 和 StorageEngine 的实例，就完成了。关闭时过程类似，锁定住配置文件后再关闭，同时删除以上创建的实例。可以发现，资源申请全放在了 Open 中，而资源的销毁放在了 Close 中，而 Database 类析构时会自动调用 Close，所以这是一个类似 RAII 的资源管理过程。",{"type":421,"tag":501,"props":3773,"children":3775},{"code":3774,"language":504,"meta":415,"className":505,"style":415},"class Database: public KingDB {\n  virtual ~Database() { Close(); }\n  virtual Status Open() override {\n    std::string filepath_dboptions = DatabaseOptions::GetPath(dbname_);\n    fd_dboptions_ = open(filepath_dboptions.c_str(), O_RDONLY, 0644);\n    flock(fd_dboptions_, LOCK_EX | LOCK_NB);\n    Mmap mmap(filepath_dboptions, info.st_size);\n    Status status_dboptions = DatabaseOptionEncoder::DecodeFrom(mmap.datafile(), mmap.filesize(), &db_options_candidate);\n    // ...\n    em_ = new EventManager();\n    wb_ = new WriteBuffer(db_options_, em_);\n    se_ = new StorageEngine(db_options_, em_, dbname_);\n    return Status::OK(); \n  }\n  virtual void Close() override {\n    flock(fd_dboptions_, LOCK_UN);\n    close(fd_dboptions_);\n    wb_->Close();\n    se_->Close();\n    delete wb_;\n    delete se_;\n    delete em_;\n  }\n}\n",[3776],{"type":421,"tag":508,"props":3777,"children":3778},{"__ignoreMap":415},[3779,3808,3843,3872,3920,3981,4021,4064,4142,4150,4176,4219,4269,4297,4304,4331,4359,4379,4401,4421,4438,4454,4469,4476],{"type":421,"tag":512,"props":3780,"children":3781},{"class":514,"line":515},[3782,3786,3791,3795,3799,3804],{"type":421,"tag":512,"props":3783,"children":3784},{"style":555},[3785],{"type":427,"value":1932},{"type":421,"tag":512,"props":3787,"children":3788},{"style":582},[3789],{"type":427,"value":3790}," Database",{"type":421,"tag":512,"props":3792,"children":3793},{"style":567},[3794],{"type":427,"value":1617},{"type":421,"tag":512,"props":3796,"children":3797},{"style":555},[3798],{"type":427,"value":1981},{"type":421,"tag":512,"props":3800,"children":3801},{"style":582},[3802],{"type":427,"value":3803}," KingDB",{"type":421,"tag":512,"props":3805,"children":3806},{"style":567},[3807],{"type":427,"value":575},{"type":421,"tag":512,"props":3809,"children":3810},{"class":514,"line":542},[3811,3816,3821,3825,3829,3834,3838],{"type":421,"tag":512,"props":3812,"children":3813},{"style":2019},[3814],{"type":427,"value":3815},"  virtual",{"type":421,"tag":512,"props":3817,"children":3818},{"style":561},[3819],{"type":427,"value":3820}," ~Database",{"type":421,"tag":512,"props":3822,"children":3823},{"style":567},[3824],{"type":427,"value":570},{"type":421,"tag":512,"props":3826,"children":3827},{"style":567},[3828],{"type":427,"value":2041},{"type":421,"tag":512,"props":3830,"children":3831},{"style":561},[3832],{"type":427,"value":3833}," Close",{"type":421,"tag":512,"props":3835,"children":3836},{"style":567},[3837],{"type":427,"value":2008},{"type":421,"tag":512,"props":3839,"children":3840},{"style":567},[3841],{"type":427,"value":3842}," }\n",{"type":421,"tag":512,"props":3844,"children":3845},{"class":514,"line":551},[3846,3850,3854,3859,3863,3868],{"type":421,"tag":512,"props":3847,"children":3848},{"style":2019},[3849],{"type":427,"value":3815},{"type":421,"tag":512,"props":3851,"children":3852},{"style":582},[3853],{"type":427,"value":3514},{"type":421,"tag":512,"props":3855,"children":3856},{"style":561},[3857],{"type":427,"value":3858}," Open",{"type":421,"tag":512,"props":3860,"children":3861},{"style":567},[3862],{"type":427,"value":570},{"type":421,"tag":512,"props":3864,"children":3865},{"style":2019},[3866],{"type":427,"value":3867}," override",{"type":421,"tag":512,"props":3869,"children":3870},{"style":567},[3871],{"type":427,"value":575},{"type":421,"tag":512,"props":3873,"children":3874},{"class":514,"line":578},[3875,3880,3884,3889,3893,3898,3902,3907,3911,3916],{"type":421,"tag":512,"props":3876,"children":3877},{"style":582},[3878],{"type":427,"value":3879},"    std",{"type":421,"tag":512,"props":3881,"children":3882},{"style":567},[3883],{"type":427,"value":590},{"type":421,"tag":512,"props":3885,"children":3886},{"style":772},[3887],{"type":427,"value":3888},"string filepath_dboptions ",{"type":421,"tag":512,"props":3890,"children":3891},{"style":691},[3892],{"type":427,"value":694},{"type":421,"tag":512,"props":3894,"children":3895},{"style":582},[3896],{"type":427,"value":3897}," DatabaseOptions",{"type":421,"tag":512,"props":3899,"children":3900},{"style":567},[3901],{"type":427,"value":590},{"type":421,"tag":512,"props":3903,"children":3904},{"style":561},[3905],{"type":427,"value":3906},"GetPath",{"type":421,"tag":512,"props":3908,"children":3909},{"style":567},[3910],{"type":427,"value":649},{"type":421,"tag":512,"props":3912,"children":3913},{"style":772},[3914],{"type":427,"value":3915},"dbname_",{"type":421,"tag":512,"props":3917,"children":3918},{"style":567},[3919],{"type":427,"value":679},{"type":421,"tag":512,"props":3921,"children":3922},{"class":514,"line":604},[3923,3928,3932,3937,3941,3946,3950,3954,3958,3963,3967,3972,3977],{"type":421,"tag":512,"props":3924,"children":3925},{"style":772},[3926],{"type":427,"value":3927},"    fd_dboptions_ ",{"type":421,"tag":512,"props":3929,"children":3930},{"style":691},[3931],{"type":427,"value":694},{"type":421,"tag":512,"props":3933,"children":3934},{"style":561},[3935],{"type":427,"value":3936}," open",{"type":421,"tag":512,"props":3938,"children":3939},{"style":567},[3940],{"type":427,"value":649},{"type":421,"tag":512,"props":3942,"children":3943},{"style":593},[3944],{"type":427,"value":3945},"filepath_dboptions",{"type":421,"tag":512,"props":3947,"children":3948},{"style":567},[3949],{"type":427,"value":704},{"type":421,"tag":512,"props":3951,"children":3952},{"style":561},[3953],{"type":427,"value":832},{"type":421,"tag":512,"props":3955,"children":3956},{"style":567},[3957],{"type":427,"value":3643},{"type":421,"tag":512,"props":3959,"children":3960},{"style":772},[3961],{"type":427,"value":3962}," O_RDONLY",{"type":421,"tag":512,"props":3964,"children":3965},{"style":567},[3966],{"type":427,"value":659},{"type":421,"tag":512,"props":3968,"children":3970},{"style":3969},"--shiki-light:#F76D47;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[3971],{"type":427,"value":1345},{"type":421,"tag":512,"props":3973,"children":3974},{"style":853},[3975],{"type":427,"value":3976},"644",{"type":421,"tag":512,"props":3978,"children":3979},{"style":567},[3980],{"type":427,"value":679},{"type":421,"tag":512,"props":3982,"children":3983},{"class":514,"line":625},[3984,3989,3993,3998,4002,4007,4012,4017],{"type":421,"tag":512,"props":3985,"children":3986},{"style":561},[3987],{"type":427,"value":3988},"    flock",{"type":421,"tag":512,"props":3990,"children":3991},{"style":567},[3992],{"type":427,"value":649},{"type":421,"tag":512,"props":3994,"children":3995},{"style":772},[3996],{"type":427,"value":3997},"fd_dboptions_",{"type":421,"tag":512,"props":3999,"children":4000},{"style":567},[4001],{"type":427,"value":659},{"type":421,"tag":512,"props":4003,"children":4004},{"style":772},[4005],{"type":427,"value":4006}," LOCK_EX ",{"type":421,"tag":512,"props":4008,"children":4009},{"style":691},[4010],{"type":427,"value":4011},"|",{"type":421,"tag":512,"props":4013,"children":4014},{"style":772},[4015],{"type":427,"value":4016}," LOCK_NB",{"type":421,"tag":512,"props":4018,"children":4019},{"style":567},[4020],{"type":427,"value":679},{"type":421,"tag":512,"props":4022,"children":4023},{"class":514,"line":682},[4024,4029,4034,4038,4042,4046,4051,4055,4060],{"type":421,"tag":512,"props":4025,"children":4026},{"style":772},[4027],{"type":427,"value":4028},"    Mmap ",{"type":421,"tag":512,"props":4030,"children":4031},{"style":561},[4032],{"type":427,"value":4033},"mmap",{"type":421,"tag":512,"props":4035,"children":4036},{"style":567},[4037],{"type":427,"value":649},{"type":421,"tag":512,"props":4039,"children":4040},{"style":772},[4041],{"type":427,"value":3945},{"type":421,"tag":512,"props":4043,"children":4044},{"style":567},[4045],{"type":427,"value":659},{"type":421,"tag":512,"props":4047,"children":4048},{"style":593},[4049],{"type":427,"value":4050}," info",{"type":421,"tag":512,"props":4052,"children":4053},{"style":567},[4054],{"type":427,"value":704},{"type":421,"tag":512,"props":4056,"children":4057},{"style":593},[4058],{"type":427,"value":4059},"st_size",{"type":421,"tag":512,"props":4061,"children":4062},{"style":567},[4063],{"type":427,"value":679},{"type":421,"tag":512,"props":4065,"children":4066},{"class":514,"line":717},[4067,4072,4076,4081,4085,4090,4094,4098,4102,4107,4111,4116,4120,4125,4129,4133,4138],{"type":421,"tag":512,"props":4068,"children":4069},{"style":772},[4070],{"type":427,"value":4071},"    Status status_dboptions ",{"type":421,"tag":512,"props":4073,"children":4074},{"style":691},[4075],{"type":427,"value":694},{"type":421,"tag":512,"props":4077,"children":4078},{"style":582},[4079],{"type":427,"value":4080}," DatabaseOptionEncoder",{"type":421,"tag":512,"props":4082,"children":4083},{"style":567},[4084],{"type":427,"value":590},{"type":421,"tag":512,"props":4086,"children":4087},{"style":561},[4088],{"type":427,"value":4089},"DecodeFrom",{"type":421,"tag":512,"props":4091,"children":4092},{"style":567},[4093],{"type":427,"value":649},{"type":421,"tag":512,"props":4095,"children":4096},{"style":593},[4097],{"type":427,"value":4033},{"type":421,"tag":512,"props":4099,"children":4100},{"style":567},[4101],{"type":427,"value":704},{"type":421,"tag":512,"props":4103,"children":4104},{"style":561},[4105],{"type":427,"value":4106},"datafile",{"type":421,"tag":512,"props":4108,"children":4109},{"style":567},[4110],{"type":427,"value":3643},{"type":421,"tag":512,"props":4112,"children":4113},{"style":593},[4114],{"type":427,"value":4115}," mmap",{"type":421,"tag":512,"props":4117,"children":4118},{"style":567},[4119],{"type":427,"value":704},{"type":421,"tag":512,"props":4121,"children":4122},{"style":561},[4123],{"type":427,"value":4124},"filesize",{"type":421,"tag":512,"props":4126,"children":4127},{"style":567},[4128],{"type":427,"value":3643},{"type":421,"tag":512,"props":4130,"children":4131},{"style":691},[4132],{"type":427,"value":1147},{"type":421,"tag":512,"props":4134,"children":4135},{"style":772},[4136],{"type":427,"value":4137},"db_options_candidate",{"type":421,"tag":512,"props":4139,"children":4140},{"style":567},[4141],{"type":427,"value":679},{"type":421,"tag":512,"props":4143,"children":4144},{"class":514,"line":759},[4145],{"type":421,"tag":512,"props":4146,"children":4147},{"style":1521},[4148],{"type":427,"value":4149},"    // ...\n",{"type":421,"tag":512,"props":4151,"children":4152},{"class":514,"line":840},[4153,4158,4162,4167,4172],{"type":421,"tag":512,"props":4154,"children":4155},{"style":772},[4156],{"type":427,"value":4157},"    em_ ",{"type":421,"tag":512,"props":4159,"children":4160},{"style":691},[4161],{"type":427,"value":694},{"type":421,"tag":512,"props":4163,"children":4164},{"style":691},[4165],{"type":427,"value":4166}," new",{"type":421,"tag":512,"props":4168,"children":4169},{"style":561},[4170],{"type":427,"value":4171}," EventManager",{"type":421,"tag":512,"props":4173,"children":4174},{"style":567},[4175],{"type":427,"value":714},{"type":421,"tag":512,"props":4177,"children":4178},{"class":514,"line":863},[4179,4184,4188,4192,4197,4201,4206,4210,4215],{"type":421,"tag":512,"props":4180,"children":4181},{"style":772},[4182],{"type":427,"value":4183},"    wb_ ",{"type":421,"tag":512,"props":4185,"children":4186},{"style":691},[4187],{"type":427,"value":694},{"type":421,"tag":512,"props":4189,"children":4190},{"style":691},[4191],{"type":427,"value":4166},{"type":421,"tag":512,"props":4193,"children":4194},{"style":561},[4195],{"type":427,"value":4196}," WriteBuffer",{"type":421,"tag":512,"props":4198,"children":4199},{"style":567},[4200],{"type":427,"value":649},{"type":421,"tag":512,"props":4202,"children":4203},{"style":772},[4204],{"type":427,"value":4205},"db_options_",{"type":421,"tag":512,"props":4207,"children":4208},{"style":567},[4209],{"type":427,"value":659},{"type":421,"tag":512,"props":4211,"children":4212},{"style":772},[4213],{"type":427,"value":4214}," em_",{"type":421,"tag":512,"props":4216,"children":4217},{"style":567},[4218],{"type":427,"value":679},{"type":421,"tag":512,"props":4220,"children":4221},{"class":514,"line":872},[4222,4227,4231,4235,4240,4244,4248,4252,4256,4260,4265],{"type":421,"tag":512,"props":4223,"children":4224},{"style":772},[4225],{"type":427,"value":4226},"    se_ ",{"type":421,"tag":512,"props":4228,"children":4229},{"style":691},[4230],{"type":427,"value":694},{"type":421,"tag":512,"props":4232,"children":4233},{"style":691},[4234],{"type":427,"value":4166},{"type":421,"tag":512,"props":4236,"children":4237},{"style":561},[4238],{"type":427,"value":4239}," StorageEngine",{"type":421,"tag":512,"props":4241,"children":4242},{"style":567},[4243],{"type":427,"value":649},{"type":421,"tag":512,"props":4245,"children":4246},{"style":772},[4247],{"type":427,"value":4205},{"type":421,"tag":512,"props":4249,"children":4250},{"style":567},[4251],{"type":427,"value":659},{"type":421,"tag":512,"props":4253,"children":4254},{"style":772},[4255],{"type":427,"value":4214},{"type":421,"tag":512,"props":4257,"children":4258},{"style":567},[4259],{"type":427,"value":659},{"type":421,"tag":512,"props":4261,"children":4262},{"style":772},[4263],{"type":427,"value":4264}," dbname_",{"type":421,"tag":512,"props":4266,"children":4267},{"style":567},[4268],{"type":427,"value":679},{"type":421,"tag":512,"props":4270,"children":4271},{"class":514,"line":880},[4272,4276,4280,4284,4289,4293],{"type":421,"tag":512,"props":4273,"children":4274},{"style":519},[4275],{"type":427,"value":2752},{"type":421,"tag":512,"props":4277,"children":4278},{"style":582},[4279],{"type":427,"value":3514},{"type":421,"tag":512,"props":4281,"children":4282},{"style":567},[4283],{"type":427,"value":590},{"type":421,"tag":512,"props":4285,"children":4286},{"style":561},[4287],{"type":427,"value":4288},"OK",{"type":421,"tag":512,"props":4290,"children":4291},{"style":567},[4292],{"type":427,"value":2008},{"type":421,"tag":512,"props":4294,"children":4295},{"style":772},[4296],{"type":427,"value":1260},{"type":421,"tag":512,"props":4298,"children":4299},{"class":514,"line":923},[4300],{"type":421,"tag":512,"props":4301,"children":4302},{"style":567},[4303],{"type":427,"value":869},{"type":421,"tag":512,"props":4305,"children":4306},{"class":514,"line":964},[4307,4311,4315,4319,4323,4327],{"type":421,"tag":512,"props":4308,"children":4309},{"style":2019},[4310],{"type":427,"value":3815},{"type":421,"tag":512,"props":4312,"children":4313},{"style":555},[4314],{"type":427,"value":2027},{"type":421,"tag":512,"props":4316,"children":4317},{"style":561},[4318],{"type":427,"value":3833},{"type":421,"tag":512,"props":4320,"children":4321},{"style":567},[4322],{"type":427,"value":570},{"type":421,"tag":512,"props":4324,"children":4325},{"style":2019},[4326],{"type":427,"value":3867},{"type":421,"tag":512,"props":4328,"children":4329},{"style":567},[4330],{"type":427,"value":575},{"type":421,"tag":512,"props":4332,"children":4333},{"class":514,"line":972},[4334,4338,4342,4346,4350,4355],{"type":421,"tag":512,"props":4335,"children":4336},{"style":561},[4337],{"type":427,"value":3988},{"type":421,"tag":512,"props":4339,"children":4340},{"style":567},[4341],{"type":427,"value":649},{"type":421,"tag":512,"props":4343,"children":4344},{"style":772},[4345],{"type":427,"value":3997},{"type":421,"tag":512,"props":4347,"children":4348},{"style":567},[4349],{"type":427,"value":659},{"type":421,"tag":512,"props":4351,"children":4352},{"style":772},[4353],{"type":427,"value":4354}," LOCK_UN",{"type":421,"tag":512,"props":4356,"children":4357},{"style":567},[4358],{"type":427,"value":679},{"type":421,"tag":512,"props":4360,"children":4361},{"class":514,"line":993},[4362,4367,4371,4375],{"type":421,"tag":512,"props":4363,"children":4364},{"style":561},[4365],{"type":427,"value":4366},"    close",{"type":421,"tag":512,"props":4368,"children":4369},{"style":567},[4370],{"type":427,"value":649},{"type":421,"tag":512,"props":4372,"children":4373},{"style":772},[4374],{"type":427,"value":3997},{"type":421,"tag":512,"props":4376,"children":4377},{"style":567},[4378],{"type":427,"value":679},{"type":421,"tag":512,"props":4380,"children":4381},{"class":514,"line":1049},[4382,4387,4392,4397],{"type":421,"tag":512,"props":4383,"children":4384},{"style":593},[4385],{"type":427,"value":4386},"    wb_",{"type":421,"tag":512,"props":4388,"children":4389},{"style":567},[4390],{"type":427,"value":4391},"->",{"type":421,"tag":512,"props":4393,"children":4394},{"style":561},[4395],{"type":427,"value":4396},"Close",{"type":421,"tag":512,"props":4398,"children":4399},{"style":567},[4400],{"type":427,"value":714},{"type":421,"tag":512,"props":4402,"children":4403},{"class":514,"line":1057},[4404,4409,4413,4417],{"type":421,"tag":512,"props":4405,"children":4406},{"style":593},[4407],{"type":427,"value":4408},"    se_",{"type":421,"tag":512,"props":4410,"children":4411},{"style":567},[4412],{"type":427,"value":4391},{"type":421,"tag":512,"props":4414,"children":4415},{"style":561},[4416],{"type":427,"value":4396},{"type":421,"tag":512,"props":4418,"children":4419},{"style":567},[4420],{"type":427,"value":714},{"type":421,"tag":512,"props":4422,"children":4423},{"class":514,"line":1078},[4424,4429,4434],{"type":421,"tag":512,"props":4425,"children":4426},{"style":691},[4427],{"type":427,"value":4428},"    delete",{"type":421,"tag":512,"props":4430,"children":4431},{"style":772},[4432],{"type":427,"value":4433}," wb_",{"type":421,"tag":512,"props":4435,"children":4436},{"style":567},[4437],{"type":427,"value":601},{"type":421,"tag":512,"props":4439,"children":4440},{"class":514,"line":1099},[4441,4445,4450],{"type":421,"tag":512,"props":4442,"children":4443},{"style":691},[4444],{"type":427,"value":4428},{"type":421,"tag":512,"props":4446,"children":4447},{"style":772},[4448],{"type":427,"value":4449}," se_",{"type":421,"tag":512,"props":4451,"children":4452},{"style":567},[4453],{"type":427,"value":601},{"type":421,"tag":512,"props":4455,"children":4456},{"class":514,"line":1159},[4457,4461,4465],{"type":421,"tag":512,"props":4458,"children":4459},{"style":691},[4460],{"type":427,"value":4428},{"type":421,"tag":512,"props":4462,"children":4463},{"style":772},[4464],{"type":427,"value":4214},{"type":421,"tag":512,"props":4466,"children":4467},{"style":567},[4468],{"type":427,"value":601},{"type":421,"tag":512,"props":4470,"children":4471},{"class":514,"line":1223},[4472],{"type":421,"tag":512,"props":4473,"children":4474},{"style":567},[4475],{"type":427,"value":869},{"type":421,"tag":512,"props":4477,"children":4478},{"class":514,"line":1263},[4479],{"type":421,"tag":512,"props":4480,"children":4481},{"style":567},[4482],{"type":427,"value":1358},{"type":421,"tag":435,"props":4484,"children":4485},{},[4486],{"type":427,"value":4487},"因为数据库不能同时关闭或是开启，所以 Open 以及 Close 中都使用了 std::unique_lock 进行锁定。",{"type":421,"tag":501,"props":4489,"children":4491},{"code":4490,"language":504,"meta":415,"className":505,"style":415},"virtual Status Open() override {\n  std::unique_lock\u003Cstd::mutex> lock(mutex_close_);\n}\nvirtual void Close() override {\n  std::unique_lock\u003Cstd::mutex> lock(mutex_close_);\n}\n",[4492],{"type":421,"tag":508,"props":4493,"children":4494},{"__ignoreMap":415},[4495,4522,4577,4584,4611,4662],{"type":421,"tag":512,"props":4496,"children":4497},{"class":514,"line":515},[4498,4502,4506,4510,4514,4518],{"type":421,"tag":512,"props":4499,"children":4500},{"style":2019},[4501],{"type":427,"value":3509},{"type":421,"tag":512,"props":4503,"children":4504},{"style":582},[4505],{"type":427,"value":3514},{"type":421,"tag":512,"props":4507,"children":4508},{"style":561},[4509],{"type":427,"value":3858},{"type":421,"tag":512,"props":4511,"children":4512},{"style":567},[4513],{"type":427,"value":570},{"type":421,"tag":512,"props":4515,"children":4516},{"style":2019},[4517],{"type":427,"value":3867},{"type":421,"tag":512,"props":4519,"children":4520},{"style":567},[4521],{"type":427,"value":575},{"type":421,"tag":512,"props":4523,"children":4524},{"class":514,"line":542},[4525,4529,4533,4538,4542,4546,4550,4555,4559,4564,4568,4573],{"type":421,"tag":512,"props":4526,"children":4527},{"style":582},[4528],{"type":427,"value":886},{"type":421,"tag":512,"props":4530,"children":4531},{"style":567},[4532],{"type":427,"value":590},{"type":421,"tag":512,"props":4534,"children":4535},{"style":593},[4536],{"type":427,"value":4537},"unique_lock",{"type":421,"tag":512,"props":4539,"children":4540},{"style":691},[4541],{"type":427,"value":3291},{"type":421,"tag":512,"props":4543,"children":4544},{"style":582},[4545],{"type":427,"value":2963},{"type":421,"tag":512,"props":4547,"children":4548},{"style":567},[4549],{"type":427,"value":590},{"type":421,"tag":512,"props":4551,"children":4552},{"style":593},[4553],{"type":427,"value":4554},"mutex",{"type":421,"tag":512,"props":4556,"children":4557},{"style":691},[4558],{"type":427,"value":2499},{"type":421,"tag":512,"props":4560,"children":4561},{"style":561},[4562],{"type":427,"value":4563}," lock",{"type":421,"tag":512,"props":4565,"children":4566},{"style":567},[4567],{"type":427,"value":649},{"type":421,"tag":512,"props":4569,"children":4570},{"style":593},[4571],{"type":427,"value":4572},"mutex_close_",{"type":421,"tag":512,"props":4574,"children":4575},{"style":567},[4576],{"type":427,"value":679},{"type":421,"tag":512,"props":4578,"children":4579},{"class":514,"line":551},[4580],{"type":421,"tag":512,"props":4581,"children":4582},{"style":567},[4583],{"type":427,"value":1358},{"type":421,"tag":512,"props":4585,"children":4586},{"class":514,"line":578},[4587,4591,4595,4599,4603,4607],{"type":421,"tag":512,"props":4588,"children":4589},{"style":2019},[4590],{"type":427,"value":3509},{"type":421,"tag":512,"props":4592,"children":4593},{"style":555},[4594],{"type":427,"value":2027},{"type":421,"tag":512,"props":4596,"children":4597},{"style":561},[4598],{"type":427,"value":3833},{"type":421,"tag":512,"props":4600,"children":4601},{"style":567},[4602],{"type":427,"value":570},{"type":421,"tag":512,"props":4604,"children":4605},{"style":2019},[4606],{"type":427,"value":3867},{"type":421,"tag":512,"props":4608,"children":4609},{"style":567},[4610],{"type":427,"value":575},{"type":421,"tag":512,"props":4612,"children":4613},{"class":514,"line":604},[4614,4618,4622,4626,4630,4634,4638,4642,4646,4650,4654,4658],{"type":421,"tag":512,"props":4615,"children":4616},{"style":582},[4617],{"type":427,"value":886},{"type":421,"tag":512,"props":4619,"children":4620},{"style":567},[4621],{"type":427,"value":590},{"type":421,"tag":512,"props":4623,"children":4624},{"style":593},[4625],{"type":427,"value":4537},{"type":421,"tag":512,"props":4627,"children":4628},{"style":691},[4629],{"type":427,"value":3291},{"type":421,"tag":512,"props":4631,"children":4632},{"style":582},[4633],{"type":427,"value":2963},{"type":421,"tag":512,"props":4635,"children":4636},{"style":567},[4637],{"type":427,"value":590},{"type":421,"tag":512,"props":4639,"children":4640},{"style":593},[4641],{"type":427,"value":4554},{"type":421,"tag":512,"props":4643,"children":4644},{"style":691},[4645],{"type":427,"value":2499},{"type":421,"tag":512,"props":4647,"children":4648},{"style":561},[4649],{"type":427,"value":4563},{"type":421,"tag":512,"props":4651,"children":4652},{"style":567},[4653],{"type":427,"value":649},{"type":421,"tag":512,"props":4655,"children":4656},{"style":593},[4657],{"type":427,"value":4572},{"type":421,"tag":512,"props":4659,"children":4660},{"style":567},[4661],{"type":427,"value":679},{"type":421,"tag":512,"props":4663,"children":4664},{"class":514,"line":625},[4665],{"type":421,"tag":512,"props":4666,"children":4667},{"style":567},[4668],{"type":427,"value":1358},{"type":421,"tag":429,"props":4670,"children":4671},{"id":3487},[4672],{"type":427,"value":3487},{"type":421,"tag":435,"props":4674,"children":4675},{},[4676],{"type":427,"value":4677},"代码没有使用 C++ 风格的异常捕获，取而代之的是设计了状态类 Status。就像 kingdb_user 示例展示的，所有数据库操作都会返回一个状态实例，通过调用其 IsOK 方法，调用者可以判断处出操作有没有成功；如果失败了，可以使用 ToString 方法把出错原因输出。尽管这种设计会带来额外的内存开销，且使每次调用都带来轻微的性能消耗，不过这种消耗可以避免魔法数值，它将错误码和核心解耦，使代码有更佳的可读性。",{"type":421,"tag":501,"props":4679,"children":4681},{"code":4680,"language":504,"meta":415,"className":505,"style":415},"class Status {\n  // ...\n  static Status OK() { return Status(); }\n  bool IsOK() const { return (code_ == kOK); }\n  // ...\n  enum Code {\n    kOK = 0, \n    kNotFound = 1,\n    kDeleteOrder = 2,\n    kInvalidArgument = 3,\n    kIOError = 4,\n    kDone = 5,\n    kMultipartRequired = 6\n  };\n  // ...\n}\nstd::string Status::ToString() const {\n  if (message1_ == \"\") {\n    return \"OK\";\n  } else {\n    char tmp[30];\n    const char* type;\n    switch (code()) {\n      case kOK:\n        type = \"OK\";\n        break;\n      // ...\n    }\n    // ...\n    return result;\n  }\n}\n",[4682],{"type":421,"tag":508,"props":4683,"children":4684},{"__ignoreMap":415},[4685,4700,4707,4748,4803,4810,4827,4852,4873,4894,4915,4936,4957,4974,4982,4989,4996,5035,5068,5091,5106,5132,5159,5183,5200,5228,5240,5248,5256,5263,5280,5288],{"type":421,"tag":512,"props":4686,"children":4687},{"class":514,"line":515},[4688,4692,4696],{"type":421,"tag":512,"props":4689,"children":4690},{"style":555},[4691],{"type":427,"value":1932},{"type":421,"tag":512,"props":4693,"children":4694},{"style":582},[4695],{"type":427,"value":3514},{"type":421,"tag":512,"props":4697,"children":4698},{"style":567},[4699],{"type":427,"value":575},{"type":421,"tag":512,"props":4701,"children":4702},{"class":514,"line":542},[4703],{"type":421,"tag":512,"props":4704,"children":4705},{"style":1521},[4706],{"type":427,"value":1877},{"type":421,"tag":512,"props":4708,"children":4709},{"class":514,"line":551},[4710,4714,4718,4723,4727,4731,4736,4740,4744],{"type":421,"tag":512,"props":4711,"children":4712},{"style":2019},[4713],{"type":427,"value":2022},{"type":421,"tag":512,"props":4715,"children":4716},{"style":582},[4717],{"type":427,"value":3514},{"type":421,"tag":512,"props":4719,"children":4720},{"style":561},[4721],{"type":427,"value":4722}," OK",{"type":421,"tag":512,"props":4724,"children":4725},{"style":567},[4726],{"type":427,"value":570},{"type":421,"tag":512,"props":4728,"children":4729},{"style":567},[4730],{"type":427,"value":2041},{"type":421,"tag":512,"props":4732,"children":4733},{"style":519},[4734],{"type":427,"value":4735}," return",{"type":421,"tag":512,"props":4737,"children":4738},{"style":561},[4739],{"type":427,"value":3514},{"type":421,"tag":512,"props":4741,"children":4742},{"style":567},[4743],{"type":427,"value":2008},{"type":421,"tag":512,"props":4745,"children":4746},{"style":567},[4747],{"type":427,"value":3842},{"type":421,"tag":512,"props":4749,"children":4750},{"class":514,"line":578},[4751,4756,4761,4765,4769,4773,4777,4781,4786,4790,4795,4799],{"type":421,"tag":512,"props":4752,"children":4753},{"style":555},[4754],{"type":427,"value":4755},"  bool",{"type":421,"tag":512,"props":4757,"children":4758},{"style":561},[4759],{"type":427,"value":4760}," IsOK",{"type":421,"tag":512,"props":4762,"children":4763},{"style":567},[4764],{"type":427,"value":570},{"type":421,"tag":512,"props":4766,"children":4767},{"style":2019},[4768],{"type":427,"value":2553},{"type":421,"tag":512,"props":4770,"children":4771},{"style":567},[4772],{"type":427,"value":2041},{"type":421,"tag":512,"props":4774,"children":4775},{"style":519},[4776],{"type":427,"value":4735},{"type":421,"tag":512,"props":4778,"children":4779},{"style":567},[4780],{"type":427,"value":728},{"type":421,"tag":512,"props":4782,"children":4783},{"style":772},[4784],{"type":427,"value":4785},"code_ ",{"type":421,"tag":512,"props":4787,"children":4788},{"style":691},[4789],{"type":427,"value":1199},{"type":421,"tag":512,"props":4791,"children":4792},{"style":772},[4793],{"type":427,"value":4794}," kOK",{"type":421,"tag":512,"props":4796,"children":4797},{"style":567},[4798],{"type":427,"value":1255},{"type":421,"tag":512,"props":4800,"children":4801},{"style":567},[4802],{"type":427,"value":3842},{"type":421,"tag":512,"props":4804,"children":4805},{"class":514,"line":604},[4806],{"type":421,"tag":512,"props":4807,"children":4808},{"style":1521},[4809],{"type":427,"value":1877},{"type":421,"tag":512,"props":4811,"children":4812},{"class":514,"line":625},[4813,4818,4823],{"type":421,"tag":512,"props":4814,"children":4815},{"style":555},[4816],{"type":427,"value":4817},"  enum",{"type":421,"tag":512,"props":4819,"children":4820},{"style":582},[4821],{"type":427,"value":4822}," Code",{"type":421,"tag":512,"props":4824,"children":4825},{"style":567},[4826],{"type":427,"value":575},{"type":421,"tag":512,"props":4828,"children":4829},{"class":514,"line":682},[4830,4836,4840,4844,4848],{"type":421,"tag":512,"props":4831,"children":4833},{"style":4832},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#F8F8F2",[4834],{"type":427,"value":4835},"    kOK",{"type":421,"tag":512,"props":4837,"children":4838},{"style":691},[4839],{"type":427,"value":2178},{"type":421,"tag":512,"props":4841,"children":4842},{"style":853},[4843],{"type":427,"value":1345},{"type":421,"tag":512,"props":4845,"children":4846},{"style":567},[4847],{"type":427,"value":659},{"type":421,"tag":512,"props":4849,"children":4850},{"style":772},[4851],{"type":427,"value":1260},{"type":421,"tag":512,"props":4853,"children":4854},{"class":514,"line":717},[4855,4860,4864,4868],{"type":421,"tag":512,"props":4856,"children":4857},{"style":4832},[4858],{"type":427,"value":4859},"    kNotFound",{"type":421,"tag":512,"props":4861,"children":4862},{"style":691},[4863],{"type":427,"value":2178},{"type":421,"tag":512,"props":4865,"children":4866},{"style":853},[4867],{"type":427,"value":3070},{"type":421,"tag":512,"props":4869,"children":4870},{"style":567},[4871],{"type":427,"value":4872},",\n",{"type":421,"tag":512,"props":4874,"children":4875},{"class":514,"line":759},[4876,4881,4885,4890],{"type":421,"tag":512,"props":4877,"children":4878},{"style":4832},[4879],{"type":427,"value":4880},"    kDeleteOrder",{"type":421,"tag":512,"props":4882,"children":4883},{"style":691},[4884],{"type":427,"value":2178},{"type":421,"tag":512,"props":4886,"children":4887},{"style":853},[4888],{"type":427,"value":4889}," 2",{"type":421,"tag":512,"props":4891,"children":4892},{"style":567},[4893],{"type":427,"value":4872},{"type":421,"tag":512,"props":4895,"children":4896},{"class":514,"line":840},[4897,4902,4906,4911],{"type":421,"tag":512,"props":4898,"children":4899},{"style":4832},[4900],{"type":427,"value":4901},"    kInvalidArgument",{"type":421,"tag":512,"props":4903,"children":4904},{"style":691},[4905],{"type":427,"value":2178},{"type":421,"tag":512,"props":4907,"children":4908},{"style":853},[4909],{"type":427,"value":4910}," 3",{"type":421,"tag":512,"props":4912,"children":4913},{"style":567},[4914],{"type":427,"value":4872},{"type":421,"tag":512,"props":4916,"children":4917},{"class":514,"line":863},[4918,4923,4927,4932],{"type":421,"tag":512,"props":4919,"children":4920},{"style":4832},[4921],{"type":427,"value":4922},"    kIOError",{"type":421,"tag":512,"props":4924,"children":4925},{"style":691},[4926],{"type":427,"value":2178},{"type":421,"tag":512,"props":4928,"children":4929},{"style":853},[4930],{"type":427,"value":4931}," 4",{"type":421,"tag":512,"props":4933,"children":4934},{"style":567},[4935],{"type":427,"value":4872},{"type":421,"tag":512,"props":4937,"children":4938},{"class":514,"line":872},[4939,4944,4948,4953],{"type":421,"tag":512,"props":4940,"children":4941},{"style":4832},[4942],{"type":427,"value":4943},"    kDone",{"type":421,"tag":512,"props":4945,"children":4946},{"style":691},[4947],{"type":427,"value":2178},{"type":421,"tag":512,"props":4949,"children":4950},{"style":853},[4951],{"type":427,"value":4952}," 5",{"type":421,"tag":512,"props":4954,"children":4955},{"style":567},[4956],{"type":427,"value":4872},{"type":421,"tag":512,"props":4958,"children":4959},{"class":514,"line":880},[4960,4965,4969],{"type":421,"tag":512,"props":4961,"children":4962},{"style":4832},[4963],{"type":427,"value":4964},"    kMultipartRequired",{"type":421,"tag":512,"props":4966,"children":4967},{"style":691},[4968],{"type":427,"value":2178},{"type":421,"tag":512,"props":4970,"children":4971},{"style":853},[4972],{"type":427,"value":4973}," 6\n",{"type":421,"tag":512,"props":4975,"children":4976},{"class":514,"line":923},[4977],{"type":421,"tag":512,"props":4978,"children":4979},{"style":567},[4980],{"type":427,"value":4981},"  };\n",{"type":421,"tag":512,"props":4983,"children":4984},{"class":514,"line":964},[4985],{"type":421,"tag":512,"props":4986,"children":4987},{"style":1521},[4988],{"type":427,"value":1877},{"type":421,"tag":512,"props":4990,"children":4991},{"class":514,"line":972},[4992],{"type":421,"tag":512,"props":4993,"children":4994},{"style":567},[4995],{"type":427,"value":1358},{"type":421,"tag":512,"props":4997,"children":4998},{"class":514,"line":993},[4999,5003,5007,5011,5015,5019,5023,5027,5031],{"type":421,"tag":512,"props":5000,"children":5001},{"style":582},[5002],{"type":427,"value":2963},{"type":421,"tag":512,"props":5004,"children":5005},{"style":567},[5006],{"type":427,"value":590},{"type":421,"tag":512,"props":5008,"children":5009},{"style":582},[5010],{"type":427,"value":3558},{"type":421,"tag":512,"props":5012,"children":5013},{"style":582},[5014],{"type":427,"value":3514},{"type":421,"tag":512,"props":5016,"children":5017},{"style":567},[5018],{"type":427,"value":590},{"type":421,"tag":512,"props":5020,"children":5021},{"style":561},[5022],{"type":427,"value":822},{"type":421,"tag":512,"props":5024,"children":5025},{"style":567},[5026],{"type":427,"value":570},{"type":421,"tag":512,"props":5028,"children":5029},{"style":2019},[5030],{"type":427,"value":2553},{"type":421,"tag":512,"props":5032,"children":5033},{"style":567},[5034],{"type":427,"value":575},{"type":421,"tag":512,"props":5036,"children":5037},{"class":514,"line":1049},[5038,5042,5046,5051,5055,5060,5064],{"type":421,"tag":512,"props":5039,"children":5040},{"style":519},[5041],{"type":427,"value":723},{"type":421,"tag":512,"props":5043,"children":5044},{"style":567},[5045],{"type":427,"value":728},{"type":421,"tag":512,"props":5047,"children":5048},{"style":772},[5049],{"type":427,"value":5050},"message1_ ",{"type":421,"tag":512,"props":5052,"children":5053},{"style":691},[5054],{"type":427,"value":1199},{"type":421,"tag":512,"props":5056,"children":5057},{"style":525},[5058],{"type":427,"value":5059}," \"\"",{"type":421,"tag":512,"props":5061,"children":5062},{"style":567},[5063],{"type":427,"value":1216},{"type":421,"tag":512,"props":5065,"children":5066},{"style":567},[5067],{"type":427,"value":575},{"type":421,"tag":512,"props":5069,"children":5070},{"class":514,"line":1057},[5071,5075,5079,5083,5087],{"type":421,"tag":512,"props":5072,"children":5073},{"style":519},[5074],{"type":427,"value":2752},{"type":421,"tag":512,"props":5076,"children":5077},{"style":525},[5078],{"type":427,"value":664},{"type":421,"tag":512,"props":5080,"children":5081},{"style":531},[5082],{"type":427,"value":4288},{"type":421,"tag":512,"props":5084,"children":5085},{"style":525},[5086],{"type":427,"value":674},{"type":421,"tag":512,"props":5088,"children":5089},{"style":567},[5090],{"type":427,"value":601},{"type":421,"tag":512,"props":5092,"children":5093},{"class":514,"line":1078},[5094,5098,5102],{"type":421,"tag":512,"props":5095,"children":5096},{"style":567},[5097],{"type":427,"value":1269},{"type":421,"tag":512,"props":5099,"children":5100},{"style":519},[5101],{"type":427,"value":1274},{"type":421,"tag":512,"props":5103,"children":5104},{"style":567},[5105],{"type":427,"value":575},{"type":421,"tag":512,"props":5107,"children":5108},{"class":514,"line":1099},[5109,5114,5119,5123,5128],{"type":421,"tag":512,"props":5110,"children":5111},{"style":555},[5112],{"type":427,"value":5113},"    char",{"type":421,"tag":512,"props":5115,"children":5116},{"style":593},[5117],{"type":427,"value":5118}," tmp",{"type":421,"tag":512,"props":5120,"children":5121},{"style":567},[5122],{"type":427,"value":1488},{"type":421,"tag":512,"props":5124,"children":5125},{"style":853},[5126],{"type":427,"value":5127},"30",{"type":421,"tag":512,"props":5129,"children":5130},{"style":567},[5131],{"type":427,"value":1498},{"type":421,"tag":512,"props":5133,"children":5134},{"class":514,"line":1159},[5135,5140,5145,5150,5155],{"type":421,"tag":512,"props":5136,"children":5137},{"style":2019},[5138],{"type":427,"value":5139},"    const",{"type":421,"tag":512,"props":5141,"children":5142},{"style":555},[5143],{"type":427,"value":5144}," char",{"type":421,"tag":512,"props":5146,"children":5147},{"style":691},[5148],{"type":427,"value":5149},"*",{"type":421,"tag":512,"props":5151,"children":5152},{"style":772},[5153],{"type":427,"value":5154}," type",{"type":421,"tag":512,"props":5156,"children":5157},{"style":567},[5158],{"type":427,"value":601},{"type":421,"tag":512,"props":5160,"children":5161},{"class":514,"line":1223},[5162,5167,5171,5175,5179],{"type":421,"tag":512,"props":5163,"children":5164},{"style":519},[5165],{"type":427,"value":5166},"    switch",{"type":421,"tag":512,"props":5168,"children":5169},{"style":567},[5170],{"type":427,"value":728},{"type":421,"tag":512,"props":5172,"children":5173},{"style":561},[5174],{"type":427,"value":508},{"type":421,"tag":512,"props":5176,"children":5177},{"style":567},[5178],{"type":427,"value":752},{"type":421,"tag":512,"props":5180,"children":5181},{"style":567},[5182],{"type":427,"value":575},{"type":421,"tag":512,"props":5184,"children":5185},{"class":514,"line":1263},[5186,5191,5195],{"type":421,"tag":512,"props":5187,"children":5188},{"style":519},[5189],{"type":427,"value":5190},"      case",{"type":421,"tag":512,"props":5192,"children":5193},{"style":772},[5194],{"type":427,"value":4794},{"type":421,"tag":512,"props":5196,"children":5197},{"style":567},[5198],{"type":427,"value":5199},":\n",{"type":421,"tag":512,"props":5201,"children":5202},{"class":514,"line":1281},[5203,5208,5212,5216,5220,5224],{"type":421,"tag":512,"props":5204,"children":5205},{"style":772},[5206],{"type":427,"value":5207},"        type ",{"type":421,"tag":512,"props":5209,"children":5210},{"style":691},[5211],{"type":427,"value":694},{"type":421,"tag":512,"props":5213,"children":5214},{"style":525},[5215],{"type":427,"value":664},{"type":421,"tag":512,"props":5217,"children":5218},{"style":531},[5219],{"type":427,"value":4288},{"type":421,"tag":512,"props":5221,"children":5222},{"style":525},[5223],{"type":427,"value":674},{"type":421,"tag":512,"props":5225,"children":5226},{"style":567},[5227],{"type":427,"value":601},{"type":421,"tag":512,"props":5229,"children":5230},{"class":514,"line":1318},[5231,5236],{"type":421,"tag":512,"props":5232,"children":5233},{"style":519},[5234],{"type":427,"value":5235},"        break",{"type":421,"tag":512,"props":5237,"children":5238},{"style":567},[5239],{"type":427,"value":601},{"type":421,"tag":512,"props":5241,"children":5242},{"class":514,"line":1326},[5243],{"type":421,"tag":512,"props":5244,"children":5245},{"style":1521},[5246],{"type":427,"value":5247},"      // ...\n",{"type":421,"tag":512,"props":5249,"children":5250},{"class":514,"line":1334},[5251],{"type":421,"tag":512,"props":5252,"children":5253},{"style":567},[5254],{"type":427,"value":5255},"    }\n",{"type":421,"tag":512,"props":5257,"children":5258},{"class":514,"line":1352},[5259],{"type":421,"tag":512,"props":5260,"children":5261},{"style":1521},[5262],{"type":427,"value":4149},{"type":421,"tag":512,"props":5264,"children":5266},{"class":514,"line":5265},30,[5267,5271,5276],{"type":421,"tag":512,"props":5268,"children":5269},{"style":519},[5270],{"type":427,"value":2752},{"type":421,"tag":512,"props":5272,"children":5273},{"style":772},[5274],{"type":427,"value":5275}," result",{"type":421,"tag":512,"props":5277,"children":5278},{"style":567},[5279],{"type":427,"value":601},{"type":421,"tag":512,"props":5281,"children":5283},{"class":514,"line":5282},31,[5284],{"type":421,"tag":512,"props":5285,"children":5286},{"style":567},[5287],{"type":427,"value":869},{"type":421,"tag":512,"props":5289,"children":5291},{"class":514,"line":5290},32,[5292],{"type":421,"tag":512,"props":5293,"children":5294},{"style":567},[5295],{"type":427,"value":1358},{"type":421,"tag":435,"props":5297,"children":5298},{},[5299],{"type":427,"value":5300},"KDB 内部代码出现异常时会使用日志将其记录下来。如果没有日志，那么在排查代码问题时简直就是噩梦。KDB 有两套日志的输出目标，分别是系统输出和标准输出设备。日志类记录输出目标、日志级别、线程锁等成员，并通过静态方法 Logv 实现记录日志。锁的最大用处是保证记录顺序。仅有当出现最高级别的日志（kLogLevelEMERG）时，才会跳过锁直接写入。出现 kLogLevelEMERG 时意味着程序遇到了紧急问题，通常会直接退出或是返回 Status 异常，所以这个时候需要及时记录。",{"type":421,"tag":435,"props":5302,"children":5303},{},[5304],{"type":427,"value":5305},"日志级别的划分参考了 Syslog：",{"type":421,"tag":462,"props":5307,"children":5308},{},[5309,5314,5319,5324,5329,5334,5339,5344,5349,5354],{"type":421,"tag":466,"props":5310,"children":5311},{},[5312],{"type":427,"value":5313},"silent: all logging is turned off",{"type":421,"tag":466,"props":5315,"children":5316},{},[5317],{"type":427,"value":5318},"emerg: system is unusable, imminent crash",{"type":421,"tag":466,"props":5320,"children":5321},{},[5322],{"type":427,"value":5323},"alert: error event, immediate action required",{"type":421,"tag":466,"props":5325,"children":5326},{},[5327],{"type":427,"value":5328},"crit: error event, immediate action required",{"type":421,"tag":466,"props":5330,"children":5331},{},[5332],{"type":427,"value":5333},"error: error event, action is required but is not urgent",{"type":421,"tag":466,"props":5335,"children":5336},{},[5337],{"type":427,"value":5338},"warn: events that can be harmful if no action is taken",{"type":421,"tag":466,"props":5340,"children":5341},{},[5342],{"type":427,"value":5343},"notice: unusual events, but no immediate action required",{"type":421,"tag":466,"props":5345,"children":5346},{},[5347],{"type":427,"value":5348},"info: normal operation events, no action required",{"type":421,"tag":466,"props":5350,"children":5351},{},[5352],{"type":427,"value":5353},"debug: events used for debugging, no action required",{"type":421,"tag":466,"props":5355,"children":5356},{},[5357],{"type":427,"value":5358},"trace: fine-grained events used for debugging, no action required",{"type":421,"tag":1388,"props":5360,"children":5362},{"id":5361},"日志调用用宏还是函数",[5363],{"type":427,"value":5361},{"type":421,"tag":435,"props":5365,"children":5366},{},[5367,5369,5375,5377,5381],{"type":427,"value":5368},"原先的提交中，日志调用被定义在了宏里，直接调用 Logger::Logv 去记录。日志宏中使用子宏 ",{"type":421,"tag":5370,"props":5371,"children":5372},"strong",{},[5373],{"type":427,"value":5374},"VA_ARGS",{"type":427,"value":5376}," 来记录可变参数。",{"type":421,"tag":5370,"props":5378,"children":5379},{},[5380],{"type":427,"value":5374},{"type":427,"value":5382}," 前面有标记黏贴运算符的原因是当日志宏的可变参数为空时，可以把末尾的逗号去掉。",{"type":421,"tag":501,"props":5384,"children":5386},{"code":5385,"language":504,"meta":415,"className":505,"style":415},"class log {\n  static void emerg(const char* logname, const char* format, ...) {\n    va_list args;\n    va_start(args, format);\n    Logger::Logv(false, Logger::kLogLevelEMERG, LOG_EMERG, logname, format, args);\n    va_end(args);\n  }\n}\n// ...\n#define LOG_EMERG(logname, fmt, ...) \\\n        Logger::Logv(false, Logger::kLogLevelEMERG, logname, fmt, ##__VA_ARGS__)\n",[5387],{"type":421,"tag":508,"props":5388,"children":5389},{"__ignoreMap":415},[5390,5406,5481,5493,5522,5604,5624,5631,5638,5645,5687],{"type":421,"tag":512,"props":5391,"children":5392},{"class":514,"line":515},[5393,5397,5402],{"type":421,"tag":512,"props":5394,"children":5395},{"style":555},[5396],{"type":427,"value":1932},{"type":421,"tag":512,"props":5398,"children":5399},{"style":582},[5400],{"type":427,"value":5401}," log",{"type":421,"tag":512,"props":5403,"children":5404},{"style":567},[5405],{"type":427,"value":575},{"type":421,"tag":512,"props":5407,"children":5408},{"class":514,"line":542},[5409,5413,5417,5422,5426,5430,5434,5438,5443,5447,5451,5455,5459,5464,5468,5473,5477],{"type":421,"tag":512,"props":5410,"children":5411},{"style":2019},[5412],{"type":427,"value":2022},{"type":421,"tag":512,"props":5414,"children":5415},{"style":555},[5416],{"type":427,"value":2027},{"type":421,"tag":512,"props":5418,"children":5419},{"style":561},[5420],{"type":427,"value":5421}," emerg",{"type":421,"tag":512,"props":5423,"children":5424},{"style":567},[5425],{"type":427,"value":649},{"type":421,"tag":512,"props":5427,"children":5428},{"style":2019},[5429],{"type":427,"value":2531},{"type":421,"tag":512,"props":5431,"children":5432},{"style":555},[5433],{"type":427,"value":5144},{"type":421,"tag":512,"props":5435,"children":5436},{"style":2019},[5437],{"type":427,"value":5149},{"type":421,"tag":512,"props":5439,"children":5440},{"style":1428},[5441],{"type":427,"value":5442}," logname",{"type":421,"tag":512,"props":5444,"children":5445},{"style":567},[5446],{"type":427,"value":659},{"type":421,"tag":512,"props":5448,"children":5449},{"style":2019},[5450],{"type":427,"value":2553},{"type":421,"tag":512,"props":5452,"children":5453},{"style":555},[5454],{"type":427,"value":5144},{"type":421,"tag":512,"props":5456,"children":5457},{"style":2019},[5458],{"type":427,"value":5149},{"type":421,"tag":512,"props":5460,"children":5461},{"style":1428},[5462],{"type":427,"value":5463}," format",{"type":421,"tag":512,"props":5465,"children":5466},{"style":567},[5467],{"type":427,"value":659},{"type":421,"tag":512,"props":5469,"children":5470},{"style":772},[5471],{"type":427,"value":5472}," ...",{"type":421,"tag":512,"props":5474,"children":5475},{"style":567},[5476],{"type":427,"value":1216},{"type":421,"tag":512,"props":5478,"children":5479},{"style":567},[5480],{"type":427,"value":575},{"type":421,"tag":512,"props":5482,"children":5483},{"class":514,"line":551},[5484,5489],{"type":421,"tag":512,"props":5485,"children":5486},{"style":772},[5487],{"type":427,"value":5488},"    va_list args",{"type":421,"tag":512,"props":5490,"children":5491},{"style":567},[5492],{"type":427,"value":601},{"type":421,"tag":512,"props":5494,"children":5495},{"class":514,"line":578},[5496,5501,5505,5510,5514,5518],{"type":421,"tag":512,"props":5497,"children":5498},{"style":561},[5499],{"type":427,"value":5500},"    va_start",{"type":421,"tag":512,"props":5502,"children":5503},{"style":567},[5504],{"type":427,"value":649},{"type":421,"tag":512,"props":5506,"children":5507},{"style":772},[5508],{"type":427,"value":5509},"args",{"type":421,"tag":512,"props":5511,"children":5512},{"style":567},[5513],{"type":427,"value":659},{"type":421,"tag":512,"props":5515,"children":5516},{"style":772},[5517],{"type":427,"value":5463},{"type":421,"tag":512,"props":5519,"children":5520},{"style":567},[5521],{"type":427,"value":679},{"type":421,"tag":512,"props":5523,"children":5524},{"class":514,"line":604},[5525,5530,5534,5539,5543,5548,5552,5557,5561,5566,5570,5575,5579,5583,5587,5591,5595,5600],{"type":421,"tag":512,"props":5526,"children":5527},{"style":582},[5528],{"type":427,"value":5529},"    Logger",{"type":421,"tag":512,"props":5531,"children":5532},{"style":567},[5533],{"type":427,"value":590},{"type":421,"tag":512,"props":5535,"children":5536},{"style":561},[5537],{"type":427,"value":5538},"Logv",{"type":421,"tag":512,"props":5540,"children":5541},{"style":567},[5542],{"type":427,"value":649},{"type":421,"tag":512,"props":5544,"children":5545},{"style":2719},[5546],{"type":427,"value":5547},"false",{"type":421,"tag":512,"props":5549,"children":5550},{"style":567},[5551],{"type":427,"value":659},{"type":421,"tag":512,"props":5553,"children":5554},{"style":582},[5555],{"type":427,"value":5556}," Logger",{"type":421,"tag":512,"props":5558,"children":5559},{"style":567},[5560],{"type":427,"value":590},{"type":421,"tag":512,"props":5562,"children":5563},{"style":772},[5564],{"type":427,"value":5565},"kLogLevelEMERG",{"type":421,"tag":512,"props":5567,"children":5568},{"style":567},[5569],{"type":427,"value":659},{"type":421,"tag":512,"props":5571,"children":5572},{"style":772},[5573],{"type":427,"value":5574}," LOG_EMERG",{"type":421,"tag":512,"props":5576,"children":5577},{"style":567},[5578],{"type":427,"value":659},{"type":421,"tag":512,"props":5580,"children":5581},{"style":772},[5582],{"type":427,"value":5442},{"type":421,"tag":512,"props":5584,"children":5585},{"style":567},[5586],{"type":427,"value":659},{"type":421,"tag":512,"props":5588,"children":5589},{"style":772},[5590],{"type":427,"value":5463},{"type":421,"tag":512,"props":5592,"children":5593},{"style":567},[5594],{"type":427,"value":659},{"type":421,"tag":512,"props":5596,"children":5597},{"style":772},[5598],{"type":427,"value":5599}," args",{"type":421,"tag":512,"props":5601,"children":5602},{"style":567},[5603],{"type":427,"value":679},{"type":421,"tag":512,"props":5605,"children":5606},{"class":514,"line":625},[5607,5612,5616,5620],{"type":421,"tag":512,"props":5608,"children":5609},{"style":561},[5610],{"type":427,"value":5611},"    va_end",{"type":421,"tag":512,"props":5613,"children":5614},{"style":567},[5615],{"type":427,"value":649},{"type":421,"tag":512,"props":5617,"children":5618},{"style":772},[5619],{"type":427,"value":5509},{"type":421,"tag":512,"props":5621,"children":5622},{"style":567},[5623],{"type":427,"value":679},{"type":421,"tag":512,"props":5625,"children":5626},{"class":514,"line":682},[5627],{"type":421,"tag":512,"props":5628,"children":5629},{"style":567},[5630],{"type":427,"value":869},{"type":421,"tag":512,"props":5632,"children":5633},{"class":514,"line":717},[5634],{"type":421,"tag":512,"props":5635,"children":5636},{"style":567},[5637],{"type":427,"value":1358},{"type":421,"tag":512,"props":5639,"children":5640},{"class":514,"line":759},[5641],{"type":421,"tag":512,"props":5642,"children":5643},{"style":1521},[5644],{"type":427,"value":3333},{"type":421,"tag":512,"props":5646,"children":5647},{"class":514,"line":840},[5648,5652,5656,5660,5665,5669,5674,5678,5683],{"type":421,"tag":512,"props":5649,"children":5650},{"style":519},[5651],{"type":427,"value":1892},{"type":421,"tag":512,"props":5653,"children":5654},{"style":561},[5655],{"type":427,"value":5574},{"type":421,"tag":512,"props":5657,"children":5658},{"style":567},[5659],{"type":427,"value":649},{"type":421,"tag":512,"props":5661,"children":5662},{"style":1428},[5663],{"type":427,"value":5664},"logname",{"type":421,"tag":512,"props":5666,"children":5667},{"style":567},[5668],{"type":427,"value":659},{"type":421,"tag":512,"props":5670,"children":5671},{"style":1428},[5672],{"type":427,"value":5673}," fmt",{"type":421,"tag":512,"props":5675,"children":5676},{"style":567},[5677],{"type":427,"value":659},{"type":421,"tag":512,"props":5679,"children":5680},{"style":567},[5681],{"type":427,"value":5682}," ...)",{"type":421,"tag":512,"props":5684,"children":5685},{"style":797},[5686],{"type":427,"value":2278},{"type":421,"tag":512,"props":5688,"children":5689},{"class":514,"line":863},[5690,5695,5699,5703,5707,5711,5715,5719,5723,5727,5731,5735,5739,5743,5747,5752],{"type":421,"tag":512,"props":5691,"children":5692},{"style":582},[5693],{"type":427,"value":5694},"        Logger",{"type":421,"tag":512,"props":5696,"children":5697},{"style":567},[5698],{"type":427,"value":590},{"type":421,"tag":512,"props":5700,"children":5701},{"style":561},[5702],{"type":427,"value":5538},{"type":421,"tag":512,"props":5704,"children":5705},{"style":567},[5706],{"type":427,"value":649},{"type":421,"tag":512,"props":5708,"children":5709},{"style":2719},[5710],{"type":427,"value":5547},{"type":421,"tag":512,"props":5712,"children":5713},{"style":567},[5714],{"type":427,"value":659},{"type":421,"tag":512,"props":5716,"children":5717},{"style":582},[5718],{"type":427,"value":5556},{"type":421,"tag":512,"props":5720,"children":5721},{"style":567},[5722],{"type":427,"value":590},{"type":421,"tag":512,"props":5724,"children":5725},{"style":772},[5726],{"type":427,"value":5565},{"type":421,"tag":512,"props":5728,"children":5729},{"style":567},[5730],{"type":427,"value":659},{"type":421,"tag":512,"props":5732,"children":5733},{"style":772},[5734],{"type":427,"value":5442},{"type":421,"tag":512,"props":5736,"children":5737},{"style":567},[5738],{"type":427,"value":659},{"type":421,"tag":512,"props":5740,"children":5741},{"style":772},[5742],{"type":427,"value":5673},{"type":421,"tag":512,"props":5744,"children":5745},{"style":567},[5746],{"type":427,"value":659},{"type":421,"tag":512,"props":5748,"children":5749},{"style":593},[5750],{"type":427,"value":5751}," ##__VA_ARGS__",{"type":421,"tag":512,"props":5753,"children":5754},{"style":567},[5755],{"type":427,"value":2348},{"type":421,"tag":435,"props":5757,"children":5758},{},[5759],{"type":427,"value":5760},"尚不清楚为什么不用宏，而是使用运行时的方法调用（即 log 的 public 方法）。猜测可能是因为宏不能跨行？因为我看到了这种很长的调用。",{"type":421,"tag":501,"props":5762,"children":5764},{"code":5763,"language":504,"meta":415,"className":505,"style":415},"log::trace(\n  \"Database::PutPartValidSize()\",\n  \"[%s] size_chunk:%\" PRIu64 \" offset_chunk:%\" PRIu64,\n  key.ToString().c_str(),\n  chunk.size(),\n  offset_chunk\n);\n",[5765],{"type":421,"tag":508,"props":5766,"children":5767},{"__ignoreMap":415},[5768,5790,5811,5862,5891,5911,5919],{"type":421,"tag":512,"props":5769,"children":5770},{"class":514,"line":515},[5771,5776,5780,5785],{"type":421,"tag":512,"props":5772,"children":5773},{"style":582},[5774],{"type":427,"value":5775},"log",{"type":421,"tag":512,"props":5777,"children":5778},{"style":567},[5779],{"type":427,"value":590},{"type":421,"tag":512,"props":5781,"children":5782},{"style":561},[5783],{"type":427,"value":5784},"trace",{"type":421,"tag":512,"props":5786,"children":5787},{"style":567},[5788],{"type":427,"value":5789},"(\n",{"type":421,"tag":512,"props":5791,"children":5792},{"class":514,"line":542},[5793,5798,5803,5807],{"type":421,"tag":512,"props":5794,"children":5795},{"style":525},[5796],{"type":427,"value":5797},"  \"",{"type":421,"tag":512,"props":5799,"children":5800},{"style":531},[5801],{"type":427,"value":5802},"Database::PutPartValidSize()",{"type":421,"tag":512,"props":5804,"children":5805},{"style":525},[5806],{"type":427,"value":674},{"type":421,"tag":512,"props":5808,"children":5809},{"style":567},[5810],{"type":427,"value":4872},{"type":421,"tag":512,"props":5812,"children":5813},{"class":514,"line":551},[5814,5818,5822,5826,5831,5835,5840,5844,5849,5853,5858],{"type":421,"tag":512,"props":5815,"children":5816},{"style":525},[5817],{"type":427,"value":5797},{"type":421,"tag":512,"props":5819,"children":5820},{"style":531},[5821],{"type":427,"value":1488},{"type":421,"tag":512,"props":5823,"children":5824},{"style":791},[5825],{"type":427,"value":794},{"type":421,"tag":512,"props":5827,"children":5828},{"style":531},[5829],{"type":427,"value":5830},"] size_chunk:%",{"type":421,"tag":512,"props":5832,"children":5833},{"style":525},[5834],{"type":427,"value":674},{"type":421,"tag":512,"props":5836,"children":5837},{"style":593},[5838],{"type":427,"value":5839}," PRIu64 ",{"type":421,"tag":512,"props":5841,"children":5842},{"style":525},[5843],{"type":427,"value":674},{"type":421,"tag":512,"props":5845,"children":5846},{"style":531},[5847],{"type":427,"value":5848}," offset_chunk:%",{"type":421,"tag":512,"props":5850,"children":5851},{"style":525},[5852],{"type":427,"value":674},{"type":421,"tag":512,"props":5854,"children":5855},{"style":593},[5856],{"type":427,"value":5857}," PRIu64",{"type":421,"tag":512,"props":5859,"children":5860},{"style":567},[5861],{"type":427,"value":4872},{"type":421,"tag":512,"props":5863,"children":5864},{"class":514,"line":578},[5865,5870,5874,5878,5882,5886],{"type":421,"tag":512,"props":5866,"children":5867},{"style":593},[5868],{"type":427,"value":5869},"  key",{"type":421,"tag":512,"props":5871,"children":5872},{"style":567},[5873],{"type":427,"value":704},{"type":421,"tag":512,"props":5875,"children":5876},{"style":561},[5877],{"type":427,"value":822},{"type":421,"tag":512,"props":5879,"children":5880},{"style":567},[5881],{"type":427,"value":827},{"type":421,"tag":512,"props":5883,"children":5884},{"style":561},[5885],{"type":427,"value":832},{"type":421,"tag":512,"props":5887,"children":5888},{"style":567},[5889],{"type":427,"value":5890},"(),\n",{"type":421,"tag":512,"props":5892,"children":5893},{"class":514,"line":604},[5894,5899,5903,5907],{"type":421,"tag":512,"props":5895,"children":5896},{"style":593},[5897],{"type":427,"value":5898},"  chunk",{"type":421,"tag":512,"props":5900,"children":5901},{"style":567},[5902],{"type":427,"value":704},{"type":421,"tag":512,"props":5904,"children":5905},{"style":561},[5906],{"type":427,"value":3656},{"type":421,"tag":512,"props":5908,"children":5909},{"style":567},[5910],{"type":427,"value":5890},{"type":421,"tag":512,"props":5912,"children":5913},{"class":514,"line":625},[5914],{"type":421,"tag":512,"props":5915,"children":5916},{"style":593},[5917],{"type":427,"value":5918},"  offset_chunk\n",{"type":421,"tag":512,"props":5920,"children":5921},{"class":514,"line":682},[5922],{"type":421,"tag":512,"props":5923,"children":5924},{"style":567},[5925],{"type":427,"value":679},{"type":421,"tag":1388,"props":5927,"children":5929},{"id":5928},"日志时间",[5930],{"type":427,"value":5928},{"type":421,"tag":435,"props":5932,"children":5933},{},[5934],{"type":427,"value":5935},"使用系统输出（syslog）时不需要手动记录时间，但是把日志打印出来时却是要的。尤其是在调试时，精确时间非常有用。KDB 使用 Linux 的 timeval、tm 两个结构体，分别拿到精确时间及可读时间，再格式化输出。",{"type":421,"tag":501,"props":5937,"children":5939},{"code":5938,"language":504,"meta":415,"className":505,"style":415},"struct timeval now_tv;\ngettimeofday(&now_tv, NULL);\nconst time_t seconds = now_tv.tv_sec;\nstruct tm t;\n// 初始化 tm 时需要用到当前秒数，\n// 所以需要提前初始化 now_tv\nlocaltime_r(&seconds, &t);\np += snprintf(p, limit - p,\n              \"%04d/%02d/%02d-%02d:%02d:%02d.%06d %s %s \",\n              t.tm_year + 1900,\n              t.tm_mon + 1,\n              t.tm_mday,\n              t.tm_hour,\n              t.tm_min,\n              t.tm_sec,\n              static_cast\u003Cint>(now_tv.tv_usec), // 毫秒\n              ss.str().c_str(),\n              logname);\n",[5940],{"type":421,"tag":508,"props":5941,"children":5942},{"__ignoreMap":415},[5943,5965,5999,6037,6057,6065,6073,6111,6160,6241,6272,6300,6320,6340,6360,6380,6423,6451],{"type":421,"tag":512,"props":5944,"children":5945},{"class":514,"line":515},[5946,5951,5956,5961],{"type":421,"tag":512,"props":5947,"children":5948},{"style":555},[5949],{"type":427,"value":5950},"struct",{"type":421,"tag":512,"props":5952,"children":5953},{"style":582},[5954],{"type":427,"value":5955}," timeval",{"type":421,"tag":512,"props":5957,"children":5958},{"style":593},[5959],{"type":427,"value":5960}," now_tv",{"type":421,"tag":512,"props":5962,"children":5963},{"style":567},[5964],{"type":427,"value":601},{"type":421,"tag":512,"props":5966,"children":5967},{"class":514,"line":542},[5968,5973,5977,5981,5986,5990,5995],{"type":421,"tag":512,"props":5969,"children":5970},{"style":561},[5971],{"type":427,"value":5972},"gettimeofday",{"type":421,"tag":512,"props":5974,"children":5975},{"style":567},[5976],{"type":427,"value":649},{"type":421,"tag":512,"props":5978,"children":5979},{"style":691},[5980],{"type":427,"value":2517},{"type":421,"tag":512,"props":5982,"children":5983},{"style":593},[5984],{"type":427,"value":5985},"now_tv",{"type":421,"tag":512,"props":5987,"children":5988},{"style":567},[5989],{"type":427,"value":659},{"type":421,"tag":512,"props":5991,"children":5992},{"style":2719},[5993],{"type":427,"value":5994}," NULL",{"type":421,"tag":512,"props":5996,"children":5997},{"style":567},[5998],{"type":427,"value":679},{"type":421,"tag":512,"props":6000,"children":6001},{"class":514,"line":551},[6002,6006,6011,6016,6020,6024,6028,6033],{"type":421,"tag":512,"props":6003,"children":6004},{"style":2019},[6005],{"type":427,"value":2531},{"type":421,"tag":512,"props":6007,"children":6008},{"style":555},[6009],{"type":427,"value":6010}," time_t",{"type":421,"tag":512,"props":6012,"children":6013},{"style":593},[6014],{"type":427,"value":6015}," seconds ",{"type":421,"tag":512,"props":6017,"children":6018},{"style":691},[6019],{"type":427,"value":694},{"type":421,"tag":512,"props":6021,"children":6022},{"style":593},[6023],{"type":427,"value":5960},{"type":421,"tag":512,"props":6025,"children":6026},{"style":567},[6027],{"type":427,"value":704},{"type":421,"tag":512,"props":6029,"children":6030},{"style":593},[6031],{"type":427,"value":6032},"tv_sec",{"type":421,"tag":512,"props":6034,"children":6035},{"style":567},[6036],{"type":427,"value":601},{"type":421,"tag":512,"props":6038,"children":6039},{"class":514,"line":578},[6040,6044,6049,6053],{"type":421,"tag":512,"props":6041,"children":6042},{"style":555},[6043],{"type":427,"value":5950},{"type":421,"tag":512,"props":6045,"children":6046},{"style":582},[6047],{"type":427,"value":6048}," tm",{"type":421,"tag":512,"props":6050,"children":6051},{"style":593},[6052],{"type":427,"value":2079},{"type":421,"tag":512,"props":6054,"children":6055},{"style":567},[6056],{"type":427,"value":601},{"type":421,"tag":512,"props":6058,"children":6059},{"class":514,"line":604},[6060],{"type":421,"tag":512,"props":6061,"children":6062},{"style":1521},[6063],{"type":427,"value":6064},"// 初始化 tm 时需要用到当前秒数，\n",{"type":421,"tag":512,"props":6066,"children":6067},{"class":514,"line":625},[6068],{"type":421,"tag":512,"props":6069,"children":6070},{"style":1521},[6071],{"type":427,"value":6072},"// 所以需要提前初始化 now_tv\n",{"type":421,"tag":512,"props":6074,"children":6075},{"class":514,"line":682},[6076,6081,6085,6089,6094,6098,6102,6107],{"type":421,"tag":512,"props":6077,"children":6078},{"style":561},[6079],{"type":427,"value":6080},"localtime_r",{"type":421,"tag":512,"props":6082,"children":6083},{"style":567},[6084],{"type":427,"value":649},{"type":421,"tag":512,"props":6086,"children":6087},{"style":691},[6088],{"type":427,"value":2517},{"type":421,"tag":512,"props":6090,"children":6091},{"style":593},[6092],{"type":427,"value":6093},"seconds",{"type":421,"tag":512,"props":6095,"children":6096},{"style":567},[6097],{"type":427,"value":659},{"type":421,"tag":512,"props":6099,"children":6100},{"style":691},[6101],{"type":427,"value":1147},{"type":421,"tag":512,"props":6103,"children":6104},{"style":593},[6105],{"type":427,"value":6106},"t",{"type":421,"tag":512,"props":6108,"children":6109},{"style":567},[6110],{"type":427,"value":679},{"type":421,"tag":512,"props":6112,"children":6113},{"class":514,"line":717},[6114,6119,6124,6129,6133,6137,6141,6146,6151,6156],{"type":421,"tag":512,"props":6115,"children":6116},{"style":593},[6117],{"type":427,"value":6118},"p ",{"type":421,"tag":512,"props":6120,"children":6121},{"style":691},[6122],{"type":427,"value":6123},"+=",{"type":421,"tag":512,"props":6125,"children":6126},{"style":561},[6127],{"type":427,"value":6128}," snprintf",{"type":421,"tag":512,"props":6130,"children":6131},{"style":567},[6132],{"type":427,"value":649},{"type":421,"tag":512,"props":6134,"children":6135},{"style":593},[6136],{"type":427,"value":435},{"type":421,"tag":512,"props":6138,"children":6139},{"style":567},[6140],{"type":427,"value":659},{"type":421,"tag":512,"props":6142,"children":6143},{"style":593},[6144],{"type":427,"value":6145}," limit ",{"type":421,"tag":512,"props":6147,"children":6148},{"style":691},[6149],{"type":427,"value":6150},"-",{"type":421,"tag":512,"props":6152,"children":6153},{"style":593},[6154],{"type":427,"value":6155}," p",{"type":421,"tag":512,"props":6157,"children":6158},{"style":567},[6159],{"type":427,"value":4872},{"type":421,"tag":512,"props":6161,"children":6162},{"class":514,"line":759},[6163,6168,6173,6178,6183,6187,6191,6195,6199,6203,6207,6211,6215,6219,6224,6229,6233,6237],{"type":421,"tag":512,"props":6164,"children":6165},{"style":525},[6166],{"type":427,"value":6167},"              \"",{"type":421,"tag":512,"props":6169,"children":6170},{"style":791},[6171],{"type":427,"value":6172},"%04d",{"type":421,"tag":512,"props":6174,"children":6175},{"style":531},[6176],{"type":427,"value":6177},"/",{"type":421,"tag":512,"props":6179,"children":6180},{"style":791},[6181],{"type":427,"value":6182},"%02d",{"type":421,"tag":512,"props":6184,"children":6185},{"style":531},[6186],{"type":427,"value":6177},{"type":421,"tag":512,"props":6188,"children":6189},{"style":791},[6190],{"type":427,"value":6182},{"type":421,"tag":512,"props":6192,"children":6193},{"style":531},[6194],{"type":427,"value":6150},{"type":421,"tag":512,"props":6196,"children":6197},{"style":791},[6198],{"type":427,"value":6182},{"type":421,"tag":512,"props":6200,"children":6201},{"style":531},[6202],{"type":427,"value":1617},{"type":421,"tag":512,"props":6204,"children":6205},{"style":791},[6206],{"type":427,"value":6182},{"type":421,"tag":512,"props":6208,"children":6209},{"style":531},[6210],{"type":427,"value":1617},{"type":421,"tag":512,"props":6212,"children":6213},{"style":791},[6214],{"type":427,"value":6182},{"type":421,"tag":512,"props":6216,"children":6217},{"style":531},[6218],{"type":427,"value":704},{"type":421,"tag":512,"props":6220,"children":6221},{"style":791},[6222],{"type":427,"value":6223},"%06d",{"type":421,"tag":512,"props":6225,"children":6226},{"style":791},[6227],{"type":427,"value":6228}," %s",{"type":421,"tag":512,"props":6230,"children":6231},{"style":791},[6232],{"type":427,"value":6228},{"type":421,"tag":512,"props":6234,"children":6235},{"style":525},[6236],{"type":427,"value":664},{"type":421,"tag":512,"props":6238,"children":6239},{"style":567},[6240],{"type":427,"value":4872},{"type":421,"tag":512,"props":6242,"children":6243},{"class":514,"line":840},[6244,6249,6253,6258,6263,6268],{"type":421,"tag":512,"props":6245,"children":6246},{"style":593},[6247],{"type":427,"value":6248},"              t",{"type":421,"tag":512,"props":6250,"children":6251},{"style":567},[6252],{"type":427,"value":704},{"type":421,"tag":512,"props":6254,"children":6255},{"style":593},[6256],{"type":427,"value":6257},"tm_year ",{"type":421,"tag":512,"props":6259,"children":6260},{"style":691},[6261],{"type":427,"value":6262},"+",{"type":421,"tag":512,"props":6264,"children":6265},{"style":853},[6266],{"type":427,"value":6267}," 1900",{"type":421,"tag":512,"props":6269,"children":6270},{"style":567},[6271],{"type":427,"value":4872},{"type":421,"tag":512,"props":6273,"children":6274},{"class":514,"line":863},[6275,6279,6283,6288,6292,6296],{"type":421,"tag":512,"props":6276,"children":6277},{"style":593},[6278],{"type":427,"value":6248},{"type":421,"tag":512,"props":6280,"children":6281},{"style":567},[6282],{"type":427,"value":704},{"type":421,"tag":512,"props":6284,"children":6285},{"style":593},[6286],{"type":427,"value":6287},"tm_mon ",{"type":421,"tag":512,"props":6289,"children":6290},{"style":691},[6291],{"type":427,"value":6262},{"type":421,"tag":512,"props":6293,"children":6294},{"style":853},[6295],{"type":427,"value":3070},{"type":421,"tag":512,"props":6297,"children":6298},{"style":567},[6299],{"type":427,"value":4872},{"type":421,"tag":512,"props":6301,"children":6302},{"class":514,"line":872},[6303,6307,6311,6316],{"type":421,"tag":512,"props":6304,"children":6305},{"style":593},[6306],{"type":427,"value":6248},{"type":421,"tag":512,"props":6308,"children":6309},{"style":567},[6310],{"type":427,"value":704},{"type":421,"tag":512,"props":6312,"children":6313},{"style":593},[6314],{"type":427,"value":6315},"tm_mday",{"type":421,"tag":512,"props":6317,"children":6318},{"style":567},[6319],{"type":427,"value":4872},{"type":421,"tag":512,"props":6321,"children":6322},{"class":514,"line":880},[6323,6327,6331,6336],{"type":421,"tag":512,"props":6324,"children":6325},{"style":593},[6326],{"type":427,"value":6248},{"type":421,"tag":512,"props":6328,"children":6329},{"style":567},[6330],{"type":427,"value":704},{"type":421,"tag":512,"props":6332,"children":6333},{"style":593},[6334],{"type":427,"value":6335},"tm_hour",{"type":421,"tag":512,"props":6337,"children":6338},{"style":567},[6339],{"type":427,"value":4872},{"type":421,"tag":512,"props":6341,"children":6342},{"class":514,"line":923},[6343,6347,6351,6356],{"type":421,"tag":512,"props":6344,"children":6345},{"style":593},[6346],{"type":427,"value":6248},{"type":421,"tag":512,"props":6348,"children":6349},{"style":567},[6350],{"type":427,"value":704},{"type":421,"tag":512,"props":6352,"children":6353},{"style":593},[6354],{"type":427,"value":6355},"tm_min",{"type":421,"tag":512,"props":6357,"children":6358},{"style":567},[6359],{"type":427,"value":4872},{"type":421,"tag":512,"props":6361,"children":6362},{"class":514,"line":964},[6363,6367,6371,6376],{"type":421,"tag":512,"props":6364,"children":6365},{"style":593},[6366],{"type":427,"value":6248},{"type":421,"tag":512,"props":6368,"children":6369},{"style":567},[6370],{"type":427,"value":704},{"type":421,"tag":512,"props":6372,"children":6373},{"style":593},[6374],{"type":427,"value":6375},"tm_sec",{"type":421,"tag":512,"props":6377,"children":6378},{"style":567},[6379],{"type":427,"value":4872},{"type":421,"tag":512,"props":6381,"children":6382},{"class":514,"line":972},[6383,6388,6392,6396,6400,6404,6408,6413,6418],{"type":421,"tag":512,"props":6384,"children":6385},{"style":691},[6386],{"type":427,"value":6387},"              static_cast\u003C",{"type":421,"tag":512,"props":6389,"children":6390},{"style":555},[6391],{"type":427,"value":558},{"type":421,"tag":512,"props":6393,"children":6394},{"style":691},[6395],{"type":427,"value":2499},{"type":421,"tag":512,"props":6397,"children":6398},{"style":567},[6399],{"type":427,"value":649},{"type":421,"tag":512,"props":6401,"children":6402},{"style":593},[6403],{"type":427,"value":5985},{"type":421,"tag":512,"props":6405,"children":6406},{"style":567},[6407],{"type":427,"value":704},{"type":421,"tag":512,"props":6409,"children":6410},{"style":593},[6411],{"type":427,"value":6412},"tv_usec",{"type":421,"tag":512,"props":6414,"children":6415},{"style":567},[6416],{"type":427,"value":6417},"),",{"type":421,"tag":512,"props":6419,"children":6420},{"style":1521},[6421],{"type":427,"value":6422}," // 毫秒\n",{"type":421,"tag":512,"props":6424,"children":6425},{"class":514,"line":993},[6426,6431,6435,6439,6443,6447],{"type":421,"tag":512,"props":6427,"children":6428},{"style":593},[6429],{"type":427,"value":6430},"              ss",{"type":421,"tag":512,"props":6432,"children":6433},{"style":567},[6434],{"type":427,"value":704},{"type":421,"tag":512,"props":6436,"children":6437},{"style":561},[6438],{"type":427,"value":3091},{"type":421,"tag":512,"props":6440,"children":6441},{"style":567},[6442],{"type":427,"value":827},{"type":421,"tag":512,"props":6444,"children":6445},{"style":561},[6446],{"type":427,"value":832},{"type":421,"tag":512,"props":6448,"children":6449},{"style":567},[6450],{"type":427,"value":5890},{"type":421,"tag":512,"props":6452,"children":6453},{"class":514,"line":1049},[6454,6459],{"type":421,"tag":512,"props":6455,"children":6456},{"style":593},[6457],{"type":427,"value":6458},"              logname",{"type":421,"tag":512,"props":6460,"children":6461},{"style":567},[6462],{"type":427,"value":679},{"type":421,"tag":6464,"props":6465,"children":6466},"style",{},[6467],{"type":427,"value":6468},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":415,"searchDepth":542,"depth":542,"links":6470},[6471,6472,6473,6474],{"id":431,"depth":542,"text":431},{"id":492,"depth":542,"text":492},{"id":3474,"depth":542,"text":3474},{"id":3487,"depth":542,"text":3487},"markdown","content:8.source-code:_cpp:kingdb.md","content","8.source-code/_cpp/kingdb.md","8.source-code/_cpp/kingdb","md",[6482,6483],{"_path":392,"title":391,"description":415},{"_path":6484,"title":6485,"description":415},"/source-code/_es/array-slice","Array.prototype.slice",1732808713814]