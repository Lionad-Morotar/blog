[{"data":1,"prerenderedAt":6460},["ShallowReactive",2],{"navigation":3,"/source-code/_cpp/kingdb":384,"/source-code/_cpp/kingdb-surround":6455},[4,35,86,105,132,138,144,150,378],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29,32],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🚝 四十二篇系列","/flows/fourty-two",{"title":15,"_path":16},"🌃 长夜梦","/flows/long-night-dream",{"title":18,"_path":19},"🌌 万物联结与幸福感","/flows/everything",{"title":21,"_path":22},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":24,"_path":25},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":27,"_path":28},"🌧️ 我的腼腆","/flows/shy",{"title":30,"_path":31},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":33,"_path":34},"📝 心流归档","/flows/archive",{"title":36,"_path":37,"children":38},"技术博客 / Coder","/articles",[39,41,44,47,50,53,56,59,62,65,68,71,74,77,80,83],{"title":40,"_path":37},"🦁 欢迎",{"title":42,"_path":43},"🥞 在 tailwind 中使用现代化 CSS Layers","/articles/tailwind-sass-and-css-layer",{"title":45,"_path":46},"💻 本地部署 Qwen 翻译网页","/articles/local-translator",{"title":48,"_path":49},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":51,"_path":52},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":54,"_path":55},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":57,"_path":58},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":60,"_path":61},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":63,"_path":64},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":66,"_path":67},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":69,"_path":70},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":72,"_path":73},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":75,"_path":76},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":78,"_path":79},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":81,"_path":82},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":84,"_path":85},"📝 技术博客归档","/articles/archive",{"title":87,"_path":88,"children":89},"造物 / Make","/tools",[90,93,96,99,102],{"title":91,"_path":92},"🥥 Coconut","/tools/coconut",{"title":94,"_path":95},"🧶 网易云音乐歌单排序","/tools/netease-sorter",{"title":97,"_path":98},"🌐 AnySort","/tools/anysort",{"title":100,"_path":101},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":103,"_path":104},"👓 Crapto","/tools/crypto-inline",{"title":106,"_path":107,"children":108},"吉他剧场 / Music","/music",[109,111,114,117,120,123,126,129],{"title":110,"_path":107},"🎸 FingerStyle！",{"title":112,"_path":113},"🌬️ 等待的风","/music/wind",{"title":115,"_path":116},"💕 约定的海洋","/music/ocean",{"title":118,"_path":119},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":121,"_path":122},"🌏 残酷天使的行动纲领","/music/eva",{"title":124,"_path":125},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":127,"_path":128},"🍷 Wu Wei","/music/wu-wei",{"title":130,"_path":131},"🌅 无题","/music/untitled",{"title":133,"_path":134,"children":135},"画点什么 / Paint","/paint",[136],{"title":137,"_path":134},"🚧 正在施工",{"title":139,"_path":140,"children":141},"读书笔记 / Notes","/books",[142],{"title":143,"_path":140},"📕 读书笔记",{"title":145,"_path":146,"children":147},"知识地图 / Maps","/maps",[148],{"title":149,"_path":146},"🏁 知识地图",{"title":151,"_path":152,"children":153},"零散的笔记 / Gists","/gists",[154,156,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255,258,261,264,267,270,273,276,279,282,285,288,291,294,297,300,303,306,309,312,315,318,321,324,327,330,333,336,339,342,345,348,351,354,357,360,363,366,369,372,375],{"title":155,"_path":152},"🧊 Gists",{"title":157,"_path":158},"网站的可访问性","/gists/accessibility",{"title":160,"_path":161},"Bit","/gists/bit",{"title":163,"_path":164},"图片模糊","/gists/blur",{"title":166,"_path":167},"渲染相关笔记","/gists/c4d",{"title":169,"_path":170},"CDN 问题记录","/gists/cdn",{"title":172,"_path":173},"消毒剂","/gists/cleaner",{"title":175,"_path":176},"Windows Command","/gists/cmd",{"title":178,"_path":179},"Command","/gists/command",{"title":181,"_path":182},"复杂科学","/gists/complexity-science",{"title":184,"_path":185},"GitHub Copilot","/gists/copilot",{"title":187,"_path":188},"宇宙","/gists/cosmos",{"title":190,"_path":191},"C++","/gists/cpp",{"title":193,"_path":194},"DEPRESSION","/gists/depression",{"title":196,"_path":197},"Developer Experience","/gists/developer-experience",{"title":199,"_path":200},"Device Metrics","/gists/device-metrix",{"title":202,"_path":203},"ECMAScript Language Specification","/gists/ecmascript-specification",{"title":205,"_path":206},"正则表达式","/gists/eegex",{"title":208,"_path":209},"Emoji","/gists/emoji",{"title":211,"_path":212},"工程","/gists/engineering",{"title":214,"_path":215},"熵","/gists/entropy",{"title":217,"_path":218},"Environment","/gists/environment",{"title":220,"_path":221},"Erlang","/gists/erlang",{"title":223,"_path":224},"逃离塔克夫","/gists/escape-from-tarkov",{"title":226,"_path":227},"ESNext (ES6-ES11)","/gists/esnext",{"title":229,"_path":230},"Eval！","/gists/eval",{"title":232,"_path":233},"Flutter","/gists/flutter",{"title":235,"_path":236},"字体","/gists/font",{"title":238,"_path":239},"JS 函数式编程","/gists/functional",{"title":241,"_path":242},"游戏化","/gists/gamification",{"title":244,"_path":245},"Google C++ Standard","/gists/google-cpp-standard",{"title":247,"_path":248},"双向链接完全体","/gists/graph",{"title":250,"_path":251},"Hardwares","/gists/hardwares",{"title":253,"_path":254},"哈希冲突","/gists/hash-collision",{"title":256,"_path":257},"信息设计","/gists/information-design",{"title":259,"_path":260},"InstantPage","/gists/instant.page",{"title":262,"_path":263},"ISUX 遇见大数据可视化系列","/gists/isux-data-visualization",{"title":265,"_path":266},"KVStore","/gists/key-value-db",{"title":268,"_path":269},"Kubernetes","/gists/kubernetes",{"title":271,"_path":272},"Makefile","/gists/makefile",{"title":274,"_path":275},"Markdown Inline Style","/gists/markdown-nice",{"title":277,"_path":278},"减小页面快照体积","/gists/minify-html",{"title":280,"_path":281},"mklink","/gists/mklink",{"title":283,"_path":284},"Mock","/gists/mock",{"title":286,"_path":287},"多人协作系统","/gists/multiplayer",{"title":289,"_path":290},"多端应用","/gists/multy-end-app",{"title":292,"_path":293},"神经科学","/gists/neuroscience",{"title":295,"_path":296},"Opinioned Personal Folder","/gists/opinioned-personal-folder",{"title":298,"_path":299},"PInvoke","/gists/pinvoke",{"title":301,"_path":302},"像素","/gists/pixel",{"title":304,"_path":305},"PowerShell","/gists/powershell",{"title":307,"_path":308},"量子","/gists/quantum",{"title":310,"_path":311},"保持好奇心","/gists/questions",{"title":313,"_path":314},"React Native","/gists/react-native",{"title":316,"_path":317},"博客改版碰到的浏览器平滑滚动问题","/gists/scroll",{"title":319,"_path":320},"SEO","/gists/seo",{"title":322,"_path":323},"Shader","/gists/shader",{"title":325,"_path":326},"Shape Up","/gists/shape-up",{"title":328,"_path":329},"睡觉","/gists/sleep",{"title":331,"_path":332},"记录奇怪的问题","/gists/solved",{"title":334,"_path":335},"States","/gists/states",{"title":337,"_path":338},"Storage","/gists/storage",{"title":340,"_path":341},"音视频流处理","/gists/stream-cli",{"title":343,"_path":344},"Symbol","/gists/symbol",{"title":346,"_path":347},"系统论","/gists/systems-theory",{"title":349,"_path":350},"任务切片","/gists/task-slice",{"title":352,"_path":353},"技术偏好","/gists/tech-dudge",{"title":355,"_path":356},"Untitled","/gists/untitled",{"title":358,"_path":359},"可变字体","/gists/variable-font",{"title":361,"_path":362},"视觉错觉","/gists/visual-illusion",{"title":364,"_path":365},"SS(SSR)","/gists/vpn",{"title":367,"_path":368},"VS Code 插件开发","/gists/vscode-plugin",{"title":370,"_path":371},"Web Components","/gists/web-components",{"title":373,"_path":374},"Windows","/gists/windows",{"title":376,"_path":377},"查缺补漏","/gists/wrong",{"title":379,"_path":380,"children":381},"我 / About","/hire",[382],{"title":383,"_path":380},"📬 技术简历",{"_path":385,"_dir":386,"_draft":387,"_partial":388,"_locale":389,"title":390,"description":389,"body":391,"_type":6449,"_id":6450,"_source":6451,"_file":6452,"_stem":6453,"_extension":6454},"/source-code/_cpp/kingdb","_cpp",false,true,"","KingDB",{"type":392,"children":393,"toc":6443},"root",[394,402,408,414,430,435,459,464,469,474,1333,1338,1346,1351,1356,1361,1367,1372,1793,1798,1803,2253,2258,2359,2364,2369,2374,2912,2918,2923,3190,3196,3201,3446,3451,3464,3469,3736,3741,3746,4457,4462,4643,4647,4652,5270,5275,5280,5333,5338,5357,5730,5735,5900,5905,5910,6437],{"type":395,"tag":396,"props":397,"children":399},"element","h1",{"id":398},"kingdb",[400],{"type":401,"value":390},"text",{"type":395,"tag":403,"props":404,"children":406},"h2",{"id":405},"概述",[407],{"type":401,"value":405},{"type":395,"tag":409,"props":410,"children":411},"p",{},[412],{"type":401,"value":413},"源码分两部分，从相关的测试文件，到核心源码。参考 IKVS 系列文章给的架构图，核心源码的阅读顺序沿着 Put、Delete、Get 三个接口，由 Database 一路向 Buffer、Event Manager、Storage Engine、HSTable Manager、File System 相关、Index 前进。最好再看相关快照、迭代器、Multipart 等部分。期间如果遇到简单的帮助函数会先讲帮助函数。",{"type":395,"tag":409,"props":415,"children":416},{},[417,419,428],{"type":401,"value":418},"本来想从第一个 Git Commit 开始看起的。但我 checkout 过去之后，碰到了一堆编译问题，根本跑不通，索性就直接回到 master 来看最新代码了。本文章的源码快照见 ",{"type":395,"tag":420,"props":421,"children":425},"a",{"href":422,"rel":423},"https://github.com/goossaert/kingdb/tree/58994280e789fc7248d61371f03a6c04c844c197",[424],"nofollow",[426],{"type":401,"value":427},"KingDB@58994",{"type":401,"value":429},"。阅读源码前可以先看一下 KingDB 的 Readme：doc/kingdb.md 以及 doc/kingserver.md。",{"type":395,"tag":409,"props":431,"children":432},{},[433],{"type":401,"value":434},"下文可能出现的缩写：",{"type":395,"tag":436,"props":437,"children":438},"ul",{},[439,445],{"type":395,"tag":440,"props":441,"children":442},"li",{},[443],{"type":401,"value":444},"KDB：KingDB，泛指，有时指 KingDB 程序，有时指 KingDB 源码。",{"type":395,"tag":440,"props":446,"children":447},{},[448,450,457],{"type":401,"value":449},"IKVS：作者相关 KingDB 做的一些调研及笔记的博客系列。这个系列从 13 年开始写，现在还没写完... 见 ",{"type":395,"tag":420,"props":451,"children":454},{"href":452,"rel":453},"https://codecapsule.com/2012/11/07/ikvs-implementing-a-key-value-store-table-of-contents/",[424],[455],{"type":401,"value":456},"IKVS",{"type":401,"value":458},"。",{"type":395,"tag":409,"props":460,"children":461},{},[462],{"type":401,"value":463},"另，为了简便起见，下文给出的代码很可能并非原本的代码，而是截取或经过剔除后的部分代码。比如说，去除了某函数中的错误处理，使之代码更短，更容易展示。",{"type":395,"tag":403,"props":465,"children":467},{"id":466},"从测试开始",[468],{"type":401,"value":466},{"type":395,"tag":409,"props":470,"children":471},{},[472],{"type":401,"value":473},"Emmanuel 给了一个典型的 KDB 用户使用示例，见 unit-tests/kingdb_user.cc。通过此示例，能大概了解 KDB 的接口及如何使用该接口。创建数据库、存入、读取前都需要创建对应的参数配置 Options；这些动作通过 Status 对象来回传操作成功与否。",{"type":395,"tag":475,"props":476,"children":480},"pre",{"code":477,"language":478,"meta":389,"className":479,"style":389},"#include \u003Ckingdb/kdb.h>\n\nint main() {\n  kdb::Status s;\n  kdb::DatabaseOptions db_options;\n  kdb::Database db(db_options, \"mylocaldb\");\n  s = db.Open();\n  if (!s.IsOK()) {\n    fprintf(stderr, \"Could not open the database: %s\\n\", s.ToString().c_str());\n    exit(1);\n  }\n\n  std::string key1(\"key1\");\n  std::string value1(\"value1\");\n\n  kdb::WriteOptions write_options;\n  s = db.Put(write_options, key1, value1);\n\n  kdb::ReadOptions read_options;\n  std::string out_str;\n  s = db.Get(read_options, key1, &out_str);\n  if (s.IsOK() && out_str == \"value1\") {\n    printf(\"Data successfully stored and retrieved\\n\"); \n  } else {\n    printf(\"An error occurred\\n\"); \n  }\n\n  return 0;\n}\n","cpp","language-cpp shiki shiki-themes material-theme-lighter github-light github-dark monokai",[481],{"type":395,"tag":482,"props":483,"children":484},"code",{"__ignoreMap":389},[485,514,523,550,576,597,654,689,731,812,835,844,852,895,936,944,965,1021,1029,1050,1071,1131,1195,1235,1253,1290,1298,1306,1324],{"type":395,"tag":486,"props":487,"children":490},"span",{"class":488,"line":489},"line",1,[491,497,503,509],{"type":395,"tag":486,"props":492,"children":494},{"style":493},"--shiki-light:#39ADB5;--shiki-light-font-style:italic;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#F92672;--shiki-sepia-font-style:inherit",[495],{"type":401,"value":496},"#include",{"type":395,"tag":486,"props":498,"children":500},{"style":499},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[501],{"type":401,"value":502}," \u003C",{"type":395,"tag":486,"props":504,"children":506},{"style":505},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[507],{"type":401,"value":508},"kingdb/kdb.h",{"type":395,"tag":486,"props":510,"children":511},{"style":499},[512],{"type":401,"value":513},">\n",{"type":395,"tag":486,"props":515,"children":517},{"class":488,"line":516},2,[518],{"type":395,"tag":486,"props":519,"children":520},{"emptyLinePlaceholder":388},[521],{"type":401,"value":522},"\n",{"type":395,"tag":486,"props":524,"children":526},{"class":488,"line":525},3,[527,533,539,545],{"type":395,"tag":486,"props":528,"children":530},{"style":529},"--shiki-light:#9C3EDA;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic",[531],{"type":401,"value":532},"int",{"type":395,"tag":486,"props":534,"children":536},{"style":535},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[537],{"type":401,"value":538}," main",{"type":395,"tag":486,"props":540,"children":542},{"style":541},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[543],{"type":401,"value":544},"()",{"type":395,"tag":486,"props":546,"children":547},{"style":541},[548],{"type":401,"value":549}," {\n",{"type":395,"tag":486,"props":551,"children":553},{"class":488,"line":552},4,[554,560,565,571],{"type":395,"tag":486,"props":555,"children":557},{"style":556},"--shiki-light:#E2931D;--shiki-light-text-decoration:inherit;--shiki-default:#6F42C1;--shiki-default-text-decoration:inherit;--shiki-dark:#B392F0;--shiki-dark-text-decoration:inherit;--shiki-sepia:#A6E22E;--shiki-sepia-text-decoration:underline",[558],{"type":401,"value":559},"  kdb",{"type":395,"tag":486,"props":561,"children":562},{"style":541},[563],{"type":401,"value":564},"::",{"type":395,"tag":486,"props":566,"children":568},{"style":567},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[569],{"type":401,"value":570},"Status s",{"type":395,"tag":486,"props":572,"children":573},{"style":541},[574],{"type":401,"value":575},";\n",{"type":395,"tag":486,"props":577,"children":579},{"class":488,"line":578},5,[580,584,588,593],{"type":395,"tag":486,"props":581,"children":582},{"style":556},[583],{"type":401,"value":559},{"type":395,"tag":486,"props":585,"children":586},{"style":541},[587],{"type":401,"value":564},{"type":395,"tag":486,"props":589,"children":590},{"style":567},[591],{"type":401,"value":592},"DatabaseOptions db_options",{"type":395,"tag":486,"props":594,"children":595},{"style":541},[596],{"type":401,"value":575},{"type":395,"tag":486,"props":598,"children":600},{"class":488,"line":599},6,[601,605,609,614,619,624,629,634,639,644,649],{"type":395,"tag":486,"props":602,"children":603},{"style":556},[604],{"type":401,"value":559},{"type":395,"tag":486,"props":606,"children":607},{"style":541},[608],{"type":401,"value":564},{"type":395,"tag":486,"props":610,"children":611},{"style":567},[612],{"type":401,"value":613},"Database ",{"type":395,"tag":486,"props":615,"children":616},{"style":535},[617],{"type":401,"value":618},"db",{"type":395,"tag":486,"props":620,"children":621},{"style":541},[622],{"type":401,"value":623},"(",{"type":395,"tag":486,"props":625,"children":626},{"style":567},[627],{"type":401,"value":628},"db_options",{"type":395,"tag":486,"props":630,"children":631},{"style":541},[632],{"type":401,"value":633},",",{"type":395,"tag":486,"props":635,"children":636},{"style":499},[637],{"type":401,"value":638}," \"",{"type":395,"tag":486,"props":640,"children":641},{"style":505},[642],{"type":401,"value":643},"mylocaldb",{"type":395,"tag":486,"props":645,"children":646},{"style":499},[647],{"type":401,"value":648},"\"",{"type":395,"tag":486,"props":650,"children":651},{"style":541},[652],{"type":401,"value":653},");\n",{"type":395,"tag":486,"props":655,"children":657},{"class":488,"line":656},7,[658,663,669,674,679,684],{"type":395,"tag":486,"props":659,"children":660},{"style":567},[661],{"type":401,"value":662},"  s ",{"type":395,"tag":486,"props":664,"children":666},{"style":665},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[667],{"type":401,"value":668},"=",{"type":395,"tag":486,"props":670,"children":671},{"style":567},[672],{"type":401,"value":673}," db",{"type":395,"tag":486,"props":675,"children":676},{"style":541},[677],{"type":401,"value":678},".",{"type":395,"tag":486,"props":680,"children":681},{"style":535},[682],{"type":401,"value":683},"Open",{"type":395,"tag":486,"props":685,"children":686},{"style":541},[687],{"type":401,"value":688},"();\n",{"type":395,"tag":486,"props":690,"children":692},{"class":488,"line":691},8,[693,698,703,708,713,717,722,727],{"type":395,"tag":486,"props":694,"children":695},{"style":493},[696],{"type":401,"value":697},"  if",{"type":395,"tag":486,"props":699,"children":700},{"style":541},[701],{"type":401,"value":702}," (",{"type":395,"tag":486,"props":704,"children":705},{"style":665},[706],{"type":401,"value":707},"!",{"type":395,"tag":486,"props":709,"children":710},{"style":567},[711],{"type":401,"value":712},"s",{"type":395,"tag":486,"props":714,"children":715},{"style":541},[716],{"type":401,"value":678},{"type":395,"tag":486,"props":718,"children":719},{"style":535},[720],{"type":401,"value":721},"IsOK",{"type":395,"tag":486,"props":723,"children":724},{"style":541},[725],{"type":401,"value":726},"())",{"type":395,"tag":486,"props":728,"children":729},{"style":541},[730],{"type":401,"value":549},{"type":395,"tag":486,"props":732,"children":734},{"class":488,"line":733},9,[735,740,744,750,754,758,763,769,775,779,783,788,792,797,802,807],{"type":395,"tag":486,"props":736,"children":737},{"style":535},[738],{"type":401,"value":739},"    fprintf",{"type":395,"tag":486,"props":741,"children":742},{"style":541},[743],{"type":401,"value":623},{"type":395,"tag":486,"props":745,"children":747},{"style":746},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[748],{"type":401,"value":749},"stderr",{"type":395,"tag":486,"props":751,"children":752},{"style":541},[753],{"type":401,"value":633},{"type":395,"tag":486,"props":755,"children":756},{"style":499},[757],{"type":401,"value":638},{"type":395,"tag":486,"props":759,"children":760},{"style":505},[761],{"type":401,"value":762},"Could not open the database: ",{"type":395,"tag":486,"props":764,"children":766},{"style":765},"--shiki-light:#E53935;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[767],{"type":401,"value":768},"%s",{"type":395,"tag":486,"props":770,"children":772},{"style":771},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[773],{"type":401,"value":774},"\\n",{"type":395,"tag":486,"props":776,"children":777},{"style":499},[778],{"type":401,"value":648},{"type":395,"tag":486,"props":780,"children":781},{"style":541},[782],{"type":401,"value":633},{"type":395,"tag":486,"props":784,"children":785},{"style":567},[786],{"type":401,"value":787}," s",{"type":395,"tag":486,"props":789,"children":790},{"style":541},[791],{"type":401,"value":678},{"type":395,"tag":486,"props":793,"children":794},{"style":535},[795],{"type":401,"value":796},"ToString",{"type":395,"tag":486,"props":798,"children":799},{"style":541},[800],{"type":401,"value":801},"().",{"type":395,"tag":486,"props":803,"children":804},{"style":535},[805],{"type":401,"value":806},"c_str",{"type":395,"tag":486,"props":808,"children":809},{"style":541},[810],{"type":401,"value":811},"());\n",{"type":395,"tag":486,"props":813,"children":815},{"class":488,"line":814},10,[816,821,825,831],{"type":395,"tag":486,"props":817,"children":818},{"style":535},[819],{"type":401,"value":820},"    exit",{"type":395,"tag":486,"props":822,"children":823},{"style":541},[824],{"type":401,"value":623},{"type":395,"tag":486,"props":826,"children":828},{"style":827},"--shiki-light:#F76D47;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[829],{"type":401,"value":830},"1",{"type":395,"tag":486,"props":832,"children":833},{"style":541},[834],{"type":401,"value":653},{"type":395,"tag":486,"props":836,"children":838},{"class":488,"line":837},11,[839],{"type":395,"tag":486,"props":840,"children":841},{"style":541},[842],{"type":401,"value":843},"  }\n",{"type":395,"tag":486,"props":845,"children":847},{"class":488,"line":846},12,[848],{"type":395,"tag":486,"props":849,"children":850},{"emptyLinePlaceholder":388},[851],{"type":401,"value":522},{"type":395,"tag":486,"props":853,"children":855},{"class":488,"line":854},13,[856,861,865,870,875,879,883,887,891],{"type":395,"tag":486,"props":857,"children":858},{"style":556},[859],{"type":401,"value":860},"  std",{"type":395,"tag":486,"props":862,"children":863},{"style":541},[864],{"type":401,"value":564},{"type":395,"tag":486,"props":866,"children":867},{"style":567},[868],{"type":401,"value":869},"string ",{"type":395,"tag":486,"props":871,"children":872},{"style":535},[873],{"type":401,"value":874},"key1",{"type":395,"tag":486,"props":876,"children":877},{"style":541},[878],{"type":401,"value":623},{"type":395,"tag":486,"props":880,"children":881},{"style":499},[882],{"type":401,"value":648},{"type":395,"tag":486,"props":884,"children":885},{"style":505},[886],{"type":401,"value":874},{"type":395,"tag":486,"props":888,"children":889},{"style":499},[890],{"type":401,"value":648},{"type":395,"tag":486,"props":892,"children":893},{"style":541},[894],{"type":401,"value":653},{"type":395,"tag":486,"props":896,"children":898},{"class":488,"line":897},14,[899,903,907,911,916,920,924,928,932],{"type":395,"tag":486,"props":900,"children":901},{"style":556},[902],{"type":401,"value":860},{"type":395,"tag":486,"props":904,"children":905},{"style":541},[906],{"type":401,"value":564},{"type":395,"tag":486,"props":908,"children":909},{"style":567},[910],{"type":401,"value":869},{"type":395,"tag":486,"props":912,"children":913},{"style":535},[914],{"type":401,"value":915},"value1",{"type":395,"tag":486,"props":917,"children":918},{"style":541},[919],{"type":401,"value":623},{"type":395,"tag":486,"props":921,"children":922},{"style":499},[923],{"type":401,"value":648},{"type":395,"tag":486,"props":925,"children":926},{"style":505},[927],{"type":401,"value":915},{"type":395,"tag":486,"props":929,"children":930},{"style":499},[931],{"type":401,"value":648},{"type":395,"tag":486,"props":933,"children":934},{"style":541},[935],{"type":401,"value":653},{"type":395,"tag":486,"props":937,"children":939},{"class":488,"line":938},15,[940],{"type":395,"tag":486,"props":941,"children":942},{"emptyLinePlaceholder":388},[943],{"type":401,"value":522},{"type":395,"tag":486,"props":945,"children":947},{"class":488,"line":946},16,[948,952,956,961],{"type":395,"tag":486,"props":949,"children":950},{"style":556},[951],{"type":401,"value":559},{"type":395,"tag":486,"props":953,"children":954},{"style":541},[955],{"type":401,"value":564},{"type":395,"tag":486,"props":957,"children":958},{"style":567},[959],{"type":401,"value":960},"WriteOptions write_options",{"type":395,"tag":486,"props":962,"children":963},{"style":541},[964],{"type":401,"value":575},{"type":395,"tag":486,"props":966,"children":968},{"class":488,"line":967},17,[969,973,977,981,985,990,994,999,1003,1008,1012,1017],{"type":395,"tag":486,"props":970,"children":971},{"style":567},[972],{"type":401,"value":662},{"type":395,"tag":486,"props":974,"children":975},{"style":665},[976],{"type":401,"value":668},{"type":395,"tag":486,"props":978,"children":979},{"style":567},[980],{"type":401,"value":673},{"type":395,"tag":486,"props":982,"children":983},{"style":541},[984],{"type":401,"value":678},{"type":395,"tag":486,"props":986,"children":987},{"style":535},[988],{"type":401,"value":989},"Put",{"type":395,"tag":486,"props":991,"children":992},{"style":541},[993],{"type":401,"value":623},{"type":395,"tag":486,"props":995,"children":996},{"style":567},[997],{"type":401,"value":998},"write_options",{"type":395,"tag":486,"props":1000,"children":1001},{"style":541},[1002],{"type":401,"value":633},{"type":395,"tag":486,"props":1004,"children":1005},{"style":567},[1006],{"type":401,"value":1007}," key1",{"type":395,"tag":486,"props":1009,"children":1010},{"style":541},[1011],{"type":401,"value":633},{"type":395,"tag":486,"props":1013,"children":1014},{"style":567},[1015],{"type":401,"value":1016}," value1",{"type":395,"tag":486,"props":1018,"children":1019},{"style":541},[1020],{"type":401,"value":653},{"type":395,"tag":486,"props":1022,"children":1024},{"class":488,"line":1023},18,[1025],{"type":395,"tag":486,"props":1026,"children":1027},{"emptyLinePlaceholder":388},[1028],{"type":401,"value":522},{"type":395,"tag":486,"props":1030,"children":1032},{"class":488,"line":1031},19,[1033,1037,1041,1046],{"type":395,"tag":486,"props":1034,"children":1035},{"style":556},[1036],{"type":401,"value":559},{"type":395,"tag":486,"props":1038,"children":1039},{"style":541},[1040],{"type":401,"value":564},{"type":395,"tag":486,"props":1042,"children":1043},{"style":567},[1044],{"type":401,"value":1045},"ReadOptions read_options",{"type":395,"tag":486,"props":1047,"children":1048},{"style":541},[1049],{"type":401,"value":575},{"type":395,"tag":486,"props":1051,"children":1053},{"class":488,"line":1052},20,[1054,1058,1062,1067],{"type":395,"tag":486,"props":1055,"children":1056},{"style":556},[1057],{"type":401,"value":860},{"type":395,"tag":486,"props":1059,"children":1060},{"style":541},[1061],{"type":401,"value":564},{"type":395,"tag":486,"props":1063,"children":1064},{"style":567},[1065],{"type":401,"value":1066},"string out_str",{"type":395,"tag":486,"props":1068,"children":1069},{"style":541},[1070],{"type":401,"value":575},{"type":395,"tag":486,"props":1072,"children":1074},{"class":488,"line":1073},21,[1075,1079,1083,1087,1091,1096,1100,1105,1109,1113,1117,1122,1127],{"type":395,"tag":486,"props":1076,"children":1077},{"style":567},[1078],{"type":401,"value":662},{"type":395,"tag":486,"props":1080,"children":1081},{"style":665},[1082],{"type":401,"value":668},{"type":395,"tag":486,"props":1084,"children":1085},{"style":567},[1086],{"type":401,"value":673},{"type":395,"tag":486,"props":1088,"children":1089},{"style":541},[1090],{"type":401,"value":678},{"type":395,"tag":486,"props":1092,"children":1093},{"style":535},[1094],{"type":401,"value":1095},"Get",{"type":395,"tag":486,"props":1097,"children":1098},{"style":541},[1099],{"type":401,"value":623},{"type":395,"tag":486,"props":1101,"children":1102},{"style":567},[1103],{"type":401,"value":1104},"read_options",{"type":395,"tag":486,"props":1106,"children":1107},{"style":541},[1108],{"type":401,"value":633},{"type":395,"tag":486,"props":1110,"children":1111},{"style":567},[1112],{"type":401,"value":1007},{"type":395,"tag":486,"props":1114,"children":1115},{"style":541},[1116],{"type":401,"value":633},{"type":395,"tag":486,"props":1118,"children":1119},{"style":665},[1120],{"type":401,"value":1121}," &",{"type":395,"tag":486,"props":1123,"children":1124},{"style":567},[1125],{"type":401,"value":1126},"out_str",{"type":395,"tag":486,"props":1128,"children":1129},{"style":541},[1130],{"type":401,"value":653},{"type":395,"tag":486,"props":1132,"children":1134},{"class":488,"line":1133},22,[1135,1139,1143,1147,1151,1155,1159,1164,1169,1174,1178,1182,1186,1191],{"type":395,"tag":486,"props":1136,"children":1137},{"style":493},[1138],{"type":401,"value":697},{"type":395,"tag":486,"props":1140,"children":1141},{"style":541},[1142],{"type":401,"value":702},{"type":395,"tag":486,"props":1144,"children":1145},{"style":567},[1146],{"type":401,"value":712},{"type":395,"tag":486,"props":1148,"children":1149},{"style":541},[1150],{"type":401,"value":678},{"type":395,"tag":486,"props":1152,"children":1153},{"style":535},[1154],{"type":401,"value":721},{"type":395,"tag":486,"props":1156,"children":1157},{"style":541},[1158],{"type":401,"value":544},{"type":395,"tag":486,"props":1160,"children":1161},{"style":665},[1162],{"type":401,"value":1163}," &&",{"type":395,"tag":486,"props":1165,"children":1166},{"style":567},[1167],{"type":401,"value":1168}," out_str ",{"type":395,"tag":486,"props":1170,"children":1171},{"style":665},[1172],{"type":401,"value":1173},"==",{"type":395,"tag":486,"props":1175,"children":1176},{"style":499},[1177],{"type":401,"value":638},{"type":395,"tag":486,"props":1179,"children":1180},{"style":505},[1181],{"type":401,"value":915},{"type":395,"tag":486,"props":1183,"children":1184},{"style":499},[1185],{"type":401,"value":648},{"type":395,"tag":486,"props":1187,"children":1188},{"style":541},[1189],{"type":401,"value":1190},")",{"type":395,"tag":486,"props":1192,"children":1193},{"style":541},[1194],{"type":401,"value":549},{"type":395,"tag":486,"props":1196,"children":1198},{"class":488,"line":1197},23,[1199,1204,1208,1212,1217,1221,1225,1230],{"type":395,"tag":486,"props":1200,"children":1201},{"style":535},[1202],{"type":401,"value":1203},"    printf",{"type":395,"tag":486,"props":1205,"children":1206},{"style":541},[1207],{"type":401,"value":623},{"type":395,"tag":486,"props":1209,"children":1210},{"style":499},[1211],{"type":401,"value":648},{"type":395,"tag":486,"props":1213,"children":1214},{"style":505},[1215],{"type":401,"value":1216},"Data successfully stored and retrieved",{"type":395,"tag":486,"props":1218,"children":1219},{"style":771},[1220],{"type":401,"value":774},{"type":395,"tag":486,"props":1222,"children":1223},{"style":499},[1224],{"type":401,"value":648},{"type":395,"tag":486,"props":1226,"children":1227},{"style":541},[1228],{"type":401,"value":1229},");",{"type":395,"tag":486,"props":1231,"children":1232},{"style":746},[1233],{"type":401,"value":1234}," \n",{"type":395,"tag":486,"props":1236,"children":1238},{"class":488,"line":1237},24,[1239,1244,1249],{"type":395,"tag":486,"props":1240,"children":1241},{"style":541},[1242],{"type":401,"value":1243},"  }",{"type":395,"tag":486,"props":1245,"children":1246},{"style":493},[1247],{"type":401,"value":1248}," else",{"type":395,"tag":486,"props":1250,"children":1251},{"style":541},[1252],{"type":401,"value":549},{"type":395,"tag":486,"props":1254,"children":1256},{"class":488,"line":1255},25,[1257,1261,1265,1269,1274,1278,1282,1286],{"type":395,"tag":486,"props":1258,"children":1259},{"style":535},[1260],{"type":401,"value":1203},{"type":395,"tag":486,"props":1262,"children":1263},{"style":541},[1264],{"type":401,"value":623},{"type":395,"tag":486,"props":1266,"children":1267},{"style":499},[1268],{"type":401,"value":648},{"type":395,"tag":486,"props":1270,"children":1271},{"style":505},[1272],{"type":401,"value":1273},"An error occurred",{"type":395,"tag":486,"props":1275,"children":1276},{"style":771},[1277],{"type":401,"value":774},{"type":395,"tag":486,"props":1279,"children":1280},{"style":499},[1281],{"type":401,"value":648},{"type":395,"tag":486,"props":1283,"children":1284},{"style":541},[1285],{"type":401,"value":1229},{"type":395,"tag":486,"props":1287,"children":1288},{"style":746},[1289],{"type":401,"value":1234},{"type":395,"tag":486,"props":1291,"children":1293},{"class":488,"line":1292},26,[1294],{"type":395,"tag":486,"props":1295,"children":1296},{"style":541},[1297],{"type":401,"value":843},{"type":395,"tag":486,"props":1299,"children":1301},{"class":488,"line":1300},27,[1302],{"type":395,"tag":486,"props":1303,"children":1304},{"emptyLinePlaceholder":388},[1305],{"type":401,"value":522},{"type":395,"tag":486,"props":1307,"children":1309},{"class":488,"line":1308},28,[1310,1315,1320],{"type":395,"tag":486,"props":1311,"children":1312},{"style":493},[1313],{"type":401,"value":1314},"  return",{"type":395,"tag":486,"props":1316,"children":1317},{"style":827},[1318],{"type":401,"value":1319}," 0",{"type":395,"tag":486,"props":1321,"children":1322},{"style":541},[1323],{"type":401,"value":575},{"type":395,"tag":486,"props":1325,"children":1327},{"class":488,"line":1326},29,[1328],{"type":395,"tag":486,"props":1329,"children":1330},{"style":541},[1331],{"type":401,"value":1332},"}\n",{"type":395,"tag":409,"props":1334,"children":1335},{},[1336],{"type":401,"value":1337},"测试的入口文件是 unit-tests/test_db.cc。以我看过的 JS 库来看，这是一个基本的功能测试。编译好 KDB 之后，运行编译出的二进制文件 test_db 可以开始测试。测试结果输出到控制台，如下代码所示。",{"type":395,"tag":475,"props":1339,"children":1341},{"code":1340},"==== Test DBTest.CloseAndReopen\n==== Test DBTest.RepairInvalidDatabaseOptionFile\n==== Test DBTest.KeysWithNullBytes\n==== Test DBTest.TestStringInterface\nDatabase Options: Stage 0 - Incompressible data with LZ4 compression enabled\nDatabase Options: Stage 1 - Compressible data with LZ4 compression enabled\nDatabase Options: Stage 2 - Compression disabled\nDatabase Options: Stage 3 - 64-bit MurmurHash3\nDatabase Options: Stage 4 - Checksum verification with incompressible data\nDatabase Options: Stage 5 - Checksum verification with compressible data\nDatabase Options: Stage 6 - Checksum verification with compression disabled\nDatabase Options: Stage 7 - Synced writes\nDatabase Options: Stage 8 - Small-sized HSTables with compression disabled\nDatabase Options: Stage 9 - Small-sized HSTables with incompressible data and LZ4 compression\nDatabase Options: Stage 10 - Small-sized HSTables with compressible data and LZ4 compression\nDatabase Options: Stage 11 - Direct mode for Write Buffer (incompressible data with LZ4 compression enabled)\nDatabase Options: Stage 12 - Direct mode for Write Buffer (compressible data with LZ4 compression enabled)\n==== Test DBTest.MultipartReader\n// the same with last stages\n==== Test DBTest.SingleThreadSmallEntries\n// the same with last stages\n==== Test DBTest.SingleThreadSnapshot\n// the same with last stages\n==== Test DBTest.SingleThreadSmallEntriesCompaction\n// the same with last stages\n==== Test DBTest.SequentialIterator\n// the same with last stages\n==== Test DBTest.SingleThreadSingleLargeEntry\n// the same with last stages\n==== Test DBTest.FileUtil\nmysize: 268435456\nOK\n89 ms\nFree size: 944 GB\n==== PASSED 11 tests\n",[1342],{"type":395,"tag":482,"props":1343,"children":1344},{"__ignoreMap":389},[1345],{"type":401,"value":1340},{"type":395,"tag":409,"props":1347,"children":1348},{},[1349],{"type":401,"value":1350},"每个功能点如数据库初始化和关闭 CloseAndReopen、存入带结束符的键 KeysWithNullBytes 都使用对应继承了 DBTest 的测试类进行测试。涉及到与数据库交互的功能部分如 TestStringInterface 使用循环，遍历了所有数据库 Options 可以设置的情况（但是只是二维循环，没有测试参数间的组合）。即对应上文的 Stage 1、Stage 2...",{"type":395,"tag":409,"props":1352,"children":1353},{},[1354],{"type":401,"value":1355},"在 test_db 创建相应的测试类时，会自动调用测试套件（unit-tests/testharness.cc）中的 RegisterTest 把测试函数储存起来。以便运行测试时，通过读取环境变量来判断是否要跳过某类测试。",{"type":395,"tag":409,"props":1357,"children":1358},{},[1359],{"type":401,"value":1360},"测试代码的实现还有一些有意思的地方，以下提及。",{"type":395,"tag":1362,"props":1363,"children":1365},"h4",{"id":1364},"信号处理",[1366],{"type":401,"value":1364},{"type":395,"tag":409,"props":1368,"children":1369},{},[1370],{"type":401,"value":1371},"和数据库核心的入口函数一样，使用 signal 挂载了对 SIGSEGV、SIGABRT 信号的处理。这两个信号分别指代系统内存错误和系统中断。而处理函数非常简单，就是 IKVS 中提到的“let it die”风格：输出调用栈，立马结束程序。",{"type":395,"tag":475,"props":1373,"children":1375},{"code":1374,"language":478,"meta":389,"className":479,"style":389},"void handler(int sig) {\n  int depth_max = 20;\n  void *array[depth_max];\n  size_t depth;\n  // backtrace 将前 depth_max 层栈帧记录到 array 数组中，\n  // 再通过 backtrace_symbols_fd 输出到 stderr。\n  // 文档见：https://man7.org/linux/man-pages/man3/backtrace.3.html\n  depth = backtrace(array, depth_max);\n  fprintf(stderr, \"Error: signal %d:\\n\", sig);\n  backtrace_symbols_fd(array, depth, STDERR_FILENO);\n  exit(1);\n}\nint main() {\n  signal(SIGSEGV, handler);\n  signal(SIGABRT, handler);\n  return kdb::test::RunAllTests();\n}\n",[1376],{"type":395,"tag":482,"props":1377,"children":1378},{"__ignoreMap":389},[1379,1414,1440,1473,1490,1499,1507,1515,1553,1612,1649,1669,1676,1695,1724,1752,1786],{"type":395,"tag":486,"props":1380,"children":1381},{"class":488,"line":489},[1382,1387,1392,1396,1400,1406,1410],{"type":395,"tag":486,"props":1383,"children":1384},{"style":529},[1385],{"type":401,"value":1386},"void",{"type":395,"tag":486,"props":1388,"children":1389},{"style":535},[1390],{"type":401,"value":1391}," handler",{"type":395,"tag":486,"props":1393,"children":1394},{"style":541},[1395],{"type":401,"value":623},{"type":395,"tag":486,"props":1397,"children":1398},{"style":529},[1399],{"type":401,"value":532},{"type":395,"tag":486,"props":1401,"children":1403},{"style":1402},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#E36209;--shiki-default-font-style:inherit;--shiki-dark:#FFAB70;--shiki-dark-font-style:inherit;--shiki-sepia:#FD971F;--shiki-sepia-font-style:italic",[1404],{"type":401,"value":1405}," sig",{"type":395,"tag":486,"props":1407,"children":1408},{"style":541},[1409],{"type":401,"value":1190},{"type":395,"tag":486,"props":1411,"children":1412},{"style":541},[1413],{"type":401,"value":549},{"type":395,"tag":486,"props":1415,"children":1416},{"class":488,"line":516},[1417,1422,1427,1431,1436],{"type":395,"tag":486,"props":1418,"children":1419},{"style":529},[1420],{"type":401,"value":1421},"  int",{"type":395,"tag":486,"props":1423,"children":1424},{"style":567},[1425],{"type":401,"value":1426}," depth_max ",{"type":395,"tag":486,"props":1428,"children":1429},{"style":665},[1430],{"type":401,"value":668},{"type":395,"tag":486,"props":1432,"children":1433},{"style":827},[1434],{"type":401,"value":1435}," 20",{"type":395,"tag":486,"props":1437,"children":1438},{"style":541},[1439],{"type":401,"value":575},{"type":395,"tag":486,"props":1441,"children":1442},{"class":488,"line":525},[1443,1448,1453,1458,1463,1468],{"type":395,"tag":486,"props":1444,"children":1445},{"style":529},[1446],{"type":401,"value":1447},"  void",{"type":395,"tag":486,"props":1449,"children":1450},{"style":665},[1451],{"type":401,"value":1452}," *",{"type":395,"tag":486,"props":1454,"children":1455},{"style":567},[1456],{"type":401,"value":1457},"array",{"type":395,"tag":486,"props":1459,"children":1460},{"style":541},[1461],{"type":401,"value":1462},"[",{"type":395,"tag":486,"props":1464,"children":1465},{"style":567},[1466],{"type":401,"value":1467},"depth_max",{"type":395,"tag":486,"props":1469,"children":1470},{"style":541},[1471],{"type":401,"value":1472},"];\n",{"type":395,"tag":486,"props":1474,"children":1475},{"class":488,"line":552},[1476,1481,1486],{"type":395,"tag":486,"props":1477,"children":1478},{"style":529},[1479],{"type":401,"value":1480},"  size_t",{"type":395,"tag":486,"props":1482,"children":1483},{"style":567},[1484],{"type":401,"value":1485}," depth",{"type":395,"tag":486,"props":1487,"children":1488},{"style":541},[1489],{"type":401,"value":575},{"type":395,"tag":486,"props":1491,"children":1492},{"class":488,"line":578},[1493],{"type":395,"tag":486,"props":1494,"children":1496},{"style":1495},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit",[1497],{"type":401,"value":1498},"  // backtrace 将前 depth_max 层栈帧记录到 array 数组中，\n",{"type":395,"tag":486,"props":1500,"children":1501},{"class":488,"line":599},[1502],{"type":395,"tag":486,"props":1503,"children":1504},{"style":1495},[1505],{"type":401,"value":1506},"  // 再通过 backtrace_symbols_fd 输出到 stderr。\n",{"type":395,"tag":486,"props":1508,"children":1509},{"class":488,"line":656},[1510],{"type":395,"tag":486,"props":1511,"children":1512},{"style":1495},[1513],{"type":401,"value":1514},"  // 文档见：https://man7.org/linux/man-pages/man3/backtrace.3.html\n",{"type":395,"tag":486,"props":1516,"children":1517},{"class":488,"line":691},[1518,1523,1527,1532,1536,1540,1544,1549],{"type":395,"tag":486,"props":1519,"children":1520},{"style":567},[1521],{"type":401,"value":1522},"  depth ",{"type":395,"tag":486,"props":1524,"children":1525},{"style":665},[1526],{"type":401,"value":668},{"type":395,"tag":486,"props":1528,"children":1529},{"style":535},[1530],{"type":401,"value":1531}," backtrace",{"type":395,"tag":486,"props":1533,"children":1534},{"style":541},[1535],{"type":401,"value":623},{"type":395,"tag":486,"props":1537,"children":1538},{"style":567},[1539],{"type":401,"value":1457},{"type":395,"tag":486,"props":1541,"children":1542},{"style":541},[1543],{"type":401,"value":633},{"type":395,"tag":486,"props":1545,"children":1546},{"style":567},[1547],{"type":401,"value":1548}," depth_max",{"type":395,"tag":486,"props":1550,"children":1551},{"style":541},[1552],{"type":401,"value":653},{"type":395,"tag":486,"props":1554,"children":1555},{"class":488,"line":733},[1556,1561,1565,1569,1573,1577,1582,1587,1592,1596,1600,1604,1608],{"type":395,"tag":486,"props":1557,"children":1558},{"style":535},[1559],{"type":401,"value":1560},"  fprintf",{"type":395,"tag":486,"props":1562,"children":1563},{"style":541},[1564],{"type":401,"value":623},{"type":395,"tag":486,"props":1566,"children":1567},{"style":567},[1568],{"type":401,"value":749},{"type":395,"tag":486,"props":1570,"children":1571},{"style":541},[1572],{"type":401,"value":633},{"type":395,"tag":486,"props":1574,"children":1575},{"style":499},[1576],{"type":401,"value":638},{"type":395,"tag":486,"props":1578,"children":1579},{"style":505},[1580],{"type":401,"value":1581},"Error: signal ",{"type":395,"tag":486,"props":1583,"children":1584},{"style":765},[1585],{"type":401,"value":1586},"%d",{"type":395,"tag":486,"props":1588,"children":1589},{"style":505},[1590],{"type":401,"value":1591},":",{"type":395,"tag":486,"props":1593,"children":1594},{"style":771},[1595],{"type":401,"value":774},{"type":395,"tag":486,"props":1597,"children":1598},{"style":499},[1599],{"type":401,"value":648},{"type":395,"tag":486,"props":1601,"children":1602},{"style":541},[1603],{"type":401,"value":633},{"type":395,"tag":486,"props":1605,"children":1606},{"style":567},[1607],{"type":401,"value":1405},{"type":395,"tag":486,"props":1609,"children":1610},{"style":541},[1611],{"type":401,"value":653},{"type":395,"tag":486,"props":1613,"children":1614},{"class":488,"line":814},[1615,1620,1624,1628,1632,1636,1640,1645],{"type":395,"tag":486,"props":1616,"children":1617},{"style":535},[1618],{"type":401,"value":1619},"  backtrace_symbols_fd",{"type":395,"tag":486,"props":1621,"children":1622},{"style":541},[1623],{"type":401,"value":623},{"type":395,"tag":486,"props":1625,"children":1626},{"style":567},[1627],{"type":401,"value":1457},{"type":395,"tag":486,"props":1629,"children":1630},{"style":541},[1631],{"type":401,"value":633},{"type":395,"tag":486,"props":1633,"children":1634},{"style":567},[1635],{"type":401,"value":1485},{"type":395,"tag":486,"props":1637,"children":1638},{"style":541},[1639],{"type":401,"value":633},{"type":395,"tag":486,"props":1641,"children":1642},{"style":567},[1643],{"type":401,"value":1644}," STDERR_FILENO",{"type":395,"tag":486,"props":1646,"children":1647},{"style":541},[1648],{"type":401,"value":653},{"type":395,"tag":486,"props":1650,"children":1651},{"class":488,"line":837},[1652,1657,1661,1665],{"type":395,"tag":486,"props":1653,"children":1654},{"style":535},[1655],{"type":401,"value":1656},"  exit",{"type":395,"tag":486,"props":1658,"children":1659},{"style":541},[1660],{"type":401,"value":623},{"type":395,"tag":486,"props":1662,"children":1663},{"style":827},[1664],{"type":401,"value":830},{"type":395,"tag":486,"props":1666,"children":1667},{"style":541},[1668],{"type":401,"value":653},{"type":395,"tag":486,"props":1670,"children":1671},{"class":488,"line":846},[1672],{"type":395,"tag":486,"props":1673,"children":1674},{"style":541},[1675],{"type":401,"value":1332},{"type":395,"tag":486,"props":1677,"children":1678},{"class":488,"line":854},[1679,1683,1687,1691],{"type":395,"tag":486,"props":1680,"children":1681},{"style":529},[1682],{"type":401,"value":532},{"type":395,"tag":486,"props":1684,"children":1685},{"style":535},[1686],{"type":401,"value":538},{"type":395,"tag":486,"props":1688,"children":1689},{"style":541},[1690],{"type":401,"value":544},{"type":395,"tag":486,"props":1692,"children":1693},{"style":541},[1694],{"type":401,"value":549},{"type":395,"tag":486,"props":1696,"children":1697},{"class":488,"line":897},[1698,1703,1707,1712,1716,1720],{"type":395,"tag":486,"props":1699,"children":1700},{"style":535},[1701],{"type":401,"value":1702},"  signal",{"type":395,"tag":486,"props":1704,"children":1705},{"style":541},[1706],{"type":401,"value":623},{"type":395,"tag":486,"props":1708,"children":1709},{"style":567},[1710],{"type":401,"value":1711},"SIGSEGV",{"type":395,"tag":486,"props":1713,"children":1714},{"style":541},[1715],{"type":401,"value":633},{"type":395,"tag":486,"props":1717,"children":1718},{"style":567},[1719],{"type":401,"value":1391},{"type":395,"tag":486,"props":1721,"children":1722},{"style":541},[1723],{"type":401,"value":653},{"type":395,"tag":486,"props":1725,"children":1726},{"class":488,"line":938},[1727,1731,1735,1740,1744,1748],{"type":395,"tag":486,"props":1728,"children":1729},{"style":535},[1730],{"type":401,"value":1702},{"type":395,"tag":486,"props":1732,"children":1733},{"style":541},[1734],{"type":401,"value":623},{"type":395,"tag":486,"props":1736,"children":1737},{"style":567},[1738],{"type":401,"value":1739},"SIGABRT",{"type":395,"tag":486,"props":1741,"children":1742},{"style":541},[1743],{"type":401,"value":633},{"type":395,"tag":486,"props":1745,"children":1746},{"style":567},[1747],{"type":401,"value":1391},{"type":395,"tag":486,"props":1749,"children":1750},{"style":541},[1751],{"type":401,"value":653},{"type":395,"tag":486,"props":1753,"children":1754},{"class":488,"line":946},[1755,1759,1764,1768,1773,1777,1782],{"type":395,"tag":486,"props":1756,"children":1757},{"style":493},[1758],{"type":401,"value":1314},{"type":395,"tag":486,"props":1760,"children":1761},{"style":556},[1762],{"type":401,"value":1763}," kdb",{"type":395,"tag":486,"props":1765,"children":1766},{"style":541},[1767],{"type":401,"value":564},{"type":395,"tag":486,"props":1769,"children":1770},{"style":556},[1771],{"type":401,"value":1772},"test",{"type":395,"tag":486,"props":1774,"children":1775},{"style":541},[1776],{"type":401,"value":564},{"type":395,"tag":486,"props":1778,"children":1779},{"style":535},[1780],{"type":401,"value":1781},"RunAllTests",{"type":395,"tag":486,"props":1783,"children":1784},{"style":541},[1785],{"type":401,"value":688},{"type":395,"tag":486,"props":1787,"children":1788},{"class":488,"line":967},[1789],{"type":395,"tag":486,"props":1790,"children":1791},{"style":541},[1792],{"type":401,"value":1332},{"type":395,"tag":1362,"props":1794,"children":1796},{"id":1795},"使用宏创建测试类",[1797],{"type":401,"value":1795},{"type":395,"tag":409,"props":1799,"children":1800},{},[1801],{"type":401,"value":1802},"test_db 中的类是使用宏定义的。如下代码，TEST 展开的新类，继承了 DBTest，实现了 _RunIt 接口以便调用测试函数。TCONCAT 宏顾名思义就是连接，使用标记黏贴运算符把两个字符串或实参连接在一起并视为一个新的标记。_Test_ 和 name 连接在一起后，就是新类的名称，如 _Test_CloseAndReopen。",{"type":395,"tag":475,"props":1804,"children":1806},{"code":1805,"language":478,"meta":389,"className":479,"style":389},"TEST(DBTest, CloseAndReopen) {\n  // ...\n}\n#define TEST(base,name)                                                 \\\nclass TCONCAT(_Test_,name) : public base {                              \\\n public:                                                                \\\n  void _Run();                                                          \\\n  static void _RunIt() {                                                \\\n    TCONCAT(_Test_,name) t;                                             \\\n    t._Run();                                                           \\\n  }                                                                     \\\n};                                                                      \\\nbool TCONCAT(_Test_ignored_,name) =                                     \\\n  ::kdb::test::RegisterTest(#base, #name, &TCONCAT(_Test_,name)::_RunIt); \\\n",[1807],{"type":395,"tag":482,"props":1808,"children":1809},{"__ignoreMap":389},[1810,1844,1852,1859,1899,1948,1966,1988,2021,2064,2090,2102,2115,2158],{"type":395,"tag":486,"props":1811,"children":1812},{"class":488,"line":489},[1813,1818,1822,1827,1831,1836,1840],{"type":395,"tag":486,"props":1814,"children":1815},{"style":535},[1816],{"type":401,"value":1817},"TEST",{"type":395,"tag":486,"props":1819,"children":1820},{"style":541},[1821],{"type":401,"value":623},{"type":395,"tag":486,"props":1823,"children":1824},{"style":567},[1825],{"type":401,"value":1826},"DBTest",{"type":395,"tag":486,"props":1828,"children":1829},{"style":541},[1830],{"type":401,"value":633},{"type":395,"tag":486,"props":1832,"children":1833},{"style":567},[1834],{"type":401,"value":1835}," CloseAndReopen",{"type":395,"tag":486,"props":1837,"children":1838},{"style":541},[1839],{"type":401,"value":1190},{"type":395,"tag":486,"props":1841,"children":1842},{"style":541},[1843],{"type":401,"value":549},{"type":395,"tag":486,"props":1845,"children":1846},{"class":488,"line":516},[1847],{"type":395,"tag":486,"props":1848,"children":1849},{"style":1495},[1850],{"type":401,"value":1851},"  // ...\n",{"type":395,"tag":486,"props":1853,"children":1854},{"class":488,"line":525},[1855],{"type":395,"tag":486,"props":1856,"children":1857},{"style":541},[1858],{"type":401,"value":1332},{"type":395,"tag":486,"props":1860,"children":1861},{"class":488,"line":552},[1862,1867,1872,1876,1881,1885,1890,1894],{"type":395,"tag":486,"props":1863,"children":1864},{"style":493},[1865],{"type":401,"value":1866},"#define",{"type":395,"tag":486,"props":1868,"children":1869},{"style":535},[1870],{"type":401,"value":1871}," TEST",{"type":395,"tag":486,"props":1873,"children":1874},{"style":541},[1875],{"type":401,"value":623},{"type":395,"tag":486,"props":1877,"children":1878},{"style":1402},[1879],{"type":401,"value":1880},"base",{"type":395,"tag":486,"props":1882,"children":1883},{"style":541},[1884],{"type":401,"value":633},{"type":395,"tag":486,"props":1886,"children":1887},{"style":1402},[1888],{"type":401,"value":1889},"name",{"type":395,"tag":486,"props":1891,"children":1892},{"style":541},[1893],{"type":401,"value":1190},{"type":395,"tag":486,"props":1895,"children":1896},{"style":771},[1897],{"type":401,"value":1898},"                                                 \\\n",{"type":395,"tag":486,"props":1900,"children":1901},{"class":488,"line":578},[1902,1907,1912,1916,1921,1925,1929,1933,1938,1943],{"type":395,"tag":486,"props":1903,"children":1904},{"style":529},[1905],{"type":401,"value":1906},"class",{"type":395,"tag":486,"props":1908,"children":1909},{"style":535},[1910],{"type":401,"value":1911}," TCONCAT",{"type":395,"tag":486,"props":1913,"children":1914},{"style":541},[1915],{"type":401,"value":623},{"type":395,"tag":486,"props":1917,"children":1918},{"style":556},[1919],{"type":401,"value":1920},"_Test_",{"type":395,"tag":486,"props":1922,"children":1923},{"style":541},[1924],{"type":401,"value":633},{"type":395,"tag":486,"props":1926,"children":1927},{"style":556},[1928],{"type":401,"value":1889},{"type":395,"tag":486,"props":1930,"children":1931},{"style":541},[1932],{"type":401,"value":1190},{"type":395,"tag":486,"props":1934,"children":1935},{"style":567},[1936],{"type":401,"value":1937}," : public base ",{"type":395,"tag":486,"props":1939,"children":1940},{"style":541},[1941],{"type":401,"value":1942},"{",{"type":395,"tag":486,"props":1944,"children":1945},{"style":771},[1946],{"type":401,"value":1947},"                              \\\n",{"type":395,"tag":486,"props":1949,"children":1950},{"class":488,"line":599},[1951,1956,1961],{"type":395,"tag":486,"props":1952,"children":1953},{"style":529},[1954],{"type":401,"value":1955}," public",{"type":395,"tag":486,"props":1957,"children":1959},{"style":1958},"--shiki-light:#39ADB5;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic",[1960],{"type":401,"value":1591},{"type":395,"tag":486,"props":1962,"children":1963},{"style":771},[1964],{"type":401,"value":1965},"                                                                \\\n",{"type":395,"tag":486,"props":1967,"children":1968},{"class":488,"line":656},[1969,1973,1978,1983],{"type":395,"tag":486,"props":1970,"children":1971},{"style":529},[1972],{"type":401,"value":1447},{"type":395,"tag":486,"props":1974,"children":1975},{"style":535},[1976],{"type":401,"value":1977}," _Run",{"type":395,"tag":486,"props":1979,"children":1980},{"style":541},[1981],{"type":401,"value":1982},"();",{"type":395,"tag":486,"props":1984,"children":1985},{"style":771},[1986],{"type":401,"value":1987},"                                                          \\\n",{"type":395,"tag":486,"props":1989,"children":1990},{"class":488,"line":691},[1991,1997,2002,2007,2011,2016],{"type":395,"tag":486,"props":1992,"children":1994},{"style":1993},"--shiki-light:#9C3EDA;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[1995],{"type":401,"value":1996},"  static",{"type":395,"tag":486,"props":1998,"children":1999},{"style":529},[2000],{"type":401,"value":2001}," void",{"type":395,"tag":486,"props":2003,"children":2004},{"style":535},[2005],{"type":401,"value":2006}," _RunIt",{"type":395,"tag":486,"props":2008,"children":2009},{"style":541},[2010],{"type":401,"value":544},{"type":395,"tag":486,"props":2012,"children":2013},{"style":541},[2014],{"type":401,"value":2015}," {",{"type":395,"tag":486,"props":2017,"children":2018},{"style":771},[2019],{"type":401,"value":2020},"                                                \\\n",{"type":395,"tag":486,"props":2022,"children":2023},{"class":488,"line":733},[2024,2029,2033,2037,2041,2045,2049,2054,2059],{"type":395,"tag":486,"props":2025,"children":2026},{"style":535},[2027],{"type":401,"value":2028},"    TCONCAT",{"type":395,"tag":486,"props":2030,"children":2031},{"style":541},[2032],{"type":401,"value":623},{"type":395,"tag":486,"props":2034,"children":2035},{"style":746},[2036],{"type":401,"value":1920},{"type":395,"tag":486,"props":2038,"children":2039},{"style":541},[2040],{"type":401,"value":633},{"type":395,"tag":486,"props":2042,"children":2043},{"style":746},[2044],{"type":401,"value":1889},{"type":395,"tag":486,"props":2046,"children":2047},{"style":541},[2048],{"type":401,"value":1190},{"type":395,"tag":486,"props":2050,"children":2051},{"style":746},[2052],{"type":401,"value":2053}," t",{"type":395,"tag":486,"props":2055,"children":2056},{"style":541},[2057],{"type":401,"value":2058},";",{"type":395,"tag":486,"props":2060,"children":2061},{"style":771},[2062],{"type":401,"value":2063},"                                             \\\n",{"type":395,"tag":486,"props":2065,"children":2066},{"class":488,"line":814},[2067,2072,2076,2081,2085],{"type":395,"tag":486,"props":2068,"children":2069},{"style":567},[2070],{"type":401,"value":2071},"    t",{"type":395,"tag":486,"props":2073,"children":2074},{"style":541},[2075],{"type":401,"value":678},{"type":395,"tag":486,"props":2077,"children":2078},{"style":535},[2079],{"type":401,"value":2080},"_Run",{"type":395,"tag":486,"props":2082,"children":2083},{"style":541},[2084],{"type":401,"value":1982},{"type":395,"tag":486,"props":2086,"children":2087},{"style":771},[2088],{"type":401,"value":2089},"                                                           \\\n",{"type":395,"tag":486,"props":2091,"children":2092},{"class":488,"line":837},[2093,2097],{"type":395,"tag":486,"props":2094,"children":2095},{"style":541},[2096],{"type":401,"value":1243},{"type":395,"tag":486,"props":2098,"children":2099},{"style":771},[2100],{"type":401,"value":2101},"                                                                     \\\n",{"type":395,"tag":486,"props":2103,"children":2104},{"class":488,"line":846},[2105,2110],{"type":395,"tag":486,"props":2106,"children":2107},{"style":541},[2108],{"type":401,"value":2109},"};",{"type":395,"tag":486,"props":2111,"children":2112},{"style":771},[2113],{"type":401,"value":2114},"                                                                      \\\n",{"type":395,"tag":486,"props":2116,"children":2117},{"class":488,"line":854},[2118,2123,2127,2131,2136,2140,2144,2148,2153],{"type":395,"tag":486,"props":2119,"children":2120},{"style":529},[2121],{"type":401,"value":2122},"bool",{"type":395,"tag":486,"props":2124,"children":2125},{"style":535},[2126],{"type":401,"value":1911},{"type":395,"tag":486,"props":2128,"children":2129},{"style":541},[2130],{"type":401,"value":623},{"type":395,"tag":486,"props":2132,"children":2133},{"style":556},[2134],{"type":401,"value":2135},"_Test_ignored_",{"type":395,"tag":486,"props":2137,"children":2138},{"style":541},[2139],{"type":401,"value":633},{"type":395,"tag":486,"props":2141,"children":2142},{"style":556},[2143],{"type":401,"value":1889},{"type":395,"tag":486,"props":2145,"children":2146},{"style":541},[2147],{"type":401,"value":1190},{"type":395,"tag":486,"props":2149,"children":2150},{"style":665},[2151],{"type":401,"value":2152}," =",{"type":395,"tag":486,"props":2154,"children":2155},{"style":771},[2156],{"type":401,"value":2157},"                                     \\\n",{"type":395,"tag":486,"props":2159,"children":2160},{"class":488,"line":897},[2161,2166,2171,2175,2179,2183,2188,2192,2197,2201,2206,2210,2214,2219,2223,2227,2231,2235,2239,2244,2248],{"type":395,"tag":486,"props":2162,"children":2163},{"style":567},[2164],{"type":401,"value":2165},"  ::",{"type":395,"tag":486,"props":2167,"children":2168},{"style":556},[2169],{"type":401,"value":2170},"kdb",{"type":395,"tag":486,"props":2172,"children":2173},{"style":541},[2174],{"type":401,"value":564},{"type":395,"tag":486,"props":2176,"children":2177},{"style":556},[2178],{"type":401,"value":1772},{"type":395,"tag":486,"props":2180,"children":2181},{"style":541},[2182],{"type":401,"value":564},{"type":395,"tag":486,"props":2184,"children":2185},{"style":535},[2186],{"type":401,"value":2187},"RegisterTest",{"type":395,"tag":486,"props":2189,"children":2190},{"style":541},[2191],{"type":401,"value":623},{"type":395,"tag":486,"props":2193,"children":2194},{"style":567},[2195],{"type":401,"value":2196},"#base",{"type":395,"tag":486,"props":2198,"children":2199},{"style":541},[2200],{"type":401,"value":633},{"type":395,"tag":486,"props":2202,"children":2203},{"style":567},[2204],{"type":401,"value":2205}," #name",{"type":395,"tag":486,"props":2207,"children":2208},{"style":541},[2209],{"type":401,"value":633},{"type":395,"tag":486,"props":2211,"children":2212},{"style":665},[2213],{"type":401,"value":1121},{"type":395,"tag":486,"props":2215,"children":2216},{"style":535},[2217],{"type":401,"value":2218},"TCONCAT",{"type":395,"tag":486,"props":2220,"children":2221},{"style":541},[2222],{"type":401,"value":623},{"type":395,"tag":486,"props":2224,"children":2225},{"style":567},[2226],{"type":401,"value":1920},{"type":395,"tag":486,"props":2228,"children":2229},{"style":541},[2230],{"type":401,"value":633},{"type":395,"tag":486,"props":2232,"children":2233},{"style":567},[2234],{"type":401,"value":1889},{"type":395,"tag":486,"props":2236,"children":2237},{"style":541},[2238],{"type":401,"value":1190},{"type":395,"tag":486,"props":2240,"children":2241},{"style":567},[2242],{"type":401,"value":2243},"::_RunIt",{"type":395,"tag":486,"props":2245,"children":2246},{"style":541},[2247],{"type":401,"value":1229},{"type":395,"tag":486,"props":2249,"children":2250},{"style":771},[2251],{"type":401,"value":2252}," \\\n",{"type":395,"tag":409,"props":2254,"children":2255},{},[2256],{"type":401,"value":2257},"可是，既然有 TCONCAT，为什么还要定义一个 TCONCAT1 宏呢？",{"type":395,"tag":475,"props":2259,"children":2261},{"code":2260,"language":478,"meta":389,"className":479,"style":389},"#define TCONCAT(a,b) TCONCAT1(a,b)\n#define TCONCAT1(a,b) a##b\n",[2262],{"type":395,"tag":482,"props":2263,"children":2264},{"__ignoreMap":389},[2265,2323],{"type":395,"tag":486,"props":2266,"children":2267},{"class":488,"line":489},[2268,2272,2276,2280,2284,2288,2293,2297,2302,2306,2310,2314,2318],{"type":395,"tag":486,"props":2269,"children":2270},{"style":493},[2271],{"type":401,"value":1866},{"type":395,"tag":486,"props":2273,"children":2274},{"style":535},[2275],{"type":401,"value":1911},{"type":395,"tag":486,"props":2277,"children":2278},{"style":541},[2279],{"type":401,"value":623},{"type":395,"tag":486,"props":2281,"children":2282},{"style":1402},[2283],{"type":401,"value":420},{"type":395,"tag":486,"props":2285,"children":2286},{"style":541},[2287],{"type":401,"value":633},{"type":395,"tag":486,"props":2289,"children":2290},{"style":1402},[2291],{"type":401,"value":2292},"b",{"type":395,"tag":486,"props":2294,"children":2295},{"style":541},[2296],{"type":401,"value":1190},{"type":395,"tag":486,"props":2298,"children":2299},{"style":535},[2300],{"type":401,"value":2301}," TCONCAT1",{"type":395,"tag":486,"props":2303,"children":2304},{"style":541},[2305],{"type":401,"value":623},{"type":395,"tag":486,"props":2307,"children":2308},{"style":567},[2309],{"type":401,"value":420},{"type":395,"tag":486,"props":2311,"children":2312},{"style":541},[2313],{"type":401,"value":633},{"type":395,"tag":486,"props":2315,"children":2316},{"style":567},[2317],{"type":401,"value":2292},{"type":395,"tag":486,"props":2319,"children":2320},{"style":541},[2321],{"type":401,"value":2322},")\n",{"type":395,"tag":486,"props":2324,"children":2325},{"class":488,"line":516},[2326,2330,2334,2338,2342,2346,2350,2354],{"type":395,"tag":486,"props":2327,"children":2328},{"style":493},[2329],{"type":401,"value":1866},{"type":395,"tag":486,"props":2331,"children":2332},{"style":535},[2333],{"type":401,"value":2301},{"type":395,"tag":486,"props":2335,"children":2336},{"style":541},[2337],{"type":401,"value":623},{"type":395,"tag":486,"props":2339,"children":2340},{"style":1402},[2341],{"type":401,"value":420},{"type":395,"tag":486,"props":2343,"children":2344},{"style":541},[2345],{"type":401,"value":633},{"type":395,"tag":486,"props":2347,"children":2348},{"style":1402},[2349],{"type":401,"value":2292},{"type":395,"tag":486,"props":2351,"children":2352},{"style":541},[2353],{"type":401,"value":1190},{"type":395,"tag":486,"props":2355,"children":2356},{"style":567},[2357],{"type":401,"value":2358}," a##b\n",{"type":395,"tag":409,"props":2360,"children":2361},{},[2362],{"type":401,"value":2363},"这就要提到宏的一个特殊规则了，如果宏参数使用了字符串化运算符（#）或标记黏贴运算符（##），那么即便参数是宏也不会展开。所以需要一个间接宏 TCONCAT1，以达到先展开参数（如果参数是宏的化），再调用标记黏贴运算符的目的。从 test_db 可以看到，测试类的名词都不是宏，所以这里本不需要 TCONCAT1 这个间接宏。但是考虑到程序的健壮性，加上更好。",{"type":395,"tag":1362,"props":2365,"children":2367},{"id":2366},"断言宏",[2368],{"type":401,"value":2366},{"type":395,"tag":409,"props":2370,"children":2371},{},[2372],{"type":401,"value":2373},"测试代码中的断言也是使用的宏来定义的。相比 TCONCAT 简单很多了，但其特点是可以记录抛错的文件以及行号。以下代码实现了 ASSERT_EQ 的定义。Tester 用于记录宏展开时所在的文件 __FILE__、行号 __LINE__ 以及断言结果。一但断言失败，记录到 ok_ 成员变量中。在 Tester 析构时，会把相关信息一并打印出来。",{"type":395,"tag":475,"props":2375,"children":2377},{"code":2376,"language":478,"meta":389,"className":479,"style":389},"class Tester {\n#define BINARY_OP(name,op)                              \\\n  template \u003Cclass X, class Y>                           \\\n  Tester& name(const X& x, const Y& y) {                \\\n    if (! (x op y)) {                                   \\\n      ss_ \u003C\u003C \" failed: \" \u003C\u003C x \u003C\u003C (\" \" #op \" \") \u003C\u003C y;    \\\n      ok_ = false;                                      \\\n    }                                                   \\\n    return *this;                                       \\\n  }\n  BINARY_OP(IsEq, ==)\n#undef BINARY_OP\n}\n#define ASSERT_EQ(a,b) ::kdb::test::Tester(__FILE__, __LINE__).IsEq((a),(b))\n",[2378],{"type":395,"tag":482,"props":2379,"children":2380},{"__ignoreMap":389},[2381,2397,2434,2479,2554,2593,2679,2706,2719,2746,2753,2783,2796,2803],{"type":395,"tag":486,"props":2382,"children":2383},{"class":488,"line":489},[2384,2388,2393],{"type":395,"tag":486,"props":2385,"children":2386},{"style":529},[2387],{"type":401,"value":1906},{"type":395,"tag":486,"props":2389,"children":2390},{"style":556},[2391],{"type":401,"value":2392}," Tester",{"type":395,"tag":486,"props":2394,"children":2395},{"style":541},[2396],{"type":401,"value":549},{"type":395,"tag":486,"props":2398,"children":2399},{"class":488,"line":516},[2400,2404,2409,2413,2417,2421,2426,2430],{"type":395,"tag":486,"props":2401,"children":2402},{"style":493},[2403],{"type":401,"value":1866},{"type":395,"tag":486,"props":2405,"children":2406},{"style":535},[2407],{"type":401,"value":2408}," BINARY_OP",{"type":395,"tag":486,"props":2410,"children":2411},{"style":541},[2412],{"type":401,"value":623},{"type":395,"tag":486,"props":2414,"children":2415},{"style":1402},[2416],{"type":401,"value":1889},{"type":395,"tag":486,"props":2418,"children":2419},{"style":541},[2420],{"type":401,"value":633},{"type":395,"tag":486,"props":2422,"children":2423},{"style":1402},[2424],{"type":401,"value":2425},"op",{"type":395,"tag":486,"props":2427,"children":2428},{"style":541},[2429],{"type":401,"value":1190},{"type":395,"tag":486,"props":2431,"children":2432},{"style":771},[2433],{"type":401,"value":1947},{"type":395,"tag":486,"props":2435,"children":2436},{"class":488,"line":525},[2437,2442,2446,2450,2455,2459,2464,2469,2474],{"type":395,"tag":486,"props":2438,"children":2439},{"style":529},[2440],{"type":401,"value":2441},"  template",{"type":395,"tag":486,"props":2443,"children":2444},{"style":541},[2445],{"type":401,"value":502},{"type":395,"tag":486,"props":2447,"children":2448},{"style":529},[2449],{"type":401,"value":1906},{"type":395,"tag":486,"props":2451,"children":2452},{"style":556},[2453],{"type":401,"value":2454}," X",{"type":395,"tag":486,"props":2456,"children":2457},{"style":541},[2458],{"type":401,"value":633},{"type":395,"tag":486,"props":2460,"children":2461},{"style":529},[2462],{"type":401,"value":2463}," class",{"type":395,"tag":486,"props":2465,"children":2466},{"style":556},[2467],{"type":401,"value":2468}," Y",{"type":395,"tag":486,"props":2470,"children":2471},{"style":541},[2472],{"type":401,"value":2473},">",{"type":395,"tag":486,"props":2475,"children":2476},{"style":771},[2477],{"type":401,"value":2478},"                           \\\n",{"type":395,"tag":486,"props":2480,"children":2481},{"class":488,"line":552},[2482,2487,2492,2497,2501,2506,2510,2514,2519,2523,2528,2532,2536,2541,2545,2549],{"type":395,"tag":486,"props":2483,"children":2484},{"style":556},[2485],{"type":401,"value":2486},"  Tester",{"type":395,"tag":486,"props":2488,"children":2489},{"style":1993},[2490],{"type":401,"value":2491},"&",{"type":395,"tag":486,"props":2493,"children":2494},{"style":535},[2495],{"type":401,"value":2496}," name",{"type":395,"tag":486,"props":2498,"children":2499},{"style":541},[2500],{"type":401,"value":623},{"type":395,"tag":486,"props":2502,"children":2503},{"style":1993},[2504],{"type":401,"value":2505},"const",{"type":395,"tag":486,"props":2507,"children":2508},{"style":556},[2509],{"type":401,"value":2454},{"type":395,"tag":486,"props":2511,"children":2512},{"style":1993},[2513],{"type":401,"value":2491},{"type":395,"tag":486,"props":2515,"children":2516},{"style":1402},[2517],{"type":401,"value":2518}," x",{"type":395,"tag":486,"props":2520,"children":2521},{"style":541},[2522],{"type":401,"value":633},{"type":395,"tag":486,"props":2524,"children":2525},{"style":1993},[2526],{"type":401,"value":2527}," const",{"type":395,"tag":486,"props":2529,"children":2530},{"style":556},[2531],{"type":401,"value":2468},{"type":395,"tag":486,"props":2533,"children":2534},{"style":1993},[2535],{"type":401,"value":2491},{"type":395,"tag":486,"props":2537,"children":2538},{"style":1402},[2539],{"type":401,"value":2540}," y",{"type":395,"tag":486,"props":2542,"children":2543},{"style":541},[2544],{"type":401,"value":1190},{"type":395,"tag":486,"props":2546,"children":2547},{"style":541},[2548],{"type":401,"value":2015},{"type":395,"tag":486,"props":2550,"children":2551},{"style":771},[2552],{"type":401,"value":2553},"                \\\n",{"type":395,"tag":486,"props":2555,"children":2556},{"class":488,"line":578},[2557,2562,2566,2570,2574,2579,2584,2588],{"type":395,"tag":486,"props":2558,"children":2559},{"style":493},[2560],{"type":401,"value":2561},"    if",{"type":395,"tag":486,"props":2563,"children":2564},{"style":541},[2565],{"type":401,"value":702},{"type":395,"tag":486,"props":2567,"children":2568},{"style":665},[2569],{"type":401,"value":707},{"type":395,"tag":486,"props":2571,"children":2572},{"style":541},[2573],{"type":401,"value":702},{"type":395,"tag":486,"props":2575,"children":2576},{"style":746},[2577],{"type":401,"value":2578},"x op y",{"type":395,"tag":486,"props":2580,"children":2581},{"style":541},[2582],{"type":401,"value":2583},"))",{"type":395,"tag":486,"props":2585,"children":2586},{"style":541},[2587],{"type":401,"value":2015},{"type":395,"tag":486,"props":2589,"children":2590},{"style":771},[2591],{"type":401,"value":2592},"                                   \\\n",{"type":395,"tag":486,"props":2594,"children":2595},{"class":488,"line":599},[2596,2601,2606,2610,2615,2619,2624,2629,2633,2637,2641,2645,2650,2654,2658,2662,2666,2670,2674],{"type":395,"tag":486,"props":2597,"children":2598},{"style":746},[2599],{"type":401,"value":2600},"      ss_ ",{"type":395,"tag":486,"props":2602,"children":2603},{"style":665},[2604],{"type":401,"value":2605},"\u003C\u003C",{"type":395,"tag":486,"props":2607,"children":2608},{"style":499},[2609],{"type":401,"value":638},{"type":395,"tag":486,"props":2611,"children":2612},{"style":505},[2613],{"type":401,"value":2614}," failed: ",{"type":395,"tag":486,"props":2616,"children":2617},{"style":499},[2618],{"type":401,"value":648},{"type":395,"tag":486,"props":2620,"children":2621},{"style":665},[2622],{"type":401,"value":2623}," \u003C\u003C",{"type":395,"tag":486,"props":2625,"children":2626},{"style":746},[2627],{"type":401,"value":2628}," x ",{"type":395,"tag":486,"props":2630,"children":2631},{"style":665},[2632],{"type":401,"value":2605},{"type":395,"tag":486,"props":2634,"children":2635},{"style":541},[2636],{"type":401,"value":702},{"type":395,"tag":486,"props":2638,"children":2639},{"style":499},[2640],{"type":401,"value":648},{"type":395,"tag":486,"props":2642,"children":2643},{"style":499},[2644],{"type":401,"value":638},{"type":395,"tag":486,"props":2646,"children":2647},{"style":567},[2648],{"type":401,"value":2649}," #op",{"type":395,"tag":486,"props":2651,"children":2652},{"style":499},[2653],{"type":401,"value":638},{"type":395,"tag":486,"props":2655,"children":2656},{"style":499},[2657],{"type":401,"value":638},{"type":395,"tag":486,"props":2659,"children":2660},{"style":541},[2661],{"type":401,"value":1190},{"type":395,"tag":486,"props":2663,"children":2664},{"style":665},[2665],{"type":401,"value":2623},{"type":395,"tag":486,"props":2667,"children":2668},{"style":746},[2669],{"type":401,"value":2540},{"type":395,"tag":486,"props":2671,"children":2672},{"style":541},[2673],{"type":401,"value":2058},{"type":395,"tag":486,"props":2675,"children":2676},{"style":771},[2677],{"type":401,"value":2678},"    \\\n",{"type":395,"tag":486,"props":2680,"children":2681},{"class":488,"line":656},[2682,2687,2691,2697,2701],{"type":395,"tag":486,"props":2683,"children":2684},{"style":746},[2685],{"type":401,"value":2686},"      ok_ ",{"type":395,"tag":486,"props":2688,"children":2689},{"style":665},[2690],{"type":401,"value":668},{"type":395,"tag":486,"props":2692,"children":2694},{"style":2693},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[2695],{"type":401,"value":2696}," false",{"type":395,"tag":486,"props":2698,"children":2699},{"style":541},[2700],{"type":401,"value":2058},{"type":395,"tag":486,"props":2702,"children":2703},{"style":771},[2704],{"type":401,"value":2705},"                                      \\\n",{"type":395,"tag":486,"props":2707,"children":2708},{"class":488,"line":691},[2709,2714],{"type":395,"tag":486,"props":2710,"children":2711},{"style":541},[2712],{"type":401,"value":2713},"    }",{"type":395,"tag":486,"props":2715,"children":2716},{"style":771},[2717],{"type":401,"value":2718},"                                                   \\\n",{"type":395,"tag":486,"props":2720,"children":2721},{"class":488,"line":733},[2722,2727,2731,2737,2741],{"type":395,"tag":486,"props":2723,"children":2724},{"style":493},[2725],{"type":401,"value":2726},"    return",{"type":395,"tag":486,"props":2728,"children":2729},{"style":665},[2730],{"type":401,"value":1452},{"type":395,"tag":486,"props":2732,"children":2734},{"style":2733},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[2735],{"type":401,"value":2736},"this",{"type":395,"tag":486,"props":2738,"children":2739},{"style":541},[2740],{"type":401,"value":2058},{"type":395,"tag":486,"props":2742,"children":2743},{"style":771},[2744],{"type":401,"value":2745},"                                       \\\n",{"type":395,"tag":486,"props":2747,"children":2748},{"class":488,"line":814},[2749],{"type":395,"tag":486,"props":2750,"children":2751},{"style":541},[2752],{"type":401,"value":843},{"type":395,"tag":486,"props":2754,"children":2755},{"class":488,"line":837},[2756,2761,2765,2770,2774,2779],{"type":395,"tag":486,"props":2757,"children":2758},{"style":535},[2759],{"type":401,"value":2760},"  BINARY_OP",{"type":395,"tag":486,"props":2762,"children":2763},{"style":541},[2764],{"type":401,"value":623},{"type":395,"tag":486,"props":2766,"children":2767},{"style":556},[2768],{"type":401,"value":2769},"IsEq",{"type":395,"tag":486,"props":2771,"children":2772},{"style":541},[2773],{"type":401,"value":633},{"type":395,"tag":486,"props":2775,"children":2776},{"style":665},[2777],{"type":401,"value":2778}," ==",{"type":395,"tag":486,"props":2780,"children":2781},{"style":541},[2782],{"type":401,"value":2322},{"type":395,"tag":486,"props":2784,"children":2785},{"class":488,"line":846},[2786,2791],{"type":395,"tag":486,"props":2787,"children":2788},{"style":493},[2789],{"type":401,"value":2790},"#undef",{"type":395,"tag":486,"props":2792,"children":2793},{"style":535},[2794],{"type":401,"value":2795}," BINARY_OP\n",{"type":395,"tag":486,"props":2797,"children":2798},{"class":488,"line":854},[2799],{"type":395,"tag":486,"props":2800,"children":2801},{"style":746},[2802],{"type":401,"value":1332},{"type":395,"tag":486,"props":2804,"children":2805},{"class":488,"line":897},[2806,2810,2815,2819,2823,2827,2831,2835,2840,2844,2848,2852,2856,2861,2865,2871,2875,2880,2885,2889,2894,2898,2903,2907],{"type":395,"tag":486,"props":2807,"children":2808},{"style":493},[2809],{"type":401,"value":1866},{"type":395,"tag":486,"props":2811,"children":2812},{"style":535},[2813],{"type":401,"value":2814}," ASSERT_EQ",{"type":395,"tag":486,"props":2816,"children":2817},{"style":541},[2818],{"type":401,"value":623},{"type":395,"tag":486,"props":2820,"children":2821},{"style":1402},[2822],{"type":401,"value":420},{"type":395,"tag":486,"props":2824,"children":2825},{"style":541},[2826],{"type":401,"value":633},{"type":395,"tag":486,"props":2828,"children":2829},{"style":1402},[2830],{"type":401,"value":2292},{"type":395,"tag":486,"props":2832,"children":2833},{"style":541},[2834],{"type":401,"value":1190},{"type":395,"tag":486,"props":2836,"children":2837},{"style":746},[2838],{"type":401,"value":2839}," ::",{"type":395,"tag":486,"props":2841,"children":2842},{"style":556},[2843],{"type":401,"value":2170},{"type":395,"tag":486,"props":2845,"children":2846},{"style":541},[2847],{"type":401,"value":564},{"type":395,"tag":486,"props":2849,"children":2850},{"style":556},[2851],{"type":401,"value":1772},{"type":395,"tag":486,"props":2853,"children":2854},{"style":541},[2855],{"type":401,"value":564},{"type":395,"tag":486,"props":2857,"children":2858},{"style":535},[2859],{"type":401,"value":2860},"Tester",{"type":395,"tag":486,"props":2862,"children":2863},{"style":541},[2864],{"type":401,"value":623},{"type":395,"tag":486,"props":2866,"children":2868},{"style":2867},"--shiki-light:#E2931D;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#F8F8F2",[2869],{"type":401,"value":2870},"__FILE__",{"type":395,"tag":486,"props":2872,"children":2873},{"style":541},[2874],{"type":401,"value":633},{"type":395,"tag":486,"props":2876,"children":2877},{"style":2867},[2878],{"type":401,"value":2879}," __LINE__",{"type":395,"tag":486,"props":2881,"children":2882},{"style":541},[2883],{"type":401,"value":2884},").",{"type":395,"tag":486,"props":2886,"children":2887},{"style":535},[2888],{"type":401,"value":2769},{"type":395,"tag":486,"props":2890,"children":2891},{"style":541},[2892],{"type":401,"value":2893},"((",{"type":395,"tag":486,"props":2895,"children":2896},{"style":746},[2897],{"type":401,"value":420},{"type":395,"tag":486,"props":2899,"children":2900},{"style":541},[2901],{"type":401,"value":2902},"),(",{"type":395,"tag":486,"props":2904,"children":2905},{"style":746},[2906],{"type":401,"value":2292},{"type":395,"tag":486,"props":2908,"children":2909},{"style":541},[2910],{"type":401,"value":2911},"))\n",{"type":395,"tag":1362,"props":2913,"children":2915},{"id":2914},"stringrepeatntimes",[2916],{"type":401,"value":2917},"string.repeat(ntimes)",{"type":395,"tag":409,"props":2919,"children":2920},{},[2921],{"type":401,"value":2922},"写 JavaScript 时经常用到 String 的原型方法 repeat，用来把 n 个内容重复的字符串拼接为一个新字符串。也许是 C++ 标准库没有提供相应的算法，KDB 使用了一种和 repeat 完全不一样的处理思路。KDB 使用 StringStream 填充一定位数内容，还可以不用考虑值的长度。",{"type":395,"tag":475,"props":2924,"children":2926},{"code":2925,"language":478,"meta":389,"className":479,"style":389},"std::stringstream ss;\nss \u003C\u003C std::setfill ('0') \u003C\u003C std::setw (16);\nss \u003C\u003C 1;\nss.str(); // result is: \"0000000000000001\"\nss \u003C\u003C std::setfill ('0') \u003C\u003C std::setw (16);\nss \u003C\u003C 1123;\nss.str(); // result is: \"0000000000001123\"\n",[2927],{"type":395,"tag":482,"props":2928,"children":2929},{"__ignoreMap":389},[2930,2951,3029,3049,3075,3146,3166],{"type":395,"tag":486,"props":2931,"children":2932},{"class":488,"line":489},[2933,2938,2942,2947],{"type":395,"tag":486,"props":2934,"children":2935},{"style":556},[2936],{"type":401,"value":2937},"std",{"type":395,"tag":486,"props":2939,"children":2940},{"style":541},[2941],{"type":401,"value":564},{"type":395,"tag":486,"props":2943,"children":2944},{"style":567},[2945],{"type":401,"value":2946},"stringstream ss",{"type":395,"tag":486,"props":2948,"children":2949},{"style":541},[2950],{"type":401,"value":575},{"type":395,"tag":486,"props":2952,"children":2953},{"class":488,"line":516},[2954,2959,2963,2968,2972,2977,2981,2986,2991,2995,2999,3003,3007,3011,3016,3020,3025],{"type":395,"tag":486,"props":2955,"children":2956},{"style":567},[2957],{"type":401,"value":2958},"ss ",{"type":395,"tag":486,"props":2960,"children":2961},{"style":665},[2962],{"type":401,"value":2605},{"type":395,"tag":486,"props":2964,"children":2965},{"style":556},[2966],{"type":401,"value":2967}," std",{"type":395,"tag":486,"props":2969,"children":2970},{"style":541},[2971],{"type":401,"value":564},{"type":395,"tag":486,"props":2973,"children":2974},{"style":535},[2975],{"type":401,"value":2976},"setfill",{"type":395,"tag":486,"props":2978,"children":2979},{"style":541},[2980],{"type":401,"value":702},{"type":395,"tag":486,"props":2982,"children":2983},{"style":499},[2984],{"type":401,"value":2985},"'",{"type":395,"tag":486,"props":2987,"children":2988},{"style":505},[2989],{"type":401,"value":2990},"0",{"type":395,"tag":486,"props":2992,"children":2993},{"style":499},[2994],{"type":401,"value":2985},{"type":395,"tag":486,"props":2996,"children":2997},{"style":541},[2998],{"type":401,"value":1190},{"type":395,"tag":486,"props":3000,"children":3001},{"style":665},[3002],{"type":401,"value":2623},{"type":395,"tag":486,"props":3004,"children":3005},{"style":556},[3006],{"type":401,"value":2967},{"type":395,"tag":486,"props":3008,"children":3009},{"style":541},[3010],{"type":401,"value":564},{"type":395,"tag":486,"props":3012,"children":3013},{"style":535},[3014],{"type":401,"value":3015},"setw",{"type":395,"tag":486,"props":3017,"children":3018},{"style":541},[3019],{"type":401,"value":702},{"type":395,"tag":486,"props":3021,"children":3022},{"style":827},[3023],{"type":401,"value":3024},"16",{"type":395,"tag":486,"props":3026,"children":3027},{"style":541},[3028],{"type":401,"value":653},{"type":395,"tag":486,"props":3030,"children":3031},{"class":488,"line":525},[3032,3036,3040,3045],{"type":395,"tag":486,"props":3033,"children":3034},{"style":567},[3035],{"type":401,"value":2958},{"type":395,"tag":486,"props":3037,"children":3038},{"style":665},[3039],{"type":401,"value":2605},{"type":395,"tag":486,"props":3041,"children":3042},{"style":827},[3043],{"type":401,"value":3044}," 1",{"type":395,"tag":486,"props":3046,"children":3047},{"style":541},[3048],{"type":401,"value":575},{"type":395,"tag":486,"props":3050,"children":3051},{"class":488,"line":552},[3052,3057,3061,3066,3070],{"type":395,"tag":486,"props":3053,"children":3054},{"style":567},[3055],{"type":401,"value":3056},"ss",{"type":395,"tag":486,"props":3058,"children":3059},{"style":541},[3060],{"type":401,"value":678},{"type":395,"tag":486,"props":3062,"children":3063},{"style":535},[3064],{"type":401,"value":3065},"str",{"type":395,"tag":486,"props":3067,"children":3068},{"style":541},[3069],{"type":401,"value":1982},{"type":395,"tag":486,"props":3071,"children":3072},{"style":1495},[3073],{"type":401,"value":3074}," // result is: \"0000000000000001\"\n",{"type":395,"tag":486,"props":3076,"children":3077},{"class":488,"line":578},[3078,3082,3086,3090,3094,3098,3102,3106,3110,3114,3118,3122,3126,3130,3134,3138,3142],{"type":395,"tag":486,"props":3079,"children":3080},{"style":567},[3081],{"type":401,"value":2958},{"type":395,"tag":486,"props":3083,"children":3084},{"style":665},[3085],{"type":401,"value":2605},{"type":395,"tag":486,"props":3087,"children":3088},{"style":556},[3089],{"type":401,"value":2967},{"type":395,"tag":486,"props":3091,"children":3092},{"style":541},[3093],{"type":401,"value":564},{"type":395,"tag":486,"props":3095,"children":3096},{"style":535},[3097],{"type":401,"value":2976},{"type":395,"tag":486,"props":3099,"children":3100},{"style":541},[3101],{"type":401,"value":702},{"type":395,"tag":486,"props":3103,"children":3104},{"style":499},[3105],{"type":401,"value":2985},{"type":395,"tag":486,"props":3107,"children":3108},{"style":505},[3109],{"type":401,"value":2990},{"type":395,"tag":486,"props":3111,"children":3112},{"style":499},[3113],{"type":401,"value":2985},{"type":395,"tag":486,"props":3115,"children":3116},{"style":541},[3117],{"type":401,"value":1190},{"type":395,"tag":486,"props":3119,"children":3120},{"style":665},[3121],{"type":401,"value":2623},{"type":395,"tag":486,"props":3123,"children":3124},{"style":556},[3125],{"type":401,"value":2967},{"type":395,"tag":486,"props":3127,"children":3128},{"style":541},[3129],{"type":401,"value":564},{"type":395,"tag":486,"props":3131,"children":3132},{"style":535},[3133],{"type":401,"value":3015},{"type":395,"tag":486,"props":3135,"children":3136},{"style":541},[3137],{"type":401,"value":702},{"type":395,"tag":486,"props":3139,"children":3140},{"style":827},[3141],{"type":401,"value":3024},{"type":395,"tag":486,"props":3143,"children":3144},{"style":541},[3145],{"type":401,"value":653},{"type":395,"tag":486,"props":3147,"children":3148},{"class":488,"line":599},[3149,3153,3157,3162],{"type":395,"tag":486,"props":3150,"children":3151},{"style":567},[3152],{"type":401,"value":2958},{"type":395,"tag":486,"props":3154,"children":3155},{"style":665},[3156],{"type":401,"value":2605},{"type":395,"tag":486,"props":3158,"children":3159},{"style":827},[3160],{"type":401,"value":3161}," 1123",{"type":395,"tag":486,"props":3163,"children":3164},{"style":541},[3165],{"type":401,"value":575},{"type":395,"tag":486,"props":3167,"children":3168},{"class":488,"line":656},[3169,3173,3177,3181,3185],{"type":395,"tag":486,"props":3170,"children":3171},{"style":567},[3172],{"type":401,"value":3056},{"type":395,"tag":486,"props":3174,"children":3175},{"style":541},[3176],{"type":401,"value":678},{"type":395,"tag":486,"props":3178,"children":3179},{"style":535},[3180],{"type":401,"value":3065},{"type":395,"tag":486,"props":3182,"children":3183},{"style":541},[3184],{"type":401,"value":1982},{"type":395,"tag":486,"props":3186,"children":3187},{"style":1495},[3188],{"type":401,"value":3189}," // result is: \"0000000000001123\"\n",{"type":395,"tag":1362,"props":3191,"children":3193},{"id":3192},"c-风格的随机数",[3194],{"type":401,"value":3195},"C++ 风格的随机数",{"type":395,"tag":409,"props":3197,"children":3198},{},[3199],{"type":401,"value":3200},"一个有意思的地方时，KDB 代码中随处可见 C 编程风格的源码。但是测试用例中生成随机数确实 C++ 风格的。",{"type":395,"tag":475,"props":3202,"children":3204},{"code":3203,"language":478,"meta":389,"className":479,"style":389},"std::mt19937 generator = std::mt19937();\nstd::uniform_int_distribution\u003Cint> random_dist(0,255);\n// ...\nfor (int i = 0; i \u003C size; i++) {\n  str[i] = static_cast\u003Cchar>(random_dist(generator));\n}\n",[3205],{"type":395,"tag":482,"props":3206,"children":3207},{"__ignoreMap":389},[3208,3245,3300,3308,3376,3439],{"type":395,"tag":486,"props":3209,"children":3210},{"class":488,"line":489},[3211,3215,3219,3224,3228,3232,3236,3241],{"type":395,"tag":486,"props":3212,"children":3213},{"style":556},[3214],{"type":401,"value":2937},{"type":395,"tag":486,"props":3216,"children":3217},{"style":541},[3218],{"type":401,"value":564},{"type":395,"tag":486,"props":3220,"children":3221},{"style":567},[3222],{"type":401,"value":3223},"mt19937 generator ",{"type":395,"tag":486,"props":3225,"children":3226},{"style":665},[3227],{"type":401,"value":668},{"type":395,"tag":486,"props":3229,"children":3230},{"style":556},[3231],{"type":401,"value":2967},{"type":395,"tag":486,"props":3233,"children":3234},{"style":541},[3235],{"type":401,"value":564},{"type":395,"tag":486,"props":3237,"children":3238},{"style":535},[3239],{"type":401,"value":3240},"mt19937",{"type":395,"tag":486,"props":3242,"children":3243},{"style":541},[3244],{"type":401,"value":688},{"type":395,"tag":486,"props":3246,"children":3247},{"class":488,"line":516},[3248,3252,3256,3261,3266,3270,3274,3279,3283,3287,3291,3296],{"type":395,"tag":486,"props":3249,"children":3250},{"style":556},[3251],{"type":401,"value":2937},{"type":395,"tag":486,"props":3253,"children":3254},{"style":541},[3255],{"type":401,"value":564},{"type":395,"tag":486,"props":3257,"children":3258},{"style":556},[3259],{"type":401,"value":3260},"uniform_int_distribution",{"type":395,"tag":486,"props":3262,"children":3263},{"style":541},[3264],{"type":401,"value":3265},"\u003C",{"type":395,"tag":486,"props":3267,"children":3268},{"style":529},[3269],{"type":401,"value":532},{"type":395,"tag":486,"props":3271,"children":3272},{"style":541},[3273],{"type":401,"value":2473},{"type":395,"tag":486,"props":3275,"children":3276},{"style":535},[3277],{"type":401,"value":3278}," random_dist",{"type":395,"tag":486,"props":3280,"children":3281},{"style":541},[3282],{"type":401,"value":623},{"type":395,"tag":486,"props":3284,"children":3285},{"style":827},[3286],{"type":401,"value":2990},{"type":395,"tag":486,"props":3288,"children":3289},{"style":541},[3290],{"type":401,"value":633},{"type":395,"tag":486,"props":3292,"children":3293},{"style":827},[3294],{"type":401,"value":3295},"255",{"type":395,"tag":486,"props":3297,"children":3298},{"style":541},[3299],{"type":401,"value":653},{"type":395,"tag":486,"props":3301,"children":3302},{"class":488,"line":525},[3303],{"type":395,"tag":486,"props":3304,"children":3305},{"style":1495},[3306],{"type":401,"value":3307},"// ...\n",{"type":395,"tag":486,"props":3309,"children":3310},{"class":488,"line":552},[3311,3316,3320,3324,3329,3333,3337,3341,3345,3349,3354,3358,3363,3368,3372],{"type":395,"tag":486,"props":3312,"children":3313},{"style":493},[3314],{"type":401,"value":3315},"for",{"type":395,"tag":486,"props":3317,"children":3318},{"style":541},[3319],{"type":401,"value":702},{"type":395,"tag":486,"props":3321,"children":3322},{"style":529},[3323],{"type":401,"value":532},{"type":395,"tag":486,"props":3325,"children":3326},{"style":567},[3327],{"type":401,"value":3328}," i ",{"type":395,"tag":486,"props":3330,"children":3331},{"style":665},[3332],{"type":401,"value":668},{"type":395,"tag":486,"props":3334,"children":3335},{"style":827},[3336],{"type":401,"value":1319},{"type":395,"tag":486,"props":3338,"children":3339},{"style":541},[3340],{"type":401,"value":2058},{"type":395,"tag":486,"props":3342,"children":3343},{"style":567},[3344],{"type":401,"value":3328},{"type":395,"tag":486,"props":3346,"children":3347},{"style":665},[3348],{"type":401,"value":3265},{"type":395,"tag":486,"props":3350,"children":3351},{"style":567},[3352],{"type":401,"value":3353}," size",{"type":395,"tag":486,"props":3355,"children":3356},{"style":541},[3357],{"type":401,"value":2058},{"type":395,"tag":486,"props":3359,"children":3360},{"style":567},[3361],{"type":401,"value":3362}," i",{"type":395,"tag":486,"props":3364,"children":3365},{"style":665},[3366],{"type":401,"value":3367},"++",{"type":395,"tag":486,"props":3369,"children":3370},{"style":541},[3371],{"type":401,"value":1190},{"type":395,"tag":486,"props":3373,"children":3374},{"style":541},[3375],{"type":401,"value":549},{"type":395,"tag":486,"props":3377,"children":3378},{"class":488,"line":578},[3379,3384,3388,3393,3398,3402,3407,3412,3416,3420,3425,3429,3434],{"type":395,"tag":486,"props":3380,"children":3381},{"style":567},[3382],{"type":401,"value":3383},"  str",{"type":395,"tag":486,"props":3385,"children":3386},{"style":541},[3387],{"type":401,"value":1462},{"type":395,"tag":486,"props":3389,"children":3390},{"style":746},[3391],{"type":401,"value":3392},"i",{"type":395,"tag":486,"props":3394,"children":3395},{"style":541},[3396],{"type":401,"value":3397},"]",{"type":395,"tag":486,"props":3399,"children":3400},{"style":665},[3401],{"type":401,"value":2152},{"type":395,"tag":486,"props":3403,"children":3404},{"style":665},[3405],{"type":401,"value":3406}," static_cast\u003C",{"type":395,"tag":486,"props":3408,"children":3409},{"style":529},[3410],{"type":401,"value":3411},"char",{"type":395,"tag":486,"props":3413,"children":3414},{"style":665},[3415],{"type":401,"value":2473},{"type":395,"tag":486,"props":3417,"children":3418},{"style":541},[3419],{"type":401,"value":623},{"type":395,"tag":486,"props":3421,"children":3422},{"style":535},[3423],{"type":401,"value":3424},"random_dist",{"type":395,"tag":486,"props":3426,"children":3427},{"style":541},[3428],{"type":401,"value":623},{"type":395,"tag":486,"props":3430,"children":3431},{"style":746},[3432],{"type":401,"value":3433},"generator",{"type":395,"tag":486,"props":3435,"children":3436},{"style":541},[3437],{"type":401,"value":3438},"));\n",{"type":395,"tag":486,"props":3440,"children":3441},{"class":488,"line":599},[3442],{"type":395,"tag":486,"props":3443,"children":3444},{"style":541},[3445],{"type":401,"value":1332},{"type":395,"tag":403,"props":3447,"children":3449},{"id":3448},"接口层",[3450],{"type":401,"value":3448},{"type":395,"tag":409,"props":3452,"children":3453},{},[3454,3456,3462],{"type":401,"value":3455},"接口的声明位于 interface/kingdb.h，实现则是 interface/kingdb.cc。KingDB 类给 Database 和 Snapshot 定义了要求实现的 Get、Put、Delete、NewIterater、Open、Close、Flush、Compact、NewMultipartReader 接口。KDB 有自己的数据传输格式 ByteArray，诸如 Get、Put 这些接口在 KingDB 类中对应方法得到了重载，以实现通过 std::string 来传递键、值或者两者，可视为为接受 ByteArray 的方法的包装。所有数据库操作方法都返回 Status 对象，相关异常部分的简介见",{"type":395,"tag":420,"props":3457,"children":3459},{"href":3458},"#%E5%BC%82%E5%B8%B8%E4%B8%8E%E6%97%A5%E5%BF%97",[3460],{"type":401,"value":3461},"异常与日志",{"type":401,"value":3463},"小节。",{"type":395,"tag":409,"props":3465,"children":3466},{},[3467],{"type":401,"value":3468},"重载方法的实现示例如下，即先把 std::string 转回 ByteArray 再调用子类（Database 或 Snapshot）的实现。",{"type":395,"tag":475,"props":3470,"children":3472},{"code":3471,"language":478,"meta":389,"className":479,"style":389},"virtual Status Put(WriteOptions& write_options, const std::string& key, const std::string& chunk) {\n  ByteArray byte_array_key = NewDeepCopyByteArray(key.c_str(), key.size());\n  ByteArray byte_array_chunk = NewDeepCopyByteArray(chunk.c_str(), chunk.size());\n  return Put(write_options, byte_array_key, byte_array_chunk);\n}\n",[3473],{"type":395,"tag":482,"props":3474,"children":3475},{"__ignoreMap":389},[3476,3579,3635,3688,3729],{"type":395,"tag":486,"props":3477,"children":3478},{"class":488,"line":489},[3479,3484,3489,3494,3498,3503,3507,3512,3516,3520,3524,3528,3533,3537,3542,3546,3550,3554,3558,3562,3566,3571,3575],{"type":395,"tag":486,"props":3480,"children":3481},{"style":1993},[3482],{"type":401,"value":3483},"virtual",{"type":395,"tag":486,"props":3485,"children":3486},{"style":556},[3487],{"type":401,"value":3488}," Status",{"type":395,"tag":486,"props":3490,"children":3491},{"style":535},[3492],{"type":401,"value":3493}," Put",{"type":395,"tag":486,"props":3495,"children":3496},{"style":541},[3497],{"type":401,"value":623},{"type":395,"tag":486,"props":3499,"children":3500},{"style":556},[3501],{"type":401,"value":3502},"WriteOptions",{"type":395,"tag":486,"props":3504,"children":3505},{"style":1993},[3506],{"type":401,"value":2491},{"type":395,"tag":486,"props":3508,"children":3509},{"style":1402},[3510],{"type":401,"value":3511}," write_options",{"type":395,"tag":486,"props":3513,"children":3514},{"style":541},[3515],{"type":401,"value":633},{"type":395,"tag":486,"props":3517,"children":3518},{"style":1993},[3519],{"type":401,"value":2527},{"type":395,"tag":486,"props":3521,"children":3522},{"style":556},[3523],{"type":401,"value":2967},{"type":395,"tag":486,"props":3525,"children":3526},{"style":541},[3527],{"type":401,"value":564},{"type":395,"tag":486,"props":3529,"children":3530},{"style":556},[3531],{"type":401,"value":3532},"string",{"type":395,"tag":486,"props":3534,"children":3535},{"style":1993},[3536],{"type":401,"value":2491},{"type":395,"tag":486,"props":3538,"children":3539},{"style":1402},[3540],{"type":401,"value":3541}," key",{"type":395,"tag":486,"props":3543,"children":3544},{"style":541},[3545],{"type":401,"value":633},{"type":395,"tag":486,"props":3547,"children":3548},{"style":1993},[3549],{"type":401,"value":2527},{"type":395,"tag":486,"props":3551,"children":3552},{"style":556},[3553],{"type":401,"value":2967},{"type":395,"tag":486,"props":3555,"children":3556},{"style":541},[3557],{"type":401,"value":564},{"type":395,"tag":486,"props":3559,"children":3560},{"style":556},[3561],{"type":401,"value":3532},{"type":395,"tag":486,"props":3563,"children":3564},{"style":1993},[3565],{"type":401,"value":2491},{"type":395,"tag":486,"props":3567,"children":3568},{"style":1402},[3569],{"type":401,"value":3570}," chunk",{"type":395,"tag":486,"props":3572,"children":3573},{"style":541},[3574],{"type":401,"value":1190},{"type":395,"tag":486,"props":3576,"children":3577},{"style":541},[3578],{"type":401,"value":549},{"type":395,"tag":486,"props":3580,"children":3581},{"class":488,"line":516},[3582,3587,3591,3596,3600,3605,3609,3613,3618,3622,3626,3631],{"type":395,"tag":486,"props":3583,"children":3584},{"style":567},[3585],{"type":401,"value":3586},"  ByteArray byte_array_key ",{"type":395,"tag":486,"props":3588,"children":3589},{"style":665},[3590],{"type":401,"value":668},{"type":395,"tag":486,"props":3592,"children":3593},{"style":535},[3594],{"type":401,"value":3595}," NewDeepCopyByteArray",{"type":395,"tag":486,"props":3597,"children":3598},{"style":541},[3599],{"type":401,"value":623},{"type":395,"tag":486,"props":3601,"children":3602},{"style":567},[3603],{"type":401,"value":3604},"key",{"type":395,"tag":486,"props":3606,"children":3607},{"style":541},[3608],{"type":401,"value":678},{"type":395,"tag":486,"props":3610,"children":3611},{"style":535},[3612],{"type":401,"value":806},{"type":395,"tag":486,"props":3614,"children":3615},{"style":541},[3616],{"type":401,"value":3617},"(),",{"type":395,"tag":486,"props":3619,"children":3620},{"style":567},[3621],{"type":401,"value":3541},{"type":395,"tag":486,"props":3623,"children":3624},{"style":541},[3625],{"type":401,"value":678},{"type":395,"tag":486,"props":3627,"children":3628},{"style":535},[3629],{"type":401,"value":3630},"size",{"type":395,"tag":486,"props":3632,"children":3633},{"style":541},[3634],{"type":401,"value":811},{"type":395,"tag":486,"props":3636,"children":3637},{"class":488,"line":525},[3638,3643,3647,3651,3655,3660,3664,3668,3672,3676,3680,3684],{"type":395,"tag":486,"props":3639,"children":3640},{"style":567},[3641],{"type":401,"value":3642},"  ByteArray byte_array_chunk ",{"type":395,"tag":486,"props":3644,"children":3645},{"style":665},[3646],{"type":401,"value":668},{"type":395,"tag":486,"props":3648,"children":3649},{"style":535},[3650],{"type":401,"value":3595},{"type":395,"tag":486,"props":3652,"children":3653},{"style":541},[3654],{"type":401,"value":623},{"type":395,"tag":486,"props":3656,"children":3657},{"style":567},[3658],{"type":401,"value":3659},"chunk",{"type":395,"tag":486,"props":3661,"children":3662},{"style":541},[3663],{"type":401,"value":678},{"type":395,"tag":486,"props":3665,"children":3666},{"style":535},[3667],{"type":401,"value":806},{"type":395,"tag":486,"props":3669,"children":3670},{"style":541},[3671],{"type":401,"value":3617},{"type":395,"tag":486,"props":3673,"children":3674},{"style":567},[3675],{"type":401,"value":3570},{"type":395,"tag":486,"props":3677,"children":3678},{"style":541},[3679],{"type":401,"value":678},{"type":395,"tag":486,"props":3681,"children":3682},{"style":535},[3683],{"type":401,"value":3630},{"type":395,"tag":486,"props":3685,"children":3686},{"style":541},[3687],{"type":401,"value":811},{"type":395,"tag":486,"props":3689,"children":3690},{"class":488,"line":552},[3691,3695,3699,3703,3707,3711,3716,3720,3725],{"type":395,"tag":486,"props":3692,"children":3693},{"style":493},[3694],{"type":401,"value":1314},{"type":395,"tag":486,"props":3696,"children":3697},{"style":535},[3698],{"type":401,"value":3493},{"type":395,"tag":486,"props":3700,"children":3701},{"style":541},[3702],{"type":401,"value":623},{"type":395,"tag":486,"props":3704,"children":3705},{"style":567},[3706],{"type":401,"value":998},{"type":395,"tag":486,"props":3708,"children":3709},{"style":541},[3710],{"type":401,"value":633},{"type":395,"tag":486,"props":3712,"children":3713},{"style":567},[3714],{"type":401,"value":3715}," byte_array_key",{"type":395,"tag":486,"props":3717,"children":3718},{"style":541},[3719],{"type":401,"value":633},{"type":395,"tag":486,"props":3721,"children":3722},{"style":567},[3723],{"type":401,"value":3724}," byte_array_chunk",{"type":395,"tag":486,"props":3726,"children":3727},{"style":541},[3728],{"type":401,"value":653},{"type":395,"tag":486,"props":3730,"children":3731},{"class":488,"line":578},[3732],{"type":395,"tag":486,"props":3733,"children":3734},{"style":541},[3735],{"type":401,"value":1332},{"type":395,"tag":1362,"props":3737,"children":3739},{"id":3738},"数据库开关",[3740],{"type":401,"value":3738},{"type":395,"tag":409,"props":3742,"children":3743},{},[3744],{"type":401,"value":3745},"数据库的开启与关闭，分别对应 Database 类的 Open 和 Close 方法。开启时，通过 stat 库函数找到数据库路径以及配置文件，使用 open 库函数获取其文件描述符。配置文件须先用 flock 锁住，使用 mmap 映射后再读取；如果没有那么分情况写入。之后，创建好 EventManager、WriteBuffer 和 StorageEngine 的实例，就完成了。关闭时过程类似，锁定住配置文件后再关闭，同时删除以上创建的实例。可以发现，资源申请全放在了 Open 中，而资源的销毁放在了 Close 中，而 Database 类析构时会自动调用 Close，所以这是一个类似 RAII 的资源管理过程。",{"type":395,"tag":475,"props":3747,"children":3749},{"code":3748,"language":478,"meta":389,"className":479,"style":389},"class Database: public KingDB {\n  virtual ~Database() { Close(); }\n  virtual Status Open() override {\n    std::string filepath_dboptions = DatabaseOptions::GetPath(dbname_);\n    fd_dboptions_ = open(filepath_dboptions.c_str(), O_RDONLY, 0644);\n    flock(fd_dboptions_, LOCK_EX | LOCK_NB);\n    Mmap mmap(filepath_dboptions, info.st_size);\n    Status status_dboptions = DatabaseOptionEncoder::DecodeFrom(mmap.datafile(), mmap.filesize(), &db_options_candidate);\n    // ...\n    em_ = new EventManager();\n    wb_ = new WriteBuffer(db_options_, em_);\n    se_ = new StorageEngine(db_options_, em_, dbname_);\n    return Status::OK(); \n  }\n  virtual void Close() override {\n    flock(fd_dboptions_, LOCK_UN);\n    close(fd_dboptions_);\n    wb_->Close();\n    se_->Close();\n    delete wb_;\n    delete se_;\n    delete em_;\n  }\n}\n",[3750],{"type":395,"tag":482,"props":3751,"children":3752},{"__ignoreMap":389},[3753,3782,3817,3846,3894,3955,3995,4038,4116,4124,4150,4193,4243,4271,4278,4305,4333,4353,4375,4395,4412,4428,4443,4450],{"type":395,"tag":486,"props":3754,"children":3755},{"class":488,"line":489},[3756,3760,3765,3769,3773,3778],{"type":395,"tag":486,"props":3757,"children":3758},{"style":529},[3759],{"type":401,"value":1906},{"type":395,"tag":486,"props":3761,"children":3762},{"style":556},[3763],{"type":401,"value":3764}," Database",{"type":395,"tag":486,"props":3766,"children":3767},{"style":541},[3768],{"type":401,"value":1591},{"type":395,"tag":486,"props":3770,"children":3771},{"style":529},[3772],{"type":401,"value":1955},{"type":395,"tag":486,"props":3774,"children":3775},{"style":556},[3776],{"type":401,"value":3777}," KingDB",{"type":395,"tag":486,"props":3779,"children":3780},{"style":541},[3781],{"type":401,"value":549},{"type":395,"tag":486,"props":3783,"children":3784},{"class":488,"line":516},[3785,3790,3795,3799,3803,3808,3812],{"type":395,"tag":486,"props":3786,"children":3787},{"style":1993},[3788],{"type":401,"value":3789},"  virtual",{"type":395,"tag":486,"props":3791,"children":3792},{"style":535},[3793],{"type":401,"value":3794}," ~Database",{"type":395,"tag":486,"props":3796,"children":3797},{"style":541},[3798],{"type":401,"value":544},{"type":395,"tag":486,"props":3800,"children":3801},{"style":541},[3802],{"type":401,"value":2015},{"type":395,"tag":486,"props":3804,"children":3805},{"style":535},[3806],{"type":401,"value":3807}," Close",{"type":395,"tag":486,"props":3809,"children":3810},{"style":541},[3811],{"type":401,"value":1982},{"type":395,"tag":486,"props":3813,"children":3814},{"style":541},[3815],{"type":401,"value":3816}," }\n",{"type":395,"tag":486,"props":3818,"children":3819},{"class":488,"line":525},[3820,3824,3828,3833,3837,3842],{"type":395,"tag":486,"props":3821,"children":3822},{"style":1993},[3823],{"type":401,"value":3789},{"type":395,"tag":486,"props":3825,"children":3826},{"style":556},[3827],{"type":401,"value":3488},{"type":395,"tag":486,"props":3829,"children":3830},{"style":535},[3831],{"type":401,"value":3832}," Open",{"type":395,"tag":486,"props":3834,"children":3835},{"style":541},[3836],{"type":401,"value":544},{"type":395,"tag":486,"props":3838,"children":3839},{"style":1993},[3840],{"type":401,"value":3841}," override",{"type":395,"tag":486,"props":3843,"children":3844},{"style":541},[3845],{"type":401,"value":549},{"type":395,"tag":486,"props":3847,"children":3848},{"class":488,"line":552},[3849,3854,3858,3863,3867,3872,3876,3881,3885,3890],{"type":395,"tag":486,"props":3850,"children":3851},{"style":556},[3852],{"type":401,"value":3853},"    std",{"type":395,"tag":486,"props":3855,"children":3856},{"style":541},[3857],{"type":401,"value":564},{"type":395,"tag":486,"props":3859,"children":3860},{"style":746},[3861],{"type":401,"value":3862},"string filepath_dboptions ",{"type":395,"tag":486,"props":3864,"children":3865},{"style":665},[3866],{"type":401,"value":668},{"type":395,"tag":486,"props":3868,"children":3869},{"style":556},[3870],{"type":401,"value":3871}," DatabaseOptions",{"type":395,"tag":486,"props":3873,"children":3874},{"style":541},[3875],{"type":401,"value":564},{"type":395,"tag":486,"props":3877,"children":3878},{"style":535},[3879],{"type":401,"value":3880},"GetPath",{"type":395,"tag":486,"props":3882,"children":3883},{"style":541},[3884],{"type":401,"value":623},{"type":395,"tag":486,"props":3886,"children":3887},{"style":746},[3888],{"type":401,"value":3889},"dbname_",{"type":395,"tag":486,"props":3891,"children":3892},{"style":541},[3893],{"type":401,"value":653},{"type":395,"tag":486,"props":3895,"children":3896},{"class":488,"line":578},[3897,3902,3906,3911,3915,3920,3924,3928,3932,3937,3941,3946,3951],{"type":395,"tag":486,"props":3898,"children":3899},{"style":746},[3900],{"type":401,"value":3901},"    fd_dboptions_ ",{"type":395,"tag":486,"props":3903,"children":3904},{"style":665},[3905],{"type":401,"value":668},{"type":395,"tag":486,"props":3907,"children":3908},{"style":535},[3909],{"type":401,"value":3910}," open",{"type":395,"tag":486,"props":3912,"children":3913},{"style":541},[3914],{"type":401,"value":623},{"type":395,"tag":486,"props":3916,"children":3917},{"style":567},[3918],{"type":401,"value":3919},"filepath_dboptions",{"type":395,"tag":486,"props":3921,"children":3922},{"style":541},[3923],{"type":401,"value":678},{"type":395,"tag":486,"props":3925,"children":3926},{"style":535},[3927],{"type":401,"value":806},{"type":395,"tag":486,"props":3929,"children":3930},{"style":541},[3931],{"type":401,"value":3617},{"type":395,"tag":486,"props":3933,"children":3934},{"style":746},[3935],{"type":401,"value":3936}," O_RDONLY",{"type":395,"tag":486,"props":3938,"children":3939},{"style":541},[3940],{"type":401,"value":633},{"type":395,"tag":486,"props":3942,"children":3944},{"style":3943},"--shiki-light:#F76D47;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[3945],{"type":401,"value":1319},{"type":395,"tag":486,"props":3947,"children":3948},{"style":827},[3949],{"type":401,"value":3950},"644",{"type":395,"tag":486,"props":3952,"children":3953},{"style":541},[3954],{"type":401,"value":653},{"type":395,"tag":486,"props":3956,"children":3957},{"class":488,"line":599},[3958,3963,3967,3972,3976,3981,3986,3991],{"type":395,"tag":486,"props":3959,"children":3960},{"style":535},[3961],{"type":401,"value":3962},"    flock",{"type":395,"tag":486,"props":3964,"children":3965},{"style":541},[3966],{"type":401,"value":623},{"type":395,"tag":486,"props":3968,"children":3969},{"style":746},[3970],{"type":401,"value":3971},"fd_dboptions_",{"type":395,"tag":486,"props":3973,"children":3974},{"style":541},[3975],{"type":401,"value":633},{"type":395,"tag":486,"props":3977,"children":3978},{"style":746},[3979],{"type":401,"value":3980}," LOCK_EX ",{"type":395,"tag":486,"props":3982,"children":3983},{"style":665},[3984],{"type":401,"value":3985},"|",{"type":395,"tag":486,"props":3987,"children":3988},{"style":746},[3989],{"type":401,"value":3990}," LOCK_NB",{"type":395,"tag":486,"props":3992,"children":3993},{"style":541},[3994],{"type":401,"value":653},{"type":395,"tag":486,"props":3996,"children":3997},{"class":488,"line":656},[3998,4003,4008,4012,4016,4020,4025,4029,4034],{"type":395,"tag":486,"props":3999,"children":4000},{"style":746},[4001],{"type":401,"value":4002},"    Mmap ",{"type":395,"tag":486,"props":4004,"children":4005},{"style":535},[4006],{"type":401,"value":4007},"mmap",{"type":395,"tag":486,"props":4009,"children":4010},{"style":541},[4011],{"type":401,"value":623},{"type":395,"tag":486,"props":4013,"children":4014},{"style":746},[4015],{"type":401,"value":3919},{"type":395,"tag":486,"props":4017,"children":4018},{"style":541},[4019],{"type":401,"value":633},{"type":395,"tag":486,"props":4021,"children":4022},{"style":567},[4023],{"type":401,"value":4024}," info",{"type":395,"tag":486,"props":4026,"children":4027},{"style":541},[4028],{"type":401,"value":678},{"type":395,"tag":486,"props":4030,"children":4031},{"style":567},[4032],{"type":401,"value":4033},"st_size",{"type":395,"tag":486,"props":4035,"children":4036},{"style":541},[4037],{"type":401,"value":653},{"type":395,"tag":486,"props":4039,"children":4040},{"class":488,"line":691},[4041,4046,4050,4055,4059,4064,4068,4072,4076,4081,4085,4090,4094,4099,4103,4107,4112],{"type":395,"tag":486,"props":4042,"children":4043},{"style":746},[4044],{"type":401,"value":4045},"    Status status_dboptions ",{"type":395,"tag":486,"props":4047,"children":4048},{"style":665},[4049],{"type":401,"value":668},{"type":395,"tag":486,"props":4051,"children":4052},{"style":556},[4053],{"type":401,"value":4054}," DatabaseOptionEncoder",{"type":395,"tag":486,"props":4056,"children":4057},{"style":541},[4058],{"type":401,"value":564},{"type":395,"tag":486,"props":4060,"children":4061},{"style":535},[4062],{"type":401,"value":4063},"DecodeFrom",{"type":395,"tag":486,"props":4065,"children":4066},{"style":541},[4067],{"type":401,"value":623},{"type":395,"tag":486,"props":4069,"children":4070},{"style":567},[4071],{"type":401,"value":4007},{"type":395,"tag":486,"props":4073,"children":4074},{"style":541},[4075],{"type":401,"value":678},{"type":395,"tag":486,"props":4077,"children":4078},{"style":535},[4079],{"type":401,"value":4080},"datafile",{"type":395,"tag":486,"props":4082,"children":4083},{"style":541},[4084],{"type":401,"value":3617},{"type":395,"tag":486,"props":4086,"children":4087},{"style":567},[4088],{"type":401,"value":4089}," mmap",{"type":395,"tag":486,"props":4091,"children":4092},{"style":541},[4093],{"type":401,"value":678},{"type":395,"tag":486,"props":4095,"children":4096},{"style":535},[4097],{"type":401,"value":4098},"filesize",{"type":395,"tag":486,"props":4100,"children":4101},{"style":541},[4102],{"type":401,"value":3617},{"type":395,"tag":486,"props":4104,"children":4105},{"style":665},[4106],{"type":401,"value":1121},{"type":395,"tag":486,"props":4108,"children":4109},{"style":746},[4110],{"type":401,"value":4111},"db_options_candidate",{"type":395,"tag":486,"props":4113,"children":4114},{"style":541},[4115],{"type":401,"value":653},{"type":395,"tag":486,"props":4117,"children":4118},{"class":488,"line":733},[4119],{"type":395,"tag":486,"props":4120,"children":4121},{"style":1495},[4122],{"type":401,"value":4123},"    // ...\n",{"type":395,"tag":486,"props":4125,"children":4126},{"class":488,"line":814},[4127,4132,4136,4141,4146],{"type":395,"tag":486,"props":4128,"children":4129},{"style":746},[4130],{"type":401,"value":4131},"    em_ ",{"type":395,"tag":486,"props":4133,"children":4134},{"style":665},[4135],{"type":401,"value":668},{"type":395,"tag":486,"props":4137,"children":4138},{"style":665},[4139],{"type":401,"value":4140}," new",{"type":395,"tag":486,"props":4142,"children":4143},{"style":535},[4144],{"type":401,"value":4145}," EventManager",{"type":395,"tag":486,"props":4147,"children":4148},{"style":541},[4149],{"type":401,"value":688},{"type":395,"tag":486,"props":4151,"children":4152},{"class":488,"line":837},[4153,4158,4162,4166,4171,4175,4180,4184,4189],{"type":395,"tag":486,"props":4154,"children":4155},{"style":746},[4156],{"type":401,"value":4157},"    wb_ ",{"type":395,"tag":486,"props":4159,"children":4160},{"style":665},[4161],{"type":401,"value":668},{"type":395,"tag":486,"props":4163,"children":4164},{"style":665},[4165],{"type":401,"value":4140},{"type":395,"tag":486,"props":4167,"children":4168},{"style":535},[4169],{"type":401,"value":4170}," WriteBuffer",{"type":395,"tag":486,"props":4172,"children":4173},{"style":541},[4174],{"type":401,"value":623},{"type":395,"tag":486,"props":4176,"children":4177},{"style":746},[4178],{"type":401,"value":4179},"db_options_",{"type":395,"tag":486,"props":4181,"children":4182},{"style":541},[4183],{"type":401,"value":633},{"type":395,"tag":486,"props":4185,"children":4186},{"style":746},[4187],{"type":401,"value":4188}," em_",{"type":395,"tag":486,"props":4190,"children":4191},{"style":541},[4192],{"type":401,"value":653},{"type":395,"tag":486,"props":4194,"children":4195},{"class":488,"line":846},[4196,4201,4205,4209,4214,4218,4222,4226,4230,4234,4239],{"type":395,"tag":486,"props":4197,"children":4198},{"style":746},[4199],{"type":401,"value":4200},"    se_ ",{"type":395,"tag":486,"props":4202,"children":4203},{"style":665},[4204],{"type":401,"value":668},{"type":395,"tag":486,"props":4206,"children":4207},{"style":665},[4208],{"type":401,"value":4140},{"type":395,"tag":486,"props":4210,"children":4211},{"style":535},[4212],{"type":401,"value":4213}," StorageEngine",{"type":395,"tag":486,"props":4215,"children":4216},{"style":541},[4217],{"type":401,"value":623},{"type":395,"tag":486,"props":4219,"children":4220},{"style":746},[4221],{"type":401,"value":4179},{"type":395,"tag":486,"props":4223,"children":4224},{"style":541},[4225],{"type":401,"value":633},{"type":395,"tag":486,"props":4227,"children":4228},{"style":746},[4229],{"type":401,"value":4188},{"type":395,"tag":486,"props":4231,"children":4232},{"style":541},[4233],{"type":401,"value":633},{"type":395,"tag":486,"props":4235,"children":4236},{"style":746},[4237],{"type":401,"value":4238}," dbname_",{"type":395,"tag":486,"props":4240,"children":4241},{"style":541},[4242],{"type":401,"value":653},{"type":395,"tag":486,"props":4244,"children":4245},{"class":488,"line":854},[4246,4250,4254,4258,4263,4267],{"type":395,"tag":486,"props":4247,"children":4248},{"style":493},[4249],{"type":401,"value":2726},{"type":395,"tag":486,"props":4251,"children":4252},{"style":556},[4253],{"type":401,"value":3488},{"type":395,"tag":486,"props":4255,"children":4256},{"style":541},[4257],{"type":401,"value":564},{"type":395,"tag":486,"props":4259,"children":4260},{"style":535},[4261],{"type":401,"value":4262},"OK",{"type":395,"tag":486,"props":4264,"children":4265},{"style":541},[4266],{"type":401,"value":1982},{"type":395,"tag":486,"props":4268,"children":4269},{"style":746},[4270],{"type":401,"value":1234},{"type":395,"tag":486,"props":4272,"children":4273},{"class":488,"line":897},[4274],{"type":395,"tag":486,"props":4275,"children":4276},{"style":541},[4277],{"type":401,"value":843},{"type":395,"tag":486,"props":4279,"children":4280},{"class":488,"line":938},[4281,4285,4289,4293,4297,4301],{"type":395,"tag":486,"props":4282,"children":4283},{"style":1993},[4284],{"type":401,"value":3789},{"type":395,"tag":486,"props":4286,"children":4287},{"style":529},[4288],{"type":401,"value":2001},{"type":395,"tag":486,"props":4290,"children":4291},{"style":535},[4292],{"type":401,"value":3807},{"type":395,"tag":486,"props":4294,"children":4295},{"style":541},[4296],{"type":401,"value":544},{"type":395,"tag":486,"props":4298,"children":4299},{"style":1993},[4300],{"type":401,"value":3841},{"type":395,"tag":486,"props":4302,"children":4303},{"style":541},[4304],{"type":401,"value":549},{"type":395,"tag":486,"props":4306,"children":4307},{"class":488,"line":946},[4308,4312,4316,4320,4324,4329],{"type":395,"tag":486,"props":4309,"children":4310},{"style":535},[4311],{"type":401,"value":3962},{"type":395,"tag":486,"props":4313,"children":4314},{"style":541},[4315],{"type":401,"value":623},{"type":395,"tag":486,"props":4317,"children":4318},{"style":746},[4319],{"type":401,"value":3971},{"type":395,"tag":486,"props":4321,"children":4322},{"style":541},[4323],{"type":401,"value":633},{"type":395,"tag":486,"props":4325,"children":4326},{"style":746},[4327],{"type":401,"value":4328}," LOCK_UN",{"type":395,"tag":486,"props":4330,"children":4331},{"style":541},[4332],{"type":401,"value":653},{"type":395,"tag":486,"props":4334,"children":4335},{"class":488,"line":967},[4336,4341,4345,4349],{"type":395,"tag":486,"props":4337,"children":4338},{"style":535},[4339],{"type":401,"value":4340},"    close",{"type":395,"tag":486,"props":4342,"children":4343},{"style":541},[4344],{"type":401,"value":623},{"type":395,"tag":486,"props":4346,"children":4347},{"style":746},[4348],{"type":401,"value":3971},{"type":395,"tag":486,"props":4350,"children":4351},{"style":541},[4352],{"type":401,"value":653},{"type":395,"tag":486,"props":4354,"children":4355},{"class":488,"line":1023},[4356,4361,4366,4371],{"type":395,"tag":486,"props":4357,"children":4358},{"style":567},[4359],{"type":401,"value":4360},"    wb_",{"type":395,"tag":486,"props":4362,"children":4363},{"style":541},[4364],{"type":401,"value":4365},"->",{"type":395,"tag":486,"props":4367,"children":4368},{"style":535},[4369],{"type":401,"value":4370},"Close",{"type":395,"tag":486,"props":4372,"children":4373},{"style":541},[4374],{"type":401,"value":688},{"type":395,"tag":486,"props":4376,"children":4377},{"class":488,"line":1031},[4378,4383,4387,4391],{"type":395,"tag":486,"props":4379,"children":4380},{"style":567},[4381],{"type":401,"value":4382},"    se_",{"type":395,"tag":486,"props":4384,"children":4385},{"style":541},[4386],{"type":401,"value":4365},{"type":395,"tag":486,"props":4388,"children":4389},{"style":535},[4390],{"type":401,"value":4370},{"type":395,"tag":486,"props":4392,"children":4393},{"style":541},[4394],{"type":401,"value":688},{"type":395,"tag":486,"props":4396,"children":4397},{"class":488,"line":1052},[4398,4403,4408],{"type":395,"tag":486,"props":4399,"children":4400},{"style":665},[4401],{"type":401,"value":4402},"    delete",{"type":395,"tag":486,"props":4404,"children":4405},{"style":746},[4406],{"type":401,"value":4407}," wb_",{"type":395,"tag":486,"props":4409,"children":4410},{"style":541},[4411],{"type":401,"value":575},{"type":395,"tag":486,"props":4413,"children":4414},{"class":488,"line":1073},[4415,4419,4424],{"type":395,"tag":486,"props":4416,"children":4417},{"style":665},[4418],{"type":401,"value":4402},{"type":395,"tag":486,"props":4420,"children":4421},{"style":746},[4422],{"type":401,"value":4423}," se_",{"type":395,"tag":486,"props":4425,"children":4426},{"style":541},[4427],{"type":401,"value":575},{"type":395,"tag":486,"props":4429,"children":4430},{"class":488,"line":1133},[4431,4435,4439],{"type":395,"tag":486,"props":4432,"children":4433},{"style":665},[4434],{"type":401,"value":4402},{"type":395,"tag":486,"props":4436,"children":4437},{"style":746},[4438],{"type":401,"value":4188},{"type":395,"tag":486,"props":4440,"children":4441},{"style":541},[4442],{"type":401,"value":575},{"type":395,"tag":486,"props":4444,"children":4445},{"class":488,"line":1197},[4446],{"type":395,"tag":486,"props":4447,"children":4448},{"style":541},[4449],{"type":401,"value":843},{"type":395,"tag":486,"props":4451,"children":4452},{"class":488,"line":1237},[4453],{"type":395,"tag":486,"props":4454,"children":4455},{"style":541},[4456],{"type":401,"value":1332},{"type":395,"tag":409,"props":4458,"children":4459},{},[4460],{"type":401,"value":4461},"因为数据库不能同时关闭或是开启，所以 Open 以及 Close 中都使用了 std::unique_lock 进行锁定。",{"type":395,"tag":475,"props":4463,"children":4465},{"code":4464,"language":478,"meta":389,"className":479,"style":389},"virtual Status Open() override {\n  std::unique_lock\u003Cstd::mutex> lock(mutex_close_);\n}\nvirtual void Close() override {\n  std::unique_lock\u003Cstd::mutex> lock(mutex_close_);\n}\n",[4466],{"type":395,"tag":482,"props":4467,"children":4468},{"__ignoreMap":389},[4469,4496,4551,4558,4585,4636],{"type":395,"tag":486,"props":4470,"children":4471},{"class":488,"line":489},[4472,4476,4480,4484,4488,4492],{"type":395,"tag":486,"props":4473,"children":4474},{"style":1993},[4475],{"type":401,"value":3483},{"type":395,"tag":486,"props":4477,"children":4478},{"style":556},[4479],{"type":401,"value":3488},{"type":395,"tag":486,"props":4481,"children":4482},{"style":535},[4483],{"type":401,"value":3832},{"type":395,"tag":486,"props":4485,"children":4486},{"style":541},[4487],{"type":401,"value":544},{"type":395,"tag":486,"props":4489,"children":4490},{"style":1993},[4491],{"type":401,"value":3841},{"type":395,"tag":486,"props":4493,"children":4494},{"style":541},[4495],{"type":401,"value":549},{"type":395,"tag":486,"props":4497,"children":4498},{"class":488,"line":516},[4499,4503,4507,4512,4516,4520,4524,4529,4533,4538,4542,4547],{"type":395,"tag":486,"props":4500,"children":4501},{"style":556},[4502],{"type":401,"value":860},{"type":395,"tag":486,"props":4504,"children":4505},{"style":541},[4506],{"type":401,"value":564},{"type":395,"tag":486,"props":4508,"children":4509},{"style":567},[4510],{"type":401,"value":4511},"unique_lock",{"type":395,"tag":486,"props":4513,"children":4514},{"style":665},[4515],{"type":401,"value":3265},{"type":395,"tag":486,"props":4517,"children":4518},{"style":556},[4519],{"type":401,"value":2937},{"type":395,"tag":486,"props":4521,"children":4522},{"style":541},[4523],{"type":401,"value":564},{"type":395,"tag":486,"props":4525,"children":4526},{"style":567},[4527],{"type":401,"value":4528},"mutex",{"type":395,"tag":486,"props":4530,"children":4531},{"style":665},[4532],{"type":401,"value":2473},{"type":395,"tag":486,"props":4534,"children":4535},{"style":535},[4536],{"type":401,"value":4537}," lock",{"type":395,"tag":486,"props":4539,"children":4540},{"style":541},[4541],{"type":401,"value":623},{"type":395,"tag":486,"props":4543,"children":4544},{"style":567},[4545],{"type":401,"value":4546},"mutex_close_",{"type":395,"tag":486,"props":4548,"children":4549},{"style":541},[4550],{"type":401,"value":653},{"type":395,"tag":486,"props":4552,"children":4553},{"class":488,"line":525},[4554],{"type":395,"tag":486,"props":4555,"children":4556},{"style":541},[4557],{"type":401,"value":1332},{"type":395,"tag":486,"props":4559,"children":4560},{"class":488,"line":552},[4561,4565,4569,4573,4577,4581],{"type":395,"tag":486,"props":4562,"children":4563},{"style":1993},[4564],{"type":401,"value":3483},{"type":395,"tag":486,"props":4566,"children":4567},{"style":529},[4568],{"type":401,"value":2001},{"type":395,"tag":486,"props":4570,"children":4571},{"style":535},[4572],{"type":401,"value":3807},{"type":395,"tag":486,"props":4574,"children":4575},{"style":541},[4576],{"type":401,"value":544},{"type":395,"tag":486,"props":4578,"children":4579},{"style":1993},[4580],{"type":401,"value":3841},{"type":395,"tag":486,"props":4582,"children":4583},{"style":541},[4584],{"type":401,"value":549},{"type":395,"tag":486,"props":4586,"children":4587},{"class":488,"line":578},[4588,4592,4596,4600,4604,4608,4612,4616,4620,4624,4628,4632],{"type":395,"tag":486,"props":4589,"children":4590},{"style":556},[4591],{"type":401,"value":860},{"type":395,"tag":486,"props":4593,"children":4594},{"style":541},[4595],{"type":401,"value":564},{"type":395,"tag":486,"props":4597,"children":4598},{"style":567},[4599],{"type":401,"value":4511},{"type":395,"tag":486,"props":4601,"children":4602},{"style":665},[4603],{"type":401,"value":3265},{"type":395,"tag":486,"props":4605,"children":4606},{"style":556},[4607],{"type":401,"value":2937},{"type":395,"tag":486,"props":4609,"children":4610},{"style":541},[4611],{"type":401,"value":564},{"type":395,"tag":486,"props":4613,"children":4614},{"style":567},[4615],{"type":401,"value":4528},{"type":395,"tag":486,"props":4617,"children":4618},{"style":665},[4619],{"type":401,"value":2473},{"type":395,"tag":486,"props":4621,"children":4622},{"style":535},[4623],{"type":401,"value":4537},{"type":395,"tag":486,"props":4625,"children":4626},{"style":541},[4627],{"type":401,"value":623},{"type":395,"tag":486,"props":4629,"children":4630},{"style":567},[4631],{"type":401,"value":4546},{"type":395,"tag":486,"props":4633,"children":4634},{"style":541},[4635],{"type":401,"value":653},{"type":395,"tag":486,"props":4637,"children":4638},{"class":488,"line":599},[4639],{"type":395,"tag":486,"props":4640,"children":4641},{"style":541},[4642],{"type":401,"value":1332},{"type":395,"tag":403,"props":4644,"children":4645},{"id":3461},[4646],{"type":401,"value":3461},{"type":395,"tag":409,"props":4648,"children":4649},{},[4650],{"type":401,"value":4651},"代码没有使用 C++ 风格的异常捕获，取而代之的是设计了状态类 Status。就像 kingdb_user 示例展示的，所有数据库操作都会返回一个状态实例，通过调用其 IsOK 方法，调用者可以判断处出操作有没有成功；如果失败了，可以使用 ToString 方法把出错原因输出。尽管这种设计会带来额外的内存开销，且使每次调用都带来轻微的性能消耗，不过这种消耗可以避免魔法数值，它将错误码和核心解耦，使代码有更佳的可读性。",{"type":395,"tag":475,"props":4653,"children":4655},{"code":4654,"language":478,"meta":389,"className":479,"style":389},"class Status {\n  // ...\n  static Status OK() { return Status(); }\n  bool IsOK() const { return (code_ == kOK); }\n  // ...\n  enum Code {\n    kOK = 0, \n    kNotFound = 1,\n    kDeleteOrder = 2,\n    kInvalidArgument = 3,\n    kIOError = 4,\n    kDone = 5,\n    kMultipartRequired = 6\n  };\n  // ...\n}\nstd::string Status::ToString() const {\n  if (message1_ == \"\") {\n    return \"OK\";\n  } else {\n    char tmp[30];\n    const char* type;\n    switch (code()) {\n      case kOK:\n        type = \"OK\";\n        break;\n      // ...\n    }\n    // ...\n    return result;\n  }\n}\n",[4656],{"type":395,"tag":482,"props":4657,"children":4658},{"__ignoreMap":389},[4659,4674,4681,4722,4777,4784,4801,4826,4847,4868,4889,4910,4931,4948,4956,4963,4970,5009,5042,5065,5080,5106,5133,5157,5174,5202,5214,5222,5230,5237,5254,5262],{"type":395,"tag":486,"props":4660,"children":4661},{"class":488,"line":489},[4662,4666,4670],{"type":395,"tag":486,"props":4663,"children":4664},{"style":529},[4665],{"type":401,"value":1906},{"type":395,"tag":486,"props":4667,"children":4668},{"style":556},[4669],{"type":401,"value":3488},{"type":395,"tag":486,"props":4671,"children":4672},{"style":541},[4673],{"type":401,"value":549},{"type":395,"tag":486,"props":4675,"children":4676},{"class":488,"line":516},[4677],{"type":395,"tag":486,"props":4678,"children":4679},{"style":1495},[4680],{"type":401,"value":1851},{"type":395,"tag":486,"props":4682,"children":4683},{"class":488,"line":525},[4684,4688,4692,4697,4701,4705,4710,4714,4718],{"type":395,"tag":486,"props":4685,"children":4686},{"style":1993},[4687],{"type":401,"value":1996},{"type":395,"tag":486,"props":4689,"children":4690},{"style":556},[4691],{"type":401,"value":3488},{"type":395,"tag":486,"props":4693,"children":4694},{"style":535},[4695],{"type":401,"value":4696}," OK",{"type":395,"tag":486,"props":4698,"children":4699},{"style":541},[4700],{"type":401,"value":544},{"type":395,"tag":486,"props":4702,"children":4703},{"style":541},[4704],{"type":401,"value":2015},{"type":395,"tag":486,"props":4706,"children":4707},{"style":493},[4708],{"type":401,"value":4709}," return",{"type":395,"tag":486,"props":4711,"children":4712},{"style":535},[4713],{"type":401,"value":3488},{"type":395,"tag":486,"props":4715,"children":4716},{"style":541},[4717],{"type":401,"value":1982},{"type":395,"tag":486,"props":4719,"children":4720},{"style":541},[4721],{"type":401,"value":3816},{"type":395,"tag":486,"props":4723,"children":4724},{"class":488,"line":552},[4725,4730,4735,4739,4743,4747,4751,4755,4760,4764,4769,4773],{"type":395,"tag":486,"props":4726,"children":4727},{"style":529},[4728],{"type":401,"value":4729},"  bool",{"type":395,"tag":486,"props":4731,"children":4732},{"style":535},[4733],{"type":401,"value":4734}," IsOK",{"type":395,"tag":486,"props":4736,"children":4737},{"style":541},[4738],{"type":401,"value":544},{"type":395,"tag":486,"props":4740,"children":4741},{"style":1993},[4742],{"type":401,"value":2527},{"type":395,"tag":486,"props":4744,"children":4745},{"style":541},[4746],{"type":401,"value":2015},{"type":395,"tag":486,"props":4748,"children":4749},{"style":493},[4750],{"type":401,"value":4709},{"type":395,"tag":486,"props":4752,"children":4753},{"style":541},[4754],{"type":401,"value":702},{"type":395,"tag":486,"props":4756,"children":4757},{"style":746},[4758],{"type":401,"value":4759},"code_ ",{"type":395,"tag":486,"props":4761,"children":4762},{"style":665},[4763],{"type":401,"value":1173},{"type":395,"tag":486,"props":4765,"children":4766},{"style":746},[4767],{"type":401,"value":4768}," kOK",{"type":395,"tag":486,"props":4770,"children":4771},{"style":541},[4772],{"type":401,"value":1229},{"type":395,"tag":486,"props":4774,"children":4775},{"style":541},[4776],{"type":401,"value":3816},{"type":395,"tag":486,"props":4778,"children":4779},{"class":488,"line":578},[4780],{"type":395,"tag":486,"props":4781,"children":4782},{"style":1495},[4783],{"type":401,"value":1851},{"type":395,"tag":486,"props":4785,"children":4786},{"class":488,"line":599},[4787,4792,4797],{"type":395,"tag":486,"props":4788,"children":4789},{"style":529},[4790],{"type":401,"value":4791},"  enum",{"type":395,"tag":486,"props":4793,"children":4794},{"style":556},[4795],{"type":401,"value":4796}," Code",{"type":395,"tag":486,"props":4798,"children":4799},{"style":541},[4800],{"type":401,"value":549},{"type":395,"tag":486,"props":4802,"children":4803},{"class":488,"line":656},[4804,4810,4814,4818,4822],{"type":395,"tag":486,"props":4805,"children":4807},{"style":4806},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#F8F8F2",[4808],{"type":401,"value":4809},"    kOK",{"type":395,"tag":486,"props":4811,"children":4812},{"style":665},[4813],{"type":401,"value":2152},{"type":395,"tag":486,"props":4815,"children":4816},{"style":827},[4817],{"type":401,"value":1319},{"type":395,"tag":486,"props":4819,"children":4820},{"style":541},[4821],{"type":401,"value":633},{"type":395,"tag":486,"props":4823,"children":4824},{"style":746},[4825],{"type":401,"value":1234},{"type":395,"tag":486,"props":4827,"children":4828},{"class":488,"line":691},[4829,4834,4838,4842],{"type":395,"tag":486,"props":4830,"children":4831},{"style":4806},[4832],{"type":401,"value":4833},"    kNotFound",{"type":395,"tag":486,"props":4835,"children":4836},{"style":665},[4837],{"type":401,"value":2152},{"type":395,"tag":486,"props":4839,"children":4840},{"style":827},[4841],{"type":401,"value":3044},{"type":395,"tag":486,"props":4843,"children":4844},{"style":541},[4845],{"type":401,"value":4846},",\n",{"type":395,"tag":486,"props":4848,"children":4849},{"class":488,"line":733},[4850,4855,4859,4864],{"type":395,"tag":486,"props":4851,"children":4852},{"style":4806},[4853],{"type":401,"value":4854},"    kDeleteOrder",{"type":395,"tag":486,"props":4856,"children":4857},{"style":665},[4858],{"type":401,"value":2152},{"type":395,"tag":486,"props":4860,"children":4861},{"style":827},[4862],{"type":401,"value":4863}," 2",{"type":395,"tag":486,"props":4865,"children":4866},{"style":541},[4867],{"type":401,"value":4846},{"type":395,"tag":486,"props":4869,"children":4870},{"class":488,"line":814},[4871,4876,4880,4885],{"type":395,"tag":486,"props":4872,"children":4873},{"style":4806},[4874],{"type":401,"value":4875},"    kInvalidArgument",{"type":395,"tag":486,"props":4877,"children":4878},{"style":665},[4879],{"type":401,"value":2152},{"type":395,"tag":486,"props":4881,"children":4882},{"style":827},[4883],{"type":401,"value":4884}," 3",{"type":395,"tag":486,"props":4886,"children":4887},{"style":541},[4888],{"type":401,"value":4846},{"type":395,"tag":486,"props":4890,"children":4891},{"class":488,"line":837},[4892,4897,4901,4906],{"type":395,"tag":486,"props":4893,"children":4894},{"style":4806},[4895],{"type":401,"value":4896},"    kIOError",{"type":395,"tag":486,"props":4898,"children":4899},{"style":665},[4900],{"type":401,"value":2152},{"type":395,"tag":486,"props":4902,"children":4903},{"style":827},[4904],{"type":401,"value":4905}," 4",{"type":395,"tag":486,"props":4907,"children":4908},{"style":541},[4909],{"type":401,"value":4846},{"type":395,"tag":486,"props":4911,"children":4912},{"class":488,"line":846},[4913,4918,4922,4927],{"type":395,"tag":486,"props":4914,"children":4915},{"style":4806},[4916],{"type":401,"value":4917},"    kDone",{"type":395,"tag":486,"props":4919,"children":4920},{"style":665},[4921],{"type":401,"value":2152},{"type":395,"tag":486,"props":4923,"children":4924},{"style":827},[4925],{"type":401,"value":4926}," 5",{"type":395,"tag":486,"props":4928,"children":4929},{"style":541},[4930],{"type":401,"value":4846},{"type":395,"tag":486,"props":4932,"children":4933},{"class":488,"line":854},[4934,4939,4943],{"type":395,"tag":486,"props":4935,"children":4936},{"style":4806},[4937],{"type":401,"value":4938},"    kMultipartRequired",{"type":395,"tag":486,"props":4940,"children":4941},{"style":665},[4942],{"type":401,"value":2152},{"type":395,"tag":486,"props":4944,"children":4945},{"style":827},[4946],{"type":401,"value":4947}," 6\n",{"type":395,"tag":486,"props":4949,"children":4950},{"class":488,"line":897},[4951],{"type":395,"tag":486,"props":4952,"children":4953},{"style":541},[4954],{"type":401,"value":4955},"  };\n",{"type":395,"tag":486,"props":4957,"children":4958},{"class":488,"line":938},[4959],{"type":395,"tag":486,"props":4960,"children":4961},{"style":1495},[4962],{"type":401,"value":1851},{"type":395,"tag":486,"props":4964,"children":4965},{"class":488,"line":946},[4966],{"type":395,"tag":486,"props":4967,"children":4968},{"style":541},[4969],{"type":401,"value":1332},{"type":395,"tag":486,"props":4971,"children":4972},{"class":488,"line":967},[4973,4977,4981,4985,4989,4993,4997,5001,5005],{"type":395,"tag":486,"props":4974,"children":4975},{"style":556},[4976],{"type":401,"value":2937},{"type":395,"tag":486,"props":4978,"children":4979},{"style":541},[4980],{"type":401,"value":564},{"type":395,"tag":486,"props":4982,"children":4983},{"style":556},[4984],{"type":401,"value":3532},{"type":395,"tag":486,"props":4986,"children":4987},{"style":556},[4988],{"type":401,"value":3488},{"type":395,"tag":486,"props":4990,"children":4991},{"style":541},[4992],{"type":401,"value":564},{"type":395,"tag":486,"props":4994,"children":4995},{"style":535},[4996],{"type":401,"value":796},{"type":395,"tag":486,"props":4998,"children":4999},{"style":541},[5000],{"type":401,"value":544},{"type":395,"tag":486,"props":5002,"children":5003},{"style":1993},[5004],{"type":401,"value":2527},{"type":395,"tag":486,"props":5006,"children":5007},{"style":541},[5008],{"type":401,"value":549},{"type":395,"tag":486,"props":5010,"children":5011},{"class":488,"line":1023},[5012,5016,5020,5025,5029,5034,5038],{"type":395,"tag":486,"props":5013,"children":5014},{"style":493},[5015],{"type":401,"value":697},{"type":395,"tag":486,"props":5017,"children":5018},{"style":541},[5019],{"type":401,"value":702},{"type":395,"tag":486,"props":5021,"children":5022},{"style":746},[5023],{"type":401,"value":5024},"message1_ ",{"type":395,"tag":486,"props":5026,"children":5027},{"style":665},[5028],{"type":401,"value":1173},{"type":395,"tag":486,"props":5030,"children":5031},{"style":499},[5032],{"type":401,"value":5033}," \"\"",{"type":395,"tag":486,"props":5035,"children":5036},{"style":541},[5037],{"type":401,"value":1190},{"type":395,"tag":486,"props":5039,"children":5040},{"style":541},[5041],{"type":401,"value":549},{"type":395,"tag":486,"props":5043,"children":5044},{"class":488,"line":1031},[5045,5049,5053,5057,5061],{"type":395,"tag":486,"props":5046,"children":5047},{"style":493},[5048],{"type":401,"value":2726},{"type":395,"tag":486,"props":5050,"children":5051},{"style":499},[5052],{"type":401,"value":638},{"type":395,"tag":486,"props":5054,"children":5055},{"style":505},[5056],{"type":401,"value":4262},{"type":395,"tag":486,"props":5058,"children":5059},{"style":499},[5060],{"type":401,"value":648},{"type":395,"tag":486,"props":5062,"children":5063},{"style":541},[5064],{"type":401,"value":575},{"type":395,"tag":486,"props":5066,"children":5067},{"class":488,"line":1052},[5068,5072,5076],{"type":395,"tag":486,"props":5069,"children":5070},{"style":541},[5071],{"type":401,"value":1243},{"type":395,"tag":486,"props":5073,"children":5074},{"style":493},[5075],{"type":401,"value":1248},{"type":395,"tag":486,"props":5077,"children":5078},{"style":541},[5079],{"type":401,"value":549},{"type":395,"tag":486,"props":5081,"children":5082},{"class":488,"line":1073},[5083,5088,5093,5097,5102],{"type":395,"tag":486,"props":5084,"children":5085},{"style":529},[5086],{"type":401,"value":5087},"    char",{"type":395,"tag":486,"props":5089,"children":5090},{"style":567},[5091],{"type":401,"value":5092}," tmp",{"type":395,"tag":486,"props":5094,"children":5095},{"style":541},[5096],{"type":401,"value":1462},{"type":395,"tag":486,"props":5098,"children":5099},{"style":827},[5100],{"type":401,"value":5101},"30",{"type":395,"tag":486,"props":5103,"children":5104},{"style":541},[5105],{"type":401,"value":1472},{"type":395,"tag":486,"props":5107,"children":5108},{"class":488,"line":1133},[5109,5114,5119,5124,5129],{"type":395,"tag":486,"props":5110,"children":5111},{"style":1993},[5112],{"type":401,"value":5113},"    const",{"type":395,"tag":486,"props":5115,"children":5116},{"style":529},[5117],{"type":401,"value":5118}," char",{"type":395,"tag":486,"props":5120,"children":5121},{"style":665},[5122],{"type":401,"value":5123},"*",{"type":395,"tag":486,"props":5125,"children":5126},{"style":746},[5127],{"type":401,"value":5128}," type",{"type":395,"tag":486,"props":5130,"children":5131},{"style":541},[5132],{"type":401,"value":575},{"type":395,"tag":486,"props":5134,"children":5135},{"class":488,"line":1197},[5136,5141,5145,5149,5153],{"type":395,"tag":486,"props":5137,"children":5138},{"style":493},[5139],{"type":401,"value":5140},"    switch",{"type":395,"tag":486,"props":5142,"children":5143},{"style":541},[5144],{"type":401,"value":702},{"type":395,"tag":486,"props":5146,"children":5147},{"style":535},[5148],{"type":401,"value":482},{"type":395,"tag":486,"props":5150,"children":5151},{"style":541},[5152],{"type":401,"value":726},{"type":395,"tag":486,"props":5154,"children":5155},{"style":541},[5156],{"type":401,"value":549},{"type":395,"tag":486,"props":5158,"children":5159},{"class":488,"line":1237},[5160,5165,5169],{"type":395,"tag":486,"props":5161,"children":5162},{"style":493},[5163],{"type":401,"value":5164},"      case",{"type":395,"tag":486,"props":5166,"children":5167},{"style":746},[5168],{"type":401,"value":4768},{"type":395,"tag":486,"props":5170,"children":5171},{"style":541},[5172],{"type":401,"value":5173},":\n",{"type":395,"tag":486,"props":5175,"children":5176},{"class":488,"line":1255},[5177,5182,5186,5190,5194,5198],{"type":395,"tag":486,"props":5178,"children":5179},{"style":746},[5180],{"type":401,"value":5181},"        type ",{"type":395,"tag":486,"props":5183,"children":5184},{"style":665},[5185],{"type":401,"value":668},{"type":395,"tag":486,"props":5187,"children":5188},{"style":499},[5189],{"type":401,"value":638},{"type":395,"tag":486,"props":5191,"children":5192},{"style":505},[5193],{"type":401,"value":4262},{"type":395,"tag":486,"props":5195,"children":5196},{"style":499},[5197],{"type":401,"value":648},{"type":395,"tag":486,"props":5199,"children":5200},{"style":541},[5201],{"type":401,"value":575},{"type":395,"tag":486,"props":5203,"children":5204},{"class":488,"line":1292},[5205,5210],{"type":395,"tag":486,"props":5206,"children":5207},{"style":493},[5208],{"type":401,"value":5209},"        break",{"type":395,"tag":486,"props":5211,"children":5212},{"style":541},[5213],{"type":401,"value":575},{"type":395,"tag":486,"props":5215,"children":5216},{"class":488,"line":1300},[5217],{"type":395,"tag":486,"props":5218,"children":5219},{"style":1495},[5220],{"type":401,"value":5221},"      // ...\n",{"type":395,"tag":486,"props":5223,"children":5224},{"class":488,"line":1308},[5225],{"type":395,"tag":486,"props":5226,"children":5227},{"style":541},[5228],{"type":401,"value":5229},"    }\n",{"type":395,"tag":486,"props":5231,"children":5232},{"class":488,"line":1326},[5233],{"type":395,"tag":486,"props":5234,"children":5235},{"style":1495},[5236],{"type":401,"value":4123},{"type":395,"tag":486,"props":5238,"children":5240},{"class":488,"line":5239},30,[5241,5245,5250],{"type":395,"tag":486,"props":5242,"children":5243},{"style":493},[5244],{"type":401,"value":2726},{"type":395,"tag":486,"props":5246,"children":5247},{"style":746},[5248],{"type":401,"value":5249}," result",{"type":395,"tag":486,"props":5251,"children":5252},{"style":541},[5253],{"type":401,"value":575},{"type":395,"tag":486,"props":5255,"children":5257},{"class":488,"line":5256},31,[5258],{"type":395,"tag":486,"props":5259,"children":5260},{"style":541},[5261],{"type":401,"value":843},{"type":395,"tag":486,"props":5263,"children":5265},{"class":488,"line":5264},32,[5266],{"type":395,"tag":486,"props":5267,"children":5268},{"style":541},[5269],{"type":401,"value":1332},{"type":395,"tag":409,"props":5271,"children":5272},{},[5273],{"type":401,"value":5274},"KDB 内部代码出现异常时会使用日志将其记录下来。如果没有日志，那么在排查代码问题时简直就是噩梦。KDB 有两套日志的输出目标，分别是系统输出和标准输出设备。日志类记录输出目标、日志级别、线程锁等成员，并通过静态方法 Logv 实现记录日志。锁的最大用处是保证记录顺序。仅有当出现最高级别的日志（kLogLevelEMERG）时，才会跳过锁直接写入。出现 kLogLevelEMERG 时意味着程序遇到了紧急问题，通常会直接退出或是返回 Status 异常，所以这个时候需要及时记录。",{"type":395,"tag":409,"props":5276,"children":5277},{},[5278],{"type":401,"value":5279},"日志级别的划分参考了 Syslog：",{"type":395,"tag":436,"props":5281,"children":5282},{},[5283,5288,5293,5298,5303,5308,5313,5318,5323,5328],{"type":395,"tag":440,"props":5284,"children":5285},{},[5286],{"type":401,"value":5287},"silent: all logging is turned off",{"type":395,"tag":440,"props":5289,"children":5290},{},[5291],{"type":401,"value":5292},"emerg: system is unusable, imminent crash",{"type":395,"tag":440,"props":5294,"children":5295},{},[5296],{"type":401,"value":5297},"alert: error event, immediate action required",{"type":395,"tag":440,"props":5299,"children":5300},{},[5301],{"type":401,"value":5302},"crit: error event, immediate action required",{"type":395,"tag":440,"props":5304,"children":5305},{},[5306],{"type":401,"value":5307},"error: error event, action is required but is not urgent",{"type":395,"tag":440,"props":5309,"children":5310},{},[5311],{"type":401,"value":5312},"warn: events that can be harmful if no action is taken",{"type":395,"tag":440,"props":5314,"children":5315},{},[5316],{"type":401,"value":5317},"notice: unusual events, but no immediate action required",{"type":395,"tag":440,"props":5319,"children":5320},{},[5321],{"type":401,"value":5322},"info: normal operation events, no action required",{"type":395,"tag":440,"props":5324,"children":5325},{},[5326],{"type":401,"value":5327},"debug: events used for debugging, no action required",{"type":395,"tag":440,"props":5329,"children":5330},{},[5331],{"type":401,"value":5332},"trace: fine-grained events used for debugging, no action required",{"type":395,"tag":1362,"props":5334,"children":5336},{"id":5335},"日志调用用宏还是函数",[5337],{"type":401,"value":5335},{"type":395,"tag":409,"props":5339,"children":5340},{},[5341,5343,5349,5351,5355],{"type":401,"value":5342},"原先的提交中，日志调用被定义在了宏里，直接调用 Logger::Logv 去记录。日志宏中使用子宏 ",{"type":395,"tag":5344,"props":5345,"children":5346},"strong",{},[5347],{"type":401,"value":5348},"VA_ARGS",{"type":401,"value":5350}," 来记录可变参数。",{"type":395,"tag":5344,"props":5352,"children":5353},{},[5354],{"type":401,"value":5348},{"type":401,"value":5356}," 前面有标记黏贴运算符的原因是当日志宏的可变参数为空时，可以把末尾的逗号去掉。",{"type":395,"tag":475,"props":5358,"children":5360},{"code":5359,"language":478,"meta":389,"className":479,"style":389},"class log {\n  static void emerg(const char* logname, const char* format, ...) {\n    va_list args;\n    va_start(args, format);\n    Logger::Logv(false, Logger::kLogLevelEMERG, LOG_EMERG, logname, format, args);\n    va_end(args);\n  }\n}\n// ...\n#define LOG_EMERG(logname, fmt, ...) \\\n        Logger::Logv(false, Logger::kLogLevelEMERG, logname, fmt, ##__VA_ARGS__)\n",[5361],{"type":395,"tag":482,"props":5362,"children":5363},{"__ignoreMap":389},[5364,5380,5455,5467,5496,5578,5598,5605,5612,5619,5661],{"type":395,"tag":486,"props":5365,"children":5366},{"class":488,"line":489},[5367,5371,5376],{"type":395,"tag":486,"props":5368,"children":5369},{"style":529},[5370],{"type":401,"value":1906},{"type":395,"tag":486,"props":5372,"children":5373},{"style":556},[5374],{"type":401,"value":5375}," log",{"type":395,"tag":486,"props":5377,"children":5378},{"style":541},[5379],{"type":401,"value":549},{"type":395,"tag":486,"props":5381,"children":5382},{"class":488,"line":516},[5383,5387,5391,5396,5400,5404,5408,5412,5417,5421,5425,5429,5433,5438,5442,5447,5451],{"type":395,"tag":486,"props":5384,"children":5385},{"style":1993},[5386],{"type":401,"value":1996},{"type":395,"tag":486,"props":5388,"children":5389},{"style":529},[5390],{"type":401,"value":2001},{"type":395,"tag":486,"props":5392,"children":5393},{"style":535},[5394],{"type":401,"value":5395}," emerg",{"type":395,"tag":486,"props":5397,"children":5398},{"style":541},[5399],{"type":401,"value":623},{"type":395,"tag":486,"props":5401,"children":5402},{"style":1993},[5403],{"type":401,"value":2505},{"type":395,"tag":486,"props":5405,"children":5406},{"style":529},[5407],{"type":401,"value":5118},{"type":395,"tag":486,"props":5409,"children":5410},{"style":1993},[5411],{"type":401,"value":5123},{"type":395,"tag":486,"props":5413,"children":5414},{"style":1402},[5415],{"type":401,"value":5416}," logname",{"type":395,"tag":486,"props":5418,"children":5419},{"style":541},[5420],{"type":401,"value":633},{"type":395,"tag":486,"props":5422,"children":5423},{"style":1993},[5424],{"type":401,"value":2527},{"type":395,"tag":486,"props":5426,"children":5427},{"style":529},[5428],{"type":401,"value":5118},{"type":395,"tag":486,"props":5430,"children":5431},{"style":1993},[5432],{"type":401,"value":5123},{"type":395,"tag":486,"props":5434,"children":5435},{"style":1402},[5436],{"type":401,"value":5437}," format",{"type":395,"tag":486,"props":5439,"children":5440},{"style":541},[5441],{"type":401,"value":633},{"type":395,"tag":486,"props":5443,"children":5444},{"style":746},[5445],{"type":401,"value":5446}," ...",{"type":395,"tag":486,"props":5448,"children":5449},{"style":541},[5450],{"type":401,"value":1190},{"type":395,"tag":486,"props":5452,"children":5453},{"style":541},[5454],{"type":401,"value":549},{"type":395,"tag":486,"props":5456,"children":5457},{"class":488,"line":525},[5458,5463],{"type":395,"tag":486,"props":5459,"children":5460},{"style":746},[5461],{"type":401,"value":5462},"    va_list args",{"type":395,"tag":486,"props":5464,"children":5465},{"style":541},[5466],{"type":401,"value":575},{"type":395,"tag":486,"props":5468,"children":5469},{"class":488,"line":552},[5470,5475,5479,5484,5488,5492],{"type":395,"tag":486,"props":5471,"children":5472},{"style":535},[5473],{"type":401,"value":5474},"    va_start",{"type":395,"tag":486,"props":5476,"children":5477},{"style":541},[5478],{"type":401,"value":623},{"type":395,"tag":486,"props":5480,"children":5481},{"style":746},[5482],{"type":401,"value":5483},"args",{"type":395,"tag":486,"props":5485,"children":5486},{"style":541},[5487],{"type":401,"value":633},{"type":395,"tag":486,"props":5489,"children":5490},{"style":746},[5491],{"type":401,"value":5437},{"type":395,"tag":486,"props":5493,"children":5494},{"style":541},[5495],{"type":401,"value":653},{"type":395,"tag":486,"props":5497,"children":5498},{"class":488,"line":578},[5499,5504,5508,5513,5517,5522,5526,5531,5535,5540,5544,5549,5553,5557,5561,5565,5569,5574],{"type":395,"tag":486,"props":5500,"children":5501},{"style":556},[5502],{"type":401,"value":5503},"    Logger",{"type":395,"tag":486,"props":5505,"children":5506},{"style":541},[5507],{"type":401,"value":564},{"type":395,"tag":486,"props":5509,"children":5510},{"style":535},[5511],{"type":401,"value":5512},"Logv",{"type":395,"tag":486,"props":5514,"children":5515},{"style":541},[5516],{"type":401,"value":623},{"type":395,"tag":486,"props":5518,"children":5519},{"style":2693},[5520],{"type":401,"value":5521},"false",{"type":395,"tag":486,"props":5523,"children":5524},{"style":541},[5525],{"type":401,"value":633},{"type":395,"tag":486,"props":5527,"children":5528},{"style":556},[5529],{"type":401,"value":5530}," Logger",{"type":395,"tag":486,"props":5532,"children":5533},{"style":541},[5534],{"type":401,"value":564},{"type":395,"tag":486,"props":5536,"children":5537},{"style":746},[5538],{"type":401,"value":5539},"kLogLevelEMERG",{"type":395,"tag":486,"props":5541,"children":5542},{"style":541},[5543],{"type":401,"value":633},{"type":395,"tag":486,"props":5545,"children":5546},{"style":746},[5547],{"type":401,"value":5548}," LOG_EMERG",{"type":395,"tag":486,"props":5550,"children":5551},{"style":541},[5552],{"type":401,"value":633},{"type":395,"tag":486,"props":5554,"children":5555},{"style":746},[5556],{"type":401,"value":5416},{"type":395,"tag":486,"props":5558,"children":5559},{"style":541},[5560],{"type":401,"value":633},{"type":395,"tag":486,"props":5562,"children":5563},{"style":746},[5564],{"type":401,"value":5437},{"type":395,"tag":486,"props":5566,"children":5567},{"style":541},[5568],{"type":401,"value":633},{"type":395,"tag":486,"props":5570,"children":5571},{"style":746},[5572],{"type":401,"value":5573}," args",{"type":395,"tag":486,"props":5575,"children":5576},{"style":541},[5577],{"type":401,"value":653},{"type":395,"tag":486,"props":5579,"children":5580},{"class":488,"line":599},[5581,5586,5590,5594],{"type":395,"tag":486,"props":5582,"children":5583},{"style":535},[5584],{"type":401,"value":5585},"    va_end",{"type":395,"tag":486,"props":5587,"children":5588},{"style":541},[5589],{"type":401,"value":623},{"type":395,"tag":486,"props":5591,"children":5592},{"style":746},[5593],{"type":401,"value":5483},{"type":395,"tag":486,"props":5595,"children":5596},{"style":541},[5597],{"type":401,"value":653},{"type":395,"tag":486,"props":5599,"children":5600},{"class":488,"line":656},[5601],{"type":395,"tag":486,"props":5602,"children":5603},{"style":541},[5604],{"type":401,"value":843},{"type":395,"tag":486,"props":5606,"children":5607},{"class":488,"line":691},[5608],{"type":395,"tag":486,"props":5609,"children":5610},{"style":541},[5611],{"type":401,"value":1332},{"type":395,"tag":486,"props":5613,"children":5614},{"class":488,"line":733},[5615],{"type":395,"tag":486,"props":5616,"children":5617},{"style":1495},[5618],{"type":401,"value":3307},{"type":395,"tag":486,"props":5620,"children":5621},{"class":488,"line":814},[5622,5626,5630,5634,5639,5643,5648,5652,5657],{"type":395,"tag":486,"props":5623,"children":5624},{"style":493},[5625],{"type":401,"value":1866},{"type":395,"tag":486,"props":5627,"children":5628},{"style":535},[5629],{"type":401,"value":5548},{"type":395,"tag":486,"props":5631,"children":5632},{"style":541},[5633],{"type":401,"value":623},{"type":395,"tag":486,"props":5635,"children":5636},{"style":1402},[5637],{"type":401,"value":5638},"logname",{"type":395,"tag":486,"props":5640,"children":5641},{"style":541},[5642],{"type":401,"value":633},{"type":395,"tag":486,"props":5644,"children":5645},{"style":1402},[5646],{"type":401,"value":5647}," fmt",{"type":395,"tag":486,"props":5649,"children":5650},{"style":541},[5651],{"type":401,"value":633},{"type":395,"tag":486,"props":5653,"children":5654},{"style":541},[5655],{"type":401,"value":5656}," ...)",{"type":395,"tag":486,"props":5658,"children":5659},{"style":771},[5660],{"type":401,"value":2252},{"type":395,"tag":486,"props":5662,"children":5663},{"class":488,"line":837},[5664,5669,5673,5677,5681,5685,5689,5693,5697,5701,5705,5709,5713,5717,5721,5726],{"type":395,"tag":486,"props":5665,"children":5666},{"style":556},[5667],{"type":401,"value":5668},"        Logger",{"type":395,"tag":486,"props":5670,"children":5671},{"style":541},[5672],{"type":401,"value":564},{"type":395,"tag":486,"props":5674,"children":5675},{"style":535},[5676],{"type":401,"value":5512},{"type":395,"tag":486,"props":5678,"children":5679},{"style":541},[5680],{"type":401,"value":623},{"type":395,"tag":486,"props":5682,"children":5683},{"style":2693},[5684],{"type":401,"value":5521},{"type":395,"tag":486,"props":5686,"children":5687},{"style":541},[5688],{"type":401,"value":633},{"type":395,"tag":486,"props":5690,"children":5691},{"style":556},[5692],{"type":401,"value":5530},{"type":395,"tag":486,"props":5694,"children":5695},{"style":541},[5696],{"type":401,"value":564},{"type":395,"tag":486,"props":5698,"children":5699},{"style":746},[5700],{"type":401,"value":5539},{"type":395,"tag":486,"props":5702,"children":5703},{"style":541},[5704],{"type":401,"value":633},{"type":395,"tag":486,"props":5706,"children":5707},{"style":746},[5708],{"type":401,"value":5416},{"type":395,"tag":486,"props":5710,"children":5711},{"style":541},[5712],{"type":401,"value":633},{"type":395,"tag":486,"props":5714,"children":5715},{"style":746},[5716],{"type":401,"value":5647},{"type":395,"tag":486,"props":5718,"children":5719},{"style":541},[5720],{"type":401,"value":633},{"type":395,"tag":486,"props":5722,"children":5723},{"style":567},[5724],{"type":401,"value":5725}," ##__VA_ARGS__",{"type":395,"tag":486,"props":5727,"children":5728},{"style":541},[5729],{"type":401,"value":2322},{"type":395,"tag":409,"props":5731,"children":5732},{},[5733],{"type":401,"value":5734},"尚不清楚为什么不用宏，而是使用运行时的方法调用（即 log 的 public 方法）。猜测可能是因为宏不能跨行？因为我看到了这种很长的调用。",{"type":395,"tag":475,"props":5736,"children":5738},{"code":5737,"language":478,"meta":389,"className":479,"style":389},"log::trace(\n  \"Database::PutPartValidSize()\",\n  \"[%s] size_chunk:%\" PRIu64 \" offset_chunk:%\" PRIu64,\n  key.ToString().c_str(),\n  chunk.size(),\n  offset_chunk\n);\n",[5739],{"type":395,"tag":482,"props":5740,"children":5741},{"__ignoreMap":389},[5742,5764,5785,5836,5865,5885,5893],{"type":395,"tag":486,"props":5743,"children":5744},{"class":488,"line":489},[5745,5750,5754,5759],{"type":395,"tag":486,"props":5746,"children":5747},{"style":556},[5748],{"type":401,"value":5749},"log",{"type":395,"tag":486,"props":5751,"children":5752},{"style":541},[5753],{"type":401,"value":564},{"type":395,"tag":486,"props":5755,"children":5756},{"style":535},[5757],{"type":401,"value":5758},"trace",{"type":395,"tag":486,"props":5760,"children":5761},{"style":541},[5762],{"type":401,"value":5763},"(\n",{"type":395,"tag":486,"props":5765,"children":5766},{"class":488,"line":516},[5767,5772,5777,5781],{"type":395,"tag":486,"props":5768,"children":5769},{"style":499},[5770],{"type":401,"value":5771},"  \"",{"type":395,"tag":486,"props":5773,"children":5774},{"style":505},[5775],{"type":401,"value":5776},"Database::PutPartValidSize()",{"type":395,"tag":486,"props":5778,"children":5779},{"style":499},[5780],{"type":401,"value":648},{"type":395,"tag":486,"props":5782,"children":5783},{"style":541},[5784],{"type":401,"value":4846},{"type":395,"tag":486,"props":5786,"children":5787},{"class":488,"line":525},[5788,5792,5796,5800,5805,5809,5814,5818,5823,5827,5832],{"type":395,"tag":486,"props":5789,"children":5790},{"style":499},[5791],{"type":401,"value":5771},{"type":395,"tag":486,"props":5793,"children":5794},{"style":505},[5795],{"type":401,"value":1462},{"type":395,"tag":486,"props":5797,"children":5798},{"style":765},[5799],{"type":401,"value":768},{"type":395,"tag":486,"props":5801,"children":5802},{"style":505},[5803],{"type":401,"value":5804},"] size_chunk:%",{"type":395,"tag":486,"props":5806,"children":5807},{"style":499},[5808],{"type":401,"value":648},{"type":395,"tag":486,"props":5810,"children":5811},{"style":567},[5812],{"type":401,"value":5813}," PRIu64 ",{"type":395,"tag":486,"props":5815,"children":5816},{"style":499},[5817],{"type":401,"value":648},{"type":395,"tag":486,"props":5819,"children":5820},{"style":505},[5821],{"type":401,"value":5822}," offset_chunk:%",{"type":395,"tag":486,"props":5824,"children":5825},{"style":499},[5826],{"type":401,"value":648},{"type":395,"tag":486,"props":5828,"children":5829},{"style":567},[5830],{"type":401,"value":5831}," PRIu64",{"type":395,"tag":486,"props":5833,"children":5834},{"style":541},[5835],{"type":401,"value":4846},{"type":395,"tag":486,"props":5837,"children":5838},{"class":488,"line":552},[5839,5844,5848,5852,5856,5860],{"type":395,"tag":486,"props":5840,"children":5841},{"style":567},[5842],{"type":401,"value":5843},"  key",{"type":395,"tag":486,"props":5845,"children":5846},{"style":541},[5847],{"type":401,"value":678},{"type":395,"tag":486,"props":5849,"children":5850},{"style":535},[5851],{"type":401,"value":796},{"type":395,"tag":486,"props":5853,"children":5854},{"style":541},[5855],{"type":401,"value":801},{"type":395,"tag":486,"props":5857,"children":5858},{"style":535},[5859],{"type":401,"value":806},{"type":395,"tag":486,"props":5861,"children":5862},{"style":541},[5863],{"type":401,"value":5864},"(),\n",{"type":395,"tag":486,"props":5866,"children":5867},{"class":488,"line":578},[5868,5873,5877,5881],{"type":395,"tag":486,"props":5869,"children":5870},{"style":567},[5871],{"type":401,"value":5872},"  chunk",{"type":395,"tag":486,"props":5874,"children":5875},{"style":541},[5876],{"type":401,"value":678},{"type":395,"tag":486,"props":5878,"children":5879},{"style":535},[5880],{"type":401,"value":3630},{"type":395,"tag":486,"props":5882,"children":5883},{"style":541},[5884],{"type":401,"value":5864},{"type":395,"tag":486,"props":5886,"children":5887},{"class":488,"line":599},[5888],{"type":395,"tag":486,"props":5889,"children":5890},{"style":567},[5891],{"type":401,"value":5892},"  offset_chunk\n",{"type":395,"tag":486,"props":5894,"children":5895},{"class":488,"line":656},[5896],{"type":395,"tag":486,"props":5897,"children":5898},{"style":541},[5899],{"type":401,"value":653},{"type":395,"tag":1362,"props":5901,"children":5903},{"id":5902},"日志时间",[5904],{"type":401,"value":5902},{"type":395,"tag":409,"props":5906,"children":5907},{},[5908],{"type":401,"value":5909},"使用系统输出（syslog）时不需要手动记录时间，但是把日志打印出来时却是要的。尤其是在调试时，精确时间非常有用。KDB 使用 Linux 的 timeval、tm 两个结构体，分别拿到精确时间及可读时间，再格式化输出。",{"type":395,"tag":475,"props":5911,"children":5913},{"code":5912,"language":478,"meta":389,"className":479,"style":389},"struct timeval now_tv;\ngettimeofday(&now_tv, NULL);\nconst time_t seconds = now_tv.tv_sec;\nstruct tm t;\n// 初始化 tm 时需要用到当前秒数，\n// 所以需要提前初始化 now_tv\nlocaltime_r(&seconds, &t);\np += snprintf(p, limit - p,\n              \"%04d/%02d/%02d-%02d:%02d:%02d.%06d %s %s \",\n              t.tm_year + 1900,\n              t.tm_mon + 1,\n              t.tm_mday,\n              t.tm_hour,\n              t.tm_min,\n              t.tm_sec,\n              static_cast\u003Cint>(now_tv.tv_usec), // 毫秒\n              ss.str().c_str(),\n              logname);\n",[5914],{"type":395,"tag":482,"props":5915,"children":5916},{"__ignoreMap":389},[5917,5939,5973,6011,6031,6039,6047,6085,6134,6215,6246,6274,6294,6314,6334,6354,6397,6425],{"type":395,"tag":486,"props":5918,"children":5919},{"class":488,"line":489},[5920,5925,5930,5935],{"type":395,"tag":486,"props":5921,"children":5922},{"style":529},[5923],{"type":401,"value":5924},"struct",{"type":395,"tag":486,"props":5926,"children":5927},{"style":556},[5928],{"type":401,"value":5929}," timeval",{"type":395,"tag":486,"props":5931,"children":5932},{"style":567},[5933],{"type":401,"value":5934}," now_tv",{"type":395,"tag":486,"props":5936,"children":5937},{"style":541},[5938],{"type":401,"value":575},{"type":395,"tag":486,"props":5940,"children":5941},{"class":488,"line":516},[5942,5947,5951,5955,5960,5964,5969],{"type":395,"tag":486,"props":5943,"children":5944},{"style":535},[5945],{"type":401,"value":5946},"gettimeofday",{"type":395,"tag":486,"props":5948,"children":5949},{"style":541},[5950],{"type":401,"value":623},{"type":395,"tag":486,"props":5952,"children":5953},{"style":665},[5954],{"type":401,"value":2491},{"type":395,"tag":486,"props":5956,"children":5957},{"style":567},[5958],{"type":401,"value":5959},"now_tv",{"type":395,"tag":486,"props":5961,"children":5962},{"style":541},[5963],{"type":401,"value":633},{"type":395,"tag":486,"props":5965,"children":5966},{"style":2693},[5967],{"type":401,"value":5968}," NULL",{"type":395,"tag":486,"props":5970,"children":5971},{"style":541},[5972],{"type":401,"value":653},{"type":395,"tag":486,"props":5974,"children":5975},{"class":488,"line":525},[5976,5980,5985,5990,5994,5998,6002,6007],{"type":395,"tag":486,"props":5977,"children":5978},{"style":1993},[5979],{"type":401,"value":2505},{"type":395,"tag":486,"props":5981,"children":5982},{"style":529},[5983],{"type":401,"value":5984}," time_t",{"type":395,"tag":486,"props":5986,"children":5987},{"style":567},[5988],{"type":401,"value":5989}," seconds ",{"type":395,"tag":486,"props":5991,"children":5992},{"style":665},[5993],{"type":401,"value":668},{"type":395,"tag":486,"props":5995,"children":5996},{"style":567},[5997],{"type":401,"value":5934},{"type":395,"tag":486,"props":5999,"children":6000},{"style":541},[6001],{"type":401,"value":678},{"type":395,"tag":486,"props":6003,"children":6004},{"style":567},[6005],{"type":401,"value":6006},"tv_sec",{"type":395,"tag":486,"props":6008,"children":6009},{"style":541},[6010],{"type":401,"value":575},{"type":395,"tag":486,"props":6012,"children":6013},{"class":488,"line":552},[6014,6018,6023,6027],{"type":395,"tag":486,"props":6015,"children":6016},{"style":529},[6017],{"type":401,"value":5924},{"type":395,"tag":486,"props":6019,"children":6020},{"style":556},[6021],{"type":401,"value":6022}," tm",{"type":395,"tag":486,"props":6024,"children":6025},{"style":567},[6026],{"type":401,"value":2053},{"type":395,"tag":486,"props":6028,"children":6029},{"style":541},[6030],{"type":401,"value":575},{"type":395,"tag":486,"props":6032,"children":6033},{"class":488,"line":578},[6034],{"type":395,"tag":486,"props":6035,"children":6036},{"style":1495},[6037],{"type":401,"value":6038},"// 初始化 tm 时需要用到当前秒数，\n",{"type":395,"tag":486,"props":6040,"children":6041},{"class":488,"line":599},[6042],{"type":395,"tag":486,"props":6043,"children":6044},{"style":1495},[6045],{"type":401,"value":6046},"// 所以需要提前初始化 now_tv\n",{"type":395,"tag":486,"props":6048,"children":6049},{"class":488,"line":656},[6050,6055,6059,6063,6068,6072,6076,6081],{"type":395,"tag":486,"props":6051,"children":6052},{"style":535},[6053],{"type":401,"value":6054},"localtime_r",{"type":395,"tag":486,"props":6056,"children":6057},{"style":541},[6058],{"type":401,"value":623},{"type":395,"tag":486,"props":6060,"children":6061},{"style":665},[6062],{"type":401,"value":2491},{"type":395,"tag":486,"props":6064,"children":6065},{"style":567},[6066],{"type":401,"value":6067},"seconds",{"type":395,"tag":486,"props":6069,"children":6070},{"style":541},[6071],{"type":401,"value":633},{"type":395,"tag":486,"props":6073,"children":6074},{"style":665},[6075],{"type":401,"value":1121},{"type":395,"tag":486,"props":6077,"children":6078},{"style":567},[6079],{"type":401,"value":6080},"t",{"type":395,"tag":486,"props":6082,"children":6083},{"style":541},[6084],{"type":401,"value":653},{"type":395,"tag":486,"props":6086,"children":6087},{"class":488,"line":691},[6088,6093,6098,6103,6107,6111,6115,6120,6125,6130],{"type":395,"tag":486,"props":6089,"children":6090},{"style":567},[6091],{"type":401,"value":6092},"p ",{"type":395,"tag":486,"props":6094,"children":6095},{"style":665},[6096],{"type":401,"value":6097},"+=",{"type":395,"tag":486,"props":6099,"children":6100},{"style":535},[6101],{"type":401,"value":6102}," snprintf",{"type":395,"tag":486,"props":6104,"children":6105},{"style":541},[6106],{"type":401,"value":623},{"type":395,"tag":486,"props":6108,"children":6109},{"style":567},[6110],{"type":401,"value":409},{"type":395,"tag":486,"props":6112,"children":6113},{"style":541},[6114],{"type":401,"value":633},{"type":395,"tag":486,"props":6116,"children":6117},{"style":567},[6118],{"type":401,"value":6119}," limit ",{"type":395,"tag":486,"props":6121,"children":6122},{"style":665},[6123],{"type":401,"value":6124},"-",{"type":395,"tag":486,"props":6126,"children":6127},{"style":567},[6128],{"type":401,"value":6129}," p",{"type":395,"tag":486,"props":6131,"children":6132},{"style":541},[6133],{"type":401,"value":4846},{"type":395,"tag":486,"props":6135,"children":6136},{"class":488,"line":733},[6137,6142,6147,6152,6157,6161,6165,6169,6173,6177,6181,6185,6189,6193,6198,6203,6207,6211],{"type":395,"tag":486,"props":6138,"children":6139},{"style":499},[6140],{"type":401,"value":6141},"              \"",{"type":395,"tag":486,"props":6143,"children":6144},{"style":765},[6145],{"type":401,"value":6146},"%04d",{"type":395,"tag":486,"props":6148,"children":6149},{"style":505},[6150],{"type":401,"value":6151},"/",{"type":395,"tag":486,"props":6153,"children":6154},{"style":765},[6155],{"type":401,"value":6156},"%02d",{"type":395,"tag":486,"props":6158,"children":6159},{"style":505},[6160],{"type":401,"value":6151},{"type":395,"tag":486,"props":6162,"children":6163},{"style":765},[6164],{"type":401,"value":6156},{"type":395,"tag":486,"props":6166,"children":6167},{"style":505},[6168],{"type":401,"value":6124},{"type":395,"tag":486,"props":6170,"children":6171},{"style":765},[6172],{"type":401,"value":6156},{"type":395,"tag":486,"props":6174,"children":6175},{"style":505},[6176],{"type":401,"value":1591},{"type":395,"tag":486,"props":6178,"children":6179},{"style":765},[6180],{"type":401,"value":6156},{"type":395,"tag":486,"props":6182,"children":6183},{"style":505},[6184],{"type":401,"value":1591},{"type":395,"tag":486,"props":6186,"children":6187},{"style":765},[6188],{"type":401,"value":6156},{"type":395,"tag":486,"props":6190,"children":6191},{"style":505},[6192],{"type":401,"value":678},{"type":395,"tag":486,"props":6194,"children":6195},{"style":765},[6196],{"type":401,"value":6197},"%06d",{"type":395,"tag":486,"props":6199,"children":6200},{"style":765},[6201],{"type":401,"value":6202}," %s",{"type":395,"tag":486,"props":6204,"children":6205},{"style":765},[6206],{"type":401,"value":6202},{"type":395,"tag":486,"props":6208,"children":6209},{"style":499},[6210],{"type":401,"value":638},{"type":395,"tag":486,"props":6212,"children":6213},{"style":541},[6214],{"type":401,"value":4846},{"type":395,"tag":486,"props":6216,"children":6217},{"class":488,"line":814},[6218,6223,6227,6232,6237,6242],{"type":395,"tag":486,"props":6219,"children":6220},{"style":567},[6221],{"type":401,"value":6222},"              t",{"type":395,"tag":486,"props":6224,"children":6225},{"style":541},[6226],{"type":401,"value":678},{"type":395,"tag":486,"props":6228,"children":6229},{"style":567},[6230],{"type":401,"value":6231},"tm_year ",{"type":395,"tag":486,"props":6233,"children":6234},{"style":665},[6235],{"type":401,"value":6236},"+",{"type":395,"tag":486,"props":6238,"children":6239},{"style":827},[6240],{"type":401,"value":6241}," 1900",{"type":395,"tag":486,"props":6243,"children":6244},{"style":541},[6245],{"type":401,"value":4846},{"type":395,"tag":486,"props":6247,"children":6248},{"class":488,"line":837},[6249,6253,6257,6262,6266,6270],{"type":395,"tag":486,"props":6250,"children":6251},{"style":567},[6252],{"type":401,"value":6222},{"type":395,"tag":486,"props":6254,"children":6255},{"style":541},[6256],{"type":401,"value":678},{"type":395,"tag":486,"props":6258,"children":6259},{"style":567},[6260],{"type":401,"value":6261},"tm_mon ",{"type":395,"tag":486,"props":6263,"children":6264},{"style":665},[6265],{"type":401,"value":6236},{"type":395,"tag":486,"props":6267,"children":6268},{"style":827},[6269],{"type":401,"value":3044},{"type":395,"tag":486,"props":6271,"children":6272},{"style":541},[6273],{"type":401,"value":4846},{"type":395,"tag":486,"props":6275,"children":6276},{"class":488,"line":846},[6277,6281,6285,6290],{"type":395,"tag":486,"props":6278,"children":6279},{"style":567},[6280],{"type":401,"value":6222},{"type":395,"tag":486,"props":6282,"children":6283},{"style":541},[6284],{"type":401,"value":678},{"type":395,"tag":486,"props":6286,"children":6287},{"style":567},[6288],{"type":401,"value":6289},"tm_mday",{"type":395,"tag":486,"props":6291,"children":6292},{"style":541},[6293],{"type":401,"value":4846},{"type":395,"tag":486,"props":6295,"children":6296},{"class":488,"line":854},[6297,6301,6305,6310],{"type":395,"tag":486,"props":6298,"children":6299},{"style":567},[6300],{"type":401,"value":6222},{"type":395,"tag":486,"props":6302,"children":6303},{"style":541},[6304],{"type":401,"value":678},{"type":395,"tag":486,"props":6306,"children":6307},{"style":567},[6308],{"type":401,"value":6309},"tm_hour",{"type":395,"tag":486,"props":6311,"children":6312},{"style":541},[6313],{"type":401,"value":4846},{"type":395,"tag":486,"props":6315,"children":6316},{"class":488,"line":897},[6317,6321,6325,6330],{"type":395,"tag":486,"props":6318,"children":6319},{"style":567},[6320],{"type":401,"value":6222},{"type":395,"tag":486,"props":6322,"children":6323},{"style":541},[6324],{"type":401,"value":678},{"type":395,"tag":486,"props":6326,"children":6327},{"style":567},[6328],{"type":401,"value":6329},"tm_min",{"type":395,"tag":486,"props":6331,"children":6332},{"style":541},[6333],{"type":401,"value":4846},{"type":395,"tag":486,"props":6335,"children":6336},{"class":488,"line":938},[6337,6341,6345,6350],{"type":395,"tag":486,"props":6338,"children":6339},{"style":567},[6340],{"type":401,"value":6222},{"type":395,"tag":486,"props":6342,"children":6343},{"style":541},[6344],{"type":401,"value":678},{"type":395,"tag":486,"props":6346,"children":6347},{"style":567},[6348],{"type":401,"value":6349},"tm_sec",{"type":395,"tag":486,"props":6351,"children":6352},{"style":541},[6353],{"type":401,"value":4846},{"type":395,"tag":486,"props":6355,"children":6356},{"class":488,"line":946},[6357,6362,6366,6370,6374,6378,6382,6387,6392],{"type":395,"tag":486,"props":6358,"children":6359},{"style":665},[6360],{"type":401,"value":6361},"              static_cast\u003C",{"type":395,"tag":486,"props":6363,"children":6364},{"style":529},[6365],{"type":401,"value":532},{"type":395,"tag":486,"props":6367,"children":6368},{"style":665},[6369],{"type":401,"value":2473},{"type":395,"tag":486,"props":6371,"children":6372},{"style":541},[6373],{"type":401,"value":623},{"type":395,"tag":486,"props":6375,"children":6376},{"style":567},[6377],{"type":401,"value":5959},{"type":395,"tag":486,"props":6379,"children":6380},{"style":541},[6381],{"type":401,"value":678},{"type":395,"tag":486,"props":6383,"children":6384},{"style":567},[6385],{"type":401,"value":6386},"tv_usec",{"type":395,"tag":486,"props":6388,"children":6389},{"style":541},[6390],{"type":401,"value":6391},"),",{"type":395,"tag":486,"props":6393,"children":6394},{"style":1495},[6395],{"type":401,"value":6396}," // 毫秒\n",{"type":395,"tag":486,"props":6398,"children":6399},{"class":488,"line":967},[6400,6405,6409,6413,6417,6421],{"type":395,"tag":486,"props":6401,"children":6402},{"style":567},[6403],{"type":401,"value":6404},"              ss",{"type":395,"tag":486,"props":6406,"children":6407},{"style":541},[6408],{"type":401,"value":678},{"type":395,"tag":486,"props":6410,"children":6411},{"style":535},[6412],{"type":401,"value":3065},{"type":395,"tag":486,"props":6414,"children":6415},{"style":541},[6416],{"type":401,"value":801},{"type":395,"tag":486,"props":6418,"children":6419},{"style":535},[6420],{"type":401,"value":806},{"type":395,"tag":486,"props":6422,"children":6423},{"style":541},[6424],{"type":401,"value":5864},{"type":395,"tag":486,"props":6426,"children":6427},{"class":488,"line":1023},[6428,6433],{"type":395,"tag":486,"props":6429,"children":6430},{"style":567},[6431],{"type":401,"value":6432},"              logname",{"type":395,"tag":486,"props":6434,"children":6435},{"style":541},[6436],{"type":401,"value":653},{"type":395,"tag":6438,"props":6439,"children":6440},"style",{},[6441],{"type":401,"value":6442},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":389,"searchDepth":516,"depth":516,"links":6444},[6445,6446,6447,6448],{"id":405,"depth":516,"text":405},{"id":466,"depth":516,"text":466},{"id":3448,"depth":516,"text":3448},{"id":3461,"depth":516,"text":3461},"markdown","content:8.source-code:_cpp:kingdb.md","content","8.source-code/_cpp/kingdb.md","8.source-code/_cpp/kingdb","md",[6456,6457],{"_path":377,"title":376,"description":389},{"_path":6458,"title":6459,"description":389},"/source-code/_es/array-slice","Array.prototype.slice",1742039251108]