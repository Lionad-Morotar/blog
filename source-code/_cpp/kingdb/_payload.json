[{"data":1,"prerenderedAt":6464},["ShallowReactive",2],{"navigation":3,"/source-code/_cpp/kingdb":389,"/source-code/_cpp/kingdb-surround":6459},[4,32,83,99,126,132,138,372,378,384],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🌃 长夜梦","/flows/long-night-dream",{"title":15,"_path":16},"🌌 万物联结与幸福感","/flows/everything",{"title":18,"_path":19},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":21,"_path":22},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":24,"_path":25},"🌧️ 我的腼腆","/flows/shy",{"title":27,"_path":28},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":30,"_path":31},"📝 心流归档","/flows/fold",{"title":33,"_path":34,"children":35},"技术博客 / Coder","/articles",[36,38,41,44,47,50,53,56,59,62,65,68,71,74,77,80],{"title":37,"_path":34},"🦁 为什么我要写博客",{"title":39,"_path":40},"💻 本地部署 Qwen 翻译网页","/articles/local-translator",{"title":42,"_path":43},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":45,"_path":46},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":48,"_path":49},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":51,"_path":52},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":54,"_path":55},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":57,"_path":58},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":60,"_path":61},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":63,"_path":64},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":66,"_path":67},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":69,"_path":70},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":72,"_path":73},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":75,"_path":76},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":78,"_path":79},"🚝 四十二篇系列","/articles/fourty-two",{"title":81,"_path":82},"📝 技术博客归档","/articles/fold",{"title":84,"_path":85,"children":86},"造物 / Make","/tools",[87,90,93,96],{"title":88,"_path":89},"🌐 AnySort","/tools/anysort",{"title":91,"_path":92},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":94,"_path":95},"👓 Crapto","/tools/crypto-inline",{"title":97,"_path":98},"🖨️ any-to-base64","/tools/any-to-base64",{"title":100,"_path":101,"children":102},"吉他剧场 / Music","/music",[103,105,108,111,114,117,120,123],{"title":104,"_path":101},"🎸 FingerStyle！",{"title":106,"_path":107},"🌬️ 等待的风","/music/wind",{"title":109,"_path":110},"💕 约定的海洋","/music/ocean",{"title":112,"_path":113},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":115,"_path":116},"🌏 残酷天使的行动纲领","/music/eva",{"title":118,"_path":119},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":121,"_path":122},"🍷 Wu Wei","/music/wu-wei",{"title":124,"_path":125},"🌅 无题","/music/untitled",{"title":127,"_path":128,"children":129},"画点什么 / Paint","/paint",[130],{"title":131,"_path":128},"🚧 正在施工",{"title":133,"_path":134,"children":135},"知识地图 / Maps","/maps",[136],{"title":137,"_path":134},"🏁 知识地图",{"title":139,"_path":140,"children":141},"零散的笔记 / Gists","/gists",[142,144,147,150,153,156,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255,258,261,264,267,270,273,276,279,282,285,288,291,294,297,300,303,306,309,312,315,318,321,324,327,330,333,336,339,342,345,348,351,354,357,360,363,366,369],{"title":143,"_path":140},"🧊 Gists",{"title":145,"_path":146},"网站的可访问性","/gists/accessibility",{"title":148,"_path":149},"Bit","/gists/bit",{"title":151,"_path":152},"图片模糊","/gists/blur",{"title":154,"_path":155},"渲染相关笔记","/gists/c4d",{"title":157,"_path":158},"CDN 问题记录","/gists/cdn",{"title":160,"_path":161},"消毒剂","/gists/cleaner",{"title":163,"_path":164},"Windows Command","/gists/cmd",{"title":166,"_path":167},"Command","/gists/command",{"title":169,"_path":170},"复杂科学","/gists/complexity-science",{"title":172,"_path":173},"宇宙","/gists/cosmos",{"title":175,"_path":176},"C++","/gists/cpp",{"title":178,"_path":179},"Data Structure","/gists/data-structure",{"title":181,"_path":182},"DEPRESSION","/gists/depression",{"title":184,"_path":185},"设计模式","/gists/design-patterns",{"title":187,"_path":188},"Developer Experience","/gists/developer-experience",{"title":190,"_path":191},"Device Metrics","/gists/device-metrix",{"title":193,"_path":194},"ECMAScript Language Specification","/gists/ecmascript-specification",{"title":196,"_path":197},"正则表达式","/gists/eegex",{"title":199,"_path":200},"Emoji","/gists/emoji",{"title":202,"_path":203},"工程","/gists/engineering",{"title":205,"_path":206},"熵","/gists/entropy",{"title":208,"_path":209},"Environment","/gists/environment",{"title":211,"_path":212},"Erlang","/gists/erlang",{"title":214,"_path":215},"逃离塔克夫","/gists/escape-from-tarkov",{"title":217,"_path":218},"ESNext (ES6-ES11)","/gists/esnext",{"title":220,"_path":221},"Eval！","/gists/eval",{"title":223,"_path":224},"Flutter","/gists/flutter",{"title":226,"_path":227},"字体","/gists/font",{"title":229,"_path":230},"JS 函数式编程","/gists/functional",{"title":232,"_path":233},"Google C++ Standard","/gists/google-cpp-standard",{"title":235,"_path":236},"双向链接完全体","/gists/graph",{"title":238,"_path":239},"Hardwares","/gists/hardwares",{"title":241,"_path":242},"哈希冲突","/gists/hash-collision",{"title":244,"_path":245},"信息设计","/gists/information-design",{"title":247,"_path":248},"InstantPage","/gists/instant.page",{"title":250,"_path":251},"ISUX 遇见大数据可视化系列","/gists/isux-data-visualization",{"title":253,"_path":254},"KVStore","/gists/key-value-db",{"title":256,"_path":257},"Kubernetes","/gists/kubernetes",{"title":259,"_path":260},"Makefile","/gists/makefile",{"title":262,"_path":263},"Markdown Inline Style","/gists/markdown-nice",{"title":265,"_path":266},"小程序","/gists/miniapp",{"title":268,"_path":269},"减小页面快照体积","/gists/minify-html",{"title":271,"_path":272},"mklink","/gists/mklink",{"title":274,"_path":275},"Mock","/gists/mock",{"title":277,"_path":278},"多端应用","/gists/multy-end-app",{"title":280,"_path":281},"神经科学","/gists/neuroscience",{"title":283,"_path":284},"OO","/gists/oo",{"title":286,"_path":287},"Opinioned Personal Folder","/gists/opinioned-personal-folder",{"title":289,"_path":290},"人物","/gists/person",{"title":292,"_path":293},"PInvoke","/gists/pinvoke",{"title":295,"_path":296},"像素","/gists/pixel",{"title":298,"_path":299},"PowerShell","/gists/powershell",{"title":301,"_path":302},"量子","/gists/quantum",{"title":304,"_path":305},"保持好奇心","/gists/questions",{"title":307,"_path":308},"React Native","/gists/react-native",{"title":310,"_path":311},"博客改版碰到的浏览器平滑滚动问题","/gists/scroll",{"title":313,"_path":314},"SEO","/gists/seo",{"title":316,"_path":317},"Shader","/gists/shader",{"title":319,"_path":320},"Shape Up","/gists/shape-up",{"title":322,"_path":323},"睡觉","/gists/sleep",{"title":325,"_path":326},"States","/gists/states",{"title":328,"_path":329},"Storage","/gists/storage",{"title":331,"_path":332},"音视频流处理","/gists/stream-cli",{"title":334,"_path":335},"Symbol","/gists/symbol",{"title":337,"_path":338},"系统论","/gists/systems-theory",{"title":340,"_path":341},"Taro","/gists/taro",{"title":343,"_path":344},"任务切片","/gists/task-slice",{"title":346,"_path":347},"技术偏好","/gists/tech-dudge",{"title":349,"_path":350},"Untitled","/gists/untitled",{"title":352,"_path":353},"可变字体","/gists/variable-font",{"title":355,"_path":356},"视觉错觉","/gists/visual-illusion",{"title":358,"_path":359},"SS(SSR)","/gists/vpn",{"title":361,"_path":362},"VS Code 插件开发","/gists/vscode-plugin",{"title":364,"_path":365},"Web Components","/gists/web-components",{"title":367,"_path":368},"Windows","/gists/windows",{"title":370,"_path":371},"查缺补漏","/gists/wrong",{"title":373,"_path":374,"children":375},"代码笔记 / Gists","/source-code",[376],{"title":377,"_path":374},"🚄 代码笔记",{"title":379,"_path":380,"children":381},"我 / Abount","/hire",[382],{"title":383,"_path":380},"📬 技术简历",{"title":385,"_path":386,"children":387},"todo","/todo",[388],{"title":385,"_path":386},{"_path":390,"_dir":391,"_draft":392,"_partial":393,"_locale":394,"title":395,"description":394,"body":396,"_type":6454,"_id":6455,"_source":6456,"_file":6457,"_extension":6458},"/source-code/_cpp/kingdb","_cpp",false,true,"","KingDB",{"type":397,"children":398,"toc":6448},"root",[399,407,413,419,435,440,464,469,474,479,1338,1343,1351,1356,1361,1366,1372,1377,1798,1803,1808,2258,2263,2364,2369,2374,2379,2917,2923,2928,3195,3201,3206,3451,3456,3469,3474,3741,3746,3751,4462,4467,4648,4652,4657,5275,5280,5285,5338,5343,5362,5735,5740,5905,5910,5915,6442],{"type":400,"tag":401,"props":402,"children":404},"element","h1",{"id":403},"kingdb",[405],{"type":406,"value":395},"text",{"type":400,"tag":408,"props":409,"children":411},"h2",{"id":410},"概述",[412],{"type":406,"value":410},{"type":400,"tag":414,"props":415,"children":416},"p",{},[417],{"type":406,"value":418},"源码分两部分，从相关的测试文件，到核心源码。参考 IKVS 系列文章给的架构图，核心源码的阅读顺序沿着 Put、Delete、Get 三个接口，由 Database 一路向 Buffer、Event Manager、Storage Engine、HSTable Manager、File System 相关、Index 前进。最好再看相关快照、迭代器、Multipart 等部分。期间如果遇到简单的帮助函数会先讲帮助函数。",{"type":400,"tag":414,"props":420,"children":421},{},[422,424,433],{"type":406,"value":423},"本来想从第一个 Git Commit 开始看起的。但我 checkout 过去之后，碰到了一堆编译问题，根本跑不通，索性就直接回到 master 来看最新代码了。本文章的源码快照见 ",{"type":400,"tag":425,"props":426,"children":430},"a",{"href":427,"rel":428},"https://github.com/goossaert/kingdb/tree/58994280e789fc7248d61371f03a6c04c844c197",[429],"nofollow",[431],{"type":406,"value":432},"KingDB@58994",{"type":406,"value":434},"。阅读源码前可以先看一下 KingDB 的 Readme：doc/kingdb.md 以及 doc/kingserver.md。",{"type":400,"tag":414,"props":436,"children":437},{},[438],{"type":406,"value":439},"下文可能出现的缩写：",{"type":400,"tag":441,"props":442,"children":443},"ul",{},[444,450],{"type":400,"tag":445,"props":446,"children":447},"li",{},[448],{"type":406,"value":449},"KDB：KingDB，泛指，有时指 KingDB 程序，有时指 KingDB 源码。",{"type":400,"tag":445,"props":451,"children":452},{},[453,455,462],{"type":406,"value":454},"IKVS：作者相关 KingDB 做的一些调研及笔记的博客系列。这个系列从 13 年开始写，现在还没写完... 见 ",{"type":400,"tag":425,"props":456,"children":459},{"href":457,"rel":458},"https://codecapsule.com/2012/11/07/ikvs-implementing-a-key-value-store-table-of-contents/",[429],[460],{"type":406,"value":461},"IKVS",{"type":406,"value":463},"。",{"type":400,"tag":414,"props":465,"children":466},{},[467],{"type":406,"value":468},"另，为了简便起见，下文给出的代码很可能并非原本的代码，而是截取或经过剔除后的部分代码。比如说，去除了某函数中的错误处理，使之代码更短，更容易展示。",{"type":400,"tag":408,"props":470,"children":472},{"id":471},"从测试开始",[473],{"type":406,"value":471},{"type":400,"tag":414,"props":475,"children":476},{},[477],{"type":406,"value":478},"Emmanuel 给了一个典型的 KDB 用户使用示例，见 unit-tests/kingdb_user.cc。通过此示例，能大概了解 KDB 的接口及如何使用该接口。创建数据库、存入、读取前都需要创建对应的参数配置 Options；这些动作通过 Status 对象来回传操作成功与否。",{"type":400,"tag":480,"props":481,"children":485},"pre",{"code":482,"language":483,"meta":394,"className":484,"style":394},"#include \u003Ckingdb/kdb.h>\n\nint main() {\n  kdb::Status s;\n  kdb::DatabaseOptions db_options;\n  kdb::Database db(db_options, \"mylocaldb\");\n  s = db.Open();\n  if (!s.IsOK()) {\n    fprintf(stderr, \"Could not open the database: %s\\n\", s.ToString().c_str());\n    exit(1);\n  }\n\n  std::string key1(\"key1\");\n  std::string value1(\"value1\");\n\n  kdb::WriteOptions write_options;\n  s = db.Put(write_options, key1, value1);\n\n  kdb::ReadOptions read_options;\n  std::string out_str;\n  s = db.Get(read_options, key1, &out_str);\n  if (s.IsOK() && out_str == \"value1\") {\n    printf(\"Data successfully stored and retrieved\\n\"); \n  } else {\n    printf(\"An error occurred\\n\"); \n  }\n\n  return 0;\n}\n","cpp","language-cpp shiki shiki-themes material-theme-lighter github-light github-dark monokai",[486],{"type":400,"tag":487,"props":488,"children":489},"code",{"__ignoreMap":394},[490,519,528,555,581,602,659,694,736,817,840,849,857,900,941,949,970,1026,1034,1055,1076,1136,1200,1240,1258,1295,1303,1311,1329],{"type":400,"tag":491,"props":492,"children":495},"span",{"class":493,"line":494},"line",1,[496,502,508,514],{"type":400,"tag":491,"props":497,"children":499},{"style":498},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:inherit",[500],{"type":406,"value":501},"#include",{"type":400,"tag":491,"props":503,"children":505},{"style":504},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[506],{"type":406,"value":507}," \u003C",{"type":400,"tag":491,"props":509,"children":511},{"style":510},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[512],{"type":406,"value":513},"kingdb/kdb.h",{"type":400,"tag":491,"props":515,"children":516},{"style":504},[517],{"type":406,"value":518},">\n",{"type":400,"tag":491,"props":520,"children":522},{"class":493,"line":521},2,[523],{"type":400,"tag":491,"props":524,"children":525},{"emptyLinePlaceholder":393},[526],{"type":406,"value":527},"\n",{"type":400,"tag":491,"props":529,"children":531},{"class":493,"line":530},3,[532,538,544,550],{"type":400,"tag":491,"props":533,"children":535},{"style":534},"--shiki-light:#9C3EDA;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#66D9EF;--shiki-light-font-style:inherit;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[536],{"type":406,"value":537},"int",{"type":400,"tag":491,"props":539,"children":541},{"style":540},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[542],{"type":406,"value":543}," main",{"type":400,"tag":491,"props":545,"children":547},{"style":546},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[548],{"type":406,"value":549},"()",{"type":400,"tag":491,"props":551,"children":552},{"style":546},[553],{"type":406,"value":554}," {\n",{"type":400,"tag":491,"props":556,"children":558},{"class":493,"line":557},4,[559,565,570,576],{"type":400,"tag":491,"props":560,"children":562},{"style":561},"--shiki-light:#E2931D;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E;--shiki-light-text-decoration:inherit;--shiki-default-text-decoration:inherit;--shiki-dark-text-decoration:inherit;--shiki-sepia-text-decoration:underline",[563],{"type":406,"value":564},"  kdb",{"type":400,"tag":491,"props":566,"children":567},{"style":546},[568],{"type":406,"value":569},"::",{"type":400,"tag":491,"props":571,"children":573},{"style":572},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[574],{"type":406,"value":575},"Status s",{"type":400,"tag":491,"props":577,"children":578},{"style":546},[579],{"type":406,"value":580},";\n",{"type":400,"tag":491,"props":582,"children":584},{"class":493,"line":583},5,[585,589,593,598],{"type":400,"tag":491,"props":586,"children":587},{"style":561},[588],{"type":406,"value":564},{"type":400,"tag":491,"props":590,"children":591},{"style":546},[592],{"type":406,"value":569},{"type":400,"tag":491,"props":594,"children":595},{"style":572},[596],{"type":406,"value":597},"DatabaseOptions db_options",{"type":400,"tag":491,"props":599,"children":600},{"style":546},[601],{"type":406,"value":580},{"type":400,"tag":491,"props":603,"children":605},{"class":493,"line":604},6,[606,610,614,619,624,629,634,639,644,649,654],{"type":400,"tag":491,"props":607,"children":608},{"style":561},[609],{"type":406,"value":564},{"type":400,"tag":491,"props":611,"children":612},{"style":546},[613],{"type":406,"value":569},{"type":400,"tag":491,"props":615,"children":616},{"style":572},[617],{"type":406,"value":618},"Database ",{"type":400,"tag":491,"props":620,"children":621},{"style":540},[622],{"type":406,"value":623},"db",{"type":400,"tag":491,"props":625,"children":626},{"style":546},[627],{"type":406,"value":628},"(",{"type":400,"tag":491,"props":630,"children":631},{"style":572},[632],{"type":406,"value":633},"db_options",{"type":400,"tag":491,"props":635,"children":636},{"style":546},[637],{"type":406,"value":638},",",{"type":400,"tag":491,"props":640,"children":641},{"style":504},[642],{"type":406,"value":643}," \"",{"type":400,"tag":491,"props":645,"children":646},{"style":510},[647],{"type":406,"value":648},"mylocaldb",{"type":400,"tag":491,"props":650,"children":651},{"style":504},[652],{"type":406,"value":653},"\"",{"type":400,"tag":491,"props":655,"children":656},{"style":546},[657],{"type":406,"value":658},");\n",{"type":400,"tag":491,"props":660,"children":662},{"class":493,"line":661},7,[663,668,674,679,684,689],{"type":400,"tag":491,"props":664,"children":665},{"style":572},[666],{"type":406,"value":667},"  s ",{"type":400,"tag":491,"props":669,"children":671},{"style":670},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[672],{"type":406,"value":673},"=",{"type":400,"tag":491,"props":675,"children":676},{"style":572},[677],{"type":406,"value":678}," db",{"type":400,"tag":491,"props":680,"children":681},{"style":546},[682],{"type":406,"value":683},".",{"type":400,"tag":491,"props":685,"children":686},{"style":540},[687],{"type":406,"value":688},"Open",{"type":400,"tag":491,"props":690,"children":691},{"style":546},[692],{"type":406,"value":693},"();\n",{"type":400,"tag":491,"props":695,"children":697},{"class":493,"line":696},8,[698,703,708,713,718,722,727,732],{"type":400,"tag":491,"props":699,"children":700},{"style":498},[701],{"type":406,"value":702},"  if",{"type":400,"tag":491,"props":704,"children":705},{"style":546},[706],{"type":406,"value":707}," (",{"type":400,"tag":491,"props":709,"children":710},{"style":670},[711],{"type":406,"value":712},"!",{"type":400,"tag":491,"props":714,"children":715},{"style":572},[716],{"type":406,"value":717},"s",{"type":400,"tag":491,"props":719,"children":720},{"style":546},[721],{"type":406,"value":683},{"type":400,"tag":491,"props":723,"children":724},{"style":540},[725],{"type":406,"value":726},"IsOK",{"type":400,"tag":491,"props":728,"children":729},{"style":546},[730],{"type":406,"value":731},"())",{"type":400,"tag":491,"props":733,"children":734},{"style":546},[735],{"type":406,"value":554},{"type":400,"tag":491,"props":737,"children":739},{"class":493,"line":738},9,[740,745,749,755,759,763,768,774,780,784,788,793,797,802,807,812],{"type":400,"tag":491,"props":741,"children":742},{"style":540},[743],{"type":406,"value":744},"    fprintf",{"type":400,"tag":491,"props":746,"children":747},{"style":546},[748],{"type":406,"value":628},{"type":400,"tag":491,"props":750,"children":752},{"style":751},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[753],{"type":406,"value":754},"stderr",{"type":400,"tag":491,"props":756,"children":757},{"style":546},[758],{"type":406,"value":638},{"type":400,"tag":491,"props":760,"children":761},{"style":504},[762],{"type":406,"value":643},{"type":400,"tag":491,"props":764,"children":765},{"style":510},[766],{"type":406,"value":767},"Could not open the database: ",{"type":400,"tag":491,"props":769,"children":771},{"style":770},"--shiki-light:#E53935;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[772],{"type":406,"value":773},"%s",{"type":400,"tag":491,"props":775,"children":777},{"style":776},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[778],{"type":406,"value":779},"\\n",{"type":400,"tag":491,"props":781,"children":782},{"style":504},[783],{"type":406,"value":653},{"type":400,"tag":491,"props":785,"children":786},{"style":546},[787],{"type":406,"value":638},{"type":400,"tag":491,"props":789,"children":790},{"style":572},[791],{"type":406,"value":792}," s",{"type":400,"tag":491,"props":794,"children":795},{"style":546},[796],{"type":406,"value":683},{"type":400,"tag":491,"props":798,"children":799},{"style":540},[800],{"type":406,"value":801},"ToString",{"type":400,"tag":491,"props":803,"children":804},{"style":546},[805],{"type":406,"value":806},"().",{"type":400,"tag":491,"props":808,"children":809},{"style":540},[810],{"type":406,"value":811},"c_str",{"type":400,"tag":491,"props":813,"children":814},{"style":546},[815],{"type":406,"value":816},"());\n",{"type":400,"tag":491,"props":818,"children":820},{"class":493,"line":819},10,[821,826,830,836],{"type":400,"tag":491,"props":822,"children":823},{"style":540},[824],{"type":406,"value":825},"    exit",{"type":400,"tag":491,"props":827,"children":828},{"style":546},[829],{"type":406,"value":628},{"type":400,"tag":491,"props":831,"children":833},{"style":832},"--shiki-light:#F76D47;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[834],{"type":406,"value":835},"1",{"type":400,"tag":491,"props":837,"children":838},{"style":546},[839],{"type":406,"value":658},{"type":400,"tag":491,"props":841,"children":843},{"class":493,"line":842},11,[844],{"type":400,"tag":491,"props":845,"children":846},{"style":546},[847],{"type":406,"value":848},"  }\n",{"type":400,"tag":491,"props":850,"children":852},{"class":493,"line":851},12,[853],{"type":400,"tag":491,"props":854,"children":855},{"emptyLinePlaceholder":393},[856],{"type":406,"value":527},{"type":400,"tag":491,"props":858,"children":860},{"class":493,"line":859},13,[861,866,870,875,880,884,888,892,896],{"type":400,"tag":491,"props":862,"children":863},{"style":561},[864],{"type":406,"value":865},"  std",{"type":400,"tag":491,"props":867,"children":868},{"style":546},[869],{"type":406,"value":569},{"type":400,"tag":491,"props":871,"children":872},{"style":572},[873],{"type":406,"value":874},"string ",{"type":400,"tag":491,"props":876,"children":877},{"style":540},[878],{"type":406,"value":879},"key1",{"type":400,"tag":491,"props":881,"children":882},{"style":546},[883],{"type":406,"value":628},{"type":400,"tag":491,"props":885,"children":886},{"style":504},[887],{"type":406,"value":653},{"type":400,"tag":491,"props":889,"children":890},{"style":510},[891],{"type":406,"value":879},{"type":400,"tag":491,"props":893,"children":894},{"style":504},[895],{"type":406,"value":653},{"type":400,"tag":491,"props":897,"children":898},{"style":546},[899],{"type":406,"value":658},{"type":400,"tag":491,"props":901,"children":903},{"class":493,"line":902},14,[904,908,912,916,921,925,929,933,937],{"type":400,"tag":491,"props":905,"children":906},{"style":561},[907],{"type":406,"value":865},{"type":400,"tag":491,"props":909,"children":910},{"style":546},[911],{"type":406,"value":569},{"type":400,"tag":491,"props":913,"children":914},{"style":572},[915],{"type":406,"value":874},{"type":400,"tag":491,"props":917,"children":918},{"style":540},[919],{"type":406,"value":920},"value1",{"type":400,"tag":491,"props":922,"children":923},{"style":546},[924],{"type":406,"value":628},{"type":400,"tag":491,"props":926,"children":927},{"style":504},[928],{"type":406,"value":653},{"type":400,"tag":491,"props":930,"children":931},{"style":510},[932],{"type":406,"value":920},{"type":400,"tag":491,"props":934,"children":935},{"style":504},[936],{"type":406,"value":653},{"type":400,"tag":491,"props":938,"children":939},{"style":546},[940],{"type":406,"value":658},{"type":400,"tag":491,"props":942,"children":944},{"class":493,"line":943},15,[945],{"type":400,"tag":491,"props":946,"children":947},{"emptyLinePlaceholder":393},[948],{"type":406,"value":527},{"type":400,"tag":491,"props":950,"children":952},{"class":493,"line":951},16,[953,957,961,966],{"type":400,"tag":491,"props":954,"children":955},{"style":561},[956],{"type":406,"value":564},{"type":400,"tag":491,"props":958,"children":959},{"style":546},[960],{"type":406,"value":569},{"type":400,"tag":491,"props":962,"children":963},{"style":572},[964],{"type":406,"value":965},"WriteOptions write_options",{"type":400,"tag":491,"props":967,"children":968},{"style":546},[969],{"type":406,"value":580},{"type":400,"tag":491,"props":971,"children":973},{"class":493,"line":972},17,[974,978,982,986,990,995,999,1004,1008,1013,1017,1022],{"type":400,"tag":491,"props":975,"children":976},{"style":572},[977],{"type":406,"value":667},{"type":400,"tag":491,"props":979,"children":980},{"style":670},[981],{"type":406,"value":673},{"type":400,"tag":491,"props":983,"children":984},{"style":572},[985],{"type":406,"value":678},{"type":400,"tag":491,"props":987,"children":988},{"style":546},[989],{"type":406,"value":683},{"type":400,"tag":491,"props":991,"children":992},{"style":540},[993],{"type":406,"value":994},"Put",{"type":400,"tag":491,"props":996,"children":997},{"style":546},[998],{"type":406,"value":628},{"type":400,"tag":491,"props":1000,"children":1001},{"style":572},[1002],{"type":406,"value":1003},"write_options",{"type":400,"tag":491,"props":1005,"children":1006},{"style":546},[1007],{"type":406,"value":638},{"type":400,"tag":491,"props":1009,"children":1010},{"style":572},[1011],{"type":406,"value":1012}," key1",{"type":400,"tag":491,"props":1014,"children":1015},{"style":546},[1016],{"type":406,"value":638},{"type":400,"tag":491,"props":1018,"children":1019},{"style":572},[1020],{"type":406,"value":1021}," value1",{"type":400,"tag":491,"props":1023,"children":1024},{"style":546},[1025],{"type":406,"value":658},{"type":400,"tag":491,"props":1027,"children":1029},{"class":493,"line":1028},18,[1030],{"type":400,"tag":491,"props":1031,"children":1032},{"emptyLinePlaceholder":393},[1033],{"type":406,"value":527},{"type":400,"tag":491,"props":1035,"children":1037},{"class":493,"line":1036},19,[1038,1042,1046,1051],{"type":400,"tag":491,"props":1039,"children":1040},{"style":561},[1041],{"type":406,"value":564},{"type":400,"tag":491,"props":1043,"children":1044},{"style":546},[1045],{"type":406,"value":569},{"type":400,"tag":491,"props":1047,"children":1048},{"style":572},[1049],{"type":406,"value":1050},"ReadOptions read_options",{"type":400,"tag":491,"props":1052,"children":1053},{"style":546},[1054],{"type":406,"value":580},{"type":400,"tag":491,"props":1056,"children":1058},{"class":493,"line":1057},20,[1059,1063,1067,1072],{"type":400,"tag":491,"props":1060,"children":1061},{"style":561},[1062],{"type":406,"value":865},{"type":400,"tag":491,"props":1064,"children":1065},{"style":546},[1066],{"type":406,"value":569},{"type":400,"tag":491,"props":1068,"children":1069},{"style":572},[1070],{"type":406,"value":1071},"string out_str",{"type":400,"tag":491,"props":1073,"children":1074},{"style":546},[1075],{"type":406,"value":580},{"type":400,"tag":491,"props":1077,"children":1079},{"class":493,"line":1078},21,[1080,1084,1088,1092,1096,1101,1105,1110,1114,1118,1122,1127,1132],{"type":400,"tag":491,"props":1081,"children":1082},{"style":572},[1083],{"type":406,"value":667},{"type":400,"tag":491,"props":1085,"children":1086},{"style":670},[1087],{"type":406,"value":673},{"type":400,"tag":491,"props":1089,"children":1090},{"style":572},[1091],{"type":406,"value":678},{"type":400,"tag":491,"props":1093,"children":1094},{"style":546},[1095],{"type":406,"value":683},{"type":400,"tag":491,"props":1097,"children":1098},{"style":540},[1099],{"type":406,"value":1100},"Get",{"type":400,"tag":491,"props":1102,"children":1103},{"style":546},[1104],{"type":406,"value":628},{"type":400,"tag":491,"props":1106,"children":1107},{"style":572},[1108],{"type":406,"value":1109},"read_options",{"type":400,"tag":491,"props":1111,"children":1112},{"style":546},[1113],{"type":406,"value":638},{"type":400,"tag":491,"props":1115,"children":1116},{"style":572},[1117],{"type":406,"value":1012},{"type":400,"tag":491,"props":1119,"children":1120},{"style":546},[1121],{"type":406,"value":638},{"type":400,"tag":491,"props":1123,"children":1124},{"style":670},[1125],{"type":406,"value":1126}," &",{"type":400,"tag":491,"props":1128,"children":1129},{"style":572},[1130],{"type":406,"value":1131},"out_str",{"type":400,"tag":491,"props":1133,"children":1134},{"style":546},[1135],{"type":406,"value":658},{"type":400,"tag":491,"props":1137,"children":1139},{"class":493,"line":1138},22,[1140,1144,1148,1152,1156,1160,1164,1169,1174,1179,1183,1187,1191,1196],{"type":400,"tag":491,"props":1141,"children":1142},{"style":498},[1143],{"type":406,"value":702},{"type":400,"tag":491,"props":1145,"children":1146},{"style":546},[1147],{"type":406,"value":707},{"type":400,"tag":491,"props":1149,"children":1150},{"style":572},[1151],{"type":406,"value":717},{"type":400,"tag":491,"props":1153,"children":1154},{"style":546},[1155],{"type":406,"value":683},{"type":400,"tag":491,"props":1157,"children":1158},{"style":540},[1159],{"type":406,"value":726},{"type":400,"tag":491,"props":1161,"children":1162},{"style":546},[1163],{"type":406,"value":549},{"type":400,"tag":491,"props":1165,"children":1166},{"style":670},[1167],{"type":406,"value":1168}," &&",{"type":400,"tag":491,"props":1170,"children":1171},{"style":572},[1172],{"type":406,"value":1173}," out_str ",{"type":400,"tag":491,"props":1175,"children":1176},{"style":670},[1177],{"type":406,"value":1178},"==",{"type":400,"tag":491,"props":1180,"children":1181},{"style":504},[1182],{"type":406,"value":643},{"type":400,"tag":491,"props":1184,"children":1185},{"style":510},[1186],{"type":406,"value":920},{"type":400,"tag":491,"props":1188,"children":1189},{"style":504},[1190],{"type":406,"value":653},{"type":400,"tag":491,"props":1192,"children":1193},{"style":546},[1194],{"type":406,"value":1195},")",{"type":400,"tag":491,"props":1197,"children":1198},{"style":546},[1199],{"type":406,"value":554},{"type":400,"tag":491,"props":1201,"children":1203},{"class":493,"line":1202},23,[1204,1209,1213,1217,1222,1226,1230,1235],{"type":400,"tag":491,"props":1205,"children":1206},{"style":540},[1207],{"type":406,"value":1208},"    printf",{"type":400,"tag":491,"props":1210,"children":1211},{"style":546},[1212],{"type":406,"value":628},{"type":400,"tag":491,"props":1214,"children":1215},{"style":504},[1216],{"type":406,"value":653},{"type":400,"tag":491,"props":1218,"children":1219},{"style":510},[1220],{"type":406,"value":1221},"Data successfully stored and retrieved",{"type":400,"tag":491,"props":1223,"children":1224},{"style":776},[1225],{"type":406,"value":779},{"type":400,"tag":491,"props":1227,"children":1228},{"style":504},[1229],{"type":406,"value":653},{"type":400,"tag":491,"props":1231,"children":1232},{"style":546},[1233],{"type":406,"value":1234},");",{"type":400,"tag":491,"props":1236,"children":1237},{"style":751},[1238],{"type":406,"value":1239}," \n",{"type":400,"tag":491,"props":1241,"children":1243},{"class":493,"line":1242},24,[1244,1249,1254],{"type":400,"tag":491,"props":1245,"children":1246},{"style":546},[1247],{"type":406,"value":1248},"  }",{"type":400,"tag":491,"props":1250,"children":1251},{"style":498},[1252],{"type":406,"value":1253}," else",{"type":400,"tag":491,"props":1255,"children":1256},{"style":546},[1257],{"type":406,"value":554},{"type":400,"tag":491,"props":1259,"children":1261},{"class":493,"line":1260},25,[1262,1266,1270,1274,1279,1283,1287,1291],{"type":400,"tag":491,"props":1263,"children":1264},{"style":540},[1265],{"type":406,"value":1208},{"type":400,"tag":491,"props":1267,"children":1268},{"style":546},[1269],{"type":406,"value":628},{"type":400,"tag":491,"props":1271,"children":1272},{"style":504},[1273],{"type":406,"value":653},{"type":400,"tag":491,"props":1275,"children":1276},{"style":510},[1277],{"type":406,"value":1278},"An error occurred",{"type":400,"tag":491,"props":1280,"children":1281},{"style":776},[1282],{"type":406,"value":779},{"type":400,"tag":491,"props":1284,"children":1285},{"style":504},[1286],{"type":406,"value":653},{"type":400,"tag":491,"props":1288,"children":1289},{"style":546},[1290],{"type":406,"value":1234},{"type":400,"tag":491,"props":1292,"children":1293},{"style":751},[1294],{"type":406,"value":1239},{"type":400,"tag":491,"props":1296,"children":1298},{"class":493,"line":1297},26,[1299],{"type":400,"tag":491,"props":1300,"children":1301},{"style":546},[1302],{"type":406,"value":848},{"type":400,"tag":491,"props":1304,"children":1306},{"class":493,"line":1305},27,[1307],{"type":400,"tag":491,"props":1308,"children":1309},{"emptyLinePlaceholder":393},[1310],{"type":406,"value":527},{"type":400,"tag":491,"props":1312,"children":1314},{"class":493,"line":1313},28,[1315,1320,1325],{"type":400,"tag":491,"props":1316,"children":1317},{"style":498},[1318],{"type":406,"value":1319},"  return",{"type":400,"tag":491,"props":1321,"children":1322},{"style":832},[1323],{"type":406,"value":1324}," 0",{"type":400,"tag":491,"props":1326,"children":1327},{"style":546},[1328],{"type":406,"value":580},{"type":400,"tag":491,"props":1330,"children":1332},{"class":493,"line":1331},29,[1333],{"type":400,"tag":491,"props":1334,"children":1335},{"style":546},[1336],{"type":406,"value":1337},"}\n",{"type":400,"tag":414,"props":1339,"children":1340},{},[1341],{"type":406,"value":1342},"测试的入口文件是 unit-tests/test_db.cc。以我看过的 JS 库来看，这是一个基本的功能测试。编译好 KDB 之后，运行编译出的二进制文件 test_db 可以开始测试。测试结果输出到控制台，如下代码所示。",{"type":400,"tag":480,"props":1344,"children":1346},{"code":1345},"==== Test DBTest.CloseAndReopen\n==== Test DBTest.RepairInvalidDatabaseOptionFile\n==== Test DBTest.KeysWithNullBytes\n==== Test DBTest.TestStringInterface\nDatabase Options: Stage 0 - Incompressible data with LZ4 compression enabled\nDatabase Options: Stage 1 - Compressible data with LZ4 compression enabled\nDatabase Options: Stage 2 - Compression disabled\nDatabase Options: Stage 3 - 64-bit MurmurHash3\nDatabase Options: Stage 4 - Checksum verification with incompressible data\nDatabase Options: Stage 5 - Checksum verification with compressible data\nDatabase Options: Stage 6 - Checksum verification with compression disabled\nDatabase Options: Stage 7 - Synced writes\nDatabase Options: Stage 8 - Small-sized HSTables with compression disabled\nDatabase Options: Stage 9 - Small-sized HSTables with incompressible data and LZ4 compression\nDatabase Options: Stage 10 - Small-sized HSTables with compressible data and LZ4 compression\nDatabase Options: Stage 11 - Direct mode for Write Buffer (incompressible data with LZ4 compression enabled)\nDatabase Options: Stage 12 - Direct mode for Write Buffer (compressible data with LZ4 compression enabled)\n==== Test DBTest.MultipartReader\n// the same with last stages\n==== Test DBTest.SingleThreadSmallEntries\n// the same with last stages\n==== Test DBTest.SingleThreadSnapshot\n// the same with last stages\n==== Test DBTest.SingleThreadSmallEntriesCompaction\n// the same with last stages\n==== Test DBTest.SequentialIterator\n// the same with last stages\n==== Test DBTest.SingleThreadSingleLargeEntry\n// the same with last stages\n==== Test DBTest.FileUtil\nmysize: 268435456\nOK\n89 ms\nFree size: 944 GB\n==== PASSED 11 tests\n",[1347],{"type":400,"tag":487,"props":1348,"children":1349},{"__ignoreMap":394},[1350],{"type":406,"value":1345},{"type":400,"tag":414,"props":1352,"children":1353},{},[1354],{"type":406,"value":1355},"每个功能点如数据库初始化和关闭 CloseAndReopen、存入带结束符的键 KeysWithNullBytes 都使用对应继承了 DBTest 的测试类进行测试。涉及到与数据库交互的功能部分如 TestStringInterface 使用循环，遍历了所有数据库 Options 可以设置的情况（但是只是二维循环，没有测试参数间的组合）。即对应上文的 Stage 1、Stage 2...",{"type":400,"tag":414,"props":1357,"children":1358},{},[1359],{"type":406,"value":1360},"在 test_db 创建相应的测试类时，会自动调用测试套件（unit-tests/testharness.cc）中的 RegisterTest 把测试函数储存起来。以便运行测试时，通过读取环境变量来判断是否要跳过某类测试。",{"type":400,"tag":414,"props":1362,"children":1363},{},[1364],{"type":406,"value":1365},"测试代码的实现还有一些有意思的地方，以下提及。",{"type":400,"tag":1367,"props":1368,"children":1370},"h4",{"id":1369},"信号处理",[1371],{"type":406,"value":1369},{"type":400,"tag":414,"props":1373,"children":1374},{},[1375],{"type":406,"value":1376},"和数据库核心的入口函数一样，使用 signal 挂载了对 SIGSEGV、SIGABRT 信号的处理。这两个信号分别指代系统内存错误和系统中断。而处理函数非常简单，就是 IKVS 中提到的“let it die”风格：输出调用栈，立马结束程序。",{"type":400,"tag":480,"props":1378,"children":1380},{"code":1379,"language":483,"meta":394,"className":484,"style":394},"void handler(int sig) {\n  int depth_max = 20;\n  void *array[depth_max];\n  size_t depth;\n  // backtrace 将前 depth_max 层栈帧记录到 array 数组中，\n  // 再通过 backtrace_symbols_fd 输出到 stderr。\n  // 文档见：https://man7.org/linux/man-pages/man3/backtrace.3.html\n  depth = backtrace(array, depth_max);\n  fprintf(stderr, \"Error: signal %d:\\n\", sig);\n  backtrace_symbols_fd(array, depth, STDERR_FILENO);\n  exit(1);\n}\nint main() {\n  signal(SIGSEGV, handler);\n  signal(SIGABRT, handler);\n  return kdb::test::RunAllTests();\n}\n",[1381],{"type":400,"tag":487,"props":1382,"children":1383},{"__ignoreMap":394},[1384,1419,1445,1478,1495,1504,1512,1520,1558,1617,1654,1674,1681,1700,1729,1757,1791],{"type":400,"tag":491,"props":1385,"children":1386},{"class":493,"line":494},[1387,1392,1397,1401,1405,1411,1415],{"type":400,"tag":491,"props":1388,"children":1389},{"style":534},[1390],{"type":406,"value":1391},"void",{"type":400,"tag":491,"props":1393,"children":1394},{"style":540},[1395],{"type":406,"value":1396}," handler",{"type":400,"tag":491,"props":1398,"children":1399},{"style":546},[1400],{"type":406,"value":628},{"type":400,"tag":491,"props":1402,"children":1403},{"style":534},[1404],{"type":406,"value":537},{"type":400,"tag":491,"props":1406,"children":1408},{"style":1407},"--shiki-light:#90A4AE;--shiki-default:#E36209;--shiki-dark:#FFAB70;--shiki-sepia:#FD971F;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[1409],{"type":406,"value":1410}," sig",{"type":400,"tag":491,"props":1412,"children":1413},{"style":546},[1414],{"type":406,"value":1195},{"type":400,"tag":491,"props":1416,"children":1417},{"style":546},[1418],{"type":406,"value":554},{"type":400,"tag":491,"props":1420,"children":1421},{"class":493,"line":521},[1422,1427,1432,1436,1441],{"type":400,"tag":491,"props":1423,"children":1424},{"style":534},[1425],{"type":406,"value":1426},"  int",{"type":400,"tag":491,"props":1428,"children":1429},{"style":572},[1430],{"type":406,"value":1431}," depth_max ",{"type":400,"tag":491,"props":1433,"children":1434},{"style":670},[1435],{"type":406,"value":673},{"type":400,"tag":491,"props":1437,"children":1438},{"style":832},[1439],{"type":406,"value":1440}," 20",{"type":400,"tag":491,"props":1442,"children":1443},{"style":546},[1444],{"type":406,"value":580},{"type":400,"tag":491,"props":1446,"children":1447},{"class":493,"line":530},[1448,1453,1458,1463,1468,1473],{"type":400,"tag":491,"props":1449,"children":1450},{"style":534},[1451],{"type":406,"value":1452},"  void",{"type":400,"tag":491,"props":1454,"children":1455},{"style":670},[1456],{"type":406,"value":1457}," *",{"type":400,"tag":491,"props":1459,"children":1460},{"style":572},[1461],{"type":406,"value":1462},"array",{"type":400,"tag":491,"props":1464,"children":1465},{"style":546},[1466],{"type":406,"value":1467},"[",{"type":400,"tag":491,"props":1469,"children":1470},{"style":572},[1471],{"type":406,"value":1472},"depth_max",{"type":400,"tag":491,"props":1474,"children":1475},{"style":546},[1476],{"type":406,"value":1477},"];\n",{"type":400,"tag":491,"props":1479,"children":1480},{"class":493,"line":557},[1481,1486,1491],{"type":400,"tag":491,"props":1482,"children":1483},{"style":534},[1484],{"type":406,"value":1485},"  size_t",{"type":400,"tag":491,"props":1487,"children":1488},{"style":572},[1489],{"type":406,"value":1490}," depth",{"type":400,"tag":491,"props":1492,"children":1493},{"style":546},[1494],{"type":406,"value":580},{"type":400,"tag":491,"props":1496,"children":1497},{"class":493,"line":583},[1498],{"type":400,"tag":491,"props":1499,"children":1501},{"style":1500},"--shiki-light:#90A4AE;--shiki-default:#6A737D;--shiki-dark:#6A737D;--shiki-sepia:#88846F;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:inherit",[1502],{"type":406,"value":1503},"  // backtrace 将前 depth_max 层栈帧记录到 array 数组中，\n",{"type":400,"tag":491,"props":1505,"children":1506},{"class":493,"line":604},[1507],{"type":400,"tag":491,"props":1508,"children":1509},{"style":1500},[1510],{"type":406,"value":1511},"  // 再通过 backtrace_symbols_fd 输出到 stderr。\n",{"type":400,"tag":491,"props":1513,"children":1514},{"class":493,"line":661},[1515],{"type":400,"tag":491,"props":1516,"children":1517},{"style":1500},[1518],{"type":406,"value":1519},"  // 文档见：https://man7.org/linux/man-pages/man3/backtrace.3.html\n",{"type":400,"tag":491,"props":1521,"children":1522},{"class":493,"line":696},[1523,1528,1532,1537,1541,1545,1549,1554],{"type":400,"tag":491,"props":1524,"children":1525},{"style":572},[1526],{"type":406,"value":1527},"  depth ",{"type":400,"tag":491,"props":1529,"children":1530},{"style":670},[1531],{"type":406,"value":673},{"type":400,"tag":491,"props":1533,"children":1534},{"style":540},[1535],{"type":406,"value":1536}," backtrace",{"type":400,"tag":491,"props":1538,"children":1539},{"style":546},[1540],{"type":406,"value":628},{"type":400,"tag":491,"props":1542,"children":1543},{"style":572},[1544],{"type":406,"value":1462},{"type":400,"tag":491,"props":1546,"children":1547},{"style":546},[1548],{"type":406,"value":638},{"type":400,"tag":491,"props":1550,"children":1551},{"style":572},[1552],{"type":406,"value":1553}," depth_max",{"type":400,"tag":491,"props":1555,"children":1556},{"style":546},[1557],{"type":406,"value":658},{"type":400,"tag":491,"props":1559,"children":1560},{"class":493,"line":738},[1561,1566,1570,1574,1578,1582,1587,1592,1597,1601,1605,1609,1613],{"type":400,"tag":491,"props":1562,"children":1563},{"style":540},[1564],{"type":406,"value":1565},"  fprintf",{"type":400,"tag":491,"props":1567,"children":1568},{"style":546},[1569],{"type":406,"value":628},{"type":400,"tag":491,"props":1571,"children":1572},{"style":572},[1573],{"type":406,"value":754},{"type":400,"tag":491,"props":1575,"children":1576},{"style":546},[1577],{"type":406,"value":638},{"type":400,"tag":491,"props":1579,"children":1580},{"style":504},[1581],{"type":406,"value":643},{"type":400,"tag":491,"props":1583,"children":1584},{"style":510},[1585],{"type":406,"value":1586},"Error: signal ",{"type":400,"tag":491,"props":1588,"children":1589},{"style":770},[1590],{"type":406,"value":1591},"%d",{"type":400,"tag":491,"props":1593,"children":1594},{"style":510},[1595],{"type":406,"value":1596},":",{"type":400,"tag":491,"props":1598,"children":1599},{"style":776},[1600],{"type":406,"value":779},{"type":400,"tag":491,"props":1602,"children":1603},{"style":504},[1604],{"type":406,"value":653},{"type":400,"tag":491,"props":1606,"children":1607},{"style":546},[1608],{"type":406,"value":638},{"type":400,"tag":491,"props":1610,"children":1611},{"style":572},[1612],{"type":406,"value":1410},{"type":400,"tag":491,"props":1614,"children":1615},{"style":546},[1616],{"type":406,"value":658},{"type":400,"tag":491,"props":1618,"children":1619},{"class":493,"line":819},[1620,1625,1629,1633,1637,1641,1645,1650],{"type":400,"tag":491,"props":1621,"children":1622},{"style":540},[1623],{"type":406,"value":1624},"  backtrace_symbols_fd",{"type":400,"tag":491,"props":1626,"children":1627},{"style":546},[1628],{"type":406,"value":628},{"type":400,"tag":491,"props":1630,"children":1631},{"style":572},[1632],{"type":406,"value":1462},{"type":400,"tag":491,"props":1634,"children":1635},{"style":546},[1636],{"type":406,"value":638},{"type":400,"tag":491,"props":1638,"children":1639},{"style":572},[1640],{"type":406,"value":1490},{"type":400,"tag":491,"props":1642,"children":1643},{"style":546},[1644],{"type":406,"value":638},{"type":400,"tag":491,"props":1646,"children":1647},{"style":572},[1648],{"type":406,"value":1649}," STDERR_FILENO",{"type":400,"tag":491,"props":1651,"children":1652},{"style":546},[1653],{"type":406,"value":658},{"type":400,"tag":491,"props":1655,"children":1656},{"class":493,"line":842},[1657,1662,1666,1670],{"type":400,"tag":491,"props":1658,"children":1659},{"style":540},[1660],{"type":406,"value":1661},"  exit",{"type":400,"tag":491,"props":1663,"children":1664},{"style":546},[1665],{"type":406,"value":628},{"type":400,"tag":491,"props":1667,"children":1668},{"style":832},[1669],{"type":406,"value":835},{"type":400,"tag":491,"props":1671,"children":1672},{"style":546},[1673],{"type":406,"value":658},{"type":400,"tag":491,"props":1675,"children":1676},{"class":493,"line":851},[1677],{"type":400,"tag":491,"props":1678,"children":1679},{"style":546},[1680],{"type":406,"value":1337},{"type":400,"tag":491,"props":1682,"children":1683},{"class":493,"line":859},[1684,1688,1692,1696],{"type":400,"tag":491,"props":1685,"children":1686},{"style":534},[1687],{"type":406,"value":537},{"type":400,"tag":491,"props":1689,"children":1690},{"style":540},[1691],{"type":406,"value":543},{"type":400,"tag":491,"props":1693,"children":1694},{"style":546},[1695],{"type":406,"value":549},{"type":400,"tag":491,"props":1697,"children":1698},{"style":546},[1699],{"type":406,"value":554},{"type":400,"tag":491,"props":1701,"children":1702},{"class":493,"line":902},[1703,1708,1712,1717,1721,1725],{"type":400,"tag":491,"props":1704,"children":1705},{"style":540},[1706],{"type":406,"value":1707},"  signal",{"type":400,"tag":491,"props":1709,"children":1710},{"style":546},[1711],{"type":406,"value":628},{"type":400,"tag":491,"props":1713,"children":1714},{"style":572},[1715],{"type":406,"value":1716},"SIGSEGV",{"type":400,"tag":491,"props":1718,"children":1719},{"style":546},[1720],{"type":406,"value":638},{"type":400,"tag":491,"props":1722,"children":1723},{"style":572},[1724],{"type":406,"value":1396},{"type":400,"tag":491,"props":1726,"children":1727},{"style":546},[1728],{"type":406,"value":658},{"type":400,"tag":491,"props":1730,"children":1731},{"class":493,"line":943},[1732,1736,1740,1745,1749,1753],{"type":400,"tag":491,"props":1733,"children":1734},{"style":540},[1735],{"type":406,"value":1707},{"type":400,"tag":491,"props":1737,"children":1738},{"style":546},[1739],{"type":406,"value":628},{"type":400,"tag":491,"props":1741,"children":1742},{"style":572},[1743],{"type":406,"value":1744},"SIGABRT",{"type":400,"tag":491,"props":1746,"children":1747},{"style":546},[1748],{"type":406,"value":638},{"type":400,"tag":491,"props":1750,"children":1751},{"style":572},[1752],{"type":406,"value":1396},{"type":400,"tag":491,"props":1754,"children":1755},{"style":546},[1756],{"type":406,"value":658},{"type":400,"tag":491,"props":1758,"children":1759},{"class":493,"line":951},[1760,1764,1769,1773,1778,1782,1787],{"type":400,"tag":491,"props":1761,"children":1762},{"style":498},[1763],{"type":406,"value":1319},{"type":400,"tag":491,"props":1765,"children":1766},{"style":561},[1767],{"type":406,"value":1768}," kdb",{"type":400,"tag":491,"props":1770,"children":1771},{"style":546},[1772],{"type":406,"value":569},{"type":400,"tag":491,"props":1774,"children":1775},{"style":561},[1776],{"type":406,"value":1777},"test",{"type":400,"tag":491,"props":1779,"children":1780},{"style":546},[1781],{"type":406,"value":569},{"type":400,"tag":491,"props":1783,"children":1784},{"style":540},[1785],{"type":406,"value":1786},"RunAllTests",{"type":400,"tag":491,"props":1788,"children":1789},{"style":546},[1790],{"type":406,"value":693},{"type":400,"tag":491,"props":1792,"children":1793},{"class":493,"line":972},[1794],{"type":400,"tag":491,"props":1795,"children":1796},{"style":546},[1797],{"type":406,"value":1337},{"type":400,"tag":1367,"props":1799,"children":1801},{"id":1800},"使用宏创建测试类",[1802],{"type":406,"value":1800},{"type":400,"tag":414,"props":1804,"children":1805},{},[1806],{"type":406,"value":1807},"test_db 中的类是使用宏定义的。如下代码，TEST 展开的新类，继承了 DBTest，实现了 _RunIt 接口以便调用测试函数。TCONCAT 宏顾名思义就是连接，使用标记黏贴运算符把两个字符串或实参连接在一起并视为一个新的标记。_Test_ 和 name 连接在一起后，就是新类的名称，如 _Test_CloseAndReopen。",{"type":400,"tag":480,"props":1809,"children":1811},{"code":1810,"language":483,"meta":394,"className":484,"style":394},"TEST(DBTest, CloseAndReopen) {\n  // ...\n}\n#define TEST(base,name)                                                 \\\nclass TCONCAT(_Test_,name) : public base {                              \\\n public:                                                                \\\n  void _Run();                                                          \\\n  static void _RunIt() {                                                \\\n    TCONCAT(_Test_,name) t;                                             \\\n    t._Run();                                                           \\\n  }                                                                     \\\n};                                                                      \\\nbool TCONCAT(_Test_ignored_,name) =                                     \\\n  ::kdb::test::RegisterTest(#base, #name, &TCONCAT(_Test_,name)::_RunIt); \\\n",[1812],{"type":400,"tag":487,"props":1813,"children":1814},{"__ignoreMap":394},[1815,1849,1857,1864,1904,1953,1971,1993,2026,2069,2095,2107,2120,2163],{"type":400,"tag":491,"props":1816,"children":1817},{"class":493,"line":494},[1818,1823,1827,1832,1836,1841,1845],{"type":400,"tag":491,"props":1819,"children":1820},{"style":540},[1821],{"type":406,"value":1822},"TEST",{"type":400,"tag":491,"props":1824,"children":1825},{"style":546},[1826],{"type":406,"value":628},{"type":400,"tag":491,"props":1828,"children":1829},{"style":572},[1830],{"type":406,"value":1831},"DBTest",{"type":400,"tag":491,"props":1833,"children":1834},{"style":546},[1835],{"type":406,"value":638},{"type":400,"tag":491,"props":1837,"children":1838},{"style":572},[1839],{"type":406,"value":1840}," CloseAndReopen",{"type":400,"tag":491,"props":1842,"children":1843},{"style":546},[1844],{"type":406,"value":1195},{"type":400,"tag":491,"props":1846,"children":1847},{"style":546},[1848],{"type":406,"value":554},{"type":400,"tag":491,"props":1850,"children":1851},{"class":493,"line":521},[1852],{"type":400,"tag":491,"props":1853,"children":1854},{"style":1500},[1855],{"type":406,"value":1856},"  // ...\n",{"type":400,"tag":491,"props":1858,"children":1859},{"class":493,"line":530},[1860],{"type":400,"tag":491,"props":1861,"children":1862},{"style":546},[1863],{"type":406,"value":1337},{"type":400,"tag":491,"props":1865,"children":1866},{"class":493,"line":557},[1867,1872,1877,1881,1886,1890,1895,1899],{"type":400,"tag":491,"props":1868,"children":1869},{"style":498},[1870],{"type":406,"value":1871},"#define",{"type":400,"tag":491,"props":1873,"children":1874},{"style":540},[1875],{"type":406,"value":1876}," TEST",{"type":400,"tag":491,"props":1878,"children":1879},{"style":546},[1880],{"type":406,"value":628},{"type":400,"tag":491,"props":1882,"children":1883},{"style":1407},[1884],{"type":406,"value":1885},"base",{"type":400,"tag":491,"props":1887,"children":1888},{"style":546},[1889],{"type":406,"value":638},{"type":400,"tag":491,"props":1891,"children":1892},{"style":1407},[1893],{"type":406,"value":1894},"name",{"type":400,"tag":491,"props":1896,"children":1897},{"style":546},[1898],{"type":406,"value":1195},{"type":400,"tag":491,"props":1900,"children":1901},{"style":776},[1902],{"type":406,"value":1903},"                                                 \\\n",{"type":400,"tag":491,"props":1905,"children":1906},{"class":493,"line":583},[1907,1912,1917,1921,1926,1930,1934,1938,1943,1948],{"type":400,"tag":491,"props":1908,"children":1909},{"style":534},[1910],{"type":406,"value":1911},"class",{"type":400,"tag":491,"props":1913,"children":1914},{"style":540},[1915],{"type":406,"value":1916}," TCONCAT",{"type":400,"tag":491,"props":1918,"children":1919},{"style":546},[1920],{"type":406,"value":628},{"type":400,"tag":491,"props":1922,"children":1923},{"style":561},[1924],{"type":406,"value":1925},"_Test_",{"type":400,"tag":491,"props":1927,"children":1928},{"style":546},[1929],{"type":406,"value":638},{"type":400,"tag":491,"props":1931,"children":1932},{"style":561},[1933],{"type":406,"value":1894},{"type":400,"tag":491,"props":1935,"children":1936},{"style":546},[1937],{"type":406,"value":1195},{"type":400,"tag":491,"props":1939,"children":1940},{"style":572},[1941],{"type":406,"value":1942}," : public base ",{"type":400,"tag":491,"props":1944,"children":1945},{"style":546},[1946],{"type":406,"value":1947},"{",{"type":400,"tag":491,"props":1949,"children":1950},{"style":776},[1951],{"type":406,"value":1952},"                              \\\n",{"type":400,"tag":491,"props":1954,"children":1955},{"class":493,"line":604},[1956,1961,1966],{"type":400,"tag":491,"props":1957,"children":1958},{"style":534},[1959],{"type":406,"value":1960}," public",{"type":400,"tag":491,"props":1962,"children":1964},{"style":1963},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#66D9EF;--shiki-light-font-style:inherit;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[1965],{"type":406,"value":1596},{"type":400,"tag":491,"props":1967,"children":1968},{"style":776},[1969],{"type":406,"value":1970},"                                                                \\\n",{"type":400,"tag":491,"props":1972,"children":1973},{"class":493,"line":661},[1974,1978,1983,1988],{"type":400,"tag":491,"props":1975,"children":1976},{"style":534},[1977],{"type":406,"value":1452},{"type":400,"tag":491,"props":1979,"children":1980},{"style":540},[1981],{"type":406,"value":1982}," _Run",{"type":400,"tag":491,"props":1984,"children":1985},{"style":546},[1986],{"type":406,"value":1987},"();",{"type":400,"tag":491,"props":1989,"children":1990},{"style":776},[1991],{"type":406,"value":1992},"                                                          \\\n",{"type":400,"tag":491,"props":1994,"children":1995},{"class":493,"line":696},[1996,2002,2007,2012,2016,2021],{"type":400,"tag":491,"props":1997,"children":1999},{"style":1998},"--shiki-light:#9C3EDA;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[2000],{"type":406,"value":2001},"  static",{"type":400,"tag":491,"props":2003,"children":2004},{"style":534},[2005],{"type":406,"value":2006}," void",{"type":400,"tag":491,"props":2008,"children":2009},{"style":540},[2010],{"type":406,"value":2011}," _RunIt",{"type":400,"tag":491,"props":2013,"children":2014},{"style":546},[2015],{"type":406,"value":549},{"type":400,"tag":491,"props":2017,"children":2018},{"style":546},[2019],{"type":406,"value":2020}," {",{"type":400,"tag":491,"props":2022,"children":2023},{"style":776},[2024],{"type":406,"value":2025},"                                                \\\n",{"type":400,"tag":491,"props":2027,"children":2028},{"class":493,"line":738},[2029,2034,2038,2042,2046,2050,2054,2059,2064],{"type":400,"tag":491,"props":2030,"children":2031},{"style":540},[2032],{"type":406,"value":2033},"    TCONCAT",{"type":400,"tag":491,"props":2035,"children":2036},{"style":546},[2037],{"type":406,"value":628},{"type":400,"tag":491,"props":2039,"children":2040},{"style":751},[2041],{"type":406,"value":1925},{"type":400,"tag":491,"props":2043,"children":2044},{"style":546},[2045],{"type":406,"value":638},{"type":400,"tag":491,"props":2047,"children":2048},{"style":751},[2049],{"type":406,"value":1894},{"type":400,"tag":491,"props":2051,"children":2052},{"style":546},[2053],{"type":406,"value":1195},{"type":400,"tag":491,"props":2055,"children":2056},{"style":751},[2057],{"type":406,"value":2058}," t",{"type":400,"tag":491,"props":2060,"children":2061},{"style":546},[2062],{"type":406,"value":2063},";",{"type":400,"tag":491,"props":2065,"children":2066},{"style":776},[2067],{"type":406,"value":2068},"                                             \\\n",{"type":400,"tag":491,"props":2070,"children":2071},{"class":493,"line":819},[2072,2077,2081,2086,2090],{"type":400,"tag":491,"props":2073,"children":2074},{"style":572},[2075],{"type":406,"value":2076},"    t",{"type":400,"tag":491,"props":2078,"children":2079},{"style":546},[2080],{"type":406,"value":683},{"type":400,"tag":491,"props":2082,"children":2083},{"style":540},[2084],{"type":406,"value":2085},"_Run",{"type":400,"tag":491,"props":2087,"children":2088},{"style":546},[2089],{"type":406,"value":1987},{"type":400,"tag":491,"props":2091,"children":2092},{"style":776},[2093],{"type":406,"value":2094},"                                                           \\\n",{"type":400,"tag":491,"props":2096,"children":2097},{"class":493,"line":842},[2098,2102],{"type":400,"tag":491,"props":2099,"children":2100},{"style":546},[2101],{"type":406,"value":1248},{"type":400,"tag":491,"props":2103,"children":2104},{"style":776},[2105],{"type":406,"value":2106},"                                                                     \\\n",{"type":400,"tag":491,"props":2108,"children":2109},{"class":493,"line":851},[2110,2115],{"type":400,"tag":491,"props":2111,"children":2112},{"style":546},[2113],{"type":406,"value":2114},"};",{"type":400,"tag":491,"props":2116,"children":2117},{"style":776},[2118],{"type":406,"value":2119},"                                                                      \\\n",{"type":400,"tag":491,"props":2121,"children":2122},{"class":493,"line":859},[2123,2128,2132,2136,2141,2145,2149,2153,2158],{"type":400,"tag":491,"props":2124,"children":2125},{"style":534},[2126],{"type":406,"value":2127},"bool",{"type":400,"tag":491,"props":2129,"children":2130},{"style":540},[2131],{"type":406,"value":1916},{"type":400,"tag":491,"props":2133,"children":2134},{"style":546},[2135],{"type":406,"value":628},{"type":400,"tag":491,"props":2137,"children":2138},{"style":561},[2139],{"type":406,"value":2140},"_Test_ignored_",{"type":400,"tag":491,"props":2142,"children":2143},{"style":546},[2144],{"type":406,"value":638},{"type":400,"tag":491,"props":2146,"children":2147},{"style":561},[2148],{"type":406,"value":1894},{"type":400,"tag":491,"props":2150,"children":2151},{"style":546},[2152],{"type":406,"value":1195},{"type":400,"tag":491,"props":2154,"children":2155},{"style":670},[2156],{"type":406,"value":2157}," =",{"type":400,"tag":491,"props":2159,"children":2160},{"style":776},[2161],{"type":406,"value":2162},"                                     \\\n",{"type":400,"tag":491,"props":2164,"children":2165},{"class":493,"line":902},[2166,2171,2176,2180,2184,2188,2193,2197,2202,2206,2211,2215,2219,2224,2228,2232,2236,2240,2244,2249,2253],{"type":400,"tag":491,"props":2167,"children":2168},{"style":572},[2169],{"type":406,"value":2170},"  ::",{"type":400,"tag":491,"props":2172,"children":2173},{"style":561},[2174],{"type":406,"value":2175},"kdb",{"type":400,"tag":491,"props":2177,"children":2178},{"style":546},[2179],{"type":406,"value":569},{"type":400,"tag":491,"props":2181,"children":2182},{"style":561},[2183],{"type":406,"value":1777},{"type":400,"tag":491,"props":2185,"children":2186},{"style":546},[2187],{"type":406,"value":569},{"type":400,"tag":491,"props":2189,"children":2190},{"style":540},[2191],{"type":406,"value":2192},"RegisterTest",{"type":400,"tag":491,"props":2194,"children":2195},{"style":546},[2196],{"type":406,"value":628},{"type":400,"tag":491,"props":2198,"children":2199},{"style":572},[2200],{"type":406,"value":2201},"#base",{"type":400,"tag":491,"props":2203,"children":2204},{"style":546},[2205],{"type":406,"value":638},{"type":400,"tag":491,"props":2207,"children":2208},{"style":572},[2209],{"type":406,"value":2210}," #name",{"type":400,"tag":491,"props":2212,"children":2213},{"style":546},[2214],{"type":406,"value":638},{"type":400,"tag":491,"props":2216,"children":2217},{"style":670},[2218],{"type":406,"value":1126},{"type":400,"tag":491,"props":2220,"children":2221},{"style":540},[2222],{"type":406,"value":2223},"TCONCAT",{"type":400,"tag":491,"props":2225,"children":2226},{"style":546},[2227],{"type":406,"value":628},{"type":400,"tag":491,"props":2229,"children":2230},{"style":572},[2231],{"type":406,"value":1925},{"type":400,"tag":491,"props":2233,"children":2234},{"style":546},[2235],{"type":406,"value":638},{"type":400,"tag":491,"props":2237,"children":2238},{"style":572},[2239],{"type":406,"value":1894},{"type":400,"tag":491,"props":2241,"children":2242},{"style":546},[2243],{"type":406,"value":1195},{"type":400,"tag":491,"props":2245,"children":2246},{"style":572},[2247],{"type":406,"value":2248},"::_RunIt",{"type":400,"tag":491,"props":2250,"children":2251},{"style":546},[2252],{"type":406,"value":1234},{"type":400,"tag":491,"props":2254,"children":2255},{"style":776},[2256],{"type":406,"value":2257}," \\\n",{"type":400,"tag":414,"props":2259,"children":2260},{},[2261],{"type":406,"value":2262},"可是，既然有 TCONCAT，为什么还要定义一个 TCONCAT1 宏呢？",{"type":400,"tag":480,"props":2264,"children":2266},{"code":2265,"language":483,"meta":394,"className":484,"style":394},"#define TCONCAT(a,b) TCONCAT1(a,b)\n#define TCONCAT1(a,b) a##b\n",[2267],{"type":400,"tag":487,"props":2268,"children":2269},{"__ignoreMap":394},[2270,2328],{"type":400,"tag":491,"props":2271,"children":2272},{"class":493,"line":494},[2273,2277,2281,2285,2289,2293,2298,2302,2307,2311,2315,2319,2323],{"type":400,"tag":491,"props":2274,"children":2275},{"style":498},[2276],{"type":406,"value":1871},{"type":400,"tag":491,"props":2278,"children":2279},{"style":540},[2280],{"type":406,"value":1916},{"type":400,"tag":491,"props":2282,"children":2283},{"style":546},[2284],{"type":406,"value":628},{"type":400,"tag":491,"props":2286,"children":2287},{"style":1407},[2288],{"type":406,"value":425},{"type":400,"tag":491,"props":2290,"children":2291},{"style":546},[2292],{"type":406,"value":638},{"type":400,"tag":491,"props":2294,"children":2295},{"style":1407},[2296],{"type":406,"value":2297},"b",{"type":400,"tag":491,"props":2299,"children":2300},{"style":546},[2301],{"type":406,"value":1195},{"type":400,"tag":491,"props":2303,"children":2304},{"style":540},[2305],{"type":406,"value":2306}," TCONCAT1",{"type":400,"tag":491,"props":2308,"children":2309},{"style":546},[2310],{"type":406,"value":628},{"type":400,"tag":491,"props":2312,"children":2313},{"style":572},[2314],{"type":406,"value":425},{"type":400,"tag":491,"props":2316,"children":2317},{"style":546},[2318],{"type":406,"value":638},{"type":400,"tag":491,"props":2320,"children":2321},{"style":572},[2322],{"type":406,"value":2297},{"type":400,"tag":491,"props":2324,"children":2325},{"style":546},[2326],{"type":406,"value":2327},")\n",{"type":400,"tag":491,"props":2329,"children":2330},{"class":493,"line":521},[2331,2335,2339,2343,2347,2351,2355,2359],{"type":400,"tag":491,"props":2332,"children":2333},{"style":498},[2334],{"type":406,"value":1871},{"type":400,"tag":491,"props":2336,"children":2337},{"style":540},[2338],{"type":406,"value":2306},{"type":400,"tag":491,"props":2340,"children":2341},{"style":546},[2342],{"type":406,"value":628},{"type":400,"tag":491,"props":2344,"children":2345},{"style":1407},[2346],{"type":406,"value":425},{"type":400,"tag":491,"props":2348,"children":2349},{"style":546},[2350],{"type":406,"value":638},{"type":400,"tag":491,"props":2352,"children":2353},{"style":1407},[2354],{"type":406,"value":2297},{"type":400,"tag":491,"props":2356,"children":2357},{"style":546},[2358],{"type":406,"value":1195},{"type":400,"tag":491,"props":2360,"children":2361},{"style":572},[2362],{"type":406,"value":2363}," a##b\n",{"type":400,"tag":414,"props":2365,"children":2366},{},[2367],{"type":406,"value":2368},"这就要提到宏的一个特殊规则了，如果宏参数使用了字符串化运算符（#）或标记黏贴运算符（##），那么即便参数是宏也不会展开。所以需要一个间接宏 TCONCAT1，以达到先展开参数（如果参数是宏的化），再调用标记黏贴运算符的目的。从 test_db 可以看到，测试类的名词都不是宏，所以这里本不需要 TCONCAT1 这个间接宏。但是考虑到程序的健壮性，加上更好。",{"type":400,"tag":1367,"props":2370,"children":2372},{"id":2371},"断言宏",[2373],{"type":406,"value":2371},{"type":400,"tag":414,"props":2375,"children":2376},{},[2377],{"type":406,"value":2378},"测试代码中的断言也是使用的宏来定义的。相比 TCONCAT 简单很多了，但其特点是可以记录抛错的文件以及行号。以下代码实现了 ASSERT_EQ 的定义。Tester 用于记录宏展开时所在的文件 __FILE__、行号 __LINE__ 以及断言结果。一但断言失败，记录到 ok_ 成员变量中。在 Tester 析构时，会把相关信息一并打印出来。",{"type":400,"tag":480,"props":2380,"children":2382},{"code":2381,"language":483,"meta":394,"className":484,"style":394},"class Tester {\n#define BINARY_OP(name,op)                              \\\n  template \u003Cclass X, class Y>                           \\\n  Tester& name(const X& x, const Y& y) {                \\\n    if (! (x op y)) {                                   \\\n      ss_ \u003C\u003C \" failed: \" \u003C\u003C x \u003C\u003C (\" \" #op \" \") \u003C\u003C y;    \\\n      ok_ = false;                                      \\\n    }                                                   \\\n    return *this;                                       \\\n  }\n  BINARY_OP(IsEq, ==)\n#undef BINARY_OP\n}\n#define ASSERT_EQ(a,b) ::kdb::test::Tester(__FILE__, __LINE__).IsEq((a),(b))\n",[2383],{"type":400,"tag":487,"props":2384,"children":2385},{"__ignoreMap":394},[2386,2402,2439,2484,2559,2598,2684,2711,2724,2751,2758,2788,2801,2808],{"type":400,"tag":491,"props":2387,"children":2388},{"class":493,"line":494},[2389,2393,2398],{"type":400,"tag":491,"props":2390,"children":2391},{"style":534},[2392],{"type":406,"value":1911},{"type":400,"tag":491,"props":2394,"children":2395},{"style":561},[2396],{"type":406,"value":2397}," Tester",{"type":400,"tag":491,"props":2399,"children":2400},{"style":546},[2401],{"type":406,"value":554},{"type":400,"tag":491,"props":2403,"children":2404},{"class":493,"line":521},[2405,2409,2414,2418,2422,2426,2431,2435],{"type":400,"tag":491,"props":2406,"children":2407},{"style":498},[2408],{"type":406,"value":1871},{"type":400,"tag":491,"props":2410,"children":2411},{"style":540},[2412],{"type":406,"value":2413}," BINARY_OP",{"type":400,"tag":491,"props":2415,"children":2416},{"style":546},[2417],{"type":406,"value":628},{"type":400,"tag":491,"props":2419,"children":2420},{"style":1407},[2421],{"type":406,"value":1894},{"type":400,"tag":491,"props":2423,"children":2424},{"style":546},[2425],{"type":406,"value":638},{"type":400,"tag":491,"props":2427,"children":2428},{"style":1407},[2429],{"type":406,"value":2430},"op",{"type":400,"tag":491,"props":2432,"children":2433},{"style":546},[2434],{"type":406,"value":1195},{"type":400,"tag":491,"props":2436,"children":2437},{"style":776},[2438],{"type":406,"value":1952},{"type":400,"tag":491,"props":2440,"children":2441},{"class":493,"line":530},[2442,2447,2451,2455,2460,2464,2469,2474,2479],{"type":400,"tag":491,"props":2443,"children":2444},{"style":534},[2445],{"type":406,"value":2446},"  template",{"type":400,"tag":491,"props":2448,"children":2449},{"style":546},[2450],{"type":406,"value":507},{"type":400,"tag":491,"props":2452,"children":2453},{"style":534},[2454],{"type":406,"value":1911},{"type":400,"tag":491,"props":2456,"children":2457},{"style":561},[2458],{"type":406,"value":2459}," X",{"type":400,"tag":491,"props":2461,"children":2462},{"style":546},[2463],{"type":406,"value":638},{"type":400,"tag":491,"props":2465,"children":2466},{"style":534},[2467],{"type":406,"value":2468}," class",{"type":400,"tag":491,"props":2470,"children":2471},{"style":561},[2472],{"type":406,"value":2473}," Y",{"type":400,"tag":491,"props":2475,"children":2476},{"style":546},[2477],{"type":406,"value":2478},">",{"type":400,"tag":491,"props":2480,"children":2481},{"style":776},[2482],{"type":406,"value":2483},"                           \\\n",{"type":400,"tag":491,"props":2485,"children":2486},{"class":493,"line":557},[2487,2492,2497,2502,2506,2511,2515,2519,2524,2528,2533,2537,2541,2546,2550,2554],{"type":400,"tag":491,"props":2488,"children":2489},{"style":561},[2490],{"type":406,"value":2491},"  Tester",{"type":400,"tag":491,"props":2493,"children":2494},{"style":1998},[2495],{"type":406,"value":2496},"&",{"type":400,"tag":491,"props":2498,"children":2499},{"style":540},[2500],{"type":406,"value":2501}," name",{"type":400,"tag":491,"props":2503,"children":2504},{"style":546},[2505],{"type":406,"value":628},{"type":400,"tag":491,"props":2507,"children":2508},{"style":1998},[2509],{"type":406,"value":2510},"const",{"type":400,"tag":491,"props":2512,"children":2513},{"style":561},[2514],{"type":406,"value":2459},{"type":400,"tag":491,"props":2516,"children":2517},{"style":1998},[2518],{"type":406,"value":2496},{"type":400,"tag":491,"props":2520,"children":2521},{"style":1407},[2522],{"type":406,"value":2523}," x",{"type":400,"tag":491,"props":2525,"children":2526},{"style":546},[2527],{"type":406,"value":638},{"type":400,"tag":491,"props":2529,"children":2530},{"style":1998},[2531],{"type":406,"value":2532}," const",{"type":400,"tag":491,"props":2534,"children":2535},{"style":561},[2536],{"type":406,"value":2473},{"type":400,"tag":491,"props":2538,"children":2539},{"style":1998},[2540],{"type":406,"value":2496},{"type":400,"tag":491,"props":2542,"children":2543},{"style":1407},[2544],{"type":406,"value":2545}," y",{"type":400,"tag":491,"props":2547,"children":2548},{"style":546},[2549],{"type":406,"value":1195},{"type":400,"tag":491,"props":2551,"children":2552},{"style":546},[2553],{"type":406,"value":2020},{"type":400,"tag":491,"props":2555,"children":2556},{"style":776},[2557],{"type":406,"value":2558},"                \\\n",{"type":400,"tag":491,"props":2560,"children":2561},{"class":493,"line":583},[2562,2567,2571,2575,2579,2584,2589,2593],{"type":400,"tag":491,"props":2563,"children":2564},{"style":498},[2565],{"type":406,"value":2566},"    if",{"type":400,"tag":491,"props":2568,"children":2569},{"style":546},[2570],{"type":406,"value":707},{"type":400,"tag":491,"props":2572,"children":2573},{"style":670},[2574],{"type":406,"value":712},{"type":400,"tag":491,"props":2576,"children":2577},{"style":546},[2578],{"type":406,"value":707},{"type":400,"tag":491,"props":2580,"children":2581},{"style":751},[2582],{"type":406,"value":2583},"x op y",{"type":400,"tag":491,"props":2585,"children":2586},{"style":546},[2587],{"type":406,"value":2588},"))",{"type":400,"tag":491,"props":2590,"children":2591},{"style":546},[2592],{"type":406,"value":2020},{"type":400,"tag":491,"props":2594,"children":2595},{"style":776},[2596],{"type":406,"value":2597},"                                   \\\n",{"type":400,"tag":491,"props":2599,"children":2600},{"class":493,"line":604},[2601,2606,2611,2615,2620,2624,2629,2634,2638,2642,2646,2650,2655,2659,2663,2667,2671,2675,2679],{"type":400,"tag":491,"props":2602,"children":2603},{"style":751},[2604],{"type":406,"value":2605},"      ss_ ",{"type":400,"tag":491,"props":2607,"children":2608},{"style":670},[2609],{"type":406,"value":2610},"\u003C\u003C",{"type":400,"tag":491,"props":2612,"children":2613},{"style":504},[2614],{"type":406,"value":643},{"type":400,"tag":491,"props":2616,"children":2617},{"style":510},[2618],{"type":406,"value":2619}," failed: ",{"type":400,"tag":491,"props":2621,"children":2622},{"style":504},[2623],{"type":406,"value":653},{"type":400,"tag":491,"props":2625,"children":2626},{"style":670},[2627],{"type":406,"value":2628}," \u003C\u003C",{"type":400,"tag":491,"props":2630,"children":2631},{"style":751},[2632],{"type":406,"value":2633}," x ",{"type":400,"tag":491,"props":2635,"children":2636},{"style":670},[2637],{"type":406,"value":2610},{"type":400,"tag":491,"props":2639,"children":2640},{"style":546},[2641],{"type":406,"value":707},{"type":400,"tag":491,"props":2643,"children":2644},{"style":504},[2645],{"type":406,"value":653},{"type":400,"tag":491,"props":2647,"children":2648},{"style":504},[2649],{"type":406,"value":643},{"type":400,"tag":491,"props":2651,"children":2652},{"style":572},[2653],{"type":406,"value":2654}," #op",{"type":400,"tag":491,"props":2656,"children":2657},{"style":504},[2658],{"type":406,"value":643},{"type":400,"tag":491,"props":2660,"children":2661},{"style":504},[2662],{"type":406,"value":643},{"type":400,"tag":491,"props":2664,"children":2665},{"style":546},[2666],{"type":406,"value":1195},{"type":400,"tag":491,"props":2668,"children":2669},{"style":670},[2670],{"type":406,"value":2628},{"type":400,"tag":491,"props":2672,"children":2673},{"style":751},[2674],{"type":406,"value":2545},{"type":400,"tag":491,"props":2676,"children":2677},{"style":546},[2678],{"type":406,"value":2063},{"type":400,"tag":491,"props":2680,"children":2681},{"style":776},[2682],{"type":406,"value":2683},"    \\\n",{"type":400,"tag":491,"props":2685,"children":2686},{"class":493,"line":661},[2687,2692,2696,2702,2706],{"type":400,"tag":491,"props":2688,"children":2689},{"style":751},[2690],{"type":406,"value":2691},"      ok_ ",{"type":400,"tag":491,"props":2693,"children":2694},{"style":670},[2695],{"type":406,"value":673},{"type":400,"tag":491,"props":2697,"children":2699},{"style":2698},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[2700],{"type":406,"value":2701}," false",{"type":400,"tag":491,"props":2703,"children":2704},{"style":546},[2705],{"type":406,"value":2063},{"type":400,"tag":491,"props":2707,"children":2708},{"style":776},[2709],{"type":406,"value":2710},"                                      \\\n",{"type":400,"tag":491,"props":2712,"children":2713},{"class":493,"line":696},[2714,2719],{"type":400,"tag":491,"props":2715,"children":2716},{"style":546},[2717],{"type":406,"value":2718},"    }",{"type":400,"tag":491,"props":2720,"children":2721},{"style":776},[2722],{"type":406,"value":2723},"                                                   \\\n",{"type":400,"tag":491,"props":2725,"children":2726},{"class":493,"line":738},[2727,2732,2736,2742,2746],{"type":400,"tag":491,"props":2728,"children":2729},{"style":498},[2730],{"type":406,"value":2731},"    return",{"type":400,"tag":491,"props":2733,"children":2734},{"style":670},[2735],{"type":406,"value":1457},{"type":400,"tag":491,"props":2737,"children":2739},{"style":2738},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[2740],{"type":406,"value":2741},"this",{"type":400,"tag":491,"props":2743,"children":2744},{"style":546},[2745],{"type":406,"value":2063},{"type":400,"tag":491,"props":2747,"children":2748},{"style":776},[2749],{"type":406,"value":2750},"                                       \\\n",{"type":400,"tag":491,"props":2752,"children":2753},{"class":493,"line":819},[2754],{"type":400,"tag":491,"props":2755,"children":2756},{"style":546},[2757],{"type":406,"value":848},{"type":400,"tag":491,"props":2759,"children":2760},{"class":493,"line":842},[2761,2766,2770,2775,2779,2784],{"type":400,"tag":491,"props":2762,"children":2763},{"style":540},[2764],{"type":406,"value":2765},"  BINARY_OP",{"type":400,"tag":491,"props":2767,"children":2768},{"style":546},[2769],{"type":406,"value":628},{"type":400,"tag":491,"props":2771,"children":2772},{"style":561},[2773],{"type":406,"value":2774},"IsEq",{"type":400,"tag":491,"props":2776,"children":2777},{"style":546},[2778],{"type":406,"value":638},{"type":400,"tag":491,"props":2780,"children":2781},{"style":670},[2782],{"type":406,"value":2783}," ==",{"type":400,"tag":491,"props":2785,"children":2786},{"style":546},[2787],{"type":406,"value":2327},{"type":400,"tag":491,"props":2789,"children":2790},{"class":493,"line":851},[2791,2796],{"type":400,"tag":491,"props":2792,"children":2793},{"style":498},[2794],{"type":406,"value":2795},"#undef",{"type":400,"tag":491,"props":2797,"children":2798},{"style":540},[2799],{"type":406,"value":2800}," BINARY_OP\n",{"type":400,"tag":491,"props":2802,"children":2803},{"class":493,"line":859},[2804],{"type":400,"tag":491,"props":2805,"children":2806},{"style":751},[2807],{"type":406,"value":1337},{"type":400,"tag":491,"props":2809,"children":2810},{"class":493,"line":902},[2811,2815,2820,2824,2828,2832,2836,2840,2845,2849,2853,2857,2861,2866,2870,2876,2880,2885,2890,2894,2899,2903,2908,2912],{"type":400,"tag":491,"props":2812,"children":2813},{"style":498},[2814],{"type":406,"value":1871},{"type":400,"tag":491,"props":2816,"children":2817},{"style":540},[2818],{"type":406,"value":2819}," ASSERT_EQ",{"type":400,"tag":491,"props":2821,"children":2822},{"style":546},[2823],{"type":406,"value":628},{"type":400,"tag":491,"props":2825,"children":2826},{"style":1407},[2827],{"type":406,"value":425},{"type":400,"tag":491,"props":2829,"children":2830},{"style":546},[2831],{"type":406,"value":638},{"type":400,"tag":491,"props":2833,"children":2834},{"style":1407},[2835],{"type":406,"value":2297},{"type":400,"tag":491,"props":2837,"children":2838},{"style":546},[2839],{"type":406,"value":1195},{"type":400,"tag":491,"props":2841,"children":2842},{"style":751},[2843],{"type":406,"value":2844}," ::",{"type":400,"tag":491,"props":2846,"children":2847},{"style":561},[2848],{"type":406,"value":2175},{"type":400,"tag":491,"props":2850,"children":2851},{"style":546},[2852],{"type":406,"value":569},{"type":400,"tag":491,"props":2854,"children":2855},{"style":561},[2856],{"type":406,"value":1777},{"type":400,"tag":491,"props":2858,"children":2859},{"style":546},[2860],{"type":406,"value":569},{"type":400,"tag":491,"props":2862,"children":2863},{"style":540},[2864],{"type":406,"value":2865},"Tester",{"type":400,"tag":491,"props":2867,"children":2868},{"style":546},[2869],{"type":406,"value":628},{"type":400,"tag":491,"props":2871,"children":2873},{"style":2872},"--shiki-light:#E2931D;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#F8F8F2",[2874],{"type":406,"value":2875},"__FILE__",{"type":400,"tag":491,"props":2877,"children":2878},{"style":546},[2879],{"type":406,"value":638},{"type":400,"tag":491,"props":2881,"children":2882},{"style":2872},[2883],{"type":406,"value":2884}," __LINE__",{"type":400,"tag":491,"props":2886,"children":2887},{"style":546},[2888],{"type":406,"value":2889},").",{"type":400,"tag":491,"props":2891,"children":2892},{"style":540},[2893],{"type":406,"value":2774},{"type":400,"tag":491,"props":2895,"children":2896},{"style":546},[2897],{"type":406,"value":2898},"((",{"type":400,"tag":491,"props":2900,"children":2901},{"style":751},[2902],{"type":406,"value":425},{"type":400,"tag":491,"props":2904,"children":2905},{"style":546},[2906],{"type":406,"value":2907},"),(",{"type":400,"tag":491,"props":2909,"children":2910},{"style":751},[2911],{"type":406,"value":2297},{"type":400,"tag":491,"props":2913,"children":2914},{"style":546},[2915],{"type":406,"value":2916},"))\n",{"type":400,"tag":1367,"props":2918,"children":2920},{"id":2919},"stringrepeatntimes",[2921],{"type":406,"value":2922},"string.repeat(ntimes)",{"type":400,"tag":414,"props":2924,"children":2925},{},[2926],{"type":406,"value":2927},"写 JavaScript 时经常用到 String 的原型方法 repeat，用来把 n 个内容重复的字符串拼接为一个新字符串。也许是 C++ 标准库没有提供相应的算法，KDB 使用了一种和 repeat 完全不一样的处理思路。KDB 使用 StringStream 填充一定位数内容，还可以不用考虑值的长度。",{"type":400,"tag":480,"props":2929,"children":2931},{"code":2930,"language":483,"meta":394,"className":484,"style":394},"std::stringstream ss;\nss \u003C\u003C std::setfill ('0') \u003C\u003C std::setw (16);\nss \u003C\u003C 1;\nss.str(); // result is: \"0000000000000001\"\nss \u003C\u003C std::setfill ('0') \u003C\u003C std::setw (16);\nss \u003C\u003C 1123;\nss.str(); // result is: \"0000000000001123\"\n",[2932],{"type":400,"tag":487,"props":2933,"children":2934},{"__ignoreMap":394},[2935,2956,3034,3054,3080,3151,3171],{"type":400,"tag":491,"props":2936,"children":2937},{"class":493,"line":494},[2938,2943,2947,2952],{"type":400,"tag":491,"props":2939,"children":2940},{"style":561},[2941],{"type":406,"value":2942},"std",{"type":400,"tag":491,"props":2944,"children":2945},{"style":546},[2946],{"type":406,"value":569},{"type":400,"tag":491,"props":2948,"children":2949},{"style":572},[2950],{"type":406,"value":2951},"stringstream ss",{"type":400,"tag":491,"props":2953,"children":2954},{"style":546},[2955],{"type":406,"value":580},{"type":400,"tag":491,"props":2957,"children":2958},{"class":493,"line":521},[2959,2964,2968,2973,2977,2982,2986,2991,2996,3000,3004,3008,3012,3016,3021,3025,3030],{"type":400,"tag":491,"props":2960,"children":2961},{"style":572},[2962],{"type":406,"value":2963},"ss ",{"type":400,"tag":491,"props":2965,"children":2966},{"style":670},[2967],{"type":406,"value":2610},{"type":400,"tag":491,"props":2969,"children":2970},{"style":561},[2971],{"type":406,"value":2972}," std",{"type":400,"tag":491,"props":2974,"children":2975},{"style":546},[2976],{"type":406,"value":569},{"type":400,"tag":491,"props":2978,"children":2979},{"style":540},[2980],{"type":406,"value":2981},"setfill",{"type":400,"tag":491,"props":2983,"children":2984},{"style":546},[2985],{"type":406,"value":707},{"type":400,"tag":491,"props":2987,"children":2988},{"style":504},[2989],{"type":406,"value":2990},"'",{"type":400,"tag":491,"props":2992,"children":2993},{"style":510},[2994],{"type":406,"value":2995},"0",{"type":400,"tag":491,"props":2997,"children":2998},{"style":504},[2999],{"type":406,"value":2990},{"type":400,"tag":491,"props":3001,"children":3002},{"style":546},[3003],{"type":406,"value":1195},{"type":400,"tag":491,"props":3005,"children":3006},{"style":670},[3007],{"type":406,"value":2628},{"type":400,"tag":491,"props":3009,"children":3010},{"style":561},[3011],{"type":406,"value":2972},{"type":400,"tag":491,"props":3013,"children":3014},{"style":546},[3015],{"type":406,"value":569},{"type":400,"tag":491,"props":3017,"children":3018},{"style":540},[3019],{"type":406,"value":3020},"setw",{"type":400,"tag":491,"props":3022,"children":3023},{"style":546},[3024],{"type":406,"value":707},{"type":400,"tag":491,"props":3026,"children":3027},{"style":832},[3028],{"type":406,"value":3029},"16",{"type":400,"tag":491,"props":3031,"children":3032},{"style":546},[3033],{"type":406,"value":658},{"type":400,"tag":491,"props":3035,"children":3036},{"class":493,"line":530},[3037,3041,3045,3050],{"type":400,"tag":491,"props":3038,"children":3039},{"style":572},[3040],{"type":406,"value":2963},{"type":400,"tag":491,"props":3042,"children":3043},{"style":670},[3044],{"type":406,"value":2610},{"type":400,"tag":491,"props":3046,"children":3047},{"style":832},[3048],{"type":406,"value":3049}," 1",{"type":400,"tag":491,"props":3051,"children":3052},{"style":546},[3053],{"type":406,"value":580},{"type":400,"tag":491,"props":3055,"children":3056},{"class":493,"line":557},[3057,3062,3066,3071,3075],{"type":400,"tag":491,"props":3058,"children":3059},{"style":572},[3060],{"type":406,"value":3061},"ss",{"type":400,"tag":491,"props":3063,"children":3064},{"style":546},[3065],{"type":406,"value":683},{"type":400,"tag":491,"props":3067,"children":3068},{"style":540},[3069],{"type":406,"value":3070},"str",{"type":400,"tag":491,"props":3072,"children":3073},{"style":546},[3074],{"type":406,"value":1987},{"type":400,"tag":491,"props":3076,"children":3077},{"style":1500},[3078],{"type":406,"value":3079}," // result is: \"0000000000000001\"\n",{"type":400,"tag":491,"props":3081,"children":3082},{"class":493,"line":583},[3083,3087,3091,3095,3099,3103,3107,3111,3115,3119,3123,3127,3131,3135,3139,3143,3147],{"type":400,"tag":491,"props":3084,"children":3085},{"style":572},[3086],{"type":406,"value":2963},{"type":400,"tag":491,"props":3088,"children":3089},{"style":670},[3090],{"type":406,"value":2610},{"type":400,"tag":491,"props":3092,"children":3093},{"style":561},[3094],{"type":406,"value":2972},{"type":400,"tag":491,"props":3096,"children":3097},{"style":546},[3098],{"type":406,"value":569},{"type":400,"tag":491,"props":3100,"children":3101},{"style":540},[3102],{"type":406,"value":2981},{"type":400,"tag":491,"props":3104,"children":3105},{"style":546},[3106],{"type":406,"value":707},{"type":400,"tag":491,"props":3108,"children":3109},{"style":504},[3110],{"type":406,"value":2990},{"type":400,"tag":491,"props":3112,"children":3113},{"style":510},[3114],{"type":406,"value":2995},{"type":400,"tag":491,"props":3116,"children":3117},{"style":504},[3118],{"type":406,"value":2990},{"type":400,"tag":491,"props":3120,"children":3121},{"style":546},[3122],{"type":406,"value":1195},{"type":400,"tag":491,"props":3124,"children":3125},{"style":670},[3126],{"type":406,"value":2628},{"type":400,"tag":491,"props":3128,"children":3129},{"style":561},[3130],{"type":406,"value":2972},{"type":400,"tag":491,"props":3132,"children":3133},{"style":546},[3134],{"type":406,"value":569},{"type":400,"tag":491,"props":3136,"children":3137},{"style":540},[3138],{"type":406,"value":3020},{"type":400,"tag":491,"props":3140,"children":3141},{"style":546},[3142],{"type":406,"value":707},{"type":400,"tag":491,"props":3144,"children":3145},{"style":832},[3146],{"type":406,"value":3029},{"type":400,"tag":491,"props":3148,"children":3149},{"style":546},[3150],{"type":406,"value":658},{"type":400,"tag":491,"props":3152,"children":3153},{"class":493,"line":604},[3154,3158,3162,3167],{"type":400,"tag":491,"props":3155,"children":3156},{"style":572},[3157],{"type":406,"value":2963},{"type":400,"tag":491,"props":3159,"children":3160},{"style":670},[3161],{"type":406,"value":2610},{"type":400,"tag":491,"props":3163,"children":3164},{"style":832},[3165],{"type":406,"value":3166}," 1123",{"type":400,"tag":491,"props":3168,"children":3169},{"style":546},[3170],{"type":406,"value":580},{"type":400,"tag":491,"props":3172,"children":3173},{"class":493,"line":661},[3174,3178,3182,3186,3190],{"type":400,"tag":491,"props":3175,"children":3176},{"style":572},[3177],{"type":406,"value":3061},{"type":400,"tag":491,"props":3179,"children":3180},{"style":546},[3181],{"type":406,"value":683},{"type":400,"tag":491,"props":3183,"children":3184},{"style":540},[3185],{"type":406,"value":3070},{"type":400,"tag":491,"props":3187,"children":3188},{"style":546},[3189],{"type":406,"value":1987},{"type":400,"tag":491,"props":3191,"children":3192},{"style":1500},[3193],{"type":406,"value":3194}," // result is: \"0000000000001123\"\n",{"type":400,"tag":1367,"props":3196,"children":3198},{"id":3197},"c-风格的随机数",[3199],{"type":406,"value":3200},"C++ 风格的随机数",{"type":400,"tag":414,"props":3202,"children":3203},{},[3204],{"type":406,"value":3205},"一个有意思的地方时，KDB 代码中随处可见 C 编程风格的源码。但是测试用例中生成随机数确实 C++ 风格的。",{"type":400,"tag":480,"props":3207,"children":3209},{"code":3208,"language":483,"meta":394,"className":484,"style":394},"std::mt19937 generator = std::mt19937();\nstd::uniform_int_distribution\u003Cint> random_dist(0,255);\n// ...\nfor (int i = 0; i \u003C size; i++) {\n  str[i] = static_cast\u003Cchar>(random_dist(generator));\n}\n",[3210],{"type":400,"tag":487,"props":3211,"children":3212},{"__ignoreMap":394},[3213,3250,3305,3313,3381,3444],{"type":400,"tag":491,"props":3214,"children":3215},{"class":493,"line":494},[3216,3220,3224,3229,3233,3237,3241,3246],{"type":400,"tag":491,"props":3217,"children":3218},{"style":561},[3219],{"type":406,"value":2942},{"type":400,"tag":491,"props":3221,"children":3222},{"style":546},[3223],{"type":406,"value":569},{"type":400,"tag":491,"props":3225,"children":3226},{"style":572},[3227],{"type":406,"value":3228},"mt19937 generator ",{"type":400,"tag":491,"props":3230,"children":3231},{"style":670},[3232],{"type":406,"value":673},{"type":400,"tag":491,"props":3234,"children":3235},{"style":561},[3236],{"type":406,"value":2972},{"type":400,"tag":491,"props":3238,"children":3239},{"style":546},[3240],{"type":406,"value":569},{"type":400,"tag":491,"props":3242,"children":3243},{"style":540},[3244],{"type":406,"value":3245},"mt19937",{"type":400,"tag":491,"props":3247,"children":3248},{"style":546},[3249],{"type":406,"value":693},{"type":400,"tag":491,"props":3251,"children":3252},{"class":493,"line":521},[3253,3257,3261,3266,3271,3275,3279,3284,3288,3292,3296,3301],{"type":400,"tag":491,"props":3254,"children":3255},{"style":561},[3256],{"type":406,"value":2942},{"type":400,"tag":491,"props":3258,"children":3259},{"style":546},[3260],{"type":406,"value":569},{"type":400,"tag":491,"props":3262,"children":3263},{"style":561},[3264],{"type":406,"value":3265},"uniform_int_distribution",{"type":400,"tag":491,"props":3267,"children":3268},{"style":546},[3269],{"type":406,"value":3270},"\u003C",{"type":400,"tag":491,"props":3272,"children":3273},{"style":534},[3274],{"type":406,"value":537},{"type":400,"tag":491,"props":3276,"children":3277},{"style":546},[3278],{"type":406,"value":2478},{"type":400,"tag":491,"props":3280,"children":3281},{"style":540},[3282],{"type":406,"value":3283}," random_dist",{"type":400,"tag":491,"props":3285,"children":3286},{"style":546},[3287],{"type":406,"value":628},{"type":400,"tag":491,"props":3289,"children":3290},{"style":832},[3291],{"type":406,"value":2995},{"type":400,"tag":491,"props":3293,"children":3294},{"style":546},[3295],{"type":406,"value":638},{"type":400,"tag":491,"props":3297,"children":3298},{"style":832},[3299],{"type":406,"value":3300},"255",{"type":400,"tag":491,"props":3302,"children":3303},{"style":546},[3304],{"type":406,"value":658},{"type":400,"tag":491,"props":3306,"children":3307},{"class":493,"line":530},[3308],{"type":400,"tag":491,"props":3309,"children":3310},{"style":1500},[3311],{"type":406,"value":3312},"// ...\n",{"type":400,"tag":491,"props":3314,"children":3315},{"class":493,"line":557},[3316,3321,3325,3329,3334,3338,3342,3346,3350,3354,3359,3363,3368,3373,3377],{"type":400,"tag":491,"props":3317,"children":3318},{"style":498},[3319],{"type":406,"value":3320},"for",{"type":400,"tag":491,"props":3322,"children":3323},{"style":546},[3324],{"type":406,"value":707},{"type":400,"tag":491,"props":3326,"children":3327},{"style":534},[3328],{"type":406,"value":537},{"type":400,"tag":491,"props":3330,"children":3331},{"style":572},[3332],{"type":406,"value":3333}," i ",{"type":400,"tag":491,"props":3335,"children":3336},{"style":670},[3337],{"type":406,"value":673},{"type":400,"tag":491,"props":3339,"children":3340},{"style":832},[3341],{"type":406,"value":1324},{"type":400,"tag":491,"props":3343,"children":3344},{"style":546},[3345],{"type":406,"value":2063},{"type":400,"tag":491,"props":3347,"children":3348},{"style":572},[3349],{"type":406,"value":3333},{"type":400,"tag":491,"props":3351,"children":3352},{"style":670},[3353],{"type":406,"value":3270},{"type":400,"tag":491,"props":3355,"children":3356},{"style":572},[3357],{"type":406,"value":3358}," size",{"type":400,"tag":491,"props":3360,"children":3361},{"style":546},[3362],{"type":406,"value":2063},{"type":400,"tag":491,"props":3364,"children":3365},{"style":572},[3366],{"type":406,"value":3367}," i",{"type":400,"tag":491,"props":3369,"children":3370},{"style":670},[3371],{"type":406,"value":3372},"++",{"type":400,"tag":491,"props":3374,"children":3375},{"style":546},[3376],{"type":406,"value":1195},{"type":400,"tag":491,"props":3378,"children":3379},{"style":546},[3380],{"type":406,"value":554},{"type":400,"tag":491,"props":3382,"children":3383},{"class":493,"line":583},[3384,3389,3393,3398,3403,3407,3412,3417,3421,3425,3430,3434,3439],{"type":400,"tag":491,"props":3385,"children":3386},{"style":572},[3387],{"type":406,"value":3388},"  str",{"type":400,"tag":491,"props":3390,"children":3391},{"style":546},[3392],{"type":406,"value":1467},{"type":400,"tag":491,"props":3394,"children":3395},{"style":751},[3396],{"type":406,"value":3397},"i",{"type":400,"tag":491,"props":3399,"children":3400},{"style":546},[3401],{"type":406,"value":3402},"]",{"type":400,"tag":491,"props":3404,"children":3405},{"style":670},[3406],{"type":406,"value":2157},{"type":400,"tag":491,"props":3408,"children":3409},{"style":670},[3410],{"type":406,"value":3411}," static_cast\u003C",{"type":400,"tag":491,"props":3413,"children":3414},{"style":534},[3415],{"type":406,"value":3416},"char",{"type":400,"tag":491,"props":3418,"children":3419},{"style":670},[3420],{"type":406,"value":2478},{"type":400,"tag":491,"props":3422,"children":3423},{"style":546},[3424],{"type":406,"value":628},{"type":400,"tag":491,"props":3426,"children":3427},{"style":540},[3428],{"type":406,"value":3429},"random_dist",{"type":400,"tag":491,"props":3431,"children":3432},{"style":546},[3433],{"type":406,"value":628},{"type":400,"tag":491,"props":3435,"children":3436},{"style":751},[3437],{"type":406,"value":3438},"generator",{"type":400,"tag":491,"props":3440,"children":3441},{"style":546},[3442],{"type":406,"value":3443},"));\n",{"type":400,"tag":491,"props":3445,"children":3446},{"class":493,"line":604},[3447],{"type":400,"tag":491,"props":3448,"children":3449},{"style":546},[3450],{"type":406,"value":1337},{"type":400,"tag":408,"props":3452,"children":3454},{"id":3453},"接口层",[3455],{"type":406,"value":3453},{"type":400,"tag":414,"props":3457,"children":3458},{},[3459,3461,3467],{"type":406,"value":3460},"接口的声明位于 interface/kingdb.h，实现则是 interface/kingdb.cc。KingDB 类给 Database 和 Snapshot 定义了要求实现的 Get、Put、Delete、NewIterater、Open、Close、Flush、Compact、NewMultipartReader 接口。KDB 有自己的数据传输格式 ByteArray，诸如 Get、Put 这些接口在 KingDB 类中对应方法得到了重载，以实现通过 std::string 来传递键、值或者两者，可视为为接受 ByteArray 的方法的包装。所有数据库操作方法都返回 Status 对象，相关异常部分的简介见",{"type":400,"tag":425,"props":3462,"children":3464},{"href":3463},"#%E5%BC%82%E5%B8%B8%E4%B8%8E%E6%97%A5%E5%BF%97",[3465],{"type":406,"value":3466},"异常与日志",{"type":406,"value":3468},"小节。",{"type":400,"tag":414,"props":3470,"children":3471},{},[3472],{"type":406,"value":3473},"重载方法的实现示例如下，即先把 std::string 转回 ByteArray 再调用子类（Database 或 Snapshot）的实现。",{"type":400,"tag":480,"props":3475,"children":3477},{"code":3476,"language":483,"meta":394,"className":484,"style":394},"virtual Status Put(WriteOptions& write_options, const std::string& key, const std::string& chunk) {\n  ByteArray byte_array_key = NewDeepCopyByteArray(key.c_str(), key.size());\n  ByteArray byte_array_chunk = NewDeepCopyByteArray(chunk.c_str(), chunk.size());\n  return Put(write_options, byte_array_key, byte_array_chunk);\n}\n",[3478],{"type":400,"tag":487,"props":3479,"children":3480},{"__ignoreMap":394},[3481,3584,3640,3693,3734],{"type":400,"tag":491,"props":3482,"children":3483},{"class":493,"line":494},[3484,3489,3494,3499,3503,3508,3512,3517,3521,3525,3529,3533,3538,3542,3547,3551,3555,3559,3563,3567,3571,3576,3580],{"type":400,"tag":491,"props":3485,"children":3486},{"style":1998},[3487],{"type":406,"value":3488},"virtual",{"type":400,"tag":491,"props":3490,"children":3491},{"style":561},[3492],{"type":406,"value":3493}," Status",{"type":400,"tag":491,"props":3495,"children":3496},{"style":540},[3497],{"type":406,"value":3498}," Put",{"type":400,"tag":491,"props":3500,"children":3501},{"style":546},[3502],{"type":406,"value":628},{"type":400,"tag":491,"props":3504,"children":3505},{"style":561},[3506],{"type":406,"value":3507},"WriteOptions",{"type":400,"tag":491,"props":3509,"children":3510},{"style":1998},[3511],{"type":406,"value":2496},{"type":400,"tag":491,"props":3513,"children":3514},{"style":1407},[3515],{"type":406,"value":3516}," write_options",{"type":400,"tag":491,"props":3518,"children":3519},{"style":546},[3520],{"type":406,"value":638},{"type":400,"tag":491,"props":3522,"children":3523},{"style":1998},[3524],{"type":406,"value":2532},{"type":400,"tag":491,"props":3526,"children":3527},{"style":561},[3528],{"type":406,"value":2972},{"type":400,"tag":491,"props":3530,"children":3531},{"style":546},[3532],{"type":406,"value":569},{"type":400,"tag":491,"props":3534,"children":3535},{"style":561},[3536],{"type":406,"value":3537},"string",{"type":400,"tag":491,"props":3539,"children":3540},{"style":1998},[3541],{"type":406,"value":2496},{"type":400,"tag":491,"props":3543,"children":3544},{"style":1407},[3545],{"type":406,"value":3546}," key",{"type":400,"tag":491,"props":3548,"children":3549},{"style":546},[3550],{"type":406,"value":638},{"type":400,"tag":491,"props":3552,"children":3553},{"style":1998},[3554],{"type":406,"value":2532},{"type":400,"tag":491,"props":3556,"children":3557},{"style":561},[3558],{"type":406,"value":2972},{"type":400,"tag":491,"props":3560,"children":3561},{"style":546},[3562],{"type":406,"value":569},{"type":400,"tag":491,"props":3564,"children":3565},{"style":561},[3566],{"type":406,"value":3537},{"type":400,"tag":491,"props":3568,"children":3569},{"style":1998},[3570],{"type":406,"value":2496},{"type":400,"tag":491,"props":3572,"children":3573},{"style":1407},[3574],{"type":406,"value":3575}," chunk",{"type":400,"tag":491,"props":3577,"children":3578},{"style":546},[3579],{"type":406,"value":1195},{"type":400,"tag":491,"props":3581,"children":3582},{"style":546},[3583],{"type":406,"value":554},{"type":400,"tag":491,"props":3585,"children":3586},{"class":493,"line":521},[3587,3592,3596,3601,3605,3610,3614,3618,3623,3627,3631,3636],{"type":400,"tag":491,"props":3588,"children":3589},{"style":572},[3590],{"type":406,"value":3591},"  ByteArray byte_array_key ",{"type":400,"tag":491,"props":3593,"children":3594},{"style":670},[3595],{"type":406,"value":673},{"type":400,"tag":491,"props":3597,"children":3598},{"style":540},[3599],{"type":406,"value":3600}," NewDeepCopyByteArray",{"type":400,"tag":491,"props":3602,"children":3603},{"style":546},[3604],{"type":406,"value":628},{"type":400,"tag":491,"props":3606,"children":3607},{"style":572},[3608],{"type":406,"value":3609},"key",{"type":400,"tag":491,"props":3611,"children":3612},{"style":546},[3613],{"type":406,"value":683},{"type":400,"tag":491,"props":3615,"children":3616},{"style":540},[3617],{"type":406,"value":811},{"type":400,"tag":491,"props":3619,"children":3620},{"style":546},[3621],{"type":406,"value":3622},"(),",{"type":400,"tag":491,"props":3624,"children":3625},{"style":572},[3626],{"type":406,"value":3546},{"type":400,"tag":491,"props":3628,"children":3629},{"style":546},[3630],{"type":406,"value":683},{"type":400,"tag":491,"props":3632,"children":3633},{"style":540},[3634],{"type":406,"value":3635},"size",{"type":400,"tag":491,"props":3637,"children":3638},{"style":546},[3639],{"type":406,"value":816},{"type":400,"tag":491,"props":3641,"children":3642},{"class":493,"line":530},[3643,3648,3652,3656,3660,3665,3669,3673,3677,3681,3685,3689],{"type":400,"tag":491,"props":3644,"children":3645},{"style":572},[3646],{"type":406,"value":3647},"  ByteArray byte_array_chunk ",{"type":400,"tag":491,"props":3649,"children":3650},{"style":670},[3651],{"type":406,"value":673},{"type":400,"tag":491,"props":3653,"children":3654},{"style":540},[3655],{"type":406,"value":3600},{"type":400,"tag":491,"props":3657,"children":3658},{"style":546},[3659],{"type":406,"value":628},{"type":400,"tag":491,"props":3661,"children":3662},{"style":572},[3663],{"type":406,"value":3664},"chunk",{"type":400,"tag":491,"props":3666,"children":3667},{"style":546},[3668],{"type":406,"value":683},{"type":400,"tag":491,"props":3670,"children":3671},{"style":540},[3672],{"type":406,"value":811},{"type":400,"tag":491,"props":3674,"children":3675},{"style":546},[3676],{"type":406,"value":3622},{"type":400,"tag":491,"props":3678,"children":3679},{"style":572},[3680],{"type":406,"value":3575},{"type":400,"tag":491,"props":3682,"children":3683},{"style":546},[3684],{"type":406,"value":683},{"type":400,"tag":491,"props":3686,"children":3687},{"style":540},[3688],{"type":406,"value":3635},{"type":400,"tag":491,"props":3690,"children":3691},{"style":546},[3692],{"type":406,"value":816},{"type":400,"tag":491,"props":3694,"children":3695},{"class":493,"line":557},[3696,3700,3704,3708,3712,3716,3721,3725,3730],{"type":400,"tag":491,"props":3697,"children":3698},{"style":498},[3699],{"type":406,"value":1319},{"type":400,"tag":491,"props":3701,"children":3702},{"style":540},[3703],{"type":406,"value":3498},{"type":400,"tag":491,"props":3705,"children":3706},{"style":546},[3707],{"type":406,"value":628},{"type":400,"tag":491,"props":3709,"children":3710},{"style":572},[3711],{"type":406,"value":1003},{"type":400,"tag":491,"props":3713,"children":3714},{"style":546},[3715],{"type":406,"value":638},{"type":400,"tag":491,"props":3717,"children":3718},{"style":572},[3719],{"type":406,"value":3720}," byte_array_key",{"type":400,"tag":491,"props":3722,"children":3723},{"style":546},[3724],{"type":406,"value":638},{"type":400,"tag":491,"props":3726,"children":3727},{"style":572},[3728],{"type":406,"value":3729}," byte_array_chunk",{"type":400,"tag":491,"props":3731,"children":3732},{"style":546},[3733],{"type":406,"value":658},{"type":400,"tag":491,"props":3735,"children":3736},{"class":493,"line":583},[3737],{"type":400,"tag":491,"props":3738,"children":3739},{"style":546},[3740],{"type":406,"value":1337},{"type":400,"tag":1367,"props":3742,"children":3744},{"id":3743},"数据库开关",[3745],{"type":406,"value":3743},{"type":400,"tag":414,"props":3747,"children":3748},{},[3749],{"type":406,"value":3750},"数据库的开启与关闭，分别对应 Database 类的 Open 和 Close 方法。开启时，通过 stat 库函数找到数据库路径以及配置文件，使用 open 库函数获取其文件描述符。配置文件须先用 flock 锁住，使用 mmap 映射后再读取；如果没有那么分情况写入。之后，创建好 EventManager、WriteBuffer 和 StorageEngine 的实例，就完成了。关闭时过程类似，锁定住配置文件后再关闭，同时删除以上创建的实例。可以发现，资源申请全放在了 Open 中，而资源的销毁放在了 Close 中，而 Database 类析构时会自动调用 Close，所以这是一个类似 RAII 的资源管理过程。",{"type":400,"tag":480,"props":3752,"children":3754},{"code":3753,"language":483,"meta":394,"className":484,"style":394},"class Database: public KingDB {\n  virtual ~Database() { Close(); }\n  virtual Status Open() override {\n    std::string filepath_dboptions = DatabaseOptions::GetPath(dbname_);\n    fd_dboptions_ = open(filepath_dboptions.c_str(), O_RDONLY, 0644);\n    flock(fd_dboptions_, LOCK_EX | LOCK_NB);\n    Mmap mmap(filepath_dboptions, info.st_size);\n    Status status_dboptions = DatabaseOptionEncoder::DecodeFrom(mmap.datafile(), mmap.filesize(), &db_options_candidate);\n    // ...\n    em_ = new EventManager();\n    wb_ = new WriteBuffer(db_options_, em_);\n    se_ = new StorageEngine(db_options_, em_, dbname_);\n    return Status::OK(); \n  }\n  virtual void Close() override {\n    flock(fd_dboptions_, LOCK_UN);\n    close(fd_dboptions_);\n    wb_->Close();\n    se_->Close();\n    delete wb_;\n    delete se_;\n    delete em_;\n  }\n}\n",[3755],{"type":400,"tag":487,"props":3756,"children":3757},{"__ignoreMap":394},[3758,3787,3822,3851,3899,3960,4000,4043,4121,4129,4155,4198,4248,4276,4283,4310,4338,4358,4380,4400,4417,4433,4448,4455],{"type":400,"tag":491,"props":3759,"children":3760},{"class":493,"line":494},[3761,3765,3770,3774,3778,3783],{"type":400,"tag":491,"props":3762,"children":3763},{"style":534},[3764],{"type":406,"value":1911},{"type":400,"tag":491,"props":3766,"children":3767},{"style":561},[3768],{"type":406,"value":3769}," Database",{"type":400,"tag":491,"props":3771,"children":3772},{"style":546},[3773],{"type":406,"value":1596},{"type":400,"tag":491,"props":3775,"children":3776},{"style":534},[3777],{"type":406,"value":1960},{"type":400,"tag":491,"props":3779,"children":3780},{"style":561},[3781],{"type":406,"value":3782}," KingDB",{"type":400,"tag":491,"props":3784,"children":3785},{"style":546},[3786],{"type":406,"value":554},{"type":400,"tag":491,"props":3788,"children":3789},{"class":493,"line":521},[3790,3795,3800,3804,3808,3813,3817],{"type":400,"tag":491,"props":3791,"children":3792},{"style":1998},[3793],{"type":406,"value":3794},"  virtual",{"type":400,"tag":491,"props":3796,"children":3797},{"style":540},[3798],{"type":406,"value":3799}," ~Database",{"type":400,"tag":491,"props":3801,"children":3802},{"style":546},[3803],{"type":406,"value":549},{"type":400,"tag":491,"props":3805,"children":3806},{"style":546},[3807],{"type":406,"value":2020},{"type":400,"tag":491,"props":3809,"children":3810},{"style":540},[3811],{"type":406,"value":3812}," Close",{"type":400,"tag":491,"props":3814,"children":3815},{"style":546},[3816],{"type":406,"value":1987},{"type":400,"tag":491,"props":3818,"children":3819},{"style":546},[3820],{"type":406,"value":3821}," }\n",{"type":400,"tag":491,"props":3823,"children":3824},{"class":493,"line":530},[3825,3829,3833,3838,3842,3847],{"type":400,"tag":491,"props":3826,"children":3827},{"style":1998},[3828],{"type":406,"value":3794},{"type":400,"tag":491,"props":3830,"children":3831},{"style":561},[3832],{"type":406,"value":3493},{"type":400,"tag":491,"props":3834,"children":3835},{"style":540},[3836],{"type":406,"value":3837}," Open",{"type":400,"tag":491,"props":3839,"children":3840},{"style":546},[3841],{"type":406,"value":549},{"type":400,"tag":491,"props":3843,"children":3844},{"style":1998},[3845],{"type":406,"value":3846}," override",{"type":400,"tag":491,"props":3848,"children":3849},{"style":546},[3850],{"type":406,"value":554},{"type":400,"tag":491,"props":3852,"children":3853},{"class":493,"line":557},[3854,3859,3863,3868,3872,3877,3881,3886,3890,3895],{"type":400,"tag":491,"props":3855,"children":3856},{"style":561},[3857],{"type":406,"value":3858},"    std",{"type":400,"tag":491,"props":3860,"children":3861},{"style":546},[3862],{"type":406,"value":569},{"type":400,"tag":491,"props":3864,"children":3865},{"style":751},[3866],{"type":406,"value":3867},"string filepath_dboptions ",{"type":400,"tag":491,"props":3869,"children":3870},{"style":670},[3871],{"type":406,"value":673},{"type":400,"tag":491,"props":3873,"children":3874},{"style":561},[3875],{"type":406,"value":3876}," DatabaseOptions",{"type":400,"tag":491,"props":3878,"children":3879},{"style":546},[3880],{"type":406,"value":569},{"type":400,"tag":491,"props":3882,"children":3883},{"style":540},[3884],{"type":406,"value":3885},"GetPath",{"type":400,"tag":491,"props":3887,"children":3888},{"style":546},[3889],{"type":406,"value":628},{"type":400,"tag":491,"props":3891,"children":3892},{"style":751},[3893],{"type":406,"value":3894},"dbname_",{"type":400,"tag":491,"props":3896,"children":3897},{"style":546},[3898],{"type":406,"value":658},{"type":400,"tag":491,"props":3900,"children":3901},{"class":493,"line":583},[3902,3907,3911,3916,3920,3925,3929,3933,3937,3942,3946,3951,3956],{"type":400,"tag":491,"props":3903,"children":3904},{"style":751},[3905],{"type":406,"value":3906},"    fd_dboptions_ ",{"type":400,"tag":491,"props":3908,"children":3909},{"style":670},[3910],{"type":406,"value":673},{"type":400,"tag":491,"props":3912,"children":3913},{"style":540},[3914],{"type":406,"value":3915}," open",{"type":400,"tag":491,"props":3917,"children":3918},{"style":546},[3919],{"type":406,"value":628},{"type":400,"tag":491,"props":3921,"children":3922},{"style":572},[3923],{"type":406,"value":3924},"filepath_dboptions",{"type":400,"tag":491,"props":3926,"children":3927},{"style":546},[3928],{"type":406,"value":683},{"type":400,"tag":491,"props":3930,"children":3931},{"style":540},[3932],{"type":406,"value":811},{"type":400,"tag":491,"props":3934,"children":3935},{"style":546},[3936],{"type":406,"value":3622},{"type":400,"tag":491,"props":3938,"children":3939},{"style":751},[3940],{"type":406,"value":3941}," O_RDONLY",{"type":400,"tag":491,"props":3943,"children":3944},{"style":546},[3945],{"type":406,"value":638},{"type":400,"tag":491,"props":3947,"children":3949},{"style":3948},"--shiki-light:#F76D47;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[3950],{"type":406,"value":1324},{"type":400,"tag":491,"props":3952,"children":3953},{"style":832},[3954],{"type":406,"value":3955},"644",{"type":400,"tag":491,"props":3957,"children":3958},{"style":546},[3959],{"type":406,"value":658},{"type":400,"tag":491,"props":3961,"children":3962},{"class":493,"line":604},[3963,3968,3972,3977,3981,3986,3991,3996],{"type":400,"tag":491,"props":3964,"children":3965},{"style":540},[3966],{"type":406,"value":3967},"    flock",{"type":400,"tag":491,"props":3969,"children":3970},{"style":546},[3971],{"type":406,"value":628},{"type":400,"tag":491,"props":3973,"children":3974},{"style":751},[3975],{"type":406,"value":3976},"fd_dboptions_",{"type":400,"tag":491,"props":3978,"children":3979},{"style":546},[3980],{"type":406,"value":638},{"type":400,"tag":491,"props":3982,"children":3983},{"style":751},[3984],{"type":406,"value":3985}," LOCK_EX ",{"type":400,"tag":491,"props":3987,"children":3988},{"style":670},[3989],{"type":406,"value":3990},"|",{"type":400,"tag":491,"props":3992,"children":3993},{"style":751},[3994],{"type":406,"value":3995}," LOCK_NB",{"type":400,"tag":491,"props":3997,"children":3998},{"style":546},[3999],{"type":406,"value":658},{"type":400,"tag":491,"props":4001,"children":4002},{"class":493,"line":661},[4003,4008,4013,4017,4021,4025,4030,4034,4039],{"type":400,"tag":491,"props":4004,"children":4005},{"style":751},[4006],{"type":406,"value":4007},"    Mmap ",{"type":400,"tag":491,"props":4009,"children":4010},{"style":540},[4011],{"type":406,"value":4012},"mmap",{"type":400,"tag":491,"props":4014,"children":4015},{"style":546},[4016],{"type":406,"value":628},{"type":400,"tag":491,"props":4018,"children":4019},{"style":751},[4020],{"type":406,"value":3924},{"type":400,"tag":491,"props":4022,"children":4023},{"style":546},[4024],{"type":406,"value":638},{"type":400,"tag":491,"props":4026,"children":4027},{"style":572},[4028],{"type":406,"value":4029}," info",{"type":400,"tag":491,"props":4031,"children":4032},{"style":546},[4033],{"type":406,"value":683},{"type":400,"tag":491,"props":4035,"children":4036},{"style":572},[4037],{"type":406,"value":4038},"st_size",{"type":400,"tag":491,"props":4040,"children":4041},{"style":546},[4042],{"type":406,"value":658},{"type":400,"tag":491,"props":4044,"children":4045},{"class":493,"line":696},[4046,4051,4055,4060,4064,4069,4073,4077,4081,4086,4090,4095,4099,4104,4108,4112,4117],{"type":400,"tag":491,"props":4047,"children":4048},{"style":751},[4049],{"type":406,"value":4050},"    Status status_dboptions ",{"type":400,"tag":491,"props":4052,"children":4053},{"style":670},[4054],{"type":406,"value":673},{"type":400,"tag":491,"props":4056,"children":4057},{"style":561},[4058],{"type":406,"value":4059}," DatabaseOptionEncoder",{"type":400,"tag":491,"props":4061,"children":4062},{"style":546},[4063],{"type":406,"value":569},{"type":400,"tag":491,"props":4065,"children":4066},{"style":540},[4067],{"type":406,"value":4068},"DecodeFrom",{"type":400,"tag":491,"props":4070,"children":4071},{"style":546},[4072],{"type":406,"value":628},{"type":400,"tag":491,"props":4074,"children":4075},{"style":572},[4076],{"type":406,"value":4012},{"type":400,"tag":491,"props":4078,"children":4079},{"style":546},[4080],{"type":406,"value":683},{"type":400,"tag":491,"props":4082,"children":4083},{"style":540},[4084],{"type":406,"value":4085},"datafile",{"type":400,"tag":491,"props":4087,"children":4088},{"style":546},[4089],{"type":406,"value":3622},{"type":400,"tag":491,"props":4091,"children":4092},{"style":572},[4093],{"type":406,"value":4094}," mmap",{"type":400,"tag":491,"props":4096,"children":4097},{"style":546},[4098],{"type":406,"value":683},{"type":400,"tag":491,"props":4100,"children":4101},{"style":540},[4102],{"type":406,"value":4103},"filesize",{"type":400,"tag":491,"props":4105,"children":4106},{"style":546},[4107],{"type":406,"value":3622},{"type":400,"tag":491,"props":4109,"children":4110},{"style":670},[4111],{"type":406,"value":1126},{"type":400,"tag":491,"props":4113,"children":4114},{"style":751},[4115],{"type":406,"value":4116},"db_options_candidate",{"type":400,"tag":491,"props":4118,"children":4119},{"style":546},[4120],{"type":406,"value":658},{"type":400,"tag":491,"props":4122,"children":4123},{"class":493,"line":738},[4124],{"type":400,"tag":491,"props":4125,"children":4126},{"style":1500},[4127],{"type":406,"value":4128},"    // ...\n",{"type":400,"tag":491,"props":4130,"children":4131},{"class":493,"line":819},[4132,4137,4141,4146,4151],{"type":400,"tag":491,"props":4133,"children":4134},{"style":751},[4135],{"type":406,"value":4136},"    em_ ",{"type":400,"tag":491,"props":4138,"children":4139},{"style":670},[4140],{"type":406,"value":673},{"type":400,"tag":491,"props":4142,"children":4143},{"style":670},[4144],{"type":406,"value":4145}," new",{"type":400,"tag":491,"props":4147,"children":4148},{"style":540},[4149],{"type":406,"value":4150}," EventManager",{"type":400,"tag":491,"props":4152,"children":4153},{"style":546},[4154],{"type":406,"value":693},{"type":400,"tag":491,"props":4156,"children":4157},{"class":493,"line":842},[4158,4163,4167,4171,4176,4180,4185,4189,4194],{"type":400,"tag":491,"props":4159,"children":4160},{"style":751},[4161],{"type":406,"value":4162},"    wb_ ",{"type":400,"tag":491,"props":4164,"children":4165},{"style":670},[4166],{"type":406,"value":673},{"type":400,"tag":491,"props":4168,"children":4169},{"style":670},[4170],{"type":406,"value":4145},{"type":400,"tag":491,"props":4172,"children":4173},{"style":540},[4174],{"type":406,"value":4175}," WriteBuffer",{"type":400,"tag":491,"props":4177,"children":4178},{"style":546},[4179],{"type":406,"value":628},{"type":400,"tag":491,"props":4181,"children":4182},{"style":751},[4183],{"type":406,"value":4184},"db_options_",{"type":400,"tag":491,"props":4186,"children":4187},{"style":546},[4188],{"type":406,"value":638},{"type":400,"tag":491,"props":4190,"children":4191},{"style":751},[4192],{"type":406,"value":4193}," em_",{"type":400,"tag":491,"props":4195,"children":4196},{"style":546},[4197],{"type":406,"value":658},{"type":400,"tag":491,"props":4199,"children":4200},{"class":493,"line":851},[4201,4206,4210,4214,4219,4223,4227,4231,4235,4239,4244],{"type":400,"tag":491,"props":4202,"children":4203},{"style":751},[4204],{"type":406,"value":4205},"    se_ ",{"type":400,"tag":491,"props":4207,"children":4208},{"style":670},[4209],{"type":406,"value":673},{"type":400,"tag":491,"props":4211,"children":4212},{"style":670},[4213],{"type":406,"value":4145},{"type":400,"tag":491,"props":4215,"children":4216},{"style":540},[4217],{"type":406,"value":4218}," StorageEngine",{"type":400,"tag":491,"props":4220,"children":4221},{"style":546},[4222],{"type":406,"value":628},{"type":400,"tag":491,"props":4224,"children":4225},{"style":751},[4226],{"type":406,"value":4184},{"type":400,"tag":491,"props":4228,"children":4229},{"style":546},[4230],{"type":406,"value":638},{"type":400,"tag":491,"props":4232,"children":4233},{"style":751},[4234],{"type":406,"value":4193},{"type":400,"tag":491,"props":4236,"children":4237},{"style":546},[4238],{"type":406,"value":638},{"type":400,"tag":491,"props":4240,"children":4241},{"style":751},[4242],{"type":406,"value":4243}," dbname_",{"type":400,"tag":491,"props":4245,"children":4246},{"style":546},[4247],{"type":406,"value":658},{"type":400,"tag":491,"props":4249,"children":4250},{"class":493,"line":859},[4251,4255,4259,4263,4268,4272],{"type":400,"tag":491,"props":4252,"children":4253},{"style":498},[4254],{"type":406,"value":2731},{"type":400,"tag":491,"props":4256,"children":4257},{"style":561},[4258],{"type":406,"value":3493},{"type":400,"tag":491,"props":4260,"children":4261},{"style":546},[4262],{"type":406,"value":569},{"type":400,"tag":491,"props":4264,"children":4265},{"style":540},[4266],{"type":406,"value":4267},"OK",{"type":400,"tag":491,"props":4269,"children":4270},{"style":546},[4271],{"type":406,"value":1987},{"type":400,"tag":491,"props":4273,"children":4274},{"style":751},[4275],{"type":406,"value":1239},{"type":400,"tag":491,"props":4277,"children":4278},{"class":493,"line":902},[4279],{"type":400,"tag":491,"props":4280,"children":4281},{"style":546},[4282],{"type":406,"value":848},{"type":400,"tag":491,"props":4284,"children":4285},{"class":493,"line":943},[4286,4290,4294,4298,4302,4306],{"type":400,"tag":491,"props":4287,"children":4288},{"style":1998},[4289],{"type":406,"value":3794},{"type":400,"tag":491,"props":4291,"children":4292},{"style":534},[4293],{"type":406,"value":2006},{"type":400,"tag":491,"props":4295,"children":4296},{"style":540},[4297],{"type":406,"value":3812},{"type":400,"tag":491,"props":4299,"children":4300},{"style":546},[4301],{"type":406,"value":549},{"type":400,"tag":491,"props":4303,"children":4304},{"style":1998},[4305],{"type":406,"value":3846},{"type":400,"tag":491,"props":4307,"children":4308},{"style":546},[4309],{"type":406,"value":554},{"type":400,"tag":491,"props":4311,"children":4312},{"class":493,"line":951},[4313,4317,4321,4325,4329,4334],{"type":400,"tag":491,"props":4314,"children":4315},{"style":540},[4316],{"type":406,"value":3967},{"type":400,"tag":491,"props":4318,"children":4319},{"style":546},[4320],{"type":406,"value":628},{"type":400,"tag":491,"props":4322,"children":4323},{"style":751},[4324],{"type":406,"value":3976},{"type":400,"tag":491,"props":4326,"children":4327},{"style":546},[4328],{"type":406,"value":638},{"type":400,"tag":491,"props":4330,"children":4331},{"style":751},[4332],{"type":406,"value":4333}," LOCK_UN",{"type":400,"tag":491,"props":4335,"children":4336},{"style":546},[4337],{"type":406,"value":658},{"type":400,"tag":491,"props":4339,"children":4340},{"class":493,"line":972},[4341,4346,4350,4354],{"type":400,"tag":491,"props":4342,"children":4343},{"style":540},[4344],{"type":406,"value":4345},"    close",{"type":400,"tag":491,"props":4347,"children":4348},{"style":546},[4349],{"type":406,"value":628},{"type":400,"tag":491,"props":4351,"children":4352},{"style":751},[4353],{"type":406,"value":3976},{"type":400,"tag":491,"props":4355,"children":4356},{"style":546},[4357],{"type":406,"value":658},{"type":400,"tag":491,"props":4359,"children":4360},{"class":493,"line":1028},[4361,4366,4371,4376],{"type":400,"tag":491,"props":4362,"children":4363},{"style":572},[4364],{"type":406,"value":4365},"    wb_",{"type":400,"tag":491,"props":4367,"children":4368},{"style":546},[4369],{"type":406,"value":4370},"->",{"type":400,"tag":491,"props":4372,"children":4373},{"style":540},[4374],{"type":406,"value":4375},"Close",{"type":400,"tag":491,"props":4377,"children":4378},{"style":546},[4379],{"type":406,"value":693},{"type":400,"tag":491,"props":4381,"children":4382},{"class":493,"line":1036},[4383,4388,4392,4396],{"type":400,"tag":491,"props":4384,"children":4385},{"style":572},[4386],{"type":406,"value":4387},"    se_",{"type":400,"tag":491,"props":4389,"children":4390},{"style":546},[4391],{"type":406,"value":4370},{"type":400,"tag":491,"props":4393,"children":4394},{"style":540},[4395],{"type":406,"value":4375},{"type":400,"tag":491,"props":4397,"children":4398},{"style":546},[4399],{"type":406,"value":693},{"type":400,"tag":491,"props":4401,"children":4402},{"class":493,"line":1057},[4403,4408,4413],{"type":400,"tag":491,"props":4404,"children":4405},{"style":670},[4406],{"type":406,"value":4407},"    delete",{"type":400,"tag":491,"props":4409,"children":4410},{"style":751},[4411],{"type":406,"value":4412}," wb_",{"type":400,"tag":491,"props":4414,"children":4415},{"style":546},[4416],{"type":406,"value":580},{"type":400,"tag":491,"props":4418,"children":4419},{"class":493,"line":1078},[4420,4424,4429],{"type":400,"tag":491,"props":4421,"children":4422},{"style":670},[4423],{"type":406,"value":4407},{"type":400,"tag":491,"props":4425,"children":4426},{"style":751},[4427],{"type":406,"value":4428}," se_",{"type":400,"tag":491,"props":4430,"children":4431},{"style":546},[4432],{"type":406,"value":580},{"type":400,"tag":491,"props":4434,"children":4435},{"class":493,"line":1138},[4436,4440,4444],{"type":400,"tag":491,"props":4437,"children":4438},{"style":670},[4439],{"type":406,"value":4407},{"type":400,"tag":491,"props":4441,"children":4442},{"style":751},[4443],{"type":406,"value":4193},{"type":400,"tag":491,"props":4445,"children":4446},{"style":546},[4447],{"type":406,"value":580},{"type":400,"tag":491,"props":4449,"children":4450},{"class":493,"line":1202},[4451],{"type":400,"tag":491,"props":4452,"children":4453},{"style":546},[4454],{"type":406,"value":848},{"type":400,"tag":491,"props":4456,"children":4457},{"class":493,"line":1242},[4458],{"type":400,"tag":491,"props":4459,"children":4460},{"style":546},[4461],{"type":406,"value":1337},{"type":400,"tag":414,"props":4463,"children":4464},{},[4465],{"type":406,"value":4466},"因为数据库不能同时关闭或是开启，所以 Open 以及 Close 中都使用了 std::unique_lock 进行锁定。",{"type":400,"tag":480,"props":4468,"children":4470},{"code":4469,"language":483,"meta":394,"className":484,"style":394},"virtual Status Open() override {\n  std::unique_lock\u003Cstd::mutex> lock(mutex_close_);\n}\nvirtual void Close() override {\n  std::unique_lock\u003Cstd::mutex> lock(mutex_close_);\n}\n",[4471],{"type":400,"tag":487,"props":4472,"children":4473},{"__ignoreMap":394},[4474,4501,4556,4563,4590,4641],{"type":400,"tag":491,"props":4475,"children":4476},{"class":493,"line":494},[4477,4481,4485,4489,4493,4497],{"type":400,"tag":491,"props":4478,"children":4479},{"style":1998},[4480],{"type":406,"value":3488},{"type":400,"tag":491,"props":4482,"children":4483},{"style":561},[4484],{"type":406,"value":3493},{"type":400,"tag":491,"props":4486,"children":4487},{"style":540},[4488],{"type":406,"value":3837},{"type":400,"tag":491,"props":4490,"children":4491},{"style":546},[4492],{"type":406,"value":549},{"type":400,"tag":491,"props":4494,"children":4495},{"style":1998},[4496],{"type":406,"value":3846},{"type":400,"tag":491,"props":4498,"children":4499},{"style":546},[4500],{"type":406,"value":554},{"type":400,"tag":491,"props":4502,"children":4503},{"class":493,"line":521},[4504,4508,4512,4517,4521,4525,4529,4534,4538,4543,4547,4552],{"type":400,"tag":491,"props":4505,"children":4506},{"style":561},[4507],{"type":406,"value":865},{"type":400,"tag":491,"props":4509,"children":4510},{"style":546},[4511],{"type":406,"value":569},{"type":400,"tag":491,"props":4513,"children":4514},{"style":572},[4515],{"type":406,"value":4516},"unique_lock",{"type":400,"tag":491,"props":4518,"children":4519},{"style":670},[4520],{"type":406,"value":3270},{"type":400,"tag":491,"props":4522,"children":4523},{"style":561},[4524],{"type":406,"value":2942},{"type":400,"tag":491,"props":4526,"children":4527},{"style":546},[4528],{"type":406,"value":569},{"type":400,"tag":491,"props":4530,"children":4531},{"style":572},[4532],{"type":406,"value":4533},"mutex",{"type":400,"tag":491,"props":4535,"children":4536},{"style":670},[4537],{"type":406,"value":2478},{"type":400,"tag":491,"props":4539,"children":4540},{"style":540},[4541],{"type":406,"value":4542}," lock",{"type":400,"tag":491,"props":4544,"children":4545},{"style":546},[4546],{"type":406,"value":628},{"type":400,"tag":491,"props":4548,"children":4549},{"style":572},[4550],{"type":406,"value":4551},"mutex_close_",{"type":400,"tag":491,"props":4553,"children":4554},{"style":546},[4555],{"type":406,"value":658},{"type":400,"tag":491,"props":4557,"children":4558},{"class":493,"line":530},[4559],{"type":400,"tag":491,"props":4560,"children":4561},{"style":546},[4562],{"type":406,"value":1337},{"type":400,"tag":491,"props":4564,"children":4565},{"class":493,"line":557},[4566,4570,4574,4578,4582,4586],{"type":400,"tag":491,"props":4567,"children":4568},{"style":1998},[4569],{"type":406,"value":3488},{"type":400,"tag":491,"props":4571,"children":4572},{"style":534},[4573],{"type":406,"value":2006},{"type":400,"tag":491,"props":4575,"children":4576},{"style":540},[4577],{"type":406,"value":3812},{"type":400,"tag":491,"props":4579,"children":4580},{"style":546},[4581],{"type":406,"value":549},{"type":400,"tag":491,"props":4583,"children":4584},{"style":1998},[4585],{"type":406,"value":3846},{"type":400,"tag":491,"props":4587,"children":4588},{"style":546},[4589],{"type":406,"value":554},{"type":400,"tag":491,"props":4591,"children":4592},{"class":493,"line":583},[4593,4597,4601,4605,4609,4613,4617,4621,4625,4629,4633,4637],{"type":400,"tag":491,"props":4594,"children":4595},{"style":561},[4596],{"type":406,"value":865},{"type":400,"tag":491,"props":4598,"children":4599},{"style":546},[4600],{"type":406,"value":569},{"type":400,"tag":491,"props":4602,"children":4603},{"style":572},[4604],{"type":406,"value":4516},{"type":400,"tag":491,"props":4606,"children":4607},{"style":670},[4608],{"type":406,"value":3270},{"type":400,"tag":491,"props":4610,"children":4611},{"style":561},[4612],{"type":406,"value":2942},{"type":400,"tag":491,"props":4614,"children":4615},{"style":546},[4616],{"type":406,"value":569},{"type":400,"tag":491,"props":4618,"children":4619},{"style":572},[4620],{"type":406,"value":4533},{"type":400,"tag":491,"props":4622,"children":4623},{"style":670},[4624],{"type":406,"value":2478},{"type":400,"tag":491,"props":4626,"children":4627},{"style":540},[4628],{"type":406,"value":4542},{"type":400,"tag":491,"props":4630,"children":4631},{"style":546},[4632],{"type":406,"value":628},{"type":400,"tag":491,"props":4634,"children":4635},{"style":572},[4636],{"type":406,"value":4551},{"type":400,"tag":491,"props":4638,"children":4639},{"style":546},[4640],{"type":406,"value":658},{"type":400,"tag":491,"props":4642,"children":4643},{"class":493,"line":604},[4644],{"type":400,"tag":491,"props":4645,"children":4646},{"style":546},[4647],{"type":406,"value":1337},{"type":400,"tag":408,"props":4649,"children":4650},{"id":3466},[4651],{"type":406,"value":3466},{"type":400,"tag":414,"props":4653,"children":4654},{},[4655],{"type":406,"value":4656},"代码没有使用 C++ 风格的异常捕获，取而代之的是设计了状态类 Status。就像 kingdb_user 示例展示的，所有数据库操作都会返回一个状态实例，通过调用其 IsOK 方法，调用者可以判断处出操作有没有成功；如果失败了，可以使用 ToString 方法把出错原因输出。尽管这种设计会带来额外的内存开销，且使每次调用都带来轻微的性能消耗，不过这种消耗可以避免魔法数值，它将错误码和核心解耦，使代码有更佳的可读性。",{"type":400,"tag":480,"props":4658,"children":4660},{"code":4659,"language":483,"meta":394,"className":484,"style":394},"class Status {\n  // ...\n  static Status OK() { return Status(); }\n  bool IsOK() const { return (code_ == kOK); }\n  // ...\n  enum Code {\n    kOK = 0, \n    kNotFound = 1,\n    kDeleteOrder = 2,\n    kInvalidArgument = 3,\n    kIOError = 4,\n    kDone = 5,\n    kMultipartRequired = 6\n  };\n  // ...\n}\nstd::string Status::ToString() const {\n  if (message1_ == \"\") {\n    return \"OK\";\n  } else {\n    char tmp[30];\n    const char* type;\n    switch (code()) {\n      case kOK:\n        type = \"OK\";\n        break;\n      // ...\n    }\n    // ...\n    return result;\n  }\n}\n",[4661],{"type":400,"tag":487,"props":4662,"children":4663},{"__ignoreMap":394},[4664,4679,4686,4727,4782,4789,4806,4831,4852,4873,4894,4915,4936,4953,4961,4968,4975,5014,5047,5070,5085,5111,5138,5162,5179,5207,5219,5227,5235,5242,5259,5267],{"type":400,"tag":491,"props":4665,"children":4666},{"class":493,"line":494},[4667,4671,4675],{"type":400,"tag":491,"props":4668,"children":4669},{"style":534},[4670],{"type":406,"value":1911},{"type":400,"tag":491,"props":4672,"children":4673},{"style":561},[4674],{"type":406,"value":3493},{"type":400,"tag":491,"props":4676,"children":4677},{"style":546},[4678],{"type":406,"value":554},{"type":400,"tag":491,"props":4680,"children":4681},{"class":493,"line":521},[4682],{"type":400,"tag":491,"props":4683,"children":4684},{"style":1500},[4685],{"type":406,"value":1856},{"type":400,"tag":491,"props":4687,"children":4688},{"class":493,"line":530},[4689,4693,4697,4702,4706,4710,4715,4719,4723],{"type":400,"tag":491,"props":4690,"children":4691},{"style":1998},[4692],{"type":406,"value":2001},{"type":400,"tag":491,"props":4694,"children":4695},{"style":561},[4696],{"type":406,"value":3493},{"type":400,"tag":491,"props":4698,"children":4699},{"style":540},[4700],{"type":406,"value":4701}," OK",{"type":400,"tag":491,"props":4703,"children":4704},{"style":546},[4705],{"type":406,"value":549},{"type":400,"tag":491,"props":4707,"children":4708},{"style":546},[4709],{"type":406,"value":2020},{"type":400,"tag":491,"props":4711,"children":4712},{"style":498},[4713],{"type":406,"value":4714}," return",{"type":400,"tag":491,"props":4716,"children":4717},{"style":540},[4718],{"type":406,"value":3493},{"type":400,"tag":491,"props":4720,"children":4721},{"style":546},[4722],{"type":406,"value":1987},{"type":400,"tag":491,"props":4724,"children":4725},{"style":546},[4726],{"type":406,"value":3821},{"type":400,"tag":491,"props":4728,"children":4729},{"class":493,"line":557},[4730,4735,4740,4744,4748,4752,4756,4760,4765,4769,4774,4778],{"type":400,"tag":491,"props":4731,"children":4732},{"style":534},[4733],{"type":406,"value":4734},"  bool",{"type":400,"tag":491,"props":4736,"children":4737},{"style":540},[4738],{"type":406,"value":4739}," IsOK",{"type":400,"tag":491,"props":4741,"children":4742},{"style":546},[4743],{"type":406,"value":549},{"type":400,"tag":491,"props":4745,"children":4746},{"style":1998},[4747],{"type":406,"value":2532},{"type":400,"tag":491,"props":4749,"children":4750},{"style":546},[4751],{"type":406,"value":2020},{"type":400,"tag":491,"props":4753,"children":4754},{"style":498},[4755],{"type":406,"value":4714},{"type":400,"tag":491,"props":4757,"children":4758},{"style":546},[4759],{"type":406,"value":707},{"type":400,"tag":491,"props":4761,"children":4762},{"style":751},[4763],{"type":406,"value":4764},"code_ ",{"type":400,"tag":491,"props":4766,"children":4767},{"style":670},[4768],{"type":406,"value":1178},{"type":400,"tag":491,"props":4770,"children":4771},{"style":751},[4772],{"type":406,"value":4773}," kOK",{"type":400,"tag":491,"props":4775,"children":4776},{"style":546},[4777],{"type":406,"value":1234},{"type":400,"tag":491,"props":4779,"children":4780},{"style":546},[4781],{"type":406,"value":3821},{"type":400,"tag":491,"props":4783,"children":4784},{"class":493,"line":583},[4785],{"type":400,"tag":491,"props":4786,"children":4787},{"style":1500},[4788],{"type":406,"value":1856},{"type":400,"tag":491,"props":4790,"children":4791},{"class":493,"line":604},[4792,4797,4802],{"type":400,"tag":491,"props":4793,"children":4794},{"style":534},[4795],{"type":406,"value":4796},"  enum",{"type":400,"tag":491,"props":4798,"children":4799},{"style":561},[4800],{"type":406,"value":4801}," Code",{"type":400,"tag":491,"props":4803,"children":4804},{"style":546},[4805],{"type":406,"value":554},{"type":400,"tag":491,"props":4807,"children":4808},{"class":493,"line":661},[4809,4815,4819,4823,4827],{"type":400,"tag":491,"props":4810,"children":4812},{"style":4811},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#F8F8F2",[4813],{"type":406,"value":4814},"    kOK",{"type":400,"tag":491,"props":4816,"children":4817},{"style":670},[4818],{"type":406,"value":2157},{"type":400,"tag":491,"props":4820,"children":4821},{"style":832},[4822],{"type":406,"value":1324},{"type":400,"tag":491,"props":4824,"children":4825},{"style":546},[4826],{"type":406,"value":638},{"type":400,"tag":491,"props":4828,"children":4829},{"style":751},[4830],{"type":406,"value":1239},{"type":400,"tag":491,"props":4832,"children":4833},{"class":493,"line":696},[4834,4839,4843,4847],{"type":400,"tag":491,"props":4835,"children":4836},{"style":4811},[4837],{"type":406,"value":4838},"    kNotFound",{"type":400,"tag":491,"props":4840,"children":4841},{"style":670},[4842],{"type":406,"value":2157},{"type":400,"tag":491,"props":4844,"children":4845},{"style":832},[4846],{"type":406,"value":3049},{"type":400,"tag":491,"props":4848,"children":4849},{"style":546},[4850],{"type":406,"value":4851},",\n",{"type":400,"tag":491,"props":4853,"children":4854},{"class":493,"line":738},[4855,4860,4864,4869],{"type":400,"tag":491,"props":4856,"children":4857},{"style":4811},[4858],{"type":406,"value":4859},"    kDeleteOrder",{"type":400,"tag":491,"props":4861,"children":4862},{"style":670},[4863],{"type":406,"value":2157},{"type":400,"tag":491,"props":4865,"children":4866},{"style":832},[4867],{"type":406,"value":4868}," 2",{"type":400,"tag":491,"props":4870,"children":4871},{"style":546},[4872],{"type":406,"value":4851},{"type":400,"tag":491,"props":4874,"children":4875},{"class":493,"line":819},[4876,4881,4885,4890],{"type":400,"tag":491,"props":4877,"children":4878},{"style":4811},[4879],{"type":406,"value":4880},"    kInvalidArgument",{"type":400,"tag":491,"props":4882,"children":4883},{"style":670},[4884],{"type":406,"value":2157},{"type":400,"tag":491,"props":4886,"children":4887},{"style":832},[4888],{"type":406,"value":4889}," 3",{"type":400,"tag":491,"props":4891,"children":4892},{"style":546},[4893],{"type":406,"value":4851},{"type":400,"tag":491,"props":4895,"children":4896},{"class":493,"line":842},[4897,4902,4906,4911],{"type":400,"tag":491,"props":4898,"children":4899},{"style":4811},[4900],{"type":406,"value":4901},"    kIOError",{"type":400,"tag":491,"props":4903,"children":4904},{"style":670},[4905],{"type":406,"value":2157},{"type":400,"tag":491,"props":4907,"children":4908},{"style":832},[4909],{"type":406,"value":4910}," 4",{"type":400,"tag":491,"props":4912,"children":4913},{"style":546},[4914],{"type":406,"value":4851},{"type":400,"tag":491,"props":4916,"children":4917},{"class":493,"line":851},[4918,4923,4927,4932],{"type":400,"tag":491,"props":4919,"children":4920},{"style":4811},[4921],{"type":406,"value":4922},"    kDone",{"type":400,"tag":491,"props":4924,"children":4925},{"style":670},[4926],{"type":406,"value":2157},{"type":400,"tag":491,"props":4928,"children":4929},{"style":832},[4930],{"type":406,"value":4931}," 5",{"type":400,"tag":491,"props":4933,"children":4934},{"style":546},[4935],{"type":406,"value":4851},{"type":400,"tag":491,"props":4937,"children":4938},{"class":493,"line":859},[4939,4944,4948],{"type":400,"tag":491,"props":4940,"children":4941},{"style":4811},[4942],{"type":406,"value":4943},"    kMultipartRequired",{"type":400,"tag":491,"props":4945,"children":4946},{"style":670},[4947],{"type":406,"value":2157},{"type":400,"tag":491,"props":4949,"children":4950},{"style":832},[4951],{"type":406,"value":4952}," 6\n",{"type":400,"tag":491,"props":4954,"children":4955},{"class":493,"line":902},[4956],{"type":400,"tag":491,"props":4957,"children":4958},{"style":546},[4959],{"type":406,"value":4960},"  };\n",{"type":400,"tag":491,"props":4962,"children":4963},{"class":493,"line":943},[4964],{"type":400,"tag":491,"props":4965,"children":4966},{"style":1500},[4967],{"type":406,"value":1856},{"type":400,"tag":491,"props":4969,"children":4970},{"class":493,"line":951},[4971],{"type":400,"tag":491,"props":4972,"children":4973},{"style":546},[4974],{"type":406,"value":1337},{"type":400,"tag":491,"props":4976,"children":4977},{"class":493,"line":972},[4978,4982,4986,4990,4994,4998,5002,5006,5010],{"type":400,"tag":491,"props":4979,"children":4980},{"style":561},[4981],{"type":406,"value":2942},{"type":400,"tag":491,"props":4983,"children":4984},{"style":546},[4985],{"type":406,"value":569},{"type":400,"tag":491,"props":4987,"children":4988},{"style":561},[4989],{"type":406,"value":3537},{"type":400,"tag":491,"props":4991,"children":4992},{"style":561},[4993],{"type":406,"value":3493},{"type":400,"tag":491,"props":4995,"children":4996},{"style":546},[4997],{"type":406,"value":569},{"type":400,"tag":491,"props":4999,"children":5000},{"style":540},[5001],{"type":406,"value":801},{"type":400,"tag":491,"props":5003,"children":5004},{"style":546},[5005],{"type":406,"value":549},{"type":400,"tag":491,"props":5007,"children":5008},{"style":1998},[5009],{"type":406,"value":2532},{"type":400,"tag":491,"props":5011,"children":5012},{"style":546},[5013],{"type":406,"value":554},{"type":400,"tag":491,"props":5015,"children":5016},{"class":493,"line":1028},[5017,5021,5025,5030,5034,5039,5043],{"type":400,"tag":491,"props":5018,"children":5019},{"style":498},[5020],{"type":406,"value":702},{"type":400,"tag":491,"props":5022,"children":5023},{"style":546},[5024],{"type":406,"value":707},{"type":400,"tag":491,"props":5026,"children":5027},{"style":751},[5028],{"type":406,"value":5029},"message1_ ",{"type":400,"tag":491,"props":5031,"children":5032},{"style":670},[5033],{"type":406,"value":1178},{"type":400,"tag":491,"props":5035,"children":5036},{"style":504},[5037],{"type":406,"value":5038}," \"\"",{"type":400,"tag":491,"props":5040,"children":5041},{"style":546},[5042],{"type":406,"value":1195},{"type":400,"tag":491,"props":5044,"children":5045},{"style":546},[5046],{"type":406,"value":554},{"type":400,"tag":491,"props":5048,"children":5049},{"class":493,"line":1036},[5050,5054,5058,5062,5066],{"type":400,"tag":491,"props":5051,"children":5052},{"style":498},[5053],{"type":406,"value":2731},{"type":400,"tag":491,"props":5055,"children":5056},{"style":504},[5057],{"type":406,"value":643},{"type":400,"tag":491,"props":5059,"children":5060},{"style":510},[5061],{"type":406,"value":4267},{"type":400,"tag":491,"props":5063,"children":5064},{"style":504},[5065],{"type":406,"value":653},{"type":400,"tag":491,"props":5067,"children":5068},{"style":546},[5069],{"type":406,"value":580},{"type":400,"tag":491,"props":5071,"children":5072},{"class":493,"line":1057},[5073,5077,5081],{"type":400,"tag":491,"props":5074,"children":5075},{"style":546},[5076],{"type":406,"value":1248},{"type":400,"tag":491,"props":5078,"children":5079},{"style":498},[5080],{"type":406,"value":1253},{"type":400,"tag":491,"props":5082,"children":5083},{"style":546},[5084],{"type":406,"value":554},{"type":400,"tag":491,"props":5086,"children":5087},{"class":493,"line":1078},[5088,5093,5098,5102,5107],{"type":400,"tag":491,"props":5089,"children":5090},{"style":534},[5091],{"type":406,"value":5092},"    char",{"type":400,"tag":491,"props":5094,"children":5095},{"style":572},[5096],{"type":406,"value":5097}," tmp",{"type":400,"tag":491,"props":5099,"children":5100},{"style":546},[5101],{"type":406,"value":1467},{"type":400,"tag":491,"props":5103,"children":5104},{"style":832},[5105],{"type":406,"value":5106},"30",{"type":400,"tag":491,"props":5108,"children":5109},{"style":546},[5110],{"type":406,"value":1477},{"type":400,"tag":491,"props":5112,"children":5113},{"class":493,"line":1138},[5114,5119,5124,5129,5134],{"type":400,"tag":491,"props":5115,"children":5116},{"style":1998},[5117],{"type":406,"value":5118},"    const",{"type":400,"tag":491,"props":5120,"children":5121},{"style":534},[5122],{"type":406,"value":5123}," char",{"type":400,"tag":491,"props":5125,"children":5126},{"style":670},[5127],{"type":406,"value":5128},"*",{"type":400,"tag":491,"props":5130,"children":5131},{"style":751},[5132],{"type":406,"value":5133}," type",{"type":400,"tag":491,"props":5135,"children":5136},{"style":546},[5137],{"type":406,"value":580},{"type":400,"tag":491,"props":5139,"children":5140},{"class":493,"line":1202},[5141,5146,5150,5154,5158],{"type":400,"tag":491,"props":5142,"children":5143},{"style":498},[5144],{"type":406,"value":5145},"    switch",{"type":400,"tag":491,"props":5147,"children":5148},{"style":546},[5149],{"type":406,"value":707},{"type":400,"tag":491,"props":5151,"children":5152},{"style":540},[5153],{"type":406,"value":487},{"type":400,"tag":491,"props":5155,"children":5156},{"style":546},[5157],{"type":406,"value":731},{"type":400,"tag":491,"props":5159,"children":5160},{"style":546},[5161],{"type":406,"value":554},{"type":400,"tag":491,"props":5163,"children":5164},{"class":493,"line":1242},[5165,5170,5174],{"type":400,"tag":491,"props":5166,"children":5167},{"style":498},[5168],{"type":406,"value":5169},"      case",{"type":400,"tag":491,"props":5171,"children":5172},{"style":751},[5173],{"type":406,"value":4773},{"type":400,"tag":491,"props":5175,"children":5176},{"style":546},[5177],{"type":406,"value":5178},":\n",{"type":400,"tag":491,"props":5180,"children":5181},{"class":493,"line":1260},[5182,5187,5191,5195,5199,5203],{"type":400,"tag":491,"props":5183,"children":5184},{"style":751},[5185],{"type":406,"value":5186},"        type ",{"type":400,"tag":491,"props":5188,"children":5189},{"style":670},[5190],{"type":406,"value":673},{"type":400,"tag":491,"props":5192,"children":5193},{"style":504},[5194],{"type":406,"value":643},{"type":400,"tag":491,"props":5196,"children":5197},{"style":510},[5198],{"type":406,"value":4267},{"type":400,"tag":491,"props":5200,"children":5201},{"style":504},[5202],{"type":406,"value":653},{"type":400,"tag":491,"props":5204,"children":5205},{"style":546},[5206],{"type":406,"value":580},{"type":400,"tag":491,"props":5208,"children":5209},{"class":493,"line":1297},[5210,5215],{"type":400,"tag":491,"props":5211,"children":5212},{"style":498},[5213],{"type":406,"value":5214},"        break",{"type":400,"tag":491,"props":5216,"children":5217},{"style":546},[5218],{"type":406,"value":580},{"type":400,"tag":491,"props":5220,"children":5221},{"class":493,"line":1305},[5222],{"type":400,"tag":491,"props":5223,"children":5224},{"style":1500},[5225],{"type":406,"value":5226},"      // ...\n",{"type":400,"tag":491,"props":5228,"children":5229},{"class":493,"line":1313},[5230],{"type":400,"tag":491,"props":5231,"children":5232},{"style":546},[5233],{"type":406,"value":5234},"    }\n",{"type":400,"tag":491,"props":5236,"children":5237},{"class":493,"line":1331},[5238],{"type":400,"tag":491,"props":5239,"children":5240},{"style":1500},[5241],{"type":406,"value":4128},{"type":400,"tag":491,"props":5243,"children":5245},{"class":493,"line":5244},30,[5246,5250,5255],{"type":400,"tag":491,"props":5247,"children":5248},{"style":498},[5249],{"type":406,"value":2731},{"type":400,"tag":491,"props":5251,"children":5252},{"style":751},[5253],{"type":406,"value":5254}," result",{"type":400,"tag":491,"props":5256,"children":5257},{"style":546},[5258],{"type":406,"value":580},{"type":400,"tag":491,"props":5260,"children":5262},{"class":493,"line":5261},31,[5263],{"type":400,"tag":491,"props":5264,"children":5265},{"style":546},[5266],{"type":406,"value":848},{"type":400,"tag":491,"props":5268,"children":5270},{"class":493,"line":5269},32,[5271],{"type":400,"tag":491,"props":5272,"children":5273},{"style":546},[5274],{"type":406,"value":1337},{"type":400,"tag":414,"props":5276,"children":5277},{},[5278],{"type":406,"value":5279},"KDB 内部代码出现异常时会使用日志将其记录下来。如果没有日志，那么在排查代码问题时简直就是噩梦。KDB 有两套日志的输出目标，分别是系统输出和标准输出设备。日志类记录输出目标、日志级别、线程锁等成员，并通过静态方法 Logv 实现记录日志。锁的最大用处是保证记录顺序。仅有当出现最高级别的日志（kLogLevelEMERG）时，才会跳过锁直接写入。出现 kLogLevelEMERG 时意味着程序遇到了紧急问题，通常会直接退出或是返回 Status 异常，所以这个时候需要及时记录。",{"type":400,"tag":414,"props":5281,"children":5282},{},[5283],{"type":406,"value":5284},"日志级别的划分参考了 Syslog：",{"type":400,"tag":441,"props":5286,"children":5287},{},[5288,5293,5298,5303,5308,5313,5318,5323,5328,5333],{"type":400,"tag":445,"props":5289,"children":5290},{},[5291],{"type":406,"value":5292},"silent: all logging is turned off",{"type":400,"tag":445,"props":5294,"children":5295},{},[5296],{"type":406,"value":5297},"emerg: system is unusable, imminent crash",{"type":400,"tag":445,"props":5299,"children":5300},{},[5301],{"type":406,"value":5302},"alert: error event, immediate action required",{"type":400,"tag":445,"props":5304,"children":5305},{},[5306],{"type":406,"value":5307},"crit: error event, immediate action required",{"type":400,"tag":445,"props":5309,"children":5310},{},[5311],{"type":406,"value":5312},"error: error event, action is required but is not urgent",{"type":400,"tag":445,"props":5314,"children":5315},{},[5316],{"type":406,"value":5317},"warn: events that can be harmful if no action is taken",{"type":400,"tag":445,"props":5319,"children":5320},{},[5321],{"type":406,"value":5322},"notice: unusual events, but no immediate action required",{"type":400,"tag":445,"props":5324,"children":5325},{},[5326],{"type":406,"value":5327},"info: normal operation events, no action required",{"type":400,"tag":445,"props":5329,"children":5330},{},[5331],{"type":406,"value":5332},"debug: events used for debugging, no action required",{"type":400,"tag":445,"props":5334,"children":5335},{},[5336],{"type":406,"value":5337},"trace: fine-grained events used for debugging, no action required",{"type":400,"tag":1367,"props":5339,"children":5341},{"id":5340},"日志调用用宏还是函数",[5342],{"type":406,"value":5340},{"type":400,"tag":414,"props":5344,"children":5345},{},[5346,5348,5354,5356,5360],{"type":406,"value":5347},"原先的提交中，日志调用被定义在了宏里，直接调用 Logger::Logv 去记录。日志宏中使用子宏 ",{"type":400,"tag":5349,"props":5350,"children":5351},"strong",{},[5352],{"type":406,"value":5353},"VA_ARGS",{"type":406,"value":5355}," 来记录可变参数。",{"type":400,"tag":5349,"props":5357,"children":5358},{},[5359],{"type":406,"value":5353},{"type":406,"value":5361}," 前面有标记黏贴运算符的原因是当日志宏的可变参数为空时，可以把末尾的逗号去掉。",{"type":400,"tag":480,"props":5363,"children":5365},{"code":5364,"language":483,"meta":394,"className":484,"style":394},"class log {\n  static void emerg(const char* logname, const char* format, ...) {\n    va_list args;\n    va_start(args, format);\n    Logger::Logv(false, Logger::kLogLevelEMERG, LOG_EMERG, logname, format, args);\n    va_end(args);\n  }\n}\n// ...\n#define LOG_EMERG(logname, fmt, ...) \\\n        Logger::Logv(false, Logger::kLogLevelEMERG, logname, fmt, ##__VA_ARGS__)\n",[5366],{"type":400,"tag":487,"props":5367,"children":5368},{"__ignoreMap":394},[5369,5385,5460,5472,5501,5583,5603,5610,5617,5624,5666],{"type":400,"tag":491,"props":5370,"children":5371},{"class":493,"line":494},[5372,5376,5381],{"type":400,"tag":491,"props":5373,"children":5374},{"style":534},[5375],{"type":406,"value":1911},{"type":400,"tag":491,"props":5377,"children":5378},{"style":561},[5379],{"type":406,"value":5380}," log",{"type":400,"tag":491,"props":5382,"children":5383},{"style":546},[5384],{"type":406,"value":554},{"type":400,"tag":491,"props":5386,"children":5387},{"class":493,"line":521},[5388,5392,5396,5401,5405,5409,5413,5417,5422,5426,5430,5434,5438,5443,5447,5452,5456],{"type":400,"tag":491,"props":5389,"children":5390},{"style":1998},[5391],{"type":406,"value":2001},{"type":400,"tag":491,"props":5393,"children":5394},{"style":534},[5395],{"type":406,"value":2006},{"type":400,"tag":491,"props":5397,"children":5398},{"style":540},[5399],{"type":406,"value":5400}," emerg",{"type":400,"tag":491,"props":5402,"children":5403},{"style":546},[5404],{"type":406,"value":628},{"type":400,"tag":491,"props":5406,"children":5407},{"style":1998},[5408],{"type":406,"value":2510},{"type":400,"tag":491,"props":5410,"children":5411},{"style":534},[5412],{"type":406,"value":5123},{"type":400,"tag":491,"props":5414,"children":5415},{"style":1998},[5416],{"type":406,"value":5128},{"type":400,"tag":491,"props":5418,"children":5419},{"style":1407},[5420],{"type":406,"value":5421}," logname",{"type":400,"tag":491,"props":5423,"children":5424},{"style":546},[5425],{"type":406,"value":638},{"type":400,"tag":491,"props":5427,"children":5428},{"style":1998},[5429],{"type":406,"value":2532},{"type":400,"tag":491,"props":5431,"children":5432},{"style":534},[5433],{"type":406,"value":5123},{"type":400,"tag":491,"props":5435,"children":5436},{"style":1998},[5437],{"type":406,"value":5128},{"type":400,"tag":491,"props":5439,"children":5440},{"style":1407},[5441],{"type":406,"value":5442}," format",{"type":400,"tag":491,"props":5444,"children":5445},{"style":546},[5446],{"type":406,"value":638},{"type":400,"tag":491,"props":5448,"children":5449},{"style":751},[5450],{"type":406,"value":5451}," ...",{"type":400,"tag":491,"props":5453,"children":5454},{"style":546},[5455],{"type":406,"value":1195},{"type":400,"tag":491,"props":5457,"children":5458},{"style":546},[5459],{"type":406,"value":554},{"type":400,"tag":491,"props":5461,"children":5462},{"class":493,"line":530},[5463,5468],{"type":400,"tag":491,"props":5464,"children":5465},{"style":751},[5466],{"type":406,"value":5467},"    va_list args",{"type":400,"tag":491,"props":5469,"children":5470},{"style":546},[5471],{"type":406,"value":580},{"type":400,"tag":491,"props":5473,"children":5474},{"class":493,"line":557},[5475,5480,5484,5489,5493,5497],{"type":400,"tag":491,"props":5476,"children":5477},{"style":540},[5478],{"type":406,"value":5479},"    va_start",{"type":400,"tag":491,"props":5481,"children":5482},{"style":546},[5483],{"type":406,"value":628},{"type":400,"tag":491,"props":5485,"children":5486},{"style":751},[5487],{"type":406,"value":5488},"args",{"type":400,"tag":491,"props":5490,"children":5491},{"style":546},[5492],{"type":406,"value":638},{"type":400,"tag":491,"props":5494,"children":5495},{"style":751},[5496],{"type":406,"value":5442},{"type":400,"tag":491,"props":5498,"children":5499},{"style":546},[5500],{"type":406,"value":658},{"type":400,"tag":491,"props":5502,"children":5503},{"class":493,"line":583},[5504,5509,5513,5518,5522,5527,5531,5536,5540,5545,5549,5554,5558,5562,5566,5570,5574,5579],{"type":400,"tag":491,"props":5505,"children":5506},{"style":561},[5507],{"type":406,"value":5508},"    Logger",{"type":400,"tag":491,"props":5510,"children":5511},{"style":546},[5512],{"type":406,"value":569},{"type":400,"tag":491,"props":5514,"children":5515},{"style":540},[5516],{"type":406,"value":5517},"Logv",{"type":400,"tag":491,"props":5519,"children":5520},{"style":546},[5521],{"type":406,"value":628},{"type":400,"tag":491,"props":5523,"children":5524},{"style":2698},[5525],{"type":406,"value":5526},"false",{"type":400,"tag":491,"props":5528,"children":5529},{"style":546},[5530],{"type":406,"value":638},{"type":400,"tag":491,"props":5532,"children":5533},{"style":561},[5534],{"type":406,"value":5535}," Logger",{"type":400,"tag":491,"props":5537,"children":5538},{"style":546},[5539],{"type":406,"value":569},{"type":400,"tag":491,"props":5541,"children":5542},{"style":751},[5543],{"type":406,"value":5544},"kLogLevelEMERG",{"type":400,"tag":491,"props":5546,"children":5547},{"style":546},[5548],{"type":406,"value":638},{"type":400,"tag":491,"props":5550,"children":5551},{"style":751},[5552],{"type":406,"value":5553}," LOG_EMERG",{"type":400,"tag":491,"props":5555,"children":5556},{"style":546},[5557],{"type":406,"value":638},{"type":400,"tag":491,"props":5559,"children":5560},{"style":751},[5561],{"type":406,"value":5421},{"type":400,"tag":491,"props":5563,"children":5564},{"style":546},[5565],{"type":406,"value":638},{"type":400,"tag":491,"props":5567,"children":5568},{"style":751},[5569],{"type":406,"value":5442},{"type":400,"tag":491,"props":5571,"children":5572},{"style":546},[5573],{"type":406,"value":638},{"type":400,"tag":491,"props":5575,"children":5576},{"style":751},[5577],{"type":406,"value":5578}," args",{"type":400,"tag":491,"props":5580,"children":5581},{"style":546},[5582],{"type":406,"value":658},{"type":400,"tag":491,"props":5584,"children":5585},{"class":493,"line":604},[5586,5591,5595,5599],{"type":400,"tag":491,"props":5587,"children":5588},{"style":540},[5589],{"type":406,"value":5590},"    va_end",{"type":400,"tag":491,"props":5592,"children":5593},{"style":546},[5594],{"type":406,"value":628},{"type":400,"tag":491,"props":5596,"children":5597},{"style":751},[5598],{"type":406,"value":5488},{"type":400,"tag":491,"props":5600,"children":5601},{"style":546},[5602],{"type":406,"value":658},{"type":400,"tag":491,"props":5604,"children":5605},{"class":493,"line":661},[5606],{"type":400,"tag":491,"props":5607,"children":5608},{"style":546},[5609],{"type":406,"value":848},{"type":400,"tag":491,"props":5611,"children":5612},{"class":493,"line":696},[5613],{"type":400,"tag":491,"props":5614,"children":5615},{"style":546},[5616],{"type":406,"value":1337},{"type":400,"tag":491,"props":5618,"children":5619},{"class":493,"line":738},[5620],{"type":400,"tag":491,"props":5621,"children":5622},{"style":1500},[5623],{"type":406,"value":3312},{"type":400,"tag":491,"props":5625,"children":5626},{"class":493,"line":819},[5627,5631,5635,5639,5644,5648,5653,5657,5662],{"type":400,"tag":491,"props":5628,"children":5629},{"style":498},[5630],{"type":406,"value":1871},{"type":400,"tag":491,"props":5632,"children":5633},{"style":540},[5634],{"type":406,"value":5553},{"type":400,"tag":491,"props":5636,"children":5637},{"style":546},[5638],{"type":406,"value":628},{"type":400,"tag":491,"props":5640,"children":5641},{"style":1407},[5642],{"type":406,"value":5643},"logname",{"type":400,"tag":491,"props":5645,"children":5646},{"style":546},[5647],{"type":406,"value":638},{"type":400,"tag":491,"props":5649,"children":5650},{"style":1407},[5651],{"type":406,"value":5652}," fmt",{"type":400,"tag":491,"props":5654,"children":5655},{"style":546},[5656],{"type":406,"value":638},{"type":400,"tag":491,"props":5658,"children":5659},{"style":546},[5660],{"type":406,"value":5661}," ...)",{"type":400,"tag":491,"props":5663,"children":5664},{"style":776},[5665],{"type":406,"value":2257},{"type":400,"tag":491,"props":5667,"children":5668},{"class":493,"line":842},[5669,5674,5678,5682,5686,5690,5694,5698,5702,5706,5710,5714,5718,5722,5726,5731],{"type":400,"tag":491,"props":5670,"children":5671},{"style":561},[5672],{"type":406,"value":5673},"        Logger",{"type":400,"tag":491,"props":5675,"children":5676},{"style":546},[5677],{"type":406,"value":569},{"type":400,"tag":491,"props":5679,"children":5680},{"style":540},[5681],{"type":406,"value":5517},{"type":400,"tag":491,"props":5683,"children":5684},{"style":546},[5685],{"type":406,"value":628},{"type":400,"tag":491,"props":5687,"children":5688},{"style":2698},[5689],{"type":406,"value":5526},{"type":400,"tag":491,"props":5691,"children":5692},{"style":546},[5693],{"type":406,"value":638},{"type":400,"tag":491,"props":5695,"children":5696},{"style":561},[5697],{"type":406,"value":5535},{"type":400,"tag":491,"props":5699,"children":5700},{"style":546},[5701],{"type":406,"value":569},{"type":400,"tag":491,"props":5703,"children":5704},{"style":751},[5705],{"type":406,"value":5544},{"type":400,"tag":491,"props":5707,"children":5708},{"style":546},[5709],{"type":406,"value":638},{"type":400,"tag":491,"props":5711,"children":5712},{"style":751},[5713],{"type":406,"value":5421},{"type":400,"tag":491,"props":5715,"children":5716},{"style":546},[5717],{"type":406,"value":638},{"type":400,"tag":491,"props":5719,"children":5720},{"style":751},[5721],{"type":406,"value":5652},{"type":400,"tag":491,"props":5723,"children":5724},{"style":546},[5725],{"type":406,"value":638},{"type":400,"tag":491,"props":5727,"children":5728},{"style":572},[5729],{"type":406,"value":5730}," ##__VA_ARGS__",{"type":400,"tag":491,"props":5732,"children":5733},{"style":546},[5734],{"type":406,"value":2327},{"type":400,"tag":414,"props":5736,"children":5737},{},[5738],{"type":406,"value":5739},"尚不清楚为什么不用宏，而是使用运行时的方法调用（即 log 的 public 方法）。猜测可能是因为宏不能跨行？因为我看到了这种很长的调用。",{"type":400,"tag":480,"props":5741,"children":5743},{"code":5742,"language":483,"meta":394,"className":484,"style":394},"log::trace(\n  \"Database::PutPartValidSize()\",\n  \"[%s] size_chunk:%\" PRIu64 \" offset_chunk:%\" PRIu64,\n  key.ToString().c_str(),\n  chunk.size(),\n  offset_chunk\n);\n",[5744],{"type":400,"tag":487,"props":5745,"children":5746},{"__ignoreMap":394},[5747,5769,5790,5841,5870,5890,5898],{"type":400,"tag":491,"props":5748,"children":5749},{"class":493,"line":494},[5750,5755,5759,5764],{"type":400,"tag":491,"props":5751,"children":5752},{"style":561},[5753],{"type":406,"value":5754},"log",{"type":400,"tag":491,"props":5756,"children":5757},{"style":546},[5758],{"type":406,"value":569},{"type":400,"tag":491,"props":5760,"children":5761},{"style":540},[5762],{"type":406,"value":5763},"trace",{"type":400,"tag":491,"props":5765,"children":5766},{"style":546},[5767],{"type":406,"value":5768},"(\n",{"type":400,"tag":491,"props":5770,"children":5771},{"class":493,"line":521},[5772,5777,5782,5786],{"type":400,"tag":491,"props":5773,"children":5774},{"style":504},[5775],{"type":406,"value":5776},"  \"",{"type":400,"tag":491,"props":5778,"children":5779},{"style":510},[5780],{"type":406,"value":5781},"Database::PutPartValidSize()",{"type":400,"tag":491,"props":5783,"children":5784},{"style":504},[5785],{"type":406,"value":653},{"type":400,"tag":491,"props":5787,"children":5788},{"style":546},[5789],{"type":406,"value":4851},{"type":400,"tag":491,"props":5791,"children":5792},{"class":493,"line":530},[5793,5797,5801,5805,5810,5814,5819,5823,5828,5832,5837],{"type":400,"tag":491,"props":5794,"children":5795},{"style":504},[5796],{"type":406,"value":5776},{"type":400,"tag":491,"props":5798,"children":5799},{"style":510},[5800],{"type":406,"value":1467},{"type":400,"tag":491,"props":5802,"children":5803},{"style":770},[5804],{"type":406,"value":773},{"type":400,"tag":491,"props":5806,"children":5807},{"style":510},[5808],{"type":406,"value":5809},"] size_chunk:%",{"type":400,"tag":491,"props":5811,"children":5812},{"style":504},[5813],{"type":406,"value":653},{"type":400,"tag":491,"props":5815,"children":5816},{"style":572},[5817],{"type":406,"value":5818}," PRIu64 ",{"type":400,"tag":491,"props":5820,"children":5821},{"style":504},[5822],{"type":406,"value":653},{"type":400,"tag":491,"props":5824,"children":5825},{"style":510},[5826],{"type":406,"value":5827}," offset_chunk:%",{"type":400,"tag":491,"props":5829,"children":5830},{"style":504},[5831],{"type":406,"value":653},{"type":400,"tag":491,"props":5833,"children":5834},{"style":572},[5835],{"type":406,"value":5836}," PRIu64",{"type":400,"tag":491,"props":5838,"children":5839},{"style":546},[5840],{"type":406,"value":4851},{"type":400,"tag":491,"props":5842,"children":5843},{"class":493,"line":557},[5844,5849,5853,5857,5861,5865],{"type":400,"tag":491,"props":5845,"children":5846},{"style":572},[5847],{"type":406,"value":5848},"  key",{"type":400,"tag":491,"props":5850,"children":5851},{"style":546},[5852],{"type":406,"value":683},{"type":400,"tag":491,"props":5854,"children":5855},{"style":540},[5856],{"type":406,"value":801},{"type":400,"tag":491,"props":5858,"children":5859},{"style":546},[5860],{"type":406,"value":806},{"type":400,"tag":491,"props":5862,"children":5863},{"style":540},[5864],{"type":406,"value":811},{"type":400,"tag":491,"props":5866,"children":5867},{"style":546},[5868],{"type":406,"value":5869},"(),\n",{"type":400,"tag":491,"props":5871,"children":5872},{"class":493,"line":583},[5873,5878,5882,5886],{"type":400,"tag":491,"props":5874,"children":5875},{"style":572},[5876],{"type":406,"value":5877},"  chunk",{"type":400,"tag":491,"props":5879,"children":5880},{"style":546},[5881],{"type":406,"value":683},{"type":400,"tag":491,"props":5883,"children":5884},{"style":540},[5885],{"type":406,"value":3635},{"type":400,"tag":491,"props":5887,"children":5888},{"style":546},[5889],{"type":406,"value":5869},{"type":400,"tag":491,"props":5891,"children":5892},{"class":493,"line":604},[5893],{"type":400,"tag":491,"props":5894,"children":5895},{"style":572},[5896],{"type":406,"value":5897},"  offset_chunk\n",{"type":400,"tag":491,"props":5899,"children":5900},{"class":493,"line":661},[5901],{"type":400,"tag":491,"props":5902,"children":5903},{"style":546},[5904],{"type":406,"value":658},{"type":400,"tag":1367,"props":5906,"children":5908},{"id":5907},"日志时间",[5909],{"type":406,"value":5907},{"type":400,"tag":414,"props":5911,"children":5912},{},[5913],{"type":406,"value":5914},"使用系统输出（syslog）时不需要手动记录时间，但是把日志打印出来时却是要的。尤其是在调试时，精确时间非常有用。KDB 使用 Linux 的 timeval、tm 两个结构体，分别拿到精确时间及可读时间，再格式化输出。",{"type":400,"tag":480,"props":5916,"children":5918},{"code":5917,"language":483,"meta":394,"className":484,"style":394},"struct timeval now_tv;\ngettimeofday(&now_tv, NULL);\nconst time_t seconds = now_tv.tv_sec;\nstruct tm t;\n// 初始化 tm 时需要用到当前秒数，\n// 所以需要提前初始化 now_tv\nlocaltime_r(&seconds, &t);\np += snprintf(p, limit - p,\n              \"%04d/%02d/%02d-%02d:%02d:%02d.%06d %s %s \",\n              t.tm_year + 1900,\n              t.tm_mon + 1,\n              t.tm_mday,\n              t.tm_hour,\n              t.tm_min,\n              t.tm_sec,\n              static_cast\u003Cint>(now_tv.tv_usec), // 毫秒\n              ss.str().c_str(),\n              logname);\n",[5919],{"type":400,"tag":487,"props":5920,"children":5921},{"__ignoreMap":394},[5922,5944,5978,6016,6036,6044,6052,6090,6139,6220,6251,6279,6299,6319,6339,6359,6402,6430],{"type":400,"tag":491,"props":5923,"children":5924},{"class":493,"line":494},[5925,5930,5935,5940],{"type":400,"tag":491,"props":5926,"children":5927},{"style":534},[5928],{"type":406,"value":5929},"struct",{"type":400,"tag":491,"props":5931,"children":5932},{"style":561},[5933],{"type":406,"value":5934}," timeval",{"type":400,"tag":491,"props":5936,"children":5937},{"style":572},[5938],{"type":406,"value":5939}," now_tv",{"type":400,"tag":491,"props":5941,"children":5942},{"style":546},[5943],{"type":406,"value":580},{"type":400,"tag":491,"props":5945,"children":5946},{"class":493,"line":521},[5947,5952,5956,5960,5965,5969,5974],{"type":400,"tag":491,"props":5948,"children":5949},{"style":540},[5950],{"type":406,"value":5951},"gettimeofday",{"type":400,"tag":491,"props":5953,"children":5954},{"style":546},[5955],{"type":406,"value":628},{"type":400,"tag":491,"props":5957,"children":5958},{"style":670},[5959],{"type":406,"value":2496},{"type":400,"tag":491,"props":5961,"children":5962},{"style":572},[5963],{"type":406,"value":5964},"now_tv",{"type":400,"tag":491,"props":5966,"children":5967},{"style":546},[5968],{"type":406,"value":638},{"type":400,"tag":491,"props":5970,"children":5971},{"style":2698},[5972],{"type":406,"value":5973}," NULL",{"type":400,"tag":491,"props":5975,"children":5976},{"style":546},[5977],{"type":406,"value":658},{"type":400,"tag":491,"props":5979,"children":5980},{"class":493,"line":530},[5981,5985,5990,5995,5999,6003,6007,6012],{"type":400,"tag":491,"props":5982,"children":5983},{"style":1998},[5984],{"type":406,"value":2510},{"type":400,"tag":491,"props":5986,"children":5987},{"style":534},[5988],{"type":406,"value":5989}," time_t",{"type":400,"tag":491,"props":5991,"children":5992},{"style":572},[5993],{"type":406,"value":5994}," seconds ",{"type":400,"tag":491,"props":5996,"children":5997},{"style":670},[5998],{"type":406,"value":673},{"type":400,"tag":491,"props":6000,"children":6001},{"style":572},[6002],{"type":406,"value":5939},{"type":400,"tag":491,"props":6004,"children":6005},{"style":546},[6006],{"type":406,"value":683},{"type":400,"tag":491,"props":6008,"children":6009},{"style":572},[6010],{"type":406,"value":6011},"tv_sec",{"type":400,"tag":491,"props":6013,"children":6014},{"style":546},[6015],{"type":406,"value":580},{"type":400,"tag":491,"props":6017,"children":6018},{"class":493,"line":557},[6019,6023,6028,6032],{"type":400,"tag":491,"props":6020,"children":6021},{"style":534},[6022],{"type":406,"value":5929},{"type":400,"tag":491,"props":6024,"children":6025},{"style":561},[6026],{"type":406,"value":6027}," tm",{"type":400,"tag":491,"props":6029,"children":6030},{"style":572},[6031],{"type":406,"value":2058},{"type":400,"tag":491,"props":6033,"children":6034},{"style":546},[6035],{"type":406,"value":580},{"type":400,"tag":491,"props":6037,"children":6038},{"class":493,"line":583},[6039],{"type":400,"tag":491,"props":6040,"children":6041},{"style":1500},[6042],{"type":406,"value":6043},"// 初始化 tm 时需要用到当前秒数，\n",{"type":400,"tag":491,"props":6045,"children":6046},{"class":493,"line":604},[6047],{"type":400,"tag":491,"props":6048,"children":6049},{"style":1500},[6050],{"type":406,"value":6051},"// 所以需要提前初始化 now_tv\n",{"type":400,"tag":491,"props":6053,"children":6054},{"class":493,"line":661},[6055,6060,6064,6068,6073,6077,6081,6086],{"type":400,"tag":491,"props":6056,"children":6057},{"style":540},[6058],{"type":406,"value":6059},"localtime_r",{"type":400,"tag":491,"props":6061,"children":6062},{"style":546},[6063],{"type":406,"value":628},{"type":400,"tag":491,"props":6065,"children":6066},{"style":670},[6067],{"type":406,"value":2496},{"type":400,"tag":491,"props":6069,"children":6070},{"style":572},[6071],{"type":406,"value":6072},"seconds",{"type":400,"tag":491,"props":6074,"children":6075},{"style":546},[6076],{"type":406,"value":638},{"type":400,"tag":491,"props":6078,"children":6079},{"style":670},[6080],{"type":406,"value":1126},{"type":400,"tag":491,"props":6082,"children":6083},{"style":572},[6084],{"type":406,"value":6085},"t",{"type":400,"tag":491,"props":6087,"children":6088},{"style":546},[6089],{"type":406,"value":658},{"type":400,"tag":491,"props":6091,"children":6092},{"class":493,"line":696},[6093,6098,6103,6108,6112,6116,6120,6125,6130,6135],{"type":400,"tag":491,"props":6094,"children":6095},{"style":572},[6096],{"type":406,"value":6097},"p ",{"type":400,"tag":491,"props":6099,"children":6100},{"style":670},[6101],{"type":406,"value":6102},"+=",{"type":400,"tag":491,"props":6104,"children":6105},{"style":540},[6106],{"type":406,"value":6107}," snprintf",{"type":400,"tag":491,"props":6109,"children":6110},{"style":546},[6111],{"type":406,"value":628},{"type":400,"tag":491,"props":6113,"children":6114},{"style":572},[6115],{"type":406,"value":414},{"type":400,"tag":491,"props":6117,"children":6118},{"style":546},[6119],{"type":406,"value":638},{"type":400,"tag":491,"props":6121,"children":6122},{"style":572},[6123],{"type":406,"value":6124}," limit ",{"type":400,"tag":491,"props":6126,"children":6127},{"style":670},[6128],{"type":406,"value":6129},"-",{"type":400,"tag":491,"props":6131,"children":6132},{"style":572},[6133],{"type":406,"value":6134}," p",{"type":400,"tag":491,"props":6136,"children":6137},{"style":546},[6138],{"type":406,"value":4851},{"type":400,"tag":491,"props":6140,"children":6141},{"class":493,"line":738},[6142,6147,6152,6157,6162,6166,6170,6174,6178,6182,6186,6190,6194,6198,6203,6208,6212,6216],{"type":400,"tag":491,"props":6143,"children":6144},{"style":504},[6145],{"type":406,"value":6146},"              \"",{"type":400,"tag":491,"props":6148,"children":6149},{"style":770},[6150],{"type":406,"value":6151},"%04d",{"type":400,"tag":491,"props":6153,"children":6154},{"style":510},[6155],{"type":406,"value":6156},"/",{"type":400,"tag":491,"props":6158,"children":6159},{"style":770},[6160],{"type":406,"value":6161},"%02d",{"type":400,"tag":491,"props":6163,"children":6164},{"style":510},[6165],{"type":406,"value":6156},{"type":400,"tag":491,"props":6167,"children":6168},{"style":770},[6169],{"type":406,"value":6161},{"type":400,"tag":491,"props":6171,"children":6172},{"style":510},[6173],{"type":406,"value":6129},{"type":400,"tag":491,"props":6175,"children":6176},{"style":770},[6177],{"type":406,"value":6161},{"type":400,"tag":491,"props":6179,"children":6180},{"style":510},[6181],{"type":406,"value":1596},{"type":400,"tag":491,"props":6183,"children":6184},{"style":770},[6185],{"type":406,"value":6161},{"type":400,"tag":491,"props":6187,"children":6188},{"style":510},[6189],{"type":406,"value":1596},{"type":400,"tag":491,"props":6191,"children":6192},{"style":770},[6193],{"type":406,"value":6161},{"type":400,"tag":491,"props":6195,"children":6196},{"style":510},[6197],{"type":406,"value":683},{"type":400,"tag":491,"props":6199,"children":6200},{"style":770},[6201],{"type":406,"value":6202},"%06d",{"type":400,"tag":491,"props":6204,"children":6205},{"style":770},[6206],{"type":406,"value":6207}," %s",{"type":400,"tag":491,"props":6209,"children":6210},{"style":770},[6211],{"type":406,"value":6207},{"type":400,"tag":491,"props":6213,"children":6214},{"style":504},[6215],{"type":406,"value":643},{"type":400,"tag":491,"props":6217,"children":6218},{"style":546},[6219],{"type":406,"value":4851},{"type":400,"tag":491,"props":6221,"children":6222},{"class":493,"line":819},[6223,6228,6232,6237,6242,6247],{"type":400,"tag":491,"props":6224,"children":6225},{"style":572},[6226],{"type":406,"value":6227},"              t",{"type":400,"tag":491,"props":6229,"children":6230},{"style":546},[6231],{"type":406,"value":683},{"type":400,"tag":491,"props":6233,"children":6234},{"style":572},[6235],{"type":406,"value":6236},"tm_year ",{"type":400,"tag":491,"props":6238,"children":6239},{"style":670},[6240],{"type":406,"value":6241},"+",{"type":400,"tag":491,"props":6243,"children":6244},{"style":832},[6245],{"type":406,"value":6246}," 1900",{"type":400,"tag":491,"props":6248,"children":6249},{"style":546},[6250],{"type":406,"value":4851},{"type":400,"tag":491,"props":6252,"children":6253},{"class":493,"line":842},[6254,6258,6262,6267,6271,6275],{"type":400,"tag":491,"props":6255,"children":6256},{"style":572},[6257],{"type":406,"value":6227},{"type":400,"tag":491,"props":6259,"children":6260},{"style":546},[6261],{"type":406,"value":683},{"type":400,"tag":491,"props":6263,"children":6264},{"style":572},[6265],{"type":406,"value":6266},"tm_mon ",{"type":400,"tag":491,"props":6268,"children":6269},{"style":670},[6270],{"type":406,"value":6241},{"type":400,"tag":491,"props":6272,"children":6273},{"style":832},[6274],{"type":406,"value":3049},{"type":400,"tag":491,"props":6276,"children":6277},{"style":546},[6278],{"type":406,"value":4851},{"type":400,"tag":491,"props":6280,"children":6281},{"class":493,"line":851},[6282,6286,6290,6295],{"type":400,"tag":491,"props":6283,"children":6284},{"style":572},[6285],{"type":406,"value":6227},{"type":400,"tag":491,"props":6287,"children":6288},{"style":546},[6289],{"type":406,"value":683},{"type":400,"tag":491,"props":6291,"children":6292},{"style":572},[6293],{"type":406,"value":6294},"tm_mday",{"type":400,"tag":491,"props":6296,"children":6297},{"style":546},[6298],{"type":406,"value":4851},{"type":400,"tag":491,"props":6300,"children":6301},{"class":493,"line":859},[6302,6306,6310,6315],{"type":400,"tag":491,"props":6303,"children":6304},{"style":572},[6305],{"type":406,"value":6227},{"type":400,"tag":491,"props":6307,"children":6308},{"style":546},[6309],{"type":406,"value":683},{"type":400,"tag":491,"props":6311,"children":6312},{"style":572},[6313],{"type":406,"value":6314},"tm_hour",{"type":400,"tag":491,"props":6316,"children":6317},{"style":546},[6318],{"type":406,"value":4851},{"type":400,"tag":491,"props":6320,"children":6321},{"class":493,"line":902},[6322,6326,6330,6335],{"type":400,"tag":491,"props":6323,"children":6324},{"style":572},[6325],{"type":406,"value":6227},{"type":400,"tag":491,"props":6327,"children":6328},{"style":546},[6329],{"type":406,"value":683},{"type":400,"tag":491,"props":6331,"children":6332},{"style":572},[6333],{"type":406,"value":6334},"tm_min",{"type":400,"tag":491,"props":6336,"children":6337},{"style":546},[6338],{"type":406,"value":4851},{"type":400,"tag":491,"props":6340,"children":6341},{"class":493,"line":943},[6342,6346,6350,6355],{"type":400,"tag":491,"props":6343,"children":6344},{"style":572},[6345],{"type":406,"value":6227},{"type":400,"tag":491,"props":6347,"children":6348},{"style":546},[6349],{"type":406,"value":683},{"type":400,"tag":491,"props":6351,"children":6352},{"style":572},[6353],{"type":406,"value":6354},"tm_sec",{"type":400,"tag":491,"props":6356,"children":6357},{"style":546},[6358],{"type":406,"value":4851},{"type":400,"tag":491,"props":6360,"children":6361},{"class":493,"line":951},[6362,6367,6371,6375,6379,6383,6387,6392,6397],{"type":400,"tag":491,"props":6363,"children":6364},{"style":670},[6365],{"type":406,"value":6366},"              static_cast\u003C",{"type":400,"tag":491,"props":6368,"children":6369},{"style":534},[6370],{"type":406,"value":537},{"type":400,"tag":491,"props":6372,"children":6373},{"style":670},[6374],{"type":406,"value":2478},{"type":400,"tag":491,"props":6376,"children":6377},{"style":546},[6378],{"type":406,"value":628},{"type":400,"tag":491,"props":6380,"children":6381},{"style":572},[6382],{"type":406,"value":5964},{"type":400,"tag":491,"props":6384,"children":6385},{"style":546},[6386],{"type":406,"value":683},{"type":400,"tag":491,"props":6388,"children":6389},{"style":572},[6390],{"type":406,"value":6391},"tv_usec",{"type":400,"tag":491,"props":6393,"children":6394},{"style":546},[6395],{"type":406,"value":6396},"),",{"type":400,"tag":491,"props":6398,"children":6399},{"style":1500},[6400],{"type":406,"value":6401}," // 毫秒\n",{"type":400,"tag":491,"props":6403,"children":6404},{"class":493,"line":972},[6405,6410,6414,6418,6422,6426],{"type":400,"tag":491,"props":6406,"children":6407},{"style":572},[6408],{"type":406,"value":6409},"              ss",{"type":400,"tag":491,"props":6411,"children":6412},{"style":546},[6413],{"type":406,"value":683},{"type":400,"tag":491,"props":6415,"children":6416},{"style":540},[6417],{"type":406,"value":3070},{"type":400,"tag":491,"props":6419,"children":6420},{"style":546},[6421],{"type":406,"value":806},{"type":400,"tag":491,"props":6423,"children":6424},{"style":540},[6425],{"type":406,"value":811},{"type":400,"tag":491,"props":6427,"children":6428},{"style":546},[6429],{"type":406,"value":5869},{"type":400,"tag":491,"props":6431,"children":6432},{"class":493,"line":1028},[6433,6438],{"type":400,"tag":491,"props":6434,"children":6435},{"style":572},[6436],{"type":406,"value":6437},"              logname",{"type":400,"tag":491,"props":6439,"children":6440},{"style":546},[6441],{"type":406,"value":658},{"type":400,"tag":6443,"props":6444,"children":6445},"style",{},[6446],{"type":406,"value":6447},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":394,"searchDepth":521,"depth":521,"links":6449},[6450,6451,6452,6453],{"id":410,"depth":521,"text":410},{"id":471,"depth":521,"text":471},{"id":3453,"depth":521,"text":3453},{"id":3466,"depth":521,"text":3466},"markdown","content:8.source-code:_cpp:kingdb.md","content","8.source-code/_cpp/kingdb.md","md",[6460,6461],{"_path":371,"title":370,"description":394},{"_path":6462,"title":6463,"description":394},"/source-code/_es/array-slice","Array.prototype.slice",1718301092352]