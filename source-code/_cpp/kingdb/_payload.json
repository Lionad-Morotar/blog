[{"data":1,"prerenderedAt":6469},["ShallowReactive",2],{"navigation":3,"/source-code/_cpp/kingdb":393,"/source-code/_cpp/kingdb-surround":6464},[4,35,86,105,132,138,144,150,387],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29,32],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🚝 四十二篇系列","/flows/fourty-two",{"title":15,"_path":16},"🌃 长夜梦","/flows/long-night-dream",{"title":18,"_path":19},"🌌 万物联结与幸福感","/flows/everything",{"title":21,"_path":22},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":24,"_path":25},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":27,"_path":28},"🌧️ 我的腼腆","/flows/shy",{"title":30,"_path":31},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":33,"_path":34},"📝 心流归档","/flows/archive",{"title":36,"_path":37,"children":38},"技术博客 / Coder","/articles",[39,41,44,47,50,53,56,59,62,65,68,71,74,77,80,83],{"title":40,"_path":37},"🦁 欢迎",{"title":42,"_path":43},"🥞 在 tailwind 中使用现代化 CSS Layers","/articles/tailwind-sass-and-css-layer",{"title":45,"_path":46},"💻 本地部署 Qwen 翻译网页","/articles/local-translator",{"title":48,"_path":49},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":51,"_path":52},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":54,"_path":55},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":57,"_path":58},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":60,"_path":61},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":63,"_path":64},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":66,"_path":67},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":69,"_path":70},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":72,"_path":73},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":75,"_path":76},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":78,"_path":79},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":81,"_path":82},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":84,"_path":85},"📝 技术博客归档","/articles/archive",{"title":87,"_path":88,"children":89},"造物 / Make","/tools",[90,93,96,99,102],{"title":91,"_path":92},"🥥 Coconut","/tools/coconut",{"title":94,"_path":95},"🧶 网易云音乐歌单排序","/tools/netease-sorter",{"title":97,"_path":98},"🌐 AnySort","/tools/anysort",{"title":100,"_path":101},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":103,"_path":104},"👓 Crapto","/tools/crypto-inline",{"title":106,"_path":107,"children":108},"吉他剧场 / Music","/music",[109,111,114,117,120,123,126,129],{"title":110,"_path":107},"🎸 FingerStyle！",{"title":112,"_path":113},"🌬️ 等待的风","/music/wind",{"title":115,"_path":116},"💕 约定的海洋","/music/ocean",{"title":118,"_path":119},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":121,"_path":122},"🌏 残酷天使的行动纲领","/music/eva",{"title":124,"_path":125},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":127,"_path":128},"🍷 Wu Wei","/music/wu-wei",{"title":130,"_path":131},"🌅 无题","/music/untitled",{"title":133,"_path":134,"children":135},"画点什么 / Paint","/paint",[136],{"title":137,"_path":134},"🚧 正在施工",{"title":139,"_path":140,"children":141},"读书笔记 / Notes","/books",[142],{"title":143,"_path":140},"📕 读书笔记",{"title":145,"_path":146,"children":147},"知识地图 / Maps","/maps",[148],{"title":149,"_path":146},"🏁 知识地图",{"title":151,"_path":152,"children":153},"零散的笔记 / Gists","/gists",[154,156,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255,258,261,264,267,270,273,276,279,282,285,288,291,294,297,300,303,306,309,312,315,318,321,324,327,330,333,336,339,342,345,348,351,354,357,360,363,366,369,372,375,378,381,384],{"title":155,"_path":152},"🧊 Gists",{"title":157,"_path":158},"网站的可访问性","/gists/accessibility",{"title":160,"_path":161},"Bit","/gists/bit",{"title":163,"_path":164},"图片模糊","/gists/blur",{"title":166,"_path":167},"渲染相关笔记","/gists/c4d",{"title":169,"_path":170},"CDN 问题记录","/gists/cdn",{"title":172,"_path":173},"消毒剂","/gists/cleaner",{"title":175,"_path":176},"Windows Command","/gists/cmd",{"title":178,"_path":179},"Command","/gists/command",{"title":181,"_path":182},"复杂科学","/gists/complexity-science",{"title":184,"_path":185},"GitHub Copilot","/gists/copilot",{"title":187,"_path":188},"宇宙","/gists/cosmos",{"title":190,"_path":191},"C++","/gists/cpp",{"title":193,"_path":194},"DEPRESSION","/gists/depression",{"title":196,"_path":197},"Developer Experience","/gists/developer-experience",{"title":199,"_path":200},"Device Metrics","/gists/device-metrix",{"title":202,"_path":203},"数字化转型","/gists/digital-transformation",{"title":205,"_path":206},"ECMAScript Language Specification","/gists/ecmascript-specification",{"title":208,"_path":209},"正则表达式","/gists/eegex",{"title":211,"_path":212},"Emoji","/gists/emoji",{"title":214,"_path":215},"工程","/gists/engineering",{"title":217,"_path":218},"熵","/gists/entropy",{"title":220,"_path":221},"Environment","/gists/environment",{"title":223,"_path":224},"Erlang","/gists/erlang",{"title":226,"_path":227},"逃离塔克夫","/gists/escape-from-tarkov",{"title":229,"_path":230},"ESNext (ES6-ES11)","/gists/esnext",{"title":232,"_path":233},"Eval！","/gists/eval",{"title":235,"_path":236},"Flutter","/gists/flutter",{"title":238,"_path":239},"字体","/gists/font",{"title":241,"_path":242},"JS 函数式编程","/gists/functional",{"title":244,"_path":245},"游戏化","/gists/gamification",{"title":247,"_path":248},"Google C++ Standard","/gists/google-cpp-standard",{"title":250,"_path":251},"双向链接完全体","/gists/graph",{"title":253,"_path":254},"Hardwares","/gists/hardwares",{"title":256,"_path":257},"哈希冲突","/gists/hash-collision",{"title":259,"_path":260},"信息设计","/gists/information-design",{"title":262,"_path":263},"InstantPage","/gists/instant.page",{"title":265,"_path":266},"ISUX 遇见大数据可视化系列","/gists/isux-data-visualization",{"title":268,"_path":269},"KVStore","/gists/key-value-db",{"title":271,"_path":272},"Kubernetes","/gists/kubernetes",{"title":274,"_path":275},"Makefile","/gists/makefile",{"title":277,"_path":278},"Markdown Inline Style","/gists/markdown-nice",{"title":280,"_path":281},"小程序","/gists/miniapp",{"title":283,"_path":284},"减小页面快照体积","/gists/minify-html",{"title":286,"_path":287},"mklink","/gists/mklink",{"title":289,"_path":290},"Mock","/gists/mock",{"title":292,"_path":293},"多人协作系统","/gists/multiplayer",{"title":295,"_path":296},"多端应用","/gists/multy-end-app",{"title":298,"_path":299},"神经科学","/gists/neuroscience",{"title":301,"_path":302},"Opinioned Personal Folder","/gists/opinioned-personal-folder",{"title":304,"_path":305},"PInvoke","/gists/pinvoke",{"title":307,"_path":308},"像素","/gists/pixel",{"title":310,"_path":311},"PowerShell","/gists/powershell",{"title":313,"_path":314},"量子","/gists/quantum",{"title":316,"_path":317},"保持好奇心","/gists/questions",{"title":319,"_path":320},"React Native","/gists/react-native",{"title":322,"_path":323},"博客改版碰到的浏览器平滑滚动问题","/gists/scroll",{"title":325,"_path":326},"SEO","/gists/seo",{"title":328,"_path":329},"Shader","/gists/shader",{"title":331,"_path":332},"Shape Up","/gists/shape-up",{"title":334,"_path":335},"睡觉","/gists/sleep",{"title":337,"_path":338},"记录奇怪的问题","/gists/solved",{"title":340,"_path":341},"States","/gists/states",{"title":343,"_path":344},"Storage","/gists/storage",{"title":346,"_path":347},"音视频流处理","/gists/stream-cli",{"title":349,"_path":350},"Symbol","/gists/symbol",{"title":352,"_path":353},"系统论","/gists/systems-theory",{"title":355,"_path":356},"Taro","/gists/taro",{"title":358,"_path":359},"任务切片","/gists/task-slice",{"title":361,"_path":362},"技术偏好","/gists/tech-dudge",{"title":364,"_path":365},"Untitled","/gists/untitled",{"title":367,"_path":368},"可变字体","/gists/variable-font",{"title":370,"_path":371},"视觉错觉","/gists/visual-illusion",{"title":373,"_path":374},"SS(SSR)","/gists/vpn",{"title":376,"_path":377},"VS Code 插件开发","/gists/vscode-plugin",{"title":379,"_path":380},"Web Components","/gists/web-components",{"title":382,"_path":383},"Windows","/gists/windows",{"title":385,"_path":386},"查缺补漏","/gists/wrong",{"title":388,"_path":389,"children":390},"我 / About","/hire",[391],{"title":392,"_path":389},"📬 技术简历",{"_path":394,"_dir":395,"_draft":396,"_partial":397,"_locale":398,"title":399,"description":398,"body":400,"_type":6458,"_id":6459,"_source":6460,"_file":6461,"_stem":6462,"_extension":6463},"/source-code/_cpp/kingdb","_cpp",false,true,"","KingDB",{"type":401,"children":402,"toc":6452},"root",[403,411,417,423,439,444,468,473,478,483,1342,1347,1355,1360,1365,1370,1376,1381,1802,1807,1812,2262,2267,2368,2373,2378,2383,2921,2927,2932,3199,3205,3210,3455,3460,3473,3478,3745,3750,3755,4466,4471,4652,4656,4661,5279,5284,5289,5342,5347,5366,5739,5744,5909,5914,5919,6446],{"type":404,"tag":405,"props":406,"children":408},"element","h1",{"id":407},"kingdb",[409],{"type":410,"value":399},"text",{"type":404,"tag":412,"props":413,"children":415},"h2",{"id":414},"概述",[416],{"type":410,"value":414},{"type":404,"tag":418,"props":419,"children":420},"p",{},[421],{"type":410,"value":422},"源码分两部分，从相关的测试文件，到核心源码。参考 IKVS 系列文章给的架构图，核心源码的阅读顺序沿着 Put、Delete、Get 三个接口，由 Database 一路向 Buffer、Event Manager、Storage Engine、HSTable Manager、File System 相关、Index 前进。最好再看相关快照、迭代器、Multipart 等部分。期间如果遇到简单的帮助函数会先讲帮助函数。",{"type":404,"tag":418,"props":424,"children":425},{},[426,428,437],{"type":410,"value":427},"本来想从第一个 Git Commit 开始看起的。但我 checkout 过去之后，碰到了一堆编译问题，根本跑不通，索性就直接回到 master 来看最新代码了。本文章的源码快照见 ",{"type":404,"tag":429,"props":430,"children":434},"a",{"href":431,"rel":432},"https://github.com/goossaert/kingdb/tree/58994280e789fc7248d61371f03a6c04c844c197",[433],"nofollow",[435],{"type":410,"value":436},"KingDB@58994",{"type":410,"value":438},"。阅读源码前可以先看一下 KingDB 的 Readme：doc/kingdb.md 以及 doc/kingserver.md。",{"type":404,"tag":418,"props":440,"children":441},{},[442],{"type":410,"value":443},"下文可能出现的缩写：",{"type":404,"tag":445,"props":446,"children":447},"ul",{},[448,454],{"type":404,"tag":449,"props":450,"children":451},"li",{},[452],{"type":410,"value":453},"KDB：KingDB，泛指，有时指 KingDB 程序，有时指 KingDB 源码。",{"type":404,"tag":449,"props":455,"children":456},{},[457,459,466],{"type":410,"value":458},"IKVS：作者相关 KingDB 做的一些调研及笔记的博客系列。这个系列从 13 年开始写，现在还没写完... 见 ",{"type":404,"tag":429,"props":460,"children":463},{"href":461,"rel":462},"https://codecapsule.com/2012/11/07/ikvs-implementing-a-key-value-store-table-of-contents/",[433],[464],{"type":410,"value":465},"IKVS",{"type":410,"value":467},"。",{"type":404,"tag":418,"props":469,"children":470},{},[471],{"type":410,"value":472},"另，为了简便起见，下文给出的代码很可能并非原本的代码，而是截取或经过剔除后的部分代码。比如说，去除了某函数中的错误处理，使之代码更短，更容易展示。",{"type":404,"tag":412,"props":474,"children":476},{"id":475},"从测试开始",[477],{"type":410,"value":475},{"type":404,"tag":418,"props":479,"children":480},{},[481],{"type":410,"value":482},"Emmanuel 给了一个典型的 KDB 用户使用示例，见 unit-tests/kingdb_user.cc。通过此示例，能大概了解 KDB 的接口及如何使用该接口。创建数据库、存入、读取前都需要创建对应的参数配置 Options；这些动作通过 Status 对象来回传操作成功与否。",{"type":404,"tag":484,"props":485,"children":489},"pre",{"code":486,"language":487,"meta":398,"className":488,"style":398},"#include \u003Ckingdb/kdb.h>\n\nint main() {\n  kdb::Status s;\n  kdb::DatabaseOptions db_options;\n  kdb::Database db(db_options, \"mylocaldb\");\n  s = db.Open();\n  if (!s.IsOK()) {\n    fprintf(stderr, \"Could not open the database: %s\\n\", s.ToString().c_str());\n    exit(1);\n  }\n\n  std::string key1(\"key1\");\n  std::string value1(\"value1\");\n\n  kdb::WriteOptions write_options;\n  s = db.Put(write_options, key1, value1);\n\n  kdb::ReadOptions read_options;\n  std::string out_str;\n  s = db.Get(read_options, key1, &out_str);\n  if (s.IsOK() && out_str == \"value1\") {\n    printf(\"Data successfully stored and retrieved\\n\"); \n  } else {\n    printf(\"An error occurred\\n\"); \n  }\n\n  return 0;\n}\n","cpp","language-cpp shiki shiki-themes material-theme-lighter github-light github-dark monokai",[490],{"type":404,"tag":491,"props":492,"children":493},"code",{"__ignoreMap":398},[494,523,532,559,585,606,663,698,740,821,844,853,861,904,945,953,974,1030,1038,1059,1080,1140,1204,1244,1262,1299,1307,1315,1333],{"type":404,"tag":495,"props":496,"children":499},"span",{"class":497,"line":498},"line",1,[500,506,512,518],{"type":404,"tag":495,"props":501,"children":503},{"style":502},"--shiki-light:#39ADB5;--shiki-light-font-style:italic;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#F92672;--shiki-sepia-font-style:inherit",[504],{"type":410,"value":505},"#include",{"type":404,"tag":495,"props":507,"children":509},{"style":508},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[510],{"type":410,"value":511}," \u003C",{"type":404,"tag":495,"props":513,"children":515},{"style":514},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[516],{"type":410,"value":517},"kingdb/kdb.h",{"type":404,"tag":495,"props":519,"children":520},{"style":508},[521],{"type":410,"value":522},">\n",{"type":404,"tag":495,"props":524,"children":526},{"class":497,"line":525},2,[527],{"type":404,"tag":495,"props":528,"children":529},{"emptyLinePlaceholder":397},[530],{"type":410,"value":531},"\n",{"type":404,"tag":495,"props":533,"children":535},{"class":497,"line":534},3,[536,542,548,554],{"type":404,"tag":495,"props":537,"children":539},{"style":538},"--shiki-light:#9C3EDA;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic",[540],{"type":410,"value":541},"int",{"type":404,"tag":495,"props":543,"children":545},{"style":544},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[546],{"type":410,"value":547}," main",{"type":404,"tag":495,"props":549,"children":551},{"style":550},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[552],{"type":410,"value":553},"()",{"type":404,"tag":495,"props":555,"children":556},{"style":550},[557],{"type":410,"value":558}," {\n",{"type":404,"tag":495,"props":560,"children":562},{"class":497,"line":561},4,[563,569,574,580],{"type":404,"tag":495,"props":564,"children":566},{"style":565},"--shiki-light:#E2931D;--shiki-light-text-decoration:inherit;--shiki-default:#6F42C1;--shiki-default-text-decoration:inherit;--shiki-dark:#B392F0;--shiki-dark-text-decoration:inherit;--shiki-sepia:#A6E22E;--shiki-sepia-text-decoration:underline",[567],{"type":410,"value":568},"  kdb",{"type":404,"tag":495,"props":570,"children":571},{"style":550},[572],{"type":410,"value":573},"::",{"type":404,"tag":495,"props":575,"children":577},{"style":576},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[578],{"type":410,"value":579},"Status s",{"type":404,"tag":495,"props":581,"children":582},{"style":550},[583],{"type":410,"value":584},";\n",{"type":404,"tag":495,"props":586,"children":588},{"class":497,"line":587},5,[589,593,597,602],{"type":404,"tag":495,"props":590,"children":591},{"style":565},[592],{"type":410,"value":568},{"type":404,"tag":495,"props":594,"children":595},{"style":550},[596],{"type":410,"value":573},{"type":404,"tag":495,"props":598,"children":599},{"style":576},[600],{"type":410,"value":601},"DatabaseOptions db_options",{"type":404,"tag":495,"props":603,"children":604},{"style":550},[605],{"type":410,"value":584},{"type":404,"tag":495,"props":607,"children":609},{"class":497,"line":608},6,[610,614,618,623,628,633,638,643,648,653,658],{"type":404,"tag":495,"props":611,"children":612},{"style":565},[613],{"type":410,"value":568},{"type":404,"tag":495,"props":615,"children":616},{"style":550},[617],{"type":410,"value":573},{"type":404,"tag":495,"props":619,"children":620},{"style":576},[621],{"type":410,"value":622},"Database ",{"type":404,"tag":495,"props":624,"children":625},{"style":544},[626],{"type":410,"value":627},"db",{"type":404,"tag":495,"props":629,"children":630},{"style":550},[631],{"type":410,"value":632},"(",{"type":404,"tag":495,"props":634,"children":635},{"style":576},[636],{"type":410,"value":637},"db_options",{"type":404,"tag":495,"props":639,"children":640},{"style":550},[641],{"type":410,"value":642},",",{"type":404,"tag":495,"props":644,"children":645},{"style":508},[646],{"type":410,"value":647}," \"",{"type":404,"tag":495,"props":649,"children":650},{"style":514},[651],{"type":410,"value":652},"mylocaldb",{"type":404,"tag":495,"props":654,"children":655},{"style":508},[656],{"type":410,"value":657},"\"",{"type":404,"tag":495,"props":659,"children":660},{"style":550},[661],{"type":410,"value":662},");\n",{"type":404,"tag":495,"props":664,"children":666},{"class":497,"line":665},7,[667,672,678,683,688,693],{"type":404,"tag":495,"props":668,"children":669},{"style":576},[670],{"type":410,"value":671},"  s ",{"type":404,"tag":495,"props":673,"children":675},{"style":674},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[676],{"type":410,"value":677},"=",{"type":404,"tag":495,"props":679,"children":680},{"style":576},[681],{"type":410,"value":682}," db",{"type":404,"tag":495,"props":684,"children":685},{"style":550},[686],{"type":410,"value":687},".",{"type":404,"tag":495,"props":689,"children":690},{"style":544},[691],{"type":410,"value":692},"Open",{"type":404,"tag":495,"props":694,"children":695},{"style":550},[696],{"type":410,"value":697},"();\n",{"type":404,"tag":495,"props":699,"children":701},{"class":497,"line":700},8,[702,707,712,717,722,726,731,736],{"type":404,"tag":495,"props":703,"children":704},{"style":502},[705],{"type":410,"value":706},"  if",{"type":404,"tag":495,"props":708,"children":709},{"style":550},[710],{"type":410,"value":711}," (",{"type":404,"tag":495,"props":713,"children":714},{"style":674},[715],{"type":410,"value":716},"!",{"type":404,"tag":495,"props":718,"children":719},{"style":576},[720],{"type":410,"value":721},"s",{"type":404,"tag":495,"props":723,"children":724},{"style":550},[725],{"type":410,"value":687},{"type":404,"tag":495,"props":727,"children":728},{"style":544},[729],{"type":410,"value":730},"IsOK",{"type":404,"tag":495,"props":732,"children":733},{"style":550},[734],{"type":410,"value":735},"())",{"type":404,"tag":495,"props":737,"children":738},{"style":550},[739],{"type":410,"value":558},{"type":404,"tag":495,"props":741,"children":743},{"class":497,"line":742},9,[744,749,753,759,763,767,772,778,784,788,792,797,801,806,811,816],{"type":404,"tag":495,"props":745,"children":746},{"style":544},[747],{"type":410,"value":748},"    fprintf",{"type":404,"tag":495,"props":750,"children":751},{"style":550},[752],{"type":410,"value":632},{"type":404,"tag":495,"props":754,"children":756},{"style":755},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[757],{"type":410,"value":758},"stderr",{"type":404,"tag":495,"props":760,"children":761},{"style":550},[762],{"type":410,"value":642},{"type":404,"tag":495,"props":764,"children":765},{"style":508},[766],{"type":410,"value":647},{"type":404,"tag":495,"props":768,"children":769},{"style":514},[770],{"type":410,"value":771},"Could not open the database: ",{"type":404,"tag":495,"props":773,"children":775},{"style":774},"--shiki-light:#E53935;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[776],{"type":410,"value":777},"%s",{"type":404,"tag":495,"props":779,"children":781},{"style":780},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[782],{"type":410,"value":783},"\\n",{"type":404,"tag":495,"props":785,"children":786},{"style":508},[787],{"type":410,"value":657},{"type":404,"tag":495,"props":789,"children":790},{"style":550},[791],{"type":410,"value":642},{"type":404,"tag":495,"props":793,"children":794},{"style":576},[795],{"type":410,"value":796}," s",{"type":404,"tag":495,"props":798,"children":799},{"style":550},[800],{"type":410,"value":687},{"type":404,"tag":495,"props":802,"children":803},{"style":544},[804],{"type":410,"value":805},"ToString",{"type":404,"tag":495,"props":807,"children":808},{"style":550},[809],{"type":410,"value":810},"().",{"type":404,"tag":495,"props":812,"children":813},{"style":544},[814],{"type":410,"value":815},"c_str",{"type":404,"tag":495,"props":817,"children":818},{"style":550},[819],{"type":410,"value":820},"());\n",{"type":404,"tag":495,"props":822,"children":824},{"class":497,"line":823},10,[825,830,834,840],{"type":404,"tag":495,"props":826,"children":827},{"style":544},[828],{"type":410,"value":829},"    exit",{"type":404,"tag":495,"props":831,"children":832},{"style":550},[833],{"type":410,"value":632},{"type":404,"tag":495,"props":835,"children":837},{"style":836},"--shiki-light:#F76D47;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[838],{"type":410,"value":839},"1",{"type":404,"tag":495,"props":841,"children":842},{"style":550},[843],{"type":410,"value":662},{"type":404,"tag":495,"props":845,"children":847},{"class":497,"line":846},11,[848],{"type":404,"tag":495,"props":849,"children":850},{"style":550},[851],{"type":410,"value":852},"  }\n",{"type":404,"tag":495,"props":854,"children":856},{"class":497,"line":855},12,[857],{"type":404,"tag":495,"props":858,"children":859},{"emptyLinePlaceholder":397},[860],{"type":410,"value":531},{"type":404,"tag":495,"props":862,"children":864},{"class":497,"line":863},13,[865,870,874,879,884,888,892,896,900],{"type":404,"tag":495,"props":866,"children":867},{"style":565},[868],{"type":410,"value":869},"  std",{"type":404,"tag":495,"props":871,"children":872},{"style":550},[873],{"type":410,"value":573},{"type":404,"tag":495,"props":875,"children":876},{"style":576},[877],{"type":410,"value":878},"string ",{"type":404,"tag":495,"props":880,"children":881},{"style":544},[882],{"type":410,"value":883},"key1",{"type":404,"tag":495,"props":885,"children":886},{"style":550},[887],{"type":410,"value":632},{"type":404,"tag":495,"props":889,"children":890},{"style":508},[891],{"type":410,"value":657},{"type":404,"tag":495,"props":893,"children":894},{"style":514},[895],{"type":410,"value":883},{"type":404,"tag":495,"props":897,"children":898},{"style":508},[899],{"type":410,"value":657},{"type":404,"tag":495,"props":901,"children":902},{"style":550},[903],{"type":410,"value":662},{"type":404,"tag":495,"props":905,"children":907},{"class":497,"line":906},14,[908,912,916,920,925,929,933,937,941],{"type":404,"tag":495,"props":909,"children":910},{"style":565},[911],{"type":410,"value":869},{"type":404,"tag":495,"props":913,"children":914},{"style":550},[915],{"type":410,"value":573},{"type":404,"tag":495,"props":917,"children":918},{"style":576},[919],{"type":410,"value":878},{"type":404,"tag":495,"props":921,"children":922},{"style":544},[923],{"type":410,"value":924},"value1",{"type":404,"tag":495,"props":926,"children":927},{"style":550},[928],{"type":410,"value":632},{"type":404,"tag":495,"props":930,"children":931},{"style":508},[932],{"type":410,"value":657},{"type":404,"tag":495,"props":934,"children":935},{"style":514},[936],{"type":410,"value":924},{"type":404,"tag":495,"props":938,"children":939},{"style":508},[940],{"type":410,"value":657},{"type":404,"tag":495,"props":942,"children":943},{"style":550},[944],{"type":410,"value":662},{"type":404,"tag":495,"props":946,"children":948},{"class":497,"line":947},15,[949],{"type":404,"tag":495,"props":950,"children":951},{"emptyLinePlaceholder":397},[952],{"type":410,"value":531},{"type":404,"tag":495,"props":954,"children":956},{"class":497,"line":955},16,[957,961,965,970],{"type":404,"tag":495,"props":958,"children":959},{"style":565},[960],{"type":410,"value":568},{"type":404,"tag":495,"props":962,"children":963},{"style":550},[964],{"type":410,"value":573},{"type":404,"tag":495,"props":966,"children":967},{"style":576},[968],{"type":410,"value":969},"WriteOptions write_options",{"type":404,"tag":495,"props":971,"children":972},{"style":550},[973],{"type":410,"value":584},{"type":404,"tag":495,"props":975,"children":977},{"class":497,"line":976},17,[978,982,986,990,994,999,1003,1008,1012,1017,1021,1026],{"type":404,"tag":495,"props":979,"children":980},{"style":576},[981],{"type":410,"value":671},{"type":404,"tag":495,"props":983,"children":984},{"style":674},[985],{"type":410,"value":677},{"type":404,"tag":495,"props":987,"children":988},{"style":576},[989],{"type":410,"value":682},{"type":404,"tag":495,"props":991,"children":992},{"style":550},[993],{"type":410,"value":687},{"type":404,"tag":495,"props":995,"children":996},{"style":544},[997],{"type":410,"value":998},"Put",{"type":404,"tag":495,"props":1000,"children":1001},{"style":550},[1002],{"type":410,"value":632},{"type":404,"tag":495,"props":1004,"children":1005},{"style":576},[1006],{"type":410,"value":1007},"write_options",{"type":404,"tag":495,"props":1009,"children":1010},{"style":550},[1011],{"type":410,"value":642},{"type":404,"tag":495,"props":1013,"children":1014},{"style":576},[1015],{"type":410,"value":1016}," key1",{"type":404,"tag":495,"props":1018,"children":1019},{"style":550},[1020],{"type":410,"value":642},{"type":404,"tag":495,"props":1022,"children":1023},{"style":576},[1024],{"type":410,"value":1025}," value1",{"type":404,"tag":495,"props":1027,"children":1028},{"style":550},[1029],{"type":410,"value":662},{"type":404,"tag":495,"props":1031,"children":1033},{"class":497,"line":1032},18,[1034],{"type":404,"tag":495,"props":1035,"children":1036},{"emptyLinePlaceholder":397},[1037],{"type":410,"value":531},{"type":404,"tag":495,"props":1039,"children":1041},{"class":497,"line":1040},19,[1042,1046,1050,1055],{"type":404,"tag":495,"props":1043,"children":1044},{"style":565},[1045],{"type":410,"value":568},{"type":404,"tag":495,"props":1047,"children":1048},{"style":550},[1049],{"type":410,"value":573},{"type":404,"tag":495,"props":1051,"children":1052},{"style":576},[1053],{"type":410,"value":1054},"ReadOptions read_options",{"type":404,"tag":495,"props":1056,"children":1057},{"style":550},[1058],{"type":410,"value":584},{"type":404,"tag":495,"props":1060,"children":1062},{"class":497,"line":1061},20,[1063,1067,1071,1076],{"type":404,"tag":495,"props":1064,"children":1065},{"style":565},[1066],{"type":410,"value":869},{"type":404,"tag":495,"props":1068,"children":1069},{"style":550},[1070],{"type":410,"value":573},{"type":404,"tag":495,"props":1072,"children":1073},{"style":576},[1074],{"type":410,"value":1075},"string out_str",{"type":404,"tag":495,"props":1077,"children":1078},{"style":550},[1079],{"type":410,"value":584},{"type":404,"tag":495,"props":1081,"children":1083},{"class":497,"line":1082},21,[1084,1088,1092,1096,1100,1105,1109,1114,1118,1122,1126,1131,1136],{"type":404,"tag":495,"props":1085,"children":1086},{"style":576},[1087],{"type":410,"value":671},{"type":404,"tag":495,"props":1089,"children":1090},{"style":674},[1091],{"type":410,"value":677},{"type":404,"tag":495,"props":1093,"children":1094},{"style":576},[1095],{"type":410,"value":682},{"type":404,"tag":495,"props":1097,"children":1098},{"style":550},[1099],{"type":410,"value":687},{"type":404,"tag":495,"props":1101,"children":1102},{"style":544},[1103],{"type":410,"value":1104},"Get",{"type":404,"tag":495,"props":1106,"children":1107},{"style":550},[1108],{"type":410,"value":632},{"type":404,"tag":495,"props":1110,"children":1111},{"style":576},[1112],{"type":410,"value":1113},"read_options",{"type":404,"tag":495,"props":1115,"children":1116},{"style":550},[1117],{"type":410,"value":642},{"type":404,"tag":495,"props":1119,"children":1120},{"style":576},[1121],{"type":410,"value":1016},{"type":404,"tag":495,"props":1123,"children":1124},{"style":550},[1125],{"type":410,"value":642},{"type":404,"tag":495,"props":1127,"children":1128},{"style":674},[1129],{"type":410,"value":1130}," &",{"type":404,"tag":495,"props":1132,"children":1133},{"style":576},[1134],{"type":410,"value":1135},"out_str",{"type":404,"tag":495,"props":1137,"children":1138},{"style":550},[1139],{"type":410,"value":662},{"type":404,"tag":495,"props":1141,"children":1143},{"class":497,"line":1142},22,[1144,1148,1152,1156,1160,1164,1168,1173,1178,1183,1187,1191,1195,1200],{"type":404,"tag":495,"props":1145,"children":1146},{"style":502},[1147],{"type":410,"value":706},{"type":404,"tag":495,"props":1149,"children":1150},{"style":550},[1151],{"type":410,"value":711},{"type":404,"tag":495,"props":1153,"children":1154},{"style":576},[1155],{"type":410,"value":721},{"type":404,"tag":495,"props":1157,"children":1158},{"style":550},[1159],{"type":410,"value":687},{"type":404,"tag":495,"props":1161,"children":1162},{"style":544},[1163],{"type":410,"value":730},{"type":404,"tag":495,"props":1165,"children":1166},{"style":550},[1167],{"type":410,"value":553},{"type":404,"tag":495,"props":1169,"children":1170},{"style":674},[1171],{"type":410,"value":1172}," &&",{"type":404,"tag":495,"props":1174,"children":1175},{"style":576},[1176],{"type":410,"value":1177}," out_str ",{"type":404,"tag":495,"props":1179,"children":1180},{"style":674},[1181],{"type":410,"value":1182},"==",{"type":404,"tag":495,"props":1184,"children":1185},{"style":508},[1186],{"type":410,"value":647},{"type":404,"tag":495,"props":1188,"children":1189},{"style":514},[1190],{"type":410,"value":924},{"type":404,"tag":495,"props":1192,"children":1193},{"style":508},[1194],{"type":410,"value":657},{"type":404,"tag":495,"props":1196,"children":1197},{"style":550},[1198],{"type":410,"value":1199},")",{"type":404,"tag":495,"props":1201,"children":1202},{"style":550},[1203],{"type":410,"value":558},{"type":404,"tag":495,"props":1205,"children":1207},{"class":497,"line":1206},23,[1208,1213,1217,1221,1226,1230,1234,1239],{"type":404,"tag":495,"props":1209,"children":1210},{"style":544},[1211],{"type":410,"value":1212},"    printf",{"type":404,"tag":495,"props":1214,"children":1215},{"style":550},[1216],{"type":410,"value":632},{"type":404,"tag":495,"props":1218,"children":1219},{"style":508},[1220],{"type":410,"value":657},{"type":404,"tag":495,"props":1222,"children":1223},{"style":514},[1224],{"type":410,"value":1225},"Data successfully stored and retrieved",{"type":404,"tag":495,"props":1227,"children":1228},{"style":780},[1229],{"type":410,"value":783},{"type":404,"tag":495,"props":1231,"children":1232},{"style":508},[1233],{"type":410,"value":657},{"type":404,"tag":495,"props":1235,"children":1236},{"style":550},[1237],{"type":410,"value":1238},");",{"type":404,"tag":495,"props":1240,"children":1241},{"style":755},[1242],{"type":410,"value":1243}," \n",{"type":404,"tag":495,"props":1245,"children":1247},{"class":497,"line":1246},24,[1248,1253,1258],{"type":404,"tag":495,"props":1249,"children":1250},{"style":550},[1251],{"type":410,"value":1252},"  }",{"type":404,"tag":495,"props":1254,"children":1255},{"style":502},[1256],{"type":410,"value":1257}," else",{"type":404,"tag":495,"props":1259,"children":1260},{"style":550},[1261],{"type":410,"value":558},{"type":404,"tag":495,"props":1263,"children":1265},{"class":497,"line":1264},25,[1266,1270,1274,1278,1283,1287,1291,1295],{"type":404,"tag":495,"props":1267,"children":1268},{"style":544},[1269],{"type":410,"value":1212},{"type":404,"tag":495,"props":1271,"children":1272},{"style":550},[1273],{"type":410,"value":632},{"type":404,"tag":495,"props":1275,"children":1276},{"style":508},[1277],{"type":410,"value":657},{"type":404,"tag":495,"props":1279,"children":1280},{"style":514},[1281],{"type":410,"value":1282},"An error occurred",{"type":404,"tag":495,"props":1284,"children":1285},{"style":780},[1286],{"type":410,"value":783},{"type":404,"tag":495,"props":1288,"children":1289},{"style":508},[1290],{"type":410,"value":657},{"type":404,"tag":495,"props":1292,"children":1293},{"style":550},[1294],{"type":410,"value":1238},{"type":404,"tag":495,"props":1296,"children":1297},{"style":755},[1298],{"type":410,"value":1243},{"type":404,"tag":495,"props":1300,"children":1302},{"class":497,"line":1301},26,[1303],{"type":404,"tag":495,"props":1304,"children":1305},{"style":550},[1306],{"type":410,"value":852},{"type":404,"tag":495,"props":1308,"children":1310},{"class":497,"line":1309},27,[1311],{"type":404,"tag":495,"props":1312,"children":1313},{"emptyLinePlaceholder":397},[1314],{"type":410,"value":531},{"type":404,"tag":495,"props":1316,"children":1318},{"class":497,"line":1317},28,[1319,1324,1329],{"type":404,"tag":495,"props":1320,"children":1321},{"style":502},[1322],{"type":410,"value":1323},"  return",{"type":404,"tag":495,"props":1325,"children":1326},{"style":836},[1327],{"type":410,"value":1328}," 0",{"type":404,"tag":495,"props":1330,"children":1331},{"style":550},[1332],{"type":410,"value":584},{"type":404,"tag":495,"props":1334,"children":1336},{"class":497,"line":1335},29,[1337],{"type":404,"tag":495,"props":1338,"children":1339},{"style":550},[1340],{"type":410,"value":1341},"}\n",{"type":404,"tag":418,"props":1343,"children":1344},{},[1345],{"type":410,"value":1346},"测试的入口文件是 unit-tests/test_db.cc。以我看过的 JS 库来看，这是一个基本的功能测试。编译好 KDB 之后，运行编译出的二进制文件 test_db 可以开始测试。测试结果输出到控制台，如下代码所示。",{"type":404,"tag":484,"props":1348,"children":1350},{"code":1349},"==== Test DBTest.CloseAndReopen\n==== Test DBTest.RepairInvalidDatabaseOptionFile\n==== Test DBTest.KeysWithNullBytes\n==== Test DBTest.TestStringInterface\nDatabase Options: Stage 0 - Incompressible data with LZ4 compression enabled\nDatabase Options: Stage 1 - Compressible data with LZ4 compression enabled\nDatabase Options: Stage 2 - Compression disabled\nDatabase Options: Stage 3 - 64-bit MurmurHash3\nDatabase Options: Stage 4 - Checksum verification with incompressible data\nDatabase Options: Stage 5 - Checksum verification with compressible data\nDatabase Options: Stage 6 - Checksum verification with compression disabled\nDatabase Options: Stage 7 - Synced writes\nDatabase Options: Stage 8 - Small-sized HSTables with compression disabled\nDatabase Options: Stage 9 - Small-sized HSTables with incompressible data and LZ4 compression\nDatabase Options: Stage 10 - Small-sized HSTables with compressible data and LZ4 compression\nDatabase Options: Stage 11 - Direct mode for Write Buffer (incompressible data with LZ4 compression enabled)\nDatabase Options: Stage 12 - Direct mode for Write Buffer (compressible data with LZ4 compression enabled)\n==== Test DBTest.MultipartReader\n// the same with last stages\n==== Test DBTest.SingleThreadSmallEntries\n// the same with last stages\n==== Test DBTest.SingleThreadSnapshot\n// the same with last stages\n==== Test DBTest.SingleThreadSmallEntriesCompaction\n// the same with last stages\n==== Test DBTest.SequentialIterator\n// the same with last stages\n==== Test DBTest.SingleThreadSingleLargeEntry\n// the same with last stages\n==== Test DBTest.FileUtil\nmysize: 268435456\nOK\n89 ms\nFree size: 944 GB\n==== PASSED 11 tests\n",[1351],{"type":404,"tag":491,"props":1352,"children":1353},{"__ignoreMap":398},[1354],{"type":410,"value":1349},{"type":404,"tag":418,"props":1356,"children":1357},{},[1358],{"type":410,"value":1359},"每个功能点如数据库初始化和关闭 CloseAndReopen、存入带结束符的键 KeysWithNullBytes 都使用对应继承了 DBTest 的测试类进行测试。涉及到与数据库交互的功能部分如 TestStringInterface 使用循环，遍历了所有数据库 Options 可以设置的情况（但是只是二维循环，没有测试参数间的组合）。即对应上文的 Stage 1、Stage 2...",{"type":404,"tag":418,"props":1361,"children":1362},{},[1363],{"type":410,"value":1364},"在 test_db 创建相应的测试类时，会自动调用测试套件（unit-tests/testharness.cc）中的 RegisterTest 把测试函数储存起来。以便运行测试时，通过读取环境变量来判断是否要跳过某类测试。",{"type":404,"tag":418,"props":1366,"children":1367},{},[1368],{"type":410,"value":1369},"测试代码的实现还有一些有意思的地方，以下提及。",{"type":404,"tag":1371,"props":1372,"children":1374},"h4",{"id":1373},"信号处理",[1375],{"type":410,"value":1373},{"type":404,"tag":418,"props":1377,"children":1378},{},[1379],{"type":410,"value":1380},"和数据库核心的入口函数一样，使用 signal 挂载了对 SIGSEGV、SIGABRT 信号的处理。这两个信号分别指代系统内存错误和系统中断。而处理函数非常简单，就是 IKVS 中提到的“let it die”风格：输出调用栈，立马结束程序。",{"type":404,"tag":484,"props":1382,"children":1384},{"code":1383,"language":487,"meta":398,"className":488,"style":398},"void handler(int sig) {\n  int depth_max = 20;\n  void *array[depth_max];\n  size_t depth;\n  // backtrace 将前 depth_max 层栈帧记录到 array 数组中，\n  // 再通过 backtrace_symbols_fd 输出到 stderr。\n  // 文档见：https://man7.org/linux/man-pages/man3/backtrace.3.html\n  depth = backtrace(array, depth_max);\n  fprintf(stderr, \"Error: signal %d:\\n\", sig);\n  backtrace_symbols_fd(array, depth, STDERR_FILENO);\n  exit(1);\n}\nint main() {\n  signal(SIGSEGV, handler);\n  signal(SIGABRT, handler);\n  return kdb::test::RunAllTests();\n}\n",[1385],{"type":404,"tag":491,"props":1386,"children":1387},{"__ignoreMap":398},[1388,1423,1449,1482,1499,1508,1516,1524,1562,1621,1658,1678,1685,1704,1733,1761,1795],{"type":404,"tag":495,"props":1389,"children":1390},{"class":497,"line":498},[1391,1396,1401,1405,1409,1415,1419],{"type":404,"tag":495,"props":1392,"children":1393},{"style":538},[1394],{"type":410,"value":1395},"void",{"type":404,"tag":495,"props":1397,"children":1398},{"style":544},[1399],{"type":410,"value":1400}," handler",{"type":404,"tag":495,"props":1402,"children":1403},{"style":550},[1404],{"type":410,"value":632},{"type":404,"tag":495,"props":1406,"children":1407},{"style":538},[1408],{"type":410,"value":541},{"type":404,"tag":495,"props":1410,"children":1412},{"style":1411},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#E36209;--shiki-default-font-style:inherit;--shiki-dark:#FFAB70;--shiki-dark-font-style:inherit;--shiki-sepia:#FD971F;--shiki-sepia-font-style:italic",[1413],{"type":410,"value":1414}," sig",{"type":404,"tag":495,"props":1416,"children":1417},{"style":550},[1418],{"type":410,"value":1199},{"type":404,"tag":495,"props":1420,"children":1421},{"style":550},[1422],{"type":410,"value":558},{"type":404,"tag":495,"props":1424,"children":1425},{"class":497,"line":525},[1426,1431,1436,1440,1445],{"type":404,"tag":495,"props":1427,"children":1428},{"style":538},[1429],{"type":410,"value":1430},"  int",{"type":404,"tag":495,"props":1432,"children":1433},{"style":576},[1434],{"type":410,"value":1435}," depth_max ",{"type":404,"tag":495,"props":1437,"children":1438},{"style":674},[1439],{"type":410,"value":677},{"type":404,"tag":495,"props":1441,"children":1442},{"style":836},[1443],{"type":410,"value":1444}," 20",{"type":404,"tag":495,"props":1446,"children":1447},{"style":550},[1448],{"type":410,"value":584},{"type":404,"tag":495,"props":1450,"children":1451},{"class":497,"line":534},[1452,1457,1462,1467,1472,1477],{"type":404,"tag":495,"props":1453,"children":1454},{"style":538},[1455],{"type":410,"value":1456},"  void",{"type":404,"tag":495,"props":1458,"children":1459},{"style":674},[1460],{"type":410,"value":1461}," *",{"type":404,"tag":495,"props":1463,"children":1464},{"style":576},[1465],{"type":410,"value":1466},"array",{"type":404,"tag":495,"props":1468,"children":1469},{"style":550},[1470],{"type":410,"value":1471},"[",{"type":404,"tag":495,"props":1473,"children":1474},{"style":576},[1475],{"type":410,"value":1476},"depth_max",{"type":404,"tag":495,"props":1478,"children":1479},{"style":550},[1480],{"type":410,"value":1481},"];\n",{"type":404,"tag":495,"props":1483,"children":1484},{"class":497,"line":561},[1485,1490,1495],{"type":404,"tag":495,"props":1486,"children":1487},{"style":538},[1488],{"type":410,"value":1489},"  size_t",{"type":404,"tag":495,"props":1491,"children":1492},{"style":576},[1493],{"type":410,"value":1494}," depth",{"type":404,"tag":495,"props":1496,"children":1497},{"style":550},[1498],{"type":410,"value":584},{"type":404,"tag":495,"props":1500,"children":1501},{"class":497,"line":587},[1502],{"type":404,"tag":495,"props":1503,"children":1505},{"style":1504},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit",[1506],{"type":410,"value":1507},"  // backtrace 将前 depth_max 层栈帧记录到 array 数组中，\n",{"type":404,"tag":495,"props":1509,"children":1510},{"class":497,"line":608},[1511],{"type":404,"tag":495,"props":1512,"children":1513},{"style":1504},[1514],{"type":410,"value":1515},"  // 再通过 backtrace_symbols_fd 输出到 stderr。\n",{"type":404,"tag":495,"props":1517,"children":1518},{"class":497,"line":665},[1519],{"type":404,"tag":495,"props":1520,"children":1521},{"style":1504},[1522],{"type":410,"value":1523},"  // 文档见：https://man7.org/linux/man-pages/man3/backtrace.3.html\n",{"type":404,"tag":495,"props":1525,"children":1526},{"class":497,"line":700},[1527,1532,1536,1541,1545,1549,1553,1558],{"type":404,"tag":495,"props":1528,"children":1529},{"style":576},[1530],{"type":410,"value":1531},"  depth ",{"type":404,"tag":495,"props":1533,"children":1534},{"style":674},[1535],{"type":410,"value":677},{"type":404,"tag":495,"props":1537,"children":1538},{"style":544},[1539],{"type":410,"value":1540}," backtrace",{"type":404,"tag":495,"props":1542,"children":1543},{"style":550},[1544],{"type":410,"value":632},{"type":404,"tag":495,"props":1546,"children":1547},{"style":576},[1548],{"type":410,"value":1466},{"type":404,"tag":495,"props":1550,"children":1551},{"style":550},[1552],{"type":410,"value":642},{"type":404,"tag":495,"props":1554,"children":1555},{"style":576},[1556],{"type":410,"value":1557}," depth_max",{"type":404,"tag":495,"props":1559,"children":1560},{"style":550},[1561],{"type":410,"value":662},{"type":404,"tag":495,"props":1563,"children":1564},{"class":497,"line":742},[1565,1570,1574,1578,1582,1586,1591,1596,1601,1605,1609,1613,1617],{"type":404,"tag":495,"props":1566,"children":1567},{"style":544},[1568],{"type":410,"value":1569},"  fprintf",{"type":404,"tag":495,"props":1571,"children":1572},{"style":550},[1573],{"type":410,"value":632},{"type":404,"tag":495,"props":1575,"children":1576},{"style":576},[1577],{"type":410,"value":758},{"type":404,"tag":495,"props":1579,"children":1580},{"style":550},[1581],{"type":410,"value":642},{"type":404,"tag":495,"props":1583,"children":1584},{"style":508},[1585],{"type":410,"value":647},{"type":404,"tag":495,"props":1587,"children":1588},{"style":514},[1589],{"type":410,"value":1590},"Error: signal ",{"type":404,"tag":495,"props":1592,"children":1593},{"style":774},[1594],{"type":410,"value":1595},"%d",{"type":404,"tag":495,"props":1597,"children":1598},{"style":514},[1599],{"type":410,"value":1600},":",{"type":404,"tag":495,"props":1602,"children":1603},{"style":780},[1604],{"type":410,"value":783},{"type":404,"tag":495,"props":1606,"children":1607},{"style":508},[1608],{"type":410,"value":657},{"type":404,"tag":495,"props":1610,"children":1611},{"style":550},[1612],{"type":410,"value":642},{"type":404,"tag":495,"props":1614,"children":1615},{"style":576},[1616],{"type":410,"value":1414},{"type":404,"tag":495,"props":1618,"children":1619},{"style":550},[1620],{"type":410,"value":662},{"type":404,"tag":495,"props":1622,"children":1623},{"class":497,"line":823},[1624,1629,1633,1637,1641,1645,1649,1654],{"type":404,"tag":495,"props":1625,"children":1626},{"style":544},[1627],{"type":410,"value":1628},"  backtrace_symbols_fd",{"type":404,"tag":495,"props":1630,"children":1631},{"style":550},[1632],{"type":410,"value":632},{"type":404,"tag":495,"props":1634,"children":1635},{"style":576},[1636],{"type":410,"value":1466},{"type":404,"tag":495,"props":1638,"children":1639},{"style":550},[1640],{"type":410,"value":642},{"type":404,"tag":495,"props":1642,"children":1643},{"style":576},[1644],{"type":410,"value":1494},{"type":404,"tag":495,"props":1646,"children":1647},{"style":550},[1648],{"type":410,"value":642},{"type":404,"tag":495,"props":1650,"children":1651},{"style":576},[1652],{"type":410,"value":1653}," STDERR_FILENO",{"type":404,"tag":495,"props":1655,"children":1656},{"style":550},[1657],{"type":410,"value":662},{"type":404,"tag":495,"props":1659,"children":1660},{"class":497,"line":846},[1661,1666,1670,1674],{"type":404,"tag":495,"props":1662,"children":1663},{"style":544},[1664],{"type":410,"value":1665},"  exit",{"type":404,"tag":495,"props":1667,"children":1668},{"style":550},[1669],{"type":410,"value":632},{"type":404,"tag":495,"props":1671,"children":1672},{"style":836},[1673],{"type":410,"value":839},{"type":404,"tag":495,"props":1675,"children":1676},{"style":550},[1677],{"type":410,"value":662},{"type":404,"tag":495,"props":1679,"children":1680},{"class":497,"line":855},[1681],{"type":404,"tag":495,"props":1682,"children":1683},{"style":550},[1684],{"type":410,"value":1341},{"type":404,"tag":495,"props":1686,"children":1687},{"class":497,"line":863},[1688,1692,1696,1700],{"type":404,"tag":495,"props":1689,"children":1690},{"style":538},[1691],{"type":410,"value":541},{"type":404,"tag":495,"props":1693,"children":1694},{"style":544},[1695],{"type":410,"value":547},{"type":404,"tag":495,"props":1697,"children":1698},{"style":550},[1699],{"type":410,"value":553},{"type":404,"tag":495,"props":1701,"children":1702},{"style":550},[1703],{"type":410,"value":558},{"type":404,"tag":495,"props":1705,"children":1706},{"class":497,"line":906},[1707,1712,1716,1721,1725,1729],{"type":404,"tag":495,"props":1708,"children":1709},{"style":544},[1710],{"type":410,"value":1711},"  signal",{"type":404,"tag":495,"props":1713,"children":1714},{"style":550},[1715],{"type":410,"value":632},{"type":404,"tag":495,"props":1717,"children":1718},{"style":576},[1719],{"type":410,"value":1720},"SIGSEGV",{"type":404,"tag":495,"props":1722,"children":1723},{"style":550},[1724],{"type":410,"value":642},{"type":404,"tag":495,"props":1726,"children":1727},{"style":576},[1728],{"type":410,"value":1400},{"type":404,"tag":495,"props":1730,"children":1731},{"style":550},[1732],{"type":410,"value":662},{"type":404,"tag":495,"props":1734,"children":1735},{"class":497,"line":947},[1736,1740,1744,1749,1753,1757],{"type":404,"tag":495,"props":1737,"children":1738},{"style":544},[1739],{"type":410,"value":1711},{"type":404,"tag":495,"props":1741,"children":1742},{"style":550},[1743],{"type":410,"value":632},{"type":404,"tag":495,"props":1745,"children":1746},{"style":576},[1747],{"type":410,"value":1748},"SIGABRT",{"type":404,"tag":495,"props":1750,"children":1751},{"style":550},[1752],{"type":410,"value":642},{"type":404,"tag":495,"props":1754,"children":1755},{"style":576},[1756],{"type":410,"value":1400},{"type":404,"tag":495,"props":1758,"children":1759},{"style":550},[1760],{"type":410,"value":662},{"type":404,"tag":495,"props":1762,"children":1763},{"class":497,"line":955},[1764,1768,1773,1777,1782,1786,1791],{"type":404,"tag":495,"props":1765,"children":1766},{"style":502},[1767],{"type":410,"value":1323},{"type":404,"tag":495,"props":1769,"children":1770},{"style":565},[1771],{"type":410,"value":1772}," kdb",{"type":404,"tag":495,"props":1774,"children":1775},{"style":550},[1776],{"type":410,"value":573},{"type":404,"tag":495,"props":1778,"children":1779},{"style":565},[1780],{"type":410,"value":1781},"test",{"type":404,"tag":495,"props":1783,"children":1784},{"style":550},[1785],{"type":410,"value":573},{"type":404,"tag":495,"props":1787,"children":1788},{"style":544},[1789],{"type":410,"value":1790},"RunAllTests",{"type":404,"tag":495,"props":1792,"children":1793},{"style":550},[1794],{"type":410,"value":697},{"type":404,"tag":495,"props":1796,"children":1797},{"class":497,"line":976},[1798],{"type":404,"tag":495,"props":1799,"children":1800},{"style":550},[1801],{"type":410,"value":1341},{"type":404,"tag":1371,"props":1803,"children":1805},{"id":1804},"使用宏创建测试类",[1806],{"type":410,"value":1804},{"type":404,"tag":418,"props":1808,"children":1809},{},[1810],{"type":410,"value":1811},"test_db 中的类是使用宏定义的。如下代码，TEST 展开的新类，继承了 DBTest，实现了 _RunIt 接口以便调用测试函数。TCONCAT 宏顾名思义就是连接，使用标记黏贴运算符把两个字符串或实参连接在一起并视为一个新的标记。_Test_ 和 name 连接在一起后，就是新类的名称，如 _Test_CloseAndReopen。",{"type":404,"tag":484,"props":1813,"children":1815},{"code":1814,"language":487,"meta":398,"className":488,"style":398},"TEST(DBTest, CloseAndReopen) {\n  // ...\n}\n#define TEST(base,name)                                                 \\\nclass TCONCAT(_Test_,name) : public base {                              \\\n public:                                                                \\\n  void _Run();                                                          \\\n  static void _RunIt() {                                                \\\n    TCONCAT(_Test_,name) t;                                             \\\n    t._Run();                                                           \\\n  }                                                                     \\\n};                                                                      \\\nbool TCONCAT(_Test_ignored_,name) =                                     \\\n  ::kdb::test::RegisterTest(#base, #name, &TCONCAT(_Test_,name)::_RunIt); \\\n",[1816],{"type":404,"tag":491,"props":1817,"children":1818},{"__ignoreMap":398},[1819,1853,1861,1868,1908,1957,1975,1997,2030,2073,2099,2111,2124,2167],{"type":404,"tag":495,"props":1820,"children":1821},{"class":497,"line":498},[1822,1827,1831,1836,1840,1845,1849],{"type":404,"tag":495,"props":1823,"children":1824},{"style":544},[1825],{"type":410,"value":1826},"TEST",{"type":404,"tag":495,"props":1828,"children":1829},{"style":550},[1830],{"type":410,"value":632},{"type":404,"tag":495,"props":1832,"children":1833},{"style":576},[1834],{"type":410,"value":1835},"DBTest",{"type":404,"tag":495,"props":1837,"children":1838},{"style":550},[1839],{"type":410,"value":642},{"type":404,"tag":495,"props":1841,"children":1842},{"style":576},[1843],{"type":410,"value":1844}," CloseAndReopen",{"type":404,"tag":495,"props":1846,"children":1847},{"style":550},[1848],{"type":410,"value":1199},{"type":404,"tag":495,"props":1850,"children":1851},{"style":550},[1852],{"type":410,"value":558},{"type":404,"tag":495,"props":1854,"children":1855},{"class":497,"line":525},[1856],{"type":404,"tag":495,"props":1857,"children":1858},{"style":1504},[1859],{"type":410,"value":1860},"  // ...\n",{"type":404,"tag":495,"props":1862,"children":1863},{"class":497,"line":534},[1864],{"type":404,"tag":495,"props":1865,"children":1866},{"style":550},[1867],{"type":410,"value":1341},{"type":404,"tag":495,"props":1869,"children":1870},{"class":497,"line":561},[1871,1876,1881,1885,1890,1894,1899,1903],{"type":404,"tag":495,"props":1872,"children":1873},{"style":502},[1874],{"type":410,"value":1875},"#define",{"type":404,"tag":495,"props":1877,"children":1878},{"style":544},[1879],{"type":410,"value":1880}," TEST",{"type":404,"tag":495,"props":1882,"children":1883},{"style":550},[1884],{"type":410,"value":632},{"type":404,"tag":495,"props":1886,"children":1887},{"style":1411},[1888],{"type":410,"value":1889},"base",{"type":404,"tag":495,"props":1891,"children":1892},{"style":550},[1893],{"type":410,"value":642},{"type":404,"tag":495,"props":1895,"children":1896},{"style":1411},[1897],{"type":410,"value":1898},"name",{"type":404,"tag":495,"props":1900,"children":1901},{"style":550},[1902],{"type":410,"value":1199},{"type":404,"tag":495,"props":1904,"children":1905},{"style":780},[1906],{"type":410,"value":1907},"                                                 \\\n",{"type":404,"tag":495,"props":1909,"children":1910},{"class":497,"line":587},[1911,1916,1921,1925,1930,1934,1938,1942,1947,1952],{"type":404,"tag":495,"props":1912,"children":1913},{"style":538},[1914],{"type":410,"value":1915},"class",{"type":404,"tag":495,"props":1917,"children":1918},{"style":544},[1919],{"type":410,"value":1920}," TCONCAT",{"type":404,"tag":495,"props":1922,"children":1923},{"style":550},[1924],{"type":410,"value":632},{"type":404,"tag":495,"props":1926,"children":1927},{"style":565},[1928],{"type":410,"value":1929},"_Test_",{"type":404,"tag":495,"props":1931,"children":1932},{"style":550},[1933],{"type":410,"value":642},{"type":404,"tag":495,"props":1935,"children":1936},{"style":565},[1937],{"type":410,"value":1898},{"type":404,"tag":495,"props":1939,"children":1940},{"style":550},[1941],{"type":410,"value":1199},{"type":404,"tag":495,"props":1943,"children":1944},{"style":576},[1945],{"type":410,"value":1946}," : public base ",{"type":404,"tag":495,"props":1948,"children":1949},{"style":550},[1950],{"type":410,"value":1951},"{",{"type":404,"tag":495,"props":1953,"children":1954},{"style":780},[1955],{"type":410,"value":1956},"                              \\\n",{"type":404,"tag":495,"props":1958,"children":1959},{"class":497,"line":608},[1960,1965,1970],{"type":404,"tag":495,"props":1961,"children":1962},{"style":538},[1963],{"type":410,"value":1964}," public",{"type":404,"tag":495,"props":1966,"children":1968},{"style":1967},"--shiki-light:#39ADB5;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic",[1969],{"type":410,"value":1600},{"type":404,"tag":495,"props":1971,"children":1972},{"style":780},[1973],{"type":410,"value":1974},"                                                                \\\n",{"type":404,"tag":495,"props":1976,"children":1977},{"class":497,"line":665},[1978,1982,1987,1992],{"type":404,"tag":495,"props":1979,"children":1980},{"style":538},[1981],{"type":410,"value":1456},{"type":404,"tag":495,"props":1983,"children":1984},{"style":544},[1985],{"type":410,"value":1986}," _Run",{"type":404,"tag":495,"props":1988,"children":1989},{"style":550},[1990],{"type":410,"value":1991},"();",{"type":404,"tag":495,"props":1993,"children":1994},{"style":780},[1995],{"type":410,"value":1996},"                                                          \\\n",{"type":404,"tag":495,"props":1998,"children":1999},{"class":497,"line":700},[2000,2006,2011,2016,2020,2025],{"type":404,"tag":495,"props":2001,"children":2003},{"style":2002},"--shiki-light:#9C3EDA;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[2004],{"type":410,"value":2005},"  static",{"type":404,"tag":495,"props":2007,"children":2008},{"style":538},[2009],{"type":410,"value":2010}," void",{"type":404,"tag":495,"props":2012,"children":2013},{"style":544},[2014],{"type":410,"value":2015}," _RunIt",{"type":404,"tag":495,"props":2017,"children":2018},{"style":550},[2019],{"type":410,"value":553},{"type":404,"tag":495,"props":2021,"children":2022},{"style":550},[2023],{"type":410,"value":2024}," {",{"type":404,"tag":495,"props":2026,"children":2027},{"style":780},[2028],{"type":410,"value":2029},"                                                \\\n",{"type":404,"tag":495,"props":2031,"children":2032},{"class":497,"line":742},[2033,2038,2042,2046,2050,2054,2058,2063,2068],{"type":404,"tag":495,"props":2034,"children":2035},{"style":544},[2036],{"type":410,"value":2037},"    TCONCAT",{"type":404,"tag":495,"props":2039,"children":2040},{"style":550},[2041],{"type":410,"value":632},{"type":404,"tag":495,"props":2043,"children":2044},{"style":755},[2045],{"type":410,"value":1929},{"type":404,"tag":495,"props":2047,"children":2048},{"style":550},[2049],{"type":410,"value":642},{"type":404,"tag":495,"props":2051,"children":2052},{"style":755},[2053],{"type":410,"value":1898},{"type":404,"tag":495,"props":2055,"children":2056},{"style":550},[2057],{"type":410,"value":1199},{"type":404,"tag":495,"props":2059,"children":2060},{"style":755},[2061],{"type":410,"value":2062}," t",{"type":404,"tag":495,"props":2064,"children":2065},{"style":550},[2066],{"type":410,"value":2067},";",{"type":404,"tag":495,"props":2069,"children":2070},{"style":780},[2071],{"type":410,"value":2072},"                                             \\\n",{"type":404,"tag":495,"props":2074,"children":2075},{"class":497,"line":823},[2076,2081,2085,2090,2094],{"type":404,"tag":495,"props":2077,"children":2078},{"style":576},[2079],{"type":410,"value":2080},"    t",{"type":404,"tag":495,"props":2082,"children":2083},{"style":550},[2084],{"type":410,"value":687},{"type":404,"tag":495,"props":2086,"children":2087},{"style":544},[2088],{"type":410,"value":2089},"_Run",{"type":404,"tag":495,"props":2091,"children":2092},{"style":550},[2093],{"type":410,"value":1991},{"type":404,"tag":495,"props":2095,"children":2096},{"style":780},[2097],{"type":410,"value":2098},"                                                           \\\n",{"type":404,"tag":495,"props":2100,"children":2101},{"class":497,"line":846},[2102,2106],{"type":404,"tag":495,"props":2103,"children":2104},{"style":550},[2105],{"type":410,"value":1252},{"type":404,"tag":495,"props":2107,"children":2108},{"style":780},[2109],{"type":410,"value":2110},"                                                                     \\\n",{"type":404,"tag":495,"props":2112,"children":2113},{"class":497,"line":855},[2114,2119],{"type":404,"tag":495,"props":2115,"children":2116},{"style":550},[2117],{"type":410,"value":2118},"};",{"type":404,"tag":495,"props":2120,"children":2121},{"style":780},[2122],{"type":410,"value":2123},"                                                                      \\\n",{"type":404,"tag":495,"props":2125,"children":2126},{"class":497,"line":863},[2127,2132,2136,2140,2145,2149,2153,2157,2162],{"type":404,"tag":495,"props":2128,"children":2129},{"style":538},[2130],{"type":410,"value":2131},"bool",{"type":404,"tag":495,"props":2133,"children":2134},{"style":544},[2135],{"type":410,"value":1920},{"type":404,"tag":495,"props":2137,"children":2138},{"style":550},[2139],{"type":410,"value":632},{"type":404,"tag":495,"props":2141,"children":2142},{"style":565},[2143],{"type":410,"value":2144},"_Test_ignored_",{"type":404,"tag":495,"props":2146,"children":2147},{"style":550},[2148],{"type":410,"value":642},{"type":404,"tag":495,"props":2150,"children":2151},{"style":565},[2152],{"type":410,"value":1898},{"type":404,"tag":495,"props":2154,"children":2155},{"style":550},[2156],{"type":410,"value":1199},{"type":404,"tag":495,"props":2158,"children":2159},{"style":674},[2160],{"type":410,"value":2161}," =",{"type":404,"tag":495,"props":2163,"children":2164},{"style":780},[2165],{"type":410,"value":2166},"                                     \\\n",{"type":404,"tag":495,"props":2168,"children":2169},{"class":497,"line":906},[2170,2175,2180,2184,2188,2192,2197,2201,2206,2210,2215,2219,2223,2228,2232,2236,2240,2244,2248,2253,2257],{"type":404,"tag":495,"props":2171,"children":2172},{"style":576},[2173],{"type":410,"value":2174},"  ::",{"type":404,"tag":495,"props":2176,"children":2177},{"style":565},[2178],{"type":410,"value":2179},"kdb",{"type":404,"tag":495,"props":2181,"children":2182},{"style":550},[2183],{"type":410,"value":573},{"type":404,"tag":495,"props":2185,"children":2186},{"style":565},[2187],{"type":410,"value":1781},{"type":404,"tag":495,"props":2189,"children":2190},{"style":550},[2191],{"type":410,"value":573},{"type":404,"tag":495,"props":2193,"children":2194},{"style":544},[2195],{"type":410,"value":2196},"RegisterTest",{"type":404,"tag":495,"props":2198,"children":2199},{"style":550},[2200],{"type":410,"value":632},{"type":404,"tag":495,"props":2202,"children":2203},{"style":576},[2204],{"type":410,"value":2205},"#base",{"type":404,"tag":495,"props":2207,"children":2208},{"style":550},[2209],{"type":410,"value":642},{"type":404,"tag":495,"props":2211,"children":2212},{"style":576},[2213],{"type":410,"value":2214}," #name",{"type":404,"tag":495,"props":2216,"children":2217},{"style":550},[2218],{"type":410,"value":642},{"type":404,"tag":495,"props":2220,"children":2221},{"style":674},[2222],{"type":410,"value":1130},{"type":404,"tag":495,"props":2224,"children":2225},{"style":544},[2226],{"type":410,"value":2227},"TCONCAT",{"type":404,"tag":495,"props":2229,"children":2230},{"style":550},[2231],{"type":410,"value":632},{"type":404,"tag":495,"props":2233,"children":2234},{"style":576},[2235],{"type":410,"value":1929},{"type":404,"tag":495,"props":2237,"children":2238},{"style":550},[2239],{"type":410,"value":642},{"type":404,"tag":495,"props":2241,"children":2242},{"style":576},[2243],{"type":410,"value":1898},{"type":404,"tag":495,"props":2245,"children":2246},{"style":550},[2247],{"type":410,"value":1199},{"type":404,"tag":495,"props":2249,"children":2250},{"style":576},[2251],{"type":410,"value":2252},"::_RunIt",{"type":404,"tag":495,"props":2254,"children":2255},{"style":550},[2256],{"type":410,"value":1238},{"type":404,"tag":495,"props":2258,"children":2259},{"style":780},[2260],{"type":410,"value":2261}," \\\n",{"type":404,"tag":418,"props":2263,"children":2264},{},[2265],{"type":410,"value":2266},"可是，既然有 TCONCAT，为什么还要定义一个 TCONCAT1 宏呢？",{"type":404,"tag":484,"props":2268,"children":2270},{"code":2269,"language":487,"meta":398,"className":488,"style":398},"#define TCONCAT(a,b) TCONCAT1(a,b)\n#define TCONCAT1(a,b) a##b\n",[2271],{"type":404,"tag":491,"props":2272,"children":2273},{"__ignoreMap":398},[2274,2332],{"type":404,"tag":495,"props":2275,"children":2276},{"class":497,"line":498},[2277,2281,2285,2289,2293,2297,2302,2306,2311,2315,2319,2323,2327],{"type":404,"tag":495,"props":2278,"children":2279},{"style":502},[2280],{"type":410,"value":1875},{"type":404,"tag":495,"props":2282,"children":2283},{"style":544},[2284],{"type":410,"value":1920},{"type":404,"tag":495,"props":2286,"children":2287},{"style":550},[2288],{"type":410,"value":632},{"type":404,"tag":495,"props":2290,"children":2291},{"style":1411},[2292],{"type":410,"value":429},{"type":404,"tag":495,"props":2294,"children":2295},{"style":550},[2296],{"type":410,"value":642},{"type":404,"tag":495,"props":2298,"children":2299},{"style":1411},[2300],{"type":410,"value":2301},"b",{"type":404,"tag":495,"props":2303,"children":2304},{"style":550},[2305],{"type":410,"value":1199},{"type":404,"tag":495,"props":2307,"children":2308},{"style":544},[2309],{"type":410,"value":2310}," TCONCAT1",{"type":404,"tag":495,"props":2312,"children":2313},{"style":550},[2314],{"type":410,"value":632},{"type":404,"tag":495,"props":2316,"children":2317},{"style":576},[2318],{"type":410,"value":429},{"type":404,"tag":495,"props":2320,"children":2321},{"style":550},[2322],{"type":410,"value":642},{"type":404,"tag":495,"props":2324,"children":2325},{"style":576},[2326],{"type":410,"value":2301},{"type":404,"tag":495,"props":2328,"children":2329},{"style":550},[2330],{"type":410,"value":2331},")\n",{"type":404,"tag":495,"props":2333,"children":2334},{"class":497,"line":525},[2335,2339,2343,2347,2351,2355,2359,2363],{"type":404,"tag":495,"props":2336,"children":2337},{"style":502},[2338],{"type":410,"value":1875},{"type":404,"tag":495,"props":2340,"children":2341},{"style":544},[2342],{"type":410,"value":2310},{"type":404,"tag":495,"props":2344,"children":2345},{"style":550},[2346],{"type":410,"value":632},{"type":404,"tag":495,"props":2348,"children":2349},{"style":1411},[2350],{"type":410,"value":429},{"type":404,"tag":495,"props":2352,"children":2353},{"style":550},[2354],{"type":410,"value":642},{"type":404,"tag":495,"props":2356,"children":2357},{"style":1411},[2358],{"type":410,"value":2301},{"type":404,"tag":495,"props":2360,"children":2361},{"style":550},[2362],{"type":410,"value":1199},{"type":404,"tag":495,"props":2364,"children":2365},{"style":576},[2366],{"type":410,"value":2367}," a##b\n",{"type":404,"tag":418,"props":2369,"children":2370},{},[2371],{"type":410,"value":2372},"这就要提到宏的一个特殊规则了，如果宏参数使用了字符串化运算符（#）或标记黏贴运算符（##），那么即便参数是宏也不会展开。所以需要一个间接宏 TCONCAT1，以达到先展开参数（如果参数是宏的化），再调用标记黏贴运算符的目的。从 test_db 可以看到，测试类的名词都不是宏，所以这里本不需要 TCONCAT1 这个间接宏。但是考虑到程序的健壮性，加上更好。",{"type":404,"tag":1371,"props":2374,"children":2376},{"id":2375},"断言宏",[2377],{"type":410,"value":2375},{"type":404,"tag":418,"props":2379,"children":2380},{},[2381],{"type":410,"value":2382},"测试代码中的断言也是使用的宏来定义的。相比 TCONCAT 简单很多了，但其特点是可以记录抛错的文件以及行号。以下代码实现了 ASSERT_EQ 的定义。Tester 用于记录宏展开时所在的文件 __FILE__、行号 __LINE__ 以及断言结果。一但断言失败，记录到 ok_ 成员变量中。在 Tester 析构时，会把相关信息一并打印出来。",{"type":404,"tag":484,"props":2384,"children":2386},{"code":2385,"language":487,"meta":398,"className":488,"style":398},"class Tester {\n#define BINARY_OP(name,op)                              \\\n  template \u003Cclass X, class Y>                           \\\n  Tester& name(const X& x, const Y& y) {                \\\n    if (! (x op y)) {                                   \\\n      ss_ \u003C\u003C \" failed: \" \u003C\u003C x \u003C\u003C (\" \" #op \" \") \u003C\u003C y;    \\\n      ok_ = false;                                      \\\n    }                                                   \\\n    return *this;                                       \\\n  }\n  BINARY_OP(IsEq, ==)\n#undef BINARY_OP\n}\n#define ASSERT_EQ(a,b) ::kdb::test::Tester(__FILE__, __LINE__).IsEq((a),(b))\n",[2387],{"type":404,"tag":491,"props":2388,"children":2389},{"__ignoreMap":398},[2390,2406,2443,2488,2563,2602,2688,2715,2728,2755,2762,2792,2805,2812],{"type":404,"tag":495,"props":2391,"children":2392},{"class":497,"line":498},[2393,2397,2402],{"type":404,"tag":495,"props":2394,"children":2395},{"style":538},[2396],{"type":410,"value":1915},{"type":404,"tag":495,"props":2398,"children":2399},{"style":565},[2400],{"type":410,"value":2401}," Tester",{"type":404,"tag":495,"props":2403,"children":2404},{"style":550},[2405],{"type":410,"value":558},{"type":404,"tag":495,"props":2407,"children":2408},{"class":497,"line":525},[2409,2413,2418,2422,2426,2430,2435,2439],{"type":404,"tag":495,"props":2410,"children":2411},{"style":502},[2412],{"type":410,"value":1875},{"type":404,"tag":495,"props":2414,"children":2415},{"style":544},[2416],{"type":410,"value":2417}," BINARY_OP",{"type":404,"tag":495,"props":2419,"children":2420},{"style":550},[2421],{"type":410,"value":632},{"type":404,"tag":495,"props":2423,"children":2424},{"style":1411},[2425],{"type":410,"value":1898},{"type":404,"tag":495,"props":2427,"children":2428},{"style":550},[2429],{"type":410,"value":642},{"type":404,"tag":495,"props":2431,"children":2432},{"style":1411},[2433],{"type":410,"value":2434},"op",{"type":404,"tag":495,"props":2436,"children":2437},{"style":550},[2438],{"type":410,"value":1199},{"type":404,"tag":495,"props":2440,"children":2441},{"style":780},[2442],{"type":410,"value":1956},{"type":404,"tag":495,"props":2444,"children":2445},{"class":497,"line":534},[2446,2451,2455,2459,2464,2468,2473,2478,2483],{"type":404,"tag":495,"props":2447,"children":2448},{"style":538},[2449],{"type":410,"value":2450},"  template",{"type":404,"tag":495,"props":2452,"children":2453},{"style":550},[2454],{"type":410,"value":511},{"type":404,"tag":495,"props":2456,"children":2457},{"style":538},[2458],{"type":410,"value":1915},{"type":404,"tag":495,"props":2460,"children":2461},{"style":565},[2462],{"type":410,"value":2463}," X",{"type":404,"tag":495,"props":2465,"children":2466},{"style":550},[2467],{"type":410,"value":642},{"type":404,"tag":495,"props":2469,"children":2470},{"style":538},[2471],{"type":410,"value":2472}," class",{"type":404,"tag":495,"props":2474,"children":2475},{"style":565},[2476],{"type":410,"value":2477}," Y",{"type":404,"tag":495,"props":2479,"children":2480},{"style":550},[2481],{"type":410,"value":2482},">",{"type":404,"tag":495,"props":2484,"children":2485},{"style":780},[2486],{"type":410,"value":2487},"                           \\\n",{"type":404,"tag":495,"props":2489,"children":2490},{"class":497,"line":561},[2491,2496,2501,2506,2510,2515,2519,2523,2528,2532,2537,2541,2545,2550,2554,2558],{"type":404,"tag":495,"props":2492,"children":2493},{"style":565},[2494],{"type":410,"value":2495},"  Tester",{"type":404,"tag":495,"props":2497,"children":2498},{"style":2002},[2499],{"type":410,"value":2500},"&",{"type":404,"tag":495,"props":2502,"children":2503},{"style":544},[2504],{"type":410,"value":2505}," name",{"type":404,"tag":495,"props":2507,"children":2508},{"style":550},[2509],{"type":410,"value":632},{"type":404,"tag":495,"props":2511,"children":2512},{"style":2002},[2513],{"type":410,"value":2514},"const",{"type":404,"tag":495,"props":2516,"children":2517},{"style":565},[2518],{"type":410,"value":2463},{"type":404,"tag":495,"props":2520,"children":2521},{"style":2002},[2522],{"type":410,"value":2500},{"type":404,"tag":495,"props":2524,"children":2525},{"style":1411},[2526],{"type":410,"value":2527}," x",{"type":404,"tag":495,"props":2529,"children":2530},{"style":550},[2531],{"type":410,"value":642},{"type":404,"tag":495,"props":2533,"children":2534},{"style":2002},[2535],{"type":410,"value":2536}," const",{"type":404,"tag":495,"props":2538,"children":2539},{"style":565},[2540],{"type":410,"value":2477},{"type":404,"tag":495,"props":2542,"children":2543},{"style":2002},[2544],{"type":410,"value":2500},{"type":404,"tag":495,"props":2546,"children":2547},{"style":1411},[2548],{"type":410,"value":2549}," y",{"type":404,"tag":495,"props":2551,"children":2552},{"style":550},[2553],{"type":410,"value":1199},{"type":404,"tag":495,"props":2555,"children":2556},{"style":550},[2557],{"type":410,"value":2024},{"type":404,"tag":495,"props":2559,"children":2560},{"style":780},[2561],{"type":410,"value":2562},"                \\\n",{"type":404,"tag":495,"props":2564,"children":2565},{"class":497,"line":587},[2566,2571,2575,2579,2583,2588,2593,2597],{"type":404,"tag":495,"props":2567,"children":2568},{"style":502},[2569],{"type":410,"value":2570},"    if",{"type":404,"tag":495,"props":2572,"children":2573},{"style":550},[2574],{"type":410,"value":711},{"type":404,"tag":495,"props":2576,"children":2577},{"style":674},[2578],{"type":410,"value":716},{"type":404,"tag":495,"props":2580,"children":2581},{"style":550},[2582],{"type":410,"value":711},{"type":404,"tag":495,"props":2584,"children":2585},{"style":755},[2586],{"type":410,"value":2587},"x op y",{"type":404,"tag":495,"props":2589,"children":2590},{"style":550},[2591],{"type":410,"value":2592},"))",{"type":404,"tag":495,"props":2594,"children":2595},{"style":550},[2596],{"type":410,"value":2024},{"type":404,"tag":495,"props":2598,"children":2599},{"style":780},[2600],{"type":410,"value":2601},"                                   \\\n",{"type":404,"tag":495,"props":2603,"children":2604},{"class":497,"line":608},[2605,2610,2615,2619,2624,2628,2633,2638,2642,2646,2650,2654,2659,2663,2667,2671,2675,2679,2683],{"type":404,"tag":495,"props":2606,"children":2607},{"style":755},[2608],{"type":410,"value":2609},"      ss_ ",{"type":404,"tag":495,"props":2611,"children":2612},{"style":674},[2613],{"type":410,"value":2614},"\u003C\u003C",{"type":404,"tag":495,"props":2616,"children":2617},{"style":508},[2618],{"type":410,"value":647},{"type":404,"tag":495,"props":2620,"children":2621},{"style":514},[2622],{"type":410,"value":2623}," failed: ",{"type":404,"tag":495,"props":2625,"children":2626},{"style":508},[2627],{"type":410,"value":657},{"type":404,"tag":495,"props":2629,"children":2630},{"style":674},[2631],{"type":410,"value":2632}," \u003C\u003C",{"type":404,"tag":495,"props":2634,"children":2635},{"style":755},[2636],{"type":410,"value":2637}," x ",{"type":404,"tag":495,"props":2639,"children":2640},{"style":674},[2641],{"type":410,"value":2614},{"type":404,"tag":495,"props":2643,"children":2644},{"style":550},[2645],{"type":410,"value":711},{"type":404,"tag":495,"props":2647,"children":2648},{"style":508},[2649],{"type":410,"value":657},{"type":404,"tag":495,"props":2651,"children":2652},{"style":508},[2653],{"type":410,"value":647},{"type":404,"tag":495,"props":2655,"children":2656},{"style":576},[2657],{"type":410,"value":2658}," #op",{"type":404,"tag":495,"props":2660,"children":2661},{"style":508},[2662],{"type":410,"value":647},{"type":404,"tag":495,"props":2664,"children":2665},{"style":508},[2666],{"type":410,"value":647},{"type":404,"tag":495,"props":2668,"children":2669},{"style":550},[2670],{"type":410,"value":1199},{"type":404,"tag":495,"props":2672,"children":2673},{"style":674},[2674],{"type":410,"value":2632},{"type":404,"tag":495,"props":2676,"children":2677},{"style":755},[2678],{"type":410,"value":2549},{"type":404,"tag":495,"props":2680,"children":2681},{"style":550},[2682],{"type":410,"value":2067},{"type":404,"tag":495,"props":2684,"children":2685},{"style":780},[2686],{"type":410,"value":2687},"    \\\n",{"type":404,"tag":495,"props":2689,"children":2690},{"class":497,"line":665},[2691,2696,2700,2706,2710],{"type":404,"tag":495,"props":2692,"children":2693},{"style":755},[2694],{"type":410,"value":2695},"      ok_ ",{"type":404,"tag":495,"props":2697,"children":2698},{"style":674},[2699],{"type":410,"value":677},{"type":404,"tag":495,"props":2701,"children":2703},{"style":2702},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[2704],{"type":410,"value":2705}," false",{"type":404,"tag":495,"props":2707,"children":2708},{"style":550},[2709],{"type":410,"value":2067},{"type":404,"tag":495,"props":2711,"children":2712},{"style":780},[2713],{"type":410,"value":2714},"                                      \\\n",{"type":404,"tag":495,"props":2716,"children":2717},{"class":497,"line":700},[2718,2723],{"type":404,"tag":495,"props":2719,"children":2720},{"style":550},[2721],{"type":410,"value":2722},"    }",{"type":404,"tag":495,"props":2724,"children":2725},{"style":780},[2726],{"type":410,"value":2727},"                                                   \\\n",{"type":404,"tag":495,"props":2729,"children":2730},{"class":497,"line":742},[2731,2736,2740,2746,2750],{"type":404,"tag":495,"props":2732,"children":2733},{"style":502},[2734],{"type":410,"value":2735},"    return",{"type":404,"tag":495,"props":2737,"children":2738},{"style":674},[2739],{"type":410,"value":1461},{"type":404,"tag":495,"props":2741,"children":2743},{"style":2742},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[2744],{"type":410,"value":2745},"this",{"type":404,"tag":495,"props":2747,"children":2748},{"style":550},[2749],{"type":410,"value":2067},{"type":404,"tag":495,"props":2751,"children":2752},{"style":780},[2753],{"type":410,"value":2754},"                                       \\\n",{"type":404,"tag":495,"props":2756,"children":2757},{"class":497,"line":823},[2758],{"type":404,"tag":495,"props":2759,"children":2760},{"style":550},[2761],{"type":410,"value":852},{"type":404,"tag":495,"props":2763,"children":2764},{"class":497,"line":846},[2765,2770,2774,2779,2783,2788],{"type":404,"tag":495,"props":2766,"children":2767},{"style":544},[2768],{"type":410,"value":2769},"  BINARY_OP",{"type":404,"tag":495,"props":2771,"children":2772},{"style":550},[2773],{"type":410,"value":632},{"type":404,"tag":495,"props":2775,"children":2776},{"style":565},[2777],{"type":410,"value":2778},"IsEq",{"type":404,"tag":495,"props":2780,"children":2781},{"style":550},[2782],{"type":410,"value":642},{"type":404,"tag":495,"props":2784,"children":2785},{"style":674},[2786],{"type":410,"value":2787}," ==",{"type":404,"tag":495,"props":2789,"children":2790},{"style":550},[2791],{"type":410,"value":2331},{"type":404,"tag":495,"props":2793,"children":2794},{"class":497,"line":855},[2795,2800],{"type":404,"tag":495,"props":2796,"children":2797},{"style":502},[2798],{"type":410,"value":2799},"#undef",{"type":404,"tag":495,"props":2801,"children":2802},{"style":544},[2803],{"type":410,"value":2804}," BINARY_OP\n",{"type":404,"tag":495,"props":2806,"children":2807},{"class":497,"line":863},[2808],{"type":404,"tag":495,"props":2809,"children":2810},{"style":755},[2811],{"type":410,"value":1341},{"type":404,"tag":495,"props":2813,"children":2814},{"class":497,"line":906},[2815,2819,2824,2828,2832,2836,2840,2844,2849,2853,2857,2861,2865,2870,2874,2880,2884,2889,2894,2898,2903,2907,2912,2916],{"type":404,"tag":495,"props":2816,"children":2817},{"style":502},[2818],{"type":410,"value":1875},{"type":404,"tag":495,"props":2820,"children":2821},{"style":544},[2822],{"type":410,"value":2823}," ASSERT_EQ",{"type":404,"tag":495,"props":2825,"children":2826},{"style":550},[2827],{"type":410,"value":632},{"type":404,"tag":495,"props":2829,"children":2830},{"style":1411},[2831],{"type":410,"value":429},{"type":404,"tag":495,"props":2833,"children":2834},{"style":550},[2835],{"type":410,"value":642},{"type":404,"tag":495,"props":2837,"children":2838},{"style":1411},[2839],{"type":410,"value":2301},{"type":404,"tag":495,"props":2841,"children":2842},{"style":550},[2843],{"type":410,"value":1199},{"type":404,"tag":495,"props":2845,"children":2846},{"style":755},[2847],{"type":410,"value":2848}," ::",{"type":404,"tag":495,"props":2850,"children":2851},{"style":565},[2852],{"type":410,"value":2179},{"type":404,"tag":495,"props":2854,"children":2855},{"style":550},[2856],{"type":410,"value":573},{"type":404,"tag":495,"props":2858,"children":2859},{"style":565},[2860],{"type":410,"value":1781},{"type":404,"tag":495,"props":2862,"children":2863},{"style":550},[2864],{"type":410,"value":573},{"type":404,"tag":495,"props":2866,"children":2867},{"style":544},[2868],{"type":410,"value":2869},"Tester",{"type":404,"tag":495,"props":2871,"children":2872},{"style":550},[2873],{"type":410,"value":632},{"type":404,"tag":495,"props":2875,"children":2877},{"style":2876},"--shiki-light:#E2931D;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#F8F8F2",[2878],{"type":410,"value":2879},"__FILE__",{"type":404,"tag":495,"props":2881,"children":2882},{"style":550},[2883],{"type":410,"value":642},{"type":404,"tag":495,"props":2885,"children":2886},{"style":2876},[2887],{"type":410,"value":2888}," __LINE__",{"type":404,"tag":495,"props":2890,"children":2891},{"style":550},[2892],{"type":410,"value":2893},").",{"type":404,"tag":495,"props":2895,"children":2896},{"style":544},[2897],{"type":410,"value":2778},{"type":404,"tag":495,"props":2899,"children":2900},{"style":550},[2901],{"type":410,"value":2902},"((",{"type":404,"tag":495,"props":2904,"children":2905},{"style":755},[2906],{"type":410,"value":429},{"type":404,"tag":495,"props":2908,"children":2909},{"style":550},[2910],{"type":410,"value":2911},"),(",{"type":404,"tag":495,"props":2913,"children":2914},{"style":755},[2915],{"type":410,"value":2301},{"type":404,"tag":495,"props":2917,"children":2918},{"style":550},[2919],{"type":410,"value":2920},"))\n",{"type":404,"tag":1371,"props":2922,"children":2924},{"id":2923},"stringrepeatntimes",[2925],{"type":410,"value":2926},"string.repeat(ntimes)",{"type":404,"tag":418,"props":2928,"children":2929},{},[2930],{"type":410,"value":2931},"写 JavaScript 时经常用到 String 的原型方法 repeat，用来把 n 个内容重复的字符串拼接为一个新字符串。也许是 C++ 标准库没有提供相应的算法，KDB 使用了一种和 repeat 完全不一样的处理思路。KDB 使用 StringStream 填充一定位数内容，还可以不用考虑值的长度。",{"type":404,"tag":484,"props":2933,"children":2935},{"code":2934,"language":487,"meta":398,"className":488,"style":398},"std::stringstream ss;\nss \u003C\u003C std::setfill ('0') \u003C\u003C std::setw (16);\nss \u003C\u003C 1;\nss.str(); // result is: \"0000000000000001\"\nss \u003C\u003C std::setfill ('0') \u003C\u003C std::setw (16);\nss \u003C\u003C 1123;\nss.str(); // result is: \"0000000000001123\"\n",[2936],{"type":404,"tag":491,"props":2937,"children":2938},{"__ignoreMap":398},[2939,2960,3038,3058,3084,3155,3175],{"type":404,"tag":495,"props":2940,"children":2941},{"class":497,"line":498},[2942,2947,2951,2956],{"type":404,"tag":495,"props":2943,"children":2944},{"style":565},[2945],{"type":410,"value":2946},"std",{"type":404,"tag":495,"props":2948,"children":2949},{"style":550},[2950],{"type":410,"value":573},{"type":404,"tag":495,"props":2952,"children":2953},{"style":576},[2954],{"type":410,"value":2955},"stringstream ss",{"type":404,"tag":495,"props":2957,"children":2958},{"style":550},[2959],{"type":410,"value":584},{"type":404,"tag":495,"props":2961,"children":2962},{"class":497,"line":525},[2963,2968,2972,2977,2981,2986,2990,2995,3000,3004,3008,3012,3016,3020,3025,3029,3034],{"type":404,"tag":495,"props":2964,"children":2965},{"style":576},[2966],{"type":410,"value":2967},"ss ",{"type":404,"tag":495,"props":2969,"children":2970},{"style":674},[2971],{"type":410,"value":2614},{"type":404,"tag":495,"props":2973,"children":2974},{"style":565},[2975],{"type":410,"value":2976}," std",{"type":404,"tag":495,"props":2978,"children":2979},{"style":550},[2980],{"type":410,"value":573},{"type":404,"tag":495,"props":2982,"children":2983},{"style":544},[2984],{"type":410,"value":2985},"setfill",{"type":404,"tag":495,"props":2987,"children":2988},{"style":550},[2989],{"type":410,"value":711},{"type":404,"tag":495,"props":2991,"children":2992},{"style":508},[2993],{"type":410,"value":2994},"'",{"type":404,"tag":495,"props":2996,"children":2997},{"style":514},[2998],{"type":410,"value":2999},"0",{"type":404,"tag":495,"props":3001,"children":3002},{"style":508},[3003],{"type":410,"value":2994},{"type":404,"tag":495,"props":3005,"children":3006},{"style":550},[3007],{"type":410,"value":1199},{"type":404,"tag":495,"props":3009,"children":3010},{"style":674},[3011],{"type":410,"value":2632},{"type":404,"tag":495,"props":3013,"children":3014},{"style":565},[3015],{"type":410,"value":2976},{"type":404,"tag":495,"props":3017,"children":3018},{"style":550},[3019],{"type":410,"value":573},{"type":404,"tag":495,"props":3021,"children":3022},{"style":544},[3023],{"type":410,"value":3024},"setw",{"type":404,"tag":495,"props":3026,"children":3027},{"style":550},[3028],{"type":410,"value":711},{"type":404,"tag":495,"props":3030,"children":3031},{"style":836},[3032],{"type":410,"value":3033},"16",{"type":404,"tag":495,"props":3035,"children":3036},{"style":550},[3037],{"type":410,"value":662},{"type":404,"tag":495,"props":3039,"children":3040},{"class":497,"line":534},[3041,3045,3049,3054],{"type":404,"tag":495,"props":3042,"children":3043},{"style":576},[3044],{"type":410,"value":2967},{"type":404,"tag":495,"props":3046,"children":3047},{"style":674},[3048],{"type":410,"value":2614},{"type":404,"tag":495,"props":3050,"children":3051},{"style":836},[3052],{"type":410,"value":3053}," 1",{"type":404,"tag":495,"props":3055,"children":3056},{"style":550},[3057],{"type":410,"value":584},{"type":404,"tag":495,"props":3059,"children":3060},{"class":497,"line":561},[3061,3066,3070,3075,3079],{"type":404,"tag":495,"props":3062,"children":3063},{"style":576},[3064],{"type":410,"value":3065},"ss",{"type":404,"tag":495,"props":3067,"children":3068},{"style":550},[3069],{"type":410,"value":687},{"type":404,"tag":495,"props":3071,"children":3072},{"style":544},[3073],{"type":410,"value":3074},"str",{"type":404,"tag":495,"props":3076,"children":3077},{"style":550},[3078],{"type":410,"value":1991},{"type":404,"tag":495,"props":3080,"children":3081},{"style":1504},[3082],{"type":410,"value":3083}," // result is: \"0000000000000001\"\n",{"type":404,"tag":495,"props":3085,"children":3086},{"class":497,"line":587},[3087,3091,3095,3099,3103,3107,3111,3115,3119,3123,3127,3131,3135,3139,3143,3147,3151],{"type":404,"tag":495,"props":3088,"children":3089},{"style":576},[3090],{"type":410,"value":2967},{"type":404,"tag":495,"props":3092,"children":3093},{"style":674},[3094],{"type":410,"value":2614},{"type":404,"tag":495,"props":3096,"children":3097},{"style":565},[3098],{"type":410,"value":2976},{"type":404,"tag":495,"props":3100,"children":3101},{"style":550},[3102],{"type":410,"value":573},{"type":404,"tag":495,"props":3104,"children":3105},{"style":544},[3106],{"type":410,"value":2985},{"type":404,"tag":495,"props":3108,"children":3109},{"style":550},[3110],{"type":410,"value":711},{"type":404,"tag":495,"props":3112,"children":3113},{"style":508},[3114],{"type":410,"value":2994},{"type":404,"tag":495,"props":3116,"children":3117},{"style":514},[3118],{"type":410,"value":2999},{"type":404,"tag":495,"props":3120,"children":3121},{"style":508},[3122],{"type":410,"value":2994},{"type":404,"tag":495,"props":3124,"children":3125},{"style":550},[3126],{"type":410,"value":1199},{"type":404,"tag":495,"props":3128,"children":3129},{"style":674},[3130],{"type":410,"value":2632},{"type":404,"tag":495,"props":3132,"children":3133},{"style":565},[3134],{"type":410,"value":2976},{"type":404,"tag":495,"props":3136,"children":3137},{"style":550},[3138],{"type":410,"value":573},{"type":404,"tag":495,"props":3140,"children":3141},{"style":544},[3142],{"type":410,"value":3024},{"type":404,"tag":495,"props":3144,"children":3145},{"style":550},[3146],{"type":410,"value":711},{"type":404,"tag":495,"props":3148,"children":3149},{"style":836},[3150],{"type":410,"value":3033},{"type":404,"tag":495,"props":3152,"children":3153},{"style":550},[3154],{"type":410,"value":662},{"type":404,"tag":495,"props":3156,"children":3157},{"class":497,"line":608},[3158,3162,3166,3171],{"type":404,"tag":495,"props":3159,"children":3160},{"style":576},[3161],{"type":410,"value":2967},{"type":404,"tag":495,"props":3163,"children":3164},{"style":674},[3165],{"type":410,"value":2614},{"type":404,"tag":495,"props":3167,"children":3168},{"style":836},[3169],{"type":410,"value":3170}," 1123",{"type":404,"tag":495,"props":3172,"children":3173},{"style":550},[3174],{"type":410,"value":584},{"type":404,"tag":495,"props":3176,"children":3177},{"class":497,"line":665},[3178,3182,3186,3190,3194],{"type":404,"tag":495,"props":3179,"children":3180},{"style":576},[3181],{"type":410,"value":3065},{"type":404,"tag":495,"props":3183,"children":3184},{"style":550},[3185],{"type":410,"value":687},{"type":404,"tag":495,"props":3187,"children":3188},{"style":544},[3189],{"type":410,"value":3074},{"type":404,"tag":495,"props":3191,"children":3192},{"style":550},[3193],{"type":410,"value":1991},{"type":404,"tag":495,"props":3195,"children":3196},{"style":1504},[3197],{"type":410,"value":3198}," // result is: \"0000000000001123\"\n",{"type":404,"tag":1371,"props":3200,"children":3202},{"id":3201},"c-风格的随机数",[3203],{"type":410,"value":3204},"C++ 风格的随机数",{"type":404,"tag":418,"props":3206,"children":3207},{},[3208],{"type":410,"value":3209},"一个有意思的地方时，KDB 代码中随处可见 C 编程风格的源码。但是测试用例中生成随机数确实 C++ 风格的。",{"type":404,"tag":484,"props":3211,"children":3213},{"code":3212,"language":487,"meta":398,"className":488,"style":398},"std::mt19937 generator = std::mt19937();\nstd::uniform_int_distribution\u003Cint> random_dist(0,255);\n// ...\nfor (int i = 0; i \u003C size; i++) {\n  str[i] = static_cast\u003Cchar>(random_dist(generator));\n}\n",[3214],{"type":404,"tag":491,"props":3215,"children":3216},{"__ignoreMap":398},[3217,3254,3309,3317,3385,3448],{"type":404,"tag":495,"props":3218,"children":3219},{"class":497,"line":498},[3220,3224,3228,3233,3237,3241,3245,3250],{"type":404,"tag":495,"props":3221,"children":3222},{"style":565},[3223],{"type":410,"value":2946},{"type":404,"tag":495,"props":3225,"children":3226},{"style":550},[3227],{"type":410,"value":573},{"type":404,"tag":495,"props":3229,"children":3230},{"style":576},[3231],{"type":410,"value":3232},"mt19937 generator ",{"type":404,"tag":495,"props":3234,"children":3235},{"style":674},[3236],{"type":410,"value":677},{"type":404,"tag":495,"props":3238,"children":3239},{"style":565},[3240],{"type":410,"value":2976},{"type":404,"tag":495,"props":3242,"children":3243},{"style":550},[3244],{"type":410,"value":573},{"type":404,"tag":495,"props":3246,"children":3247},{"style":544},[3248],{"type":410,"value":3249},"mt19937",{"type":404,"tag":495,"props":3251,"children":3252},{"style":550},[3253],{"type":410,"value":697},{"type":404,"tag":495,"props":3255,"children":3256},{"class":497,"line":525},[3257,3261,3265,3270,3275,3279,3283,3288,3292,3296,3300,3305],{"type":404,"tag":495,"props":3258,"children":3259},{"style":565},[3260],{"type":410,"value":2946},{"type":404,"tag":495,"props":3262,"children":3263},{"style":550},[3264],{"type":410,"value":573},{"type":404,"tag":495,"props":3266,"children":3267},{"style":565},[3268],{"type":410,"value":3269},"uniform_int_distribution",{"type":404,"tag":495,"props":3271,"children":3272},{"style":550},[3273],{"type":410,"value":3274},"\u003C",{"type":404,"tag":495,"props":3276,"children":3277},{"style":538},[3278],{"type":410,"value":541},{"type":404,"tag":495,"props":3280,"children":3281},{"style":550},[3282],{"type":410,"value":2482},{"type":404,"tag":495,"props":3284,"children":3285},{"style":544},[3286],{"type":410,"value":3287}," random_dist",{"type":404,"tag":495,"props":3289,"children":3290},{"style":550},[3291],{"type":410,"value":632},{"type":404,"tag":495,"props":3293,"children":3294},{"style":836},[3295],{"type":410,"value":2999},{"type":404,"tag":495,"props":3297,"children":3298},{"style":550},[3299],{"type":410,"value":642},{"type":404,"tag":495,"props":3301,"children":3302},{"style":836},[3303],{"type":410,"value":3304},"255",{"type":404,"tag":495,"props":3306,"children":3307},{"style":550},[3308],{"type":410,"value":662},{"type":404,"tag":495,"props":3310,"children":3311},{"class":497,"line":534},[3312],{"type":404,"tag":495,"props":3313,"children":3314},{"style":1504},[3315],{"type":410,"value":3316},"// ...\n",{"type":404,"tag":495,"props":3318,"children":3319},{"class":497,"line":561},[3320,3325,3329,3333,3338,3342,3346,3350,3354,3358,3363,3367,3372,3377,3381],{"type":404,"tag":495,"props":3321,"children":3322},{"style":502},[3323],{"type":410,"value":3324},"for",{"type":404,"tag":495,"props":3326,"children":3327},{"style":550},[3328],{"type":410,"value":711},{"type":404,"tag":495,"props":3330,"children":3331},{"style":538},[3332],{"type":410,"value":541},{"type":404,"tag":495,"props":3334,"children":3335},{"style":576},[3336],{"type":410,"value":3337}," i ",{"type":404,"tag":495,"props":3339,"children":3340},{"style":674},[3341],{"type":410,"value":677},{"type":404,"tag":495,"props":3343,"children":3344},{"style":836},[3345],{"type":410,"value":1328},{"type":404,"tag":495,"props":3347,"children":3348},{"style":550},[3349],{"type":410,"value":2067},{"type":404,"tag":495,"props":3351,"children":3352},{"style":576},[3353],{"type":410,"value":3337},{"type":404,"tag":495,"props":3355,"children":3356},{"style":674},[3357],{"type":410,"value":3274},{"type":404,"tag":495,"props":3359,"children":3360},{"style":576},[3361],{"type":410,"value":3362}," size",{"type":404,"tag":495,"props":3364,"children":3365},{"style":550},[3366],{"type":410,"value":2067},{"type":404,"tag":495,"props":3368,"children":3369},{"style":576},[3370],{"type":410,"value":3371}," i",{"type":404,"tag":495,"props":3373,"children":3374},{"style":674},[3375],{"type":410,"value":3376},"++",{"type":404,"tag":495,"props":3378,"children":3379},{"style":550},[3380],{"type":410,"value":1199},{"type":404,"tag":495,"props":3382,"children":3383},{"style":550},[3384],{"type":410,"value":558},{"type":404,"tag":495,"props":3386,"children":3387},{"class":497,"line":587},[3388,3393,3397,3402,3407,3411,3416,3421,3425,3429,3434,3438,3443],{"type":404,"tag":495,"props":3389,"children":3390},{"style":576},[3391],{"type":410,"value":3392},"  str",{"type":404,"tag":495,"props":3394,"children":3395},{"style":550},[3396],{"type":410,"value":1471},{"type":404,"tag":495,"props":3398,"children":3399},{"style":755},[3400],{"type":410,"value":3401},"i",{"type":404,"tag":495,"props":3403,"children":3404},{"style":550},[3405],{"type":410,"value":3406},"]",{"type":404,"tag":495,"props":3408,"children":3409},{"style":674},[3410],{"type":410,"value":2161},{"type":404,"tag":495,"props":3412,"children":3413},{"style":674},[3414],{"type":410,"value":3415}," static_cast\u003C",{"type":404,"tag":495,"props":3417,"children":3418},{"style":538},[3419],{"type":410,"value":3420},"char",{"type":404,"tag":495,"props":3422,"children":3423},{"style":674},[3424],{"type":410,"value":2482},{"type":404,"tag":495,"props":3426,"children":3427},{"style":550},[3428],{"type":410,"value":632},{"type":404,"tag":495,"props":3430,"children":3431},{"style":544},[3432],{"type":410,"value":3433},"random_dist",{"type":404,"tag":495,"props":3435,"children":3436},{"style":550},[3437],{"type":410,"value":632},{"type":404,"tag":495,"props":3439,"children":3440},{"style":755},[3441],{"type":410,"value":3442},"generator",{"type":404,"tag":495,"props":3444,"children":3445},{"style":550},[3446],{"type":410,"value":3447},"));\n",{"type":404,"tag":495,"props":3449,"children":3450},{"class":497,"line":608},[3451],{"type":404,"tag":495,"props":3452,"children":3453},{"style":550},[3454],{"type":410,"value":1341},{"type":404,"tag":412,"props":3456,"children":3458},{"id":3457},"接口层",[3459],{"type":410,"value":3457},{"type":404,"tag":418,"props":3461,"children":3462},{},[3463,3465,3471],{"type":410,"value":3464},"接口的声明位于 interface/kingdb.h，实现则是 interface/kingdb.cc。KingDB 类给 Database 和 Snapshot 定义了要求实现的 Get、Put、Delete、NewIterater、Open、Close、Flush、Compact、NewMultipartReader 接口。KDB 有自己的数据传输格式 ByteArray，诸如 Get、Put 这些接口在 KingDB 类中对应方法得到了重载，以实现通过 std::string 来传递键、值或者两者，可视为为接受 ByteArray 的方法的包装。所有数据库操作方法都返回 Status 对象，相关异常部分的简介见",{"type":404,"tag":429,"props":3466,"children":3468},{"href":3467},"#%E5%BC%82%E5%B8%B8%E4%B8%8E%E6%97%A5%E5%BF%97",[3469],{"type":410,"value":3470},"异常与日志",{"type":410,"value":3472},"小节。",{"type":404,"tag":418,"props":3474,"children":3475},{},[3476],{"type":410,"value":3477},"重载方法的实现示例如下，即先把 std::string 转回 ByteArray 再调用子类（Database 或 Snapshot）的实现。",{"type":404,"tag":484,"props":3479,"children":3481},{"code":3480,"language":487,"meta":398,"className":488,"style":398},"virtual Status Put(WriteOptions& write_options, const std::string& key, const std::string& chunk) {\n  ByteArray byte_array_key = NewDeepCopyByteArray(key.c_str(), key.size());\n  ByteArray byte_array_chunk = NewDeepCopyByteArray(chunk.c_str(), chunk.size());\n  return Put(write_options, byte_array_key, byte_array_chunk);\n}\n",[3482],{"type":404,"tag":491,"props":3483,"children":3484},{"__ignoreMap":398},[3485,3588,3644,3697,3738],{"type":404,"tag":495,"props":3486,"children":3487},{"class":497,"line":498},[3488,3493,3498,3503,3507,3512,3516,3521,3525,3529,3533,3537,3542,3546,3551,3555,3559,3563,3567,3571,3575,3580,3584],{"type":404,"tag":495,"props":3489,"children":3490},{"style":2002},[3491],{"type":410,"value":3492},"virtual",{"type":404,"tag":495,"props":3494,"children":3495},{"style":565},[3496],{"type":410,"value":3497}," Status",{"type":404,"tag":495,"props":3499,"children":3500},{"style":544},[3501],{"type":410,"value":3502}," Put",{"type":404,"tag":495,"props":3504,"children":3505},{"style":550},[3506],{"type":410,"value":632},{"type":404,"tag":495,"props":3508,"children":3509},{"style":565},[3510],{"type":410,"value":3511},"WriteOptions",{"type":404,"tag":495,"props":3513,"children":3514},{"style":2002},[3515],{"type":410,"value":2500},{"type":404,"tag":495,"props":3517,"children":3518},{"style":1411},[3519],{"type":410,"value":3520}," write_options",{"type":404,"tag":495,"props":3522,"children":3523},{"style":550},[3524],{"type":410,"value":642},{"type":404,"tag":495,"props":3526,"children":3527},{"style":2002},[3528],{"type":410,"value":2536},{"type":404,"tag":495,"props":3530,"children":3531},{"style":565},[3532],{"type":410,"value":2976},{"type":404,"tag":495,"props":3534,"children":3535},{"style":550},[3536],{"type":410,"value":573},{"type":404,"tag":495,"props":3538,"children":3539},{"style":565},[3540],{"type":410,"value":3541},"string",{"type":404,"tag":495,"props":3543,"children":3544},{"style":2002},[3545],{"type":410,"value":2500},{"type":404,"tag":495,"props":3547,"children":3548},{"style":1411},[3549],{"type":410,"value":3550}," key",{"type":404,"tag":495,"props":3552,"children":3553},{"style":550},[3554],{"type":410,"value":642},{"type":404,"tag":495,"props":3556,"children":3557},{"style":2002},[3558],{"type":410,"value":2536},{"type":404,"tag":495,"props":3560,"children":3561},{"style":565},[3562],{"type":410,"value":2976},{"type":404,"tag":495,"props":3564,"children":3565},{"style":550},[3566],{"type":410,"value":573},{"type":404,"tag":495,"props":3568,"children":3569},{"style":565},[3570],{"type":410,"value":3541},{"type":404,"tag":495,"props":3572,"children":3573},{"style":2002},[3574],{"type":410,"value":2500},{"type":404,"tag":495,"props":3576,"children":3577},{"style":1411},[3578],{"type":410,"value":3579}," chunk",{"type":404,"tag":495,"props":3581,"children":3582},{"style":550},[3583],{"type":410,"value":1199},{"type":404,"tag":495,"props":3585,"children":3586},{"style":550},[3587],{"type":410,"value":558},{"type":404,"tag":495,"props":3589,"children":3590},{"class":497,"line":525},[3591,3596,3600,3605,3609,3614,3618,3622,3627,3631,3635,3640],{"type":404,"tag":495,"props":3592,"children":3593},{"style":576},[3594],{"type":410,"value":3595},"  ByteArray byte_array_key ",{"type":404,"tag":495,"props":3597,"children":3598},{"style":674},[3599],{"type":410,"value":677},{"type":404,"tag":495,"props":3601,"children":3602},{"style":544},[3603],{"type":410,"value":3604}," NewDeepCopyByteArray",{"type":404,"tag":495,"props":3606,"children":3607},{"style":550},[3608],{"type":410,"value":632},{"type":404,"tag":495,"props":3610,"children":3611},{"style":576},[3612],{"type":410,"value":3613},"key",{"type":404,"tag":495,"props":3615,"children":3616},{"style":550},[3617],{"type":410,"value":687},{"type":404,"tag":495,"props":3619,"children":3620},{"style":544},[3621],{"type":410,"value":815},{"type":404,"tag":495,"props":3623,"children":3624},{"style":550},[3625],{"type":410,"value":3626},"(),",{"type":404,"tag":495,"props":3628,"children":3629},{"style":576},[3630],{"type":410,"value":3550},{"type":404,"tag":495,"props":3632,"children":3633},{"style":550},[3634],{"type":410,"value":687},{"type":404,"tag":495,"props":3636,"children":3637},{"style":544},[3638],{"type":410,"value":3639},"size",{"type":404,"tag":495,"props":3641,"children":3642},{"style":550},[3643],{"type":410,"value":820},{"type":404,"tag":495,"props":3645,"children":3646},{"class":497,"line":534},[3647,3652,3656,3660,3664,3669,3673,3677,3681,3685,3689,3693],{"type":404,"tag":495,"props":3648,"children":3649},{"style":576},[3650],{"type":410,"value":3651},"  ByteArray byte_array_chunk ",{"type":404,"tag":495,"props":3653,"children":3654},{"style":674},[3655],{"type":410,"value":677},{"type":404,"tag":495,"props":3657,"children":3658},{"style":544},[3659],{"type":410,"value":3604},{"type":404,"tag":495,"props":3661,"children":3662},{"style":550},[3663],{"type":410,"value":632},{"type":404,"tag":495,"props":3665,"children":3666},{"style":576},[3667],{"type":410,"value":3668},"chunk",{"type":404,"tag":495,"props":3670,"children":3671},{"style":550},[3672],{"type":410,"value":687},{"type":404,"tag":495,"props":3674,"children":3675},{"style":544},[3676],{"type":410,"value":815},{"type":404,"tag":495,"props":3678,"children":3679},{"style":550},[3680],{"type":410,"value":3626},{"type":404,"tag":495,"props":3682,"children":3683},{"style":576},[3684],{"type":410,"value":3579},{"type":404,"tag":495,"props":3686,"children":3687},{"style":550},[3688],{"type":410,"value":687},{"type":404,"tag":495,"props":3690,"children":3691},{"style":544},[3692],{"type":410,"value":3639},{"type":404,"tag":495,"props":3694,"children":3695},{"style":550},[3696],{"type":410,"value":820},{"type":404,"tag":495,"props":3698,"children":3699},{"class":497,"line":561},[3700,3704,3708,3712,3716,3720,3725,3729,3734],{"type":404,"tag":495,"props":3701,"children":3702},{"style":502},[3703],{"type":410,"value":1323},{"type":404,"tag":495,"props":3705,"children":3706},{"style":544},[3707],{"type":410,"value":3502},{"type":404,"tag":495,"props":3709,"children":3710},{"style":550},[3711],{"type":410,"value":632},{"type":404,"tag":495,"props":3713,"children":3714},{"style":576},[3715],{"type":410,"value":1007},{"type":404,"tag":495,"props":3717,"children":3718},{"style":550},[3719],{"type":410,"value":642},{"type":404,"tag":495,"props":3721,"children":3722},{"style":576},[3723],{"type":410,"value":3724}," byte_array_key",{"type":404,"tag":495,"props":3726,"children":3727},{"style":550},[3728],{"type":410,"value":642},{"type":404,"tag":495,"props":3730,"children":3731},{"style":576},[3732],{"type":410,"value":3733}," byte_array_chunk",{"type":404,"tag":495,"props":3735,"children":3736},{"style":550},[3737],{"type":410,"value":662},{"type":404,"tag":495,"props":3739,"children":3740},{"class":497,"line":587},[3741],{"type":404,"tag":495,"props":3742,"children":3743},{"style":550},[3744],{"type":410,"value":1341},{"type":404,"tag":1371,"props":3746,"children":3748},{"id":3747},"数据库开关",[3749],{"type":410,"value":3747},{"type":404,"tag":418,"props":3751,"children":3752},{},[3753],{"type":410,"value":3754},"数据库的开启与关闭，分别对应 Database 类的 Open 和 Close 方法。开启时，通过 stat 库函数找到数据库路径以及配置文件，使用 open 库函数获取其文件描述符。配置文件须先用 flock 锁住，使用 mmap 映射后再读取；如果没有那么分情况写入。之后，创建好 EventManager、WriteBuffer 和 StorageEngine 的实例，就完成了。关闭时过程类似，锁定住配置文件后再关闭，同时删除以上创建的实例。可以发现，资源申请全放在了 Open 中，而资源的销毁放在了 Close 中，而 Database 类析构时会自动调用 Close，所以这是一个类似 RAII 的资源管理过程。",{"type":404,"tag":484,"props":3756,"children":3758},{"code":3757,"language":487,"meta":398,"className":488,"style":398},"class Database: public KingDB {\n  virtual ~Database() { Close(); }\n  virtual Status Open() override {\n    std::string filepath_dboptions = DatabaseOptions::GetPath(dbname_);\n    fd_dboptions_ = open(filepath_dboptions.c_str(), O_RDONLY, 0644);\n    flock(fd_dboptions_, LOCK_EX | LOCK_NB);\n    Mmap mmap(filepath_dboptions, info.st_size);\n    Status status_dboptions = DatabaseOptionEncoder::DecodeFrom(mmap.datafile(), mmap.filesize(), &db_options_candidate);\n    // ...\n    em_ = new EventManager();\n    wb_ = new WriteBuffer(db_options_, em_);\n    se_ = new StorageEngine(db_options_, em_, dbname_);\n    return Status::OK(); \n  }\n  virtual void Close() override {\n    flock(fd_dboptions_, LOCK_UN);\n    close(fd_dboptions_);\n    wb_->Close();\n    se_->Close();\n    delete wb_;\n    delete se_;\n    delete em_;\n  }\n}\n",[3759],{"type":404,"tag":491,"props":3760,"children":3761},{"__ignoreMap":398},[3762,3791,3826,3855,3903,3964,4004,4047,4125,4133,4159,4202,4252,4280,4287,4314,4342,4362,4384,4404,4421,4437,4452,4459],{"type":404,"tag":495,"props":3763,"children":3764},{"class":497,"line":498},[3765,3769,3774,3778,3782,3787],{"type":404,"tag":495,"props":3766,"children":3767},{"style":538},[3768],{"type":410,"value":1915},{"type":404,"tag":495,"props":3770,"children":3771},{"style":565},[3772],{"type":410,"value":3773}," Database",{"type":404,"tag":495,"props":3775,"children":3776},{"style":550},[3777],{"type":410,"value":1600},{"type":404,"tag":495,"props":3779,"children":3780},{"style":538},[3781],{"type":410,"value":1964},{"type":404,"tag":495,"props":3783,"children":3784},{"style":565},[3785],{"type":410,"value":3786}," KingDB",{"type":404,"tag":495,"props":3788,"children":3789},{"style":550},[3790],{"type":410,"value":558},{"type":404,"tag":495,"props":3792,"children":3793},{"class":497,"line":525},[3794,3799,3804,3808,3812,3817,3821],{"type":404,"tag":495,"props":3795,"children":3796},{"style":2002},[3797],{"type":410,"value":3798},"  virtual",{"type":404,"tag":495,"props":3800,"children":3801},{"style":544},[3802],{"type":410,"value":3803}," ~Database",{"type":404,"tag":495,"props":3805,"children":3806},{"style":550},[3807],{"type":410,"value":553},{"type":404,"tag":495,"props":3809,"children":3810},{"style":550},[3811],{"type":410,"value":2024},{"type":404,"tag":495,"props":3813,"children":3814},{"style":544},[3815],{"type":410,"value":3816}," Close",{"type":404,"tag":495,"props":3818,"children":3819},{"style":550},[3820],{"type":410,"value":1991},{"type":404,"tag":495,"props":3822,"children":3823},{"style":550},[3824],{"type":410,"value":3825}," }\n",{"type":404,"tag":495,"props":3827,"children":3828},{"class":497,"line":534},[3829,3833,3837,3842,3846,3851],{"type":404,"tag":495,"props":3830,"children":3831},{"style":2002},[3832],{"type":410,"value":3798},{"type":404,"tag":495,"props":3834,"children":3835},{"style":565},[3836],{"type":410,"value":3497},{"type":404,"tag":495,"props":3838,"children":3839},{"style":544},[3840],{"type":410,"value":3841}," Open",{"type":404,"tag":495,"props":3843,"children":3844},{"style":550},[3845],{"type":410,"value":553},{"type":404,"tag":495,"props":3847,"children":3848},{"style":2002},[3849],{"type":410,"value":3850}," override",{"type":404,"tag":495,"props":3852,"children":3853},{"style":550},[3854],{"type":410,"value":558},{"type":404,"tag":495,"props":3856,"children":3857},{"class":497,"line":561},[3858,3863,3867,3872,3876,3881,3885,3890,3894,3899],{"type":404,"tag":495,"props":3859,"children":3860},{"style":565},[3861],{"type":410,"value":3862},"    std",{"type":404,"tag":495,"props":3864,"children":3865},{"style":550},[3866],{"type":410,"value":573},{"type":404,"tag":495,"props":3868,"children":3869},{"style":755},[3870],{"type":410,"value":3871},"string filepath_dboptions ",{"type":404,"tag":495,"props":3873,"children":3874},{"style":674},[3875],{"type":410,"value":677},{"type":404,"tag":495,"props":3877,"children":3878},{"style":565},[3879],{"type":410,"value":3880}," DatabaseOptions",{"type":404,"tag":495,"props":3882,"children":3883},{"style":550},[3884],{"type":410,"value":573},{"type":404,"tag":495,"props":3886,"children":3887},{"style":544},[3888],{"type":410,"value":3889},"GetPath",{"type":404,"tag":495,"props":3891,"children":3892},{"style":550},[3893],{"type":410,"value":632},{"type":404,"tag":495,"props":3895,"children":3896},{"style":755},[3897],{"type":410,"value":3898},"dbname_",{"type":404,"tag":495,"props":3900,"children":3901},{"style":550},[3902],{"type":410,"value":662},{"type":404,"tag":495,"props":3904,"children":3905},{"class":497,"line":587},[3906,3911,3915,3920,3924,3929,3933,3937,3941,3946,3950,3955,3960],{"type":404,"tag":495,"props":3907,"children":3908},{"style":755},[3909],{"type":410,"value":3910},"    fd_dboptions_ ",{"type":404,"tag":495,"props":3912,"children":3913},{"style":674},[3914],{"type":410,"value":677},{"type":404,"tag":495,"props":3916,"children":3917},{"style":544},[3918],{"type":410,"value":3919}," open",{"type":404,"tag":495,"props":3921,"children":3922},{"style":550},[3923],{"type":410,"value":632},{"type":404,"tag":495,"props":3925,"children":3926},{"style":576},[3927],{"type":410,"value":3928},"filepath_dboptions",{"type":404,"tag":495,"props":3930,"children":3931},{"style":550},[3932],{"type":410,"value":687},{"type":404,"tag":495,"props":3934,"children":3935},{"style":544},[3936],{"type":410,"value":815},{"type":404,"tag":495,"props":3938,"children":3939},{"style":550},[3940],{"type":410,"value":3626},{"type":404,"tag":495,"props":3942,"children":3943},{"style":755},[3944],{"type":410,"value":3945}," O_RDONLY",{"type":404,"tag":495,"props":3947,"children":3948},{"style":550},[3949],{"type":410,"value":642},{"type":404,"tag":495,"props":3951,"children":3953},{"style":3952},"--shiki-light:#F76D47;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[3954],{"type":410,"value":1328},{"type":404,"tag":495,"props":3956,"children":3957},{"style":836},[3958],{"type":410,"value":3959},"644",{"type":404,"tag":495,"props":3961,"children":3962},{"style":550},[3963],{"type":410,"value":662},{"type":404,"tag":495,"props":3965,"children":3966},{"class":497,"line":608},[3967,3972,3976,3981,3985,3990,3995,4000],{"type":404,"tag":495,"props":3968,"children":3969},{"style":544},[3970],{"type":410,"value":3971},"    flock",{"type":404,"tag":495,"props":3973,"children":3974},{"style":550},[3975],{"type":410,"value":632},{"type":404,"tag":495,"props":3977,"children":3978},{"style":755},[3979],{"type":410,"value":3980},"fd_dboptions_",{"type":404,"tag":495,"props":3982,"children":3983},{"style":550},[3984],{"type":410,"value":642},{"type":404,"tag":495,"props":3986,"children":3987},{"style":755},[3988],{"type":410,"value":3989}," LOCK_EX ",{"type":404,"tag":495,"props":3991,"children":3992},{"style":674},[3993],{"type":410,"value":3994},"|",{"type":404,"tag":495,"props":3996,"children":3997},{"style":755},[3998],{"type":410,"value":3999}," LOCK_NB",{"type":404,"tag":495,"props":4001,"children":4002},{"style":550},[4003],{"type":410,"value":662},{"type":404,"tag":495,"props":4005,"children":4006},{"class":497,"line":665},[4007,4012,4017,4021,4025,4029,4034,4038,4043],{"type":404,"tag":495,"props":4008,"children":4009},{"style":755},[4010],{"type":410,"value":4011},"    Mmap ",{"type":404,"tag":495,"props":4013,"children":4014},{"style":544},[4015],{"type":410,"value":4016},"mmap",{"type":404,"tag":495,"props":4018,"children":4019},{"style":550},[4020],{"type":410,"value":632},{"type":404,"tag":495,"props":4022,"children":4023},{"style":755},[4024],{"type":410,"value":3928},{"type":404,"tag":495,"props":4026,"children":4027},{"style":550},[4028],{"type":410,"value":642},{"type":404,"tag":495,"props":4030,"children":4031},{"style":576},[4032],{"type":410,"value":4033}," info",{"type":404,"tag":495,"props":4035,"children":4036},{"style":550},[4037],{"type":410,"value":687},{"type":404,"tag":495,"props":4039,"children":4040},{"style":576},[4041],{"type":410,"value":4042},"st_size",{"type":404,"tag":495,"props":4044,"children":4045},{"style":550},[4046],{"type":410,"value":662},{"type":404,"tag":495,"props":4048,"children":4049},{"class":497,"line":700},[4050,4055,4059,4064,4068,4073,4077,4081,4085,4090,4094,4099,4103,4108,4112,4116,4121],{"type":404,"tag":495,"props":4051,"children":4052},{"style":755},[4053],{"type":410,"value":4054},"    Status status_dboptions ",{"type":404,"tag":495,"props":4056,"children":4057},{"style":674},[4058],{"type":410,"value":677},{"type":404,"tag":495,"props":4060,"children":4061},{"style":565},[4062],{"type":410,"value":4063}," DatabaseOptionEncoder",{"type":404,"tag":495,"props":4065,"children":4066},{"style":550},[4067],{"type":410,"value":573},{"type":404,"tag":495,"props":4069,"children":4070},{"style":544},[4071],{"type":410,"value":4072},"DecodeFrom",{"type":404,"tag":495,"props":4074,"children":4075},{"style":550},[4076],{"type":410,"value":632},{"type":404,"tag":495,"props":4078,"children":4079},{"style":576},[4080],{"type":410,"value":4016},{"type":404,"tag":495,"props":4082,"children":4083},{"style":550},[4084],{"type":410,"value":687},{"type":404,"tag":495,"props":4086,"children":4087},{"style":544},[4088],{"type":410,"value":4089},"datafile",{"type":404,"tag":495,"props":4091,"children":4092},{"style":550},[4093],{"type":410,"value":3626},{"type":404,"tag":495,"props":4095,"children":4096},{"style":576},[4097],{"type":410,"value":4098}," mmap",{"type":404,"tag":495,"props":4100,"children":4101},{"style":550},[4102],{"type":410,"value":687},{"type":404,"tag":495,"props":4104,"children":4105},{"style":544},[4106],{"type":410,"value":4107},"filesize",{"type":404,"tag":495,"props":4109,"children":4110},{"style":550},[4111],{"type":410,"value":3626},{"type":404,"tag":495,"props":4113,"children":4114},{"style":674},[4115],{"type":410,"value":1130},{"type":404,"tag":495,"props":4117,"children":4118},{"style":755},[4119],{"type":410,"value":4120},"db_options_candidate",{"type":404,"tag":495,"props":4122,"children":4123},{"style":550},[4124],{"type":410,"value":662},{"type":404,"tag":495,"props":4126,"children":4127},{"class":497,"line":742},[4128],{"type":404,"tag":495,"props":4129,"children":4130},{"style":1504},[4131],{"type":410,"value":4132},"    // ...\n",{"type":404,"tag":495,"props":4134,"children":4135},{"class":497,"line":823},[4136,4141,4145,4150,4155],{"type":404,"tag":495,"props":4137,"children":4138},{"style":755},[4139],{"type":410,"value":4140},"    em_ ",{"type":404,"tag":495,"props":4142,"children":4143},{"style":674},[4144],{"type":410,"value":677},{"type":404,"tag":495,"props":4146,"children":4147},{"style":674},[4148],{"type":410,"value":4149}," new",{"type":404,"tag":495,"props":4151,"children":4152},{"style":544},[4153],{"type":410,"value":4154}," EventManager",{"type":404,"tag":495,"props":4156,"children":4157},{"style":550},[4158],{"type":410,"value":697},{"type":404,"tag":495,"props":4160,"children":4161},{"class":497,"line":846},[4162,4167,4171,4175,4180,4184,4189,4193,4198],{"type":404,"tag":495,"props":4163,"children":4164},{"style":755},[4165],{"type":410,"value":4166},"    wb_ ",{"type":404,"tag":495,"props":4168,"children":4169},{"style":674},[4170],{"type":410,"value":677},{"type":404,"tag":495,"props":4172,"children":4173},{"style":674},[4174],{"type":410,"value":4149},{"type":404,"tag":495,"props":4176,"children":4177},{"style":544},[4178],{"type":410,"value":4179}," WriteBuffer",{"type":404,"tag":495,"props":4181,"children":4182},{"style":550},[4183],{"type":410,"value":632},{"type":404,"tag":495,"props":4185,"children":4186},{"style":755},[4187],{"type":410,"value":4188},"db_options_",{"type":404,"tag":495,"props":4190,"children":4191},{"style":550},[4192],{"type":410,"value":642},{"type":404,"tag":495,"props":4194,"children":4195},{"style":755},[4196],{"type":410,"value":4197}," em_",{"type":404,"tag":495,"props":4199,"children":4200},{"style":550},[4201],{"type":410,"value":662},{"type":404,"tag":495,"props":4203,"children":4204},{"class":497,"line":855},[4205,4210,4214,4218,4223,4227,4231,4235,4239,4243,4248],{"type":404,"tag":495,"props":4206,"children":4207},{"style":755},[4208],{"type":410,"value":4209},"    se_ ",{"type":404,"tag":495,"props":4211,"children":4212},{"style":674},[4213],{"type":410,"value":677},{"type":404,"tag":495,"props":4215,"children":4216},{"style":674},[4217],{"type":410,"value":4149},{"type":404,"tag":495,"props":4219,"children":4220},{"style":544},[4221],{"type":410,"value":4222}," StorageEngine",{"type":404,"tag":495,"props":4224,"children":4225},{"style":550},[4226],{"type":410,"value":632},{"type":404,"tag":495,"props":4228,"children":4229},{"style":755},[4230],{"type":410,"value":4188},{"type":404,"tag":495,"props":4232,"children":4233},{"style":550},[4234],{"type":410,"value":642},{"type":404,"tag":495,"props":4236,"children":4237},{"style":755},[4238],{"type":410,"value":4197},{"type":404,"tag":495,"props":4240,"children":4241},{"style":550},[4242],{"type":410,"value":642},{"type":404,"tag":495,"props":4244,"children":4245},{"style":755},[4246],{"type":410,"value":4247}," dbname_",{"type":404,"tag":495,"props":4249,"children":4250},{"style":550},[4251],{"type":410,"value":662},{"type":404,"tag":495,"props":4253,"children":4254},{"class":497,"line":863},[4255,4259,4263,4267,4272,4276],{"type":404,"tag":495,"props":4256,"children":4257},{"style":502},[4258],{"type":410,"value":2735},{"type":404,"tag":495,"props":4260,"children":4261},{"style":565},[4262],{"type":410,"value":3497},{"type":404,"tag":495,"props":4264,"children":4265},{"style":550},[4266],{"type":410,"value":573},{"type":404,"tag":495,"props":4268,"children":4269},{"style":544},[4270],{"type":410,"value":4271},"OK",{"type":404,"tag":495,"props":4273,"children":4274},{"style":550},[4275],{"type":410,"value":1991},{"type":404,"tag":495,"props":4277,"children":4278},{"style":755},[4279],{"type":410,"value":1243},{"type":404,"tag":495,"props":4281,"children":4282},{"class":497,"line":906},[4283],{"type":404,"tag":495,"props":4284,"children":4285},{"style":550},[4286],{"type":410,"value":852},{"type":404,"tag":495,"props":4288,"children":4289},{"class":497,"line":947},[4290,4294,4298,4302,4306,4310],{"type":404,"tag":495,"props":4291,"children":4292},{"style":2002},[4293],{"type":410,"value":3798},{"type":404,"tag":495,"props":4295,"children":4296},{"style":538},[4297],{"type":410,"value":2010},{"type":404,"tag":495,"props":4299,"children":4300},{"style":544},[4301],{"type":410,"value":3816},{"type":404,"tag":495,"props":4303,"children":4304},{"style":550},[4305],{"type":410,"value":553},{"type":404,"tag":495,"props":4307,"children":4308},{"style":2002},[4309],{"type":410,"value":3850},{"type":404,"tag":495,"props":4311,"children":4312},{"style":550},[4313],{"type":410,"value":558},{"type":404,"tag":495,"props":4315,"children":4316},{"class":497,"line":955},[4317,4321,4325,4329,4333,4338],{"type":404,"tag":495,"props":4318,"children":4319},{"style":544},[4320],{"type":410,"value":3971},{"type":404,"tag":495,"props":4322,"children":4323},{"style":550},[4324],{"type":410,"value":632},{"type":404,"tag":495,"props":4326,"children":4327},{"style":755},[4328],{"type":410,"value":3980},{"type":404,"tag":495,"props":4330,"children":4331},{"style":550},[4332],{"type":410,"value":642},{"type":404,"tag":495,"props":4334,"children":4335},{"style":755},[4336],{"type":410,"value":4337}," LOCK_UN",{"type":404,"tag":495,"props":4339,"children":4340},{"style":550},[4341],{"type":410,"value":662},{"type":404,"tag":495,"props":4343,"children":4344},{"class":497,"line":976},[4345,4350,4354,4358],{"type":404,"tag":495,"props":4346,"children":4347},{"style":544},[4348],{"type":410,"value":4349},"    close",{"type":404,"tag":495,"props":4351,"children":4352},{"style":550},[4353],{"type":410,"value":632},{"type":404,"tag":495,"props":4355,"children":4356},{"style":755},[4357],{"type":410,"value":3980},{"type":404,"tag":495,"props":4359,"children":4360},{"style":550},[4361],{"type":410,"value":662},{"type":404,"tag":495,"props":4363,"children":4364},{"class":497,"line":1032},[4365,4370,4375,4380],{"type":404,"tag":495,"props":4366,"children":4367},{"style":576},[4368],{"type":410,"value":4369},"    wb_",{"type":404,"tag":495,"props":4371,"children":4372},{"style":550},[4373],{"type":410,"value":4374},"->",{"type":404,"tag":495,"props":4376,"children":4377},{"style":544},[4378],{"type":410,"value":4379},"Close",{"type":404,"tag":495,"props":4381,"children":4382},{"style":550},[4383],{"type":410,"value":697},{"type":404,"tag":495,"props":4385,"children":4386},{"class":497,"line":1040},[4387,4392,4396,4400],{"type":404,"tag":495,"props":4388,"children":4389},{"style":576},[4390],{"type":410,"value":4391},"    se_",{"type":404,"tag":495,"props":4393,"children":4394},{"style":550},[4395],{"type":410,"value":4374},{"type":404,"tag":495,"props":4397,"children":4398},{"style":544},[4399],{"type":410,"value":4379},{"type":404,"tag":495,"props":4401,"children":4402},{"style":550},[4403],{"type":410,"value":697},{"type":404,"tag":495,"props":4405,"children":4406},{"class":497,"line":1061},[4407,4412,4417],{"type":404,"tag":495,"props":4408,"children":4409},{"style":674},[4410],{"type":410,"value":4411},"    delete",{"type":404,"tag":495,"props":4413,"children":4414},{"style":755},[4415],{"type":410,"value":4416}," wb_",{"type":404,"tag":495,"props":4418,"children":4419},{"style":550},[4420],{"type":410,"value":584},{"type":404,"tag":495,"props":4422,"children":4423},{"class":497,"line":1082},[4424,4428,4433],{"type":404,"tag":495,"props":4425,"children":4426},{"style":674},[4427],{"type":410,"value":4411},{"type":404,"tag":495,"props":4429,"children":4430},{"style":755},[4431],{"type":410,"value":4432}," se_",{"type":404,"tag":495,"props":4434,"children":4435},{"style":550},[4436],{"type":410,"value":584},{"type":404,"tag":495,"props":4438,"children":4439},{"class":497,"line":1142},[4440,4444,4448],{"type":404,"tag":495,"props":4441,"children":4442},{"style":674},[4443],{"type":410,"value":4411},{"type":404,"tag":495,"props":4445,"children":4446},{"style":755},[4447],{"type":410,"value":4197},{"type":404,"tag":495,"props":4449,"children":4450},{"style":550},[4451],{"type":410,"value":584},{"type":404,"tag":495,"props":4453,"children":4454},{"class":497,"line":1206},[4455],{"type":404,"tag":495,"props":4456,"children":4457},{"style":550},[4458],{"type":410,"value":852},{"type":404,"tag":495,"props":4460,"children":4461},{"class":497,"line":1246},[4462],{"type":404,"tag":495,"props":4463,"children":4464},{"style":550},[4465],{"type":410,"value":1341},{"type":404,"tag":418,"props":4467,"children":4468},{},[4469],{"type":410,"value":4470},"因为数据库不能同时关闭或是开启，所以 Open 以及 Close 中都使用了 std::unique_lock 进行锁定。",{"type":404,"tag":484,"props":4472,"children":4474},{"code":4473,"language":487,"meta":398,"className":488,"style":398},"virtual Status Open() override {\n  std::unique_lock\u003Cstd::mutex> lock(mutex_close_);\n}\nvirtual void Close() override {\n  std::unique_lock\u003Cstd::mutex> lock(mutex_close_);\n}\n",[4475],{"type":404,"tag":491,"props":4476,"children":4477},{"__ignoreMap":398},[4478,4505,4560,4567,4594,4645],{"type":404,"tag":495,"props":4479,"children":4480},{"class":497,"line":498},[4481,4485,4489,4493,4497,4501],{"type":404,"tag":495,"props":4482,"children":4483},{"style":2002},[4484],{"type":410,"value":3492},{"type":404,"tag":495,"props":4486,"children":4487},{"style":565},[4488],{"type":410,"value":3497},{"type":404,"tag":495,"props":4490,"children":4491},{"style":544},[4492],{"type":410,"value":3841},{"type":404,"tag":495,"props":4494,"children":4495},{"style":550},[4496],{"type":410,"value":553},{"type":404,"tag":495,"props":4498,"children":4499},{"style":2002},[4500],{"type":410,"value":3850},{"type":404,"tag":495,"props":4502,"children":4503},{"style":550},[4504],{"type":410,"value":558},{"type":404,"tag":495,"props":4506,"children":4507},{"class":497,"line":525},[4508,4512,4516,4521,4525,4529,4533,4538,4542,4547,4551,4556],{"type":404,"tag":495,"props":4509,"children":4510},{"style":565},[4511],{"type":410,"value":869},{"type":404,"tag":495,"props":4513,"children":4514},{"style":550},[4515],{"type":410,"value":573},{"type":404,"tag":495,"props":4517,"children":4518},{"style":576},[4519],{"type":410,"value":4520},"unique_lock",{"type":404,"tag":495,"props":4522,"children":4523},{"style":674},[4524],{"type":410,"value":3274},{"type":404,"tag":495,"props":4526,"children":4527},{"style":565},[4528],{"type":410,"value":2946},{"type":404,"tag":495,"props":4530,"children":4531},{"style":550},[4532],{"type":410,"value":573},{"type":404,"tag":495,"props":4534,"children":4535},{"style":576},[4536],{"type":410,"value":4537},"mutex",{"type":404,"tag":495,"props":4539,"children":4540},{"style":674},[4541],{"type":410,"value":2482},{"type":404,"tag":495,"props":4543,"children":4544},{"style":544},[4545],{"type":410,"value":4546}," lock",{"type":404,"tag":495,"props":4548,"children":4549},{"style":550},[4550],{"type":410,"value":632},{"type":404,"tag":495,"props":4552,"children":4553},{"style":576},[4554],{"type":410,"value":4555},"mutex_close_",{"type":404,"tag":495,"props":4557,"children":4558},{"style":550},[4559],{"type":410,"value":662},{"type":404,"tag":495,"props":4561,"children":4562},{"class":497,"line":534},[4563],{"type":404,"tag":495,"props":4564,"children":4565},{"style":550},[4566],{"type":410,"value":1341},{"type":404,"tag":495,"props":4568,"children":4569},{"class":497,"line":561},[4570,4574,4578,4582,4586,4590],{"type":404,"tag":495,"props":4571,"children":4572},{"style":2002},[4573],{"type":410,"value":3492},{"type":404,"tag":495,"props":4575,"children":4576},{"style":538},[4577],{"type":410,"value":2010},{"type":404,"tag":495,"props":4579,"children":4580},{"style":544},[4581],{"type":410,"value":3816},{"type":404,"tag":495,"props":4583,"children":4584},{"style":550},[4585],{"type":410,"value":553},{"type":404,"tag":495,"props":4587,"children":4588},{"style":2002},[4589],{"type":410,"value":3850},{"type":404,"tag":495,"props":4591,"children":4592},{"style":550},[4593],{"type":410,"value":558},{"type":404,"tag":495,"props":4595,"children":4596},{"class":497,"line":587},[4597,4601,4605,4609,4613,4617,4621,4625,4629,4633,4637,4641],{"type":404,"tag":495,"props":4598,"children":4599},{"style":565},[4600],{"type":410,"value":869},{"type":404,"tag":495,"props":4602,"children":4603},{"style":550},[4604],{"type":410,"value":573},{"type":404,"tag":495,"props":4606,"children":4607},{"style":576},[4608],{"type":410,"value":4520},{"type":404,"tag":495,"props":4610,"children":4611},{"style":674},[4612],{"type":410,"value":3274},{"type":404,"tag":495,"props":4614,"children":4615},{"style":565},[4616],{"type":410,"value":2946},{"type":404,"tag":495,"props":4618,"children":4619},{"style":550},[4620],{"type":410,"value":573},{"type":404,"tag":495,"props":4622,"children":4623},{"style":576},[4624],{"type":410,"value":4537},{"type":404,"tag":495,"props":4626,"children":4627},{"style":674},[4628],{"type":410,"value":2482},{"type":404,"tag":495,"props":4630,"children":4631},{"style":544},[4632],{"type":410,"value":4546},{"type":404,"tag":495,"props":4634,"children":4635},{"style":550},[4636],{"type":410,"value":632},{"type":404,"tag":495,"props":4638,"children":4639},{"style":576},[4640],{"type":410,"value":4555},{"type":404,"tag":495,"props":4642,"children":4643},{"style":550},[4644],{"type":410,"value":662},{"type":404,"tag":495,"props":4646,"children":4647},{"class":497,"line":608},[4648],{"type":404,"tag":495,"props":4649,"children":4650},{"style":550},[4651],{"type":410,"value":1341},{"type":404,"tag":412,"props":4653,"children":4654},{"id":3470},[4655],{"type":410,"value":3470},{"type":404,"tag":418,"props":4657,"children":4658},{},[4659],{"type":410,"value":4660},"代码没有使用 C++ 风格的异常捕获，取而代之的是设计了状态类 Status。就像 kingdb_user 示例展示的，所有数据库操作都会返回一个状态实例，通过调用其 IsOK 方法，调用者可以判断处出操作有没有成功；如果失败了，可以使用 ToString 方法把出错原因输出。尽管这种设计会带来额外的内存开销，且使每次调用都带来轻微的性能消耗，不过这种消耗可以避免魔法数值，它将错误码和核心解耦，使代码有更佳的可读性。",{"type":404,"tag":484,"props":4662,"children":4664},{"code":4663,"language":487,"meta":398,"className":488,"style":398},"class Status {\n  // ...\n  static Status OK() { return Status(); }\n  bool IsOK() const { return (code_ == kOK); }\n  // ...\n  enum Code {\n    kOK = 0, \n    kNotFound = 1,\n    kDeleteOrder = 2,\n    kInvalidArgument = 3,\n    kIOError = 4,\n    kDone = 5,\n    kMultipartRequired = 6\n  };\n  // ...\n}\nstd::string Status::ToString() const {\n  if (message1_ == \"\") {\n    return \"OK\";\n  } else {\n    char tmp[30];\n    const char* type;\n    switch (code()) {\n      case kOK:\n        type = \"OK\";\n        break;\n      // ...\n    }\n    // ...\n    return result;\n  }\n}\n",[4665],{"type":404,"tag":491,"props":4666,"children":4667},{"__ignoreMap":398},[4668,4683,4690,4731,4786,4793,4810,4835,4856,4877,4898,4919,4940,4957,4965,4972,4979,5018,5051,5074,5089,5115,5142,5166,5183,5211,5223,5231,5239,5246,5263,5271],{"type":404,"tag":495,"props":4669,"children":4670},{"class":497,"line":498},[4671,4675,4679],{"type":404,"tag":495,"props":4672,"children":4673},{"style":538},[4674],{"type":410,"value":1915},{"type":404,"tag":495,"props":4676,"children":4677},{"style":565},[4678],{"type":410,"value":3497},{"type":404,"tag":495,"props":4680,"children":4681},{"style":550},[4682],{"type":410,"value":558},{"type":404,"tag":495,"props":4684,"children":4685},{"class":497,"line":525},[4686],{"type":404,"tag":495,"props":4687,"children":4688},{"style":1504},[4689],{"type":410,"value":1860},{"type":404,"tag":495,"props":4691,"children":4692},{"class":497,"line":534},[4693,4697,4701,4706,4710,4714,4719,4723,4727],{"type":404,"tag":495,"props":4694,"children":4695},{"style":2002},[4696],{"type":410,"value":2005},{"type":404,"tag":495,"props":4698,"children":4699},{"style":565},[4700],{"type":410,"value":3497},{"type":404,"tag":495,"props":4702,"children":4703},{"style":544},[4704],{"type":410,"value":4705}," OK",{"type":404,"tag":495,"props":4707,"children":4708},{"style":550},[4709],{"type":410,"value":553},{"type":404,"tag":495,"props":4711,"children":4712},{"style":550},[4713],{"type":410,"value":2024},{"type":404,"tag":495,"props":4715,"children":4716},{"style":502},[4717],{"type":410,"value":4718}," return",{"type":404,"tag":495,"props":4720,"children":4721},{"style":544},[4722],{"type":410,"value":3497},{"type":404,"tag":495,"props":4724,"children":4725},{"style":550},[4726],{"type":410,"value":1991},{"type":404,"tag":495,"props":4728,"children":4729},{"style":550},[4730],{"type":410,"value":3825},{"type":404,"tag":495,"props":4732,"children":4733},{"class":497,"line":561},[4734,4739,4744,4748,4752,4756,4760,4764,4769,4773,4778,4782],{"type":404,"tag":495,"props":4735,"children":4736},{"style":538},[4737],{"type":410,"value":4738},"  bool",{"type":404,"tag":495,"props":4740,"children":4741},{"style":544},[4742],{"type":410,"value":4743}," IsOK",{"type":404,"tag":495,"props":4745,"children":4746},{"style":550},[4747],{"type":410,"value":553},{"type":404,"tag":495,"props":4749,"children":4750},{"style":2002},[4751],{"type":410,"value":2536},{"type":404,"tag":495,"props":4753,"children":4754},{"style":550},[4755],{"type":410,"value":2024},{"type":404,"tag":495,"props":4757,"children":4758},{"style":502},[4759],{"type":410,"value":4718},{"type":404,"tag":495,"props":4761,"children":4762},{"style":550},[4763],{"type":410,"value":711},{"type":404,"tag":495,"props":4765,"children":4766},{"style":755},[4767],{"type":410,"value":4768},"code_ ",{"type":404,"tag":495,"props":4770,"children":4771},{"style":674},[4772],{"type":410,"value":1182},{"type":404,"tag":495,"props":4774,"children":4775},{"style":755},[4776],{"type":410,"value":4777}," kOK",{"type":404,"tag":495,"props":4779,"children":4780},{"style":550},[4781],{"type":410,"value":1238},{"type":404,"tag":495,"props":4783,"children":4784},{"style":550},[4785],{"type":410,"value":3825},{"type":404,"tag":495,"props":4787,"children":4788},{"class":497,"line":587},[4789],{"type":404,"tag":495,"props":4790,"children":4791},{"style":1504},[4792],{"type":410,"value":1860},{"type":404,"tag":495,"props":4794,"children":4795},{"class":497,"line":608},[4796,4801,4806],{"type":404,"tag":495,"props":4797,"children":4798},{"style":538},[4799],{"type":410,"value":4800},"  enum",{"type":404,"tag":495,"props":4802,"children":4803},{"style":565},[4804],{"type":410,"value":4805}," Code",{"type":404,"tag":495,"props":4807,"children":4808},{"style":550},[4809],{"type":410,"value":558},{"type":404,"tag":495,"props":4811,"children":4812},{"class":497,"line":665},[4813,4819,4823,4827,4831],{"type":404,"tag":495,"props":4814,"children":4816},{"style":4815},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#F8F8F2",[4817],{"type":410,"value":4818},"    kOK",{"type":404,"tag":495,"props":4820,"children":4821},{"style":674},[4822],{"type":410,"value":2161},{"type":404,"tag":495,"props":4824,"children":4825},{"style":836},[4826],{"type":410,"value":1328},{"type":404,"tag":495,"props":4828,"children":4829},{"style":550},[4830],{"type":410,"value":642},{"type":404,"tag":495,"props":4832,"children":4833},{"style":755},[4834],{"type":410,"value":1243},{"type":404,"tag":495,"props":4836,"children":4837},{"class":497,"line":700},[4838,4843,4847,4851],{"type":404,"tag":495,"props":4839,"children":4840},{"style":4815},[4841],{"type":410,"value":4842},"    kNotFound",{"type":404,"tag":495,"props":4844,"children":4845},{"style":674},[4846],{"type":410,"value":2161},{"type":404,"tag":495,"props":4848,"children":4849},{"style":836},[4850],{"type":410,"value":3053},{"type":404,"tag":495,"props":4852,"children":4853},{"style":550},[4854],{"type":410,"value":4855},",\n",{"type":404,"tag":495,"props":4857,"children":4858},{"class":497,"line":742},[4859,4864,4868,4873],{"type":404,"tag":495,"props":4860,"children":4861},{"style":4815},[4862],{"type":410,"value":4863},"    kDeleteOrder",{"type":404,"tag":495,"props":4865,"children":4866},{"style":674},[4867],{"type":410,"value":2161},{"type":404,"tag":495,"props":4869,"children":4870},{"style":836},[4871],{"type":410,"value":4872}," 2",{"type":404,"tag":495,"props":4874,"children":4875},{"style":550},[4876],{"type":410,"value":4855},{"type":404,"tag":495,"props":4878,"children":4879},{"class":497,"line":823},[4880,4885,4889,4894],{"type":404,"tag":495,"props":4881,"children":4882},{"style":4815},[4883],{"type":410,"value":4884},"    kInvalidArgument",{"type":404,"tag":495,"props":4886,"children":4887},{"style":674},[4888],{"type":410,"value":2161},{"type":404,"tag":495,"props":4890,"children":4891},{"style":836},[4892],{"type":410,"value":4893}," 3",{"type":404,"tag":495,"props":4895,"children":4896},{"style":550},[4897],{"type":410,"value":4855},{"type":404,"tag":495,"props":4899,"children":4900},{"class":497,"line":846},[4901,4906,4910,4915],{"type":404,"tag":495,"props":4902,"children":4903},{"style":4815},[4904],{"type":410,"value":4905},"    kIOError",{"type":404,"tag":495,"props":4907,"children":4908},{"style":674},[4909],{"type":410,"value":2161},{"type":404,"tag":495,"props":4911,"children":4912},{"style":836},[4913],{"type":410,"value":4914}," 4",{"type":404,"tag":495,"props":4916,"children":4917},{"style":550},[4918],{"type":410,"value":4855},{"type":404,"tag":495,"props":4920,"children":4921},{"class":497,"line":855},[4922,4927,4931,4936],{"type":404,"tag":495,"props":4923,"children":4924},{"style":4815},[4925],{"type":410,"value":4926},"    kDone",{"type":404,"tag":495,"props":4928,"children":4929},{"style":674},[4930],{"type":410,"value":2161},{"type":404,"tag":495,"props":4932,"children":4933},{"style":836},[4934],{"type":410,"value":4935}," 5",{"type":404,"tag":495,"props":4937,"children":4938},{"style":550},[4939],{"type":410,"value":4855},{"type":404,"tag":495,"props":4941,"children":4942},{"class":497,"line":863},[4943,4948,4952],{"type":404,"tag":495,"props":4944,"children":4945},{"style":4815},[4946],{"type":410,"value":4947},"    kMultipartRequired",{"type":404,"tag":495,"props":4949,"children":4950},{"style":674},[4951],{"type":410,"value":2161},{"type":404,"tag":495,"props":4953,"children":4954},{"style":836},[4955],{"type":410,"value":4956}," 6\n",{"type":404,"tag":495,"props":4958,"children":4959},{"class":497,"line":906},[4960],{"type":404,"tag":495,"props":4961,"children":4962},{"style":550},[4963],{"type":410,"value":4964},"  };\n",{"type":404,"tag":495,"props":4966,"children":4967},{"class":497,"line":947},[4968],{"type":404,"tag":495,"props":4969,"children":4970},{"style":1504},[4971],{"type":410,"value":1860},{"type":404,"tag":495,"props":4973,"children":4974},{"class":497,"line":955},[4975],{"type":404,"tag":495,"props":4976,"children":4977},{"style":550},[4978],{"type":410,"value":1341},{"type":404,"tag":495,"props":4980,"children":4981},{"class":497,"line":976},[4982,4986,4990,4994,4998,5002,5006,5010,5014],{"type":404,"tag":495,"props":4983,"children":4984},{"style":565},[4985],{"type":410,"value":2946},{"type":404,"tag":495,"props":4987,"children":4988},{"style":550},[4989],{"type":410,"value":573},{"type":404,"tag":495,"props":4991,"children":4992},{"style":565},[4993],{"type":410,"value":3541},{"type":404,"tag":495,"props":4995,"children":4996},{"style":565},[4997],{"type":410,"value":3497},{"type":404,"tag":495,"props":4999,"children":5000},{"style":550},[5001],{"type":410,"value":573},{"type":404,"tag":495,"props":5003,"children":5004},{"style":544},[5005],{"type":410,"value":805},{"type":404,"tag":495,"props":5007,"children":5008},{"style":550},[5009],{"type":410,"value":553},{"type":404,"tag":495,"props":5011,"children":5012},{"style":2002},[5013],{"type":410,"value":2536},{"type":404,"tag":495,"props":5015,"children":5016},{"style":550},[5017],{"type":410,"value":558},{"type":404,"tag":495,"props":5019,"children":5020},{"class":497,"line":1032},[5021,5025,5029,5034,5038,5043,5047],{"type":404,"tag":495,"props":5022,"children":5023},{"style":502},[5024],{"type":410,"value":706},{"type":404,"tag":495,"props":5026,"children":5027},{"style":550},[5028],{"type":410,"value":711},{"type":404,"tag":495,"props":5030,"children":5031},{"style":755},[5032],{"type":410,"value":5033},"message1_ ",{"type":404,"tag":495,"props":5035,"children":5036},{"style":674},[5037],{"type":410,"value":1182},{"type":404,"tag":495,"props":5039,"children":5040},{"style":508},[5041],{"type":410,"value":5042}," \"\"",{"type":404,"tag":495,"props":5044,"children":5045},{"style":550},[5046],{"type":410,"value":1199},{"type":404,"tag":495,"props":5048,"children":5049},{"style":550},[5050],{"type":410,"value":558},{"type":404,"tag":495,"props":5052,"children":5053},{"class":497,"line":1040},[5054,5058,5062,5066,5070],{"type":404,"tag":495,"props":5055,"children":5056},{"style":502},[5057],{"type":410,"value":2735},{"type":404,"tag":495,"props":5059,"children":5060},{"style":508},[5061],{"type":410,"value":647},{"type":404,"tag":495,"props":5063,"children":5064},{"style":514},[5065],{"type":410,"value":4271},{"type":404,"tag":495,"props":5067,"children":5068},{"style":508},[5069],{"type":410,"value":657},{"type":404,"tag":495,"props":5071,"children":5072},{"style":550},[5073],{"type":410,"value":584},{"type":404,"tag":495,"props":5075,"children":5076},{"class":497,"line":1061},[5077,5081,5085],{"type":404,"tag":495,"props":5078,"children":5079},{"style":550},[5080],{"type":410,"value":1252},{"type":404,"tag":495,"props":5082,"children":5083},{"style":502},[5084],{"type":410,"value":1257},{"type":404,"tag":495,"props":5086,"children":5087},{"style":550},[5088],{"type":410,"value":558},{"type":404,"tag":495,"props":5090,"children":5091},{"class":497,"line":1082},[5092,5097,5102,5106,5111],{"type":404,"tag":495,"props":5093,"children":5094},{"style":538},[5095],{"type":410,"value":5096},"    char",{"type":404,"tag":495,"props":5098,"children":5099},{"style":576},[5100],{"type":410,"value":5101}," tmp",{"type":404,"tag":495,"props":5103,"children":5104},{"style":550},[5105],{"type":410,"value":1471},{"type":404,"tag":495,"props":5107,"children":5108},{"style":836},[5109],{"type":410,"value":5110},"30",{"type":404,"tag":495,"props":5112,"children":5113},{"style":550},[5114],{"type":410,"value":1481},{"type":404,"tag":495,"props":5116,"children":5117},{"class":497,"line":1142},[5118,5123,5128,5133,5138],{"type":404,"tag":495,"props":5119,"children":5120},{"style":2002},[5121],{"type":410,"value":5122},"    const",{"type":404,"tag":495,"props":5124,"children":5125},{"style":538},[5126],{"type":410,"value":5127}," char",{"type":404,"tag":495,"props":5129,"children":5130},{"style":674},[5131],{"type":410,"value":5132},"*",{"type":404,"tag":495,"props":5134,"children":5135},{"style":755},[5136],{"type":410,"value":5137}," type",{"type":404,"tag":495,"props":5139,"children":5140},{"style":550},[5141],{"type":410,"value":584},{"type":404,"tag":495,"props":5143,"children":5144},{"class":497,"line":1206},[5145,5150,5154,5158,5162],{"type":404,"tag":495,"props":5146,"children":5147},{"style":502},[5148],{"type":410,"value":5149},"    switch",{"type":404,"tag":495,"props":5151,"children":5152},{"style":550},[5153],{"type":410,"value":711},{"type":404,"tag":495,"props":5155,"children":5156},{"style":544},[5157],{"type":410,"value":491},{"type":404,"tag":495,"props":5159,"children":5160},{"style":550},[5161],{"type":410,"value":735},{"type":404,"tag":495,"props":5163,"children":5164},{"style":550},[5165],{"type":410,"value":558},{"type":404,"tag":495,"props":5167,"children":5168},{"class":497,"line":1246},[5169,5174,5178],{"type":404,"tag":495,"props":5170,"children":5171},{"style":502},[5172],{"type":410,"value":5173},"      case",{"type":404,"tag":495,"props":5175,"children":5176},{"style":755},[5177],{"type":410,"value":4777},{"type":404,"tag":495,"props":5179,"children":5180},{"style":550},[5181],{"type":410,"value":5182},":\n",{"type":404,"tag":495,"props":5184,"children":5185},{"class":497,"line":1264},[5186,5191,5195,5199,5203,5207],{"type":404,"tag":495,"props":5187,"children":5188},{"style":755},[5189],{"type":410,"value":5190},"        type ",{"type":404,"tag":495,"props":5192,"children":5193},{"style":674},[5194],{"type":410,"value":677},{"type":404,"tag":495,"props":5196,"children":5197},{"style":508},[5198],{"type":410,"value":647},{"type":404,"tag":495,"props":5200,"children":5201},{"style":514},[5202],{"type":410,"value":4271},{"type":404,"tag":495,"props":5204,"children":5205},{"style":508},[5206],{"type":410,"value":657},{"type":404,"tag":495,"props":5208,"children":5209},{"style":550},[5210],{"type":410,"value":584},{"type":404,"tag":495,"props":5212,"children":5213},{"class":497,"line":1301},[5214,5219],{"type":404,"tag":495,"props":5215,"children":5216},{"style":502},[5217],{"type":410,"value":5218},"        break",{"type":404,"tag":495,"props":5220,"children":5221},{"style":550},[5222],{"type":410,"value":584},{"type":404,"tag":495,"props":5224,"children":5225},{"class":497,"line":1309},[5226],{"type":404,"tag":495,"props":5227,"children":5228},{"style":1504},[5229],{"type":410,"value":5230},"      // ...\n",{"type":404,"tag":495,"props":5232,"children":5233},{"class":497,"line":1317},[5234],{"type":404,"tag":495,"props":5235,"children":5236},{"style":550},[5237],{"type":410,"value":5238},"    }\n",{"type":404,"tag":495,"props":5240,"children":5241},{"class":497,"line":1335},[5242],{"type":404,"tag":495,"props":5243,"children":5244},{"style":1504},[5245],{"type":410,"value":4132},{"type":404,"tag":495,"props":5247,"children":5249},{"class":497,"line":5248},30,[5250,5254,5259],{"type":404,"tag":495,"props":5251,"children":5252},{"style":502},[5253],{"type":410,"value":2735},{"type":404,"tag":495,"props":5255,"children":5256},{"style":755},[5257],{"type":410,"value":5258}," result",{"type":404,"tag":495,"props":5260,"children":5261},{"style":550},[5262],{"type":410,"value":584},{"type":404,"tag":495,"props":5264,"children":5266},{"class":497,"line":5265},31,[5267],{"type":404,"tag":495,"props":5268,"children":5269},{"style":550},[5270],{"type":410,"value":852},{"type":404,"tag":495,"props":5272,"children":5274},{"class":497,"line":5273},32,[5275],{"type":404,"tag":495,"props":5276,"children":5277},{"style":550},[5278],{"type":410,"value":1341},{"type":404,"tag":418,"props":5280,"children":5281},{},[5282],{"type":410,"value":5283},"KDB 内部代码出现异常时会使用日志将其记录下来。如果没有日志，那么在排查代码问题时简直就是噩梦。KDB 有两套日志的输出目标，分别是系统输出和标准输出设备。日志类记录输出目标、日志级别、线程锁等成员，并通过静态方法 Logv 实现记录日志。锁的最大用处是保证记录顺序。仅有当出现最高级别的日志（kLogLevelEMERG）时，才会跳过锁直接写入。出现 kLogLevelEMERG 时意味着程序遇到了紧急问题，通常会直接退出或是返回 Status 异常，所以这个时候需要及时记录。",{"type":404,"tag":418,"props":5285,"children":5286},{},[5287],{"type":410,"value":5288},"日志级别的划分参考了 Syslog：",{"type":404,"tag":445,"props":5290,"children":5291},{},[5292,5297,5302,5307,5312,5317,5322,5327,5332,5337],{"type":404,"tag":449,"props":5293,"children":5294},{},[5295],{"type":410,"value":5296},"silent: all logging is turned off",{"type":404,"tag":449,"props":5298,"children":5299},{},[5300],{"type":410,"value":5301},"emerg: system is unusable, imminent crash",{"type":404,"tag":449,"props":5303,"children":5304},{},[5305],{"type":410,"value":5306},"alert: error event, immediate action required",{"type":404,"tag":449,"props":5308,"children":5309},{},[5310],{"type":410,"value":5311},"crit: error event, immediate action required",{"type":404,"tag":449,"props":5313,"children":5314},{},[5315],{"type":410,"value":5316},"error: error event, action is required but is not urgent",{"type":404,"tag":449,"props":5318,"children":5319},{},[5320],{"type":410,"value":5321},"warn: events that can be harmful if no action is taken",{"type":404,"tag":449,"props":5323,"children":5324},{},[5325],{"type":410,"value":5326},"notice: unusual events, but no immediate action required",{"type":404,"tag":449,"props":5328,"children":5329},{},[5330],{"type":410,"value":5331},"info: normal operation events, no action required",{"type":404,"tag":449,"props":5333,"children":5334},{},[5335],{"type":410,"value":5336},"debug: events used for debugging, no action required",{"type":404,"tag":449,"props":5338,"children":5339},{},[5340],{"type":410,"value":5341},"trace: fine-grained events used for debugging, no action required",{"type":404,"tag":1371,"props":5343,"children":5345},{"id":5344},"日志调用用宏还是函数",[5346],{"type":410,"value":5344},{"type":404,"tag":418,"props":5348,"children":5349},{},[5350,5352,5358,5360,5364],{"type":410,"value":5351},"原先的提交中，日志调用被定义在了宏里，直接调用 Logger::Logv 去记录。日志宏中使用子宏 ",{"type":404,"tag":5353,"props":5354,"children":5355},"strong",{},[5356],{"type":410,"value":5357},"VA_ARGS",{"type":410,"value":5359}," 来记录可变参数。",{"type":404,"tag":5353,"props":5361,"children":5362},{},[5363],{"type":410,"value":5357},{"type":410,"value":5365}," 前面有标记黏贴运算符的原因是当日志宏的可变参数为空时，可以把末尾的逗号去掉。",{"type":404,"tag":484,"props":5367,"children":5369},{"code":5368,"language":487,"meta":398,"className":488,"style":398},"class log {\n  static void emerg(const char* logname, const char* format, ...) {\n    va_list args;\n    va_start(args, format);\n    Logger::Logv(false, Logger::kLogLevelEMERG, LOG_EMERG, logname, format, args);\n    va_end(args);\n  }\n}\n// ...\n#define LOG_EMERG(logname, fmt, ...) \\\n        Logger::Logv(false, Logger::kLogLevelEMERG, logname, fmt, ##__VA_ARGS__)\n",[5370],{"type":404,"tag":491,"props":5371,"children":5372},{"__ignoreMap":398},[5373,5389,5464,5476,5505,5587,5607,5614,5621,5628,5670],{"type":404,"tag":495,"props":5374,"children":5375},{"class":497,"line":498},[5376,5380,5385],{"type":404,"tag":495,"props":5377,"children":5378},{"style":538},[5379],{"type":410,"value":1915},{"type":404,"tag":495,"props":5381,"children":5382},{"style":565},[5383],{"type":410,"value":5384}," log",{"type":404,"tag":495,"props":5386,"children":5387},{"style":550},[5388],{"type":410,"value":558},{"type":404,"tag":495,"props":5390,"children":5391},{"class":497,"line":525},[5392,5396,5400,5405,5409,5413,5417,5421,5426,5430,5434,5438,5442,5447,5451,5456,5460],{"type":404,"tag":495,"props":5393,"children":5394},{"style":2002},[5395],{"type":410,"value":2005},{"type":404,"tag":495,"props":5397,"children":5398},{"style":538},[5399],{"type":410,"value":2010},{"type":404,"tag":495,"props":5401,"children":5402},{"style":544},[5403],{"type":410,"value":5404}," emerg",{"type":404,"tag":495,"props":5406,"children":5407},{"style":550},[5408],{"type":410,"value":632},{"type":404,"tag":495,"props":5410,"children":5411},{"style":2002},[5412],{"type":410,"value":2514},{"type":404,"tag":495,"props":5414,"children":5415},{"style":538},[5416],{"type":410,"value":5127},{"type":404,"tag":495,"props":5418,"children":5419},{"style":2002},[5420],{"type":410,"value":5132},{"type":404,"tag":495,"props":5422,"children":5423},{"style":1411},[5424],{"type":410,"value":5425}," logname",{"type":404,"tag":495,"props":5427,"children":5428},{"style":550},[5429],{"type":410,"value":642},{"type":404,"tag":495,"props":5431,"children":5432},{"style":2002},[5433],{"type":410,"value":2536},{"type":404,"tag":495,"props":5435,"children":5436},{"style":538},[5437],{"type":410,"value":5127},{"type":404,"tag":495,"props":5439,"children":5440},{"style":2002},[5441],{"type":410,"value":5132},{"type":404,"tag":495,"props":5443,"children":5444},{"style":1411},[5445],{"type":410,"value":5446}," format",{"type":404,"tag":495,"props":5448,"children":5449},{"style":550},[5450],{"type":410,"value":642},{"type":404,"tag":495,"props":5452,"children":5453},{"style":755},[5454],{"type":410,"value":5455}," ...",{"type":404,"tag":495,"props":5457,"children":5458},{"style":550},[5459],{"type":410,"value":1199},{"type":404,"tag":495,"props":5461,"children":5462},{"style":550},[5463],{"type":410,"value":558},{"type":404,"tag":495,"props":5465,"children":5466},{"class":497,"line":534},[5467,5472],{"type":404,"tag":495,"props":5468,"children":5469},{"style":755},[5470],{"type":410,"value":5471},"    va_list args",{"type":404,"tag":495,"props":5473,"children":5474},{"style":550},[5475],{"type":410,"value":584},{"type":404,"tag":495,"props":5477,"children":5478},{"class":497,"line":561},[5479,5484,5488,5493,5497,5501],{"type":404,"tag":495,"props":5480,"children":5481},{"style":544},[5482],{"type":410,"value":5483},"    va_start",{"type":404,"tag":495,"props":5485,"children":5486},{"style":550},[5487],{"type":410,"value":632},{"type":404,"tag":495,"props":5489,"children":5490},{"style":755},[5491],{"type":410,"value":5492},"args",{"type":404,"tag":495,"props":5494,"children":5495},{"style":550},[5496],{"type":410,"value":642},{"type":404,"tag":495,"props":5498,"children":5499},{"style":755},[5500],{"type":410,"value":5446},{"type":404,"tag":495,"props":5502,"children":5503},{"style":550},[5504],{"type":410,"value":662},{"type":404,"tag":495,"props":5506,"children":5507},{"class":497,"line":587},[5508,5513,5517,5522,5526,5531,5535,5540,5544,5549,5553,5558,5562,5566,5570,5574,5578,5583],{"type":404,"tag":495,"props":5509,"children":5510},{"style":565},[5511],{"type":410,"value":5512},"    Logger",{"type":404,"tag":495,"props":5514,"children":5515},{"style":550},[5516],{"type":410,"value":573},{"type":404,"tag":495,"props":5518,"children":5519},{"style":544},[5520],{"type":410,"value":5521},"Logv",{"type":404,"tag":495,"props":5523,"children":5524},{"style":550},[5525],{"type":410,"value":632},{"type":404,"tag":495,"props":5527,"children":5528},{"style":2702},[5529],{"type":410,"value":5530},"false",{"type":404,"tag":495,"props":5532,"children":5533},{"style":550},[5534],{"type":410,"value":642},{"type":404,"tag":495,"props":5536,"children":5537},{"style":565},[5538],{"type":410,"value":5539}," Logger",{"type":404,"tag":495,"props":5541,"children":5542},{"style":550},[5543],{"type":410,"value":573},{"type":404,"tag":495,"props":5545,"children":5546},{"style":755},[5547],{"type":410,"value":5548},"kLogLevelEMERG",{"type":404,"tag":495,"props":5550,"children":5551},{"style":550},[5552],{"type":410,"value":642},{"type":404,"tag":495,"props":5554,"children":5555},{"style":755},[5556],{"type":410,"value":5557}," LOG_EMERG",{"type":404,"tag":495,"props":5559,"children":5560},{"style":550},[5561],{"type":410,"value":642},{"type":404,"tag":495,"props":5563,"children":5564},{"style":755},[5565],{"type":410,"value":5425},{"type":404,"tag":495,"props":5567,"children":5568},{"style":550},[5569],{"type":410,"value":642},{"type":404,"tag":495,"props":5571,"children":5572},{"style":755},[5573],{"type":410,"value":5446},{"type":404,"tag":495,"props":5575,"children":5576},{"style":550},[5577],{"type":410,"value":642},{"type":404,"tag":495,"props":5579,"children":5580},{"style":755},[5581],{"type":410,"value":5582}," args",{"type":404,"tag":495,"props":5584,"children":5585},{"style":550},[5586],{"type":410,"value":662},{"type":404,"tag":495,"props":5588,"children":5589},{"class":497,"line":608},[5590,5595,5599,5603],{"type":404,"tag":495,"props":5591,"children":5592},{"style":544},[5593],{"type":410,"value":5594},"    va_end",{"type":404,"tag":495,"props":5596,"children":5597},{"style":550},[5598],{"type":410,"value":632},{"type":404,"tag":495,"props":5600,"children":5601},{"style":755},[5602],{"type":410,"value":5492},{"type":404,"tag":495,"props":5604,"children":5605},{"style":550},[5606],{"type":410,"value":662},{"type":404,"tag":495,"props":5608,"children":5609},{"class":497,"line":665},[5610],{"type":404,"tag":495,"props":5611,"children":5612},{"style":550},[5613],{"type":410,"value":852},{"type":404,"tag":495,"props":5615,"children":5616},{"class":497,"line":700},[5617],{"type":404,"tag":495,"props":5618,"children":5619},{"style":550},[5620],{"type":410,"value":1341},{"type":404,"tag":495,"props":5622,"children":5623},{"class":497,"line":742},[5624],{"type":404,"tag":495,"props":5625,"children":5626},{"style":1504},[5627],{"type":410,"value":3316},{"type":404,"tag":495,"props":5629,"children":5630},{"class":497,"line":823},[5631,5635,5639,5643,5648,5652,5657,5661,5666],{"type":404,"tag":495,"props":5632,"children":5633},{"style":502},[5634],{"type":410,"value":1875},{"type":404,"tag":495,"props":5636,"children":5637},{"style":544},[5638],{"type":410,"value":5557},{"type":404,"tag":495,"props":5640,"children":5641},{"style":550},[5642],{"type":410,"value":632},{"type":404,"tag":495,"props":5644,"children":5645},{"style":1411},[5646],{"type":410,"value":5647},"logname",{"type":404,"tag":495,"props":5649,"children":5650},{"style":550},[5651],{"type":410,"value":642},{"type":404,"tag":495,"props":5653,"children":5654},{"style":1411},[5655],{"type":410,"value":5656}," fmt",{"type":404,"tag":495,"props":5658,"children":5659},{"style":550},[5660],{"type":410,"value":642},{"type":404,"tag":495,"props":5662,"children":5663},{"style":550},[5664],{"type":410,"value":5665}," ...)",{"type":404,"tag":495,"props":5667,"children":5668},{"style":780},[5669],{"type":410,"value":2261},{"type":404,"tag":495,"props":5671,"children":5672},{"class":497,"line":846},[5673,5678,5682,5686,5690,5694,5698,5702,5706,5710,5714,5718,5722,5726,5730,5735],{"type":404,"tag":495,"props":5674,"children":5675},{"style":565},[5676],{"type":410,"value":5677},"        Logger",{"type":404,"tag":495,"props":5679,"children":5680},{"style":550},[5681],{"type":410,"value":573},{"type":404,"tag":495,"props":5683,"children":5684},{"style":544},[5685],{"type":410,"value":5521},{"type":404,"tag":495,"props":5687,"children":5688},{"style":550},[5689],{"type":410,"value":632},{"type":404,"tag":495,"props":5691,"children":5692},{"style":2702},[5693],{"type":410,"value":5530},{"type":404,"tag":495,"props":5695,"children":5696},{"style":550},[5697],{"type":410,"value":642},{"type":404,"tag":495,"props":5699,"children":5700},{"style":565},[5701],{"type":410,"value":5539},{"type":404,"tag":495,"props":5703,"children":5704},{"style":550},[5705],{"type":410,"value":573},{"type":404,"tag":495,"props":5707,"children":5708},{"style":755},[5709],{"type":410,"value":5548},{"type":404,"tag":495,"props":5711,"children":5712},{"style":550},[5713],{"type":410,"value":642},{"type":404,"tag":495,"props":5715,"children":5716},{"style":755},[5717],{"type":410,"value":5425},{"type":404,"tag":495,"props":5719,"children":5720},{"style":550},[5721],{"type":410,"value":642},{"type":404,"tag":495,"props":5723,"children":5724},{"style":755},[5725],{"type":410,"value":5656},{"type":404,"tag":495,"props":5727,"children":5728},{"style":550},[5729],{"type":410,"value":642},{"type":404,"tag":495,"props":5731,"children":5732},{"style":576},[5733],{"type":410,"value":5734}," ##__VA_ARGS__",{"type":404,"tag":495,"props":5736,"children":5737},{"style":550},[5738],{"type":410,"value":2331},{"type":404,"tag":418,"props":5740,"children":5741},{},[5742],{"type":410,"value":5743},"尚不清楚为什么不用宏，而是使用运行时的方法调用（即 log 的 public 方法）。猜测可能是因为宏不能跨行？因为我看到了这种很长的调用。",{"type":404,"tag":484,"props":5745,"children":5747},{"code":5746,"language":487,"meta":398,"className":488,"style":398},"log::trace(\n  \"Database::PutPartValidSize()\",\n  \"[%s] size_chunk:%\" PRIu64 \" offset_chunk:%\" PRIu64,\n  key.ToString().c_str(),\n  chunk.size(),\n  offset_chunk\n);\n",[5748],{"type":404,"tag":491,"props":5749,"children":5750},{"__ignoreMap":398},[5751,5773,5794,5845,5874,5894,5902],{"type":404,"tag":495,"props":5752,"children":5753},{"class":497,"line":498},[5754,5759,5763,5768],{"type":404,"tag":495,"props":5755,"children":5756},{"style":565},[5757],{"type":410,"value":5758},"log",{"type":404,"tag":495,"props":5760,"children":5761},{"style":550},[5762],{"type":410,"value":573},{"type":404,"tag":495,"props":5764,"children":5765},{"style":544},[5766],{"type":410,"value":5767},"trace",{"type":404,"tag":495,"props":5769,"children":5770},{"style":550},[5771],{"type":410,"value":5772},"(\n",{"type":404,"tag":495,"props":5774,"children":5775},{"class":497,"line":525},[5776,5781,5786,5790],{"type":404,"tag":495,"props":5777,"children":5778},{"style":508},[5779],{"type":410,"value":5780},"  \"",{"type":404,"tag":495,"props":5782,"children":5783},{"style":514},[5784],{"type":410,"value":5785},"Database::PutPartValidSize()",{"type":404,"tag":495,"props":5787,"children":5788},{"style":508},[5789],{"type":410,"value":657},{"type":404,"tag":495,"props":5791,"children":5792},{"style":550},[5793],{"type":410,"value":4855},{"type":404,"tag":495,"props":5795,"children":5796},{"class":497,"line":534},[5797,5801,5805,5809,5814,5818,5823,5827,5832,5836,5841],{"type":404,"tag":495,"props":5798,"children":5799},{"style":508},[5800],{"type":410,"value":5780},{"type":404,"tag":495,"props":5802,"children":5803},{"style":514},[5804],{"type":410,"value":1471},{"type":404,"tag":495,"props":5806,"children":5807},{"style":774},[5808],{"type":410,"value":777},{"type":404,"tag":495,"props":5810,"children":5811},{"style":514},[5812],{"type":410,"value":5813},"] size_chunk:%",{"type":404,"tag":495,"props":5815,"children":5816},{"style":508},[5817],{"type":410,"value":657},{"type":404,"tag":495,"props":5819,"children":5820},{"style":576},[5821],{"type":410,"value":5822}," PRIu64 ",{"type":404,"tag":495,"props":5824,"children":5825},{"style":508},[5826],{"type":410,"value":657},{"type":404,"tag":495,"props":5828,"children":5829},{"style":514},[5830],{"type":410,"value":5831}," offset_chunk:%",{"type":404,"tag":495,"props":5833,"children":5834},{"style":508},[5835],{"type":410,"value":657},{"type":404,"tag":495,"props":5837,"children":5838},{"style":576},[5839],{"type":410,"value":5840}," PRIu64",{"type":404,"tag":495,"props":5842,"children":5843},{"style":550},[5844],{"type":410,"value":4855},{"type":404,"tag":495,"props":5846,"children":5847},{"class":497,"line":561},[5848,5853,5857,5861,5865,5869],{"type":404,"tag":495,"props":5849,"children":5850},{"style":576},[5851],{"type":410,"value":5852},"  key",{"type":404,"tag":495,"props":5854,"children":5855},{"style":550},[5856],{"type":410,"value":687},{"type":404,"tag":495,"props":5858,"children":5859},{"style":544},[5860],{"type":410,"value":805},{"type":404,"tag":495,"props":5862,"children":5863},{"style":550},[5864],{"type":410,"value":810},{"type":404,"tag":495,"props":5866,"children":5867},{"style":544},[5868],{"type":410,"value":815},{"type":404,"tag":495,"props":5870,"children":5871},{"style":550},[5872],{"type":410,"value":5873},"(),\n",{"type":404,"tag":495,"props":5875,"children":5876},{"class":497,"line":587},[5877,5882,5886,5890],{"type":404,"tag":495,"props":5878,"children":5879},{"style":576},[5880],{"type":410,"value":5881},"  chunk",{"type":404,"tag":495,"props":5883,"children":5884},{"style":550},[5885],{"type":410,"value":687},{"type":404,"tag":495,"props":5887,"children":5888},{"style":544},[5889],{"type":410,"value":3639},{"type":404,"tag":495,"props":5891,"children":5892},{"style":550},[5893],{"type":410,"value":5873},{"type":404,"tag":495,"props":5895,"children":5896},{"class":497,"line":608},[5897],{"type":404,"tag":495,"props":5898,"children":5899},{"style":576},[5900],{"type":410,"value":5901},"  offset_chunk\n",{"type":404,"tag":495,"props":5903,"children":5904},{"class":497,"line":665},[5905],{"type":404,"tag":495,"props":5906,"children":5907},{"style":550},[5908],{"type":410,"value":662},{"type":404,"tag":1371,"props":5910,"children":5912},{"id":5911},"日志时间",[5913],{"type":410,"value":5911},{"type":404,"tag":418,"props":5915,"children":5916},{},[5917],{"type":410,"value":5918},"使用系统输出（syslog）时不需要手动记录时间，但是把日志打印出来时却是要的。尤其是在调试时，精确时间非常有用。KDB 使用 Linux 的 timeval、tm 两个结构体，分别拿到精确时间及可读时间，再格式化输出。",{"type":404,"tag":484,"props":5920,"children":5922},{"code":5921,"language":487,"meta":398,"className":488,"style":398},"struct timeval now_tv;\ngettimeofday(&now_tv, NULL);\nconst time_t seconds = now_tv.tv_sec;\nstruct tm t;\n// 初始化 tm 时需要用到当前秒数，\n// 所以需要提前初始化 now_tv\nlocaltime_r(&seconds, &t);\np += snprintf(p, limit - p,\n              \"%04d/%02d/%02d-%02d:%02d:%02d.%06d %s %s \",\n              t.tm_year + 1900,\n              t.tm_mon + 1,\n              t.tm_mday,\n              t.tm_hour,\n              t.tm_min,\n              t.tm_sec,\n              static_cast\u003Cint>(now_tv.tv_usec), // 毫秒\n              ss.str().c_str(),\n              logname);\n",[5923],{"type":404,"tag":491,"props":5924,"children":5925},{"__ignoreMap":398},[5926,5948,5982,6020,6040,6048,6056,6094,6143,6224,6255,6283,6303,6323,6343,6363,6406,6434],{"type":404,"tag":495,"props":5927,"children":5928},{"class":497,"line":498},[5929,5934,5939,5944],{"type":404,"tag":495,"props":5930,"children":5931},{"style":538},[5932],{"type":410,"value":5933},"struct",{"type":404,"tag":495,"props":5935,"children":5936},{"style":565},[5937],{"type":410,"value":5938}," timeval",{"type":404,"tag":495,"props":5940,"children":5941},{"style":576},[5942],{"type":410,"value":5943}," now_tv",{"type":404,"tag":495,"props":5945,"children":5946},{"style":550},[5947],{"type":410,"value":584},{"type":404,"tag":495,"props":5949,"children":5950},{"class":497,"line":525},[5951,5956,5960,5964,5969,5973,5978],{"type":404,"tag":495,"props":5952,"children":5953},{"style":544},[5954],{"type":410,"value":5955},"gettimeofday",{"type":404,"tag":495,"props":5957,"children":5958},{"style":550},[5959],{"type":410,"value":632},{"type":404,"tag":495,"props":5961,"children":5962},{"style":674},[5963],{"type":410,"value":2500},{"type":404,"tag":495,"props":5965,"children":5966},{"style":576},[5967],{"type":410,"value":5968},"now_tv",{"type":404,"tag":495,"props":5970,"children":5971},{"style":550},[5972],{"type":410,"value":642},{"type":404,"tag":495,"props":5974,"children":5975},{"style":2702},[5976],{"type":410,"value":5977}," NULL",{"type":404,"tag":495,"props":5979,"children":5980},{"style":550},[5981],{"type":410,"value":662},{"type":404,"tag":495,"props":5983,"children":5984},{"class":497,"line":534},[5985,5989,5994,5999,6003,6007,6011,6016],{"type":404,"tag":495,"props":5986,"children":5987},{"style":2002},[5988],{"type":410,"value":2514},{"type":404,"tag":495,"props":5990,"children":5991},{"style":538},[5992],{"type":410,"value":5993}," time_t",{"type":404,"tag":495,"props":5995,"children":5996},{"style":576},[5997],{"type":410,"value":5998}," seconds ",{"type":404,"tag":495,"props":6000,"children":6001},{"style":674},[6002],{"type":410,"value":677},{"type":404,"tag":495,"props":6004,"children":6005},{"style":576},[6006],{"type":410,"value":5943},{"type":404,"tag":495,"props":6008,"children":6009},{"style":550},[6010],{"type":410,"value":687},{"type":404,"tag":495,"props":6012,"children":6013},{"style":576},[6014],{"type":410,"value":6015},"tv_sec",{"type":404,"tag":495,"props":6017,"children":6018},{"style":550},[6019],{"type":410,"value":584},{"type":404,"tag":495,"props":6021,"children":6022},{"class":497,"line":561},[6023,6027,6032,6036],{"type":404,"tag":495,"props":6024,"children":6025},{"style":538},[6026],{"type":410,"value":5933},{"type":404,"tag":495,"props":6028,"children":6029},{"style":565},[6030],{"type":410,"value":6031}," tm",{"type":404,"tag":495,"props":6033,"children":6034},{"style":576},[6035],{"type":410,"value":2062},{"type":404,"tag":495,"props":6037,"children":6038},{"style":550},[6039],{"type":410,"value":584},{"type":404,"tag":495,"props":6041,"children":6042},{"class":497,"line":587},[6043],{"type":404,"tag":495,"props":6044,"children":6045},{"style":1504},[6046],{"type":410,"value":6047},"// 初始化 tm 时需要用到当前秒数，\n",{"type":404,"tag":495,"props":6049,"children":6050},{"class":497,"line":608},[6051],{"type":404,"tag":495,"props":6052,"children":6053},{"style":1504},[6054],{"type":410,"value":6055},"// 所以需要提前初始化 now_tv\n",{"type":404,"tag":495,"props":6057,"children":6058},{"class":497,"line":665},[6059,6064,6068,6072,6077,6081,6085,6090],{"type":404,"tag":495,"props":6060,"children":6061},{"style":544},[6062],{"type":410,"value":6063},"localtime_r",{"type":404,"tag":495,"props":6065,"children":6066},{"style":550},[6067],{"type":410,"value":632},{"type":404,"tag":495,"props":6069,"children":6070},{"style":674},[6071],{"type":410,"value":2500},{"type":404,"tag":495,"props":6073,"children":6074},{"style":576},[6075],{"type":410,"value":6076},"seconds",{"type":404,"tag":495,"props":6078,"children":6079},{"style":550},[6080],{"type":410,"value":642},{"type":404,"tag":495,"props":6082,"children":6083},{"style":674},[6084],{"type":410,"value":1130},{"type":404,"tag":495,"props":6086,"children":6087},{"style":576},[6088],{"type":410,"value":6089},"t",{"type":404,"tag":495,"props":6091,"children":6092},{"style":550},[6093],{"type":410,"value":662},{"type":404,"tag":495,"props":6095,"children":6096},{"class":497,"line":700},[6097,6102,6107,6112,6116,6120,6124,6129,6134,6139],{"type":404,"tag":495,"props":6098,"children":6099},{"style":576},[6100],{"type":410,"value":6101},"p ",{"type":404,"tag":495,"props":6103,"children":6104},{"style":674},[6105],{"type":410,"value":6106},"+=",{"type":404,"tag":495,"props":6108,"children":6109},{"style":544},[6110],{"type":410,"value":6111}," snprintf",{"type":404,"tag":495,"props":6113,"children":6114},{"style":550},[6115],{"type":410,"value":632},{"type":404,"tag":495,"props":6117,"children":6118},{"style":576},[6119],{"type":410,"value":418},{"type":404,"tag":495,"props":6121,"children":6122},{"style":550},[6123],{"type":410,"value":642},{"type":404,"tag":495,"props":6125,"children":6126},{"style":576},[6127],{"type":410,"value":6128}," limit ",{"type":404,"tag":495,"props":6130,"children":6131},{"style":674},[6132],{"type":410,"value":6133},"-",{"type":404,"tag":495,"props":6135,"children":6136},{"style":576},[6137],{"type":410,"value":6138}," p",{"type":404,"tag":495,"props":6140,"children":6141},{"style":550},[6142],{"type":410,"value":4855},{"type":404,"tag":495,"props":6144,"children":6145},{"class":497,"line":742},[6146,6151,6156,6161,6166,6170,6174,6178,6182,6186,6190,6194,6198,6202,6207,6212,6216,6220],{"type":404,"tag":495,"props":6147,"children":6148},{"style":508},[6149],{"type":410,"value":6150},"              \"",{"type":404,"tag":495,"props":6152,"children":6153},{"style":774},[6154],{"type":410,"value":6155},"%04d",{"type":404,"tag":495,"props":6157,"children":6158},{"style":514},[6159],{"type":410,"value":6160},"/",{"type":404,"tag":495,"props":6162,"children":6163},{"style":774},[6164],{"type":410,"value":6165},"%02d",{"type":404,"tag":495,"props":6167,"children":6168},{"style":514},[6169],{"type":410,"value":6160},{"type":404,"tag":495,"props":6171,"children":6172},{"style":774},[6173],{"type":410,"value":6165},{"type":404,"tag":495,"props":6175,"children":6176},{"style":514},[6177],{"type":410,"value":6133},{"type":404,"tag":495,"props":6179,"children":6180},{"style":774},[6181],{"type":410,"value":6165},{"type":404,"tag":495,"props":6183,"children":6184},{"style":514},[6185],{"type":410,"value":1600},{"type":404,"tag":495,"props":6187,"children":6188},{"style":774},[6189],{"type":410,"value":6165},{"type":404,"tag":495,"props":6191,"children":6192},{"style":514},[6193],{"type":410,"value":1600},{"type":404,"tag":495,"props":6195,"children":6196},{"style":774},[6197],{"type":410,"value":6165},{"type":404,"tag":495,"props":6199,"children":6200},{"style":514},[6201],{"type":410,"value":687},{"type":404,"tag":495,"props":6203,"children":6204},{"style":774},[6205],{"type":410,"value":6206},"%06d",{"type":404,"tag":495,"props":6208,"children":6209},{"style":774},[6210],{"type":410,"value":6211}," %s",{"type":404,"tag":495,"props":6213,"children":6214},{"style":774},[6215],{"type":410,"value":6211},{"type":404,"tag":495,"props":6217,"children":6218},{"style":508},[6219],{"type":410,"value":647},{"type":404,"tag":495,"props":6221,"children":6222},{"style":550},[6223],{"type":410,"value":4855},{"type":404,"tag":495,"props":6225,"children":6226},{"class":497,"line":823},[6227,6232,6236,6241,6246,6251],{"type":404,"tag":495,"props":6228,"children":6229},{"style":576},[6230],{"type":410,"value":6231},"              t",{"type":404,"tag":495,"props":6233,"children":6234},{"style":550},[6235],{"type":410,"value":687},{"type":404,"tag":495,"props":6237,"children":6238},{"style":576},[6239],{"type":410,"value":6240},"tm_year ",{"type":404,"tag":495,"props":6242,"children":6243},{"style":674},[6244],{"type":410,"value":6245},"+",{"type":404,"tag":495,"props":6247,"children":6248},{"style":836},[6249],{"type":410,"value":6250}," 1900",{"type":404,"tag":495,"props":6252,"children":6253},{"style":550},[6254],{"type":410,"value":4855},{"type":404,"tag":495,"props":6256,"children":6257},{"class":497,"line":846},[6258,6262,6266,6271,6275,6279],{"type":404,"tag":495,"props":6259,"children":6260},{"style":576},[6261],{"type":410,"value":6231},{"type":404,"tag":495,"props":6263,"children":6264},{"style":550},[6265],{"type":410,"value":687},{"type":404,"tag":495,"props":6267,"children":6268},{"style":576},[6269],{"type":410,"value":6270},"tm_mon ",{"type":404,"tag":495,"props":6272,"children":6273},{"style":674},[6274],{"type":410,"value":6245},{"type":404,"tag":495,"props":6276,"children":6277},{"style":836},[6278],{"type":410,"value":3053},{"type":404,"tag":495,"props":6280,"children":6281},{"style":550},[6282],{"type":410,"value":4855},{"type":404,"tag":495,"props":6284,"children":6285},{"class":497,"line":855},[6286,6290,6294,6299],{"type":404,"tag":495,"props":6287,"children":6288},{"style":576},[6289],{"type":410,"value":6231},{"type":404,"tag":495,"props":6291,"children":6292},{"style":550},[6293],{"type":410,"value":687},{"type":404,"tag":495,"props":6295,"children":6296},{"style":576},[6297],{"type":410,"value":6298},"tm_mday",{"type":404,"tag":495,"props":6300,"children":6301},{"style":550},[6302],{"type":410,"value":4855},{"type":404,"tag":495,"props":6304,"children":6305},{"class":497,"line":863},[6306,6310,6314,6319],{"type":404,"tag":495,"props":6307,"children":6308},{"style":576},[6309],{"type":410,"value":6231},{"type":404,"tag":495,"props":6311,"children":6312},{"style":550},[6313],{"type":410,"value":687},{"type":404,"tag":495,"props":6315,"children":6316},{"style":576},[6317],{"type":410,"value":6318},"tm_hour",{"type":404,"tag":495,"props":6320,"children":6321},{"style":550},[6322],{"type":410,"value":4855},{"type":404,"tag":495,"props":6324,"children":6325},{"class":497,"line":906},[6326,6330,6334,6339],{"type":404,"tag":495,"props":6327,"children":6328},{"style":576},[6329],{"type":410,"value":6231},{"type":404,"tag":495,"props":6331,"children":6332},{"style":550},[6333],{"type":410,"value":687},{"type":404,"tag":495,"props":6335,"children":6336},{"style":576},[6337],{"type":410,"value":6338},"tm_min",{"type":404,"tag":495,"props":6340,"children":6341},{"style":550},[6342],{"type":410,"value":4855},{"type":404,"tag":495,"props":6344,"children":6345},{"class":497,"line":947},[6346,6350,6354,6359],{"type":404,"tag":495,"props":6347,"children":6348},{"style":576},[6349],{"type":410,"value":6231},{"type":404,"tag":495,"props":6351,"children":6352},{"style":550},[6353],{"type":410,"value":687},{"type":404,"tag":495,"props":6355,"children":6356},{"style":576},[6357],{"type":410,"value":6358},"tm_sec",{"type":404,"tag":495,"props":6360,"children":6361},{"style":550},[6362],{"type":410,"value":4855},{"type":404,"tag":495,"props":6364,"children":6365},{"class":497,"line":955},[6366,6371,6375,6379,6383,6387,6391,6396,6401],{"type":404,"tag":495,"props":6367,"children":6368},{"style":674},[6369],{"type":410,"value":6370},"              static_cast\u003C",{"type":404,"tag":495,"props":6372,"children":6373},{"style":538},[6374],{"type":410,"value":541},{"type":404,"tag":495,"props":6376,"children":6377},{"style":674},[6378],{"type":410,"value":2482},{"type":404,"tag":495,"props":6380,"children":6381},{"style":550},[6382],{"type":410,"value":632},{"type":404,"tag":495,"props":6384,"children":6385},{"style":576},[6386],{"type":410,"value":5968},{"type":404,"tag":495,"props":6388,"children":6389},{"style":550},[6390],{"type":410,"value":687},{"type":404,"tag":495,"props":6392,"children":6393},{"style":576},[6394],{"type":410,"value":6395},"tv_usec",{"type":404,"tag":495,"props":6397,"children":6398},{"style":550},[6399],{"type":410,"value":6400},"),",{"type":404,"tag":495,"props":6402,"children":6403},{"style":1504},[6404],{"type":410,"value":6405}," // 毫秒\n",{"type":404,"tag":495,"props":6407,"children":6408},{"class":497,"line":976},[6409,6414,6418,6422,6426,6430],{"type":404,"tag":495,"props":6410,"children":6411},{"style":576},[6412],{"type":410,"value":6413},"              ss",{"type":404,"tag":495,"props":6415,"children":6416},{"style":550},[6417],{"type":410,"value":687},{"type":404,"tag":495,"props":6419,"children":6420},{"style":544},[6421],{"type":410,"value":3074},{"type":404,"tag":495,"props":6423,"children":6424},{"style":550},[6425],{"type":410,"value":810},{"type":404,"tag":495,"props":6427,"children":6428},{"style":544},[6429],{"type":410,"value":815},{"type":404,"tag":495,"props":6431,"children":6432},{"style":550},[6433],{"type":410,"value":5873},{"type":404,"tag":495,"props":6435,"children":6436},{"class":497,"line":1032},[6437,6442],{"type":404,"tag":495,"props":6438,"children":6439},{"style":576},[6440],{"type":410,"value":6441},"              logname",{"type":404,"tag":495,"props":6443,"children":6444},{"style":550},[6445],{"type":410,"value":662},{"type":404,"tag":6447,"props":6448,"children":6449},"style",{},[6450],{"type":410,"value":6451},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":398,"searchDepth":525,"depth":525,"links":6453},[6454,6455,6456,6457],{"id":414,"depth":525,"text":414},{"id":475,"depth":525,"text":475},{"id":3457,"depth":525,"text":3457},{"id":3470,"depth":525,"text":3470},"markdown","content:8.source-code:_cpp:kingdb.md","content","8.source-code/_cpp/kingdb.md","8.source-code/_cpp/kingdb","md",[6465,6466],{"_path":386,"title":385,"description":398},{"_path":6467,"title":6468,"description":398},"/source-code/_es/array-slice","Array.prototype.slice",1741604959119]