[{"data":1,"prerenderedAt":6492},["ShallowReactive",2],{"navigation":3,"/source-code/_cpp/kingdb":416,"/source-code/_cpp/kingdb-surround":6487},[4,32,86,108,135,141,147,153,399,405,411],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🌃 长夜梦","/flows/long-night-dream",{"title":15,"_path":16},"🌌 万物联结与幸福感","/flows/everything",{"title":18,"_path":19},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":21,"_path":22},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":24,"_path":25},"🌧️ 我的腼腆","/flows/shy",{"title":27,"_path":28},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":30,"_path":31},"📝 心流归档","/flows/fold",{"title":33,"_path":34,"children":35},"技术博客 / Coder","/articles",[36,38,41,44,47,50,53,56,59,62,65,68,71,74,77,80,83],{"title":37,"_path":34},"🦁 为什么我要写博客",{"title":39,"_path":40},"🥞 在 tailwind 中使用现代化 CSS Layers","/articles/tailwind-sass-and-css-layer",{"title":42,"_path":43},"💻 本地部署 Qwen 翻译网页","/articles/local-translator",{"title":45,"_path":46},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":48,"_path":49},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":51,"_path":52},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":54,"_path":55},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":57,"_path":58},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":60,"_path":61},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":63,"_path":64},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":66,"_path":67},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":69,"_path":70},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":72,"_path":73},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":75,"_path":76},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":78,"_path":79},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":81,"_path":82},"🚝 四十二篇系列","/articles/fourty-two",{"title":84,"_path":85},"📝 技术博客归档","/articles/fold",{"title":87,"_path":88,"children":89},"造物 / Make","/tools",[90,93,96,99,102,105],{"title":91,"_path":92},"🥥 Coconut","/tools/coconut",{"title":94,"_path":95},"🧶 网易云音乐歌单排序","/tools/netease-sorter",{"title":97,"_path":98},"🌐 AnySort","/tools/anysort",{"title":100,"_path":101},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":103,"_path":104},"👓 Crapto","/tools/crypto-inline",{"title":106,"_path":107},"🖨️ any-to-base64","/tools/any-to-base64",{"title":109,"_path":110,"children":111},"吉他剧场 / Music","/music",[112,114,117,120,123,126,129,132],{"title":113,"_path":110},"🎸 FingerStyle！",{"title":115,"_path":116},"🌬️ 等待的风","/music/wind",{"title":118,"_path":119},"💕 约定的海洋","/music/ocean",{"title":121,"_path":122},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":124,"_path":125},"🌏 残酷天使的行动纲领","/music/eva",{"title":127,"_path":128},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":130,"_path":131},"🍷 Wu Wei","/music/wu-wei",{"title":133,"_path":134},"🌅 无题","/music/untitled",{"title":136,"_path":137,"children":138},"画点什么 / Paint","/paint",[139],{"title":140,"_path":137},"🚧 正在施工",{"title":142,"_path":143,"children":144},"读书笔记 / Notes","/books",[145],{"title":146,"_path":143},"📕 读书笔记",{"title":148,"_path":149,"children":150},"知识地图 / Maps","/maps",[151],{"title":152,"_path":149},"🏁 知识地图",{"title":154,"_path":155,"children":156},"零散的笔记 / Gists","/gists",[157,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255,258,261,264,267,270,273,276,279,282,285,288,291,294,297,300,303,306,309,312,315,318,321,324,327,330,333,336,339,342,345,348,351,354,357,360,363,366,369,372,375,378,381,384,387,390,393,396],{"title":158,"_path":155},"🧊 Gists",{"title":160,"_path":161},"网站的可访问性","/gists/accessibility",{"title":163,"_path":164},"Bit","/gists/bit",{"title":166,"_path":167},"图片模糊","/gists/blur",{"title":169,"_path":170},"渲染相关笔记","/gists/c4d",{"title":172,"_path":173},"CDN 问题记录","/gists/cdn",{"title":175,"_path":176},"消毒剂","/gists/cleaner",{"title":178,"_path":179},"Windows Command","/gists/cmd",{"title":181,"_path":182},"Command","/gists/command",{"title":184,"_path":185},"复杂科学","/gists/complexity-science",{"title":187,"_path":188},"GitHub Copilot","/gists/copilot",{"title":190,"_path":191},"宇宙","/gists/cosmos",{"title":193,"_path":194},"C++","/gists/cpp",{"title":196,"_path":197},"Data Structure","/gists/data-structure",{"title":199,"_path":200},"DEPRESSION","/gists/depression",{"title":202,"_path":203},"设计模式","/gists/design-patterns",{"title":205,"_path":206},"Developer Experience","/gists/developer-experience",{"title":208,"_path":209},"Device Metrics","/gists/device-metrix",{"title":211,"_path":212},"数字化转型","/gists/digital-transformation",{"title":214,"_path":215},"ECMAScript Language Specification","/gists/ecmascript-specification",{"title":217,"_path":218},"正则表达式","/gists/eegex",{"title":220,"_path":221},"Emoji","/gists/emoji",{"title":223,"_path":224},"工程","/gists/engineering",{"title":226,"_path":227},"熵","/gists/entropy",{"title":229,"_path":230},"Environment","/gists/environment",{"title":232,"_path":233},"Erlang","/gists/erlang",{"title":235,"_path":236},"逃离塔克夫","/gists/escape-from-tarkov",{"title":238,"_path":239},"ESNext (ES6-ES11)","/gists/esnext",{"title":241,"_path":242},"Eval！","/gists/eval",{"title":244,"_path":245},"Flutter","/gists/flutter",{"title":247,"_path":248},"字体","/gists/font",{"title":250,"_path":251},"JS 函数式编程","/gists/functional",{"title":253,"_path":254},"游戏化","/gists/gamification",{"title":256,"_path":257},"Google C++ Standard","/gists/google-cpp-standard",{"title":259,"_path":260},"双向链接完全体","/gists/graph",{"title":262,"_path":263},"Hardwares","/gists/hardwares",{"title":265,"_path":266},"哈希冲突","/gists/hash-collision",{"title":268,"_path":269},"信息设计","/gists/information-design",{"title":271,"_path":272},"InstantPage","/gists/instant.page",{"title":274,"_path":275},"ISUX 遇见大数据可视化系列","/gists/isux-data-visualization",{"title":277,"_path":278},"KVStore","/gists/key-value-db",{"title":280,"_path":281},"Kubernetes","/gists/kubernetes",{"title":283,"_path":284},"Makefile","/gists/makefile",{"title":286,"_path":287},"Markdown Inline Style","/gists/markdown-nice",{"title":289,"_path":290},"小程序","/gists/miniapp",{"title":292,"_path":293},"减小页面快照体积","/gists/minify-html",{"title":295,"_path":296},"mklink","/gists/mklink",{"title":298,"_path":299},"Mock","/gists/mock",{"title":301,"_path":302},"多人协作系统","/gists/multiplayer",{"title":304,"_path":305},"多端应用","/gists/multy-end-app",{"title":307,"_path":308},"神经科学","/gists/neuroscience",{"title":310,"_path":311},"OO","/gists/oo",{"title":313,"_path":314},"Opinioned Personal Folder","/gists/opinioned-personal-folder",{"title":316,"_path":317},"PInvoke","/gists/pinvoke",{"title":319,"_path":320},"像素","/gists/pixel",{"title":322,"_path":323},"PowerShell","/gists/powershell",{"title":325,"_path":326},"量子","/gists/quantum",{"title":328,"_path":329},"保持好奇心","/gists/questions",{"title":331,"_path":332},"React Native","/gists/react-native",{"title":334,"_path":335},"博客改版碰到的浏览器平滑滚动问题","/gists/scroll",{"title":337,"_path":338},"SEO","/gists/seo",{"title":340,"_path":341},"Shader","/gists/shader",{"title":343,"_path":344},"Shape Up","/gists/shape-up",{"title":346,"_path":347},"睡觉","/gists/sleep",{"title":349,"_path":350},"记录奇怪的问题","/gists/solved",{"title":352,"_path":353},"States","/gists/states",{"title":355,"_path":356},"Storage","/gists/storage",{"title":358,"_path":359},"音视频流处理","/gists/stream-cli",{"title":361,"_path":362},"Symbol","/gists/symbol",{"title":364,"_path":365},"系统论","/gists/systems-theory",{"title":367,"_path":368},"Taro","/gists/taro",{"title":370,"_path":371},"任务切片","/gists/task-slice",{"title":373,"_path":374},"技术偏好","/gists/tech-dudge",{"title":376,"_path":377},"Untitled","/gists/untitled",{"title":379,"_path":380},"可变字体","/gists/variable-font",{"title":382,"_path":383},"视觉错觉","/gists/visual-illusion",{"title":385,"_path":386},"SS(SSR)","/gists/vpn",{"title":388,"_path":389},"VS Code 插件开发","/gists/vscode-plugin",{"title":391,"_path":392},"Web Components","/gists/web-components",{"title":394,"_path":395},"Windows","/gists/windows",{"title":397,"_path":398},"查缺补漏","/gists/wrong",{"title":400,"_path":401,"children":402},"代码笔记 / Gists","/source-code",[403],{"title":404,"_path":401},"🚄 代码笔记",{"title":406,"_path":407,"children":408},"我 / About","/hire",[409],{"title":410,"_path":407},"📬 技术简历",{"title":412,"_path":413,"children":414},"todo","/todo",[415],{"title":412,"_path":413},{"_path":417,"_dir":418,"_draft":419,"_partial":420,"_locale":421,"title":422,"description":421,"body":423,"_type":6481,"_id":6482,"_source":6483,"_file":6484,"_stem":6485,"_extension":6486},"/source-code/_cpp/kingdb","_cpp",false,true,"","KingDB",{"type":424,"children":425,"toc":6475},"root",[426,434,440,446,462,467,491,496,501,506,1365,1370,1378,1383,1388,1393,1399,1404,1825,1830,1835,2285,2290,2391,2396,2401,2406,2944,2950,2955,3222,3228,3233,3478,3483,3496,3501,3768,3773,3778,4489,4494,4675,4679,4684,5302,5307,5312,5365,5370,5389,5762,5767,5932,5937,5942,6469],{"type":427,"tag":428,"props":429,"children":431},"element","h1",{"id":430},"kingdb",[432],{"type":433,"value":422},"text",{"type":427,"tag":435,"props":436,"children":438},"h2",{"id":437},"概述",[439],{"type":433,"value":437},{"type":427,"tag":441,"props":442,"children":443},"p",{},[444],{"type":433,"value":445},"源码分两部分，从相关的测试文件，到核心源码。参考 IKVS 系列文章给的架构图，核心源码的阅读顺序沿着 Put、Delete、Get 三个接口，由 Database 一路向 Buffer、Event Manager、Storage Engine、HSTable Manager、File System 相关、Index 前进。最好再看相关快照、迭代器、Multipart 等部分。期间如果遇到简单的帮助函数会先讲帮助函数。",{"type":427,"tag":441,"props":447,"children":448},{},[449,451,460],{"type":433,"value":450},"本来想从第一个 Git Commit 开始看起的。但我 checkout 过去之后，碰到了一堆编译问题，根本跑不通，索性就直接回到 master 来看最新代码了。本文章的源码快照见 ",{"type":427,"tag":452,"props":453,"children":457},"a",{"href":454,"rel":455},"https://github.com/goossaert/kingdb/tree/58994280e789fc7248d61371f03a6c04c844c197",[456],"nofollow",[458],{"type":433,"value":459},"KingDB@58994",{"type":433,"value":461},"。阅读源码前可以先看一下 KingDB 的 Readme：doc/kingdb.md 以及 doc/kingserver.md。",{"type":427,"tag":441,"props":463,"children":464},{},[465],{"type":433,"value":466},"下文可能出现的缩写：",{"type":427,"tag":468,"props":469,"children":470},"ul",{},[471,477],{"type":427,"tag":472,"props":473,"children":474},"li",{},[475],{"type":433,"value":476},"KDB：KingDB，泛指，有时指 KingDB 程序，有时指 KingDB 源码。",{"type":427,"tag":472,"props":478,"children":479},{},[480,482,489],{"type":433,"value":481},"IKVS：作者相关 KingDB 做的一些调研及笔记的博客系列。这个系列从 13 年开始写，现在还没写完... 见 ",{"type":427,"tag":452,"props":483,"children":486},{"href":484,"rel":485},"https://codecapsule.com/2012/11/07/ikvs-implementing-a-key-value-store-table-of-contents/",[456],[487],{"type":433,"value":488},"IKVS",{"type":433,"value":490},"。",{"type":427,"tag":441,"props":492,"children":493},{},[494],{"type":433,"value":495},"另，为了简便起见，下文给出的代码很可能并非原本的代码，而是截取或经过剔除后的部分代码。比如说，去除了某函数中的错误处理，使之代码更短，更容易展示。",{"type":427,"tag":435,"props":497,"children":499},{"id":498},"从测试开始",[500],{"type":433,"value":498},{"type":427,"tag":441,"props":502,"children":503},{},[504],{"type":433,"value":505},"Emmanuel 给了一个典型的 KDB 用户使用示例，见 unit-tests/kingdb_user.cc。通过此示例，能大概了解 KDB 的接口及如何使用该接口。创建数据库、存入、读取前都需要创建对应的参数配置 Options；这些动作通过 Status 对象来回传操作成功与否。",{"type":427,"tag":507,"props":508,"children":512},"pre",{"code":509,"language":510,"meta":421,"className":511,"style":421},"#include \u003Ckingdb/kdb.h>\n\nint main() {\n  kdb::Status s;\n  kdb::DatabaseOptions db_options;\n  kdb::Database db(db_options, \"mylocaldb\");\n  s = db.Open();\n  if (!s.IsOK()) {\n    fprintf(stderr, \"Could not open the database: %s\\n\", s.ToString().c_str());\n    exit(1);\n  }\n\n  std::string key1(\"key1\");\n  std::string value1(\"value1\");\n\n  kdb::WriteOptions write_options;\n  s = db.Put(write_options, key1, value1);\n\n  kdb::ReadOptions read_options;\n  std::string out_str;\n  s = db.Get(read_options, key1, &out_str);\n  if (s.IsOK() && out_str == \"value1\") {\n    printf(\"Data successfully stored and retrieved\\n\"); \n  } else {\n    printf(\"An error occurred\\n\"); \n  }\n\n  return 0;\n}\n","cpp","language-cpp shiki shiki-themes material-theme-lighter github-light github-dark monokai",[513],{"type":427,"tag":514,"props":515,"children":516},"code",{"__ignoreMap":421},[517,546,555,582,608,629,686,721,763,844,867,876,884,927,968,976,997,1053,1061,1082,1103,1163,1227,1267,1285,1322,1330,1338,1356],{"type":427,"tag":518,"props":519,"children":522},"span",{"class":520,"line":521},"line",1,[523,529,535,541],{"type":427,"tag":518,"props":524,"children":526},{"style":525},"--shiki-light:#39ADB5;--shiki-light-font-style:italic;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#F92672;--shiki-sepia-font-style:inherit",[527],{"type":433,"value":528},"#include",{"type":427,"tag":518,"props":530,"children":532},{"style":531},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[533],{"type":433,"value":534}," \u003C",{"type":427,"tag":518,"props":536,"children":538},{"style":537},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[539],{"type":433,"value":540},"kingdb/kdb.h",{"type":427,"tag":518,"props":542,"children":543},{"style":531},[544],{"type":433,"value":545},">\n",{"type":427,"tag":518,"props":547,"children":549},{"class":520,"line":548},2,[550],{"type":427,"tag":518,"props":551,"children":552},{"emptyLinePlaceholder":420},[553],{"type":433,"value":554},"\n",{"type":427,"tag":518,"props":556,"children":558},{"class":520,"line":557},3,[559,565,571,577],{"type":427,"tag":518,"props":560,"children":562},{"style":561},"--shiki-light:#9C3EDA;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic",[563],{"type":433,"value":564},"int",{"type":427,"tag":518,"props":566,"children":568},{"style":567},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[569],{"type":433,"value":570}," main",{"type":427,"tag":518,"props":572,"children":574},{"style":573},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[575],{"type":433,"value":576},"()",{"type":427,"tag":518,"props":578,"children":579},{"style":573},[580],{"type":433,"value":581}," {\n",{"type":427,"tag":518,"props":583,"children":585},{"class":520,"line":584},4,[586,592,597,603],{"type":427,"tag":518,"props":587,"children":589},{"style":588},"--shiki-light:#E2931D;--shiki-light-text-decoration:inherit;--shiki-default:#6F42C1;--shiki-default-text-decoration:inherit;--shiki-dark:#B392F0;--shiki-dark-text-decoration:inherit;--shiki-sepia:#A6E22E;--shiki-sepia-text-decoration:underline",[590],{"type":433,"value":591},"  kdb",{"type":427,"tag":518,"props":593,"children":594},{"style":573},[595],{"type":433,"value":596},"::",{"type":427,"tag":518,"props":598,"children":600},{"style":599},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[601],{"type":433,"value":602},"Status s",{"type":427,"tag":518,"props":604,"children":605},{"style":573},[606],{"type":433,"value":607},";\n",{"type":427,"tag":518,"props":609,"children":611},{"class":520,"line":610},5,[612,616,620,625],{"type":427,"tag":518,"props":613,"children":614},{"style":588},[615],{"type":433,"value":591},{"type":427,"tag":518,"props":617,"children":618},{"style":573},[619],{"type":433,"value":596},{"type":427,"tag":518,"props":621,"children":622},{"style":599},[623],{"type":433,"value":624},"DatabaseOptions db_options",{"type":427,"tag":518,"props":626,"children":627},{"style":573},[628],{"type":433,"value":607},{"type":427,"tag":518,"props":630,"children":632},{"class":520,"line":631},6,[633,637,641,646,651,656,661,666,671,676,681],{"type":427,"tag":518,"props":634,"children":635},{"style":588},[636],{"type":433,"value":591},{"type":427,"tag":518,"props":638,"children":639},{"style":573},[640],{"type":433,"value":596},{"type":427,"tag":518,"props":642,"children":643},{"style":599},[644],{"type":433,"value":645},"Database ",{"type":427,"tag":518,"props":647,"children":648},{"style":567},[649],{"type":433,"value":650},"db",{"type":427,"tag":518,"props":652,"children":653},{"style":573},[654],{"type":433,"value":655},"(",{"type":427,"tag":518,"props":657,"children":658},{"style":599},[659],{"type":433,"value":660},"db_options",{"type":427,"tag":518,"props":662,"children":663},{"style":573},[664],{"type":433,"value":665},",",{"type":427,"tag":518,"props":667,"children":668},{"style":531},[669],{"type":433,"value":670}," \"",{"type":427,"tag":518,"props":672,"children":673},{"style":537},[674],{"type":433,"value":675},"mylocaldb",{"type":427,"tag":518,"props":677,"children":678},{"style":531},[679],{"type":433,"value":680},"\"",{"type":427,"tag":518,"props":682,"children":683},{"style":573},[684],{"type":433,"value":685},");\n",{"type":427,"tag":518,"props":687,"children":689},{"class":520,"line":688},7,[690,695,701,706,711,716],{"type":427,"tag":518,"props":691,"children":692},{"style":599},[693],{"type":433,"value":694},"  s ",{"type":427,"tag":518,"props":696,"children":698},{"style":697},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[699],{"type":433,"value":700},"=",{"type":427,"tag":518,"props":702,"children":703},{"style":599},[704],{"type":433,"value":705}," db",{"type":427,"tag":518,"props":707,"children":708},{"style":573},[709],{"type":433,"value":710},".",{"type":427,"tag":518,"props":712,"children":713},{"style":567},[714],{"type":433,"value":715},"Open",{"type":427,"tag":518,"props":717,"children":718},{"style":573},[719],{"type":433,"value":720},"();\n",{"type":427,"tag":518,"props":722,"children":724},{"class":520,"line":723},8,[725,730,735,740,745,749,754,759],{"type":427,"tag":518,"props":726,"children":727},{"style":525},[728],{"type":433,"value":729},"  if",{"type":427,"tag":518,"props":731,"children":732},{"style":573},[733],{"type":433,"value":734}," (",{"type":427,"tag":518,"props":736,"children":737},{"style":697},[738],{"type":433,"value":739},"!",{"type":427,"tag":518,"props":741,"children":742},{"style":599},[743],{"type":433,"value":744},"s",{"type":427,"tag":518,"props":746,"children":747},{"style":573},[748],{"type":433,"value":710},{"type":427,"tag":518,"props":750,"children":751},{"style":567},[752],{"type":433,"value":753},"IsOK",{"type":427,"tag":518,"props":755,"children":756},{"style":573},[757],{"type":433,"value":758},"())",{"type":427,"tag":518,"props":760,"children":761},{"style":573},[762],{"type":433,"value":581},{"type":427,"tag":518,"props":764,"children":766},{"class":520,"line":765},9,[767,772,776,782,786,790,795,801,807,811,815,820,824,829,834,839],{"type":427,"tag":518,"props":768,"children":769},{"style":567},[770],{"type":433,"value":771},"    fprintf",{"type":427,"tag":518,"props":773,"children":774},{"style":573},[775],{"type":433,"value":655},{"type":427,"tag":518,"props":777,"children":779},{"style":778},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[780],{"type":433,"value":781},"stderr",{"type":427,"tag":518,"props":783,"children":784},{"style":573},[785],{"type":433,"value":665},{"type":427,"tag":518,"props":787,"children":788},{"style":531},[789],{"type":433,"value":670},{"type":427,"tag":518,"props":791,"children":792},{"style":537},[793],{"type":433,"value":794},"Could not open the database: ",{"type":427,"tag":518,"props":796,"children":798},{"style":797},"--shiki-light:#E53935;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[799],{"type":433,"value":800},"%s",{"type":427,"tag":518,"props":802,"children":804},{"style":803},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[805],{"type":433,"value":806},"\\n",{"type":427,"tag":518,"props":808,"children":809},{"style":531},[810],{"type":433,"value":680},{"type":427,"tag":518,"props":812,"children":813},{"style":573},[814],{"type":433,"value":665},{"type":427,"tag":518,"props":816,"children":817},{"style":599},[818],{"type":433,"value":819}," s",{"type":427,"tag":518,"props":821,"children":822},{"style":573},[823],{"type":433,"value":710},{"type":427,"tag":518,"props":825,"children":826},{"style":567},[827],{"type":433,"value":828},"ToString",{"type":427,"tag":518,"props":830,"children":831},{"style":573},[832],{"type":433,"value":833},"().",{"type":427,"tag":518,"props":835,"children":836},{"style":567},[837],{"type":433,"value":838},"c_str",{"type":427,"tag":518,"props":840,"children":841},{"style":573},[842],{"type":433,"value":843},"());\n",{"type":427,"tag":518,"props":845,"children":847},{"class":520,"line":846},10,[848,853,857,863],{"type":427,"tag":518,"props":849,"children":850},{"style":567},[851],{"type":433,"value":852},"    exit",{"type":427,"tag":518,"props":854,"children":855},{"style":573},[856],{"type":433,"value":655},{"type":427,"tag":518,"props":858,"children":860},{"style":859},"--shiki-light:#F76D47;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[861],{"type":433,"value":862},"1",{"type":427,"tag":518,"props":864,"children":865},{"style":573},[866],{"type":433,"value":685},{"type":427,"tag":518,"props":868,"children":870},{"class":520,"line":869},11,[871],{"type":427,"tag":518,"props":872,"children":873},{"style":573},[874],{"type":433,"value":875},"  }\n",{"type":427,"tag":518,"props":877,"children":879},{"class":520,"line":878},12,[880],{"type":427,"tag":518,"props":881,"children":882},{"emptyLinePlaceholder":420},[883],{"type":433,"value":554},{"type":427,"tag":518,"props":885,"children":887},{"class":520,"line":886},13,[888,893,897,902,907,911,915,919,923],{"type":427,"tag":518,"props":889,"children":890},{"style":588},[891],{"type":433,"value":892},"  std",{"type":427,"tag":518,"props":894,"children":895},{"style":573},[896],{"type":433,"value":596},{"type":427,"tag":518,"props":898,"children":899},{"style":599},[900],{"type":433,"value":901},"string ",{"type":427,"tag":518,"props":903,"children":904},{"style":567},[905],{"type":433,"value":906},"key1",{"type":427,"tag":518,"props":908,"children":909},{"style":573},[910],{"type":433,"value":655},{"type":427,"tag":518,"props":912,"children":913},{"style":531},[914],{"type":433,"value":680},{"type":427,"tag":518,"props":916,"children":917},{"style":537},[918],{"type":433,"value":906},{"type":427,"tag":518,"props":920,"children":921},{"style":531},[922],{"type":433,"value":680},{"type":427,"tag":518,"props":924,"children":925},{"style":573},[926],{"type":433,"value":685},{"type":427,"tag":518,"props":928,"children":930},{"class":520,"line":929},14,[931,935,939,943,948,952,956,960,964],{"type":427,"tag":518,"props":932,"children":933},{"style":588},[934],{"type":433,"value":892},{"type":427,"tag":518,"props":936,"children":937},{"style":573},[938],{"type":433,"value":596},{"type":427,"tag":518,"props":940,"children":941},{"style":599},[942],{"type":433,"value":901},{"type":427,"tag":518,"props":944,"children":945},{"style":567},[946],{"type":433,"value":947},"value1",{"type":427,"tag":518,"props":949,"children":950},{"style":573},[951],{"type":433,"value":655},{"type":427,"tag":518,"props":953,"children":954},{"style":531},[955],{"type":433,"value":680},{"type":427,"tag":518,"props":957,"children":958},{"style":537},[959],{"type":433,"value":947},{"type":427,"tag":518,"props":961,"children":962},{"style":531},[963],{"type":433,"value":680},{"type":427,"tag":518,"props":965,"children":966},{"style":573},[967],{"type":433,"value":685},{"type":427,"tag":518,"props":969,"children":971},{"class":520,"line":970},15,[972],{"type":427,"tag":518,"props":973,"children":974},{"emptyLinePlaceholder":420},[975],{"type":433,"value":554},{"type":427,"tag":518,"props":977,"children":979},{"class":520,"line":978},16,[980,984,988,993],{"type":427,"tag":518,"props":981,"children":982},{"style":588},[983],{"type":433,"value":591},{"type":427,"tag":518,"props":985,"children":986},{"style":573},[987],{"type":433,"value":596},{"type":427,"tag":518,"props":989,"children":990},{"style":599},[991],{"type":433,"value":992},"WriteOptions write_options",{"type":427,"tag":518,"props":994,"children":995},{"style":573},[996],{"type":433,"value":607},{"type":427,"tag":518,"props":998,"children":1000},{"class":520,"line":999},17,[1001,1005,1009,1013,1017,1022,1026,1031,1035,1040,1044,1049],{"type":427,"tag":518,"props":1002,"children":1003},{"style":599},[1004],{"type":433,"value":694},{"type":427,"tag":518,"props":1006,"children":1007},{"style":697},[1008],{"type":433,"value":700},{"type":427,"tag":518,"props":1010,"children":1011},{"style":599},[1012],{"type":433,"value":705},{"type":427,"tag":518,"props":1014,"children":1015},{"style":573},[1016],{"type":433,"value":710},{"type":427,"tag":518,"props":1018,"children":1019},{"style":567},[1020],{"type":433,"value":1021},"Put",{"type":427,"tag":518,"props":1023,"children":1024},{"style":573},[1025],{"type":433,"value":655},{"type":427,"tag":518,"props":1027,"children":1028},{"style":599},[1029],{"type":433,"value":1030},"write_options",{"type":427,"tag":518,"props":1032,"children":1033},{"style":573},[1034],{"type":433,"value":665},{"type":427,"tag":518,"props":1036,"children":1037},{"style":599},[1038],{"type":433,"value":1039}," key1",{"type":427,"tag":518,"props":1041,"children":1042},{"style":573},[1043],{"type":433,"value":665},{"type":427,"tag":518,"props":1045,"children":1046},{"style":599},[1047],{"type":433,"value":1048}," value1",{"type":427,"tag":518,"props":1050,"children":1051},{"style":573},[1052],{"type":433,"value":685},{"type":427,"tag":518,"props":1054,"children":1056},{"class":520,"line":1055},18,[1057],{"type":427,"tag":518,"props":1058,"children":1059},{"emptyLinePlaceholder":420},[1060],{"type":433,"value":554},{"type":427,"tag":518,"props":1062,"children":1064},{"class":520,"line":1063},19,[1065,1069,1073,1078],{"type":427,"tag":518,"props":1066,"children":1067},{"style":588},[1068],{"type":433,"value":591},{"type":427,"tag":518,"props":1070,"children":1071},{"style":573},[1072],{"type":433,"value":596},{"type":427,"tag":518,"props":1074,"children":1075},{"style":599},[1076],{"type":433,"value":1077},"ReadOptions read_options",{"type":427,"tag":518,"props":1079,"children":1080},{"style":573},[1081],{"type":433,"value":607},{"type":427,"tag":518,"props":1083,"children":1085},{"class":520,"line":1084},20,[1086,1090,1094,1099],{"type":427,"tag":518,"props":1087,"children":1088},{"style":588},[1089],{"type":433,"value":892},{"type":427,"tag":518,"props":1091,"children":1092},{"style":573},[1093],{"type":433,"value":596},{"type":427,"tag":518,"props":1095,"children":1096},{"style":599},[1097],{"type":433,"value":1098},"string out_str",{"type":427,"tag":518,"props":1100,"children":1101},{"style":573},[1102],{"type":433,"value":607},{"type":427,"tag":518,"props":1104,"children":1106},{"class":520,"line":1105},21,[1107,1111,1115,1119,1123,1128,1132,1137,1141,1145,1149,1154,1159],{"type":427,"tag":518,"props":1108,"children":1109},{"style":599},[1110],{"type":433,"value":694},{"type":427,"tag":518,"props":1112,"children":1113},{"style":697},[1114],{"type":433,"value":700},{"type":427,"tag":518,"props":1116,"children":1117},{"style":599},[1118],{"type":433,"value":705},{"type":427,"tag":518,"props":1120,"children":1121},{"style":573},[1122],{"type":433,"value":710},{"type":427,"tag":518,"props":1124,"children":1125},{"style":567},[1126],{"type":433,"value":1127},"Get",{"type":427,"tag":518,"props":1129,"children":1130},{"style":573},[1131],{"type":433,"value":655},{"type":427,"tag":518,"props":1133,"children":1134},{"style":599},[1135],{"type":433,"value":1136},"read_options",{"type":427,"tag":518,"props":1138,"children":1139},{"style":573},[1140],{"type":433,"value":665},{"type":427,"tag":518,"props":1142,"children":1143},{"style":599},[1144],{"type":433,"value":1039},{"type":427,"tag":518,"props":1146,"children":1147},{"style":573},[1148],{"type":433,"value":665},{"type":427,"tag":518,"props":1150,"children":1151},{"style":697},[1152],{"type":433,"value":1153}," &",{"type":427,"tag":518,"props":1155,"children":1156},{"style":599},[1157],{"type":433,"value":1158},"out_str",{"type":427,"tag":518,"props":1160,"children":1161},{"style":573},[1162],{"type":433,"value":685},{"type":427,"tag":518,"props":1164,"children":1166},{"class":520,"line":1165},22,[1167,1171,1175,1179,1183,1187,1191,1196,1201,1206,1210,1214,1218,1223],{"type":427,"tag":518,"props":1168,"children":1169},{"style":525},[1170],{"type":433,"value":729},{"type":427,"tag":518,"props":1172,"children":1173},{"style":573},[1174],{"type":433,"value":734},{"type":427,"tag":518,"props":1176,"children":1177},{"style":599},[1178],{"type":433,"value":744},{"type":427,"tag":518,"props":1180,"children":1181},{"style":573},[1182],{"type":433,"value":710},{"type":427,"tag":518,"props":1184,"children":1185},{"style":567},[1186],{"type":433,"value":753},{"type":427,"tag":518,"props":1188,"children":1189},{"style":573},[1190],{"type":433,"value":576},{"type":427,"tag":518,"props":1192,"children":1193},{"style":697},[1194],{"type":433,"value":1195}," &&",{"type":427,"tag":518,"props":1197,"children":1198},{"style":599},[1199],{"type":433,"value":1200}," out_str ",{"type":427,"tag":518,"props":1202,"children":1203},{"style":697},[1204],{"type":433,"value":1205},"==",{"type":427,"tag":518,"props":1207,"children":1208},{"style":531},[1209],{"type":433,"value":670},{"type":427,"tag":518,"props":1211,"children":1212},{"style":537},[1213],{"type":433,"value":947},{"type":427,"tag":518,"props":1215,"children":1216},{"style":531},[1217],{"type":433,"value":680},{"type":427,"tag":518,"props":1219,"children":1220},{"style":573},[1221],{"type":433,"value":1222},")",{"type":427,"tag":518,"props":1224,"children":1225},{"style":573},[1226],{"type":433,"value":581},{"type":427,"tag":518,"props":1228,"children":1230},{"class":520,"line":1229},23,[1231,1236,1240,1244,1249,1253,1257,1262],{"type":427,"tag":518,"props":1232,"children":1233},{"style":567},[1234],{"type":433,"value":1235},"    printf",{"type":427,"tag":518,"props":1237,"children":1238},{"style":573},[1239],{"type":433,"value":655},{"type":427,"tag":518,"props":1241,"children":1242},{"style":531},[1243],{"type":433,"value":680},{"type":427,"tag":518,"props":1245,"children":1246},{"style":537},[1247],{"type":433,"value":1248},"Data successfully stored and retrieved",{"type":427,"tag":518,"props":1250,"children":1251},{"style":803},[1252],{"type":433,"value":806},{"type":427,"tag":518,"props":1254,"children":1255},{"style":531},[1256],{"type":433,"value":680},{"type":427,"tag":518,"props":1258,"children":1259},{"style":573},[1260],{"type":433,"value":1261},");",{"type":427,"tag":518,"props":1263,"children":1264},{"style":778},[1265],{"type":433,"value":1266}," \n",{"type":427,"tag":518,"props":1268,"children":1270},{"class":520,"line":1269},24,[1271,1276,1281],{"type":427,"tag":518,"props":1272,"children":1273},{"style":573},[1274],{"type":433,"value":1275},"  }",{"type":427,"tag":518,"props":1277,"children":1278},{"style":525},[1279],{"type":433,"value":1280}," else",{"type":427,"tag":518,"props":1282,"children":1283},{"style":573},[1284],{"type":433,"value":581},{"type":427,"tag":518,"props":1286,"children":1288},{"class":520,"line":1287},25,[1289,1293,1297,1301,1306,1310,1314,1318],{"type":427,"tag":518,"props":1290,"children":1291},{"style":567},[1292],{"type":433,"value":1235},{"type":427,"tag":518,"props":1294,"children":1295},{"style":573},[1296],{"type":433,"value":655},{"type":427,"tag":518,"props":1298,"children":1299},{"style":531},[1300],{"type":433,"value":680},{"type":427,"tag":518,"props":1302,"children":1303},{"style":537},[1304],{"type":433,"value":1305},"An error occurred",{"type":427,"tag":518,"props":1307,"children":1308},{"style":803},[1309],{"type":433,"value":806},{"type":427,"tag":518,"props":1311,"children":1312},{"style":531},[1313],{"type":433,"value":680},{"type":427,"tag":518,"props":1315,"children":1316},{"style":573},[1317],{"type":433,"value":1261},{"type":427,"tag":518,"props":1319,"children":1320},{"style":778},[1321],{"type":433,"value":1266},{"type":427,"tag":518,"props":1323,"children":1325},{"class":520,"line":1324},26,[1326],{"type":427,"tag":518,"props":1327,"children":1328},{"style":573},[1329],{"type":433,"value":875},{"type":427,"tag":518,"props":1331,"children":1333},{"class":520,"line":1332},27,[1334],{"type":427,"tag":518,"props":1335,"children":1336},{"emptyLinePlaceholder":420},[1337],{"type":433,"value":554},{"type":427,"tag":518,"props":1339,"children":1341},{"class":520,"line":1340},28,[1342,1347,1352],{"type":427,"tag":518,"props":1343,"children":1344},{"style":525},[1345],{"type":433,"value":1346},"  return",{"type":427,"tag":518,"props":1348,"children":1349},{"style":859},[1350],{"type":433,"value":1351}," 0",{"type":427,"tag":518,"props":1353,"children":1354},{"style":573},[1355],{"type":433,"value":607},{"type":427,"tag":518,"props":1357,"children":1359},{"class":520,"line":1358},29,[1360],{"type":427,"tag":518,"props":1361,"children":1362},{"style":573},[1363],{"type":433,"value":1364},"}\n",{"type":427,"tag":441,"props":1366,"children":1367},{},[1368],{"type":433,"value":1369},"测试的入口文件是 unit-tests/test_db.cc。以我看过的 JS 库来看，这是一个基本的功能测试。编译好 KDB 之后，运行编译出的二进制文件 test_db 可以开始测试。测试结果输出到控制台，如下代码所示。",{"type":427,"tag":507,"props":1371,"children":1373},{"code":1372},"==== Test DBTest.CloseAndReopen\n==== Test DBTest.RepairInvalidDatabaseOptionFile\n==== Test DBTest.KeysWithNullBytes\n==== Test DBTest.TestStringInterface\nDatabase Options: Stage 0 - Incompressible data with LZ4 compression enabled\nDatabase Options: Stage 1 - Compressible data with LZ4 compression enabled\nDatabase Options: Stage 2 - Compression disabled\nDatabase Options: Stage 3 - 64-bit MurmurHash3\nDatabase Options: Stage 4 - Checksum verification with incompressible data\nDatabase Options: Stage 5 - Checksum verification with compressible data\nDatabase Options: Stage 6 - Checksum verification with compression disabled\nDatabase Options: Stage 7 - Synced writes\nDatabase Options: Stage 8 - Small-sized HSTables with compression disabled\nDatabase Options: Stage 9 - Small-sized HSTables with incompressible data and LZ4 compression\nDatabase Options: Stage 10 - Small-sized HSTables with compressible data and LZ4 compression\nDatabase Options: Stage 11 - Direct mode for Write Buffer (incompressible data with LZ4 compression enabled)\nDatabase Options: Stage 12 - Direct mode for Write Buffer (compressible data with LZ4 compression enabled)\n==== Test DBTest.MultipartReader\n// the same with last stages\n==== Test DBTest.SingleThreadSmallEntries\n// the same with last stages\n==== Test DBTest.SingleThreadSnapshot\n// the same with last stages\n==== Test DBTest.SingleThreadSmallEntriesCompaction\n// the same with last stages\n==== Test DBTest.SequentialIterator\n// the same with last stages\n==== Test DBTest.SingleThreadSingleLargeEntry\n// the same with last stages\n==== Test DBTest.FileUtil\nmysize: 268435456\nOK\n89 ms\nFree size: 944 GB\n==== PASSED 11 tests\n",[1374],{"type":427,"tag":514,"props":1375,"children":1376},{"__ignoreMap":421},[1377],{"type":433,"value":1372},{"type":427,"tag":441,"props":1379,"children":1380},{},[1381],{"type":433,"value":1382},"每个功能点如数据库初始化和关闭 CloseAndReopen、存入带结束符的键 KeysWithNullBytes 都使用对应继承了 DBTest 的测试类进行测试。涉及到与数据库交互的功能部分如 TestStringInterface 使用循环，遍历了所有数据库 Options 可以设置的情况（但是只是二维循环，没有测试参数间的组合）。即对应上文的 Stage 1、Stage 2...",{"type":427,"tag":441,"props":1384,"children":1385},{},[1386],{"type":433,"value":1387},"在 test_db 创建相应的测试类时，会自动调用测试套件（unit-tests/testharness.cc）中的 RegisterTest 把测试函数储存起来。以便运行测试时，通过读取环境变量来判断是否要跳过某类测试。",{"type":427,"tag":441,"props":1389,"children":1390},{},[1391],{"type":433,"value":1392},"测试代码的实现还有一些有意思的地方，以下提及。",{"type":427,"tag":1394,"props":1395,"children":1397},"h4",{"id":1396},"信号处理",[1398],{"type":433,"value":1396},{"type":427,"tag":441,"props":1400,"children":1401},{},[1402],{"type":433,"value":1403},"和数据库核心的入口函数一样，使用 signal 挂载了对 SIGSEGV、SIGABRT 信号的处理。这两个信号分别指代系统内存错误和系统中断。而处理函数非常简单，就是 IKVS 中提到的“let it die”风格：输出调用栈，立马结束程序。",{"type":427,"tag":507,"props":1405,"children":1407},{"code":1406,"language":510,"meta":421,"className":511,"style":421},"void handler(int sig) {\n  int depth_max = 20;\n  void *array[depth_max];\n  size_t depth;\n  // backtrace 将前 depth_max 层栈帧记录到 array 数组中，\n  // 再通过 backtrace_symbols_fd 输出到 stderr。\n  // 文档见：https://man7.org/linux/man-pages/man3/backtrace.3.html\n  depth = backtrace(array, depth_max);\n  fprintf(stderr, \"Error: signal %d:\\n\", sig);\n  backtrace_symbols_fd(array, depth, STDERR_FILENO);\n  exit(1);\n}\nint main() {\n  signal(SIGSEGV, handler);\n  signal(SIGABRT, handler);\n  return kdb::test::RunAllTests();\n}\n",[1408],{"type":427,"tag":514,"props":1409,"children":1410},{"__ignoreMap":421},[1411,1446,1472,1505,1522,1531,1539,1547,1585,1644,1681,1701,1708,1727,1756,1784,1818],{"type":427,"tag":518,"props":1412,"children":1413},{"class":520,"line":521},[1414,1419,1424,1428,1432,1438,1442],{"type":427,"tag":518,"props":1415,"children":1416},{"style":561},[1417],{"type":433,"value":1418},"void",{"type":427,"tag":518,"props":1420,"children":1421},{"style":567},[1422],{"type":433,"value":1423}," handler",{"type":427,"tag":518,"props":1425,"children":1426},{"style":573},[1427],{"type":433,"value":655},{"type":427,"tag":518,"props":1429,"children":1430},{"style":561},[1431],{"type":433,"value":564},{"type":427,"tag":518,"props":1433,"children":1435},{"style":1434},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#E36209;--shiki-default-font-style:inherit;--shiki-dark:#FFAB70;--shiki-dark-font-style:inherit;--shiki-sepia:#FD971F;--shiki-sepia-font-style:italic",[1436],{"type":433,"value":1437}," sig",{"type":427,"tag":518,"props":1439,"children":1440},{"style":573},[1441],{"type":433,"value":1222},{"type":427,"tag":518,"props":1443,"children":1444},{"style":573},[1445],{"type":433,"value":581},{"type":427,"tag":518,"props":1447,"children":1448},{"class":520,"line":548},[1449,1454,1459,1463,1468],{"type":427,"tag":518,"props":1450,"children":1451},{"style":561},[1452],{"type":433,"value":1453},"  int",{"type":427,"tag":518,"props":1455,"children":1456},{"style":599},[1457],{"type":433,"value":1458}," depth_max ",{"type":427,"tag":518,"props":1460,"children":1461},{"style":697},[1462],{"type":433,"value":700},{"type":427,"tag":518,"props":1464,"children":1465},{"style":859},[1466],{"type":433,"value":1467}," 20",{"type":427,"tag":518,"props":1469,"children":1470},{"style":573},[1471],{"type":433,"value":607},{"type":427,"tag":518,"props":1473,"children":1474},{"class":520,"line":557},[1475,1480,1485,1490,1495,1500],{"type":427,"tag":518,"props":1476,"children":1477},{"style":561},[1478],{"type":433,"value":1479},"  void",{"type":427,"tag":518,"props":1481,"children":1482},{"style":697},[1483],{"type":433,"value":1484}," *",{"type":427,"tag":518,"props":1486,"children":1487},{"style":599},[1488],{"type":433,"value":1489},"array",{"type":427,"tag":518,"props":1491,"children":1492},{"style":573},[1493],{"type":433,"value":1494},"[",{"type":427,"tag":518,"props":1496,"children":1497},{"style":599},[1498],{"type":433,"value":1499},"depth_max",{"type":427,"tag":518,"props":1501,"children":1502},{"style":573},[1503],{"type":433,"value":1504},"];\n",{"type":427,"tag":518,"props":1506,"children":1507},{"class":520,"line":584},[1508,1513,1518],{"type":427,"tag":518,"props":1509,"children":1510},{"style":561},[1511],{"type":433,"value":1512},"  size_t",{"type":427,"tag":518,"props":1514,"children":1515},{"style":599},[1516],{"type":433,"value":1517}," depth",{"type":427,"tag":518,"props":1519,"children":1520},{"style":573},[1521],{"type":433,"value":607},{"type":427,"tag":518,"props":1523,"children":1524},{"class":520,"line":610},[1525],{"type":427,"tag":518,"props":1526,"children":1528},{"style":1527},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit",[1529],{"type":433,"value":1530},"  // backtrace 将前 depth_max 层栈帧记录到 array 数组中，\n",{"type":427,"tag":518,"props":1532,"children":1533},{"class":520,"line":631},[1534],{"type":427,"tag":518,"props":1535,"children":1536},{"style":1527},[1537],{"type":433,"value":1538},"  // 再通过 backtrace_symbols_fd 输出到 stderr。\n",{"type":427,"tag":518,"props":1540,"children":1541},{"class":520,"line":688},[1542],{"type":427,"tag":518,"props":1543,"children":1544},{"style":1527},[1545],{"type":433,"value":1546},"  // 文档见：https://man7.org/linux/man-pages/man3/backtrace.3.html\n",{"type":427,"tag":518,"props":1548,"children":1549},{"class":520,"line":723},[1550,1555,1559,1564,1568,1572,1576,1581],{"type":427,"tag":518,"props":1551,"children":1552},{"style":599},[1553],{"type":433,"value":1554},"  depth ",{"type":427,"tag":518,"props":1556,"children":1557},{"style":697},[1558],{"type":433,"value":700},{"type":427,"tag":518,"props":1560,"children":1561},{"style":567},[1562],{"type":433,"value":1563}," backtrace",{"type":427,"tag":518,"props":1565,"children":1566},{"style":573},[1567],{"type":433,"value":655},{"type":427,"tag":518,"props":1569,"children":1570},{"style":599},[1571],{"type":433,"value":1489},{"type":427,"tag":518,"props":1573,"children":1574},{"style":573},[1575],{"type":433,"value":665},{"type":427,"tag":518,"props":1577,"children":1578},{"style":599},[1579],{"type":433,"value":1580}," depth_max",{"type":427,"tag":518,"props":1582,"children":1583},{"style":573},[1584],{"type":433,"value":685},{"type":427,"tag":518,"props":1586,"children":1587},{"class":520,"line":765},[1588,1593,1597,1601,1605,1609,1614,1619,1624,1628,1632,1636,1640],{"type":427,"tag":518,"props":1589,"children":1590},{"style":567},[1591],{"type":433,"value":1592},"  fprintf",{"type":427,"tag":518,"props":1594,"children":1595},{"style":573},[1596],{"type":433,"value":655},{"type":427,"tag":518,"props":1598,"children":1599},{"style":599},[1600],{"type":433,"value":781},{"type":427,"tag":518,"props":1602,"children":1603},{"style":573},[1604],{"type":433,"value":665},{"type":427,"tag":518,"props":1606,"children":1607},{"style":531},[1608],{"type":433,"value":670},{"type":427,"tag":518,"props":1610,"children":1611},{"style":537},[1612],{"type":433,"value":1613},"Error: signal ",{"type":427,"tag":518,"props":1615,"children":1616},{"style":797},[1617],{"type":433,"value":1618},"%d",{"type":427,"tag":518,"props":1620,"children":1621},{"style":537},[1622],{"type":433,"value":1623},":",{"type":427,"tag":518,"props":1625,"children":1626},{"style":803},[1627],{"type":433,"value":806},{"type":427,"tag":518,"props":1629,"children":1630},{"style":531},[1631],{"type":433,"value":680},{"type":427,"tag":518,"props":1633,"children":1634},{"style":573},[1635],{"type":433,"value":665},{"type":427,"tag":518,"props":1637,"children":1638},{"style":599},[1639],{"type":433,"value":1437},{"type":427,"tag":518,"props":1641,"children":1642},{"style":573},[1643],{"type":433,"value":685},{"type":427,"tag":518,"props":1645,"children":1646},{"class":520,"line":846},[1647,1652,1656,1660,1664,1668,1672,1677],{"type":427,"tag":518,"props":1648,"children":1649},{"style":567},[1650],{"type":433,"value":1651},"  backtrace_symbols_fd",{"type":427,"tag":518,"props":1653,"children":1654},{"style":573},[1655],{"type":433,"value":655},{"type":427,"tag":518,"props":1657,"children":1658},{"style":599},[1659],{"type":433,"value":1489},{"type":427,"tag":518,"props":1661,"children":1662},{"style":573},[1663],{"type":433,"value":665},{"type":427,"tag":518,"props":1665,"children":1666},{"style":599},[1667],{"type":433,"value":1517},{"type":427,"tag":518,"props":1669,"children":1670},{"style":573},[1671],{"type":433,"value":665},{"type":427,"tag":518,"props":1673,"children":1674},{"style":599},[1675],{"type":433,"value":1676}," STDERR_FILENO",{"type":427,"tag":518,"props":1678,"children":1679},{"style":573},[1680],{"type":433,"value":685},{"type":427,"tag":518,"props":1682,"children":1683},{"class":520,"line":869},[1684,1689,1693,1697],{"type":427,"tag":518,"props":1685,"children":1686},{"style":567},[1687],{"type":433,"value":1688},"  exit",{"type":427,"tag":518,"props":1690,"children":1691},{"style":573},[1692],{"type":433,"value":655},{"type":427,"tag":518,"props":1694,"children":1695},{"style":859},[1696],{"type":433,"value":862},{"type":427,"tag":518,"props":1698,"children":1699},{"style":573},[1700],{"type":433,"value":685},{"type":427,"tag":518,"props":1702,"children":1703},{"class":520,"line":878},[1704],{"type":427,"tag":518,"props":1705,"children":1706},{"style":573},[1707],{"type":433,"value":1364},{"type":427,"tag":518,"props":1709,"children":1710},{"class":520,"line":886},[1711,1715,1719,1723],{"type":427,"tag":518,"props":1712,"children":1713},{"style":561},[1714],{"type":433,"value":564},{"type":427,"tag":518,"props":1716,"children":1717},{"style":567},[1718],{"type":433,"value":570},{"type":427,"tag":518,"props":1720,"children":1721},{"style":573},[1722],{"type":433,"value":576},{"type":427,"tag":518,"props":1724,"children":1725},{"style":573},[1726],{"type":433,"value":581},{"type":427,"tag":518,"props":1728,"children":1729},{"class":520,"line":929},[1730,1735,1739,1744,1748,1752],{"type":427,"tag":518,"props":1731,"children":1732},{"style":567},[1733],{"type":433,"value":1734},"  signal",{"type":427,"tag":518,"props":1736,"children":1737},{"style":573},[1738],{"type":433,"value":655},{"type":427,"tag":518,"props":1740,"children":1741},{"style":599},[1742],{"type":433,"value":1743},"SIGSEGV",{"type":427,"tag":518,"props":1745,"children":1746},{"style":573},[1747],{"type":433,"value":665},{"type":427,"tag":518,"props":1749,"children":1750},{"style":599},[1751],{"type":433,"value":1423},{"type":427,"tag":518,"props":1753,"children":1754},{"style":573},[1755],{"type":433,"value":685},{"type":427,"tag":518,"props":1757,"children":1758},{"class":520,"line":970},[1759,1763,1767,1772,1776,1780],{"type":427,"tag":518,"props":1760,"children":1761},{"style":567},[1762],{"type":433,"value":1734},{"type":427,"tag":518,"props":1764,"children":1765},{"style":573},[1766],{"type":433,"value":655},{"type":427,"tag":518,"props":1768,"children":1769},{"style":599},[1770],{"type":433,"value":1771},"SIGABRT",{"type":427,"tag":518,"props":1773,"children":1774},{"style":573},[1775],{"type":433,"value":665},{"type":427,"tag":518,"props":1777,"children":1778},{"style":599},[1779],{"type":433,"value":1423},{"type":427,"tag":518,"props":1781,"children":1782},{"style":573},[1783],{"type":433,"value":685},{"type":427,"tag":518,"props":1785,"children":1786},{"class":520,"line":978},[1787,1791,1796,1800,1805,1809,1814],{"type":427,"tag":518,"props":1788,"children":1789},{"style":525},[1790],{"type":433,"value":1346},{"type":427,"tag":518,"props":1792,"children":1793},{"style":588},[1794],{"type":433,"value":1795}," kdb",{"type":427,"tag":518,"props":1797,"children":1798},{"style":573},[1799],{"type":433,"value":596},{"type":427,"tag":518,"props":1801,"children":1802},{"style":588},[1803],{"type":433,"value":1804},"test",{"type":427,"tag":518,"props":1806,"children":1807},{"style":573},[1808],{"type":433,"value":596},{"type":427,"tag":518,"props":1810,"children":1811},{"style":567},[1812],{"type":433,"value":1813},"RunAllTests",{"type":427,"tag":518,"props":1815,"children":1816},{"style":573},[1817],{"type":433,"value":720},{"type":427,"tag":518,"props":1819,"children":1820},{"class":520,"line":999},[1821],{"type":427,"tag":518,"props":1822,"children":1823},{"style":573},[1824],{"type":433,"value":1364},{"type":427,"tag":1394,"props":1826,"children":1828},{"id":1827},"使用宏创建测试类",[1829],{"type":433,"value":1827},{"type":427,"tag":441,"props":1831,"children":1832},{},[1833],{"type":433,"value":1834},"test_db 中的类是使用宏定义的。如下代码，TEST 展开的新类，继承了 DBTest，实现了 _RunIt 接口以便调用测试函数。TCONCAT 宏顾名思义就是连接，使用标记黏贴运算符把两个字符串或实参连接在一起并视为一个新的标记。_Test_ 和 name 连接在一起后，就是新类的名称，如 _Test_CloseAndReopen。",{"type":427,"tag":507,"props":1836,"children":1838},{"code":1837,"language":510,"meta":421,"className":511,"style":421},"TEST(DBTest, CloseAndReopen) {\n  // ...\n}\n#define TEST(base,name)                                                 \\\nclass TCONCAT(_Test_,name) : public base {                              \\\n public:                                                                \\\n  void _Run();                                                          \\\n  static void _RunIt() {                                                \\\n    TCONCAT(_Test_,name) t;                                             \\\n    t._Run();                                                           \\\n  }                                                                     \\\n};                                                                      \\\nbool TCONCAT(_Test_ignored_,name) =                                     \\\n  ::kdb::test::RegisterTest(#base, #name, &TCONCAT(_Test_,name)::_RunIt); \\\n",[1839],{"type":427,"tag":514,"props":1840,"children":1841},{"__ignoreMap":421},[1842,1876,1884,1891,1931,1980,1998,2020,2053,2096,2122,2134,2147,2190],{"type":427,"tag":518,"props":1843,"children":1844},{"class":520,"line":521},[1845,1850,1854,1859,1863,1868,1872],{"type":427,"tag":518,"props":1846,"children":1847},{"style":567},[1848],{"type":433,"value":1849},"TEST",{"type":427,"tag":518,"props":1851,"children":1852},{"style":573},[1853],{"type":433,"value":655},{"type":427,"tag":518,"props":1855,"children":1856},{"style":599},[1857],{"type":433,"value":1858},"DBTest",{"type":427,"tag":518,"props":1860,"children":1861},{"style":573},[1862],{"type":433,"value":665},{"type":427,"tag":518,"props":1864,"children":1865},{"style":599},[1866],{"type":433,"value":1867}," CloseAndReopen",{"type":427,"tag":518,"props":1869,"children":1870},{"style":573},[1871],{"type":433,"value":1222},{"type":427,"tag":518,"props":1873,"children":1874},{"style":573},[1875],{"type":433,"value":581},{"type":427,"tag":518,"props":1877,"children":1878},{"class":520,"line":548},[1879],{"type":427,"tag":518,"props":1880,"children":1881},{"style":1527},[1882],{"type":433,"value":1883},"  // ...\n",{"type":427,"tag":518,"props":1885,"children":1886},{"class":520,"line":557},[1887],{"type":427,"tag":518,"props":1888,"children":1889},{"style":573},[1890],{"type":433,"value":1364},{"type":427,"tag":518,"props":1892,"children":1893},{"class":520,"line":584},[1894,1899,1904,1908,1913,1917,1922,1926],{"type":427,"tag":518,"props":1895,"children":1896},{"style":525},[1897],{"type":433,"value":1898},"#define",{"type":427,"tag":518,"props":1900,"children":1901},{"style":567},[1902],{"type":433,"value":1903}," TEST",{"type":427,"tag":518,"props":1905,"children":1906},{"style":573},[1907],{"type":433,"value":655},{"type":427,"tag":518,"props":1909,"children":1910},{"style":1434},[1911],{"type":433,"value":1912},"base",{"type":427,"tag":518,"props":1914,"children":1915},{"style":573},[1916],{"type":433,"value":665},{"type":427,"tag":518,"props":1918,"children":1919},{"style":1434},[1920],{"type":433,"value":1921},"name",{"type":427,"tag":518,"props":1923,"children":1924},{"style":573},[1925],{"type":433,"value":1222},{"type":427,"tag":518,"props":1927,"children":1928},{"style":803},[1929],{"type":433,"value":1930},"                                                 \\\n",{"type":427,"tag":518,"props":1932,"children":1933},{"class":520,"line":610},[1934,1939,1944,1948,1953,1957,1961,1965,1970,1975],{"type":427,"tag":518,"props":1935,"children":1936},{"style":561},[1937],{"type":433,"value":1938},"class",{"type":427,"tag":518,"props":1940,"children":1941},{"style":567},[1942],{"type":433,"value":1943}," TCONCAT",{"type":427,"tag":518,"props":1945,"children":1946},{"style":573},[1947],{"type":433,"value":655},{"type":427,"tag":518,"props":1949,"children":1950},{"style":588},[1951],{"type":433,"value":1952},"_Test_",{"type":427,"tag":518,"props":1954,"children":1955},{"style":573},[1956],{"type":433,"value":665},{"type":427,"tag":518,"props":1958,"children":1959},{"style":588},[1960],{"type":433,"value":1921},{"type":427,"tag":518,"props":1962,"children":1963},{"style":573},[1964],{"type":433,"value":1222},{"type":427,"tag":518,"props":1966,"children":1967},{"style":599},[1968],{"type":433,"value":1969}," : public base ",{"type":427,"tag":518,"props":1971,"children":1972},{"style":573},[1973],{"type":433,"value":1974},"{",{"type":427,"tag":518,"props":1976,"children":1977},{"style":803},[1978],{"type":433,"value":1979},"                              \\\n",{"type":427,"tag":518,"props":1981,"children":1982},{"class":520,"line":631},[1983,1988,1993],{"type":427,"tag":518,"props":1984,"children":1985},{"style":561},[1986],{"type":433,"value":1987}," public",{"type":427,"tag":518,"props":1989,"children":1991},{"style":1990},"--shiki-light:#39ADB5;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic",[1992],{"type":433,"value":1623},{"type":427,"tag":518,"props":1994,"children":1995},{"style":803},[1996],{"type":433,"value":1997},"                                                                \\\n",{"type":427,"tag":518,"props":1999,"children":2000},{"class":520,"line":688},[2001,2005,2010,2015],{"type":427,"tag":518,"props":2002,"children":2003},{"style":561},[2004],{"type":433,"value":1479},{"type":427,"tag":518,"props":2006,"children":2007},{"style":567},[2008],{"type":433,"value":2009}," _Run",{"type":427,"tag":518,"props":2011,"children":2012},{"style":573},[2013],{"type":433,"value":2014},"();",{"type":427,"tag":518,"props":2016,"children":2017},{"style":803},[2018],{"type":433,"value":2019},"                                                          \\\n",{"type":427,"tag":518,"props":2021,"children":2022},{"class":520,"line":723},[2023,2029,2034,2039,2043,2048],{"type":427,"tag":518,"props":2024,"children":2026},{"style":2025},"--shiki-light:#9C3EDA;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[2027],{"type":433,"value":2028},"  static",{"type":427,"tag":518,"props":2030,"children":2031},{"style":561},[2032],{"type":433,"value":2033}," void",{"type":427,"tag":518,"props":2035,"children":2036},{"style":567},[2037],{"type":433,"value":2038}," _RunIt",{"type":427,"tag":518,"props":2040,"children":2041},{"style":573},[2042],{"type":433,"value":576},{"type":427,"tag":518,"props":2044,"children":2045},{"style":573},[2046],{"type":433,"value":2047}," {",{"type":427,"tag":518,"props":2049,"children":2050},{"style":803},[2051],{"type":433,"value":2052},"                                                \\\n",{"type":427,"tag":518,"props":2054,"children":2055},{"class":520,"line":765},[2056,2061,2065,2069,2073,2077,2081,2086,2091],{"type":427,"tag":518,"props":2057,"children":2058},{"style":567},[2059],{"type":433,"value":2060},"    TCONCAT",{"type":427,"tag":518,"props":2062,"children":2063},{"style":573},[2064],{"type":433,"value":655},{"type":427,"tag":518,"props":2066,"children":2067},{"style":778},[2068],{"type":433,"value":1952},{"type":427,"tag":518,"props":2070,"children":2071},{"style":573},[2072],{"type":433,"value":665},{"type":427,"tag":518,"props":2074,"children":2075},{"style":778},[2076],{"type":433,"value":1921},{"type":427,"tag":518,"props":2078,"children":2079},{"style":573},[2080],{"type":433,"value":1222},{"type":427,"tag":518,"props":2082,"children":2083},{"style":778},[2084],{"type":433,"value":2085}," t",{"type":427,"tag":518,"props":2087,"children":2088},{"style":573},[2089],{"type":433,"value":2090},";",{"type":427,"tag":518,"props":2092,"children":2093},{"style":803},[2094],{"type":433,"value":2095},"                                             \\\n",{"type":427,"tag":518,"props":2097,"children":2098},{"class":520,"line":846},[2099,2104,2108,2113,2117],{"type":427,"tag":518,"props":2100,"children":2101},{"style":599},[2102],{"type":433,"value":2103},"    t",{"type":427,"tag":518,"props":2105,"children":2106},{"style":573},[2107],{"type":433,"value":710},{"type":427,"tag":518,"props":2109,"children":2110},{"style":567},[2111],{"type":433,"value":2112},"_Run",{"type":427,"tag":518,"props":2114,"children":2115},{"style":573},[2116],{"type":433,"value":2014},{"type":427,"tag":518,"props":2118,"children":2119},{"style":803},[2120],{"type":433,"value":2121},"                                                           \\\n",{"type":427,"tag":518,"props":2123,"children":2124},{"class":520,"line":869},[2125,2129],{"type":427,"tag":518,"props":2126,"children":2127},{"style":573},[2128],{"type":433,"value":1275},{"type":427,"tag":518,"props":2130,"children":2131},{"style":803},[2132],{"type":433,"value":2133},"                                                                     \\\n",{"type":427,"tag":518,"props":2135,"children":2136},{"class":520,"line":878},[2137,2142],{"type":427,"tag":518,"props":2138,"children":2139},{"style":573},[2140],{"type":433,"value":2141},"};",{"type":427,"tag":518,"props":2143,"children":2144},{"style":803},[2145],{"type":433,"value":2146},"                                                                      \\\n",{"type":427,"tag":518,"props":2148,"children":2149},{"class":520,"line":886},[2150,2155,2159,2163,2168,2172,2176,2180,2185],{"type":427,"tag":518,"props":2151,"children":2152},{"style":561},[2153],{"type":433,"value":2154},"bool",{"type":427,"tag":518,"props":2156,"children":2157},{"style":567},[2158],{"type":433,"value":1943},{"type":427,"tag":518,"props":2160,"children":2161},{"style":573},[2162],{"type":433,"value":655},{"type":427,"tag":518,"props":2164,"children":2165},{"style":588},[2166],{"type":433,"value":2167},"_Test_ignored_",{"type":427,"tag":518,"props":2169,"children":2170},{"style":573},[2171],{"type":433,"value":665},{"type":427,"tag":518,"props":2173,"children":2174},{"style":588},[2175],{"type":433,"value":1921},{"type":427,"tag":518,"props":2177,"children":2178},{"style":573},[2179],{"type":433,"value":1222},{"type":427,"tag":518,"props":2181,"children":2182},{"style":697},[2183],{"type":433,"value":2184}," =",{"type":427,"tag":518,"props":2186,"children":2187},{"style":803},[2188],{"type":433,"value":2189},"                                     \\\n",{"type":427,"tag":518,"props":2191,"children":2192},{"class":520,"line":929},[2193,2198,2203,2207,2211,2215,2220,2224,2229,2233,2238,2242,2246,2251,2255,2259,2263,2267,2271,2276,2280],{"type":427,"tag":518,"props":2194,"children":2195},{"style":599},[2196],{"type":433,"value":2197},"  ::",{"type":427,"tag":518,"props":2199,"children":2200},{"style":588},[2201],{"type":433,"value":2202},"kdb",{"type":427,"tag":518,"props":2204,"children":2205},{"style":573},[2206],{"type":433,"value":596},{"type":427,"tag":518,"props":2208,"children":2209},{"style":588},[2210],{"type":433,"value":1804},{"type":427,"tag":518,"props":2212,"children":2213},{"style":573},[2214],{"type":433,"value":596},{"type":427,"tag":518,"props":2216,"children":2217},{"style":567},[2218],{"type":433,"value":2219},"RegisterTest",{"type":427,"tag":518,"props":2221,"children":2222},{"style":573},[2223],{"type":433,"value":655},{"type":427,"tag":518,"props":2225,"children":2226},{"style":599},[2227],{"type":433,"value":2228},"#base",{"type":427,"tag":518,"props":2230,"children":2231},{"style":573},[2232],{"type":433,"value":665},{"type":427,"tag":518,"props":2234,"children":2235},{"style":599},[2236],{"type":433,"value":2237}," #name",{"type":427,"tag":518,"props":2239,"children":2240},{"style":573},[2241],{"type":433,"value":665},{"type":427,"tag":518,"props":2243,"children":2244},{"style":697},[2245],{"type":433,"value":1153},{"type":427,"tag":518,"props":2247,"children":2248},{"style":567},[2249],{"type":433,"value":2250},"TCONCAT",{"type":427,"tag":518,"props":2252,"children":2253},{"style":573},[2254],{"type":433,"value":655},{"type":427,"tag":518,"props":2256,"children":2257},{"style":599},[2258],{"type":433,"value":1952},{"type":427,"tag":518,"props":2260,"children":2261},{"style":573},[2262],{"type":433,"value":665},{"type":427,"tag":518,"props":2264,"children":2265},{"style":599},[2266],{"type":433,"value":1921},{"type":427,"tag":518,"props":2268,"children":2269},{"style":573},[2270],{"type":433,"value":1222},{"type":427,"tag":518,"props":2272,"children":2273},{"style":599},[2274],{"type":433,"value":2275},"::_RunIt",{"type":427,"tag":518,"props":2277,"children":2278},{"style":573},[2279],{"type":433,"value":1261},{"type":427,"tag":518,"props":2281,"children":2282},{"style":803},[2283],{"type":433,"value":2284}," \\\n",{"type":427,"tag":441,"props":2286,"children":2287},{},[2288],{"type":433,"value":2289},"可是，既然有 TCONCAT，为什么还要定义一个 TCONCAT1 宏呢？",{"type":427,"tag":507,"props":2291,"children":2293},{"code":2292,"language":510,"meta":421,"className":511,"style":421},"#define TCONCAT(a,b) TCONCAT1(a,b)\n#define TCONCAT1(a,b) a##b\n",[2294],{"type":427,"tag":514,"props":2295,"children":2296},{"__ignoreMap":421},[2297,2355],{"type":427,"tag":518,"props":2298,"children":2299},{"class":520,"line":521},[2300,2304,2308,2312,2316,2320,2325,2329,2334,2338,2342,2346,2350],{"type":427,"tag":518,"props":2301,"children":2302},{"style":525},[2303],{"type":433,"value":1898},{"type":427,"tag":518,"props":2305,"children":2306},{"style":567},[2307],{"type":433,"value":1943},{"type":427,"tag":518,"props":2309,"children":2310},{"style":573},[2311],{"type":433,"value":655},{"type":427,"tag":518,"props":2313,"children":2314},{"style":1434},[2315],{"type":433,"value":452},{"type":427,"tag":518,"props":2317,"children":2318},{"style":573},[2319],{"type":433,"value":665},{"type":427,"tag":518,"props":2321,"children":2322},{"style":1434},[2323],{"type":433,"value":2324},"b",{"type":427,"tag":518,"props":2326,"children":2327},{"style":573},[2328],{"type":433,"value":1222},{"type":427,"tag":518,"props":2330,"children":2331},{"style":567},[2332],{"type":433,"value":2333}," TCONCAT1",{"type":427,"tag":518,"props":2335,"children":2336},{"style":573},[2337],{"type":433,"value":655},{"type":427,"tag":518,"props":2339,"children":2340},{"style":599},[2341],{"type":433,"value":452},{"type":427,"tag":518,"props":2343,"children":2344},{"style":573},[2345],{"type":433,"value":665},{"type":427,"tag":518,"props":2347,"children":2348},{"style":599},[2349],{"type":433,"value":2324},{"type":427,"tag":518,"props":2351,"children":2352},{"style":573},[2353],{"type":433,"value":2354},")\n",{"type":427,"tag":518,"props":2356,"children":2357},{"class":520,"line":548},[2358,2362,2366,2370,2374,2378,2382,2386],{"type":427,"tag":518,"props":2359,"children":2360},{"style":525},[2361],{"type":433,"value":1898},{"type":427,"tag":518,"props":2363,"children":2364},{"style":567},[2365],{"type":433,"value":2333},{"type":427,"tag":518,"props":2367,"children":2368},{"style":573},[2369],{"type":433,"value":655},{"type":427,"tag":518,"props":2371,"children":2372},{"style":1434},[2373],{"type":433,"value":452},{"type":427,"tag":518,"props":2375,"children":2376},{"style":573},[2377],{"type":433,"value":665},{"type":427,"tag":518,"props":2379,"children":2380},{"style":1434},[2381],{"type":433,"value":2324},{"type":427,"tag":518,"props":2383,"children":2384},{"style":573},[2385],{"type":433,"value":1222},{"type":427,"tag":518,"props":2387,"children":2388},{"style":599},[2389],{"type":433,"value":2390}," a##b\n",{"type":427,"tag":441,"props":2392,"children":2393},{},[2394],{"type":433,"value":2395},"这就要提到宏的一个特殊规则了，如果宏参数使用了字符串化运算符（#）或标记黏贴运算符（##），那么即便参数是宏也不会展开。所以需要一个间接宏 TCONCAT1，以达到先展开参数（如果参数是宏的化），再调用标记黏贴运算符的目的。从 test_db 可以看到，测试类的名词都不是宏，所以这里本不需要 TCONCAT1 这个间接宏。但是考虑到程序的健壮性，加上更好。",{"type":427,"tag":1394,"props":2397,"children":2399},{"id":2398},"断言宏",[2400],{"type":433,"value":2398},{"type":427,"tag":441,"props":2402,"children":2403},{},[2404],{"type":433,"value":2405},"测试代码中的断言也是使用的宏来定义的。相比 TCONCAT 简单很多了，但其特点是可以记录抛错的文件以及行号。以下代码实现了 ASSERT_EQ 的定义。Tester 用于记录宏展开时所在的文件 __FILE__、行号 __LINE__ 以及断言结果。一但断言失败，记录到 ok_ 成员变量中。在 Tester 析构时，会把相关信息一并打印出来。",{"type":427,"tag":507,"props":2407,"children":2409},{"code":2408,"language":510,"meta":421,"className":511,"style":421},"class Tester {\n#define BINARY_OP(name,op)                              \\\n  template \u003Cclass X, class Y>                           \\\n  Tester& name(const X& x, const Y& y) {                \\\n    if (! (x op y)) {                                   \\\n      ss_ \u003C\u003C \" failed: \" \u003C\u003C x \u003C\u003C (\" \" #op \" \") \u003C\u003C y;    \\\n      ok_ = false;                                      \\\n    }                                                   \\\n    return *this;                                       \\\n  }\n  BINARY_OP(IsEq, ==)\n#undef BINARY_OP\n}\n#define ASSERT_EQ(a,b) ::kdb::test::Tester(__FILE__, __LINE__).IsEq((a),(b))\n",[2410],{"type":427,"tag":514,"props":2411,"children":2412},{"__ignoreMap":421},[2413,2429,2466,2511,2586,2625,2711,2738,2751,2778,2785,2815,2828,2835],{"type":427,"tag":518,"props":2414,"children":2415},{"class":520,"line":521},[2416,2420,2425],{"type":427,"tag":518,"props":2417,"children":2418},{"style":561},[2419],{"type":433,"value":1938},{"type":427,"tag":518,"props":2421,"children":2422},{"style":588},[2423],{"type":433,"value":2424}," Tester",{"type":427,"tag":518,"props":2426,"children":2427},{"style":573},[2428],{"type":433,"value":581},{"type":427,"tag":518,"props":2430,"children":2431},{"class":520,"line":548},[2432,2436,2441,2445,2449,2453,2458,2462],{"type":427,"tag":518,"props":2433,"children":2434},{"style":525},[2435],{"type":433,"value":1898},{"type":427,"tag":518,"props":2437,"children":2438},{"style":567},[2439],{"type":433,"value":2440}," BINARY_OP",{"type":427,"tag":518,"props":2442,"children":2443},{"style":573},[2444],{"type":433,"value":655},{"type":427,"tag":518,"props":2446,"children":2447},{"style":1434},[2448],{"type":433,"value":1921},{"type":427,"tag":518,"props":2450,"children":2451},{"style":573},[2452],{"type":433,"value":665},{"type":427,"tag":518,"props":2454,"children":2455},{"style":1434},[2456],{"type":433,"value":2457},"op",{"type":427,"tag":518,"props":2459,"children":2460},{"style":573},[2461],{"type":433,"value":1222},{"type":427,"tag":518,"props":2463,"children":2464},{"style":803},[2465],{"type":433,"value":1979},{"type":427,"tag":518,"props":2467,"children":2468},{"class":520,"line":557},[2469,2474,2478,2482,2487,2491,2496,2501,2506],{"type":427,"tag":518,"props":2470,"children":2471},{"style":561},[2472],{"type":433,"value":2473},"  template",{"type":427,"tag":518,"props":2475,"children":2476},{"style":573},[2477],{"type":433,"value":534},{"type":427,"tag":518,"props":2479,"children":2480},{"style":561},[2481],{"type":433,"value":1938},{"type":427,"tag":518,"props":2483,"children":2484},{"style":588},[2485],{"type":433,"value":2486}," X",{"type":427,"tag":518,"props":2488,"children":2489},{"style":573},[2490],{"type":433,"value":665},{"type":427,"tag":518,"props":2492,"children":2493},{"style":561},[2494],{"type":433,"value":2495}," class",{"type":427,"tag":518,"props":2497,"children":2498},{"style":588},[2499],{"type":433,"value":2500}," Y",{"type":427,"tag":518,"props":2502,"children":2503},{"style":573},[2504],{"type":433,"value":2505},">",{"type":427,"tag":518,"props":2507,"children":2508},{"style":803},[2509],{"type":433,"value":2510},"                           \\\n",{"type":427,"tag":518,"props":2512,"children":2513},{"class":520,"line":584},[2514,2519,2524,2529,2533,2538,2542,2546,2551,2555,2560,2564,2568,2573,2577,2581],{"type":427,"tag":518,"props":2515,"children":2516},{"style":588},[2517],{"type":433,"value":2518},"  Tester",{"type":427,"tag":518,"props":2520,"children":2521},{"style":2025},[2522],{"type":433,"value":2523},"&",{"type":427,"tag":518,"props":2525,"children":2526},{"style":567},[2527],{"type":433,"value":2528}," name",{"type":427,"tag":518,"props":2530,"children":2531},{"style":573},[2532],{"type":433,"value":655},{"type":427,"tag":518,"props":2534,"children":2535},{"style":2025},[2536],{"type":433,"value":2537},"const",{"type":427,"tag":518,"props":2539,"children":2540},{"style":588},[2541],{"type":433,"value":2486},{"type":427,"tag":518,"props":2543,"children":2544},{"style":2025},[2545],{"type":433,"value":2523},{"type":427,"tag":518,"props":2547,"children":2548},{"style":1434},[2549],{"type":433,"value":2550}," x",{"type":427,"tag":518,"props":2552,"children":2553},{"style":573},[2554],{"type":433,"value":665},{"type":427,"tag":518,"props":2556,"children":2557},{"style":2025},[2558],{"type":433,"value":2559}," const",{"type":427,"tag":518,"props":2561,"children":2562},{"style":588},[2563],{"type":433,"value":2500},{"type":427,"tag":518,"props":2565,"children":2566},{"style":2025},[2567],{"type":433,"value":2523},{"type":427,"tag":518,"props":2569,"children":2570},{"style":1434},[2571],{"type":433,"value":2572}," y",{"type":427,"tag":518,"props":2574,"children":2575},{"style":573},[2576],{"type":433,"value":1222},{"type":427,"tag":518,"props":2578,"children":2579},{"style":573},[2580],{"type":433,"value":2047},{"type":427,"tag":518,"props":2582,"children":2583},{"style":803},[2584],{"type":433,"value":2585},"                \\\n",{"type":427,"tag":518,"props":2587,"children":2588},{"class":520,"line":610},[2589,2594,2598,2602,2606,2611,2616,2620],{"type":427,"tag":518,"props":2590,"children":2591},{"style":525},[2592],{"type":433,"value":2593},"    if",{"type":427,"tag":518,"props":2595,"children":2596},{"style":573},[2597],{"type":433,"value":734},{"type":427,"tag":518,"props":2599,"children":2600},{"style":697},[2601],{"type":433,"value":739},{"type":427,"tag":518,"props":2603,"children":2604},{"style":573},[2605],{"type":433,"value":734},{"type":427,"tag":518,"props":2607,"children":2608},{"style":778},[2609],{"type":433,"value":2610},"x op y",{"type":427,"tag":518,"props":2612,"children":2613},{"style":573},[2614],{"type":433,"value":2615},"))",{"type":427,"tag":518,"props":2617,"children":2618},{"style":573},[2619],{"type":433,"value":2047},{"type":427,"tag":518,"props":2621,"children":2622},{"style":803},[2623],{"type":433,"value":2624},"                                   \\\n",{"type":427,"tag":518,"props":2626,"children":2627},{"class":520,"line":631},[2628,2633,2638,2642,2647,2651,2656,2661,2665,2669,2673,2677,2682,2686,2690,2694,2698,2702,2706],{"type":427,"tag":518,"props":2629,"children":2630},{"style":778},[2631],{"type":433,"value":2632},"      ss_ ",{"type":427,"tag":518,"props":2634,"children":2635},{"style":697},[2636],{"type":433,"value":2637},"\u003C\u003C",{"type":427,"tag":518,"props":2639,"children":2640},{"style":531},[2641],{"type":433,"value":670},{"type":427,"tag":518,"props":2643,"children":2644},{"style":537},[2645],{"type":433,"value":2646}," failed: ",{"type":427,"tag":518,"props":2648,"children":2649},{"style":531},[2650],{"type":433,"value":680},{"type":427,"tag":518,"props":2652,"children":2653},{"style":697},[2654],{"type":433,"value":2655}," \u003C\u003C",{"type":427,"tag":518,"props":2657,"children":2658},{"style":778},[2659],{"type":433,"value":2660}," x ",{"type":427,"tag":518,"props":2662,"children":2663},{"style":697},[2664],{"type":433,"value":2637},{"type":427,"tag":518,"props":2666,"children":2667},{"style":573},[2668],{"type":433,"value":734},{"type":427,"tag":518,"props":2670,"children":2671},{"style":531},[2672],{"type":433,"value":680},{"type":427,"tag":518,"props":2674,"children":2675},{"style":531},[2676],{"type":433,"value":670},{"type":427,"tag":518,"props":2678,"children":2679},{"style":599},[2680],{"type":433,"value":2681}," #op",{"type":427,"tag":518,"props":2683,"children":2684},{"style":531},[2685],{"type":433,"value":670},{"type":427,"tag":518,"props":2687,"children":2688},{"style":531},[2689],{"type":433,"value":670},{"type":427,"tag":518,"props":2691,"children":2692},{"style":573},[2693],{"type":433,"value":1222},{"type":427,"tag":518,"props":2695,"children":2696},{"style":697},[2697],{"type":433,"value":2655},{"type":427,"tag":518,"props":2699,"children":2700},{"style":778},[2701],{"type":433,"value":2572},{"type":427,"tag":518,"props":2703,"children":2704},{"style":573},[2705],{"type":433,"value":2090},{"type":427,"tag":518,"props":2707,"children":2708},{"style":803},[2709],{"type":433,"value":2710},"    \\\n",{"type":427,"tag":518,"props":2712,"children":2713},{"class":520,"line":688},[2714,2719,2723,2729,2733],{"type":427,"tag":518,"props":2715,"children":2716},{"style":778},[2717],{"type":433,"value":2718},"      ok_ ",{"type":427,"tag":518,"props":2720,"children":2721},{"style":697},[2722],{"type":433,"value":700},{"type":427,"tag":518,"props":2724,"children":2726},{"style":2725},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[2727],{"type":433,"value":2728}," false",{"type":427,"tag":518,"props":2730,"children":2731},{"style":573},[2732],{"type":433,"value":2090},{"type":427,"tag":518,"props":2734,"children":2735},{"style":803},[2736],{"type":433,"value":2737},"                                      \\\n",{"type":427,"tag":518,"props":2739,"children":2740},{"class":520,"line":723},[2741,2746],{"type":427,"tag":518,"props":2742,"children":2743},{"style":573},[2744],{"type":433,"value":2745},"    }",{"type":427,"tag":518,"props":2747,"children":2748},{"style":803},[2749],{"type":433,"value":2750},"                                                   \\\n",{"type":427,"tag":518,"props":2752,"children":2753},{"class":520,"line":765},[2754,2759,2763,2769,2773],{"type":427,"tag":518,"props":2755,"children":2756},{"style":525},[2757],{"type":433,"value":2758},"    return",{"type":427,"tag":518,"props":2760,"children":2761},{"style":697},[2762],{"type":433,"value":1484},{"type":427,"tag":518,"props":2764,"children":2766},{"style":2765},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[2767],{"type":433,"value":2768},"this",{"type":427,"tag":518,"props":2770,"children":2771},{"style":573},[2772],{"type":433,"value":2090},{"type":427,"tag":518,"props":2774,"children":2775},{"style":803},[2776],{"type":433,"value":2777},"                                       \\\n",{"type":427,"tag":518,"props":2779,"children":2780},{"class":520,"line":846},[2781],{"type":427,"tag":518,"props":2782,"children":2783},{"style":573},[2784],{"type":433,"value":875},{"type":427,"tag":518,"props":2786,"children":2787},{"class":520,"line":869},[2788,2793,2797,2802,2806,2811],{"type":427,"tag":518,"props":2789,"children":2790},{"style":567},[2791],{"type":433,"value":2792},"  BINARY_OP",{"type":427,"tag":518,"props":2794,"children":2795},{"style":573},[2796],{"type":433,"value":655},{"type":427,"tag":518,"props":2798,"children":2799},{"style":588},[2800],{"type":433,"value":2801},"IsEq",{"type":427,"tag":518,"props":2803,"children":2804},{"style":573},[2805],{"type":433,"value":665},{"type":427,"tag":518,"props":2807,"children":2808},{"style":697},[2809],{"type":433,"value":2810}," ==",{"type":427,"tag":518,"props":2812,"children":2813},{"style":573},[2814],{"type":433,"value":2354},{"type":427,"tag":518,"props":2816,"children":2817},{"class":520,"line":878},[2818,2823],{"type":427,"tag":518,"props":2819,"children":2820},{"style":525},[2821],{"type":433,"value":2822},"#undef",{"type":427,"tag":518,"props":2824,"children":2825},{"style":567},[2826],{"type":433,"value":2827}," BINARY_OP\n",{"type":427,"tag":518,"props":2829,"children":2830},{"class":520,"line":886},[2831],{"type":427,"tag":518,"props":2832,"children":2833},{"style":778},[2834],{"type":433,"value":1364},{"type":427,"tag":518,"props":2836,"children":2837},{"class":520,"line":929},[2838,2842,2847,2851,2855,2859,2863,2867,2872,2876,2880,2884,2888,2893,2897,2903,2907,2912,2917,2921,2926,2930,2935,2939],{"type":427,"tag":518,"props":2839,"children":2840},{"style":525},[2841],{"type":433,"value":1898},{"type":427,"tag":518,"props":2843,"children":2844},{"style":567},[2845],{"type":433,"value":2846}," ASSERT_EQ",{"type":427,"tag":518,"props":2848,"children":2849},{"style":573},[2850],{"type":433,"value":655},{"type":427,"tag":518,"props":2852,"children":2853},{"style":1434},[2854],{"type":433,"value":452},{"type":427,"tag":518,"props":2856,"children":2857},{"style":573},[2858],{"type":433,"value":665},{"type":427,"tag":518,"props":2860,"children":2861},{"style":1434},[2862],{"type":433,"value":2324},{"type":427,"tag":518,"props":2864,"children":2865},{"style":573},[2866],{"type":433,"value":1222},{"type":427,"tag":518,"props":2868,"children":2869},{"style":778},[2870],{"type":433,"value":2871}," ::",{"type":427,"tag":518,"props":2873,"children":2874},{"style":588},[2875],{"type":433,"value":2202},{"type":427,"tag":518,"props":2877,"children":2878},{"style":573},[2879],{"type":433,"value":596},{"type":427,"tag":518,"props":2881,"children":2882},{"style":588},[2883],{"type":433,"value":1804},{"type":427,"tag":518,"props":2885,"children":2886},{"style":573},[2887],{"type":433,"value":596},{"type":427,"tag":518,"props":2889,"children":2890},{"style":567},[2891],{"type":433,"value":2892},"Tester",{"type":427,"tag":518,"props":2894,"children":2895},{"style":573},[2896],{"type":433,"value":655},{"type":427,"tag":518,"props":2898,"children":2900},{"style":2899},"--shiki-light:#E2931D;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#F8F8F2",[2901],{"type":433,"value":2902},"__FILE__",{"type":427,"tag":518,"props":2904,"children":2905},{"style":573},[2906],{"type":433,"value":665},{"type":427,"tag":518,"props":2908,"children":2909},{"style":2899},[2910],{"type":433,"value":2911}," __LINE__",{"type":427,"tag":518,"props":2913,"children":2914},{"style":573},[2915],{"type":433,"value":2916},").",{"type":427,"tag":518,"props":2918,"children":2919},{"style":567},[2920],{"type":433,"value":2801},{"type":427,"tag":518,"props":2922,"children":2923},{"style":573},[2924],{"type":433,"value":2925},"((",{"type":427,"tag":518,"props":2927,"children":2928},{"style":778},[2929],{"type":433,"value":452},{"type":427,"tag":518,"props":2931,"children":2932},{"style":573},[2933],{"type":433,"value":2934},"),(",{"type":427,"tag":518,"props":2936,"children":2937},{"style":778},[2938],{"type":433,"value":2324},{"type":427,"tag":518,"props":2940,"children":2941},{"style":573},[2942],{"type":433,"value":2943},"))\n",{"type":427,"tag":1394,"props":2945,"children":2947},{"id":2946},"stringrepeatntimes",[2948],{"type":433,"value":2949},"string.repeat(ntimes)",{"type":427,"tag":441,"props":2951,"children":2952},{},[2953],{"type":433,"value":2954},"写 JavaScript 时经常用到 String 的原型方法 repeat，用来把 n 个内容重复的字符串拼接为一个新字符串。也许是 C++ 标准库没有提供相应的算法，KDB 使用了一种和 repeat 完全不一样的处理思路。KDB 使用 StringStream 填充一定位数内容，还可以不用考虑值的长度。",{"type":427,"tag":507,"props":2956,"children":2958},{"code":2957,"language":510,"meta":421,"className":511,"style":421},"std::stringstream ss;\nss \u003C\u003C std::setfill ('0') \u003C\u003C std::setw (16);\nss \u003C\u003C 1;\nss.str(); // result is: \"0000000000000001\"\nss \u003C\u003C std::setfill ('0') \u003C\u003C std::setw (16);\nss \u003C\u003C 1123;\nss.str(); // result is: \"0000000000001123\"\n",[2959],{"type":427,"tag":514,"props":2960,"children":2961},{"__ignoreMap":421},[2962,2983,3061,3081,3107,3178,3198],{"type":427,"tag":518,"props":2963,"children":2964},{"class":520,"line":521},[2965,2970,2974,2979],{"type":427,"tag":518,"props":2966,"children":2967},{"style":588},[2968],{"type":433,"value":2969},"std",{"type":427,"tag":518,"props":2971,"children":2972},{"style":573},[2973],{"type":433,"value":596},{"type":427,"tag":518,"props":2975,"children":2976},{"style":599},[2977],{"type":433,"value":2978},"stringstream ss",{"type":427,"tag":518,"props":2980,"children":2981},{"style":573},[2982],{"type":433,"value":607},{"type":427,"tag":518,"props":2984,"children":2985},{"class":520,"line":548},[2986,2991,2995,3000,3004,3009,3013,3018,3023,3027,3031,3035,3039,3043,3048,3052,3057],{"type":427,"tag":518,"props":2987,"children":2988},{"style":599},[2989],{"type":433,"value":2990},"ss ",{"type":427,"tag":518,"props":2992,"children":2993},{"style":697},[2994],{"type":433,"value":2637},{"type":427,"tag":518,"props":2996,"children":2997},{"style":588},[2998],{"type":433,"value":2999}," std",{"type":427,"tag":518,"props":3001,"children":3002},{"style":573},[3003],{"type":433,"value":596},{"type":427,"tag":518,"props":3005,"children":3006},{"style":567},[3007],{"type":433,"value":3008},"setfill",{"type":427,"tag":518,"props":3010,"children":3011},{"style":573},[3012],{"type":433,"value":734},{"type":427,"tag":518,"props":3014,"children":3015},{"style":531},[3016],{"type":433,"value":3017},"'",{"type":427,"tag":518,"props":3019,"children":3020},{"style":537},[3021],{"type":433,"value":3022},"0",{"type":427,"tag":518,"props":3024,"children":3025},{"style":531},[3026],{"type":433,"value":3017},{"type":427,"tag":518,"props":3028,"children":3029},{"style":573},[3030],{"type":433,"value":1222},{"type":427,"tag":518,"props":3032,"children":3033},{"style":697},[3034],{"type":433,"value":2655},{"type":427,"tag":518,"props":3036,"children":3037},{"style":588},[3038],{"type":433,"value":2999},{"type":427,"tag":518,"props":3040,"children":3041},{"style":573},[3042],{"type":433,"value":596},{"type":427,"tag":518,"props":3044,"children":3045},{"style":567},[3046],{"type":433,"value":3047},"setw",{"type":427,"tag":518,"props":3049,"children":3050},{"style":573},[3051],{"type":433,"value":734},{"type":427,"tag":518,"props":3053,"children":3054},{"style":859},[3055],{"type":433,"value":3056},"16",{"type":427,"tag":518,"props":3058,"children":3059},{"style":573},[3060],{"type":433,"value":685},{"type":427,"tag":518,"props":3062,"children":3063},{"class":520,"line":557},[3064,3068,3072,3077],{"type":427,"tag":518,"props":3065,"children":3066},{"style":599},[3067],{"type":433,"value":2990},{"type":427,"tag":518,"props":3069,"children":3070},{"style":697},[3071],{"type":433,"value":2637},{"type":427,"tag":518,"props":3073,"children":3074},{"style":859},[3075],{"type":433,"value":3076}," 1",{"type":427,"tag":518,"props":3078,"children":3079},{"style":573},[3080],{"type":433,"value":607},{"type":427,"tag":518,"props":3082,"children":3083},{"class":520,"line":584},[3084,3089,3093,3098,3102],{"type":427,"tag":518,"props":3085,"children":3086},{"style":599},[3087],{"type":433,"value":3088},"ss",{"type":427,"tag":518,"props":3090,"children":3091},{"style":573},[3092],{"type":433,"value":710},{"type":427,"tag":518,"props":3094,"children":3095},{"style":567},[3096],{"type":433,"value":3097},"str",{"type":427,"tag":518,"props":3099,"children":3100},{"style":573},[3101],{"type":433,"value":2014},{"type":427,"tag":518,"props":3103,"children":3104},{"style":1527},[3105],{"type":433,"value":3106}," // result is: \"0000000000000001\"\n",{"type":427,"tag":518,"props":3108,"children":3109},{"class":520,"line":610},[3110,3114,3118,3122,3126,3130,3134,3138,3142,3146,3150,3154,3158,3162,3166,3170,3174],{"type":427,"tag":518,"props":3111,"children":3112},{"style":599},[3113],{"type":433,"value":2990},{"type":427,"tag":518,"props":3115,"children":3116},{"style":697},[3117],{"type":433,"value":2637},{"type":427,"tag":518,"props":3119,"children":3120},{"style":588},[3121],{"type":433,"value":2999},{"type":427,"tag":518,"props":3123,"children":3124},{"style":573},[3125],{"type":433,"value":596},{"type":427,"tag":518,"props":3127,"children":3128},{"style":567},[3129],{"type":433,"value":3008},{"type":427,"tag":518,"props":3131,"children":3132},{"style":573},[3133],{"type":433,"value":734},{"type":427,"tag":518,"props":3135,"children":3136},{"style":531},[3137],{"type":433,"value":3017},{"type":427,"tag":518,"props":3139,"children":3140},{"style":537},[3141],{"type":433,"value":3022},{"type":427,"tag":518,"props":3143,"children":3144},{"style":531},[3145],{"type":433,"value":3017},{"type":427,"tag":518,"props":3147,"children":3148},{"style":573},[3149],{"type":433,"value":1222},{"type":427,"tag":518,"props":3151,"children":3152},{"style":697},[3153],{"type":433,"value":2655},{"type":427,"tag":518,"props":3155,"children":3156},{"style":588},[3157],{"type":433,"value":2999},{"type":427,"tag":518,"props":3159,"children":3160},{"style":573},[3161],{"type":433,"value":596},{"type":427,"tag":518,"props":3163,"children":3164},{"style":567},[3165],{"type":433,"value":3047},{"type":427,"tag":518,"props":3167,"children":3168},{"style":573},[3169],{"type":433,"value":734},{"type":427,"tag":518,"props":3171,"children":3172},{"style":859},[3173],{"type":433,"value":3056},{"type":427,"tag":518,"props":3175,"children":3176},{"style":573},[3177],{"type":433,"value":685},{"type":427,"tag":518,"props":3179,"children":3180},{"class":520,"line":631},[3181,3185,3189,3194],{"type":427,"tag":518,"props":3182,"children":3183},{"style":599},[3184],{"type":433,"value":2990},{"type":427,"tag":518,"props":3186,"children":3187},{"style":697},[3188],{"type":433,"value":2637},{"type":427,"tag":518,"props":3190,"children":3191},{"style":859},[3192],{"type":433,"value":3193}," 1123",{"type":427,"tag":518,"props":3195,"children":3196},{"style":573},[3197],{"type":433,"value":607},{"type":427,"tag":518,"props":3199,"children":3200},{"class":520,"line":688},[3201,3205,3209,3213,3217],{"type":427,"tag":518,"props":3202,"children":3203},{"style":599},[3204],{"type":433,"value":3088},{"type":427,"tag":518,"props":3206,"children":3207},{"style":573},[3208],{"type":433,"value":710},{"type":427,"tag":518,"props":3210,"children":3211},{"style":567},[3212],{"type":433,"value":3097},{"type":427,"tag":518,"props":3214,"children":3215},{"style":573},[3216],{"type":433,"value":2014},{"type":427,"tag":518,"props":3218,"children":3219},{"style":1527},[3220],{"type":433,"value":3221}," // result is: \"0000000000001123\"\n",{"type":427,"tag":1394,"props":3223,"children":3225},{"id":3224},"c-风格的随机数",[3226],{"type":433,"value":3227},"C++ 风格的随机数",{"type":427,"tag":441,"props":3229,"children":3230},{},[3231],{"type":433,"value":3232},"一个有意思的地方时，KDB 代码中随处可见 C 编程风格的源码。但是测试用例中生成随机数确实 C++ 风格的。",{"type":427,"tag":507,"props":3234,"children":3236},{"code":3235,"language":510,"meta":421,"className":511,"style":421},"std::mt19937 generator = std::mt19937();\nstd::uniform_int_distribution\u003Cint> random_dist(0,255);\n// ...\nfor (int i = 0; i \u003C size; i++) {\n  str[i] = static_cast\u003Cchar>(random_dist(generator));\n}\n",[3237],{"type":427,"tag":514,"props":3238,"children":3239},{"__ignoreMap":421},[3240,3277,3332,3340,3408,3471],{"type":427,"tag":518,"props":3241,"children":3242},{"class":520,"line":521},[3243,3247,3251,3256,3260,3264,3268,3273],{"type":427,"tag":518,"props":3244,"children":3245},{"style":588},[3246],{"type":433,"value":2969},{"type":427,"tag":518,"props":3248,"children":3249},{"style":573},[3250],{"type":433,"value":596},{"type":427,"tag":518,"props":3252,"children":3253},{"style":599},[3254],{"type":433,"value":3255},"mt19937 generator ",{"type":427,"tag":518,"props":3257,"children":3258},{"style":697},[3259],{"type":433,"value":700},{"type":427,"tag":518,"props":3261,"children":3262},{"style":588},[3263],{"type":433,"value":2999},{"type":427,"tag":518,"props":3265,"children":3266},{"style":573},[3267],{"type":433,"value":596},{"type":427,"tag":518,"props":3269,"children":3270},{"style":567},[3271],{"type":433,"value":3272},"mt19937",{"type":427,"tag":518,"props":3274,"children":3275},{"style":573},[3276],{"type":433,"value":720},{"type":427,"tag":518,"props":3278,"children":3279},{"class":520,"line":548},[3280,3284,3288,3293,3298,3302,3306,3311,3315,3319,3323,3328],{"type":427,"tag":518,"props":3281,"children":3282},{"style":588},[3283],{"type":433,"value":2969},{"type":427,"tag":518,"props":3285,"children":3286},{"style":573},[3287],{"type":433,"value":596},{"type":427,"tag":518,"props":3289,"children":3290},{"style":588},[3291],{"type":433,"value":3292},"uniform_int_distribution",{"type":427,"tag":518,"props":3294,"children":3295},{"style":573},[3296],{"type":433,"value":3297},"\u003C",{"type":427,"tag":518,"props":3299,"children":3300},{"style":561},[3301],{"type":433,"value":564},{"type":427,"tag":518,"props":3303,"children":3304},{"style":573},[3305],{"type":433,"value":2505},{"type":427,"tag":518,"props":3307,"children":3308},{"style":567},[3309],{"type":433,"value":3310}," random_dist",{"type":427,"tag":518,"props":3312,"children":3313},{"style":573},[3314],{"type":433,"value":655},{"type":427,"tag":518,"props":3316,"children":3317},{"style":859},[3318],{"type":433,"value":3022},{"type":427,"tag":518,"props":3320,"children":3321},{"style":573},[3322],{"type":433,"value":665},{"type":427,"tag":518,"props":3324,"children":3325},{"style":859},[3326],{"type":433,"value":3327},"255",{"type":427,"tag":518,"props":3329,"children":3330},{"style":573},[3331],{"type":433,"value":685},{"type":427,"tag":518,"props":3333,"children":3334},{"class":520,"line":557},[3335],{"type":427,"tag":518,"props":3336,"children":3337},{"style":1527},[3338],{"type":433,"value":3339},"// ...\n",{"type":427,"tag":518,"props":3341,"children":3342},{"class":520,"line":584},[3343,3348,3352,3356,3361,3365,3369,3373,3377,3381,3386,3390,3395,3400,3404],{"type":427,"tag":518,"props":3344,"children":3345},{"style":525},[3346],{"type":433,"value":3347},"for",{"type":427,"tag":518,"props":3349,"children":3350},{"style":573},[3351],{"type":433,"value":734},{"type":427,"tag":518,"props":3353,"children":3354},{"style":561},[3355],{"type":433,"value":564},{"type":427,"tag":518,"props":3357,"children":3358},{"style":599},[3359],{"type":433,"value":3360}," i ",{"type":427,"tag":518,"props":3362,"children":3363},{"style":697},[3364],{"type":433,"value":700},{"type":427,"tag":518,"props":3366,"children":3367},{"style":859},[3368],{"type":433,"value":1351},{"type":427,"tag":518,"props":3370,"children":3371},{"style":573},[3372],{"type":433,"value":2090},{"type":427,"tag":518,"props":3374,"children":3375},{"style":599},[3376],{"type":433,"value":3360},{"type":427,"tag":518,"props":3378,"children":3379},{"style":697},[3380],{"type":433,"value":3297},{"type":427,"tag":518,"props":3382,"children":3383},{"style":599},[3384],{"type":433,"value":3385}," size",{"type":427,"tag":518,"props":3387,"children":3388},{"style":573},[3389],{"type":433,"value":2090},{"type":427,"tag":518,"props":3391,"children":3392},{"style":599},[3393],{"type":433,"value":3394}," i",{"type":427,"tag":518,"props":3396,"children":3397},{"style":697},[3398],{"type":433,"value":3399},"++",{"type":427,"tag":518,"props":3401,"children":3402},{"style":573},[3403],{"type":433,"value":1222},{"type":427,"tag":518,"props":3405,"children":3406},{"style":573},[3407],{"type":433,"value":581},{"type":427,"tag":518,"props":3409,"children":3410},{"class":520,"line":610},[3411,3416,3420,3425,3430,3434,3439,3444,3448,3452,3457,3461,3466],{"type":427,"tag":518,"props":3412,"children":3413},{"style":599},[3414],{"type":433,"value":3415},"  str",{"type":427,"tag":518,"props":3417,"children":3418},{"style":573},[3419],{"type":433,"value":1494},{"type":427,"tag":518,"props":3421,"children":3422},{"style":778},[3423],{"type":433,"value":3424},"i",{"type":427,"tag":518,"props":3426,"children":3427},{"style":573},[3428],{"type":433,"value":3429},"]",{"type":427,"tag":518,"props":3431,"children":3432},{"style":697},[3433],{"type":433,"value":2184},{"type":427,"tag":518,"props":3435,"children":3436},{"style":697},[3437],{"type":433,"value":3438}," static_cast\u003C",{"type":427,"tag":518,"props":3440,"children":3441},{"style":561},[3442],{"type":433,"value":3443},"char",{"type":427,"tag":518,"props":3445,"children":3446},{"style":697},[3447],{"type":433,"value":2505},{"type":427,"tag":518,"props":3449,"children":3450},{"style":573},[3451],{"type":433,"value":655},{"type":427,"tag":518,"props":3453,"children":3454},{"style":567},[3455],{"type":433,"value":3456},"random_dist",{"type":427,"tag":518,"props":3458,"children":3459},{"style":573},[3460],{"type":433,"value":655},{"type":427,"tag":518,"props":3462,"children":3463},{"style":778},[3464],{"type":433,"value":3465},"generator",{"type":427,"tag":518,"props":3467,"children":3468},{"style":573},[3469],{"type":433,"value":3470},"));\n",{"type":427,"tag":518,"props":3472,"children":3473},{"class":520,"line":631},[3474],{"type":427,"tag":518,"props":3475,"children":3476},{"style":573},[3477],{"type":433,"value":1364},{"type":427,"tag":435,"props":3479,"children":3481},{"id":3480},"接口层",[3482],{"type":433,"value":3480},{"type":427,"tag":441,"props":3484,"children":3485},{},[3486,3488,3494],{"type":433,"value":3487},"接口的声明位于 interface/kingdb.h，实现则是 interface/kingdb.cc。KingDB 类给 Database 和 Snapshot 定义了要求实现的 Get、Put、Delete、NewIterater、Open、Close、Flush、Compact、NewMultipartReader 接口。KDB 有自己的数据传输格式 ByteArray，诸如 Get、Put 这些接口在 KingDB 类中对应方法得到了重载，以实现通过 std::string 来传递键、值或者两者，可视为为接受 ByteArray 的方法的包装。所有数据库操作方法都返回 Status 对象，相关异常部分的简介见",{"type":427,"tag":452,"props":3489,"children":3491},{"href":3490},"#%E5%BC%82%E5%B8%B8%E4%B8%8E%E6%97%A5%E5%BF%97",[3492],{"type":433,"value":3493},"异常与日志",{"type":433,"value":3495},"小节。",{"type":427,"tag":441,"props":3497,"children":3498},{},[3499],{"type":433,"value":3500},"重载方法的实现示例如下，即先把 std::string 转回 ByteArray 再调用子类（Database 或 Snapshot）的实现。",{"type":427,"tag":507,"props":3502,"children":3504},{"code":3503,"language":510,"meta":421,"className":511,"style":421},"virtual Status Put(WriteOptions& write_options, const std::string& key, const std::string& chunk) {\n  ByteArray byte_array_key = NewDeepCopyByteArray(key.c_str(), key.size());\n  ByteArray byte_array_chunk = NewDeepCopyByteArray(chunk.c_str(), chunk.size());\n  return Put(write_options, byte_array_key, byte_array_chunk);\n}\n",[3505],{"type":427,"tag":514,"props":3506,"children":3507},{"__ignoreMap":421},[3508,3611,3667,3720,3761],{"type":427,"tag":518,"props":3509,"children":3510},{"class":520,"line":521},[3511,3516,3521,3526,3530,3535,3539,3544,3548,3552,3556,3560,3565,3569,3574,3578,3582,3586,3590,3594,3598,3603,3607],{"type":427,"tag":518,"props":3512,"children":3513},{"style":2025},[3514],{"type":433,"value":3515},"virtual",{"type":427,"tag":518,"props":3517,"children":3518},{"style":588},[3519],{"type":433,"value":3520}," Status",{"type":427,"tag":518,"props":3522,"children":3523},{"style":567},[3524],{"type":433,"value":3525}," Put",{"type":427,"tag":518,"props":3527,"children":3528},{"style":573},[3529],{"type":433,"value":655},{"type":427,"tag":518,"props":3531,"children":3532},{"style":588},[3533],{"type":433,"value":3534},"WriteOptions",{"type":427,"tag":518,"props":3536,"children":3537},{"style":2025},[3538],{"type":433,"value":2523},{"type":427,"tag":518,"props":3540,"children":3541},{"style":1434},[3542],{"type":433,"value":3543}," write_options",{"type":427,"tag":518,"props":3545,"children":3546},{"style":573},[3547],{"type":433,"value":665},{"type":427,"tag":518,"props":3549,"children":3550},{"style":2025},[3551],{"type":433,"value":2559},{"type":427,"tag":518,"props":3553,"children":3554},{"style":588},[3555],{"type":433,"value":2999},{"type":427,"tag":518,"props":3557,"children":3558},{"style":573},[3559],{"type":433,"value":596},{"type":427,"tag":518,"props":3561,"children":3562},{"style":588},[3563],{"type":433,"value":3564},"string",{"type":427,"tag":518,"props":3566,"children":3567},{"style":2025},[3568],{"type":433,"value":2523},{"type":427,"tag":518,"props":3570,"children":3571},{"style":1434},[3572],{"type":433,"value":3573}," key",{"type":427,"tag":518,"props":3575,"children":3576},{"style":573},[3577],{"type":433,"value":665},{"type":427,"tag":518,"props":3579,"children":3580},{"style":2025},[3581],{"type":433,"value":2559},{"type":427,"tag":518,"props":3583,"children":3584},{"style":588},[3585],{"type":433,"value":2999},{"type":427,"tag":518,"props":3587,"children":3588},{"style":573},[3589],{"type":433,"value":596},{"type":427,"tag":518,"props":3591,"children":3592},{"style":588},[3593],{"type":433,"value":3564},{"type":427,"tag":518,"props":3595,"children":3596},{"style":2025},[3597],{"type":433,"value":2523},{"type":427,"tag":518,"props":3599,"children":3600},{"style":1434},[3601],{"type":433,"value":3602}," chunk",{"type":427,"tag":518,"props":3604,"children":3605},{"style":573},[3606],{"type":433,"value":1222},{"type":427,"tag":518,"props":3608,"children":3609},{"style":573},[3610],{"type":433,"value":581},{"type":427,"tag":518,"props":3612,"children":3613},{"class":520,"line":548},[3614,3619,3623,3628,3632,3637,3641,3645,3650,3654,3658,3663],{"type":427,"tag":518,"props":3615,"children":3616},{"style":599},[3617],{"type":433,"value":3618},"  ByteArray byte_array_key ",{"type":427,"tag":518,"props":3620,"children":3621},{"style":697},[3622],{"type":433,"value":700},{"type":427,"tag":518,"props":3624,"children":3625},{"style":567},[3626],{"type":433,"value":3627}," NewDeepCopyByteArray",{"type":427,"tag":518,"props":3629,"children":3630},{"style":573},[3631],{"type":433,"value":655},{"type":427,"tag":518,"props":3633,"children":3634},{"style":599},[3635],{"type":433,"value":3636},"key",{"type":427,"tag":518,"props":3638,"children":3639},{"style":573},[3640],{"type":433,"value":710},{"type":427,"tag":518,"props":3642,"children":3643},{"style":567},[3644],{"type":433,"value":838},{"type":427,"tag":518,"props":3646,"children":3647},{"style":573},[3648],{"type":433,"value":3649},"(),",{"type":427,"tag":518,"props":3651,"children":3652},{"style":599},[3653],{"type":433,"value":3573},{"type":427,"tag":518,"props":3655,"children":3656},{"style":573},[3657],{"type":433,"value":710},{"type":427,"tag":518,"props":3659,"children":3660},{"style":567},[3661],{"type":433,"value":3662},"size",{"type":427,"tag":518,"props":3664,"children":3665},{"style":573},[3666],{"type":433,"value":843},{"type":427,"tag":518,"props":3668,"children":3669},{"class":520,"line":557},[3670,3675,3679,3683,3687,3692,3696,3700,3704,3708,3712,3716],{"type":427,"tag":518,"props":3671,"children":3672},{"style":599},[3673],{"type":433,"value":3674},"  ByteArray byte_array_chunk ",{"type":427,"tag":518,"props":3676,"children":3677},{"style":697},[3678],{"type":433,"value":700},{"type":427,"tag":518,"props":3680,"children":3681},{"style":567},[3682],{"type":433,"value":3627},{"type":427,"tag":518,"props":3684,"children":3685},{"style":573},[3686],{"type":433,"value":655},{"type":427,"tag":518,"props":3688,"children":3689},{"style":599},[3690],{"type":433,"value":3691},"chunk",{"type":427,"tag":518,"props":3693,"children":3694},{"style":573},[3695],{"type":433,"value":710},{"type":427,"tag":518,"props":3697,"children":3698},{"style":567},[3699],{"type":433,"value":838},{"type":427,"tag":518,"props":3701,"children":3702},{"style":573},[3703],{"type":433,"value":3649},{"type":427,"tag":518,"props":3705,"children":3706},{"style":599},[3707],{"type":433,"value":3602},{"type":427,"tag":518,"props":3709,"children":3710},{"style":573},[3711],{"type":433,"value":710},{"type":427,"tag":518,"props":3713,"children":3714},{"style":567},[3715],{"type":433,"value":3662},{"type":427,"tag":518,"props":3717,"children":3718},{"style":573},[3719],{"type":433,"value":843},{"type":427,"tag":518,"props":3721,"children":3722},{"class":520,"line":584},[3723,3727,3731,3735,3739,3743,3748,3752,3757],{"type":427,"tag":518,"props":3724,"children":3725},{"style":525},[3726],{"type":433,"value":1346},{"type":427,"tag":518,"props":3728,"children":3729},{"style":567},[3730],{"type":433,"value":3525},{"type":427,"tag":518,"props":3732,"children":3733},{"style":573},[3734],{"type":433,"value":655},{"type":427,"tag":518,"props":3736,"children":3737},{"style":599},[3738],{"type":433,"value":1030},{"type":427,"tag":518,"props":3740,"children":3741},{"style":573},[3742],{"type":433,"value":665},{"type":427,"tag":518,"props":3744,"children":3745},{"style":599},[3746],{"type":433,"value":3747}," byte_array_key",{"type":427,"tag":518,"props":3749,"children":3750},{"style":573},[3751],{"type":433,"value":665},{"type":427,"tag":518,"props":3753,"children":3754},{"style":599},[3755],{"type":433,"value":3756}," byte_array_chunk",{"type":427,"tag":518,"props":3758,"children":3759},{"style":573},[3760],{"type":433,"value":685},{"type":427,"tag":518,"props":3762,"children":3763},{"class":520,"line":610},[3764],{"type":427,"tag":518,"props":3765,"children":3766},{"style":573},[3767],{"type":433,"value":1364},{"type":427,"tag":1394,"props":3769,"children":3771},{"id":3770},"数据库开关",[3772],{"type":433,"value":3770},{"type":427,"tag":441,"props":3774,"children":3775},{},[3776],{"type":433,"value":3777},"数据库的开启与关闭，分别对应 Database 类的 Open 和 Close 方法。开启时，通过 stat 库函数找到数据库路径以及配置文件，使用 open 库函数获取其文件描述符。配置文件须先用 flock 锁住，使用 mmap 映射后再读取；如果没有那么分情况写入。之后，创建好 EventManager、WriteBuffer 和 StorageEngine 的实例，就完成了。关闭时过程类似，锁定住配置文件后再关闭，同时删除以上创建的实例。可以发现，资源申请全放在了 Open 中，而资源的销毁放在了 Close 中，而 Database 类析构时会自动调用 Close，所以这是一个类似 RAII 的资源管理过程。",{"type":427,"tag":507,"props":3779,"children":3781},{"code":3780,"language":510,"meta":421,"className":511,"style":421},"class Database: public KingDB {\n  virtual ~Database() { Close(); }\n  virtual Status Open() override {\n    std::string filepath_dboptions = DatabaseOptions::GetPath(dbname_);\n    fd_dboptions_ = open(filepath_dboptions.c_str(), O_RDONLY, 0644);\n    flock(fd_dboptions_, LOCK_EX | LOCK_NB);\n    Mmap mmap(filepath_dboptions, info.st_size);\n    Status status_dboptions = DatabaseOptionEncoder::DecodeFrom(mmap.datafile(), mmap.filesize(), &db_options_candidate);\n    // ...\n    em_ = new EventManager();\n    wb_ = new WriteBuffer(db_options_, em_);\n    se_ = new StorageEngine(db_options_, em_, dbname_);\n    return Status::OK(); \n  }\n  virtual void Close() override {\n    flock(fd_dboptions_, LOCK_UN);\n    close(fd_dboptions_);\n    wb_->Close();\n    se_->Close();\n    delete wb_;\n    delete se_;\n    delete em_;\n  }\n}\n",[3782],{"type":427,"tag":514,"props":3783,"children":3784},{"__ignoreMap":421},[3785,3814,3849,3878,3926,3987,4027,4070,4148,4156,4182,4225,4275,4303,4310,4337,4365,4385,4407,4427,4444,4460,4475,4482],{"type":427,"tag":518,"props":3786,"children":3787},{"class":520,"line":521},[3788,3792,3797,3801,3805,3810],{"type":427,"tag":518,"props":3789,"children":3790},{"style":561},[3791],{"type":433,"value":1938},{"type":427,"tag":518,"props":3793,"children":3794},{"style":588},[3795],{"type":433,"value":3796}," Database",{"type":427,"tag":518,"props":3798,"children":3799},{"style":573},[3800],{"type":433,"value":1623},{"type":427,"tag":518,"props":3802,"children":3803},{"style":561},[3804],{"type":433,"value":1987},{"type":427,"tag":518,"props":3806,"children":3807},{"style":588},[3808],{"type":433,"value":3809}," KingDB",{"type":427,"tag":518,"props":3811,"children":3812},{"style":573},[3813],{"type":433,"value":581},{"type":427,"tag":518,"props":3815,"children":3816},{"class":520,"line":548},[3817,3822,3827,3831,3835,3840,3844],{"type":427,"tag":518,"props":3818,"children":3819},{"style":2025},[3820],{"type":433,"value":3821},"  virtual",{"type":427,"tag":518,"props":3823,"children":3824},{"style":567},[3825],{"type":433,"value":3826}," ~Database",{"type":427,"tag":518,"props":3828,"children":3829},{"style":573},[3830],{"type":433,"value":576},{"type":427,"tag":518,"props":3832,"children":3833},{"style":573},[3834],{"type":433,"value":2047},{"type":427,"tag":518,"props":3836,"children":3837},{"style":567},[3838],{"type":433,"value":3839}," Close",{"type":427,"tag":518,"props":3841,"children":3842},{"style":573},[3843],{"type":433,"value":2014},{"type":427,"tag":518,"props":3845,"children":3846},{"style":573},[3847],{"type":433,"value":3848}," }\n",{"type":427,"tag":518,"props":3850,"children":3851},{"class":520,"line":557},[3852,3856,3860,3865,3869,3874],{"type":427,"tag":518,"props":3853,"children":3854},{"style":2025},[3855],{"type":433,"value":3821},{"type":427,"tag":518,"props":3857,"children":3858},{"style":588},[3859],{"type":433,"value":3520},{"type":427,"tag":518,"props":3861,"children":3862},{"style":567},[3863],{"type":433,"value":3864}," Open",{"type":427,"tag":518,"props":3866,"children":3867},{"style":573},[3868],{"type":433,"value":576},{"type":427,"tag":518,"props":3870,"children":3871},{"style":2025},[3872],{"type":433,"value":3873}," override",{"type":427,"tag":518,"props":3875,"children":3876},{"style":573},[3877],{"type":433,"value":581},{"type":427,"tag":518,"props":3879,"children":3880},{"class":520,"line":584},[3881,3886,3890,3895,3899,3904,3908,3913,3917,3922],{"type":427,"tag":518,"props":3882,"children":3883},{"style":588},[3884],{"type":433,"value":3885},"    std",{"type":427,"tag":518,"props":3887,"children":3888},{"style":573},[3889],{"type":433,"value":596},{"type":427,"tag":518,"props":3891,"children":3892},{"style":778},[3893],{"type":433,"value":3894},"string filepath_dboptions ",{"type":427,"tag":518,"props":3896,"children":3897},{"style":697},[3898],{"type":433,"value":700},{"type":427,"tag":518,"props":3900,"children":3901},{"style":588},[3902],{"type":433,"value":3903}," DatabaseOptions",{"type":427,"tag":518,"props":3905,"children":3906},{"style":573},[3907],{"type":433,"value":596},{"type":427,"tag":518,"props":3909,"children":3910},{"style":567},[3911],{"type":433,"value":3912},"GetPath",{"type":427,"tag":518,"props":3914,"children":3915},{"style":573},[3916],{"type":433,"value":655},{"type":427,"tag":518,"props":3918,"children":3919},{"style":778},[3920],{"type":433,"value":3921},"dbname_",{"type":427,"tag":518,"props":3923,"children":3924},{"style":573},[3925],{"type":433,"value":685},{"type":427,"tag":518,"props":3927,"children":3928},{"class":520,"line":610},[3929,3934,3938,3943,3947,3952,3956,3960,3964,3969,3973,3978,3983],{"type":427,"tag":518,"props":3930,"children":3931},{"style":778},[3932],{"type":433,"value":3933},"    fd_dboptions_ ",{"type":427,"tag":518,"props":3935,"children":3936},{"style":697},[3937],{"type":433,"value":700},{"type":427,"tag":518,"props":3939,"children":3940},{"style":567},[3941],{"type":433,"value":3942}," open",{"type":427,"tag":518,"props":3944,"children":3945},{"style":573},[3946],{"type":433,"value":655},{"type":427,"tag":518,"props":3948,"children":3949},{"style":599},[3950],{"type":433,"value":3951},"filepath_dboptions",{"type":427,"tag":518,"props":3953,"children":3954},{"style":573},[3955],{"type":433,"value":710},{"type":427,"tag":518,"props":3957,"children":3958},{"style":567},[3959],{"type":433,"value":838},{"type":427,"tag":518,"props":3961,"children":3962},{"style":573},[3963],{"type":433,"value":3649},{"type":427,"tag":518,"props":3965,"children":3966},{"style":778},[3967],{"type":433,"value":3968}," O_RDONLY",{"type":427,"tag":518,"props":3970,"children":3971},{"style":573},[3972],{"type":433,"value":665},{"type":427,"tag":518,"props":3974,"children":3976},{"style":3975},"--shiki-light:#F76D47;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[3977],{"type":433,"value":1351},{"type":427,"tag":518,"props":3979,"children":3980},{"style":859},[3981],{"type":433,"value":3982},"644",{"type":427,"tag":518,"props":3984,"children":3985},{"style":573},[3986],{"type":433,"value":685},{"type":427,"tag":518,"props":3988,"children":3989},{"class":520,"line":631},[3990,3995,3999,4004,4008,4013,4018,4023],{"type":427,"tag":518,"props":3991,"children":3992},{"style":567},[3993],{"type":433,"value":3994},"    flock",{"type":427,"tag":518,"props":3996,"children":3997},{"style":573},[3998],{"type":433,"value":655},{"type":427,"tag":518,"props":4000,"children":4001},{"style":778},[4002],{"type":433,"value":4003},"fd_dboptions_",{"type":427,"tag":518,"props":4005,"children":4006},{"style":573},[4007],{"type":433,"value":665},{"type":427,"tag":518,"props":4009,"children":4010},{"style":778},[4011],{"type":433,"value":4012}," LOCK_EX ",{"type":427,"tag":518,"props":4014,"children":4015},{"style":697},[4016],{"type":433,"value":4017},"|",{"type":427,"tag":518,"props":4019,"children":4020},{"style":778},[4021],{"type":433,"value":4022}," LOCK_NB",{"type":427,"tag":518,"props":4024,"children":4025},{"style":573},[4026],{"type":433,"value":685},{"type":427,"tag":518,"props":4028,"children":4029},{"class":520,"line":688},[4030,4035,4040,4044,4048,4052,4057,4061,4066],{"type":427,"tag":518,"props":4031,"children":4032},{"style":778},[4033],{"type":433,"value":4034},"    Mmap ",{"type":427,"tag":518,"props":4036,"children":4037},{"style":567},[4038],{"type":433,"value":4039},"mmap",{"type":427,"tag":518,"props":4041,"children":4042},{"style":573},[4043],{"type":433,"value":655},{"type":427,"tag":518,"props":4045,"children":4046},{"style":778},[4047],{"type":433,"value":3951},{"type":427,"tag":518,"props":4049,"children":4050},{"style":573},[4051],{"type":433,"value":665},{"type":427,"tag":518,"props":4053,"children":4054},{"style":599},[4055],{"type":433,"value":4056}," info",{"type":427,"tag":518,"props":4058,"children":4059},{"style":573},[4060],{"type":433,"value":710},{"type":427,"tag":518,"props":4062,"children":4063},{"style":599},[4064],{"type":433,"value":4065},"st_size",{"type":427,"tag":518,"props":4067,"children":4068},{"style":573},[4069],{"type":433,"value":685},{"type":427,"tag":518,"props":4071,"children":4072},{"class":520,"line":723},[4073,4078,4082,4087,4091,4096,4100,4104,4108,4113,4117,4122,4126,4131,4135,4139,4144],{"type":427,"tag":518,"props":4074,"children":4075},{"style":778},[4076],{"type":433,"value":4077},"    Status status_dboptions ",{"type":427,"tag":518,"props":4079,"children":4080},{"style":697},[4081],{"type":433,"value":700},{"type":427,"tag":518,"props":4083,"children":4084},{"style":588},[4085],{"type":433,"value":4086}," DatabaseOptionEncoder",{"type":427,"tag":518,"props":4088,"children":4089},{"style":573},[4090],{"type":433,"value":596},{"type":427,"tag":518,"props":4092,"children":4093},{"style":567},[4094],{"type":433,"value":4095},"DecodeFrom",{"type":427,"tag":518,"props":4097,"children":4098},{"style":573},[4099],{"type":433,"value":655},{"type":427,"tag":518,"props":4101,"children":4102},{"style":599},[4103],{"type":433,"value":4039},{"type":427,"tag":518,"props":4105,"children":4106},{"style":573},[4107],{"type":433,"value":710},{"type":427,"tag":518,"props":4109,"children":4110},{"style":567},[4111],{"type":433,"value":4112},"datafile",{"type":427,"tag":518,"props":4114,"children":4115},{"style":573},[4116],{"type":433,"value":3649},{"type":427,"tag":518,"props":4118,"children":4119},{"style":599},[4120],{"type":433,"value":4121}," mmap",{"type":427,"tag":518,"props":4123,"children":4124},{"style":573},[4125],{"type":433,"value":710},{"type":427,"tag":518,"props":4127,"children":4128},{"style":567},[4129],{"type":433,"value":4130},"filesize",{"type":427,"tag":518,"props":4132,"children":4133},{"style":573},[4134],{"type":433,"value":3649},{"type":427,"tag":518,"props":4136,"children":4137},{"style":697},[4138],{"type":433,"value":1153},{"type":427,"tag":518,"props":4140,"children":4141},{"style":778},[4142],{"type":433,"value":4143},"db_options_candidate",{"type":427,"tag":518,"props":4145,"children":4146},{"style":573},[4147],{"type":433,"value":685},{"type":427,"tag":518,"props":4149,"children":4150},{"class":520,"line":765},[4151],{"type":427,"tag":518,"props":4152,"children":4153},{"style":1527},[4154],{"type":433,"value":4155},"    // ...\n",{"type":427,"tag":518,"props":4157,"children":4158},{"class":520,"line":846},[4159,4164,4168,4173,4178],{"type":427,"tag":518,"props":4160,"children":4161},{"style":778},[4162],{"type":433,"value":4163},"    em_ ",{"type":427,"tag":518,"props":4165,"children":4166},{"style":697},[4167],{"type":433,"value":700},{"type":427,"tag":518,"props":4169,"children":4170},{"style":697},[4171],{"type":433,"value":4172}," new",{"type":427,"tag":518,"props":4174,"children":4175},{"style":567},[4176],{"type":433,"value":4177}," EventManager",{"type":427,"tag":518,"props":4179,"children":4180},{"style":573},[4181],{"type":433,"value":720},{"type":427,"tag":518,"props":4183,"children":4184},{"class":520,"line":869},[4185,4190,4194,4198,4203,4207,4212,4216,4221],{"type":427,"tag":518,"props":4186,"children":4187},{"style":778},[4188],{"type":433,"value":4189},"    wb_ ",{"type":427,"tag":518,"props":4191,"children":4192},{"style":697},[4193],{"type":433,"value":700},{"type":427,"tag":518,"props":4195,"children":4196},{"style":697},[4197],{"type":433,"value":4172},{"type":427,"tag":518,"props":4199,"children":4200},{"style":567},[4201],{"type":433,"value":4202}," WriteBuffer",{"type":427,"tag":518,"props":4204,"children":4205},{"style":573},[4206],{"type":433,"value":655},{"type":427,"tag":518,"props":4208,"children":4209},{"style":778},[4210],{"type":433,"value":4211},"db_options_",{"type":427,"tag":518,"props":4213,"children":4214},{"style":573},[4215],{"type":433,"value":665},{"type":427,"tag":518,"props":4217,"children":4218},{"style":778},[4219],{"type":433,"value":4220}," em_",{"type":427,"tag":518,"props":4222,"children":4223},{"style":573},[4224],{"type":433,"value":685},{"type":427,"tag":518,"props":4226,"children":4227},{"class":520,"line":878},[4228,4233,4237,4241,4246,4250,4254,4258,4262,4266,4271],{"type":427,"tag":518,"props":4229,"children":4230},{"style":778},[4231],{"type":433,"value":4232},"    se_ ",{"type":427,"tag":518,"props":4234,"children":4235},{"style":697},[4236],{"type":433,"value":700},{"type":427,"tag":518,"props":4238,"children":4239},{"style":697},[4240],{"type":433,"value":4172},{"type":427,"tag":518,"props":4242,"children":4243},{"style":567},[4244],{"type":433,"value":4245}," StorageEngine",{"type":427,"tag":518,"props":4247,"children":4248},{"style":573},[4249],{"type":433,"value":655},{"type":427,"tag":518,"props":4251,"children":4252},{"style":778},[4253],{"type":433,"value":4211},{"type":427,"tag":518,"props":4255,"children":4256},{"style":573},[4257],{"type":433,"value":665},{"type":427,"tag":518,"props":4259,"children":4260},{"style":778},[4261],{"type":433,"value":4220},{"type":427,"tag":518,"props":4263,"children":4264},{"style":573},[4265],{"type":433,"value":665},{"type":427,"tag":518,"props":4267,"children":4268},{"style":778},[4269],{"type":433,"value":4270}," dbname_",{"type":427,"tag":518,"props":4272,"children":4273},{"style":573},[4274],{"type":433,"value":685},{"type":427,"tag":518,"props":4276,"children":4277},{"class":520,"line":886},[4278,4282,4286,4290,4295,4299],{"type":427,"tag":518,"props":4279,"children":4280},{"style":525},[4281],{"type":433,"value":2758},{"type":427,"tag":518,"props":4283,"children":4284},{"style":588},[4285],{"type":433,"value":3520},{"type":427,"tag":518,"props":4287,"children":4288},{"style":573},[4289],{"type":433,"value":596},{"type":427,"tag":518,"props":4291,"children":4292},{"style":567},[4293],{"type":433,"value":4294},"OK",{"type":427,"tag":518,"props":4296,"children":4297},{"style":573},[4298],{"type":433,"value":2014},{"type":427,"tag":518,"props":4300,"children":4301},{"style":778},[4302],{"type":433,"value":1266},{"type":427,"tag":518,"props":4304,"children":4305},{"class":520,"line":929},[4306],{"type":427,"tag":518,"props":4307,"children":4308},{"style":573},[4309],{"type":433,"value":875},{"type":427,"tag":518,"props":4311,"children":4312},{"class":520,"line":970},[4313,4317,4321,4325,4329,4333],{"type":427,"tag":518,"props":4314,"children":4315},{"style":2025},[4316],{"type":433,"value":3821},{"type":427,"tag":518,"props":4318,"children":4319},{"style":561},[4320],{"type":433,"value":2033},{"type":427,"tag":518,"props":4322,"children":4323},{"style":567},[4324],{"type":433,"value":3839},{"type":427,"tag":518,"props":4326,"children":4327},{"style":573},[4328],{"type":433,"value":576},{"type":427,"tag":518,"props":4330,"children":4331},{"style":2025},[4332],{"type":433,"value":3873},{"type":427,"tag":518,"props":4334,"children":4335},{"style":573},[4336],{"type":433,"value":581},{"type":427,"tag":518,"props":4338,"children":4339},{"class":520,"line":978},[4340,4344,4348,4352,4356,4361],{"type":427,"tag":518,"props":4341,"children":4342},{"style":567},[4343],{"type":433,"value":3994},{"type":427,"tag":518,"props":4345,"children":4346},{"style":573},[4347],{"type":433,"value":655},{"type":427,"tag":518,"props":4349,"children":4350},{"style":778},[4351],{"type":433,"value":4003},{"type":427,"tag":518,"props":4353,"children":4354},{"style":573},[4355],{"type":433,"value":665},{"type":427,"tag":518,"props":4357,"children":4358},{"style":778},[4359],{"type":433,"value":4360}," LOCK_UN",{"type":427,"tag":518,"props":4362,"children":4363},{"style":573},[4364],{"type":433,"value":685},{"type":427,"tag":518,"props":4366,"children":4367},{"class":520,"line":999},[4368,4373,4377,4381],{"type":427,"tag":518,"props":4369,"children":4370},{"style":567},[4371],{"type":433,"value":4372},"    close",{"type":427,"tag":518,"props":4374,"children":4375},{"style":573},[4376],{"type":433,"value":655},{"type":427,"tag":518,"props":4378,"children":4379},{"style":778},[4380],{"type":433,"value":4003},{"type":427,"tag":518,"props":4382,"children":4383},{"style":573},[4384],{"type":433,"value":685},{"type":427,"tag":518,"props":4386,"children":4387},{"class":520,"line":1055},[4388,4393,4398,4403],{"type":427,"tag":518,"props":4389,"children":4390},{"style":599},[4391],{"type":433,"value":4392},"    wb_",{"type":427,"tag":518,"props":4394,"children":4395},{"style":573},[4396],{"type":433,"value":4397},"->",{"type":427,"tag":518,"props":4399,"children":4400},{"style":567},[4401],{"type":433,"value":4402},"Close",{"type":427,"tag":518,"props":4404,"children":4405},{"style":573},[4406],{"type":433,"value":720},{"type":427,"tag":518,"props":4408,"children":4409},{"class":520,"line":1063},[4410,4415,4419,4423],{"type":427,"tag":518,"props":4411,"children":4412},{"style":599},[4413],{"type":433,"value":4414},"    se_",{"type":427,"tag":518,"props":4416,"children":4417},{"style":573},[4418],{"type":433,"value":4397},{"type":427,"tag":518,"props":4420,"children":4421},{"style":567},[4422],{"type":433,"value":4402},{"type":427,"tag":518,"props":4424,"children":4425},{"style":573},[4426],{"type":433,"value":720},{"type":427,"tag":518,"props":4428,"children":4429},{"class":520,"line":1084},[4430,4435,4440],{"type":427,"tag":518,"props":4431,"children":4432},{"style":697},[4433],{"type":433,"value":4434},"    delete",{"type":427,"tag":518,"props":4436,"children":4437},{"style":778},[4438],{"type":433,"value":4439}," wb_",{"type":427,"tag":518,"props":4441,"children":4442},{"style":573},[4443],{"type":433,"value":607},{"type":427,"tag":518,"props":4445,"children":4446},{"class":520,"line":1105},[4447,4451,4456],{"type":427,"tag":518,"props":4448,"children":4449},{"style":697},[4450],{"type":433,"value":4434},{"type":427,"tag":518,"props":4452,"children":4453},{"style":778},[4454],{"type":433,"value":4455}," se_",{"type":427,"tag":518,"props":4457,"children":4458},{"style":573},[4459],{"type":433,"value":607},{"type":427,"tag":518,"props":4461,"children":4462},{"class":520,"line":1165},[4463,4467,4471],{"type":427,"tag":518,"props":4464,"children":4465},{"style":697},[4466],{"type":433,"value":4434},{"type":427,"tag":518,"props":4468,"children":4469},{"style":778},[4470],{"type":433,"value":4220},{"type":427,"tag":518,"props":4472,"children":4473},{"style":573},[4474],{"type":433,"value":607},{"type":427,"tag":518,"props":4476,"children":4477},{"class":520,"line":1229},[4478],{"type":427,"tag":518,"props":4479,"children":4480},{"style":573},[4481],{"type":433,"value":875},{"type":427,"tag":518,"props":4483,"children":4484},{"class":520,"line":1269},[4485],{"type":427,"tag":518,"props":4486,"children":4487},{"style":573},[4488],{"type":433,"value":1364},{"type":427,"tag":441,"props":4490,"children":4491},{},[4492],{"type":433,"value":4493},"因为数据库不能同时关闭或是开启，所以 Open 以及 Close 中都使用了 std::unique_lock 进行锁定。",{"type":427,"tag":507,"props":4495,"children":4497},{"code":4496,"language":510,"meta":421,"className":511,"style":421},"virtual Status Open() override {\n  std::unique_lock\u003Cstd::mutex> lock(mutex_close_);\n}\nvirtual void Close() override {\n  std::unique_lock\u003Cstd::mutex> lock(mutex_close_);\n}\n",[4498],{"type":427,"tag":514,"props":4499,"children":4500},{"__ignoreMap":421},[4501,4528,4583,4590,4617,4668],{"type":427,"tag":518,"props":4502,"children":4503},{"class":520,"line":521},[4504,4508,4512,4516,4520,4524],{"type":427,"tag":518,"props":4505,"children":4506},{"style":2025},[4507],{"type":433,"value":3515},{"type":427,"tag":518,"props":4509,"children":4510},{"style":588},[4511],{"type":433,"value":3520},{"type":427,"tag":518,"props":4513,"children":4514},{"style":567},[4515],{"type":433,"value":3864},{"type":427,"tag":518,"props":4517,"children":4518},{"style":573},[4519],{"type":433,"value":576},{"type":427,"tag":518,"props":4521,"children":4522},{"style":2025},[4523],{"type":433,"value":3873},{"type":427,"tag":518,"props":4525,"children":4526},{"style":573},[4527],{"type":433,"value":581},{"type":427,"tag":518,"props":4529,"children":4530},{"class":520,"line":548},[4531,4535,4539,4544,4548,4552,4556,4561,4565,4570,4574,4579],{"type":427,"tag":518,"props":4532,"children":4533},{"style":588},[4534],{"type":433,"value":892},{"type":427,"tag":518,"props":4536,"children":4537},{"style":573},[4538],{"type":433,"value":596},{"type":427,"tag":518,"props":4540,"children":4541},{"style":599},[4542],{"type":433,"value":4543},"unique_lock",{"type":427,"tag":518,"props":4545,"children":4546},{"style":697},[4547],{"type":433,"value":3297},{"type":427,"tag":518,"props":4549,"children":4550},{"style":588},[4551],{"type":433,"value":2969},{"type":427,"tag":518,"props":4553,"children":4554},{"style":573},[4555],{"type":433,"value":596},{"type":427,"tag":518,"props":4557,"children":4558},{"style":599},[4559],{"type":433,"value":4560},"mutex",{"type":427,"tag":518,"props":4562,"children":4563},{"style":697},[4564],{"type":433,"value":2505},{"type":427,"tag":518,"props":4566,"children":4567},{"style":567},[4568],{"type":433,"value":4569}," lock",{"type":427,"tag":518,"props":4571,"children":4572},{"style":573},[4573],{"type":433,"value":655},{"type":427,"tag":518,"props":4575,"children":4576},{"style":599},[4577],{"type":433,"value":4578},"mutex_close_",{"type":427,"tag":518,"props":4580,"children":4581},{"style":573},[4582],{"type":433,"value":685},{"type":427,"tag":518,"props":4584,"children":4585},{"class":520,"line":557},[4586],{"type":427,"tag":518,"props":4587,"children":4588},{"style":573},[4589],{"type":433,"value":1364},{"type":427,"tag":518,"props":4591,"children":4592},{"class":520,"line":584},[4593,4597,4601,4605,4609,4613],{"type":427,"tag":518,"props":4594,"children":4595},{"style":2025},[4596],{"type":433,"value":3515},{"type":427,"tag":518,"props":4598,"children":4599},{"style":561},[4600],{"type":433,"value":2033},{"type":427,"tag":518,"props":4602,"children":4603},{"style":567},[4604],{"type":433,"value":3839},{"type":427,"tag":518,"props":4606,"children":4607},{"style":573},[4608],{"type":433,"value":576},{"type":427,"tag":518,"props":4610,"children":4611},{"style":2025},[4612],{"type":433,"value":3873},{"type":427,"tag":518,"props":4614,"children":4615},{"style":573},[4616],{"type":433,"value":581},{"type":427,"tag":518,"props":4618,"children":4619},{"class":520,"line":610},[4620,4624,4628,4632,4636,4640,4644,4648,4652,4656,4660,4664],{"type":427,"tag":518,"props":4621,"children":4622},{"style":588},[4623],{"type":433,"value":892},{"type":427,"tag":518,"props":4625,"children":4626},{"style":573},[4627],{"type":433,"value":596},{"type":427,"tag":518,"props":4629,"children":4630},{"style":599},[4631],{"type":433,"value":4543},{"type":427,"tag":518,"props":4633,"children":4634},{"style":697},[4635],{"type":433,"value":3297},{"type":427,"tag":518,"props":4637,"children":4638},{"style":588},[4639],{"type":433,"value":2969},{"type":427,"tag":518,"props":4641,"children":4642},{"style":573},[4643],{"type":433,"value":596},{"type":427,"tag":518,"props":4645,"children":4646},{"style":599},[4647],{"type":433,"value":4560},{"type":427,"tag":518,"props":4649,"children":4650},{"style":697},[4651],{"type":433,"value":2505},{"type":427,"tag":518,"props":4653,"children":4654},{"style":567},[4655],{"type":433,"value":4569},{"type":427,"tag":518,"props":4657,"children":4658},{"style":573},[4659],{"type":433,"value":655},{"type":427,"tag":518,"props":4661,"children":4662},{"style":599},[4663],{"type":433,"value":4578},{"type":427,"tag":518,"props":4665,"children":4666},{"style":573},[4667],{"type":433,"value":685},{"type":427,"tag":518,"props":4669,"children":4670},{"class":520,"line":631},[4671],{"type":427,"tag":518,"props":4672,"children":4673},{"style":573},[4674],{"type":433,"value":1364},{"type":427,"tag":435,"props":4676,"children":4677},{"id":3493},[4678],{"type":433,"value":3493},{"type":427,"tag":441,"props":4680,"children":4681},{},[4682],{"type":433,"value":4683},"代码没有使用 C++ 风格的异常捕获，取而代之的是设计了状态类 Status。就像 kingdb_user 示例展示的，所有数据库操作都会返回一个状态实例，通过调用其 IsOK 方法，调用者可以判断处出操作有没有成功；如果失败了，可以使用 ToString 方法把出错原因输出。尽管这种设计会带来额外的内存开销，且使每次调用都带来轻微的性能消耗，不过这种消耗可以避免魔法数值，它将错误码和核心解耦，使代码有更佳的可读性。",{"type":427,"tag":507,"props":4685,"children":4687},{"code":4686,"language":510,"meta":421,"className":511,"style":421},"class Status {\n  // ...\n  static Status OK() { return Status(); }\n  bool IsOK() const { return (code_ == kOK); }\n  // ...\n  enum Code {\n    kOK = 0, \n    kNotFound = 1,\n    kDeleteOrder = 2,\n    kInvalidArgument = 3,\n    kIOError = 4,\n    kDone = 5,\n    kMultipartRequired = 6\n  };\n  // ...\n}\nstd::string Status::ToString() const {\n  if (message1_ == \"\") {\n    return \"OK\";\n  } else {\n    char tmp[30];\n    const char* type;\n    switch (code()) {\n      case kOK:\n        type = \"OK\";\n        break;\n      // ...\n    }\n    // ...\n    return result;\n  }\n}\n",[4688],{"type":427,"tag":514,"props":4689,"children":4690},{"__ignoreMap":421},[4691,4706,4713,4754,4809,4816,4833,4858,4879,4900,4921,4942,4963,4980,4988,4995,5002,5041,5074,5097,5112,5138,5165,5189,5206,5234,5246,5254,5262,5269,5286,5294],{"type":427,"tag":518,"props":4692,"children":4693},{"class":520,"line":521},[4694,4698,4702],{"type":427,"tag":518,"props":4695,"children":4696},{"style":561},[4697],{"type":433,"value":1938},{"type":427,"tag":518,"props":4699,"children":4700},{"style":588},[4701],{"type":433,"value":3520},{"type":427,"tag":518,"props":4703,"children":4704},{"style":573},[4705],{"type":433,"value":581},{"type":427,"tag":518,"props":4707,"children":4708},{"class":520,"line":548},[4709],{"type":427,"tag":518,"props":4710,"children":4711},{"style":1527},[4712],{"type":433,"value":1883},{"type":427,"tag":518,"props":4714,"children":4715},{"class":520,"line":557},[4716,4720,4724,4729,4733,4737,4742,4746,4750],{"type":427,"tag":518,"props":4717,"children":4718},{"style":2025},[4719],{"type":433,"value":2028},{"type":427,"tag":518,"props":4721,"children":4722},{"style":588},[4723],{"type":433,"value":3520},{"type":427,"tag":518,"props":4725,"children":4726},{"style":567},[4727],{"type":433,"value":4728}," OK",{"type":427,"tag":518,"props":4730,"children":4731},{"style":573},[4732],{"type":433,"value":576},{"type":427,"tag":518,"props":4734,"children":4735},{"style":573},[4736],{"type":433,"value":2047},{"type":427,"tag":518,"props":4738,"children":4739},{"style":525},[4740],{"type":433,"value":4741}," return",{"type":427,"tag":518,"props":4743,"children":4744},{"style":567},[4745],{"type":433,"value":3520},{"type":427,"tag":518,"props":4747,"children":4748},{"style":573},[4749],{"type":433,"value":2014},{"type":427,"tag":518,"props":4751,"children":4752},{"style":573},[4753],{"type":433,"value":3848},{"type":427,"tag":518,"props":4755,"children":4756},{"class":520,"line":584},[4757,4762,4767,4771,4775,4779,4783,4787,4792,4796,4801,4805],{"type":427,"tag":518,"props":4758,"children":4759},{"style":561},[4760],{"type":433,"value":4761},"  bool",{"type":427,"tag":518,"props":4763,"children":4764},{"style":567},[4765],{"type":433,"value":4766}," IsOK",{"type":427,"tag":518,"props":4768,"children":4769},{"style":573},[4770],{"type":433,"value":576},{"type":427,"tag":518,"props":4772,"children":4773},{"style":2025},[4774],{"type":433,"value":2559},{"type":427,"tag":518,"props":4776,"children":4777},{"style":573},[4778],{"type":433,"value":2047},{"type":427,"tag":518,"props":4780,"children":4781},{"style":525},[4782],{"type":433,"value":4741},{"type":427,"tag":518,"props":4784,"children":4785},{"style":573},[4786],{"type":433,"value":734},{"type":427,"tag":518,"props":4788,"children":4789},{"style":778},[4790],{"type":433,"value":4791},"code_ ",{"type":427,"tag":518,"props":4793,"children":4794},{"style":697},[4795],{"type":433,"value":1205},{"type":427,"tag":518,"props":4797,"children":4798},{"style":778},[4799],{"type":433,"value":4800}," kOK",{"type":427,"tag":518,"props":4802,"children":4803},{"style":573},[4804],{"type":433,"value":1261},{"type":427,"tag":518,"props":4806,"children":4807},{"style":573},[4808],{"type":433,"value":3848},{"type":427,"tag":518,"props":4810,"children":4811},{"class":520,"line":610},[4812],{"type":427,"tag":518,"props":4813,"children":4814},{"style":1527},[4815],{"type":433,"value":1883},{"type":427,"tag":518,"props":4817,"children":4818},{"class":520,"line":631},[4819,4824,4829],{"type":427,"tag":518,"props":4820,"children":4821},{"style":561},[4822],{"type":433,"value":4823},"  enum",{"type":427,"tag":518,"props":4825,"children":4826},{"style":588},[4827],{"type":433,"value":4828}," Code",{"type":427,"tag":518,"props":4830,"children":4831},{"style":573},[4832],{"type":433,"value":581},{"type":427,"tag":518,"props":4834,"children":4835},{"class":520,"line":688},[4836,4842,4846,4850,4854],{"type":427,"tag":518,"props":4837,"children":4839},{"style":4838},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#F8F8F2",[4840],{"type":433,"value":4841},"    kOK",{"type":427,"tag":518,"props":4843,"children":4844},{"style":697},[4845],{"type":433,"value":2184},{"type":427,"tag":518,"props":4847,"children":4848},{"style":859},[4849],{"type":433,"value":1351},{"type":427,"tag":518,"props":4851,"children":4852},{"style":573},[4853],{"type":433,"value":665},{"type":427,"tag":518,"props":4855,"children":4856},{"style":778},[4857],{"type":433,"value":1266},{"type":427,"tag":518,"props":4859,"children":4860},{"class":520,"line":723},[4861,4866,4870,4874],{"type":427,"tag":518,"props":4862,"children":4863},{"style":4838},[4864],{"type":433,"value":4865},"    kNotFound",{"type":427,"tag":518,"props":4867,"children":4868},{"style":697},[4869],{"type":433,"value":2184},{"type":427,"tag":518,"props":4871,"children":4872},{"style":859},[4873],{"type":433,"value":3076},{"type":427,"tag":518,"props":4875,"children":4876},{"style":573},[4877],{"type":433,"value":4878},",\n",{"type":427,"tag":518,"props":4880,"children":4881},{"class":520,"line":765},[4882,4887,4891,4896],{"type":427,"tag":518,"props":4883,"children":4884},{"style":4838},[4885],{"type":433,"value":4886},"    kDeleteOrder",{"type":427,"tag":518,"props":4888,"children":4889},{"style":697},[4890],{"type":433,"value":2184},{"type":427,"tag":518,"props":4892,"children":4893},{"style":859},[4894],{"type":433,"value":4895}," 2",{"type":427,"tag":518,"props":4897,"children":4898},{"style":573},[4899],{"type":433,"value":4878},{"type":427,"tag":518,"props":4901,"children":4902},{"class":520,"line":846},[4903,4908,4912,4917],{"type":427,"tag":518,"props":4904,"children":4905},{"style":4838},[4906],{"type":433,"value":4907},"    kInvalidArgument",{"type":427,"tag":518,"props":4909,"children":4910},{"style":697},[4911],{"type":433,"value":2184},{"type":427,"tag":518,"props":4913,"children":4914},{"style":859},[4915],{"type":433,"value":4916}," 3",{"type":427,"tag":518,"props":4918,"children":4919},{"style":573},[4920],{"type":433,"value":4878},{"type":427,"tag":518,"props":4922,"children":4923},{"class":520,"line":869},[4924,4929,4933,4938],{"type":427,"tag":518,"props":4925,"children":4926},{"style":4838},[4927],{"type":433,"value":4928},"    kIOError",{"type":427,"tag":518,"props":4930,"children":4931},{"style":697},[4932],{"type":433,"value":2184},{"type":427,"tag":518,"props":4934,"children":4935},{"style":859},[4936],{"type":433,"value":4937}," 4",{"type":427,"tag":518,"props":4939,"children":4940},{"style":573},[4941],{"type":433,"value":4878},{"type":427,"tag":518,"props":4943,"children":4944},{"class":520,"line":878},[4945,4950,4954,4959],{"type":427,"tag":518,"props":4946,"children":4947},{"style":4838},[4948],{"type":433,"value":4949},"    kDone",{"type":427,"tag":518,"props":4951,"children":4952},{"style":697},[4953],{"type":433,"value":2184},{"type":427,"tag":518,"props":4955,"children":4956},{"style":859},[4957],{"type":433,"value":4958}," 5",{"type":427,"tag":518,"props":4960,"children":4961},{"style":573},[4962],{"type":433,"value":4878},{"type":427,"tag":518,"props":4964,"children":4965},{"class":520,"line":886},[4966,4971,4975],{"type":427,"tag":518,"props":4967,"children":4968},{"style":4838},[4969],{"type":433,"value":4970},"    kMultipartRequired",{"type":427,"tag":518,"props":4972,"children":4973},{"style":697},[4974],{"type":433,"value":2184},{"type":427,"tag":518,"props":4976,"children":4977},{"style":859},[4978],{"type":433,"value":4979}," 6\n",{"type":427,"tag":518,"props":4981,"children":4982},{"class":520,"line":929},[4983],{"type":427,"tag":518,"props":4984,"children":4985},{"style":573},[4986],{"type":433,"value":4987},"  };\n",{"type":427,"tag":518,"props":4989,"children":4990},{"class":520,"line":970},[4991],{"type":427,"tag":518,"props":4992,"children":4993},{"style":1527},[4994],{"type":433,"value":1883},{"type":427,"tag":518,"props":4996,"children":4997},{"class":520,"line":978},[4998],{"type":427,"tag":518,"props":4999,"children":5000},{"style":573},[5001],{"type":433,"value":1364},{"type":427,"tag":518,"props":5003,"children":5004},{"class":520,"line":999},[5005,5009,5013,5017,5021,5025,5029,5033,5037],{"type":427,"tag":518,"props":5006,"children":5007},{"style":588},[5008],{"type":433,"value":2969},{"type":427,"tag":518,"props":5010,"children":5011},{"style":573},[5012],{"type":433,"value":596},{"type":427,"tag":518,"props":5014,"children":5015},{"style":588},[5016],{"type":433,"value":3564},{"type":427,"tag":518,"props":5018,"children":5019},{"style":588},[5020],{"type":433,"value":3520},{"type":427,"tag":518,"props":5022,"children":5023},{"style":573},[5024],{"type":433,"value":596},{"type":427,"tag":518,"props":5026,"children":5027},{"style":567},[5028],{"type":433,"value":828},{"type":427,"tag":518,"props":5030,"children":5031},{"style":573},[5032],{"type":433,"value":576},{"type":427,"tag":518,"props":5034,"children":5035},{"style":2025},[5036],{"type":433,"value":2559},{"type":427,"tag":518,"props":5038,"children":5039},{"style":573},[5040],{"type":433,"value":581},{"type":427,"tag":518,"props":5042,"children":5043},{"class":520,"line":1055},[5044,5048,5052,5057,5061,5066,5070],{"type":427,"tag":518,"props":5045,"children":5046},{"style":525},[5047],{"type":433,"value":729},{"type":427,"tag":518,"props":5049,"children":5050},{"style":573},[5051],{"type":433,"value":734},{"type":427,"tag":518,"props":5053,"children":5054},{"style":778},[5055],{"type":433,"value":5056},"message1_ ",{"type":427,"tag":518,"props":5058,"children":5059},{"style":697},[5060],{"type":433,"value":1205},{"type":427,"tag":518,"props":5062,"children":5063},{"style":531},[5064],{"type":433,"value":5065}," \"\"",{"type":427,"tag":518,"props":5067,"children":5068},{"style":573},[5069],{"type":433,"value":1222},{"type":427,"tag":518,"props":5071,"children":5072},{"style":573},[5073],{"type":433,"value":581},{"type":427,"tag":518,"props":5075,"children":5076},{"class":520,"line":1063},[5077,5081,5085,5089,5093],{"type":427,"tag":518,"props":5078,"children":5079},{"style":525},[5080],{"type":433,"value":2758},{"type":427,"tag":518,"props":5082,"children":5083},{"style":531},[5084],{"type":433,"value":670},{"type":427,"tag":518,"props":5086,"children":5087},{"style":537},[5088],{"type":433,"value":4294},{"type":427,"tag":518,"props":5090,"children":5091},{"style":531},[5092],{"type":433,"value":680},{"type":427,"tag":518,"props":5094,"children":5095},{"style":573},[5096],{"type":433,"value":607},{"type":427,"tag":518,"props":5098,"children":5099},{"class":520,"line":1084},[5100,5104,5108],{"type":427,"tag":518,"props":5101,"children":5102},{"style":573},[5103],{"type":433,"value":1275},{"type":427,"tag":518,"props":5105,"children":5106},{"style":525},[5107],{"type":433,"value":1280},{"type":427,"tag":518,"props":5109,"children":5110},{"style":573},[5111],{"type":433,"value":581},{"type":427,"tag":518,"props":5113,"children":5114},{"class":520,"line":1105},[5115,5120,5125,5129,5134],{"type":427,"tag":518,"props":5116,"children":5117},{"style":561},[5118],{"type":433,"value":5119},"    char",{"type":427,"tag":518,"props":5121,"children":5122},{"style":599},[5123],{"type":433,"value":5124}," tmp",{"type":427,"tag":518,"props":5126,"children":5127},{"style":573},[5128],{"type":433,"value":1494},{"type":427,"tag":518,"props":5130,"children":5131},{"style":859},[5132],{"type":433,"value":5133},"30",{"type":427,"tag":518,"props":5135,"children":5136},{"style":573},[5137],{"type":433,"value":1504},{"type":427,"tag":518,"props":5139,"children":5140},{"class":520,"line":1165},[5141,5146,5151,5156,5161],{"type":427,"tag":518,"props":5142,"children":5143},{"style":2025},[5144],{"type":433,"value":5145},"    const",{"type":427,"tag":518,"props":5147,"children":5148},{"style":561},[5149],{"type":433,"value":5150}," char",{"type":427,"tag":518,"props":5152,"children":5153},{"style":697},[5154],{"type":433,"value":5155},"*",{"type":427,"tag":518,"props":5157,"children":5158},{"style":778},[5159],{"type":433,"value":5160}," type",{"type":427,"tag":518,"props":5162,"children":5163},{"style":573},[5164],{"type":433,"value":607},{"type":427,"tag":518,"props":5166,"children":5167},{"class":520,"line":1229},[5168,5173,5177,5181,5185],{"type":427,"tag":518,"props":5169,"children":5170},{"style":525},[5171],{"type":433,"value":5172},"    switch",{"type":427,"tag":518,"props":5174,"children":5175},{"style":573},[5176],{"type":433,"value":734},{"type":427,"tag":518,"props":5178,"children":5179},{"style":567},[5180],{"type":433,"value":514},{"type":427,"tag":518,"props":5182,"children":5183},{"style":573},[5184],{"type":433,"value":758},{"type":427,"tag":518,"props":5186,"children":5187},{"style":573},[5188],{"type":433,"value":581},{"type":427,"tag":518,"props":5190,"children":5191},{"class":520,"line":1269},[5192,5197,5201],{"type":427,"tag":518,"props":5193,"children":5194},{"style":525},[5195],{"type":433,"value":5196},"      case",{"type":427,"tag":518,"props":5198,"children":5199},{"style":778},[5200],{"type":433,"value":4800},{"type":427,"tag":518,"props":5202,"children":5203},{"style":573},[5204],{"type":433,"value":5205},":\n",{"type":427,"tag":518,"props":5207,"children":5208},{"class":520,"line":1287},[5209,5214,5218,5222,5226,5230],{"type":427,"tag":518,"props":5210,"children":5211},{"style":778},[5212],{"type":433,"value":5213},"        type ",{"type":427,"tag":518,"props":5215,"children":5216},{"style":697},[5217],{"type":433,"value":700},{"type":427,"tag":518,"props":5219,"children":5220},{"style":531},[5221],{"type":433,"value":670},{"type":427,"tag":518,"props":5223,"children":5224},{"style":537},[5225],{"type":433,"value":4294},{"type":427,"tag":518,"props":5227,"children":5228},{"style":531},[5229],{"type":433,"value":680},{"type":427,"tag":518,"props":5231,"children":5232},{"style":573},[5233],{"type":433,"value":607},{"type":427,"tag":518,"props":5235,"children":5236},{"class":520,"line":1324},[5237,5242],{"type":427,"tag":518,"props":5238,"children":5239},{"style":525},[5240],{"type":433,"value":5241},"        break",{"type":427,"tag":518,"props":5243,"children":5244},{"style":573},[5245],{"type":433,"value":607},{"type":427,"tag":518,"props":5247,"children":5248},{"class":520,"line":1332},[5249],{"type":427,"tag":518,"props":5250,"children":5251},{"style":1527},[5252],{"type":433,"value":5253},"      // ...\n",{"type":427,"tag":518,"props":5255,"children":5256},{"class":520,"line":1340},[5257],{"type":427,"tag":518,"props":5258,"children":5259},{"style":573},[5260],{"type":433,"value":5261},"    }\n",{"type":427,"tag":518,"props":5263,"children":5264},{"class":520,"line":1358},[5265],{"type":427,"tag":518,"props":5266,"children":5267},{"style":1527},[5268],{"type":433,"value":4155},{"type":427,"tag":518,"props":5270,"children":5272},{"class":520,"line":5271},30,[5273,5277,5282],{"type":427,"tag":518,"props":5274,"children":5275},{"style":525},[5276],{"type":433,"value":2758},{"type":427,"tag":518,"props":5278,"children":5279},{"style":778},[5280],{"type":433,"value":5281}," result",{"type":427,"tag":518,"props":5283,"children":5284},{"style":573},[5285],{"type":433,"value":607},{"type":427,"tag":518,"props":5287,"children":5289},{"class":520,"line":5288},31,[5290],{"type":427,"tag":518,"props":5291,"children":5292},{"style":573},[5293],{"type":433,"value":875},{"type":427,"tag":518,"props":5295,"children":5297},{"class":520,"line":5296},32,[5298],{"type":427,"tag":518,"props":5299,"children":5300},{"style":573},[5301],{"type":433,"value":1364},{"type":427,"tag":441,"props":5303,"children":5304},{},[5305],{"type":433,"value":5306},"KDB 内部代码出现异常时会使用日志将其记录下来。如果没有日志，那么在排查代码问题时简直就是噩梦。KDB 有两套日志的输出目标，分别是系统输出和标准输出设备。日志类记录输出目标、日志级别、线程锁等成员，并通过静态方法 Logv 实现记录日志。锁的最大用处是保证记录顺序。仅有当出现最高级别的日志（kLogLevelEMERG）时，才会跳过锁直接写入。出现 kLogLevelEMERG 时意味着程序遇到了紧急问题，通常会直接退出或是返回 Status 异常，所以这个时候需要及时记录。",{"type":427,"tag":441,"props":5308,"children":5309},{},[5310],{"type":433,"value":5311},"日志级别的划分参考了 Syslog：",{"type":427,"tag":468,"props":5313,"children":5314},{},[5315,5320,5325,5330,5335,5340,5345,5350,5355,5360],{"type":427,"tag":472,"props":5316,"children":5317},{},[5318],{"type":433,"value":5319},"silent: all logging is turned off",{"type":427,"tag":472,"props":5321,"children":5322},{},[5323],{"type":433,"value":5324},"emerg: system is unusable, imminent crash",{"type":427,"tag":472,"props":5326,"children":5327},{},[5328],{"type":433,"value":5329},"alert: error event, immediate action required",{"type":427,"tag":472,"props":5331,"children":5332},{},[5333],{"type":433,"value":5334},"crit: error event, immediate action required",{"type":427,"tag":472,"props":5336,"children":5337},{},[5338],{"type":433,"value":5339},"error: error event, action is required but is not urgent",{"type":427,"tag":472,"props":5341,"children":5342},{},[5343],{"type":433,"value":5344},"warn: events that can be harmful if no action is taken",{"type":427,"tag":472,"props":5346,"children":5347},{},[5348],{"type":433,"value":5349},"notice: unusual events, but no immediate action required",{"type":427,"tag":472,"props":5351,"children":5352},{},[5353],{"type":433,"value":5354},"info: normal operation events, no action required",{"type":427,"tag":472,"props":5356,"children":5357},{},[5358],{"type":433,"value":5359},"debug: events used for debugging, no action required",{"type":427,"tag":472,"props":5361,"children":5362},{},[5363],{"type":433,"value":5364},"trace: fine-grained events used for debugging, no action required",{"type":427,"tag":1394,"props":5366,"children":5368},{"id":5367},"日志调用用宏还是函数",[5369],{"type":433,"value":5367},{"type":427,"tag":441,"props":5371,"children":5372},{},[5373,5375,5381,5383,5387],{"type":433,"value":5374},"原先的提交中，日志调用被定义在了宏里，直接调用 Logger::Logv 去记录。日志宏中使用子宏 ",{"type":427,"tag":5376,"props":5377,"children":5378},"strong",{},[5379],{"type":433,"value":5380},"VA_ARGS",{"type":433,"value":5382}," 来记录可变参数。",{"type":427,"tag":5376,"props":5384,"children":5385},{},[5386],{"type":433,"value":5380},{"type":433,"value":5388}," 前面有标记黏贴运算符的原因是当日志宏的可变参数为空时，可以把末尾的逗号去掉。",{"type":427,"tag":507,"props":5390,"children":5392},{"code":5391,"language":510,"meta":421,"className":511,"style":421},"class log {\n  static void emerg(const char* logname, const char* format, ...) {\n    va_list args;\n    va_start(args, format);\n    Logger::Logv(false, Logger::kLogLevelEMERG, LOG_EMERG, logname, format, args);\n    va_end(args);\n  }\n}\n// ...\n#define LOG_EMERG(logname, fmt, ...) \\\n        Logger::Logv(false, Logger::kLogLevelEMERG, logname, fmt, ##__VA_ARGS__)\n",[5393],{"type":427,"tag":514,"props":5394,"children":5395},{"__ignoreMap":421},[5396,5412,5487,5499,5528,5610,5630,5637,5644,5651,5693],{"type":427,"tag":518,"props":5397,"children":5398},{"class":520,"line":521},[5399,5403,5408],{"type":427,"tag":518,"props":5400,"children":5401},{"style":561},[5402],{"type":433,"value":1938},{"type":427,"tag":518,"props":5404,"children":5405},{"style":588},[5406],{"type":433,"value":5407}," log",{"type":427,"tag":518,"props":5409,"children":5410},{"style":573},[5411],{"type":433,"value":581},{"type":427,"tag":518,"props":5413,"children":5414},{"class":520,"line":548},[5415,5419,5423,5428,5432,5436,5440,5444,5449,5453,5457,5461,5465,5470,5474,5479,5483],{"type":427,"tag":518,"props":5416,"children":5417},{"style":2025},[5418],{"type":433,"value":2028},{"type":427,"tag":518,"props":5420,"children":5421},{"style":561},[5422],{"type":433,"value":2033},{"type":427,"tag":518,"props":5424,"children":5425},{"style":567},[5426],{"type":433,"value":5427}," emerg",{"type":427,"tag":518,"props":5429,"children":5430},{"style":573},[5431],{"type":433,"value":655},{"type":427,"tag":518,"props":5433,"children":5434},{"style":2025},[5435],{"type":433,"value":2537},{"type":427,"tag":518,"props":5437,"children":5438},{"style":561},[5439],{"type":433,"value":5150},{"type":427,"tag":518,"props":5441,"children":5442},{"style":2025},[5443],{"type":433,"value":5155},{"type":427,"tag":518,"props":5445,"children":5446},{"style":1434},[5447],{"type":433,"value":5448}," logname",{"type":427,"tag":518,"props":5450,"children":5451},{"style":573},[5452],{"type":433,"value":665},{"type":427,"tag":518,"props":5454,"children":5455},{"style":2025},[5456],{"type":433,"value":2559},{"type":427,"tag":518,"props":5458,"children":5459},{"style":561},[5460],{"type":433,"value":5150},{"type":427,"tag":518,"props":5462,"children":5463},{"style":2025},[5464],{"type":433,"value":5155},{"type":427,"tag":518,"props":5466,"children":5467},{"style":1434},[5468],{"type":433,"value":5469}," format",{"type":427,"tag":518,"props":5471,"children":5472},{"style":573},[5473],{"type":433,"value":665},{"type":427,"tag":518,"props":5475,"children":5476},{"style":778},[5477],{"type":433,"value":5478}," ...",{"type":427,"tag":518,"props":5480,"children":5481},{"style":573},[5482],{"type":433,"value":1222},{"type":427,"tag":518,"props":5484,"children":5485},{"style":573},[5486],{"type":433,"value":581},{"type":427,"tag":518,"props":5488,"children":5489},{"class":520,"line":557},[5490,5495],{"type":427,"tag":518,"props":5491,"children":5492},{"style":778},[5493],{"type":433,"value":5494},"    va_list args",{"type":427,"tag":518,"props":5496,"children":5497},{"style":573},[5498],{"type":433,"value":607},{"type":427,"tag":518,"props":5500,"children":5501},{"class":520,"line":584},[5502,5507,5511,5516,5520,5524],{"type":427,"tag":518,"props":5503,"children":5504},{"style":567},[5505],{"type":433,"value":5506},"    va_start",{"type":427,"tag":518,"props":5508,"children":5509},{"style":573},[5510],{"type":433,"value":655},{"type":427,"tag":518,"props":5512,"children":5513},{"style":778},[5514],{"type":433,"value":5515},"args",{"type":427,"tag":518,"props":5517,"children":5518},{"style":573},[5519],{"type":433,"value":665},{"type":427,"tag":518,"props":5521,"children":5522},{"style":778},[5523],{"type":433,"value":5469},{"type":427,"tag":518,"props":5525,"children":5526},{"style":573},[5527],{"type":433,"value":685},{"type":427,"tag":518,"props":5529,"children":5530},{"class":520,"line":610},[5531,5536,5540,5545,5549,5554,5558,5563,5567,5572,5576,5581,5585,5589,5593,5597,5601,5606],{"type":427,"tag":518,"props":5532,"children":5533},{"style":588},[5534],{"type":433,"value":5535},"    Logger",{"type":427,"tag":518,"props":5537,"children":5538},{"style":573},[5539],{"type":433,"value":596},{"type":427,"tag":518,"props":5541,"children":5542},{"style":567},[5543],{"type":433,"value":5544},"Logv",{"type":427,"tag":518,"props":5546,"children":5547},{"style":573},[5548],{"type":433,"value":655},{"type":427,"tag":518,"props":5550,"children":5551},{"style":2725},[5552],{"type":433,"value":5553},"false",{"type":427,"tag":518,"props":5555,"children":5556},{"style":573},[5557],{"type":433,"value":665},{"type":427,"tag":518,"props":5559,"children":5560},{"style":588},[5561],{"type":433,"value":5562}," Logger",{"type":427,"tag":518,"props":5564,"children":5565},{"style":573},[5566],{"type":433,"value":596},{"type":427,"tag":518,"props":5568,"children":5569},{"style":778},[5570],{"type":433,"value":5571},"kLogLevelEMERG",{"type":427,"tag":518,"props":5573,"children":5574},{"style":573},[5575],{"type":433,"value":665},{"type":427,"tag":518,"props":5577,"children":5578},{"style":778},[5579],{"type":433,"value":5580}," LOG_EMERG",{"type":427,"tag":518,"props":5582,"children":5583},{"style":573},[5584],{"type":433,"value":665},{"type":427,"tag":518,"props":5586,"children":5587},{"style":778},[5588],{"type":433,"value":5448},{"type":427,"tag":518,"props":5590,"children":5591},{"style":573},[5592],{"type":433,"value":665},{"type":427,"tag":518,"props":5594,"children":5595},{"style":778},[5596],{"type":433,"value":5469},{"type":427,"tag":518,"props":5598,"children":5599},{"style":573},[5600],{"type":433,"value":665},{"type":427,"tag":518,"props":5602,"children":5603},{"style":778},[5604],{"type":433,"value":5605}," args",{"type":427,"tag":518,"props":5607,"children":5608},{"style":573},[5609],{"type":433,"value":685},{"type":427,"tag":518,"props":5611,"children":5612},{"class":520,"line":631},[5613,5618,5622,5626],{"type":427,"tag":518,"props":5614,"children":5615},{"style":567},[5616],{"type":433,"value":5617},"    va_end",{"type":427,"tag":518,"props":5619,"children":5620},{"style":573},[5621],{"type":433,"value":655},{"type":427,"tag":518,"props":5623,"children":5624},{"style":778},[5625],{"type":433,"value":5515},{"type":427,"tag":518,"props":5627,"children":5628},{"style":573},[5629],{"type":433,"value":685},{"type":427,"tag":518,"props":5631,"children":5632},{"class":520,"line":688},[5633],{"type":427,"tag":518,"props":5634,"children":5635},{"style":573},[5636],{"type":433,"value":875},{"type":427,"tag":518,"props":5638,"children":5639},{"class":520,"line":723},[5640],{"type":427,"tag":518,"props":5641,"children":5642},{"style":573},[5643],{"type":433,"value":1364},{"type":427,"tag":518,"props":5645,"children":5646},{"class":520,"line":765},[5647],{"type":427,"tag":518,"props":5648,"children":5649},{"style":1527},[5650],{"type":433,"value":3339},{"type":427,"tag":518,"props":5652,"children":5653},{"class":520,"line":846},[5654,5658,5662,5666,5671,5675,5680,5684,5689],{"type":427,"tag":518,"props":5655,"children":5656},{"style":525},[5657],{"type":433,"value":1898},{"type":427,"tag":518,"props":5659,"children":5660},{"style":567},[5661],{"type":433,"value":5580},{"type":427,"tag":518,"props":5663,"children":5664},{"style":573},[5665],{"type":433,"value":655},{"type":427,"tag":518,"props":5667,"children":5668},{"style":1434},[5669],{"type":433,"value":5670},"logname",{"type":427,"tag":518,"props":5672,"children":5673},{"style":573},[5674],{"type":433,"value":665},{"type":427,"tag":518,"props":5676,"children":5677},{"style":1434},[5678],{"type":433,"value":5679}," fmt",{"type":427,"tag":518,"props":5681,"children":5682},{"style":573},[5683],{"type":433,"value":665},{"type":427,"tag":518,"props":5685,"children":5686},{"style":573},[5687],{"type":433,"value":5688}," ...)",{"type":427,"tag":518,"props":5690,"children":5691},{"style":803},[5692],{"type":433,"value":2284},{"type":427,"tag":518,"props":5694,"children":5695},{"class":520,"line":869},[5696,5701,5705,5709,5713,5717,5721,5725,5729,5733,5737,5741,5745,5749,5753,5758],{"type":427,"tag":518,"props":5697,"children":5698},{"style":588},[5699],{"type":433,"value":5700},"        Logger",{"type":427,"tag":518,"props":5702,"children":5703},{"style":573},[5704],{"type":433,"value":596},{"type":427,"tag":518,"props":5706,"children":5707},{"style":567},[5708],{"type":433,"value":5544},{"type":427,"tag":518,"props":5710,"children":5711},{"style":573},[5712],{"type":433,"value":655},{"type":427,"tag":518,"props":5714,"children":5715},{"style":2725},[5716],{"type":433,"value":5553},{"type":427,"tag":518,"props":5718,"children":5719},{"style":573},[5720],{"type":433,"value":665},{"type":427,"tag":518,"props":5722,"children":5723},{"style":588},[5724],{"type":433,"value":5562},{"type":427,"tag":518,"props":5726,"children":5727},{"style":573},[5728],{"type":433,"value":596},{"type":427,"tag":518,"props":5730,"children":5731},{"style":778},[5732],{"type":433,"value":5571},{"type":427,"tag":518,"props":5734,"children":5735},{"style":573},[5736],{"type":433,"value":665},{"type":427,"tag":518,"props":5738,"children":5739},{"style":778},[5740],{"type":433,"value":5448},{"type":427,"tag":518,"props":5742,"children":5743},{"style":573},[5744],{"type":433,"value":665},{"type":427,"tag":518,"props":5746,"children":5747},{"style":778},[5748],{"type":433,"value":5679},{"type":427,"tag":518,"props":5750,"children":5751},{"style":573},[5752],{"type":433,"value":665},{"type":427,"tag":518,"props":5754,"children":5755},{"style":599},[5756],{"type":433,"value":5757}," ##__VA_ARGS__",{"type":427,"tag":518,"props":5759,"children":5760},{"style":573},[5761],{"type":433,"value":2354},{"type":427,"tag":441,"props":5763,"children":5764},{},[5765],{"type":433,"value":5766},"尚不清楚为什么不用宏，而是使用运行时的方法调用（即 log 的 public 方法）。猜测可能是因为宏不能跨行？因为我看到了这种很长的调用。",{"type":427,"tag":507,"props":5768,"children":5770},{"code":5769,"language":510,"meta":421,"className":511,"style":421},"log::trace(\n  \"Database::PutPartValidSize()\",\n  \"[%s] size_chunk:%\" PRIu64 \" offset_chunk:%\" PRIu64,\n  key.ToString().c_str(),\n  chunk.size(),\n  offset_chunk\n);\n",[5771],{"type":427,"tag":514,"props":5772,"children":5773},{"__ignoreMap":421},[5774,5796,5817,5868,5897,5917,5925],{"type":427,"tag":518,"props":5775,"children":5776},{"class":520,"line":521},[5777,5782,5786,5791],{"type":427,"tag":518,"props":5778,"children":5779},{"style":588},[5780],{"type":433,"value":5781},"log",{"type":427,"tag":518,"props":5783,"children":5784},{"style":573},[5785],{"type":433,"value":596},{"type":427,"tag":518,"props":5787,"children":5788},{"style":567},[5789],{"type":433,"value":5790},"trace",{"type":427,"tag":518,"props":5792,"children":5793},{"style":573},[5794],{"type":433,"value":5795},"(\n",{"type":427,"tag":518,"props":5797,"children":5798},{"class":520,"line":548},[5799,5804,5809,5813],{"type":427,"tag":518,"props":5800,"children":5801},{"style":531},[5802],{"type":433,"value":5803},"  \"",{"type":427,"tag":518,"props":5805,"children":5806},{"style":537},[5807],{"type":433,"value":5808},"Database::PutPartValidSize()",{"type":427,"tag":518,"props":5810,"children":5811},{"style":531},[5812],{"type":433,"value":680},{"type":427,"tag":518,"props":5814,"children":5815},{"style":573},[5816],{"type":433,"value":4878},{"type":427,"tag":518,"props":5818,"children":5819},{"class":520,"line":557},[5820,5824,5828,5832,5837,5841,5846,5850,5855,5859,5864],{"type":427,"tag":518,"props":5821,"children":5822},{"style":531},[5823],{"type":433,"value":5803},{"type":427,"tag":518,"props":5825,"children":5826},{"style":537},[5827],{"type":433,"value":1494},{"type":427,"tag":518,"props":5829,"children":5830},{"style":797},[5831],{"type":433,"value":800},{"type":427,"tag":518,"props":5833,"children":5834},{"style":537},[5835],{"type":433,"value":5836},"] size_chunk:%",{"type":427,"tag":518,"props":5838,"children":5839},{"style":531},[5840],{"type":433,"value":680},{"type":427,"tag":518,"props":5842,"children":5843},{"style":599},[5844],{"type":433,"value":5845}," PRIu64 ",{"type":427,"tag":518,"props":5847,"children":5848},{"style":531},[5849],{"type":433,"value":680},{"type":427,"tag":518,"props":5851,"children":5852},{"style":537},[5853],{"type":433,"value":5854}," offset_chunk:%",{"type":427,"tag":518,"props":5856,"children":5857},{"style":531},[5858],{"type":433,"value":680},{"type":427,"tag":518,"props":5860,"children":5861},{"style":599},[5862],{"type":433,"value":5863}," PRIu64",{"type":427,"tag":518,"props":5865,"children":5866},{"style":573},[5867],{"type":433,"value":4878},{"type":427,"tag":518,"props":5869,"children":5870},{"class":520,"line":584},[5871,5876,5880,5884,5888,5892],{"type":427,"tag":518,"props":5872,"children":5873},{"style":599},[5874],{"type":433,"value":5875},"  key",{"type":427,"tag":518,"props":5877,"children":5878},{"style":573},[5879],{"type":433,"value":710},{"type":427,"tag":518,"props":5881,"children":5882},{"style":567},[5883],{"type":433,"value":828},{"type":427,"tag":518,"props":5885,"children":5886},{"style":573},[5887],{"type":433,"value":833},{"type":427,"tag":518,"props":5889,"children":5890},{"style":567},[5891],{"type":433,"value":838},{"type":427,"tag":518,"props":5893,"children":5894},{"style":573},[5895],{"type":433,"value":5896},"(),\n",{"type":427,"tag":518,"props":5898,"children":5899},{"class":520,"line":610},[5900,5905,5909,5913],{"type":427,"tag":518,"props":5901,"children":5902},{"style":599},[5903],{"type":433,"value":5904},"  chunk",{"type":427,"tag":518,"props":5906,"children":5907},{"style":573},[5908],{"type":433,"value":710},{"type":427,"tag":518,"props":5910,"children":5911},{"style":567},[5912],{"type":433,"value":3662},{"type":427,"tag":518,"props":5914,"children":5915},{"style":573},[5916],{"type":433,"value":5896},{"type":427,"tag":518,"props":5918,"children":5919},{"class":520,"line":631},[5920],{"type":427,"tag":518,"props":5921,"children":5922},{"style":599},[5923],{"type":433,"value":5924},"  offset_chunk\n",{"type":427,"tag":518,"props":5926,"children":5927},{"class":520,"line":688},[5928],{"type":427,"tag":518,"props":5929,"children":5930},{"style":573},[5931],{"type":433,"value":685},{"type":427,"tag":1394,"props":5933,"children":5935},{"id":5934},"日志时间",[5936],{"type":433,"value":5934},{"type":427,"tag":441,"props":5938,"children":5939},{},[5940],{"type":433,"value":5941},"使用系统输出（syslog）时不需要手动记录时间，但是把日志打印出来时却是要的。尤其是在调试时，精确时间非常有用。KDB 使用 Linux 的 timeval、tm 两个结构体，分别拿到精确时间及可读时间，再格式化输出。",{"type":427,"tag":507,"props":5943,"children":5945},{"code":5944,"language":510,"meta":421,"className":511,"style":421},"struct timeval now_tv;\ngettimeofday(&now_tv, NULL);\nconst time_t seconds = now_tv.tv_sec;\nstruct tm t;\n// 初始化 tm 时需要用到当前秒数，\n// 所以需要提前初始化 now_tv\nlocaltime_r(&seconds, &t);\np += snprintf(p, limit - p,\n              \"%04d/%02d/%02d-%02d:%02d:%02d.%06d %s %s \",\n              t.tm_year + 1900,\n              t.tm_mon + 1,\n              t.tm_mday,\n              t.tm_hour,\n              t.tm_min,\n              t.tm_sec,\n              static_cast\u003Cint>(now_tv.tv_usec), // 毫秒\n              ss.str().c_str(),\n              logname);\n",[5946],{"type":427,"tag":514,"props":5947,"children":5948},{"__ignoreMap":421},[5949,5971,6005,6043,6063,6071,6079,6117,6166,6247,6278,6306,6326,6346,6366,6386,6429,6457],{"type":427,"tag":518,"props":5950,"children":5951},{"class":520,"line":521},[5952,5957,5962,5967],{"type":427,"tag":518,"props":5953,"children":5954},{"style":561},[5955],{"type":433,"value":5956},"struct",{"type":427,"tag":518,"props":5958,"children":5959},{"style":588},[5960],{"type":433,"value":5961}," timeval",{"type":427,"tag":518,"props":5963,"children":5964},{"style":599},[5965],{"type":433,"value":5966}," now_tv",{"type":427,"tag":518,"props":5968,"children":5969},{"style":573},[5970],{"type":433,"value":607},{"type":427,"tag":518,"props":5972,"children":5973},{"class":520,"line":548},[5974,5979,5983,5987,5992,5996,6001],{"type":427,"tag":518,"props":5975,"children":5976},{"style":567},[5977],{"type":433,"value":5978},"gettimeofday",{"type":427,"tag":518,"props":5980,"children":5981},{"style":573},[5982],{"type":433,"value":655},{"type":427,"tag":518,"props":5984,"children":5985},{"style":697},[5986],{"type":433,"value":2523},{"type":427,"tag":518,"props":5988,"children":5989},{"style":599},[5990],{"type":433,"value":5991},"now_tv",{"type":427,"tag":518,"props":5993,"children":5994},{"style":573},[5995],{"type":433,"value":665},{"type":427,"tag":518,"props":5997,"children":5998},{"style":2725},[5999],{"type":433,"value":6000}," NULL",{"type":427,"tag":518,"props":6002,"children":6003},{"style":573},[6004],{"type":433,"value":685},{"type":427,"tag":518,"props":6006,"children":6007},{"class":520,"line":557},[6008,6012,6017,6022,6026,6030,6034,6039],{"type":427,"tag":518,"props":6009,"children":6010},{"style":2025},[6011],{"type":433,"value":2537},{"type":427,"tag":518,"props":6013,"children":6014},{"style":561},[6015],{"type":433,"value":6016}," time_t",{"type":427,"tag":518,"props":6018,"children":6019},{"style":599},[6020],{"type":433,"value":6021}," seconds ",{"type":427,"tag":518,"props":6023,"children":6024},{"style":697},[6025],{"type":433,"value":700},{"type":427,"tag":518,"props":6027,"children":6028},{"style":599},[6029],{"type":433,"value":5966},{"type":427,"tag":518,"props":6031,"children":6032},{"style":573},[6033],{"type":433,"value":710},{"type":427,"tag":518,"props":6035,"children":6036},{"style":599},[6037],{"type":433,"value":6038},"tv_sec",{"type":427,"tag":518,"props":6040,"children":6041},{"style":573},[6042],{"type":433,"value":607},{"type":427,"tag":518,"props":6044,"children":6045},{"class":520,"line":584},[6046,6050,6055,6059],{"type":427,"tag":518,"props":6047,"children":6048},{"style":561},[6049],{"type":433,"value":5956},{"type":427,"tag":518,"props":6051,"children":6052},{"style":588},[6053],{"type":433,"value":6054}," tm",{"type":427,"tag":518,"props":6056,"children":6057},{"style":599},[6058],{"type":433,"value":2085},{"type":427,"tag":518,"props":6060,"children":6061},{"style":573},[6062],{"type":433,"value":607},{"type":427,"tag":518,"props":6064,"children":6065},{"class":520,"line":610},[6066],{"type":427,"tag":518,"props":6067,"children":6068},{"style":1527},[6069],{"type":433,"value":6070},"// 初始化 tm 时需要用到当前秒数，\n",{"type":427,"tag":518,"props":6072,"children":6073},{"class":520,"line":631},[6074],{"type":427,"tag":518,"props":6075,"children":6076},{"style":1527},[6077],{"type":433,"value":6078},"// 所以需要提前初始化 now_tv\n",{"type":427,"tag":518,"props":6080,"children":6081},{"class":520,"line":688},[6082,6087,6091,6095,6100,6104,6108,6113],{"type":427,"tag":518,"props":6083,"children":6084},{"style":567},[6085],{"type":433,"value":6086},"localtime_r",{"type":427,"tag":518,"props":6088,"children":6089},{"style":573},[6090],{"type":433,"value":655},{"type":427,"tag":518,"props":6092,"children":6093},{"style":697},[6094],{"type":433,"value":2523},{"type":427,"tag":518,"props":6096,"children":6097},{"style":599},[6098],{"type":433,"value":6099},"seconds",{"type":427,"tag":518,"props":6101,"children":6102},{"style":573},[6103],{"type":433,"value":665},{"type":427,"tag":518,"props":6105,"children":6106},{"style":697},[6107],{"type":433,"value":1153},{"type":427,"tag":518,"props":6109,"children":6110},{"style":599},[6111],{"type":433,"value":6112},"t",{"type":427,"tag":518,"props":6114,"children":6115},{"style":573},[6116],{"type":433,"value":685},{"type":427,"tag":518,"props":6118,"children":6119},{"class":520,"line":723},[6120,6125,6130,6135,6139,6143,6147,6152,6157,6162],{"type":427,"tag":518,"props":6121,"children":6122},{"style":599},[6123],{"type":433,"value":6124},"p ",{"type":427,"tag":518,"props":6126,"children":6127},{"style":697},[6128],{"type":433,"value":6129},"+=",{"type":427,"tag":518,"props":6131,"children":6132},{"style":567},[6133],{"type":433,"value":6134}," snprintf",{"type":427,"tag":518,"props":6136,"children":6137},{"style":573},[6138],{"type":433,"value":655},{"type":427,"tag":518,"props":6140,"children":6141},{"style":599},[6142],{"type":433,"value":441},{"type":427,"tag":518,"props":6144,"children":6145},{"style":573},[6146],{"type":433,"value":665},{"type":427,"tag":518,"props":6148,"children":6149},{"style":599},[6150],{"type":433,"value":6151}," limit ",{"type":427,"tag":518,"props":6153,"children":6154},{"style":697},[6155],{"type":433,"value":6156},"-",{"type":427,"tag":518,"props":6158,"children":6159},{"style":599},[6160],{"type":433,"value":6161}," p",{"type":427,"tag":518,"props":6163,"children":6164},{"style":573},[6165],{"type":433,"value":4878},{"type":427,"tag":518,"props":6167,"children":6168},{"class":520,"line":765},[6169,6174,6179,6184,6189,6193,6197,6201,6205,6209,6213,6217,6221,6225,6230,6235,6239,6243],{"type":427,"tag":518,"props":6170,"children":6171},{"style":531},[6172],{"type":433,"value":6173},"              \"",{"type":427,"tag":518,"props":6175,"children":6176},{"style":797},[6177],{"type":433,"value":6178},"%04d",{"type":427,"tag":518,"props":6180,"children":6181},{"style":537},[6182],{"type":433,"value":6183},"/",{"type":427,"tag":518,"props":6185,"children":6186},{"style":797},[6187],{"type":433,"value":6188},"%02d",{"type":427,"tag":518,"props":6190,"children":6191},{"style":537},[6192],{"type":433,"value":6183},{"type":427,"tag":518,"props":6194,"children":6195},{"style":797},[6196],{"type":433,"value":6188},{"type":427,"tag":518,"props":6198,"children":6199},{"style":537},[6200],{"type":433,"value":6156},{"type":427,"tag":518,"props":6202,"children":6203},{"style":797},[6204],{"type":433,"value":6188},{"type":427,"tag":518,"props":6206,"children":6207},{"style":537},[6208],{"type":433,"value":1623},{"type":427,"tag":518,"props":6210,"children":6211},{"style":797},[6212],{"type":433,"value":6188},{"type":427,"tag":518,"props":6214,"children":6215},{"style":537},[6216],{"type":433,"value":1623},{"type":427,"tag":518,"props":6218,"children":6219},{"style":797},[6220],{"type":433,"value":6188},{"type":427,"tag":518,"props":6222,"children":6223},{"style":537},[6224],{"type":433,"value":710},{"type":427,"tag":518,"props":6226,"children":6227},{"style":797},[6228],{"type":433,"value":6229},"%06d",{"type":427,"tag":518,"props":6231,"children":6232},{"style":797},[6233],{"type":433,"value":6234}," %s",{"type":427,"tag":518,"props":6236,"children":6237},{"style":797},[6238],{"type":433,"value":6234},{"type":427,"tag":518,"props":6240,"children":6241},{"style":531},[6242],{"type":433,"value":670},{"type":427,"tag":518,"props":6244,"children":6245},{"style":573},[6246],{"type":433,"value":4878},{"type":427,"tag":518,"props":6248,"children":6249},{"class":520,"line":846},[6250,6255,6259,6264,6269,6274],{"type":427,"tag":518,"props":6251,"children":6252},{"style":599},[6253],{"type":433,"value":6254},"              t",{"type":427,"tag":518,"props":6256,"children":6257},{"style":573},[6258],{"type":433,"value":710},{"type":427,"tag":518,"props":6260,"children":6261},{"style":599},[6262],{"type":433,"value":6263},"tm_year ",{"type":427,"tag":518,"props":6265,"children":6266},{"style":697},[6267],{"type":433,"value":6268},"+",{"type":427,"tag":518,"props":6270,"children":6271},{"style":859},[6272],{"type":433,"value":6273}," 1900",{"type":427,"tag":518,"props":6275,"children":6276},{"style":573},[6277],{"type":433,"value":4878},{"type":427,"tag":518,"props":6279,"children":6280},{"class":520,"line":869},[6281,6285,6289,6294,6298,6302],{"type":427,"tag":518,"props":6282,"children":6283},{"style":599},[6284],{"type":433,"value":6254},{"type":427,"tag":518,"props":6286,"children":6287},{"style":573},[6288],{"type":433,"value":710},{"type":427,"tag":518,"props":6290,"children":6291},{"style":599},[6292],{"type":433,"value":6293},"tm_mon ",{"type":427,"tag":518,"props":6295,"children":6296},{"style":697},[6297],{"type":433,"value":6268},{"type":427,"tag":518,"props":6299,"children":6300},{"style":859},[6301],{"type":433,"value":3076},{"type":427,"tag":518,"props":6303,"children":6304},{"style":573},[6305],{"type":433,"value":4878},{"type":427,"tag":518,"props":6307,"children":6308},{"class":520,"line":878},[6309,6313,6317,6322],{"type":427,"tag":518,"props":6310,"children":6311},{"style":599},[6312],{"type":433,"value":6254},{"type":427,"tag":518,"props":6314,"children":6315},{"style":573},[6316],{"type":433,"value":710},{"type":427,"tag":518,"props":6318,"children":6319},{"style":599},[6320],{"type":433,"value":6321},"tm_mday",{"type":427,"tag":518,"props":6323,"children":6324},{"style":573},[6325],{"type":433,"value":4878},{"type":427,"tag":518,"props":6327,"children":6328},{"class":520,"line":886},[6329,6333,6337,6342],{"type":427,"tag":518,"props":6330,"children":6331},{"style":599},[6332],{"type":433,"value":6254},{"type":427,"tag":518,"props":6334,"children":6335},{"style":573},[6336],{"type":433,"value":710},{"type":427,"tag":518,"props":6338,"children":6339},{"style":599},[6340],{"type":433,"value":6341},"tm_hour",{"type":427,"tag":518,"props":6343,"children":6344},{"style":573},[6345],{"type":433,"value":4878},{"type":427,"tag":518,"props":6347,"children":6348},{"class":520,"line":929},[6349,6353,6357,6362],{"type":427,"tag":518,"props":6350,"children":6351},{"style":599},[6352],{"type":433,"value":6254},{"type":427,"tag":518,"props":6354,"children":6355},{"style":573},[6356],{"type":433,"value":710},{"type":427,"tag":518,"props":6358,"children":6359},{"style":599},[6360],{"type":433,"value":6361},"tm_min",{"type":427,"tag":518,"props":6363,"children":6364},{"style":573},[6365],{"type":433,"value":4878},{"type":427,"tag":518,"props":6367,"children":6368},{"class":520,"line":970},[6369,6373,6377,6382],{"type":427,"tag":518,"props":6370,"children":6371},{"style":599},[6372],{"type":433,"value":6254},{"type":427,"tag":518,"props":6374,"children":6375},{"style":573},[6376],{"type":433,"value":710},{"type":427,"tag":518,"props":6378,"children":6379},{"style":599},[6380],{"type":433,"value":6381},"tm_sec",{"type":427,"tag":518,"props":6383,"children":6384},{"style":573},[6385],{"type":433,"value":4878},{"type":427,"tag":518,"props":6387,"children":6388},{"class":520,"line":978},[6389,6394,6398,6402,6406,6410,6414,6419,6424],{"type":427,"tag":518,"props":6390,"children":6391},{"style":697},[6392],{"type":433,"value":6393},"              static_cast\u003C",{"type":427,"tag":518,"props":6395,"children":6396},{"style":561},[6397],{"type":433,"value":564},{"type":427,"tag":518,"props":6399,"children":6400},{"style":697},[6401],{"type":433,"value":2505},{"type":427,"tag":518,"props":6403,"children":6404},{"style":573},[6405],{"type":433,"value":655},{"type":427,"tag":518,"props":6407,"children":6408},{"style":599},[6409],{"type":433,"value":5991},{"type":427,"tag":518,"props":6411,"children":6412},{"style":573},[6413],{"type":433,"value":710},{"type":427,"tag":518,"props":6415,"children":6416},{"style":599},[6417],{"type":433,"value":6418},"tv_usec",{"type":427,"tag":518,"props":6420,"children":6421},{"style":573},[6422],{"type":433,"value":6423},"),",{"type":427,"tag":518,"props":6425,"children":6426},{"style":1527},[6427],{"type":433,"value":6428}," // 毫秒\n",{"type":427,"tag":518,"props":6430,"children":6431},{"class":520,"line":999},[6432,6437,6441,6445,6449,6453],{"type":427,"tag":518,"props":6433,"children":6434},{"style":599},[6435],{"type":433,"value":6436},"              ss",{"type":427,"tag":518,"props":6438,"children":6439},{"style":573},[6440],{"type":433,"value":710},{"type":427,"tag":518,"props":6442,"children":6443},{"style":567},[6444],{"type":433,"value":3097},{"type":427,"tag":518,"props":6446,"children":6447},{"style":573},[6448],{"type":433,"value":833},{"type":427,"tag":518,"props":6450,"children":6451},{"style":567},[6452],{"type":433,"value":838},{"type":427,"tag":518,"props":6454,"children":6455},{"style":573},[6456],{"type":433,"value":5896},{"type":427,"tag":518,"props":6458,"children":6459},{"class":520,"line":1055},[6460,6465],{"type":427,"tag":518,"props":6461,"children":6462},{"style":599},[6463],{"type":433,"value":6464},"              logname",{"type":427,"tag":518,"props":6466,"children":6467},{"style":573},[6468],{"type":433,"value":685},{"type":427,"tag":6470,"props":6471,"children":6472},"style",{},[6473],{"type":433,"value":6474},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":421,"searchDepth":548,"depth":548,"links":6476},[6477,6478,6479,6480],{"id":437,"depth":548,"text":437},{"id":498,"depth":548,"text":498},{"id":3480,"depth":548,"text":3480},{"id":3493,"depth":548,"text":3493},"markdown","content:8.source-code:_cpp:kingdb.md","content","8.source-code/_cpp/kingdb.md","8.source-code/_cpp/kingdb","md",[6488,6489],{"_path":398,"title":397,"description":421},{"_path":6490,"title":6491,"description":421},"/source-code/_es/array-slice","Array.prototype.slice",1739578929226]