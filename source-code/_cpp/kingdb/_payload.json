[{"data":1,"prerenderedAt":6458},["Reactive",2],{"navigation":3,"/source-code/_cpp/kingdb":383,"/source-code/_cpp/kingdb-surround":6453},[4,32,80,96,123,129,135,366,372,378],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🌃 长夜梦","/flows/long-night-dream",{"title":15,"_path":16},"🌌 万物联结与幸福感","/flows/everything",{"title":18,"_path":19},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":21,"_path":22},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":24,"_path":25},"🌧️ 我的腼腆","/flows/shy",{"title":27,"_path":28},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":30,"_path":31},"📝 心流归档","/flows/fold",{"title":33,"_path":34,"children":35},"技术博客 / Coder","/articles",[36,38,41,44,47,50,53,56,59,62,65,68,71,74,77],{"title":37,"_path":34},"🦁 为什么我要写博客",{"title":39,"_path":40},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":42,"_path":43},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":45,"_path":46},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":48,"_path":49},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":51,"_path":52},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":54,"_path":55},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":57,"_path":58},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":60,"_path":61},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":63,"_path":64},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":66,"_path":67},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":69,"_path":70},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":72,"_path":73},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":75,"_path":76},"🚝 四十二篇系列","/articles/fourty-two",{"title":78,"_path":79},"📝 技术博客归档","/articles/fold",{"title":81,"_path":82,"children":83},"造物 / Make","/tools",[84,87,90,93],{"title":85,"_path":86},"🌐 AnySort","/tools/anysort",{"title":88,"_path":89},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":91,"_path":92},"👓 Crapto","/tools/crypto-inline",{"title":94,"_path":95},"🖨️ any-to-base64","/tools/any-to-base64",{"title":97,"_path":98,"children":99},"吉他剧场 / Music","/music",[100,102,105,108,111,114,117,120],{"title":101,"_path":98},"🎸 FingerStyle！",{"title":103,"_path":104},"🌬️ 等待的风","/music/wind",{"title":106,"_path":107},"💕 约定的海洋","/music/ocean",{"title":109,"_path":110},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":112,"_path":113},"🌏 残酷天使的行动纲领","/music/eva",{"title":115,"_path":116},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":118,"_path":119},"🍷 Wu Wei","/music/wu-wei",{"title":121,"_path":122},"🌅 无题","/music/untitled",{"title":124,"_path":125,"children":126},"画点什么 / Paint","/paint",[127],{"title":128,"_path":125},"🚧 正在施工",{"title":130,"_path":131,"children":132},"知识地图 / Maps","/maps",[133],{"title":134,"_path":131},"🏁 知识地图",{"title":136,"_path":137,"children":138},"零散的笔记 / Gists","/gists",[139,141,144,147,150,153,156,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255,258,261,264,267,270,273,276,279,282,285,288,291,294,297,300,303,306,309,312,315,318,321,324,327,330,333,336,339,342,345,348,351,354,357,360,363],{"title":140,"_path":137},"🧊 Gists",{"title":142,"_path":143},"网站的可访问性","/gists/accessibility",{"title":145,"_path":146},"图片模糊","/gists/blur",{"title":148,"_path":149},"渲染相关笔记","/gists/c4d",{"title":151,"_path":152},"CDN 问题记录","/gists/cdn",{"title":154,"_path":155},"消毒剂","/gists/cleaner",{"title":157,"_path":158},"Windows Command","/gists/cmd",{"title":160,"_path":161},"Command","/gists/command",{"title":163,"_path":164},"复杂科学","/gists/complexity-science",{"title":166,"_path":167},"宇宙","/gists/cosmos",{"title":169,"_path":170},"C++","/gists/cpp",{"title":172,"_path":173},"Data Structure","/gists/data-structure",{"title":175,"_path":176},"DEPRESSION","/gists/depression",{"title":178,"_path":179},"设计模式","/gists/design-patterns",{"title":181,"_path":182},"Developer Experience","/gists/developer-experience",{"title":184,"_path":185},"Device Metrics","/gists/device-metrix",{"title":187,"_path":188},"ECMAScript Language Specification","/gists/ecmascript-specification",{"title":190,"_path":191},"正则表达式","/gists/eegex",{"title":193,"_path":194},"Emoji","/gists/emoji",{"title":196,"_path":197},"工程","/gists/engineering",{"title":199,"_path":200},"熵","/gists/entropy",{"title":202,"_path":203},"Environment","/gists/environment",{"title":205,"_path":206},"Erlang","/gists/erlang",{"title":208,"_path":209},"逃离塔克夫","/gists/escape-from-tarkov",{"title":211,"_path":212},"ESNext (ES6-ES11)","/gists/esnext",{"title":214,"_path":215},"Eval！","/gists/eval",{"title":217,"_path":218},"Flutter","/gists/flutter",{"title":220,"_path":221},"字体","/gists/font",{"title":223,"_path":224},"JS 函数式编程","/gists/functional",{"title":226,"_path":227},"Google C++ Standard","/gists/google-cpp-standard",{"title":229,"_path":230},"双向链接完全体","/gists/graph",{"title":232,"_path":233},"Hardwares","/gists/hardwares",{"title":235,"_path":236},"哈希冲突","/gists/hash-collision",{"title":238,"_path":239},"信息设计","/gists/information-design",{"title":241,"_path":242},"InstantPage","/gists/instant.page",{"title":244,"_path":245},"ISUX 遇见大数据可视化系列","/gists/isux-data-visualization",{"title":247,"_path":248},"KVStore","/gists/key-value-db",{"title":250,"_path":251},"Kubernetes","/gists/kubernetes",{"title":253,"_path":254},"Makefile","/gists/makefile",{"title":256,"_path":257},"Markdown Inline Style","/gists/markdown-nice",{"title":259,"_path":260},"小程序","/gists/miniapp",{"title":262,"_path":263},"减小页面快照体积","/gists/minify-html",{"title":265,"_path":266},"mklink","/gists/mklink",{"title":268,"_path":269},"Mock","/gists/mock",{"title":271,"_path":272},"多端应用","/gists/multy-end-app",{"title":274,"_path":275},"神经科学","/gists/neuroscience",{"title":277,"_path":278},"OO","/gists/oo",{"title":280,"_path":281},"Opinioned Personal Folder","/gists/opinioned-personal-folder",{"title":283,"_path":284},"人物","/gists/person",{"title":286,"_path":287},"PInvoke","/gists/pinvoke",{"title":289,"_path":290},"像素","/gists/pixel",{"title":292,"_path":293},"PowerShell","/gists/powershell",{"title":295,"_path":296},"量子","/gists/quantum",{"title":298,"_path":299},"保持好奇心","/gists/questions",{"title":301,"_path":302},"React Native","/gists/react-native",{"title":304,"_path":305},"博客改版碰到的浏览器平滑滚动问题","/gists/scroll",{"title":307,"_path":308},"SEO","/gists/seo",{"title":310,"_path":311},"Shader","/gists/shader",{"title":313,"_path":314},"Shape Up","/gists/shape-up",{"title":316,"_path":317},"睡觉","/gists/sleep",{"title":319,"_path":320},"States","/gists/states",{"title":322,"_path":323},"Storage","/gists/storage",{"title":325,"_path":326},"音视频流处理","/gists/stream-cli",{"title":328,"_path":329},"Symbol","/gists/symbol",{"title":331,"_path":332},"系统论","/gists/systems-theory",{"title":334,"_path":335},"Taro","/gists/taro",{"title":337,"_path":338},"任务切片","/gists/task-slice",{"title":340,"_path":341},"技术偏好","/gists/tech-dudge",{"title":343,"_path":344},"Untitled","/gists/untitled",{"title":346,"_path":347},"可变字体","/gists/variable-font",{"title":349,"_path":350},"视觉错觉","/gists/visual-illusion",{"title":352,"_path":353},"SS(SSR)","/gists/vpn",{"title":355,"_path":356},"VS Code 插件开发","/gists/vscode-plugin",{"title":358,"_path":359},"Web Components","/gists/web-components",{"title":361,"_path":362},"Windows","/gists/windows",{"title":364,"_path":365},"查缺补漏","/gists/wrong",{"title":367,"_path":368,"children":369},"代码笔记 / Gists","/source-code",[370],{"title":371,"_path":368},"🚄 代码笔记",{"title":373,"_path":374,"children":375},"我 / Abount","/hire",[376],{"title":377,"_path":374},"📬 技术简历",{"title":379,"_path":380,"children":381},"todo","/todo",[382],{"title":379,"_path":380},{"_path":384,"_dir":385,"_draft":386,"_partial":387,"_locale":388,"title":389,"description":388,"body":390,"_type":6448,"_id":6449,"_source":6450,"_file":6451,"_extension":6452},"/source-code/_cpp/kingdb","_cpp",false,true,"","KingDB",{"type":391,"children":392,"toc":6442},"root",[393,401,407,413,429,434,458,463,468,473,1332,1337,1345,1350,1355,1360,1366,1371,1792,1797,1802,2252,2257,2358,2363,2368,2373,2911,2917,2922,3189,3195,3200,3445,3450,3463,3468,3735,3740,3745,4456,4461,4642,4646,4651,5269,5274,5279,5332,5337,5356,5729,5734,5899,5904,5909,6436],{"type":394,"tag":395,"props":396,"children":398},"element","h1",{"id":397},"kingdb",[399],{"type":400,"value":389},"text",{"type":394,"tag":402,"props":403,"children":405},"h2",{"id":404},"概述",[406],{"type":400,"value":404},{"type":394,"tag":408,"props":409,"children":410},"p",{},[411],{"type":400,"value":412},"源码分两部分，从相关的测试文件，到核心源码。参考 IKVS 系列文章给的架构图，核心源码的阅读顺序沿着 Put、Delete、Get 三个接口，由 Database 一路向 Buffer、Event Manager、Storage Engine、HSTable Manager、File System 相关、Index 前进。最好再看相关快照、迭代器、Multipart 等部分。期间如果遇到简单的帮助函数会先讲帮助函数。",{"type":394,"tag":408,"props":414,"children":415},{},[416,418,427],{"type":400,"value":417},"本来想从第一个 Git Commit 开始看起的。但我 checkout 过去之后，碰到了一堆编译问题，根本跑不通，索性就直接回到 master 来看最新代码了。本文章的源码快照见 ",{"type":394,"tag":419,"props":420,"children":424},"a",{"href":421,"rel":422},"https://github.com/goossaert/kingdb/tree/58994280e789fc7248d61371f03a6c04c844c197",[423],"nofollow",[425],{"type":400,"value":426},"KingDB@58994",{"type":400,"value":428},"。阅读源码前可以先看一下 KingDB 的 Readme：doc/kingdb.md 以及 doc/kingserver.md。",{"type":394,"tag":408,"props":430,"children":431},{},[432],{"type":400,"value":433},"下文可能出现的缩写：",{"type":394,"tag":435,"props":436,"children":437},"ul",{},[438,444],{"type":394,"tag":439,"props":440,"children":441},"li",{},[442],{"type":400,"value":443},"KDB：KingDB，泛指，有时指 KingDB 程序，有时指 KingDB 源码。",{"type":394,"tag":439,"props":445,"children":446},{},[447,449,456],{"type":400,"value":448},"IKVS：作者相关 KingDB 做的一些调研及笔记的博客系列。这个系列从 13 年开始写，现在还没写完... 见 ",{"type":394,"tag":419,"props":450,"children":453},{"href":451,"rel":452},"https://codecapsule.com/2012/11/07/ikvs-implementing-a-key-value-store-table-of-contents/",[423],[454],{"type":400,"value":455},"IKVS",{"type":400,"value":457},"。",{"type":394,"tag":408,"props":459,"children":460},{},[461],{"type":400,"value":462},"另，为了简便起见，下文给出的代码很可能并非原本的代码，而是截取或经过剔除后的部分代码。比如说，去除了某函数中的错误处理，使之代码更短，更容易展示。",{"type":394,"tag":402,"props":464,"children":466},{"id":465},"从测试开始",[467],{"type":400,"value":465},{"type":394,"tag":408,"props":469,"children":470},{},[471],{"type":400,"value":472},"Emmanuel 给了一个典型的 KDB 用户使用示例，见 unit-tests/kingdb_user.cc。通过此示例，能大概了解 KDB 的接口及如何使用该接口。创建数据库、存入、读取前都需要创建对应的参数配置 Options；这些动作通过 Status 对象来回传操作成功与否。",{"type":394,"tag":474,"props":475,"children":479},"pre",{"code":476,"language":477,"meta":388,"className":478,"style":388},"#include \u003Ckingdb/kdb.h>\n\nint main() {\n  kdb::Status s;\n  kdb::DatabaseOptions db_options;\n  kdb::Database db(db_options, \"mylocaldb\");\n  s = db.Open();\n  if (!s.IsOK()) {\n    fprintf(stderr, \"Could not open the database: %s\\n\", s.ToString().c_str());\n    exit(1);\n  }\n\n  std::string key1(\"key1\");\n  std::string value1(\"value1\");\n\n  kdb::WriteOptions write_options;\n  s = db.Put(write_options, key1, value1);\n\n  kdb::ReadOptions read_options;\n  std::string out_str;\n  s = db.Get(read_options, key1, &out_str);\n  if (s.IsOK() && out_str == \"value1\") {\n    printf(\"Data successfully stored and retrieved\\n\"); \n  } else {\n    printf(\"An error occurred\\n\"); \n  }\n\n  return 0;\n}\n","cpp","language-cpp shiki shiki-themes material-theme-lighter github-light github-dark monokai",[480],{"type":394,"tag":481,"props":482,"children":483},"code",{"__ignoreMap":388},[484,513,522,549,575,596,653,688,730,811,834,843,851,894,935,943,964,1020,1028,1049,1070,1130,1194,1234,1252,1289,1297,1305,1323],{"type":394,"tag":485,"props":486,"children":489},"span",{"class":487,"line":488},"line",1,[490,496,502,508],{"type":394,"tag":485,"props":491,"children":493},{"style":492},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:inherit",[494],{"type":400,"value":495},"#include",{"type":394,"tag":485,"props":497,"children":499},{"style":498},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[500],{"type":400,"value":501}," \u003C",{"type":394,"tag":485,"props":503,"children":505},{"style":504},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[506],{"type":400,"value":507},"kingdb/kdb.h",{"type":394,"tag":485,"props":509,"children":510},{"style":498},[511],{"type":400,"value":512},">\n",{"type":394,"tag":485,"props":514,"children":516},{"class":487,"line":515},2,[517],{"type":394,"tag":485,"props":518,"children":519},{"emptyLinePlaceholder":387},[520],{"type":400,"value":521},"\n",{"type":394,"tag":485,"props":523,"children":525},{"class":487,"line":524},3,[526,532,538,544],{"type":394,"tag":485,"props":527,"children":529},{"style":528},"--shiki-light:#9C3EDA;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#66D9EF;--shiki-light-font-style:inherit;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[530],{"type":400,"value":531},"int",{"type":394,"tag":485,"props":533,"children":535},{"style":534},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[536],{"type":400,"value":537}," main",{"type":394,"tag":485,"props":539,"children":541},{"style":540},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[542],{"type":400,"value":543},"()",{"type":394,"tag":485,"props":545,"children":546},{"style":540},[547],{"type":400,"value":548}," {\n",{"type":394,"tag":485,"props":550,"children":552},{"class":487,"line":551},4,[553,559,564,570],{"type":394,"tag":485,"props":554,"children":556},{"style":555},"--shiki-light:#E2931D;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E;--shiki-light-text-decoration:inherit;--shiki-default-text-decoration:inherit;--shiki-dark-text-decoration:inherit;--shiki-sepia-text-decoration:underline",[557],{"type":400,"value":558},"  kdb",{"type":394,"tag":485,"props":560,"children":561},{"style":540},[562],{"type":400,"value":563},"::",{"type":394,"tag":485,"props":565,"children":567},{"style":566},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[568],{"type":400,"value":569},"Status s",{"type":394,"tag":485,"props":571,"children":572},{"style":540},[573],{"type":400,"value":574},";\n",{"type":394,"tag":485,"props":576,"children":578},{"class":487,"line":577},5,[579,583,587,592],{"type":394,"tag":485,"props":580,"children":581},{"style":555},[582],{"type":400,"value":558},{"type":394,"tag":485,"props":584,"children":585},{"style":540},[586],{"type":400,"value":563},{"type":394,"tag":485,"props":588,"children":589},{"style":566},[590],{"type":400,"value":591},"DatabaseOptions db_options",{"type":394,"tag":485,"props":593,"children":594},{"style":540},[595],{"type":400,"value":574},{"type":394,"tag":485,"props":597,"children":599},{"class":487,"line":598},6,[600,604,608,613,618,623,628,633,638,643,648],{"type":394,"tag":485,"props":601,"children":602},{"style":555},[603],{"type":400,"value":558},{"type":394,"tag":485,"props":605,"children":606},{"style":540},[607],{"type":400,"value":563},{"type":394,"tag":485,"props":609,"children":610},{"style":566},[611],{"type":400,"value":612},"Database ",{"type":394,"tag":485,"props":614,"children":615},{"style":534},[616],{"type":400,"value":617},"db",{"type":394,"tag":485,"props":619,"children":620},{"style":540},[621],{"type":400,"value":622},"(",{"type":394,"tag":485,"props":624,"children":625},{"style":566},[626],{"type":400,"value":627},"db_options",{"type":394,"tag":485,"props":629,"children":630},{"style":540},[631],{"type":400,"value":632},",",{"type":394,"tag":485,"props":634,"children":635},{"style":498},[636],{"type":400,"value":637}," \"",{"type":394,"tag":485,"props":639,"children":640},{"style":504},[641],{"type":400,"value":642},"mylocaldb",{"type":394,"tag":485,"props":644,"children":645},{"style":498},[646],{"type":400,"value":647},"\"",{"type":394,"tag":485,"props":649,"children":650},{"style":540},[651],{"type":400,"value":652},");\n",{"type":394,"tag":485,"props":654,"children":656},{"class":487,"line":655},7,[657,662,668,673,678,683],{"type":394,"tag":485,"props":658,"children":659},{"style":566},[660],{"type":400,"value":661},"  s ",{"type":394,"tag":485,"props":663,"children":665},{"style":664},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[666],{"type":400,"value":667},"=",{"type":394,"tag":485,"props":669,"children":670},{"style":566},[671],{"type":400,"value":672}," db",{"type":394,"tag":485,"props":674,"children":675},{"style":540},[676],{"type":400,"value":677},".",{"type":394,"tag":485,"props":679,"children":680},{"style":534},[681],{"type":400,"value":682},"Open",{"type":394,"tag":485,"props":684,"children":685},{"style":540},[686],{"type":400,"value":687},"();\n",{"type":394,"tag":485,"props":689,"children":691},{"class":487,"line":690},8,[692,697,702,707,712,716,721,726],{"type":394,"tag":485,"props":693,"children":694},{"style":492},[695],{"type":400,"value":696},"  if",{"type":394,"tag":485,"props":698,"children":699},{"style":540},[700],{"type":400,"value":701}," (",{"type":394,"tag":485,"props":703,"children":704},{"style":664},[705],{"type":400,"value":706},"!",{"type":394,"tag":485,"props":708,"children":709},{"style":566},[710],{"type":400,"value":711},"s",{"type":394,"tag":485,"props":713,"children":714},{"style":540},[715],{"type":400,"value":677},{"type":394,"tag":485,"props":717,"children":718},{"style":534},[719],{"type":400,"value":720},"IsOK",{"type":394,"tag":485,"props":722,"children":723},{"style":540},[724],{"type":400,"value":725},"())",{"type":394,"tag":485,"props":727,"children":728},{"style":540},[729],{"type":400,"value":548},{"type":394,"tag":485,"props":731,"children":733},{"class":487,"line":732},9,[734,739,743,749,753,757,762,768,774,778,782,787,791,796,801,806],{"type":394,"tag":485,"props":735,"children":736},{"style":534},[737],{"type":400,"value":738},"    fprintf",{"type":394,"tag":485,"props":740,"children":741},{"style":540},[742],{"type":400,"value":622},{"type":394,"tag":485,"props":744,"children":746},{"style":745},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[747],{"type":400,"value":748},"stderr",{"type":394,"tag":485,"props":750,"children":751},{"style":540},[752],{"type":400,"value":632},{"type":394,"tag":485,"props":754,"children":755},{"style":498},[756],{"type":400,"value":637},{"type":394,"tag":485,"props":758,"children":759},{"style":504},[760],{"type":400,"value":761},"Could not open the database: ",{"type":394,"tag":485,"props":763,"children":765},{"style":764},"--shiki-light:#E53935;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[766],{"type":400,"value":767},"%s",{"type":394,"tag":485,"props":769,"children":771},{"style":770},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[772],{"type":400,"value":773},"\\n",{"type":394,"tag":485,"props":775,"children":776},{"style":498},[777],{"type":400,"value":647},{"type":394,"tag":485,"props":779,"children":780},{"style":540},[781],{"type":400,"value":632},{"type":394,"tag":485,"props":783,"children":784},{"style":566},[785],{"type":400,"value":786}," s",{"type":394,"tag":485,"props":788,"children":789},{"style":540},[790],{"type":400,"value":677},{"type":394,"tag":485,"props":792,"children":793},{"style":534},[794],{"type":400,"value":795},"ToString",{"type":394,"tag":485,"props":797,"children":798},{"style":540},[799],{"type":400,"value":800},"().",{"type":394,"tag":485,"props":802,"children":803},{"style":534},[804],{"type":400,"value":805},"c_str",{"type":394,"tag":485,"props":807,"children":808},{"style":540},[809],{"type":400,"value":810},"());\n",{"type":394,"tag":485,"props":812,"children":814},{"class":487,"line":813},10,[815,820,824,830],{"type":394,"tag":485,"props":816,"children":817},{"style":534},[818],{"type":400,"value":819},"    exit",{"type":394,"tag":485,"props":821,"children":822},{"style":540},[823],{"type":400,"value":622},{"type":394,"tag":485,"props":825,"children":827},{"style":826},"--shiki-light:#F76D47;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[828],{"type":400,"value":829},"1",{"type":394,"tag":485,"props":831,"children":832},{"style":540},[833],{"type":400,"value":652},{"type":394,"tag":485,"props":835,"children":837},{"class":487,"line":836},11,[838],{"type":394,"tag":485,"props":839,"children":840},{"style":540},[841],{"type":400,"value":842},"  }\n",{"type":394,"tag":485,"props":844,"children":846},{"class":487,"line":845},12,[847],{"type":394,"tag":485,"props":848,"children":849},{"emptyLinePlaceholder":387},[850],{"type":400,"value":521},{"type":394,"tag":485,"props":852,"children":854},{"class":487,"line":853},13,[855,860,864,869,874,878,882,886,890],{"type":394,"tag":485,"props":856,"children":857},{"style":555},[858],{"type":400,"value":859},"  std",{"type":394,"tag":485,"props":861,"children":862},{"style":540},[863],{"type":400,"value":563},{"type":394,"tag":485,"props":865,"children":866},{"style":566},[867],{"type":400,"value":868},"string ",{"type":394,"tag":485,"props":870,"children":871},{"style":534},[872],{"type":400,"value":873},"key1",{"type":394,"tag":485,"props":875,"children":876},{"style":540},[877],{"type":400,"value":622},{"type":394,"tag":485,"props":879,"children":880},{"style":498},[881],{"type":400,"value":647},{"type":394,"tag":485,"props":883,"children":884},{"style":504},[885],{"type":400,"value":873},{"type":394,"tag":485,"props":887,"children":888},{"style":498},[889],{"type":400,"value":647},{"type":394,"tag":485,"props":891,"children":892},{"style":540},[893],{"type":400,"value":652},{"type":394,"tag":485,"props":895,"children":897},{"class":487,"line":896},14,[898,902,906,910,915,919,923,927,931],{"type":394,"tag":485,"props":899,"children":900},{"style":555},[901],{"type":400,"value":859},{"type":394,"tag":485,"props":903,"children":904},{"style":540},[905],{"type":400,"value":563},{"type":394,"tag":485,"props":907,"children":908},{"style":566},[909],{"type":400,"value":868},{"type":394,"tag":485,"props":911,"children":912},{"style":534},[913],{"type":400,"value":914},"value1",{"type":394,"tag":485,"props":916,"children":917},{"style":540},[918],{"type":400,"value":622},{"type":394,"tag":485,"props":920,"children":921},{"style":498},[922],{"type":400,"value":647},{"type":394,"tag":485,"props":924,"children":925},{"style":504},[926],{"type":400,"value":914},{"type":394,"tag":485,"props":928,"children":929},{"style":498},[930],{"type":400,"value":647},{"type":394,"tag":485,"props":932,"children":933},{"style":540},[934],{"type":400,"value":652},{"type":394,"tag":485,"props":936,"children":938},{"class":487,"line":937},15,[939],{"type":394,"tag":485,"props":940,"children":941},{"emptyLinePlaceholder":387},[942],{"type":400,"value":521},{"type":394,"tag":485,"props":944,"children":946},{"class":487,"line":945},16,[947,951,955,960],{"type":394,"tag":485,"props":948,"children":949},{"style":555},[950],{"type":400,"value":558},{"type":394,"tag":485,"props":952,"children":953},{"style":540},[954],{"type":400,"value":563},{"type":394,"tag":485,"props":956,"children":957},{"style":566},[958],{"type":400,"value":959},"WriteOptions write_options",{"type":394,"tag":485,"props":961,"children":962},{"style":540},[963],{"type":400,"value":574},{"type":394,"tag":485,"props":965,"children":967},{"class":487,"line":966},17,[968,972,976,980,984,989,993,998,1002,1007,1011,1016],{"type":394,"tag":485,"props":969,"children":970},{"style":566},[971],{"type":400,"value":661},{"type":394,"tag":485,"props":973,"children":974},{"style":664},[975],{"type":400,"value":667},{"type":394,"tag":485,"props":977,"children":978},{"style":566},[979],{"type":400,"value":672},{"type":394,"tag":485,"props":981,"children":982},{"style":540},[983],{"type":400,"value":677},{"type":394,"tag":485,"props":985,"children":986},{"style":534},[987],{"type":400,"value":988},"Put",{"type":394,"tag":485,"props":990,"children":991},{"style":540},[992],{"type":400,"value":622},{"type":394,"tag":485,"props":994,"children":995},{"style":566},[996],{"type":400,"value":997},"write_options",{"type":394,"tag":485,"props":999,"children":1000},{"style":540},[1001],{"type":400,"value":632},{"type":394,"tag":485,"props":1003,"children":1004},{"style":566},[1005],{"type":400,"value":1006}," key1",{"type":394,"tag":485,"props":1008,"children":1009},{"style":540},[1010],{"type":400,"value":632},{"type":394,"tag":485,"props":1012,"children":1013},{"style":566},[1014],{"type":400,"value":1015}," value1",{"type":394,"tag":485,"props":1017,"children":1018},{"style":540},[1019],{"type":400,"value":652},{"type":394,"tag":485,"props":1021,"children":1023},{"class":487,"line":1022},18,[1024],{"type":394,"tag":485,"props":1025,"children":1026},{"emptyLinePlaceholder":387},[1027],{"type":400,"value":521},{"type":394,"tag":485,"props":1029,"children":1031},{"class":487,"line":1030},19,[1032,1036,1040,1045],{"type":394,"tag":485,"props":1033,"children":1034},{"style":555},[1035],{"type":400,"value":558},{"type":394,"tag":485,"props":1037,"children":1038},{"style":540},[1039],{"type":400,"value":563},{"type":394,"tag":485,"props":1041,"children":1042},{"style":566},[1043],{"type":400,"value":1044},"ReadOptions read_options",{"type":394,"tag":485,"props":1046,"children":1047},{"style":540},[1048],{"type":400,"value":574},{"type":394,"tag":485,"props":1050,"children":1052},{"class":487,"line":1051},20,[1053,1057,1061,1066],{"type":394,"tag":485,"props":1054,"children":1055},{"style":555},[1056],{"type":400,"value":859},{"type":394,"tag":485,"props":1058,"children":1059},{"style":540},[1060],{"type":400,"value":563},{"type":394,"tag":485,"props":1062,"children":1063},{"style":566},[1064],{"type":400,"value":1065},"string out_str",{"type":394,"tag":485,"props":1067,"children":1068},{"style":540},[1069],{"type":400,"value":574},{"type":394,"tag":485,"props":1071,"children":1073},{"class":487,"line":1072},21,[1074,1078,1082,1086,1090,1095,1099,1104,1108,1112,1116,1121,1126],{"type":394,"tag":485,"props":1075,"children":1076},{"style":566},[1077],{"type":400,"value":661},{"type":394,"tag":485,"props":1079,"children":1080},{"style":664},[1081],{"type":400,"value":667},{"type":394,"tag":485,"props":1083,"children":1084},{"style":566},[1085],{"type":400,"value":672},{"type":394,"tag":485,"props":1087,"children":1088},{"style":540},[1089],{"type":400,"value":677},{"type":394,"tag":485,"props":1091,"children":1092},{"style":534},[1093],{"type":400,"value":1094},"Get",{"type":394,"tag":485,"props":1096,"children":1097},{"style":540},[1098],{"type":400,"value":622},{"type":394,"tag":485,"props":1100,"children":1101},{"style":566},[1102],{"type":400,"value":1103},"read_options",{"type":394,"tag":485,"props":1105,"children":1106},{"style":540},[1107],{"type":400,"value":632},{"type":394,"tag":485,"props":1109,"children":1110},{"style":566},[1111],{"type":400,"value":1006},{"type":394,"tag":485,"props":1113,"children":1114},{"style":540},[1115],{"type":400,"value":632},{"type":394,"tag":485,"props":1117,"children":1118},{"style":664},[1119],{"type":400,"value":1120}," &",{"type":394,"tag":485,"props":1122,"children":1123},{"style":566},[1124],{"type":400,"value":1125},"out_str",{"type":394,"tag":485,"props":1127,"children":1128},{"style":540},[1129],{"type":400,"value":652},{"type":394,"tag":485,"props":1131,"children":1133},{"class":487,"line":1132},22,[1134,1138,1142,1146,1150,1154,1158,1163,1168,1173,1177,1181,1185,1190],{"type":394,"tag":485,"props":1135,"children":1136},{"style":492},[1137],{"type":400,"value":696},{"type":394,"tag":485,"props":1139,"children":1140},{"style":540},[1141],{"type":400,"value":701},{"type":394,"tag":485,"props":1143,"children":1144},{"style":566},[1145],{"type":400,"value":711},{"type":394,"tag":485,"props":1147,"children":1148},{"style":540},[1149],{"type":400,"value":677},{"type":394,"tag":485,"props":1151,"children":1152},{"style":534},[1153],{"type":400,"value":720},{"type":394,"tag":485,"props":1155,"children":1156},{"style":540},[1157],{"type":400,"value":543},{"type":394,"tag":485,"props":1159,"children":1160},{"style":664},[1161],{"type":400,"value":1162}," &&",{"type":394,"tag":485,"props":1164,"children":1165},{"style":566},[1166],{"type":400,"value":1167}," out_str ",{"type":394,"tag":485,"props":1169,"children":1170},{"style":664},[1171],{"type":400,"value":1172},"==",{"type":394,"tag":485,"props":1174,"children":1175},{"style":498},[1176],{"type":400,"value":637},{"type":394,"tag":485,"props":1178,"children":1179},{"style":504},[1180],{"type":400,"value":914},{"type":394,"tag":485,"props":1182,"children":1183},{"style":498},[1184],{"type":400,"value":647},{"type":394,"tag":485,"props":1186,"children":1187},{"style":540},[1188],{"type":400,"value":1189},")",{"type":394,"tag":485,"props":1191,"children":1192},{"style":540},[1193],{"type":400,"value":548},{"type":394,"tag":485,"props":1195,"children":1197},{"class":487,"line":1196},23,[1198,1203,1207,1211,1216,1220,1224,1229],{"type":394,"tag":485,"props":1199,"children":1200},{"style":534},[1201],{"type":400,"value":1202},"    printf",{"type":394,"tag":485,"props":1204,"children":1205},{"style":540},[1206],{"type":400,"value":622},{"type":394,"tag":485,"props":1208,"children":1209},{"style":498},[1210],{"type":400,"value":647},{"type":394,"tag":485,"props":1212,"children":1213},{"style":504},[1214],{"type":400,"value":1215},"Data successfully stored and retrieved",{"type":394,"tag":485,"props":1217,"children":1218},{"style":770},[1219],{"type":400,"value":773},{"type":394,"tag":485,"props":1221,"children":1222},{"style":498},[1223],{"type":400,"value":647},{"type":394,"tag":485,"props":1225,"children":1226},{"style":540},[1227],{"type":400,"value":1228},");",{"type":394,"tag":485,"props":1230,"children":1231},{"style":745},[1232],{"type":400,"value":1233}," \n",{"type":394,"tag":485,"props":1235,"children":1237},{"class":487,"line":1236},24,[1238,1243,1248],{"type":394,"tag":485,"props":1239,"children":1240},{"style":540},[1241],{"type":400,"value":1242},"  }",{"type":394,"tag":485,"props":1244,"children":1245},{"style":492},[1246],{"type":400,"value":1247}," else",{"type":394,"tag":485,"props":1249,"children":1250},{"style":540},[1251],{"type":400,"value":548},{"type":394,"tag":485,"props":1253,"children":1255},{"class":487,"line":1254},25,[1256,1260,1264,1268,1273,1277,1281,1285],{"type":394,"tag":485,"props":1257,"children":1258},{"style":534},[1259],{"type":400,"value":1202},{"type":394,"tag":485,"props":1261,"children":1262},{"style":540},[1263],{"type":400,"value":622},{"type":394,"tag":485,"props":1265,"children":1266},{"style":498},[1267],{"type":400,"value":647},{"type":394,"tag":485,"props":1269,"children":1270},{"style":504},[1271],{"type":400,"value":1272},"An error occurred",{"type":394,"tag":485,"props":1274,"children":1275},{"style":770},[1276],{"type":400,"value":773},{"type":394,"tag":485,"props":1278,"children":1279},{"style":498},[1280],{"type":400,"value":647},{"type":394,"tag":485,"props":1282,"children":1283},{"style":540},[1284],{"type":400,"value":1228},{"type":394,"tag":485,"props":1286,"children":1287},{"style":745},[1288],{"type":400,"value":1233},{"type":394,"tag":485,"props":1290,"children":1292},{"class":487,"line":1291},26,[1293],{"type":394,"tag":485,"props":1294,"children":1295},{"style":540},[1296],{"type":400,"value":842},{"type":394,"tag":485,"props":1298,"children":1300},{"class":487,"line":1299},27,[1301],{"type":394,"tag":485,"props":1302,"children":1303},{"emptyLinePlaceholder":387},[1304],{"type":400,"value":521},{"type":394,"tag":485,"props":1306,"children":1308},{"class":487,"line":1307},28,[1309,1314,1319],{"type":394,"tag":485,"props":1310,"children":1311},{"style":492},[1312],{"type":400,"value":1313},"  return",{"type":394,"tag":485,"props":1315,"children":1316},{"style":826},[1317],{"type":400,"value":1318}," 0",{"type":394,"tag":485,"props":1320,"children":1321},{"style":540},[1322],{"type":400,"value":574},{"type":394,"tag":485,"props":1324,"children":1326},{"class":487,"line":1325},29,[1327],{"type":394,"tag":485,"props":1328,"children":1329},{"style":540},[1330],{"type":400,"value":1331},"}\n",{"type":394,"tag":408,"props":1333,"children":1334},{},[1335],{"type":400,"value":1336},"测试的入口文件是 unit-tests/test_db.cc。以我看过的 JS 库来看，这是一个基本的功能测试。编译好 KDB 之后，运行编译出的二进制文件 test_db 可以开始测试。测试结果输出到控制台，如下代码所示。",{"type":394,"tag":474,"props":1338,"children":1340},{"code":1339},"==== Test DBTest.CloseAndReopen\n==== Test DBTest.RepairInvalidDatabaseOptionFile\n==== Test DBTest.KeysWithNullBytes\n==== Test DBTest.TestStringInterface\nDatabase Options: Stage 0 - Incompressible data with LZ4 compression enabled\nDatabase Options: Stage 1 - Compressible data with LZ4 compression enabled\nDatabase Options: Stage 2 - Compression disabled\nDatabase Options: Stage 3 - 64-bit MurmurHash3\nDatabase Options: Stage 4 - Checksum verification with incompressible data\nDatabase Options: Stage 5 - Checksum verification with compressible data\nDatabase Options: Stage 6 - Checksum verification with compression disabled\nDatabase Options: Stage 7 - Synced writes\nDatabase Options: Stage 8 - Small-sized HSTables with compression disabled\nDatabase Options: Stage 9 - Small-sized HSTables with incompressible data and LZ4 compression\nDatabase Options: Stage 10 - Small-sized HSTables with compressible data and LZ4 compression\nDatabase Options: Stage 11 - Direct mode for Write Buffer (incompressible data with LZ4 compression enabled)\nDatabase Options: Stage 12 - Direct mode for Write Buffer (compressible data with LZ4 compression enabled)\n==== Test DBTest.MultipartReader\n// the same with last stages\n==== Test DBTest.SingleThreadSmallEntries\n// the same with last stages\n==== Test DBTest.SingleThreadSnapshot\n// the same with last stages\n==== Test DBTest.SingleThreadSmallEntriesCompaction\n// the same with last stages\n==== Test DBTest.SequentialIterator\n// the same with last stages\n==== Test DBTest.SingleThreadSingleLargeEntry\n// the same with last stages\n==== Test DBTest.FileUtil\nmysize: 268435456\nOK\n89 ms\nFree size: 944 GB\n==== PASSED 11 tests\n",[1341],{"type":394,"tag":481,"props":1342,"children":1343},{"__ignoreMap":388},[1344],{"type":400,"value":1339},{"type":394,"tag":408,"props":1346,"children":1347},{},[1348],{"type":400,"value":1349},"每个功能点如数据库初始化和关闭 CloseAndReopen、存入带结束符的键 KeysWithNullBytes 都使用对应继承了 DBTest 的测试类进行测试。涉及到与数据库交互的功能部分如 TestStringInterface 使用循环，遍历了所有数据库 Options 可以设置的情况（但是只是二维循环，没有测试参数间的组合）。即对应上文的 Stage 1、Stage 2...",{"type":394,"tag":408,"props":1351,"children":1352},{},[1353],{"type":400,"value":1354},"在 test_db 创建相应的测试类时，会自动调用测试套件（unit-tests/testharness.cc）中的 RegisterTest 把测试函数储存起来。以便运行测试时，通过读取环境变量来判断是否要跳过某类测试。",{"type":394,"tag":408,"props":1356,"children":1357},{},[1358],{"type":400,"value":1359},"测试代码的实现还有一些有意思的地方，以下提及。",{"type":394,"tag":1361,"props":1362,"children":1364},"h4",{"id":1363},"信号处理",[1365],{"type":400,"value":1363},{"type":394,"tag":408,"props":1367,"children":1368},{},[1369],{"type":400,"value":1370},"和数据库核心的入口函数一样，使用 signal 挂载了对 SIGSEGV、SIGABRT 信号的处理。这两个信号分别指代系统内存错误和系统中断。而处理函数非常简单，就是 IKVS 中提到的“let it die”风格：输出调用栈，立马结束程序。",{"type":394,"tag":474,"props":1372,"children":1374},{"code":1373,"language":477,"meta":388,"className":478,"style":388},"void handler(int sig) {\n  int depth_max = 20;\n  void *array[depth_max];\n  size_t depth;\n  // backtrace 将前 depth_max 层栈帧记录到 array 数组中，\n  // 再通过 backtrace_symbols_fd 输出到 stderr。\n  // 文档见：https://man7.org/linux/man-pages/man3/backtrace.3.html\n  depth = backtrace(array, depth_max);\n  fprintf(stderr, \"Error: signal %d:\\n\", sig);\n  backtrace_symbols_fd(array, depth, STDERR_FILENO);\n  exit(1);\n}\nint main() {\n  signal(SIGSEGV, handler);\n  signal(SIGABRT, handler);\n  return kdb::test::RunAllTests();\n}\n",[1375],{"type":394,"tag":481,"props":1376,"children":1377},{"__ignoreMap":388},[1378,1413,1439,1472,1489,1498,1506,1514,1552,1611,1648,1668,1675,1694,1723,1751,1785],{"type":394,"tag":485,"props":1379,"children":1380},{"class":487,"line":488},[1381,1386,1391,1395,1399,1405,1409],{"type":394,"tag":485,"props":1382,"children":1383},{"style":528},[1384],{"type":400,"value":1385},"void",{"type":394,"tag":485,"props":1387,"children":1388},{"style":534},[1389],{"type":400,"value":1390}," handler",{"type":394,"tag":485,"props":1392,"children":1393},{"style":540},[1394],{"type":400,"value":622},{"type":394,"tag":485,"props":1396,"children":1397},{"style":528},[1398],{"type":400,"value":531},{"type":394,"tag":485,"props":1400,"children":1402},{"style":1401},"--shiki-light:#90A4AE;--shiki-default:#E36209;--shiki-dark:#FFAB70;--shiki-sepia:#FD971F;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[1403],{"type":400,"value":1404}," sig",{"type":394,"tag":485,"props":1406,"children":1407},{"style":540},[1408],{"type":400,"value":1189},{"type":394,"tag":485,"props":1410,"children":1411},{"style":540},[1412],{"type":400,"value":548},{"type":394,"tag":485,"props":1414,"children":1415},{"class":487,"line":515},[1416,1421,1426,1430,1435],{"type":394,"tag":485,"props":1417,"children":1418},{"style":528},[1419],{"type":400,"value":1420},"  int",{"type":394,"tag":485,"props":1422,"children":1423},{"style":566},[1424],{"type":400,"value":1425}," depth_max ",{"type":394,"tag":485,"props":1427,"children":1428},{"style":664},[1429],{"type":400,"value":667},{"type":394,"tag":485,"props":1431,"children":1432},{"style":826},[1433],{"type":400,"value":1434}," 20",{"type":394,"tag":485,"props":1436,"children":1437},{"style":540},[1438],{"type":400,"value":574},{"type":394,"tag":485,"props":1440,"children":1441},{"class":487,"line":524},[1442,1447,1452,1457,1462,1467],{"type":394,"tag":485,"props":1443,"children":1444},{"style":528},[1445],{"type":400,"value":1446},"  void",{"type":394,"tag":485,"props":1448,"children":1449},{"style":664},[1450],{"type":400,"value":1451}," *",{"type":394,"tag":485,"props":1453,"children":1454},{"style":566},[1455],{"type":400,"value":1456},"array",{"type":394,"tag":485,"props":1458,"children":1459},{"style":540},[1460],{"type":400,"value":1461},"[",{"type":394,"tag":485,"props":1463,"children":1464},{"style":566},[1465],{"type":400,"value":1466},"depth_max",{"type":394,"tag":485,"props":1468,"children":1469},{"style":540},[1470],{"type":400,"value":1471},"];\n",{"type":394,"tag":485,"props":1473,"children":1474},{"class":487,"line":551},[1475,1480,1485],{"type":394,"tag":485,"props":1476,"children":1477},{"style":528},[1478],{"type":400,"value":1479},"  size_t",{"type":394,"tag":485,"props":1481,"children":1482},{"style":566},[1483],{"type":400,"value":1484}," depth",{"type":394,"tag":485,"props":1486,"children":1487},{"style":540},[1488],{"type":400,"value":574},{"type":394,"tag":485,"props":1490,"children":1491},{"class":487,"line":577},[1492],{"type":394,"tag":485,"props":1493,"children":1495},{"style":1494},"--shiki-light:#90A4AE;--shiki-default:#6A737D;--shiki-dark:#6A737D;--shiki-sepia:#88846F;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:inherit",[1496],{"type":400,"value":1497},"  // backtrace 将前 depth_max 层栈帧记录到 array 数组中，\n",{"type":394,"tag":485,"props":1499,"children":1500},{"class":487,"line":598},[1501],{"type":394,"tag":485,"props":1502,"children":1503},{"style":1494},[1504],{"type":400,"value":1505},"  // 再通过 backtrace_symbols_fd 输出到 stderr。\n",{"type":394,"tag":485,"props":1507,"children":1508},{"class":487,"line":655},[1509],{"type":394,"tag":485,"props":1510,"children":1511},{"style":1494},[1512],{"type":400,"value":1513},"  // 文档见：https://man7.org/linux/man-pages/man3/backtrace.3.html\n",{"type":394,"tag":485,"props":1515,"children":1516},{"class":487,"line":690},[1517,1522,1526,1531,1535,1539,1543,1548],{"type":394,"tag":485,"props":1518,"children":1519},{"style":566},[1520],{"type":400,"value":1521},"  depth ",{"type":394,"tag":485,"props":1523,"children":1524},{"style":664},[1525],{"type":400,"value":667},{"type":394,"tag":485,"props":1527,"children":1528},{"style":534},[1529],{"type":400,"value":1530}," backtrace",{"type":394,"tag":485,"props":1532,"children":1533},{"style":540},[1534],{"type":400,"value":622},{"type":394,"tag":485,"props":1536,"children":1537},{"style":566},[1538],{"type":400,"value":1456},{"type":394,"tag":485,"props":1540,"children":1541},{"style":540},[1542],{"type":400,"value":632},{"type":394,"tag":485,"props":1544,"children":1545},{"style":566},[1546],{"type":400,"value":1547}," depth_max",{"type":394,"tag":485,"props":1549,"children":1550},{"style":540},[1551],{"type":400,"value":652},{"type":394,"tag":485,"props":1553,"children":1554},{"class":487,"line":732},[1555,1560,1564,1568,1572,1576,1581,1586,1591,1595,1599,1603,1607],{"type":394,"tag":485,"props":1556,"children":1557},{"style":534},[1558],{"type":400,"value":1559},"  fprintf",{"type":394,"tag":485,"props":1561,"children":1562},{"style":540},[1563],{"type":400,"value":622},{"type":394,"tag":485,"props":1565,"children":1566},{"style":566},[1567],{"type":400,"value":748},{"type":394,"tag":485,"props":1569,"children":1570},{"style":540},[1571],{"type":400,"value":632},{"type":394,"tag":485,"props":1573,"children":1574},{"style":498},[1575],{"type":400,"value":637},{"type":394,"tag":485,"props":1577,"children":1578},{"style":504},[1579],{"type":400,"value":1580},"Error: signal ",{"type":394,"tag":485,"props":1582,"children":1583},{"style":764},[1584],{"type":400,"value":1585},"%d",{"type":394,"tag":485,"props":1587,"children":1588},{"style":504},[1589],{"type":400,"value":1590},":",{"type":394,"tag":485,"props":1592,"children":1593},{"style":770},[1594],{"type":400,"value":773},{"type":394,"tag":485,"props":1596,"children":1597},{"style":498},[1598],{"type":400,"value":647},{"type":394,"tag":485,"props":1600,"children":1601},{"style":540},[1602],{"type":400,"value":632},{"type":394,"tag":485,"props":1604,"children":1605},{"style":566},[1606],{"type":400,"value":1404},{"type":394,"tag":485,"props":1608,"children":1609},{"style":540},[1610],{"type":400,"value":652},{"type":394,"tag":485,"props":1612,"children":1613},{"class":487,"line":813},[1614,1619,1623,1627,1631,1635,1639,1644],{"type":394,"tag":485,"props":1615,"children":1616},{"style":534},[1617],{"type":400,"value":1618},"  backtrace_symbols_fd",{"type":394,"tag":485,"props":1620,"children":1621},{"style":540},[1622],{"type":400,"value":622},{"type":394,"tag":485,"props":1624,"children":1625},{"style":566},[1626],{"type":400,"value":1456},{"type":394,"tag":485,"props":1628,"children":1629},{"style":540},[1630],{"type":400,"value":632},{"type":394,"tag":485,"props":1632,"children":1633},{"style":566},[1634],{"type":400,"value":1484},{"type":394,"tag":485,"props":1636,"children":1637},{"style":540},[1638],{"type":400,"value":632},{"type":394,"tag":485,"props":1640,"children":1641},{"style":566},[1642],{"type":400,"value":1643}," STDERR_FILENO",{"type":394,"tag":485,"props":1645,"children":1646},{"style":540},[1647],{"type":400,"value":652},{"type":394,"tag":485,"props":1649,"children":1650},{"class":487,"line":836},[1651,1656,1660,1664],{"type":394,"tag":485,"props":1652,"children":1653},{"style":534},[1654],{"type":400,"value":1655},"  exit",{"type":394,"tag":485,"props":1657,"children":1658},{"style":540},[1659],{"type":400,"value":622},{"type":394,"tag":485,"props":1661,"children":1662},{"style":826},[1663],{"type":400,"value":829},{"type":394,"tag":485,"props":1665,"children":1666},{"style":540},[1667],{"type":400,"value":652},{"type":394,"tag":485,"props":1669,"children":1670},{"class":487,"line":845},[1671],{"type":394,"tag":485,"props":1672,"children":1673},{"style":540},[1674],{"type":400,"value":1331},{"type":394,"tag":485,"props":1676,"children":1677},{"class":487,"line":853},[1678,1682,1686,1690],{"type":394,"tag":485,"props":1679,"children":1680},{"style":528},[1681],{"type":400,"value":531},{"type":394,"tag":485,"props":1683,"children":1684},{"style":534},[1685],{"type":400,"value":537},{"type":394,"tag":485,"props":1687,"children":1688},{"style":540},[1689],{"type":400,"value":543},{"type":394,"tag":485,"props":1691,"children":1692},{"style":540},[1693],{"type":400,"value":548},{"type":394,"tag":485,"props":1695,"children":1696},{"class":487,"line":896},[1697,1702,1706,1711,1715,1719],{"type":394,"tag":485,"props":1698,"children":1699},{"style":534},[1700],{"type":400,"value":1701},"  signal",{"type":394,"tag":485,"props":1703,"children":1704},{"style":540},[1705],{"type":400,"value":622},{"type":394,"tag":485,"props":1707,"children":1708},{"style":566},[1709],{"type":400,"value":1710},"SIGSEGV",{"type":394,"tag":485,"props":1712,"children":1713},{"style":540},[1714],{"type":400,"value":632},{"type":394,"tag":485,"props":1716,"children":1717},{"style":566},[1718],{"type":400,"value":1390},{"type":394,"tag":485,"props":1720,"children":1721},{"style":540},[1722],{"type":400,"value":652},{"type":394,"tag":485,"props":1724,"children":1725},{"class":487,"line":937},[1726,1730,1734,1739,1743,1747],{"type":394,"tag":485,"props":1727,"children":1728},{"style":534},[1729],{"type":400,"value":1701},{"type":394,"tag":485,"props":1731,"children":1732},{"style":540},[1733],{"type":400,"value":622},{"type":394,"tag":485,"props":1735,"children":1736},{"style":566},[1737],{"type":400,"value":1738},"SIGABRT",{"type":394,"tag":485,"props":1740,"children":1741},{"style":540},[1742],{"type":400,"value":632},{"type":394,"tag":485,"props":1744,"children":1745},{"style":566},[1746],{"type":400,"value":1390},{"type":394,"tag":485,"props":1748,"children":1749},{"style":540},[1750],{"type":400,"value":652},{"type":394,"tag":485,"props":1752,"children":1753},{"class":487,"line":945},[1754,1758,1763,1767,1772,1776,1781],{"type":394,"tag":485,"props":1755,"children":1756},{"style":492},[1757],{"type":400,"value":1313},{"type":394,"tag":485,"props":1759,"children":1760},{"style":555},[1761],{"type":400,"value":1762}," kdb",{"type":394,"tag":485,"props":1764,"children":1765},{"style":540},[1766],{"type":400,"value":563},{"type":394,"tag":485,"props":1768,"children":1769},{"style":555},[1770],{"type":400,"value":1771},"test",{"type":394,"tag":485,"props":1773,"children":1774},{"style":540},[1775],{"type":400,"value":563},{"type":394,"tag":485,"props":1777,"children":1778},{"style":534},[1779],{"type":400,"value":1780},"RunAllTests",{"type":394,"tag":485,"props":1782,"children":1783},{"style":540},[1784],{"type":400,"value":687},{"type":394,"tag":485,"props":1786,"children":1787},{"class":487,"line":966},[1788],{"type":394,"tag":485,"props":1789,"children":1790},{"style":540},[1791],{"type":400,"value":1331},{"type":394,"tag":1361,"props":1793,"children":1795},{"id":1794},"使用宏创建测试类",[1796],{"type":400,"value":1794},{"type":394,"tag":408,"props":1798,"children":1799},{},[1800],{"type":400,"value":1801},"test_db 中的类是使用宏定义的。如下代码，TEST 展开的新类，继承了 DBTest，实现了 _RunIt 接口以便调用测试函数。TCONCAT 宏顾名思义就是连接，使用标记黏贴运算符把两个字符串或实参连接在一起并视为一个新的标记。_Test_ 和 name 连接在一起后，就是新类的名称，如 _Test_CloseAndReopen。",{"type":394,"tag":474,"props":1803,"children":1805},{"code":1804,"language":477,"meta":388,"className":478,"style":388},"TEST(DBTest, CloseAndReopen) {\n  // ...\n}\n#define TEST(base,name)                                                 \\\nclass TCONCAT(_Test_,name) : public base {                              \\\n public:                                                                \\\n  void _Run();                                                          \\\n  static void _RunIt() {                                                \\\n    TCONCAT(_Test_,name) t;                                             \\\n    t._Run();                                                           \\\n  }                                                                     \\\n};                                                                      \\\nbool TCONCAT(_Test_ignored_,name) =                                     \\\n  ::kdb::test::RegisterTest(#base, #name, &TCONCAT(_Test_,name)::_RunIt); \\\n",[1806],{"type":394,"tag":481,"props":1807,"children":1808},{"__ignoreMap":388},[1809,1843,1851,1858,1898,1947,1965,1987,2020,2063,2089,2101,2114,2157],{"type":394,"tag":485,"props":1810,"children":1811},{"class":487,"line":488},[1812,1817,1821,1826,1830,1835,1839],{"type":394,"tag":485,"props":1813,"children":1814},{"style":534},[1815],{"type":400,"value":1816},"TEST",{"type":394,"tag":485,"props":1818,"children":1819},{"style":540},[1820],{"type":400,"value":622},{"type":394,"tag":485,"props":1822,"children":1823},{"style":566},[1824],{"type":400,"value":1825},"DBTest",{"type":394,"tag":485,"props":1827,"children":1828},{"style":540},[1829],{"type":400,"value":632},{"type":394,"tag":485,"props":1831,"children":1832},{"style":566},[1833],{"type":400,"value":1834}," CloseAndReopen",{"type":394,"tag":485,"props":1836,"children":1837},{"style":540},[1838],{"type":400,"value":1189},{"type":394,"tag":485,"props":1840,"children":1841},{"style":540},[1842],{"type":400,"value":548},{"type":394,"tag":485,"props":1844,"children":1845},{"class":487,"line":515},[1846],{"type":394,"tag":485,"props":1847,"children":1848},{"style":1494},[1849],{"type":400,"value":1850},"  // ...\n",{"type":394,"tag":485,"props":1852,"children":1853},{"class":487,"line":524},[1854],{"type":394,"tag":485,"props":1855,"children":1856},{"style":540},[1857],{"type":400,"value":1331},{"type":394,"tag":485,"props":1859,"children":1860},{"class":487,"line":551},[1861,1866,1871,1875,1880,1884,1889,1893],{"type":394,"tag":485,"props":1862,"children":1863},{"style":492},[1864],{"type":400,"value":1865},"#define",{"type":394,"tag":485,"props":1867,"children":1868},{"style":534},[1869],{"type":400,"value":1870}," TEST",{"type":394,"tag":485,"props":1872,"children":1873},{"style":540},[1874],{"type":400,"value":622},{"type":394,"tag":485,"props":1876,"children":1877},{"style":1401},[1878],{"type":400,"value":1879},"base",{"type":394,"tag":485,"props":1881,"children":1882},{"style":540},[1883],{"type":400,"value":632},{"type":394,"tag":485,"props":1885,"children":1886},{"style":1401},[1887],{"type":400,"value":1888},"name",{"type":394,"tag":485,"props":1890,"children":1891},{"style":540},[1892],{"type":400,"value":1189},{"type":394,"tag":485,"props":1894,"children":1895},{"style":770},[1896],{"type":400,"value":1897},"                                                 \\\n",{"type":394,"tag":485,"props":1899,"children":1900},{"class":487,"line":577},[1901,1906,1911,1915,1920,1924,1928,1932,1937,1942],{"type":394,"tag":485,"props":1902,"children":1903},{"style":528},[1904],{"type":400,"value":1905},"class",{"type":394,"tag":485,"props":1907,"children":1908},{"style":534},[1909],{"type":400,"value":1910}," TCONCAT",{"type":394,"tag":485,"props":1912,"children":1913},{"style":540},[1914],{"type":400,"value":622},{"type":394,"tag":485,"props":1916,"children":1917},{"style":555},[1918],{"type":400,"value":1919},"_Test_",{"type":394,"tag":485,"props":1921,"children":1922},{"style":540},[1923],{"type":400,"value":632},{"type":394,"tag":485,"props":1925,"children":1926},{"style":555},[1927],{"type":400,"value":1888},{"type":394,"tag":485,"props":1929,"children":1930},{"style":540},[1931],{"type":400,"value":1189},{"type":394,"tag":485,"props":1933,"children":1934},{"style":566},[1935],{"type":400,"value":1936}," : public base ",{"type":394,"tag":485,"props":1938,"children":1939},{"style":540},[1940],{"type":400,"value":1941},"{",{"type":394,"tag":485,"props":1943,"children":1944},{"style":770},[1945],{"type":400,"value":1946},"                              \\\n",{"type":394,"tag":485,"props":1948,"children":1949},{"class":487,"line":598},[1950,1955,1960],{"type":394,"tag":485,"props":1951,"children":1952},{"style":528},[1953],{"type":400,"value":1954}," public",{"type":394,"tag":485,"props":1956,"children":1958},{"style":1957},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#66D9EF;--shiki-light-font-style:inherit;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[1959],{"type":400,"value":1590},{"type":394,"tag":485,"props":1961,"children":1962},{"style":770},[1963],{"type":400,"value":1964},"                                                                \\\n",{"type":394,"tag":485,"props":1966,"children":1967},{"class":487,"line":655},[1968,1972,1977,1982],{"type":394,"tag":485,"props":1969,"children":1970},{"style":528},[1971],{"type":400,"value":1446},{"type":394,"tag":485,"props":1973,"children":1974},{"style":534},[1975],{"type":400,"value":1976}," _Run",{"type":394,"tag":485,"props":1978,"children":1979},{"style":540},[1980],{"type":400,"value":1981},"();",{"type":394,"tag":485,"props":1983,"children":1984},{"style":770},[1985],{"type":400,"value":1986},"                                                          \\\n",{"type":394,"tag":485,"props":1988,"children":1989},{"class":487,"line":690},[1990,1996,2001,2006,2010,2015],{"type":394,"tag":485,"props":1991,"children":1993},{"style":1992},"--shiki-light:#9C3EDA;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[1994],{"type":400,"value":1995},"  static",{"type":394,"tag":485,"props":1997,"children":1998},{"style":528},[1999],{"type":400,"value":2000}," void",{"type":394,"tag":485,"props":2002,"children":2003},{"style":534},[2004],{"type":400,"value":2005}," _RunIt",{"type":394,"tag":485,"props":2007,"children":2008},{"style":540},[2009],{"type":400,"value":543},{"type":394,"tag":485,"props":2011,"children":2012},{"style":540},[2013],{"type":400,"value":2014}," {",{"type":394,"tag":485,"props":2016,"children":2017},{"style":770},[2018],{"type":400,"value":2019},"                                                \\\n",{"type":394,"tag":485,"props":2021,"children":2022},{"class":487,"line":732},[2023,2028,2032,2036,2040,2044,2048,2053,2058],{"type":394,"tag":485,"props":2024,"children":2025},{"style":534},[2026],{"type":400,"value":2027},"    TCONCAT",{"type":394,"tag":485,"props":2029,"children":2030},{"style":540},[2031],{"type":400,"value":622},{"type":394,"tag":485,"props":2033,"children":2034},{"style":745},[2035],{"type":400,"value":1919},{"type":394,"tag":485,"props":2037,"children":2038},{"style":540},[2039],{"type":400,"value":632},{"type":394,"tag":485,"props":2041,"children":2042},{"style":745},[2043],{"type":400,"value":1888},{"type":394,"tag":485,"props":2045,"children":2046},{"style":540},[2047],{"type":400,"value":1189},{"type":394,"tag":485,"props":2049,"children":2050},{"style":745},[2051],{"type":400,"value":2052}," t",{"type":394,"tag":485,"props":2054,"children":2055},{"style":540},[2056],{"type":400,"value":2057},";",{"type":394,"tag":485,"props":2059,"children":2060},{"style":770},[2061],{"type":400,"value":2062},"                                             \\\n",{"type":394,"tag":485,"props":2064,"children":2065},{"class":487,"line":813},[2066,2071,2075,2080,2084],{"type":394,"tag":485,"props":2067,"children":2068},{"style":566},[2069],{"type":400,"value":2070},"    t",{"type":394,"tag":485,"props":2072,"children":2073},{"style":540},[2074],{"type":400,"value":677},{"type":394,"tag":485,"props":2076,"children":2077},{"style":534},[2078],{"type":400,"value":2079},"_Run",{"type":394,"tag":485,"props":2081,"children":2082},{"style":540},[2083],{"type":400,"value":1981},{"type":394,"tag":485,"props":2085,"children":2086},{"style":770},[2087],{"type":400,"value":2088},"                                                           \\\n",{"type":394,"tag":485,"props":2090,"children":2091},{"class":487,"line":836},[2092,2096],{"type":394,"tag":485,"props":2093,"children":2094},{"style":540},[2095],{"type":400,"value":1242},{"type":394,"tag":485,"props":2097,"children":2098},{"style":770},[2099],{"type":400,"value":2100},"                                                                     \\\n",{"type":394,"tag":485,"props":2102,"children":2103},{"class":487,"line":845},[2104,2109],{"type":394,"tag":485,"props":2105,"children":2106},{"style":540},[2107],{"type":400,"value":2108},"};",{"type":394,"tag":485,"props":2110,"children":2111},{"style":770},[2112],{"type":400,"value":2113},"                                                                      \\\n",{"type":394,"tag":485,"props":2115,"children":2116},{"class":487,"line":853},[2117,2122,2126,2130,2135,2139,2143,2147,2152],{"type":394,"tag":485,"props":2118,"children":2119},{"style":528},[2120],{"type":400,"value":2121},"bool",{"type":394,"tag":485,"props":2123,"children":2124},{"style":534},[2125],{"type":400,"value":1910},{"type":394,"tag":485,"props":2127,"children":2128},{"style":540},[2129],{"type":400,"value":622},{"type":394,"tag":485,"props":2131,"children":2132},{"style":555},[2133],{"type":400,"value":2134},"_Test_ignored_",{"type":394,"tag":485,"props":2136,"children":2137},{"style":540},[2138],{"type":400,"value":632},{"type":394,"tag":485,"props":2140,"children":2141},{"style":555},[2142],{"type":400,"value":1888},{"type":394,"tag":485,"props":2144,"children":2145},{"style":540},[2146],{"type":400,"value":1189},{"type":394,"tag":485,"props":2148,"children":2149},{"style":664},[2150],{"type":400,"value":2151}," =",{"type":394,"tag":485,"props":2153,"children":2154},{"style":770},[2155],{"type":400,"value":2156},"                                     \\\n",{"type":394,"tag":485,"props":2158,"children":2159},{"class":487,"line":896},[2160,2165,2170,2174,2178,2182,2187,2191,2196,2200,2205,2209,2213,2218,2222,2226,2230,2234,2238,2243,2247],{"type":394,"tag":485,"props":2161,"children":2162},{"style":566},[2163],{"type":400,"value":2164},"  ::",{"type":394,"tag":485,"props":2166,"children":2167},{"style":555},[2168],{"type":400,"value":2169},"kdb",{"type":394,"tag":485,"props":2171,"children":2172},{"style":540},[2173],{"type":400,"value":563},{"type":394,"tag":485,"props":2175,"children":2176},{"style":555},[2177],{"type":400,"value":1771},{"type":394,"tag":485,"props":2179,"children":2180},{"style":540},[2181],{"type":400,"value":563},{"type":394,"tag":485,"props":2183,"children":2184},{"style":534},[2185],{"type":400,"value":2186},"RegisterTest",{"type":394,"tag":485,"props":2188,"children":2189},{"style":540},[2190],{"type":400,"value":622},{"type":394,"tag":485,"props":2192,"children":2193},{"style":566},[2194],{"type":400,"value":2195},"#base",{"type":394,"tag":485,"props":2197,"children":2198},{"style":540},[2199],{"type":400,"value":632},{"type":394,"tag":485,"props":2201,"children":2202},{"style":566},[2203],{"type":400,"value":2204}," #name",{"type":394,"tag":485,"props":2206,"children":2207},{"style":540},[2208],{"type":400,"value":632},{"type":394,"tag":485,"props":2210,"children":2211},{"style":664},[2212],{"type":400,"value":1120},{"type":394,"tag":485,"props":2214,"children":2215},{"style":534},[2216],{"type":400,"value":2217},"TCONCAT",{"type":394,"tag":485,"props":2219,"children":2220},{"style":540},[2221],{"type":400,"value":622},{"type":394,"tag":485,"props":2223,"children":2224},{"style":566},[2225],{"type":400,"value":1919},{"type":394,"tag":485,"props":2227,"children":2228},{"style":540},[2229],{"type":400,"value":632},{"type":394,"tag":485,"props":2231,"children":2232},{"style":566},[2233],{"type":400,"value":1888},{"type":394,"tag":485,"props":2235,"children":2236},{"style":540},[2237],{"type":400,"value":1189},{"type":394,"tag":485,"props":2239,"children":2240},{"style":566},[2241],{"type":400,"value":2242},"::_RunIt",{"type":394,"tag":485,"props":2244,"children":2245},{"style":540},[2246],{"type":400,"value":1228},{"type":394,"tag":485,"props":2248,"children":2249},{"style":770},[2250],{"type":400,"value":2251}," \\\n",{"type":394,"tag":408,"props":2253,"children":2254},{},[2255],{"type":400,"value":2256},"可是，既然有 TCONCAT，为什么还要定义一个 TCONCAT1 宏呢？",{"type":394,"tag":474,"props":2258,"children":2260},{"code":2259,"language":477,"meta":388,"className":478,"style":388},"#define TCONCAT(a,b) TCONCAT1(a,b)\n#define TCONCAT1(a,b) a##b\n",[2261],{"type":394,"tag":481,"props":2262,"children":2263},{"__ignoreMap":388},[2264,2322],{"type":394,"tag":485,"props":2265,"children":2266},{"class":487,"line":488},[2267,2271,2275,2279,2283,2287,2292,2296,2301,2305,2309,2313,2317],{"type":394,"tag":485,"props":2268,"children":2269},{"style":492},[2270],{"type":400,"value":1865},{"type":394,"tag":485,"props":2272,"children":2273},{"style":534},[2274],{"type":400,"value":1910},{"type":394,"tag":485,"props":2276,"children":2277},{"style":540},[2278],{"type":400,"value":622},{"type":394,"tag":485,"props":2280,"children":2281},{"style":1401},[2282],{"type":400,"value":419},{"type":394,"tag":485,"props":2284,"children":2285},{"style":540},[2286],{"type":400,"value":632},{"type":394,"tag":485,"props":2288,"children":2289},{"style":1401},[2290],{"type":400,"value":2291},"b",{"type":394,"tag":485,"props":2293,"children":2294},{"style":540},[2295],{"type":400,"value":1189},{"type":394,"tag":485,"props":2297,"children":2298},{"style":534},[2299],{"type":400,"value":2300}," TCONCAT1",{"type":394,"tag":485,"props":2302,"children":2303},{"style":540},[2304],{"type":400,"value":622},{"type":394,"tag":485,"props":2306,"children":2307},{"style":566},[2308],{"type":400,"value":419},{"type":394,"tag":485,"props":2310,"children":2311},{"style":540},[2312],{"type":400,"value":632},{"type":394,"tag":485,"props":2314,"children":2315},{"style":566},[2316],{"type":400,"value":2291},{"type":394,"tag":485,"props":2318,"children":2319},{"style":540},[2320],{"type":400,"value":2321},")\n",{"type":394,"tag":485,"props":2323,"children":2324},{"class":487,"line":515},[2325,2329,2333,2337,2341,2345,2349,2353],{"type":394,"tag":485,"props":2326,"children":2327},{"style":492},[2328],{"type":400,"value":1865},{"type":394,"tag":485,"props":2330,"children":2331},{"style":534},[2332],{"type":400,"value":2300},{"type":394,"tag":485,"props":2334,"children":2335},{"style":540},[2336],{"type":400,"value":622},{"type":394,"tag":485,"props":2338,"children":2339},{"style":1401},[2340],{"type":400,"value":419},{"type":394,"tag":485,"props":2342,"children":2343},{"style":540},[2344],{"type":400,"value":632},{"type":394,"tag":485,"props":2346,"children":2347},{"style":1401},[2348],{"type":400,"value":2291},{"type":394,"tag":485,"props":2350,"children":2351},{"style":540},[2352],{"type":400,"value":1189},{"type":394,"tag":485,"props":2354,"children":2355},{"style":566},[2356],{"type":400,"value":2357}," a##b\n",{"type":394,"tag":408,"props":2359,"children":2360},{},[2361],{"type":400,"value":2362},"这就要提到宏的一个特殊规则了，如果宏参数使用了字符串化运算符（#）或标记黏贴运算符（##），那么即便参数是宏也不会展开。所以需要一个间接宏 TCONCAT1，以达到先展开参数（如果参数是宏的化），再调用标记黏贴运算符的目的。从 test_db 可以看到，测试类的名词都不是宏，所以这里本不需要 TCONCAT1 这个间接宏。但是考虑到程序的健壮性，加上更好。",{"type":394,"tag":1361,"props":2364,"children":2366},{"id":2365},"断言宏",[2367],{"type":400,"value":2365},{"type":394,"tag":408,"props":2369,"children":2370},{},[2371],{"type":400,"value":2372},"测试代码中的断言也是使用的宏来定义的。相比 TCONCAT 简单很多了，但其特点是可以记录抛错的文件以及行号。以下代码实现了 ASSERT_EQ 的定义。Tester 用于记录宏展开时所在的文件 __FILE__、行号 __LINE__ 以及断言结果。一但断言失败，记录到 ok_ 成员变量中。在 Tester 析构时，会把相关信息一并打印出来。",{"type":394,"tag":474,"props":2374,"children":2376},{"code":2375,"language":477,"meta":388,"className":478,"style":388},"class Tester {\n#define BINARY_OP(name,op)                              \\\n  template \u003Cclass X, class Y>                           \\\n  Tester& name(const X& x, const Y& y) {                \\\n    if (! (x op y)) {                                   \\\n      ss_ \u003C\u003C \" failed: \" \u003C\u003C x \u003C\u003C (\" \" #op \" \") \u003C\u003C y;    \\\n      ok_ = false;                                      \\\n    }                                                   \\\n    return *this;                                       \\\n  }\n  BINARY_OP(IsEq, ==)\n#undef BINARY_OP\n}\n#define ASSERT_EQ(a,b) ::kdb::test::Tester(__FILE__, __LINE__).IsEq((a),(b))\n",[2377],{"type":394,"tag":481,"props":2378,"children":2379},{"__ignoreMap":388},[2380,2396,2433,2478,2553,2592,2678,2705,2718,2745,2752,2782,2795,2802],{"type":394,"tag":485,"props":2381,"children":2382},{"class":487,"line":488},[2383,2387,2392],{"type":394,"tag":485,"props":2384,"children":2385},{"style":528},[2386],{"type":400,"value":1905},{"type":394,"tag":485,"props":2388,"children":2389},{"style":555},[2390],{"type":400,"value":2391}," Tester",{"type":394,"tag":485,"props":2393,"children":2394},{"style":540},[2395],{"type":400,"value":548},{"type":394,"tag":485,"props":2397,"children":2398},{"class":487,"line":515},[2399,2403,2408,2412,2416,2420,2425,2429],{"type":394,"tag":485,"props":2400,"children":2401},{"style":492},[2402],{"type":400,"value":1865},{"type":394,"tag":485,"props":2404,"children":2405},{"style":534},[2406],{"type":400,"value":2407}," BINARY_OP",{"type":394,"tag":485,"props":2409,"children":2410},{"style":540},[2411],{"type":400,"value":622},{"type":394,"tag":485,"props":2413,"children":2414},{"style":1401},[2415],{"type":400,"value":1888},{"type":394,"tag":485,"props":2417,"children":2418},{"style":540},[2419],{"type":400,"value":632},{"type":394,"tag":485,"props":2421,"children":2422},{"style":1401},[2423],{"type":400,"value":2424},"op",{"type":394,"tag":485,"props":2426,"children":2427},{"style":540},[2428],{"type":400,"value":1189},{"type":394,"tag":485,"props":2430,"children":2431},{"style":770},[2432],{"type":400,"value":1946},{"type":394,"tag":485,"props":2434,"children":2435},{"class":487,"line":524},[2436,2441,2445,2449,2454,2458,2463,2468,2473],{"type":394,"tag":485,"props":2437,"children":2438},{"style":528},[2439],{"type":400,"value":2440},"  template",{"type":394,"tag":485,"props":2442,"children":2443},{"style":540},[2444],{"type":400,"value":501},{"type":394,"tag":485,"props":2446,"children":2447},{"style":528},[2448],{"type":400,"value":1905},{"type":394,"tag":485,"props":2450,"children":2451},{"style":555},[2452],{"type":400,"value":2453}," X",{"type":394,"tag":485,"props":2455,"children":2456},{"style":540},[2457],{"type":400,"value":632},{"type":394,"tag":485,"props":2459,"children":2460},{"style":528},[2461],{"type":400,"value":2462}," class",{"type":394,"tag":485,"props":2464,"children":2465},{"style":555},[2466],{"type":400,"value":2467}," Y",{"type":394,"tag":485,"props":2469,"children":2470},{"style":540},[2471],{"type":400,"value":2472},">",{"type":394,"tag":485,"props":2474,"children":2475},{"style":770},[2476],{"type":400,"value":2477},"                           \\\n",{"type":394,"tag":485,"props":2479,"children":2480},{"class":487,"line":551},[2481,2486,2491,2496,2500,2505,2509,2513,2518,2522,2527,2531,2535,2540,2544,2548],{"type":394,"tag":485,"props":2482,"children":2483},{"style":555},[2484],{"type":400,"value":2485},"  Tester",{"type":394,"tag":485,"props":2487,"children":2488},{"style":1992},[2489],{"type":400,"value":2490},"&",{"type":394,"tag":485,"props":2492,"children":2493},{"style":534},[2494],{"type":400,"value":2495}," name",{"type":394,"tag":485,"props":2497,"children":2498},{"style":540},[2499],{"type":400,"value":622},{"type":394,"tag":485,"props":2501,"children":2502},{"style":1992},[2503],{"type":400,"value":2504},"const",{"type":394,"tag":485,"props":2506,"children":2507},{"style":555},[2508],{"type":400,"value":2453},{"type":394,"tag":485,"props":2510,"children":2511},{"style":1992},[2512],{"type":400,"value":2490},{"type":394,"tag":485,"props":2514,"children":2515},{"style":1401},[2516],{"type":400,"value":2517}," x",{"type":394,"tag":485,"props":2519,"children":2520},{"style":540},[2521],{"type":400,"value":632},{"type":394,"tag":485,"props":2523,"children":2524},{"style":1992},[2525],{"type":400,"value":2526}," const",{"type":394,"tag":485,"props":2528,"children":2529},{"style":555},[2530],{"type":400,"value":2467},{"type":394,"tag":485,"props":2532,"children":2533},{"style":1992},[2534],{"type":400,"value":2490},{"type":394,"tag":485,"props":2536,"children":2537},{"style":1401},[2538],{"type":400,"value":2539}," y",{"type":394,"tag":485,"props":2541,"children":2542},{"style":540},[2543],{"type":400,"value":1189},{"type":394,"tag":485,"props":2545,"children":2546},{"style":540},[2547],{"type":400,"value":2014},{"type":394,"tag":485,"props":2549,"children":2550},{"style":770},[2551],{"type":400,"value":2552},"                \\\n",{"type":394,"tag":485,"props":2554,"children":2555},{"class":487,"line":577},[2556,2561,2565,2569,2573,2578,2583,2587],{"type":394,"tag":485,"props":2557,"children":2558},{"style":492},[2559],{"type":400,"value":2560},"    if",{"type":394,"tag":485,"props":2562,"children":2563},{"style":540},[2564],{"type":400,"value":701},{"type":394,"tag":485,"props":2566,"children":2567},{"style":664},[2568],{"type":400,"value":706},{"type":394,"tag":485,"props":2570,"children":2571},{"style":540},[2572],{"type":400,"value":701},{"type":394,"tag":485,"props":2574,"children":2575},{"style":745},[2576],{"type":400,"value":2577},"x op y",{"type":394,"tag":485,"props":2579,"children":2580},{"style":540},[2581],{"type":400,"value":2582},"))",{"type":394,"tag":485,"props":2584,"children":2585},{"style":540},[2586],{"type":400,"value":2014},{"type":394,"tag":485,"props":2588,"children":2589},{"style":770},[2590],{"type":400,"value":2591},"                                   \\\n",{"type":394,"tag":485,"props":2593,"children":2594},{"class":487,"line":598},[2595,2600,2605,2609,2614,2618,2623,2628,2632,2636,2640,2644,2649,2653,2657,2661,2665,2669,2673],{"type":394,"tag":485,"props":2596,"children":2597},{"style":745},[2598],{"type":400,"value":2599},"      ss_ ",{"type":394,"tag":485,"props":2601,"children":2602},{"style":664},[2603],{"type":400,"value":2604},"\u003C\u003C",{"type":394,"tag":485,"props":2606,"children":2607},{"style":498},[2608],{"type":400,"value":637},{"type":394,"tag":485,"props":2610,"children":2611},{"style":504},[2612],{"type":400,"value":2613}," failed: ",{"type":394,"tag":485,"props":2615,"children":2616},{"style":498},[2617],{"type":400,"value":647},{"type":394,"tag":485,"props":2619,"children":2620},{"style":664},[2621],{"type":400,"value":2622}," \u003C\u003C",{"type":394,"tag":485,"props":2624,"children":2625},{"style":745},[2626],{"type":400,"value":2627}," x ",{"type":394,"tag":485,"props":2629,"children":2630},{"style":664},[2631],{"type":400,"value":2604},{"type":394,"tag":485,"props":2633,"children":2634},{"style":540},[2635],{"type":400,"value":701},{"type":394,"tag":485,"props":2637,"children":2638},{"style":498},[2639],{"type":400,"value":647},{"type":394,"tag":485,"props":2641,"children":2642},{"style":498},[2643],{"type":400,"value":637},{"type":394,"tag":485,"props":2645,"children":2646},{"style":566},[2647],{"type":400,"value":2648}," #op",{"type":394,"tag":485,"props":2650,"children":2651},{"style":498},[2652],{"type":400,"value":637},{"type":394,"tag":485,"props":2654,"children":2655},{"style":498},[2656],{"type":400,"value":637},{"type":394,"tag":485,"props":2658,"children":2659},{"style":540},[2660],{"type":400,"value":1189},{"type":394,"tag":485,"props":2662,"children":2663},{"style":664},[2664],{"type":400,"value":2622},{"type":394,"tag":485,"props":2666,"children":2667},{"style":745},[2668],{"type":400,"value":2539},{"type":394,"tag":485,"props":2670,"children":2671},{"style":540},[2672],{"type":400,"value":2057},{"type":394,"tag":485,"props":2674,"children":2675},{"style":770},[2676],{"type":400,"value":2677},"    \\\n",{"type":394,"tag":485,"props":2679,"children":2680},{"class":487,"line":655},[2681,2686,2690,2696,2700],{"type":394,"tag":485,"props":2682,"children":2683},{"style":745},[2684],{"type":400,"value":2685},"      ok_ ",{"type":394,"tag":485,"props":2687,"children":2688},{"style":664},[2689],{"type":400,"value":667},{"type":394,"tag":485,"props":2691,"children":2693},{"style":2692},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[2694],{"type":400,"value":2695}," false",{"type":394,"tag":485,"props":2697,"children":2698},{"style":540},[2699],{"type":400,"value":2057},{"type":394,"tag":485,"props":2701,"children":2702},{"style":770},[2703],{"type":400,"value":2704},"                                      \\\n",{"type":394,"tag":485,"props":2706,"children":2707},{"class":487,"line":690},[2708,2713],{"type":394,"tag":485,"props":2709,"children":2710},{"style":540},[2711],{"type":400,"value":2712},"    }",{"type":394,"tag":485,"props":2714,"children":2715},{"style":770},[2716],{"type":400,"value":2717},"                                                   \\\n",{"type":394,"tag":485,"props":2719,"children":2720},{"class":487,"line":732},[2721,2726,2730,2736,2740],{"type":394,"tag":485,"props":2722,"children":2723},{"style":492},[2724],{"type":400,"value":2725},"    return",{"type":394,"tag":485,"props":2727,"children":2728},{"style":664},[2729],{"type":400,"value":1451},{"type":394,"tag":485,"props":2731,"children":2733},{"style":2732},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[2734],{"type":400,"value":2735},"this",{"type":394,"tag":485,"props":2737,"children":2738},{"style":540},[2739],{"type":400,"value":2057},{"type":394,"tag":485,"props":2741,"children":2742},{"style":770},[2743],{"type":400,"value":2744},"                                       \\\n",{"type":394,"tag":485,"props":2746,"children":2747},{"class":487,"line":813},[2748],{"type":394,"tag":485,"props":2749,"children":2750},{"style":540},[2751],{"type":400,"value":842},{"type":394,"tag":485,"props":2753,"children":2754},{"class":487,"line":836},[2755,2760,2764,2769,2773,2778],{"type":394,"tag":485,"props":2756,"children":2757},{"style":534},[2758],{"type":400,"value":2759},"  BINARY_OP",{"type":394,"tag":485,"props":2761,"children":2762},{"style":540},[2763],{"type":400,"value":622},{"type":394,"tag":485,"props":2765,"children":2766},{"style":555},[2767],{"type":400,"value":2768},"IsEq",{"type":394,"tag":485,"props":2770,"children":2771},{"style":540},[2772],{"type":400,"value":632},{"type":394,"tag":485,"props":2774,"children":2775},{"style":664},[2776],{"type":400,"value":2777}," ==",{"type":394,"tag":485,"props":2779,"children":2780},{"style":540},[2781],{"type":400,"value":2321},{"type":394,"tag":485,"props":2783,"children":2784},{"class":487,"line":845},[2785,2790],{"type":394,"tag":485,"props":2786,"children":2787},{"style":492},[2788],{"type":400,"value":2789},"#undef",{"type":394,"tag":485,"props":2791,"children":2792},{"style":534},[2793],{"type":400,"value":2794}," BINARY_OP\n",{"type":394,"tag":485,"props":2796,"children":2797},{"class":487,"line":853},[2798],{"type":394,"tag":485,"props":2799,"children":2800},{"style":745},[2801],{"type":400,"value":1331},{"type":394,"tag":485,"props":2803,"children":2804},{"class":487,"line":896},[2805,2809,2814,2818,2822,2826,2830,2834,2839,2843,2847,2851,2855,2860,2864,2870,2874,2879,2884,2888,2893,2897,2902,2906],{"type":394,"tag":485,"props":2806,"children":2807},{"style":492},[2808],{"type":400,"value":1865},{"type":394,"tag":485,"props":2810,"children":2811},{"style":534},[2812],{"type":400,"value":2813}," ASSERT_EQ",{"type":394,"tag":485,"props":2815,"children":2816},{"style":540},[2817],{"type":400,"value":622},{"type":394,"tag":485,"props":2819,"children":2820},{"style":1401},[2821],{"type":400,"value":419},{"type":394,"tag":485,"props":2823,"children":2824},{"style":540},[2825],{"type":400,"value":632},{"type":394,"tag":485,"props":2827,"children":2828},{"style":1401},[2829],{"type":400,"value":2291},{"type":394,"tag":485,"props":2831,"children":2832},{"style":540},[2833],{"type":400,"value":1189},{"type":394,"tag":485,"props":2835,"children":2836},{"style":745},[2837],{"type":400,"value":2838}," ::",{"type":394,"tag":485,"props":2840,"children":2841},{"style":555},[2842],{"type":400,"value":2169},{"type":394,"tag":485,"props":2844,"children":2845},{"style":540},[2846],{"type":400,"value":563},{"type":394,"tag":485,"props":2848,"children":2849},{"style":555},[2850],{"type":400,"value":1771},{"type":394,"tag":485,"props":2852,"children":2853},{"style":540},[2854],{"type":400,"value":563},{"type":394,"tag":485,"props":2856,"children":2857},{"style":534},[2858],{"type":400,"value":2859},"Tester",{"type":394,"tag":485,"props":2861,"children":2862},{"style":540},[2863],{"type":400,"value":622},{"type":394,"tag":485,"props":2865,"children":2867},{"style":2866},"--shiki-light:#E2931D;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#F8F8F2",[2868],{"type":400,"value":2869},"__FILE__",{"type":394,"tag":485,"props":2871,"children":2872},{"style":540},[2873],{"type":400,"value":632},{"type":394,"tag":485,"props":2875,"children":2876},{"style":2866},[2877],{"type":400,"value":2878}," __LINE__",{"type":394,"tag":485,"props":2880,"children":2881},{"style":540},[2882],{"type":400,"value":2883},").",{"type":394,"tag":485,"props":2885,"children":2886},{"style":534},[2887],{"type":400,"value":2768},{"type":394,"tag":485,"props":2889,"children":2890},{"style":540},[2891],{"type":400,"value":2892},"((",{"type":394,"tag":485,"props":2894,"children":2895},{"style":745},[2896],{"type":400,"value":419},{"type":394,"tag":485,"props":2898,"children":2899},{"style":540},[2900],{"type":400,"value":2901},"),(",{"type":394,"tag":485,"props":2903,"children":2904},{"style":745},[2905],{"type":400,"value":2291},{"type":394,"tag":485,"props":2907,"children":2908},{"style":540},[2909],{"type":400,"value":2910},"))\n",{"type":394,"tag":1361,"props":2912,"children":2914},{"id":2913},"stringrepeatntimes",[2915],{"type":400,"value":2916},"string.repeat(ntimes)",{"type":394,"tag":408,"props":2918,"children":2919},{},[2920],{"type":400,"value":2921},"写 JavaScript 时经常用到 String 的原型方法 repeat，用来把 n 个内容重复的字符串拼接为一个新字符串。也许是 C++ 标准库没有提供相应的算法，KDB 使用了一种和 repeat 完全不一样的处理思路。KDB 使用 StringStream 填充一定位数内容，还可以不用考虑值的长度。",{"type":394,"tag":474,"props":2923,"children":2925},{"code":2924,"language":477,"meta":388,"className":478,"style":388},"std::stringstream ss;\nss \u003C\u003C std::setfill ('0') \u003C\u003C std::setw (16);\nss \u003C\u003C 1;\nss.str(); // result is: \"0000000000000001\"\nss \u003C\u003C std::setfill ('0') \u003C\u003C std::setw (16);\nss \u003C\u003C 1123;\nss.str(); // result is: \"0000000000001123\"\n",[2926],{"type":394,"tag":481,"props":2927,"children":2928},{"__ignoreMap":388},[2929,2950,3028,3048,3074,3145,3165],{"type":394,"tag":485,"props":2930,"children":2931},{"class":487,"line":488},[2932,2937,2941,2946],{"type":394,"tag":485,"props":2933,"children":2934},{"style":555},[2935],{"type":400,"value":2936},"std",{"type":394,"tag":485,"props":2938,"children":2939},{"style":540},[2940],{"type":400,"value":563},{"type":394,"tag":485,"props":2942,"children":2943},{"style":566},[2944],{"type":400,"value":2945},"stringstream ss",{"type":394,"tag":485,"props":2947,"children":2948},{"style":540},[2949],{"type":400,"value":574},{"type":394,"tag":485,"props":2951,"children":2952},{"class":487,"line":515},[2953,2958,2962,2967,2971,2976,2980,2985,2990,2994,2998,3002,3006,3010,3015,3019,3024],{"type":394,"tag":485,"props":2954,"children":2955},{"style":566},[2956],{"type":400,"value":2957},"ss ",{"type":394,"tag":485,"props":2959,"children":2960},{"style":664},[2961],{"type":400,"value":2604},{"type":394,"tag":485,"props":2963,"children":2964},{"style":555},[2965],{"type":400,"value":2966}," std",{"type":394,"tag":485,"props":2968,"children":2969},{"style":540},[2970],{"type":400,"value":563},{"type":394,"tag":485,"props":2972,"children":2973},{"style":534},[2974],{"type":400,"value":2975},"setfill",{"type":394,"tag":485,"props":2977,"children":2978},{"style":540},[2979],{"type":400,"value":701},{"type":394,"tag":485,"props":2981,"children":2982},{"style":498},[2983],{"type":400,"value":2984},"'",{"type":394,"tag":485,"props":2986,"children":2987},{"style":504},[2988],{"type":400,"value":2989},"0",{"type":394,"tag":485,"props":2991,"children":2992},{"style":498},[2993],{"type":400,"value":2984},{"type":394,"tag":485,"props":2995,"children":2996},{"style":540},[2997],{"type":400,"value":1189},{"type":394,"tag":485,"props":2999,"children":3000},{"style":664},[3001],{"type":400,"value":2622},{"type":394,"tag":485,"props":3003,"children":3004},{"style":555},[3005],{"type":400,"value":2966},{"type":394,"tag":485,"props":3007,"children":3008},{"style":540},[3009],{"type":400,"value":563},{"type":394,"tag":485,"props":3011,"children":3012},{"style":534},[3013],{"type":400,"value":3014},"setw",{"type":394,"tag":485,"props":3016,"children":3017},{"style":540},[3018],{"type":400,"value":701},{"type":394,"tag":485,"props":3020,"children":3021},{"style":826},[3022],{"type":400,"value":3023},"16",{"type":394,"tag":485,"props":3025,"children":3026},{"style":540},[3027],{"type":400,"value":652},{"type":394,"tag":485,"props":3029,"children":3030},{"class":487,"line":524},[3031,3035,3039,3044],{"type":394,"tag":485,"props":3032,"children":3033},{"style":566},[3034],{"type":400,"value":2957},{"type":394,"tag":485,"props":3036,"children":3037},{"style":664},[3038],{"type":400,"value":2604},{"type":394,"tag":485,"props":3040,"children":3041},{"style":826},[3042],{"type":400,"value":3043}," 1",{"type":394,"tag":485,"props":3045,"children":3046},{"style":540},[3047],{"type":400,"value":574},{"type":394,"tag":485,"props":3049,"children":3050},{"class":487,"line":551},[3051,3056,3060,3065,3069],{"type":394,"tag":485,"props":3052,"children":3053},{"style":566},[3054],{"type":400,"value":3055},"ss",{"type":394,"tag":485,"props":3057,"children":3058},{"style":540},[3059],{"type":400,"value":677},{"type":394,"tag":485,"props":3061,"children":3062},{"style":534},[3063],{"type":400,"value":3064},"str",{"type":394,"tag":485,"props":3066,"children":3067},{"style":540},[3068],{"type":400,"value":1981},{"type":394,"tag":485,"props":3070,"children":3071},{"style":1494},[3072],{"type":400,"value":3073}," // result is: \"0000000000000001\"\n",{"type":394,"tag":485,"props":3075,"children":3076},{"class":487,"line":577},[3077,3081,3085,3089,3093,3097,3101,3105,3109,3113,3117,3121,3125,3129,3133,3137,3141],{"type":394,"tag":485,"props":3078,"children":3079},{"style":566},[3080],{"type":400,"value":2957},{"type":394,"tag":485,"props":3082,"children":3083},{"style":664},[3084],{"type":400,"value":2604},{"type":394,"tag":485,"props":3086,"children":3087},{"style":555},[3088],{"type":400,"value":2966},{"type":394,"tag":485,"props":3090,"children":3091},{"style":540},[3092],{"type":400,"value":563},{"type":394,"tag":485,"props":3094,"children":3095},{"style":534},[3096],{"type":400,"value":2975},{"type":394,"tag":485,"props":3098,"children":3099},{"style":540},[3100],{"type":400,"value":701},{"type":394,"tag":485,"props":3102,"children":3103},{"style":498},[3104],{"type":400,"value":2984},{"type":394,"tag":485,"props":3106,"children":3107},{"style":504},[3108],{"type":400,"value":2989},{"type":394,"tag":485,"props":3110,"children":3111},{"style":498},[3112],{"type":400,"value":2984},{"type":394,"tag":485,"props":3114,"children":3115},{"style":540},[3116],{"type":400,"value":1189},{"type":394,"tag":485,"props":3118,"children":3119},{"style":664},[3120],{"type":400,"value":2622},{"type":394,"tag":485,"props":3122,"children":3123},{"style":555},[3124],{"type":400,"value":2966},{"type":394,"tag":485,"props":3126,"children":3127},{"style":540},[3128],{"type":400,"value":563},{"type":394,"tag":485,"props":3130,"children":3131},{"style":534},[3132],{"type":400,"value":3014},{"type":394,"tag":485,"props":3134,"children":3135},{"style":540},[3136],{"type":400,"value":701},{"type":394,"tag":485,"props":3138,"children":3139},{"style":826},[3140],{"type":400,"value":3023},{"type":394,"tag":485,"props":3142,"children":3143},{"style":540},[3144],{"type":400,"value":652},{"type":394,"tag":485,"props":3146,"children":3147},{"class":487,"line":598},[3148,3152,3156,3161],{"type":394,"tag":485,"props":3149,"children":3150},{"style":566},[3151],{"type":400,"value":2957},{"type":394,"tag":485,"props":3153,"children":3154},{"style":664},[3155],{"type":400,"value":2604},{"type":394,"tag":485,"props":3157,"children":3158},{"style":826},[3159],{"type":400,"value":3160}," 1123",{"type":394,"tag":485,"props":3162,"children":3163},{"style":540},[3164],{"type":400,"value":574},{"type":394,"tag":485,"props":3166,"children":3167},{"class":487,"line":655},[3168,3172,3176,3180,3184],{"type":394,"tag":485,"props":3169,"children":3170},{"style":566},[3171],{"type":400,"value":3055},{"type":394,"tag":485,"props":3173,"children":3174},{"style":540},[3175],{"type":400,"value":677},{"type":394,"tag":485,"props":3177,"children":3178},{"style":534},[3179],{"type":400,"value":3064},{"type":394,"tag":485,"props":3181,"children":3182},{"style":540},[3183],{"type":400,"value":1981},{"type":394,"tag":485,"props":3185,"children":3186},{"style":1494},[3187],{"type":400,"value":3188}," // result is: \"0000000000001123\"\n",{"type":394,"tag":1361,"props":3190,"children":3192},{"id":3191},"c-风格的随机数",[3193],{"type":400,"value":3194},"C++ 风格的随机数",{"type":394,"tag":408,"props":3196,"children":3197},{},[3198],{"type":400,"value":3199},"一个有意思的地方时，KDB 代码中随处可见 C 编程风格的源码。但是测试用例中生成随机数确实 C++ 风格的。",{"type":394,"tag":474,"props":3201,"children":3203},{"code":3202,"language":477,"meta":388,"className":478,"style":388},"std::mt19937 generator = std::mt19937();\nstd::uniform_int_distribution\u003Cint> random_dist(0,255);\n// ...\nfor (int i = 0; i \u003C size; i++) {\n  str[i] = static_cast\u003Cchar>(random_dist(generator));\n}\n",[3204],{"type":394,"tag":481,"props":3205,"children":3206},{"__ignoreMap":388},[3207,3244,3299,3307,3375,3438],{"type":394,"tag":485,"props":3208,"children":3209},{"class":487,"line":488},[3210,3214,3218,3223,3227,3231,3235,3240],{"type":394,"tag":485,"props":3211,"children":3212},{"style":555},[3213],{"type":400,"value":2936},{"type":394,"tag":485,"props":3215,"children":3216},{"style":540},[3217],{"type":400,"value":563},{"type":394,"tag":485,"props":3219,"children":3220},{"style":566},[3221],{"type":400,"value":3222},"mt19937 generator ",{"type":394,"tag":485,"props":3224,"children":3225},{"style":664},[3226],{"type":400,"value":667},{"type":394,"tag":485,"props":3228,"children":3229},{"style":555},[3230],{"type":400,"value":2966},{"type":394,"tag":485,"props":3232,"children":3233},{"style":540},[3234],{"type":400,"value":563},{"type":394,"tag":485,"props":3236,"children":3237},{"style":534},[3238],{"type":400,"value":3239},"mt19937",{"type":394,"tag":485,"props":3241,"children":3242},{"style":540},[3243],{"type":400,"value":687},{"type":394,"tag":485,"props":3245,"children":3246},{"class":487,"line":515},[3247,3251,3255,3260,3265,3269,3273,3278,3282,3286,3290,3295],{"type":394,"tag":485,"props":3248,"children":3249},{"style":555},[3250],{"type":400,"value":2936},{"type":394,"tag":485,"props":3252,"children":3253},{"style":540},[3254],{"type":400,"value":563},{"type":394,"tag":485,"props":3256,"children":3257},{"style":555},[3258],{"type":400,"value":3259},"uniform_int_distribution",{"type":394,"tag":485,"props":3261,"children":3262},{"style":540},[3263],{"type":400,"value":3264},"\u003C",{"type":394,"tag":485,"props":3266,"children":3267},{"style":528},[3268],{"type":400,"value":531},{"type":394,"tag":485,"props":3270,"children":3271},{"style":540},[3272],{"type":400,"value":2472},{"type":394,"tag":485,"props":3274,"children":3275},{"style":534},[3276],{"type":400,"value":3277}," random_dist",{"type":394,"tag":485,"props":3279,"children":3280},{"style":540},[3281],{"type":400,"value":622},{"type":394,"tag":485,"props":3283,"children":3284},{"style":826},[3285],{"type":400,"value":2989},{"type":394,"tag":485,"props":3287,"children":3288},{"style":540},[3289],{"type":400,"value":632},{"type":394,"tag":485,"props":3291,"children":3292},{"style":826},[3293],{"type":400,"value":3294},"255",{"type":394,"tag":485,"props":3296,"children":3297},{"style":540},[3298],{"type":400,"value":652},{"type":394,"tag":485,"props":3300,"children":3301},{"class":487,"line":524},[3302],{"type":394,"tag":485,"props":3303,"children":3304},{"style":1494},[3305],{"type":400,"value":3306},"// ...\n",{"type":394,"tag":485,"props":3308,"children":3309},{"class":487,"line":551},[3310,3315,3319,3323,3328,3332,3336,3340,3344,3348,3353,3357,3362,3367,3371],{"type":394,"tag":485,"props":3311,"children":3312},{"style":492},[3313],{"type":400,"value":3314},"for",{"type":394,"tag":485,"props":3316,"children":3317},{"style":540},[3318],{"type":400,"value":701},{"type":394,"tag":485,"props":3320,"children":3321},{"style":528},[3322],{"type":400,"value":531},{"type":394,"tag":485,"props":3324,"children":3325},{"style":566},[3326],{"type":400,"value":3327}," i ",{"type":394,"tag":485,"props":3329,"children":3330},{"style":664},[3331],{"type":400,"value":667},{"type":394,"tag":485,"props":3333,"children":3334},{"style":826},[3335],{"type":400,"value":1318},{"type":394,"tag":485,"props":3337,"children":3338},{"style":540},[3339],{"type":400,"value":2057},{"type":394,"tag":485,"props":3341,"children":3342},{"style":566},[3343],{"type":400,"value":3327},{"type":394,"tag":485,"props":3345,"children":3346},{"style":664},[3347],{"type":400,"value":3264},{"type":394,"tag":485,"props":3349,"children":3350},{"style":566},[3351],{"type":400,"value":3352}," size",{"type":394,"tag":485,"props":3354,"children":3355},{"style":540},[3356],{"type":400,"value":2057},{"type":394,"tag":485,"props":3358,"children":3359},{"style":566},[3360],{"type":400,"value":3361}," i",{"type":394,"tag":485,"props":3363,"children":3364},{"style":664},[3365],{"type":400,"value":3366},"++",{"type":394,"tag":485,"props":3368,"children":3369},{"style":540},[3370],{"type":400,"value":1189},{"type":394,"tag":485,"props":3372,"children":3373},{"style":540},[3374],{"type":400,"value":548},{"type":394,"tag":485,"props":3376,"children":3377},{"class":487,"line":577},[3378,3383,3387,3392,3397,3401,3406,3411,3415,3419,3424,3428,3433],{"type":394,"tag":485,"props":3379,"children":3380},{"style":566},[3381],{"type":400,"value":3382},"  str",{"type":394,"tag":485,"props":3384,"children":3385},{"style":540},[3386],{"type":400,"value":1461},{"type":394,"tag":485,"props":3388,"children":3389},{"style":745},[3390],{"type":400,"value":3391},"i",{"type":394,"tag":485,"props":3393,"children":3394},{"style":540},[3395],{"type":400,"value":3396},"]",{"type":394,"tag":485,"props":3398,"children":3399},{"style":664},[3400],{"type":400,"value":2151},{"type":394,"tag":485,"props":3402,"children":3403},{"style":664},[3404],{"type":400,"value":3405}," static_cast\u003C",{"type":394,"tag":485,"props":3407,"children":3408},{"style":528},[3409],{"type":400,"value":3410},"char",{"type":394,"tag":485,"props":3412,"children":3413},{"style":664},[3414],{"type":400,"value":2472},{"type":394,"tag":485,"props":3416,"children":3417},{"style":540},[3418],{"type":400,"value":622},{"type":394,"tag":485,"props":3420,"children":3421},{"style":534},[3422],{"type":400,"value":3423},"random_dist",{"type":394,"tag":485,"props":3425,"children":3426},{"style":540},[3427],{"type":400,"value":622},{"type":394,"tag":485,"props":3429,"children":3430},{"style":745},[3431],{"type":400,"value":3432},"generator",{"type":394,"tag":485,"props":3434,"children":3435},{"style":540},[3436],{"type":400,"value":3437},"));\n",{"type":394,"tag":485,"props":3439,"children":3440},{"class":487,"line":598},[3441],{"type":394,"tag":485,"props":3442,"children":3443},{"style":540},[3444],{"type":400,"value":1331},{"type":394,"tag":402,"props":3446,"children":3448},{"id":3447},"接口层",[3449],{"type":400,"value":3447},{"type":394,"tag":408,"props":3451,"children":3452},{},[3453,3455,3461],{"type":400,"value":3454},"接口的声明位于 interface/kingdb.h，实现则是 interface/kingdb.cc。KingDB 类给 Database 和 Snapshot 定义了要求实现的 Get、Put、Delete、NewIterater、Open、Close、Flush、Compact、NewMultipartReader 接口。KDB 有自己的数据传输格式 ByteArray，诸如 Get、Put 这些接口在 KingDB 类中对应方法得到了重载，以实现通过 std::string 来传递键、值或者两者，可视为为接受 ByteArray 的方法的包装。所有数据库操作方法都返回 Status 对象，相关异常部分的简介见",{"type":394,"tag":419,"props":3456,"children":3458},{"href":3457},"#%E5%BC%82%E5%B8%B8%E4%B8%8E%E6%97%A5%E5%BF%97",[3459],{"type":400,"value":3460},"异常与日志",{"type":400,"value":3462},"小节。",{"type":394,"tag":408,"props":3464,"children":3465},{},[3466],{"type":400,"value":3467},"重载方法的实现示例如下，即先把 std::string 转回 ByteArray 再调用子类（Database 或 Snapshot）的实现。",{"type":394,"tag":474,"props":3469,"children":3471},{"code":3470,"language":477,"meta":388,"className":478,"style":388},"virtual Status Put(WriteOptions& write_options, const std::string& key, const std::string& chunk) {\n  ByteArray byte_array_key = NewDeepCopyByteArray(key.c_str(), key.size());\n  ByteArray byte_array_chunk = NewDeepCopyByteArray(chunk.c_str(), chunk.size());\n  return Put(write_options, byte_array_key, byte_array_chunk);\n}\n",[3472],{"type":394,"tag":481,"props":3473,"children":3474},{"__ignoreMap":388},[3475,3578,3634,3687,3728],{"type":394,"tag":485,"props":3476,"children":3477},{"class":487,"line":488},[3478,3483,3488,3493,3497,3502,3506,3511,3515,3519,3523,3527,3532,3536,3541,3545,3549,3553,3557,3561,3565,3570,3574],{"type":394,"tag":485,"props":3479,"children":3480},{"style":1992},[3481],{"type":400,"value":3482},"virtual",{"type":394,"tag":485,"props":3484,"children":3485},{"style":555},[3486],{"type":400,"value":3487}," Status",{"type":394,"tag":485,"props":3489,"children":3490},{"style":534},[3491],{"type":400,"value":3492}," Put",{"type":394,"tag":485,"props":3494,"children":3495},{"style":540},[3496],{"type":400,"value":622},{"type":394,"tag":485,"props":3498,"children":3499},{"style":555},[3500],{"type":400,"value":3501},"WriteOptions",{"type":394,"tag":485,"props":3503,"children":3504},{"style":1992},[3505],{"type":400,"value":2490},{"type":394,"tag":485,"props":3507,"children":3508},{"style":1401},[3509],{"type":400,"value":3510}," write_options",{"type":394,"tag":485,"props":3512,"children":3513},{"style":540},[3514],{"type":400,"value":632},{"type":394,"tag":485,"props":3516,"children":3517},{"style":1992},[3518],{"type":400,"value":2526},{"type":394,"tag":485,"props":3520,"children":3521},{"style":555},[3522],{"type":400,"value":2966},{"type":394,"tag":485,"props":3524,"children":3525},{"style":540},[3526],{"type":400,"value":563},{"type":394,"tag":485,"props":3528,"children":3529},{"style":555},[3530],{"type":400,"value":3531},"string",{"type":394,"tag":485,"props":3533,"children":3534},{"style":1992},[3535],{"type":400,"value":2490},{"type":394,"tag":485,"props":3537,"children":3538},{"style":1401},[3539],{"type":400,"value":3540}," key",{"type":394,"tag":485,"props":3542,"children":3543},{"style":540},[3544],{"type":400,"value":632},{"type":394,"tag":485,"props":3546,"children":3547},{"style":1992},[3548],{"type":400,"value":2526},{"type":394,"tag":485,"props":3550,"children":3551},{"style":555},[3552],{"type":400,"value":2966},{"type":394,"tag":485,"props":3554,"children":3555},{"style":540},[3556],{"type":400,"value":563},{"type":394,"tag":485,"props":3558,"children":3559},{"style":555},[3560],{"type":400,"value":3531},{"type":394,"tag":485,"props":3562,"children":3563},{"style":1992},[3564],{"type":400,"value":2490},{"type":394,"tag":485,"props":3566,"children":3567},{"style":1401},[3568],{"type":400,"value":3569}," chunk",{"type":394,"tag":485,"props":3571,"children":3572},{"style":540},[3573],{"type":400,"value":1189},{"type":394,"tag":485,"props":3575,"children":3576},{"style":540},[3577],{"type":400,"value":548},{"type":394,"tag":485,"props":3579,"children":3580},{"class":487,"line":515},[3581,3586,3590,3595,3599,3604,3608,3612,3617,3621,3625,3630],{"type":394,"tag":485,"props":3582,"children":3583},{"style":566},[3584],{"type":400,"value":3585},"  ByteArray byte_array_key ",{"type":394,"tag":485,"props":3587,"children":3588},{"style":664},[3589],{"type":400,"value":667},{"type":394,"tag":485,"props":3591,"children":3592},{"style":534},[3593],{"type":400,"value":3594}," NewDeepCopyByteArray",{"type":394,"tag":485,"props":3596,"children":3597},{"style":540},[3598],{"type":400,"value":622},{"type":394,"tag":485,"props":3600,"children":3601},{"style":566},[3602],{"type":400,"value":3603},"key",{"type":394,"tag":485,"props":3605,"children":3606},{"style":540},[3607],{"type":400,"value":677},{"type":394,"tag":485,"props":3609,"children":3610},{"style":534},[3611],{"type":400,"value":805},{"type":394,"tag":485,"props":3613,"children":3614},{"style":540},[3615],{"type":400,"value":3616},"(),",{"type":394,"tag":485,"props":3618,"children":3619},{"style":566},[3620],{"type":400,"value":3540},{"type":394,"tag":485,"props":3622,"children":3623},{"style":540},[3624],{"type":400,"value":677},{"type":394,"tag":485,"props":3626,"children":3627},{"style":534},[3628],{"type":400,"value":3629},"size",{"type":394,"tag":485,"props":3631,"children":3632},{"style":540},[3633],{"type":400,"value":810},{"type":394,"tag":485,"props":3635,"children":3636},{"class":487,"line":524},[3637,3642,3646,3650,3654,3659,3663,3667,3671,3675,3679,3683],{"type":394,"tag":485,"props":3638,"children":3639},{"style":566},[3640],{"type":400,"value":3641},"  ByteArray byte_array_chunk ",{"type":394,"tag":485,"props":3643,"children":3644},{"style":664},[3645],{"type":400,"value":667},{"type":394,"tag":485,"props":3647,"children":3648},{"style":534},[3649],{"type":400,"value":3594},{"type":394,"tag":485,"props":3651,"children":3652},{"style":540},[3653],{"type":400,"value":622},{"type":394,"tag":485,"props":3655,"children":3656},{"style":566},[3657],{"type":400,"value":3658},"chunk",{"type":394,"tag":485,"props":3660,"children":3661},{"style":540},[3662],{"type":400,"value":677},{"type":394,"tag":485,"props":3664,"children":3665},{"style":534},[3666],{"type":400,"value":805},{"type":394,"tag":485,"props":3668,"children":3669},{"style":540},[3670],{"type":400,"value":3616},{"type":394,"tag":485,"props":3672,"children":3673},{"style":566},[3674],{"type":400,"value":3569},{"type":394,"tag":485,"props":3676,"children":3677},{"style":540},[3678],{"type":400,"value":677},{"type":394,"tag":485,"props":3680,"children":3681},{"style":534},[3682],{"type":400,"value":3629},{"type":394,"tag":485,"props":3684,"children":3685},{"style":540},[3686],{"type":400,"value":810},{"type":394,"tag":485,"props":3688,"children":3689},{"class":487,"line":551},[3690,3694,3698,3702,3706,3710,3715,3719,3724],{"type":394,"tag":485,"props":3691,"children":3692},{"style":492},[3693],{"type":400,"value":1313},{"type":394,"tag":485,"props":3695,"children":3696},{"style":534},[3697],{"type":400,"value":3492},{"type":394,"tag":485,"props":3699,"children":3700},{"style":540},[3701],{"type":400,"value":622},{"type":394,"tag":485,"props":3703,"children":3704},{"style":566},[3705],{"type":400,"value":997},{"type":394,"tag":485,"props":3707,"children":3708},{"style":540},[3709],{"type":400,"value":632},{"type":394,"tag":485,"props":3711,"children":3712},{"style":566},[3713],{"type":400,"value":3714}," byte_array_key",{"type":394,"tag":485,"props":3716,"children":3717},{"style":540},[3718],{"type":400,"value":632},{"type":394,"tag":485,"props":3720,"children":3721},{"style":566},[3722],{"type":400,"value":3723}," byte_array_chunk",{"type":394,"tag":485,"props":3725,"children":3726},{"style":540},[3727],{"type":400,"value":652},{"type":394,"tag":485,"props":3729,"children":3730},{"class":487,"line":577},[3731],{"type":394,"tag":485,"props":3732,"children":3733},{"style":540},[3734],{"type":400,"value":1331},{"type":394,"tag":1361,"props":3736,"children":3738},{"id":3737},"数据库开关",[3739],{"type":400,"value":3737},{"type":394,"tag":408,"props":3741,"children":3742},{},[3743],{"type":400,"value":3744},"数据库的开启与关闭，分别对应 Database 类的 Open 和 Close 方法。开启时，通过 stat 库函数找到数据库路径以及配置文件，使用 open 库函数获取其文件描述符。配置文件须先用 flock 锁住，使用 mmap 映射后再读取；如果没有那么分情况写入。之后，创建好 EventManager、WriteBuffer 和 StorageEngine 的实例，就完成了。关闭时过程类似，锁定住配置文件后再关闭，同时删除以上创建的实例。可以发现，资源申请全放在了 Open 中，而资源的销毁放在了 Close 中，而 Database 类析构时会自动调用 Close，所以这是一个类似 RAII 的资源管理过程。",{"type":394,"tag":474,"props":3746,"children":3748},{"code":3747,"language":477,"meta":388,"className":478,"style":388},"class Database: public KingDB {\n  virtual ~Database() { Close(); }\n  virtual Status Open() override {\n    std::string filepath_dboptions = DatabaseOptions::GetPath(dbname_);\n    fd_dboptions_ = open(filepath_dboptions.c_str(), O_RDONLY, 0644);\n    flock(fd_dboptions_, LOCK_EX | LOCK_NB);\n    Mmap mmap(filepath_dboptions, info.st_size);\n    Status status_dboptions = DatabaseOptionEncoder::DecodeFrom(mmap.datafile(), mmap.filesize(), &db_options_candidate);\n    // ...\n    em_ = new EventManager();\n    wb_ = new WriteBuffer(db_options_, em_);\n    se_ = new StorageEngine(db_options_, em_, dbname_);\n    return Status::OK(); \n  }\n  virtual void Close() override {\n    flock(fd_dboptions_, LOCK_UN);\n    close(fd_dboptions_);\n    wb_->Close();\n    se_->Close();\n    delete wb_;\n    delete se_;\n    delete em_;\n  }\n}\n",[3749],{"type":394,"tag":481,"props":3750,"children":3751},{"__ignoreMap":388},[3752,3781,3816,3845,3893,3954,3994,4037,4115,4123,4149,4192,4242,4270,4277,4304,4332,4352,4374,4394,4411,4427,4442,4449],{"type":394,"tag":485,"props":3753,"children":3754},{"class":487,"line":488},[3755,3759,3764,3768,3772,3777],{"type":394,"tag":485,"props":3756,"children":3757},{"style":528},[3758],{"type":400,"value":1905},{"type":394,"tag":485,"props":3760,"children":3761},{"style":555},[3762],{"type":400,"value":3763}," Database",{"type":394,"tag":485,"props":3765,"children":3766},{"style":540},[3767],{"type":400,"value":1590},{"type":394,"tag":485,"props":3769,"children":3770},{"style":528},[3771],{"type":400,"value":1954},{"type":394,"tag":485,"props":3773,"children":3774},{"style":555},[3775],{"type":400,"value":3776}," KingDB",{"type":394,"tag":485,"props":3778,"children":3779},{"style":540},[3780],{"type":400,"value":548},{"type":394,"tag":485,"props":3782,"children":3783},{"class":487,"line":515},[3784,3789,3794,3798,3802,3807,3811],{"type":394,"tag":485,"props":3785,"children":3786},{"style":1992},[3787],{"type":400,"value":3788},"  virtual",{"type":394,"tag":485,"props":3790,"children":3791},{"style":534},[3792],{"type":400,"value":3793}," ~Database",{"type":394,"tag":485,"props":3795,"children":3796},{"style":540},[3797],{"type":400,"value":543},{"type":394,"tag":485,"props":3799,"children":3800},{"style":540},[3801],{"type":400,"value":2014},{"type":394,"tag":485,"props":3803,"children":3804},{"style":534},[3805],{"type":400,"value":3806}," Close",{"type":394,"tag":485,"props":3808,"children":3809},{"style":540},[3810],{"type":400,"value":1981},{"type":394,"tag":485,"props":3812,"children":3813},{"style":540},[3814],{"type":400,"value":3815}," }\n",{"type":394,"tag":485,"props":3817,"children":3818},{"class":487,"line":524},[3819,3823,3827,3832,3836,3841],{"type":394,"tag":485,"props":3820,"children":3821},{"style":1992},[3822],{"type":400,"value":3788},{"type":394,"tag":485,"props":3824,"children":3825},{"style":555},[3826],{"type":400,"value":3487},{"type":394,"tag":485,"props":3828,"children":3829},{"style":534},[3830],{"type":400,"value":3831}," Open",{"type":394,"tag":485,"props":3833,"children":3834},{"style":540},[3835],{"type":400,"value":543},{"type":394,"tag":485,"props":3837,"children":3838},{"style":1992},[3839],{"type":400,"value":3840}," override",{"type":394,"tag":485,"props":3842,"children":3843},{"style":540},[3844],{"type":400,"value":548},{"type":394,"tag":485,"props":3846,"children":3847},{"class":487,"line":551},[3848,3853,3857,3862,3866,3871,3875,3880,3884,3889],{"type":394,"tag":485,"props":3849,"children":3850},{"style":555},[3851],{"type":400,"value":3852},"    std",{"type":394,"tag":485,"props":3854,"children":3855},{"style":540},[3856],{"type":400,"value":563},{"type":394,"tag":485,"props":3858,"children":3859},{"style":745},[3860],{"type":400,"value":3861},"string filepath_dboptions ",{"type":394,"tag":485,"props":3863,"children":3864},{"style":664},[3865],{"type":400,"value":667},{"type":394,"tag":485,"props":3867,"children":3868},{"style":555},[3869],{"type":400,"value":3870}," DatabaseOptions",{"type":394,"tag":485,"props":3872,"children":3873},{"style":540},[3874],{"type":400,"value":563},{"type":394,"tag":485,"props":3876,"children":3877},{"style":534},[3878],{"type":400,"value":3879},"GetPath",{"type":394,"tag":485,"props":3881,"children":3882},{"style":540},[3883],{"type":400,"value":622},{"type":394,"tag":485,"props":3885,"children":3886},{"style":745},[3887],{"type":400,"value":3888},"dbname_",{"type":394,"tag":485,"props":3890,"children":3891},{"style":540},[3892],{"type":400,"value":652},{"type":394,"tag":485,"props":3894,"children":3895},{"class":487,"line":577},[3896,3901,3905,3910,3914,3919,3923,3927,3931,3936,3940,3945,3950],{"type":394,"tag":485,"props":3897,"children":3898},{"style":745},[3899],{"type":400,"value":3900},"    fd_dboptions_ ",{"type":394,"tag":485,"props":3902,"children":3903},{"style":664},[3904],{"type":400,"value":667},{"type":394,"tag":485,"props":3906,"children":3907},{"style":534},[3908],{"type":400,"value":3909}," open",{"type":394,"tag":485,"props":3911,"children":3912},{"style":540},[3913],{"type":400,"value":622},{"type":394,"tag":485,"props":3915,"children":3916},{"style":566},[3917],{"type":400,"value":3918},"filepath_dboptions",{"type":394,"tag":485,"props":3920,"children":3921},{"style":540},[3922],{"type":400,"value":677},{"type":394,"tag":485,"props":3924,"children":3925},{"style":534},[3926],{"type":400,"value":805},{"type":394,"tag":485,"props":3928,"children":3929},{"style":540},[3930],{"type":400,"value":3616},{"type":394,"tag":485,"props":3932,"children":3933},{"style":745},[3934],{"type":400,"value":3935}," O_RDONLY",{"type":394,"tag":485,"props":3937,"children":3938},{"style":540},[3939],{"type":400,"value":632},{"type":394,"tag":485,"props":3941,"children":3943},{"style":3942},"--shiki-light:#F76D47;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[3944],{"type":400,"value":1318},{"type":394,"tag":485,"props":3946,"children":3947},{"style":826},[3948],{"type":400,"value":3949},"644",{"type":394,"tag":485,"props":3951,"children":3952},{"style":540},[3953],{"type":400,"value":652},{"type":394,"tag":485,"props":3955,"children":3956},{"class":487,"line":598},[3957,3962,3966,3971,3975,3980,3985,3990],{"type":394,"tag":485,"props":3958,"children":3959},{"style":534},[3960],{"type":400,"value":3961},"    flock",{"type":394,"tag":485,"props":3963,"children":3964},{"style":540},[3965],{"type":400,"value":622},{"type":394,"tag":485,"props":3967,"children":3968},{"style":745},[3969],{"type":400,"value":3970},"fd_dboptions_",{"type":394,"tag":485,"props":3972,"children":3973},{"style":540},[3974],{"type":400,"value":632},{"type":394,"tag":485,"props":3976,"children":3977},{"style":745},[3978],{"type":400,"value":3979}," LOCK_EX ",{"type":394,"tag":485,"props":3981,"children":3982},{"style":664},[3983],{"type":400,"value":3984},"|",{"type":394,"tag":485,"props":3986,"children":3987},{"style":745},[3988],{"type":400,"value":3989}," LOCK_NB",{"type":394,"tag":485,"props":3991,"children":3992},{"style":540},[3993],{"type":400,"value":652},{"type":394,"tag":485,"props":3995,"children":3996},{"class":487,"line":655},[3997,4002,4007,4011,4015,4019,4024,4028,4033],{"type":394,"tag":485,"props":3998,"children":3999},{"style":745},[4000],{"type":400,"value":4001},"    Mmap ",{"type":394,"tag":485,"props":4003,"children":4004},{"style":534},[4005],{"type":400,"value":4006},"mmap",{"type":394,"tag":485,"props":4008,"children":4009},{"style":540},[4010],{"type":400,"value":622},{"type":394,"tag":485,"props":4012,"children":4013},{"style":745},[4014],{"type":400,"value":3918},{"type":394,"tag":485,"props":4016,"children":4017},{"style":540},[4018],{"type":400,"value":632},{"type":394,"tag":485,"props":4020,"children":4021},{"style":566},[4022],{"type":400,"value":4023}," info",{"type":394,"tag":485,"props":4025,"children":4026},{"style":540},[4027],{"type":400,"value":677},{"type":394,"tag":485,"props":4029,"children":4030},{"style":566},[4031],{"type":400,"value":4032},"st_size",{"type":394,"tag":485,"props":4034,"children":4035},{"style":540},[4036],{"type":400,"value":652},{"type":394,"tag":485,"props":4038,"children":4039},{"class":487,"line":690},[4040,4045,4049,4054,4058,4063,4067,4071,4075,4080,4084,4089,4093,4098,4102,4106,4111],{"type":394,"tag":485,"props":4041,"children":4042},{"style":745},[4043],{"type":400,"value":4044},"    Status status_dboptions ",{"type":394,"tag":485,"props":4046,"children":4047},{"style":664},[4048],{"type":400,"value":667},{"type":394,"tag":485,"props":4050,"children":4051},{"style":555},[4052],{"type":400,"value":4053}," DatabaseOptionEncoder",{"type":394,"tag":485,"props":4055,"children":4056},{"style":540},[4057],{"type":400,"value":563},{"type":394,"tag":485,"props":4059,"children":4060},{"style":534},[4061],{"type":400,"value":4062},"DecodeFrom",{"type":394,"tag":485,"props":4064,"children":4065},{"style":540},[4066],{"type":400,"value":622},{"type":394,"tag":485,"props":4068,"children":4069},{"style":566},[4070],{"type":400,"value":4006},{"type":394,"tag":485,"props":4072,"children":4073},{"style":540},[4074],{"type":400,"value":677},{"type":394,"tag":485,"props":4076,"children":4077},{"style":534},[4078],{"type":400,"value":4079},"datafile",{"type":394,"tag":485,"props":4081,"children":4082},{"style":540},[4083],{"type":400,"value":3616},{"type":394,"tag":485,"props":4085,"children":4086},{"style":566},[4087],{"type":400,"value":4088}," mmap",{"type":394,"tag":485,"props":4090,"children":4091},{"style":540},[4092],{"type":400,"value":677},{"type":394,"tag":485,"props":4094,"children":4095},{"style":534},[4096],{"type":400,"value":4097},"filesize",{"type":394,"tag":485,"props":4099,"children":4100},{"style":540},[4101],{"type":400,"value":3616},{"type":394,"tag":485,"props":4103,"children":4104},{"style":664},[4105],{"type":400,"value":1120},{"type":394,"tag":485,"props":4107,"children":4108},{"style":745},[4109],{"type":400,"value":4110},"db_options_candidate",{"type":394,"tag":485,"props":4112,"children":4113},{"style":540},[4114],{"type":400,"value":652},{"type":394,"tag":485,"props":4116,"children":4117},{"class":487,"line":732},[4118],{"type":394,"tag":485,"props":4119,"children":4120},{"style":1494},[4121],{"type":400,"value":4122},"    // ...\n",{"type":394,"tag":485,"props":4124,"children":4125},{"class":487,"line":813},[4126,4131,4135,4140,4145],{"type":394,"tag":485,"props":4127,"children":4128},{"style":745},[4129],{"type":400,"value":4130},"    em_ ",{"type":394,"tag":485,"props":4132,"children":4133},{"style":664},[4134],{"type":400,"value":667},{"type":394,"tag":485,"props":4136,"children":4137},{"style":664},[4138],{"type":400,"value":4139}," new",{"type":394,"tag":485,"props":4141,"children":4142},{"style":534},[4143],{"type":400,"value":4144}," EventManager",{"type":394,"tag":485,"props":4146,"children":4147},{"style":540},[4148],{"type":400,"value":687},{"type":394,"tag":485,"props":4150,"children":4151},{"class":487,"line":836},[4152,4157,4161,4165,4170,4174,4179,4183,4188],{"type":394,"tag":485,"props":4153,"children":4154},{"style":745},[4155],{"type":400,"value":4156},"    wb_ ",{"type":394,"tag":485,"props":4158,"children":4159},{"style":664},[4160],{"type":400,"value":667},{"type":394,"tag":485,"props":4162,"children":4163},{"style":664},[4164],{"type":400,"value":4139},{"type":394,"tag":485,"props":4166,"children":4167},{"style":534},[4168],{"type":400,"value":4169}," WriteBuffer",{"type":394,"tag":485,"props":4171,"children":4172},{"style":540},[4173],{"type":400,"value":622},{"type":394,"tag":485,"props":4175,"children":4176},{"style":745},[4177],{"type":400,"value":4178},"db_options_",{"type":394,"tag":485,"props":4180,"children":4181},{"style":540},[4182],{"type":400,"value":632},{"type":394,"tag":485,"props":4184,"children":4185},{"style":745},[4186],{"type":400,"value":4187}," em_",{"type":394,"tag":485,"props":4189,"children":4190},{"style":540},[4191],{"type":400,"value":652},{"type":394,"tag":485,"props":4193,"children":4194},{"class":487,"line":845},[4195,4200,4204,4208,4213,4217,4221,4225,4229,4233,4238],{"type":394,"tag":485,"props":4196,"children":4197},{"style":745},[4198],{"type":400,"value":4199},"    se_ ",{"type":394,"tag":485,"props":4201,"children":4202},{"style":664},[4203],{"type":400,"value":667},{"type":394,"tag":485,"props":4205,"children":4206},{"style":664},[4207],{"type":400,"value":4139},{"type":394,"tag":485,"props":4209,"children":4210},{"style":534},[4211],{"type":400,"value":4212}," StorageEngine",{"type":394,"tag":485,"props":4214,"children":4215},{"style":540},[4216],{"type":400,"value":622},{"type":394,"tag":485,"props":4218,"children":4219},{"style":745},[4220],{"type":400,"value":4178},{"type":394,"tag":485,"props":4222,"children":4223},{"style":540},[4224],{"type":400,"value":632},{"type":394,"tag":485,"props":4226,"children":4227},{"style":745},[4228],{"type":400,"value":4187},{"type":394,"tag":485,"props":4230,"children":4231},{"style":540},[4232],{"type":400,"value":632},{"type":394,"tag":485,"props":4234,"children":4235},{"style":745},[4236],{"type":400,"value":4237}," dbname_",{"type":394,"tag":485,"props":4239,"children":4240},{"style":540},[4241],{"type":400,"value":652},{"type":394,"tag":485,"props":4243,"children":4244},{"class":487,"line":853},[4245,4249,4253,4257,4262,4266],{"type":394,"tag":485,"props":4246,"children":4247},{"style":492},[4248],{"type":400,"value":2725},{"type":394,"tag":485,"props":4250,"children":4251},{"style":555},[4252],{"type":400,"value":3487},{"type":394,"tag":485,"props":4254,"children":4255},{"style":540},[4256],{"type":400,"value":563},{"type":394,"tag":485,"props":4258,"children":4259},{"style":534},[4260],{"type":400,"value":4261},"OK",{"type":394,"tag":485,"props":4263,"children":4264},{"style":540},[4265],{"type":400,"value":1981},{"type":394,"tag":485,"props":4267,"children":4268},{"style":745},[4269],{"type":400,"value":1233},{"type":394,"tag":485,"props":4271,"children":4272},{"class":487,"line":896},[4273],{"type":394,"tag":485,"props":4274,"children":4275},{"style":540},[4276],{"type":400,"value":842},{"type":394,"tag":485,"props":4278,"children":4279},{"class":487,"line":937},[4280,4284,4288,4292,4296,4300],{"type":394,"tag":485,"props":4281,"children":4282},{"style":1992},[4283],{"type":400,"value":3788},{"type":394,"tag":485,"props":4285,"children":4286},{"style":528},[4287],{"type":400,"value":2000},{"type":394,"tag":485,"props":4289,"children":4290},{"style":534},[4291],{"type":400,"value":3806},{"type":394,"tag":485,"props":4293,"children":4294},{"style":540},[4295],{"type":400,"value":543},{"type":394,"tag":485,"props":4297,"children":4298},{"style":1992},[4299],{"type":400,"value":3840},{"type":394,"tag":485,"props":4301,"children":4302},{"style":540},[4303],{"type":400,"value":548},{"type":394,"tag":485,"props":4305,"children":4306},{"class":487,"line":945},[4307,4311,4315,4319,4323,4328],{"type":394,"tag":485,"props":4308,"children":4309},{"style":534},[4310],{"type":400,"value":3961},{"type":394,"tag":485,"props":4312,"children":4313},{"style":540},[4314],{"type":400,"value":622},{"type":394,"tag":485,"props":4316,"children":4317},{"style":745},[4318],{"type":400,"value":3970},{"type":394,"tag":485,"props":4320,"children":4321},{"style":540},[4322],{"type":400,"value":632},{"type":394,"tag":485,"props":4324,"children":4325},{"style":745},[4326],{"type":400,"value":4327}," LOCK_UN",{"type":394,"tag":485,"props":4329,"children":4330},{"style":540},[4331],{"type":400,"value":652},{"type":394,"tag":485,"props":4333,"children":4334},{"class":487,"line":966},[4335,4340,4344,4348],{"type":394,"tag":485,"props":4336,"children":4337},{"style":534},[4338],{"type":400,"value":4339},"    close",{"type":394,"tag":485,"props":4341,"children":4342},{"style":540},[4343],{"type":400,"value":622},{"type":394,"tag":485,"props":4345,"children":4346},{"style":745},[4347],{"type":400,"value":3970},{"type":394,"tag":485,"props":4349,"children":4350},{"style":540},[4351],{"type":400,"value":652},{"type":394,"tag":485,"props":4353,"children":4354},{"class":487,"line":1022},[4355,4360,4365,4370],{"type":394,"tag":485,"props":4356,"children":4357},{"style":566},[4358],{"type":400,"value":4359},"    wb_",{"type":394,"tag":485,"props":4361,"children":4362},{"style":540},[4363],{"type":400,"value":4364},"->",{"type":394,"tag":485,"props":4366,"children":4367},{"style":534},[4368],{"type":400,"value":4369},"Close",{"type":394,"tag":485,"props":4371,"children":4372},{"style":540},[4373],{"type":400,"value":687},{"type":394,"tag":485,"props":4375,"children":4376},{"class":487,"line":1030},[4377,4382,4386,4390],{"type":394,"tag":485,"props":4378,"children":4379},{"style":566},[4380],{"type":400,"value":4381},"    se_",{"type":394,"tag":485,"props":4383,"children":4384},{"style":540},[4385],{"type":400,"value":4364},{"type":394,"tag":485,"props":4387,"children":4388},{"style":534},[4389],{"type":400,"value":4369},{"type":394,"tag":485,"props":4391,"children":4392},{"style":540},[4393],{"type":400,"value":687},{"type":394,"tag":485,"props":4395,"children":4396},{"class":487,"line":1051},[4397,4402,4407],{"type":394,"tag":485,"props":4398,"children":4399},{"style":664},[4400],{"type":400,"value":4401},"    delete",{"type":394,"tag":485,"props":4403,"children":4404},{"style":745},[4405],{"type":400,"value":4406}," wb_",{"type":394,"tag":485,"props":4408,"children":4409},{"style":540},[4410],{"type":400,"value":574},{"type":394,"tag":485,"props":4412,"children":4413},{"class":487,"line":1072},[4414,4418,4423],{"type":394,"tag":485,"props":4415,"children":4416},{"style":664},[4417],{"type":400,"value":4401},{"type":394,"tag":485,"props":4419,"children":4420},{"style":745},[4421],{"type":400,"value":4422}," se_",{"type":394,"tag":485,"props":4424,"children":4425},{"style":540},[4426],{"type":400,"value":574},{"type":394,"tag":485,"props":4428,"children":4429},{"class":487,"line":1132},[4430,4434,4438],{"type":394,"tag":485,"props":4431,"children":4432},{"style":664},[4433],{"type":400,"value":4401},{"type":394,"tag":485,"props":4435,"children":4436},{"style":745},[4437],{"type":400,"value":4187},{"type":394,"tag":485,"props":4439,"children":4440},{"style":540},[4441],{"type":400,"value":574},{"type":394,"tag":485,"props":4443,"children":4444},{"class":487,"line":1196},[4445],{"type":394,"tag":485,"props":4446,"children":4447},{"style":540},[4448],{"type":400,"value":842},{"type":394,"tag":485,"props":4450,"children":4451},{"class":487,"line":1236},[4452],{"type":394,"tag":485,"props":4453,"children":4454},{"style":540},[4455],{"type":400,"value":1331},{"type":394,"tag":408,"props":4457,"children":4458},{},[4459],{"type":400,"value":4460},"因为数据库不能同时关闭或是开启，所以 Open 以及 Close 中都使用了 std::unique_lock 进行锁定。",{"type":394,"tag":474,"props":4462,"children":4464},{"code":4463,"language":477,"meta":388,"className":478,"style":388},"virtual Status Open() override {\n  std::unique_lock\u003Cstd::mutex> lock(mutex_close_);\n}\nvirtual void Close() override {\n  std::unique_lock\u003Cstd::mutex> lock(mutex_close_);\n}\n",[4465],{"type":394,"tag":481,"props":4466,"children":4467},{"__ignoreMap":388},[4468,4495,4550,4557,4584,4635],{"type":394,"tag":485,"props":4469,"children":4470},{"class":487,"line":488},[4471,4475,4479,4483,4487,4491],{"type":394,"tag":485,"props":4472,"children":4473},{"style":1992},[4474],{"type":400,"value":3482},{"type":394,"tag":485,"props":4476,"children":4477},{"style":555},[4478],{"type":400,"value":3487},{"type":394,"tag":485,"props":4480,"children":4481},{"style":534},[4482],{"type":400,"value":3831},{"type":394,"tag":485,"props":4484,"children":4485},{"style":540},[4486],{"type":400,"value":543},{"type":394,"tag":485,"props":4488,"children":4489},{"style":1992},[4490],{"type":400,"value":3840},{"type":394,"tag":485,"props":4492,"children":4493},{"style":540},[4494],{"type":400,"value":548},{"type":394,"tag":485,"props":4496,"children":4497},{"class":487,"line":515},[4498,4502,4506,4511,4515,4519,4523,4528,4532,4537,4541,4546],{"type":394,"tag":485,"props":4499,"children":4500},{"style":555},[4501],{"type":400,"value":859},{"type":394,"tag":485,"props":4503,"children":4504},{"style":540},[4505],{"type":400,"value":563},{"type":394,"tag":485,"props":4507,"children":4508},{"style":566},[4509],{"type":400,"value":4510},"unique_lock",{"type":394,"tag":485,"props":4512,"children":4513},{"style":664},[4514],{"type":400,"value":3264},{"type":394,"tag":485,"props":4516,"children":4517},{"style":555},[4518],{"type":400,"value":2936},{"type":394,"tag":485,"props":4520,"children":4521},{"style":540},[4522],{"type":400,"value":563},{"type":394,"tag":485,"props":4524,"children":4525},{"style":566},[4526],{"type":400,"value":4527},"mutex",{"type":394,"tag":485,"props":4529,"children":4530},{"style":664},[4531],{"type":400,"value":2472},{"type":394,"tag":485,"props":4533,"children":4534},{"style":534},[4535],{"type":400,"value":4536}," lock",{"type":394,"tag":485,"props":4538,"children":4539},{"style":540},[4540],{"type":400,"value":622},{"type":394,"tag":485,"props":4542,"children":4543},{"style":566},[4544],{"type":400,"value":4545},"mutex_close_",{"type":394,"tag":485,"props":4547,"children":4548},{"style":540},[4549],{"type":400,"value":652},{"type":394,"tag":485,"props":4551,"children":4552},{"class":487,"line":524},[4553],{"type":394,"tag":485,"props":4554,"children":4555},{"style":540},[4556],{"type":400,"value":1331},{"type":394,"tag":485,"props":4558,"children":4559},{"class":487,"line":551},[4560,4564,4568,4572,4576,4580],{"type":394,"tag":485,"props":4561,"children":4562},{"style":1992},[4563],{"type":400,"value":3482},{"type":394,"tag":485,"props":4565,"children":4566},{"style":528},[4567],{"type":400,"value":2000},{"type":394,"tag":485,"props":4569,"children":4570},{"style":534},[4571],{"type":400,"value":3806},{"type":394,"tag":485,"props":4573,"children":4574},{"style":540},[4575],{"type":400,"value":543},{"type":394,"tag":485,"props":4577,"children":4578},{"style":1992},[4579],{"type":400,"value":3840},{"type":394,"tag":485,"props":4581,"children":4582},{"style":540},[4583],{"type":400,"value":548},{"type":394,"tag":485,"props":4585,"children":4586},{"class":487,"line":577},[4587,4591,4595,4599,4603,4607,4611,4615,4619,4623,4627,4631],{"type":394,"tag":485,"props":4588,"children":4589},{"style":555},[4590],{"type":400,"value":859},{"type":394,"tag":485,"props":4592,"children":4593},{"style":540},[4594],{"type":400,"value":563},{"type":394,"tag":485,"props":4596,"children":4597},{"style":566},[4598],{"type":400,"value":4510},{"type":394,"tag":485,"props":4600,"children":4601},{"style":664},[4602],{"type":400,"value":3264},{"type":394,"tag":485,"props":4604,"children":4605},{"style":555},[4606],{"type":400,"value":2936},{"type":394,"tag":485,"props":4608,"children":4609},{"style":540},[4610],{"type":400,"value":563},{"type":394,"tag":485,"props":4612,"children":4613},{"style":566},[4614],{"type":400,"value":4527},{"type":394,"tag":485,"props":4616,"children":4617},{"style":664},[4618],{"type":400,"value":2472},{"type":394,"tag":485,"props":4620,"children":4621},{"style":534},[4622],{"type":400,"value":4536},{"type":394,"tag":485,"props":4624,"children":4625},{"style":540},[4626],{"type":400,"value":622},{"type":394,"tag":485,"props":4628,"children":4629},{"style":566},[4630],{"type":400,"value":4545},{"type":394,"tag":485,"props":4632,"children":4633},{"style":540},[4634],{"type":400,"value":652},{"type":394,"tag":485,"props":4636,"children":4637},{"class":487,"line":598},[4638],{"type":394,"tag":485,"props":4639,"children":4640},{"style":540},[4641],{"type":400,"value":1331},{"type":394,"tag":402,"props":4643,"children":4644},{"id":3460},[4645],{"type":400,"value":3460},{"type":394,"tag":408,"props":4647,"children":4648},{},[4649],{"type":400,"value":4650},"代码没有使用 C++ 风格的异常捕获，取而代之的是设计了状态类 Status。就像 kingdb_user 示例展示的，所有数据库操作都会返回一个状态实例，通过调用其 IsOK 方法，调用者可以判断处出操作有没有成功；如果失败了，可以使用 ToString 方法把出错原因输出。尽管这种设计会带来额外的内存开销，且使每次调用都带来轻微的性能消耗，不过这种消耗可以避免魔法数值，它将错误码和核心解耦，使代码有更佳的可读性。",{"type":394,"tag":474,"props":4652,"children":4654},{"code":4653,"language":477,"meta":388,"className":478,"style":388},"class Status {\n  // ...\n  static Status OK() { return Status(); }\n  bool IsOK() const { return (code_ == kOK); }\n  // ...\n  enum Code {\n    kOK = 0, \n    kNotFound = 1,\n    kDeleteOrder = 2,\n    kInvalidArgument = 3,\n    kIOError = 4,\n    kDone = 5,\n    kMultipartRequired = 6\n  };\n  // ...\n}\nstd::string Status::ToString() const {\n  if (message1_ == \"\") {\n    return \"OK\";\n  } else {\n    char tmp[30];\n    const char* type;\n    switch (code()) {\n      case kOK:\n        type = \"OK\";\n        break;\n      // ...\n    }\n    // ...\n    return result;\n  }\n}\n",[4655],{"type":394,"tag":481,"props":4656,"children":4657},{"__ignoreMap":388},[4658,4673,4680,4721,4776,4783,4800,4825,4846,4867,4888,4909,4930,4947,4955,4962,4969,5008,5041,5064,5079,5105,5132,5156,5173,5201,5213,5221,5229,5236,5253,5261],{"type":394,"tag":485,"props":4659,"children":4660},{"class":487,"line":488},[4661,4665,4669],{"type":394,"tag":485,"props":4662,"children":4663},{"style":528},[4664],{"type":400,"value":1905},{"type":394,"tag":485,"props":4666,"children":4667},{"style":555},[4668],{"type":400,"value":3487},{"type":394,"tag":485,"props":4670,"children":4671},{"style":540},[4672],{"type":400,"value":548},{"type":394,"tag":485,"props":4674,"children":4675},{"class":487,"line":515},[4676],{"type":394,"tag":485,"props":4677,"children":4678},{"style":1494},[4679],{"type":400,"value":1850},{"type":394,"tag":485,"props":4681,"children":4682},{"class":487,"line":524},[4683,4687,4691,4696,4700,4704,4709,4713,4717],{"type":394,"tag":485,"props":4684,"children":4685},{"style":1992},[4686],{"type":400,"value":1995},{"type":394,"tag":485,"props":4688,"children":4689},{"style":555},[4690],{"type":400,"value":3487},{"type":394,"tag":485,"props":4692,"children":4693},{"style":534},[4694],{"type":400,"value":4695}," OK",{"type":394,"tag":485,"props":4697,"children":4698},{"style":540},[4699],{"type":400,"value":543},{"type":394,"tag":485,"props":4701,"children":4702},{"style":540},[4703],{"type":400,"value":2014},{"type":394,"tag":485,"props":4705,"children":4706},{"style":492},[4707],{"type":400,"value":4708}," return",{"type":394,"tag":485,"props":4710,"children":4711},{"style":534},[4712],{"type":400,"value":3487},{"type":394,"tag":485,"props":4714,"children":4715},{"style":540},[4716],{"type":400,"value":1981},{"type":394,"tag":485,"props":4718,"children":4719},{"style":540},[4720],{"type":400,"value":3815},{"type":394,"tag":485,"props":4722,"children":4723},{"class":487,"line":551},[4724,4729,4734,4738,4742,4746,4750,4754,4759,4763,4768,4772],{"type":394,"tag":485,"props":4725,"children":4726},{"style":528},[4727],{"type":400,"value":4728},"  bool",{"type":394,"tag":485,"props":4730,"children":4731},{"style":534},[4732],{"type":400,"value":4733}," IsOK",{"type":394,"tag":485,"props":4735,"children":4736},{"style":540},[4737],{"type":400,"value":543},{"type":394,"tag":485,"props":4739,"children":4740},{"style":1992},[4741],{"type":400,"value":2526},{"type":394,"tag":485,"props":4743,"children":4744},{"style":540},[4745],{"type":400,"value":2014},{"type":394,"tag":485,"props":4747,"children":4748},{"style":492},[4749],{"type":400,"value":4708},{"type":394,"tag":485,"props":4751,"children":4752},{"style":540},[4753],{"type":400,"value":701},{"type":394,"tag":485,"props":4755,"children":4756},{"style":745},[4757],{"type":400,"value":4758},"code_ ",{"type":394,"tag":485,"props":4760,"children":4761},{"style":664},[4762],{"type":400,"value":1172},{"type":394,"tag":485,"props":4764,"children":4765},{"style":745},[4766],{"type":400,"value":4767}," kOK",{"type":394,"tag":485,"props":4769,"children":4770},{"style":540},[4771],{"type":400,"value":1228},{"type":394,"tag":485,"props":4773,"children":4774},{"style":540},[4775],{"type":400,"value":3815},{"type":394,"tag":485,"props":4777,"children":4778},{"class":487,"line":577},[4779],{"type":394,"tag":485,"props":4780,"children":4781},{"style":1494},[4782],{"type":400,"value":1850},{"type":394,"tag":485,"props":4784,"children":4785},{"class":487,"line":598},[4786,4791,4796],{"type":394,"tag":485,"props":4787,"children":4788},{"style":528},[4789],{"type":400,"value":4790},"  enum",{"type":394,"tag":485,"props":4792,"children":4793},{"style":555},[4794],{"type":400,"value":4795}," Code",{"type":394,"tag":485,"props":4797,"children":4798},{"style":540},[4799],{"type":400,"value":548},{"type":394,"tag":485,"props":4801,"children":4802},{"class":487,"line":655},[4803,4809,4813,4817,4821],{"type":394,"tag":485,"props":4804,"children":4806},{"style":4805},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#F8F8F2",[4807],{"type":400,"value":4808},"    kOK",{"type":394,"tag":485,"props":4810,"children":4811},{"style":664},[4812],{"type":400,"value":2151},{"type":394,"tag":485,"props":4814,"children":4815},{"style":826},[4816],{"type":400,"value":1318},{"type":394,"tag":485,"props":4818,"children":4819},{"style":540},[4820],{"type":400,"value":632},{"type":394,"tag":485,"props":4822,"children":4823},{"style":745},[4824],{"type":400,"value":1233},{"type":394,"tag":485,"props":4826,"children":4827},{"class":487,"line":690},[4828,4833,4837,4841],{"type":394,"tag":485,"props":4829,"children":4830},{"style":4805},[4831],{"type":400,"value":4832},"    kNotFound",{"type":394,"tag":485,"props":4834,"children":4835},{"style":664},[4836],{"type":400,"value":2151},{"type":394,"tag":485,"props":4838,"children":4839},{"style":826},[4840],{"type":400,"value":3043},{"type":394,"tag":485,"props":4842,"children":4843},{"style":540},[4844],{"type":400,"value":4845},",\n",{"type":394,"tag":485,"props":4847,"children":4848},{"class":487,"line":732},[4849,4854,4858,4863],{"type":394,"tag":485,"props":4850,"children":4851},{"style":4805},[4852],{"type":400,"value":4853},"    kDeleteOrder",{"type":394,"tag":485,"props":4855,"children":4856},{"style":664},[4857],{"type":400,"value":2151},{"type":394,"tag":485,"props":4859,"children":4860},{"style":826},[4861],{"type":400,"value":4862}," 2",{"type":394,"tag":485,"props":4864,"children":4865},{"style":540},[4866],{"type":400,"value":4845},{"type":394,"tag":485,"props":4868,"children":4869},{"class":487,"line":813},[4870,4875,4879,4884],{"type":394,"tag":485,"props":4871,"children":4872},{"style":4805},[4873],{"type":400,"value":4874},"    kInvalidArgument",{"type":394,"tag":485,"props":4876,"children":4877},{"style":664},[4878],{"type":400,"value":2151},{"type":394,"tag":485,"props":4880,"children":4881},{"style":826},[4882],{"type":400,"value":4883}," 3",{"type":394,"tag":485,"props":4885,"children":4886},{"style":540},[4887],{"type":400,"value":4845},{"type":394,"tag":485,"props":4889,"children":4890},{"class":487,"line":836},[4891,4896,4900,4905],{"type":394,"tag":485,"props":4892,"children":4893},{"style":4805},[4894],{"type":400,"value":4895},"    kIOError",{"type":394,"tag":485,"props":4897,"children":4898},{"style":664},[4899],{"type":400,"value":2151},{"type":394,"tag":485,"props":4901,"children":4902},{"style":826},[4903],{"type":400,"value":4904}," 4",{"type":394,"tag":485,"props":4906,"children":4907},{"style":540},[4908],{"type":400,"value":4845},{"type":394,"tag":485,"props":4910,"children":4911},{"class":487,"line":845},[4912,4917,4921,4926],{"type":394,"tag":485,"props":4913,"children":4914},{"style":4805},[4915],{"type":400,"value":4916},"    kDone",{"type":394,"tag":485,"props":4918,"children":4919},{"style":664},[4920],{"type":400,"value":2151},{"type":394,"tag":485,"props":4922,"children":4923},{"style":826},[4924],{"type":400,"value":4925}," 5",{"type":394,"tag":485,"props":4927,"children":4928},{"style":540},[4929],{"type":400,"value":4845},{"type":394,"tag":485,"props":4931,"children":4932},{"class":487,"line":853},[4933,4938,4942],{"type":394,"tag":485,"props":4934,"children":4935},{"style":4805},[4936],{"type":400,"value":4937},"    kMultipartRequired",{"type":394,"tag":485,"props":4939,"children":4940},{"style":664},[4941],{"type":400,"value":2151},{"type":394,"tag":485,"props":4943,"children":4944},{"style":826},[4945],{"type":400,"value":4946}," 6\n",{"type":394,"tag":485,"props":4948,"children":4949},{"class":487,"line":896},[4950],{"type":394,"tag":485,"props":4951,"children":4952},{"style":540},[4953],{"type":400,"value":4954},"  };\n",{"type":394,"tag":485,"props":4956,"children":4957},{"class":487,"line":937},[4958],{"type":394,"tag":485,"props":4959,"children":4960},{"style":1494},[4961],{"type":400,"value":1850},{"type":394,"tag":485,"props":4963,"children":4964},{"class":487,"line":945},[4965],{"type":394,"tag":485,"props":4966,"children":4967},{"style":540},[4968],{"type":400,"value":1331},{"type":394,"tag":485,"props":4970,"children":4971},{"class":487,"line":966},[4972,4976,4980,4984,4988,4992,4996,5000,5004],{"type":394,"tag":485,"props":4973,"children":4974},{"style":555},[4975],{"type":400,"value":2936},{"type":394,"tag":485,"props":4977,"children":4978},{"style":540},[4979],{"type":400,"value":563},{"type":394,"tag":485,"props":4981,"children":4982},{"style":555},[4983],{"type":400,"value":3531},{"type":394,"tag":485,"props":4985,"children":4986},{"style":555},[4987],{"type":400,"value":3487},{"type":394,"tag":485,"props":4989,"children":4990},{"style":540},[4991],{"type":400,"value":563},{"type":394,"tag":485,"props":4993,"children":4994},{"style":534},[4995],{"type":400,"value":795},{"type":394,"tag":485,"props":4997,"children":4998},{"style":540},[4999],{"type":400,"value":543},{"type":394,"tag":485,"props":5001,"children":5002},{"style":1992},[5003],{"type":400,"value":2526},{"type":394,"tag":485,"props":5005,"children":5006},{"style":540},[5007],{"type":400,"value":548},{"type":394,"tag":485,"props":5009,"children":5010},{"class":487,"line":1022},[5011,5015,5019,5024,5028,5033,5037],{"type":394,"tag":485,"props":5012,"children":5013},{"style":492},[5014],{"type":400,"value":696},{"type":394,"tag":485,"props":5016,"children":5017},{"style":540},[5018],{"type":400,"value":701},{"type":394,"tag":485,"props":5020,"children":5021},{"style":745},[5022],{"type":400,"value":5023},"message1_ ",{"type":394,"tag":485,"props":5025,"children":5026},{"style":664},[5027],{"type":400,"value":1172},{"type":394,"tag":485,"props":5029,"children":5030},{"style":498},[5031],{"type":400,"value":5032}," \"\"",{"type":394,"tag":485,"props":5034,"children":5035},{"style":540},[5036],{"type":400,"value":1189},{"type":394,"tag":485,"props":5038,"children":5039},{"style":540},[5040],{"type":400,"value":548},{"type":394,"tag":485,"props":5042,"children":5043},{"class":487,"line":1030},[5044,5048,5052,5056,5060],{"type":394,"tag":485,"props":5045,"children":5046},{"style":492},[5047],{"type":400,"value":2725},{"type":394,"tag":485,"props":5049,"children":5050},{"style":498},[5051],{"type":400,"value":637},{"type":394,"tag":485,"props":5053,"children":5054},{"style":504},[5055],{"type":400,"value":4261},{"type":394,"tag":485,"props":5057,"children":5058},{"style":498},[5059],{"type":400,"value":647},{"type":394,"tag":485,"props":5061,"children":5062},{"style":540},[5063],{"type":400,"value":574},{"type":394,"tag":485,"props":5065,"children":5066},{"class":487,"line":1051},[5067,5071,5075],{"type":394,"tag":485,"props":5068,"children":5069},{"style":540},[5070],{"type":400,"value":1242},{"type":394,"tag":485,"props":5072,"children":5073},{"style":492},[5074],{"type":400,"value":1247},{"type":394,"tag":485,"props":5076,"children":5077},{"style":540},[5078],{"type":400,"value":548},{"type":394,"tag":485,"props":5080,"children":5081},{"class":487,"line":1072},[5082,5087,5092,5096,5101],{"type":394,"tag":485,"props":5083,"children":5084},{"style":528},[5085],{"type":400,"value":5086},"    char",{"type":394,"tag":485,"props":5088,"children":5089},{"style":566},[5090],{"type":400,"value":5091}," tmp",{"type":394,"tag":485,"props":5093,"children":5094},{"style":540},[5095],{"type":400,"value":1461},{"type":394,"tag":485,"props":5097,"children":5098},{"style":826},[5099],{"type":400,"value":5100},"30",{"type":394,"tag":485,"props":5102,"children":5103},{"style":540},[5104],{"type":400,"value":1471},{"type":394,"tag":485,"props":5106,"children":5107},{"class":487,"line":1132},[5108,5113,5118,5123,5128],{"type":394,"tag":485,"props":5109,"children":5110},{"style":1992},[5111],{"type":400,"value":5112},"    const",{"type":394,"tag":485,"props":5114,"children":5115},{"style":528},[5116],{"type":400,"value":5117}," char",{"type":394,"tag":485,"props":5119,"children":5120},{"style":664},[5121],{"type":400,"value":5122},"*",{"type":394,"tag":485,"props":5124,"children":5125},{"style":745},[5126],{"type":400,"value":5127}," type",{"type":394,"tag":485,"props":5129,"children":5130},{"style":540},[5131],{"type":400,"value":574},{"type":394,"tag":485,"props":5133,"children":5134},{"class":487,"line":1196},[5135,5140,5144,5148,5152],{"type":394,"tag":485,"props":5136,"children":5137},{"style":492},[5138],{"type":400,"value":5139},"    switch",{"type":394,"tag":485,"props":5141,"children":5142},{"style":540},[5143],{"type":400,"value":701},{"type":394,"tag":485,"props":5145,"children":5146},{"style":534},[5147],{"type":400,"value":481},{"type":394,"tag":485,"props":5149,"children":5150},{"style":540},[5151],{"type":400,"value":725},{"type":394,"tag":485,"props":5153,"children":5154},{"style":540},[5155],{"type":400,"value":548},{"type":394,"tag":485,"props":5157,"children":5158},{"class":487,"line":1236},[5159,5164,5168],{"type":394,"tag":485,"props":5160,"children":5161},{"style":492},[5162],{"type":400,"value":5163},"      case",{"type":394,"tag":485,"props":5165,"children":5166},{"style":745},[5167],{"type":400,"value":4767},{"type":394,"tag":485,"props":5169,"children":5170},{"style":540},[5171],{"type":400,"value":5172},":\n",{"type":394,"tag":485,"props":5174,"children":5175},{"class":487,"line":1254},[5176,5181,5185,5189,5193,5197],{"type":394,"tag":485,"props":5177,"children":5178},{"style":745},[5179],{"type":400,"value":5180},"        type ",{"type":394,"tag":485,"props":5182,"children":5183},{"style":664},[5184],{"type":400,"value":667},{"type":394,"tag":485,"props":5186,"children":5187},{"style":498},[5188],{"type":400,"value":637},{"type":394,"tag":485,"props":5190,"children":5191},{"style":504},[5192],{"type":400,"value":4261},{"type":394,"tag":485,"props":5194,"children":5195},{"style":498},[5196],{"type":400,"value":647},{"type":394,"tag":485,"props":5198,"children":5199},{"style":540},[5200],{"type":400,"value":574},{"type":394,"tag":485,"props":5202,"children":5203},{"class":487,"line":1291},[5204,5209],{"type":394,"tag":485,"props":5205,"children":5206},{"style":492},[5207],{"type":400,"value":5208},"        break",{"type":394,"tag":485,"props":5210,"children":5211},{"style":540},[5212],{"type":400,"value":574},{"type":394,"tag":485,"props":5214,"children":5215},{"class":487,"line":1299},[5216],{"type":394,"tag":485,"props":5217,"children":5218},{"style":1494},[5219],{"type":400,"value":5220},"      // ...\n",{"type":394,"tag":485,"props":5222,"children":5223},{"class":487,"line":1307},[5224],{"type":394,"tag":485,"props":5225,"children":5226},{"style":540},[5227],{"type":400,"value":5228},"    }\n",{"type":394,"tag":485,"props":5230,"children":5231},{"class":487,"line":1325},[5232],{"type":394,"tag":485,"props":5233,"children":5234},{"style":1494},[5235],{"type":400,"value":4122},{"type":394,"tag":485,"props":5237,"children":5239},{"class":487,"line":5238},30,[5240,5244,5249],{"type":394,"tag":485,"props":5241,"children":5242},{"style":492},[5243],{"type":400,"value":2725},{"type":394,"tag":485,"props":5245,"children":5246},{"style":745},[5247],{"type":400,"value":5248}," result",{"type":394,"tag":485,"props":5250,"children":5251},{"style":540},[5252],{"type":400,"value":574},{"type":394,"tag":485,"props":5254,"children":5256},{"class":487,"line":5255},31,[5257],{"type":394,"tag":485,"props":5258,"children":5259},{"style":540},[5260],{"type":400,"value":842},{"type":394,"tag":485,"props":5262,"children":5264},{"class":487,"line":5263},32,[5265],{"type":394,"tag":485,"props":5266,"children":5267},{"style":540},[5268],{"type":400,"value":1331},{"type":394,"tag":408,"props":5270,"children":5271},{},[5272],{"type":400,"value":5273},"KDB 内部代码出现异常时会使用日志将其记录下来。如果没有日志，那么在排查代码问题时简直就是噩梦。KDB 有两套日志的输出目标，分别是系统输出和标准输出设备。日志类记录输出目标、日志级别、线程锁等成员，并通过静态方法 Logv 实现记录日志。锁的最大用处是保证记录顺序。仅有当出现最高级别的日志（kLogLevelEMERG）时，才会跳过锁直接写入。出现 kLogLevelEMERG 时意味着程序遇到了紧急问题，通常会直接退出或是返回 Status 异常，所以这个时候需要及时记录。",{"type":394,"tag":408,"props":5275,"children":5276},{},[5277],{"type":400,"value":5278},"日志级别的划分参考了 Syslog：",{"type":394,"tag":435,"props":5280,"children":5281},{},[5282,5287,5292,5297,5302,5307,5312,5317,5322,5327],{"type":394,"tag":439,"props":5283,"children":5284},{},[5285],{"type":400,"value":5286},"silent: all logging is turned off",{"type":394,"tag":439,"props":5288,"children":5289},{},[5290],{"type":400,"value":5291},"emerg: system is unusable, imminent crash",{"type":394,"tag":439,"props":5293,"children":5294},{},[5295],{"type":400,"value":5296},"alert: error event, immediate action required",{"type":394,"tag":439,"props":5298,"children":5299},{},[5300],{"type":400,"value":5301},"crit: error event, immediate action required",{"type":394,"tag":439,"props":5303,"children":5304},{},[5305],{"type":400,"value":5306},"error: error event, action is required but is not urgent",{"type":394,"tag":439,"props":5308,"children":5309},{},[5310],{"type":400,"value":5311},"warn: events that can be harmful if no action is taken",{"type":394,"tag":439,"props":5313,"children":5314},{},[5315],{"type":400,"value":5316},"notice: unusual events, but no immediate action required",{"type":394,"tag":439,"props":5318,"children":5319},{},[5320],{"type":400,"value":5321},"info: normal operation events, no action required",{"type":394,"tag":439,"props":5323,"children":5324},{},[5325],{"type":400,"value":5326},"debug: events used for debugging, no action required",{"type":394,"tag":439,"props":5328,"children":5329},{},[5330],{"type":400,"value":5331},"trace: fine-grained events used for debugging, no action required",{"type":394,"tag":1361,"props":5333,"children":5335},{"id":5334},"日志调用用宏还是函数",[5336],{"type":400,"value":5334},{"type":394,"tag":408,"props":5338,"children":5339},{},[5340,5342,5348,5350,5354],{"type":400,"value":5341},"原先的提交中，日志调用被定义在了宏里，直接调用 Logger::Logv 去记录。日志宏中使用子宏 ",{"type":394,"tag":5343,"props":5344,"children":5345},"strong",{},[5346],{"type":400,"value":5347},"VA_ARGS",{"type":400,"value":5349}," 来记录可变参数。",{"type":394,"tag":5343,"props":5351,"children":5352},{},[5353],{"type":400,"value":5347},{"type":400,"value":5355}," 前面有标记黏贴运算符的原因是当日志宏的可变参数为空时，可以把末尾的逗号去掉。",{"type":394,"tag":474,"props":5357,"children":5359},{"code":5358,"language":477,"meta":388,"className":478,"style":388},"class log {\n  static void emerg(const char* logname, const char* format, ...) {\n    va_list args;\n    va_start(args, format);\n    Logger::Logv(false, Logger::kLogLevelEMERG, LOG_EMERG, logname, format, args);\n    va_end(args);\n  }\n}\n// ...\n#define LOG_EMERG(logname, fmt, ...) \\\n        Logger::Logv(false, Logger::kLogLevelEMERG, logname, fmt, ##__VA_ARGS__)\n",[5360],{"type":394,"tag":481,"props":5361,"children":5362},{"__ignoreMap":388},[5363,5379,5454,5466,5495,5577,5597,5604,5611,5618,5660],{"type":394,"tag":485,"props":5364,"children":5365},{"class":487,"line":488},[5366,5370,5375],{"type":394,"tag":485,"props":5367,"children":5368},{"style":528},[5369],{"type":400,"value":1905},{"type":394,"tag":485,"props":5371,"children":5372},{"style":555},[5373],{"type":400,"value":5374}," log",{"type":394,"tag":485,"props":5376,"children":5377},{"style":540},[5378],{"type":400,"value":548},{"type":394,"tag":485,"props":5380,"children":5381},{"class":487,"line":515},[5382,5386,5390,5395,5399,5403,5407,5411,5416,5420,5424,5428,5432,5437,5441,5446,5450],{"type":394,"tag":485,"props":5383,"children":5384},{"style":1992},[5385],{"type":400,"value":1995},{"type":394,"tag":485,"props":5387,"children":5388},{"style":528},[5389],{"type":400,"value":2000},{"type":394,"tag":485,"props":5391,"children":5392},{"style":534},[5393],{"type":400,"value":5394}," emerg",{"type":394,"tag":485,"props":5396,"children":5397},{"style":540},[5398],{"type":400,"value":622},{"type":394,"tag":485,"props":5400,"children":5401},{"style":1992},[5402],{"type":400,"value":2504},{"type":394,"tag":485,"props":5404,"children":5405},{"style":528},[5406],{"type":400,"value":5117},{"type":394,"tag":485,"props":5408,"children":5409},{"style":1992},[5410],{"type":400,"value":5122},{"type":394,"tag":485,"props":5412,"children":5413},{"style":1401},[5414],{"type":400,"value":5415}," logname",{"type":394,"tag":485,"props":5417,"children":5418},{"style":540},[5419],{"type":400,"value":632},{"type":394,"tag":485,"props":5421,"children":5422},{"style":1992},[5423],{"type":400,"value":2526},{"type":394,"tag":485,"props":5425,"children":5426},{"style":528},[5427],{"type":400,"value":5117},{"type":394,"tag":485,"props":5429,"children":5430},{"style":1992},[5431],{"type":400,"value":5122},{"type":394,"tag":485,"props":5433,"children":5434},{"style":1401},[5435],{"type":400,"value":5436}," format",{"type":394,"tag":485,"props":5438,"children":5439},{"style":540},[5440],{"type":400,"value":632},{"type":394,"tag":485,"props":5442,"children":5443},{"style":745},[5444],{"type":400,"value":5445}," ...",{"type":394,"tag":485,"props":5447,"children":5448},{"style":540},[5449],{"type":400,"value":1189},{"type":394,"tag":485,"props":5451,"children":5452},{"style":540},[5453],{"type":400,"value":548},{"type":394,"tag":485,"props":5455,"children":5456},{"class":487,"line":524},[5457,5462],{"type":394,"tag":485,"props":5458,"children":5459},{"style":745},[5460],{"type":400,"value":5461},"    va_list args",{"type":394,"tag":485,"props":5463,"children":5464},{"style":540},[5465],{"type":400,"value":574},{"type":394,"tag":485,"props":5467,"children":5468},{"class":487,"line":551},[5469,5474,5478,5483,5487,5491],{"type":394,"tag":485,"props":5470,"children":5471},{"style":534},[5472],{"type":400,"value":5473},"    va_start",{"type":394,"tag":485,"props":5475,"children":5476},{"style":540},[5477],{"type":400,"value":622},{"type":394,"tag":485,"props":5479,"children":5480},{"style":745},[5481],{"type":400,"value":5482},"args",{"type":394,"tag":485,"props":5484,"children":5485},{"style":540},[5486],{"type":400,"value":632},{"type":394,"tag":485,"props":5488,"children":5489},{"style":745},[5490],{"type":400,"value":5436},{"type":394,"tag":485,"props":5492,"children":5493},{"style":540},[5494],{"type":400,"value":652},{"type":394,"tag":485,"props":5496,"children":5497},{"class":487,"line":577},[5498,5503,5507,5512,5516,5521,5525,5530,5534,5539,5543,5548,5552,5556,5560,5564,5568,5573],{"type":394,"tag":485,"props":5499,"children":5500},{"style":555},[5501],{"type":400,"value":5502},"    Logger",{"type":394,"tag":485,"props":5504,"children":5505},{"style":540},[5506],{"type":400,"value":563},{"type":394,"tag":485,"props":5508,"children":5509},{"style":534},[5510],{"type":400,"value":5511},"Logv",{"type":394,"tag":485,"props":5513,"children":5514},{"style":540},[5515],{"type":400,"value":622},{"type":394,"tag":485,"props":5517,"children":5518},{"style":2692},[5519],{"type":400,"value":5520},"false",{"type":394,"tag":485,"props":5522,"children":5523},{"style":540},[5524],{"type":400,"value":632},{"type":394,"tag":485,"props":5526,"children":5527},{"style":555},[5528],{"type":400,"value":5529}," Logger",{"type":394,"tag":485,"props":5531,"children":5532},{"style":540},[5533],{"type":400,"value":563},{"type":394,"tag":485,"props":5535,"children":5536},{"style":745},[5537],{"type":400,"value":5538},"kLogLevelEMERG",{"type":394,"tag":485,"props":5540,"children":5541},{"style":540},[5542],{"type":400,"value":632},{"type":394,"tag":485,"props":5544,"children":5545},{"style":745},[5546],{"type":400,"value":5547}," LOG_EMERG",{"type":394,"tag":485,"props":5549,"children":5550},{"style":540},[5551],{"type":400,"value":632},{"type":394,"tag":485,"props":5553,"children":5554},{"style":745},[5555],{"type":400,"value":5415},{"type":394,"tag":485,"props":5557,"children":5558},{"style":540},[5559],{"type":400,"value":632},{"type":394,"tag":485,"props":5561,"children":5562},{"style":745},[5563],{"type":400,"value":5436},{"type":394,"tag":485,"props":5565,"children":5566},{"style":540},[5567],{"type":400,"value":632},{"type":394,"tag":485,"props":5569,"children":5570},{"style":745},[5571],{"type":400,"value":5572}," args",{"type":394,"tag":485,"props":5574,"children":5575},{"style":540},[5576],{"type":400,"value":652},{"type":394,"tag":485,"props":5578,"children":5579},{"class":487,"line":598},[5580,5585,5589,5593],{"type":394,"tag":485,"props":5581,"children":5582},{"style":534},[5583],{"type":400,"value":5584},"    va_end",{"type":394,"tag":485,"props":5586,"children":5587},{"style":540},[5588],{"type":400,"value":622},{"type":394,"tag":485,"props":5590,"children":5591},{"style":745},[5592],{"type":400,"value":5482},{"type":394,"tag":485,"props":5594,"children":5595},{"style":540},[5596],{"type":400,"value":652},{"type":394,"tag":485,"props":5598,"children":5599},{"class":487,"line":655},[5600],{"type":394,"tag":485,"props":5601,"children":5602},{"style":540},[5603],{"type":400,"value":842},{"type":394,"tag":485,"props":5605,"children":5606},{"class":487,"line":690},[5607],{"type":394,"tag":485,"props":5608,"children":5609},{"style":540},[5610],{"type":400,"value":1331},{"type":394,"tag":485,"props":5612,"children":5613},{"class":487,"line":732},[5614],{"type":394,"tag":485,"props":5615,"children":5616},{"style":1494},[5617],{"type":400,"value":3306},{"type":394,"tag":485,"props":5619,"children":5620},{"class":487,"line":813},[5621,5625,5629,5633,5638,5642,5647,5651,5656],{"type":394,"tag":485,"props":5622,"children":5623},{"style":492},[5624],{"type":400,"value":1865},{"type":394,"tag":485,"props":5626,"children":5627},{"style":534},[5628],{"type":400,"value":5547},{"type":394,"tag":485,"props":5630,"children":5631},{"style":540},[5632],{"type":400,"value":622},{"type":394,"tag":485,"props":5634,"children":5635},{"style":1401},[5636],{"type":400,"value":5637},"logname",{"type":394,"tag":485,"props":5639,"children":5640},{"style":540},[5641],{"type":400,"value":632},{"type":394,"tag":485,"props":5643,"children":5644},{"style":1401},[5645],{"type":400,"value":5646}," fmt",{"type":394,"tag":485,"props":5648,"children":5649},{"style":540},[5650],{"type":400,"value":632},{"type":394,"tag":485,"props":5652,"children":5653},{"style":540},[5654],{"type":400,"value":5655}," ...)",{"type":394,"tag":485,"props":5657,"children":5658},{"style":770},[5659],{"type":400,"value":2251},{"type":394,"tag":485,"props":5661,"children":5662},{"class":487,"line":836},[5663,5668,5672,5676,5680,5684,5688,5692,5696,5700,5704,5708,5712,5716,5720,5725],{"type":394,"tag":485,"props":5664,"children":5665},{"style":555},[5666],{"type":400,"value":5667},"        Logger",{"type":394,"tag":485,"props":5669,"children":5670},{"style":540},[5671],{"type":400,"value":563},{"type":394,"tag":485,"props":5673,"children":5674},{"style":534},[5675],{"type":400,"value":5511},{"type":394,"tag":485,"props":5677,"children":5678},{"style":540},[5679],{"type":400,"value":622},{"type":394,"tag":485,"props":5681,"children":5682},{"style":2692},[5683],{"type":400,"value":5520},{"type":394,"tag":485,"props":5685,"children":5686},{"style":540},[5687],{"type":400,"value":632},{"type":394,"tag":485,"props":5689,"children":5690},{"style":555},[5691],{"type":400,"value":5529},{"type":394,"tag":485,"props":5693,"children":5694},{"style":540},[5695],{"type":400,"value":563},{"type":394,"tag":485,"props":5697,"children":5698},{"style":745},[5699],{"type":400,"value":5538},{"type":394,"tag":485,"props":5701,"children":5702},{"style":540},[5703],{"type":400,"value":632},{"type":394,"tag":485,"props":5705,"children":5706},{"style":745},[5707],{"type":400,"value":5415},{"type":394,"tag":485,"props":5709,"children":5710},{"style":540},[5711],{"type":400,"value":632},{"type":394,"tag":485,"props":5713,"children":5714},{"style":745},[5715],{"type":400,"value":5646},{"type":394,"tag":485,"props":5717,"children":5718},{"style":540},[5719],{"type":400,"value":632},{"type":394,"tag":485,"props":5721,"children":5722},{"style":566},[5723],{"type":400,"value":5724}," ##__VA_ARGS__",{"type":394,"tag":485,"props":5726,"children":5727},{"style":540},[5728],{"type":400,"value":2321},{"type":394,"tag":408,"props":5730,"children":5731},{},[5732],{"type":400,"value":5733},"尚不清楚为什么不用宏，而是使用运行时的方法调用（即 log 的 public 方法）。猜测可能是因为宏不能跨行？因为我看到了这种很长的调用。",{"type":394,"tag":474,"props":5735,"children":5737},{"code":5736,"language":477,"meta":388,"className":478,"style":388},"log::trace(\n  \"Database::PutPartValidSize()\",\n  \"[%s] size_chunk:%\" PRIu64 \" offset_chunk:%\" PRIu64,\n  key.ToString().c_str(),\n  chunk.size(),\n  offset_chunk\n);\n",[5738],{"type":394,"tag":481,"props":5739,"children":5740},{"__ignoreMap":388},[5741,5763,5784,5835,5864,5884,5892],{"type":394,"tag":485,"props":5742,"children":5743},{"class":487,"line":488},[5744,5749,5753,5758],{"type":394,"tag":485,"props":5745,"children":5746},{"style":555},[5747],{"type":400,"value":5748},"log",{"type":394,"tag":485,"props":5750,"children":5751},{"style":540},[5752],{"type":400,"value":563},{"type":394,"tag":485,"props":5754,"children":5755},{"style":534},[5756],{"type":400,"value":5757},"trace",{"type":394,"tag":485,"props":5759,"children":5760},{"style":540},[5761],{"type":400,"value":5762},"(\n",{"type":394,"tag":485,"props":5764,"children":5765},{"class":487,"line":515},[5766,5771,5776,5780],{"type":394,"tag":485,"props":5767,"children":5768},{"style":498},[5769],{"type":400,"value":5770},"  \"",{"type":394,"tag":485,"props":5772,"children":5773},{"style":504},[5774],{"type":400,"value":5775},"Database::PutPartValidSize()",{"type":394,"tag":485,"props":5777,"children":5778},{"style":498},[5779],{"type":400,"value":647},{"type":394,"tag":485,"props":5781,"children":5782},{"style":540},[5783],{"type":400,"value":4845},{"type":394,"tag":485,"props":5785,"children":5786},{"class":487,"line":524},[5787,5791,5795,5799,5804,5808,5813,5817,5822,5826,5831],{"type":394,"tag":485,"props":5788,"children":5789},{"style":498},[5790],{"type":400,"value":5770},{"type":394,"tag":485,"props":5792,"children":5793},{"style":504},[5794],{"type":400,"value":1461},{"type":394,"tag":485,"props":5796,"children":5797},{"style":764},[5798],{"type":400,"value":767},{"type":394,"tag":485,"props":5800,"children":5801},{"style":504},[5802],{"type":400,"value":5803},"] size_chunk:%",{"type":394,"tag":485,"props":5805,"children":5806},{"style":498},[5807],{"type":400,"value":647},{"type":394,"tag":485,"props":5809,"children":5810},{"style":566},[5811],{"type":400,"value":5812}," PRIu64 ",{"type":394,"tag":485,"props":5814,"children":5815},{"style":498},[5816],{"type":400,"value":647},{"type":394,"tag":485,"props":5818,"children":5819},{"style":504},[5820],{"type":400,"value":5821}," offset_chunk:%",{"type":394,"tag":485,"props":5823,"children":5824},{"style":498},[5825],{"type":400,"value":647},{"type":394,"tag":485,"props":5827,"children":5828},{"style":566},[5829],{"type":400,"value":5830}," PRIu64",{"type":394,"tag":485,"props":5832,"children":5833},{"style":540},[5834],{"type":400,"value":4845},{"type":394,"tag":485,"props":5836,"children":5837},{"class":487,"line":551},[5838,5843,5847,5851,5855,5859],{"type":394,"tag":485,"props":5839,"children":5840},{"style":566},[5841],{"type":400,"value":5842},"  key",{"type":394,"tag":485,"props":5844,"children":5845},{"style":540},[5846],{"type":400,"value":677},{"type":394,"tag":485,"props":5848,"children":5849},{"style":534},[5850],{"type":400,"value":795},{"type":394,"tag":485,"props":5852,"children":5853},{"style":540},[5854],{"type":400,"value":800},{"type":394,"tag":485,"props":5856,"children":5857},{"style":534},[5858],{"type":400,"value":805},{"type":394,"tag":485,"props":5860,"children":5861},{"style":540},[5862],{"type":400,"value":5863},"(),\n",{"type":394,"tag":485,"props":5865,"children":5866},{"class":487,"line":577},[5867,5872,5876,5880],{"type":394,"tag":485,"props":5868,"children":5869},{"style":566},[5870],{"type":400,"value":5871},"  chunk",{"type":394,"tag":485,"props":5873,"children":5874},{"style":540},[5875],{"type":400,"value":677},{"type":394,"tag":485,"props":5877,"children":5878},{"style":534},[5879],{"type":400,"value":3629},{"type":394,"tag":485,"props":5881,"children":5882},{"style":540},[5883],{"type":400,"value":5863},{"type":394,"tag":485,"props":5885,"children":5886},{"class":487,"line":598},[5887],{"type":394,"tag":485,"props":5888,"children":5889},{"style":566},[5890],{"type":400,"value":5891},"  offset_chunk\n",{"type":394,"tag":485,"props":5893,"children":5894},{"class":487,"line":655},[5895],{"type":394,"tag":485,"props":5896,"children":5897},{"style":540},[5898],{"type":400,"value":652},{"type":394,"tag":1361,"props":5900,"children":5902},{"id":5901},"日志时间",[5903],{"type":400,"value":5901},{"type":394,"tag":408,"props":5905,"children":5906},{},[5907],{"type":400,"value":5908},"使用系统输出（syslog）时不需要手动记录时间，但是把日志打印出来时却是要的。尤其是在调试时，精确时间非常有用。KDB 使用 Linux 的 timeval、tm 两个结构体，分别拿到精确时间及可读时间，再格式化输出。",{"type":394,"tag":474,"props":5910,"children":5912},{"code":5911,"language":477,"meta":388,"className":478,"style":388},"struct timeval now_tv;\ngettimeofday(&now_tv, NULL);\nconst time_t seconds = now_tv.tv_sec;\nstruct tm t;\n// 初始化 tm 时需要用到当前秒数，\n// 所以需要提前初始化 now_tv\nlocaltime_r(&seconds, &t);\np += snprintf(p, limit - p,\n              \"%04d/%02d/%02d-%02d:%02d:%02d.%06d %s %s \",\n              t.tm_year + 1900,\n              t.tm_mon + 1,\n              t.tm_mday,\n              t.tm_hour,\n              t.tm_min,\n              t.tm_sec,\n              static_cast\u003Cint>(now_tv.tv_usec), // 毫秒\n              ss.str().c_str(),\n              logname);\n",[5913],{"type":394,"tag":481,"props":5914,"children":5915},{"__ignoreMap":388},[5916,5938,5972,6010,6030,6038,6046,6084,6133,6214,6245,6273,6293,6313,6333,6353,6396,6424],{"type":394,"tag":485,"props":5917,"children":5918},{"class":487,"line":488},[5919,5924,5929,5934],{"type":394,"tag":485,"props":5920,"children":5921},{"style":528},[5922],{"type":400,"value":5923},"struct",{"type":394,"tag":485,"props":5925,"children":5926},{"style":555},[5927],{"type":400,"value":5928}," timeval",{"type":394,"tag":485,"props":5930,"children":5931},{"style":566},[5932],{"type":400,"value":5933}," now_tv",{"type":394,"tag":485,"props":5935,"children":5936},{"style":540},[5937],{"type":400,"value":574},{"type":394,"tag":485,"props":5939,"children":5940},{"class":487,"line":515},[5941,5946,5950,5954,5959,5963,5968],{"type":394,"tag":485,"props":5942,"children":5943},{"style":534},[5944],{"type":400,"value":5945},"gettimeofday",{"type":394,"tag":485,"props":5947,"children":5948},{"style":540},[5949],{"type":400,"value":622},{"type":394,"tag":485,"props":5951,"children":5952},{"style":664},[5953],{"type":400,"value":2490},{"type":394,"tag":485,"props":5955,"children":5956},{"style":566},[5957],{"type":400,"value":5958},"now_tv",{"type":394,"tag":485,"props":5960,"children":5961},{"style":540},[5962],{"type":400,"value":632},{"type":394,"tag":485,"props":5964,"children":5965},{"style":2692},[5966],{"type":400,"value":5967}," NULL",{"type":394,"tag":485,"props":5969,"children":5970},{"style":540},[5971],{"type":400,"value":652},{"type":394,"tag":485,"props":5973,"children":5974},{"class":487,"line":524},[5975,5979,5984,5989,5993,5997,6001,6006],{"type":394,"tag":485,"props":5976,"children":5977},{"style":1992},[5978],{"type":400,"value":2504},{"type":394,"tag":485,"props":5980,"children":5981},{"style":528},[5982],{"type":400,"value":5983}," time_t",{"type":394,"tag":485,"props":5985,"children":5986},{"style":566},[5987],{"type":400,"value":5988}," seconds ",{"type":394,"tag":485,"props":5990,"children":5991},{"style":664},[5992],{"type":400,"value":667},{"type":394,"tag":485,"props":5994,"children":5995},{"style":566},[5996],{"type":400,"value":5933},{"type":394,"tag":485,"props":5998,"children":5999},{"style":540},[6000],{"type":400,"value":677},{"type":394,"tag":485,"props":6002,"children":6003},{"style":566},[6004],{"type":400,"value":6005},"tv_sec",{"type":394,"tag":485,"props":6007,"children":6008},{"style":540},[6009],{"type":400,"value":574},{"type":394,"tag":485,"props":6011,"children":6012},{"class":487,"line":551},[6013,6017,6022,6026],{"type":394,"tag":485,"props":6014,"children":6015},{"style":528},[6016],{"type":400,"value":5923},{"type":394,"tag":485,"props":6018,"children":6019},{"style":555},[6020],{"type":400,"value":6021}," tm",{"type":394,"tag":485,"props":6023,"children":6024},{"style":566},[6025],{"type":400,"value":2052},{"type":394,"tag":485,"props":6027,"children":6028},{"style":540},[6029],{"type":400,"value":574},{"type":394,"tag":485,"props":6031,"children":6032},{"class":487,"line":577},[6033],{"type":394,"tag":485,"props":6034,"children":6035},{"style":1494},[6036],{"type":400,"value":6037},"// 初始化 tm 时需要用到当前秒数，\n",{"type":394,"tag":485,"props":6039,"children":6040},{"class":487,"line":598},[6041],{"type":394,"tag":485,"props":6042,"children":6043},{"style":1494},[6044],{"type":400,"value":6045},"// 所以需要提前初始化 now_tv\n",{"type":394,"tag":485,"props":6047,"children":6048},{"class":487,"line":655},[6049,6054,6058,6062,6067,6071,6075,6080],{"type":394,"tag":485,"props":6050,"children":6051},{"style":534},[6052],{"type":400,"value":6053},"localtime_r",{"type":394,"tag":485,"props":6055,"children":6056},{"style":540},[6057],{"type":400,"value":622},{"type":394,"tag":485,"props":6059,"children":6060},{"style":664},[6061],{"type":400,"value":2490},{"type":394,"tag":485,"props":6063,"children":6064},{"style":566},[6065],{"type":400,"value":6066},"seconds",{"type":394,"tag":485,"props":6068,"children":6069},{"style":540},[6070],{"type":400,"value":632},{"type":394,"tag":485,"props":6072,"children":6073},{"style":664},[6074],{"type":400,"value":1120},{"type":394,"tag":485,"props":6076,"children":6077},{"style":566},[6078],{"type":400,"value":6079},"t",{"type":394,"tag":485,"props":6081,"children":6082},{"style":540},[6083],{"type":400,"value":652},{"type":394,"tag":485,"props":6085,"children":6086},{"class":487,"line":690},[6087,6092,6097,6102,6106,6110,6114,6119,6124,6129],{"type":394,"tag":485,"props":6088,"children":6089},{"style":566},[6090],{"type":400,"value":6091},"p ",{"type":394,"tag":485,"props":6093,"children":6094},{"style":664},[6095],{"type":400,"value":6096},"+=",{"type":394,"tag":485,"props":6098,"children":6099},{"style":534},[6100],{"type":400,"value":6101}," snprintf",{"type":394,"tag":485,"props":6103,"children":6104},{"style":540},[6105],{"type":400,"value":622},{"type":394,"tag":485,"props":6107,"children":6108},{"style":566},[6109],{"type":400,"value":408},{"type":394,"tag":485,"props":6111,"children":6112},{"style":540},[6113],{"type":400,"value":632},{"type":394,"tag":485,"props":6115,"children":6116},{"style":566},[6117],{"type":400,"value":6118}," limit ",{"type":394,"tag":485,"props":6120,"children":6121},{"style":664},[6122],{"type":400,"value":6123},"-",{"type":394,"tag":485,"props":6125,"children":6126},{"style":566},[6127],{"type":400,"value":6128}," p",{"type":394,"tag":485,"props":6130,"children":6131},{"style":540},[6132],{"type":400,"value":4845},{"type":394,"tag":485,"props":6134,"children":6135},{"class":487,"line":732},[6136,6141,6146,6151,6156,6160,6164,6168,6172,6176,6180,6184,6188,6192,6197,6202,6206,6210],{"type":394,"tag":485,"props":6137,"children":6138},{"style":498},[6139],{"type":400,"value":6140},"              \"",{"type":394,"tag":485,"props":6142,"children":6143},{"style":764},[6144],{"type":400,"value":6145},"%04d",{"type":394,"tag":485,"props":6147,"children":6148},{"style":504},[6149],{"type":400,"value":6150},"/",{"type":394,"tag":485,"props":6152,"children":6153},{"style":764},[6154],{"type":400,"value":6155},"%02d",{"type":394,"tag":485,"props":6157,"children":6158},{"style":504},[6159],{"type":400,"value":6150},{"type":394,"tag":485,"props":6161,"children":6162},{"style":764},[6163],{"type":400,"value":6155},{"type":394,"tag":485,"props":6165,"children":6166},{"style":504},[6167],{"type":400,"value":6123},{"type":394,"tag":485,"props":6169,"children":6170},{"style":764},[6171],{"type":400,"value":6155},{"type":394,"tag":485,"props":6173,"children":6174},{"style":504},[6175],{"type":400,"value":1590},{"type":394,"tag":485,"props":6177,"children":6178},{"style":764},[6179],{"type":400,"value":6155},{"type":394,"tag":485,"props":6181,"children":6182},{"style":504},[6183],{"type":400,"value":1590},{"type":394,"tag":485,"props":6185,"children":6186},{"style":764},[6187],{"type":400,"value":6155},{"type":394,"tag":485,"props":6189,"children":6190},{"style":504},[6191],{"type":400,"value":677},{"type":394,"tag":485,"props":6193,"children":6194},{"style":764},[6195],{"type":400,"value":6196},"%06d",{"type":394,"tag":485,"props":6198,"children":6199},{"style":764},[6200],{"type":400,"value":6201}," %s",{"type":394,"tag":485,"props":6203,"children":6204},{"style":764},[6205],{"type":400,"value":6201},{"type":394,"tag":485,"props":6207,"children":6208},{"style":498},[6209],{"type":400,"value":637},{"type":394,"tag":485,"props":6211,"children":6212},{"style":540},[6213],{"type":400,"value":4845},{"type":394,"tag":485,"props":6215,"children":6216},{"class":487,"line":813},[6217,6222,6226,6231,6236,6241],{"type":394,"tag":485,"props":6218,"children":6219},{"style":566},[6220],{"type":400,"value":6221},"              t",{"type":394,"tag":485,"props":6223,"children":6224},{"style":540},[6225],{"type":400,"value":677},{"type":394,"tag":485,"props":6227,"children":6228},{"style":566},[6229],{"type":400,"value":6230},"tm_year ",{"type":394,"tag":485,"props":6232,"children":6233},{"style":664},[6234],{"type":400,"value":6235},"+",{"type":394,"tag":485,"props":6237,"children":6238},{"style":826},[6239],{"type":400,"value":6240}," 1900",{"type":394,"tag":485,"props":6242,"children":6243},{"style":540},[6244],{"type":400,"value":4845},{"type":394,"tag":485,"props":6246,"children":6247},{"class":487,"line":836},[6248,6252,6256,6261,6265,6269],{"type":394,"tag":485,"props":6249,"children":6250},{"style":566},[6251],{"type":400,"value":6221},{"type":394,"tag":485,"props":6253,"children":6254},{"style":540},[6255],{"type":400,"value":677},{"type":394,"tag":485,"props":6257,"children":6258},{"style":566},[6259],{"type":400,"value":6260},"tm_mon ",{"type":394,"tag":485,"props":6262,"children":6263},{"style":664},[6264],{"type":400,"value":6235},{"type":394,"tag":485,"props":6266,"children":6267},{"style":826},[6268],{"type":400,"value":3043},{"type":394,"tag":485,"props":6270,"children":6271},{"style":540},[6272],{"type":400,"value":4845},{"type":394,"tag":485,"props":6274,"children":6275},{"class":487,"line":845},[6276,6280,6284,6289],{"type":394,"tag":485,"props":6277,"children":6278},{"style":566},[6279],{"type":400,"value":6221},{"type":394,"tag":485,"props":6281,"children":6282},{"style":540},[6283],{"type":400,"value":677},{"type":394,"tag":485,"props":6285,"children":6286},{"style":566},[6287],{"type":400,"value":6288},"tm_mday",{"type":394,"tag":485,"props":6290,"children":6291},{"style":540},[6292],{"type":400,"value":4845},{"type":394,"tag":485,"props":6294,"children":6295},{"class":487,"line":853},[6296,6300,6304,6309],{"type":394,"tag":485,"props":6297,"children":6298},{"style":566},[6299],{"type":400,"value":6221},{"type":394,"tag":485,"props":6301,"children":6302},{"style":540},[6303],{"type":400,"value":677},{"type":394,"tag":485,"props":6305,"children":6306},{"style":566},[6307],{"type":400,"value":6308},"tm_hour",{"type":394,"tag":485,"props":6310,"children":6311},{"style":540},[6312],{"type":400,"value":4845},{"type":394,"tag":485,"props":6314,"children":6315},{"class":487,"line":896},[6316,6320,6324,6329],{"type":394,"tag":485,"props":6317,"children":6318},{"style":566},[6319],{"type":400,"value":6221},{"type":394,"tag":485,"props":6321,"children":6322},{"style":540},[6323],{"type":400,"value":677},{"type":394,"tag":485,"props":6325,"children":6326},{"style":566},[6327],{"type":400,"value":6328},"tm_min",{"type":394,"tag":485,"props":6330,"children":6331},{"style":540},[6332],{"type":400,"value":4845},{"type":394,"tag":485,"props":6334,"children":6335},{"class":487,"line":937},[6336,6340,6344,6349],{"type":394,"tag":485,"props":6337,"children":6338},{"style":566},[6339],{"type":400,"value":6221},{"type":394,"tag":485,"props":6341,"children":6342},{"style":540},[6343],{"type":400,"value":677},{"type":394,"tag":485,"props":6345,"children":6346},{"style":566},[6347],{"type":400,"value":6348},"tm_sec",{"type":394,"tag":485,"props":6350,"children":6351},{"style":540},[6352],{"type":400,"value":4845},{"type":394,"tag":485,"props":6354,"children":6355},{"class":487,"line":945},[6356,6361,6365,6369,6373,6377,6381,6386,6391],{"type":394,"tag":485,"props":6357,"children":6358},{"style":664},[6359],{"type":400,"value":6360},"              static_cast\u003C",{"type":394,"tag":485,"props":6362,"children":6363},{"style":528},[6364],{"type":400,"value":531},{"type":394,"tag":485,"props":6366,"children":6367},{"style":664},[6368],{"type":400,"value":2472},{"type":394,"tag":485,"props":6370,"children":6371},{"style":540},[6372],{"type":400,"value":622},{"type":394,"tag":485,"props":6374,"children":6375},{"style":566},[6376],{"type":400,"value":5958},{"type":394,"tag":485,"props":6378,"children":6379},{"style":540},[6380],{"type":400,"value":677},{"type":394,"tag":485,"props":6382,"children":6383},{"style":566},[6384],{"type":400,"value":6385},"tv_usec",{"type":394,"tag":485,"props":6387,"children":6388},{"style":540},[6389],{"type":400,"value":6390},"),",{"type":394,"tag":485,"props":6392,"children":6393},{"style":1494},[6394],{"type":400,"value":6395}," // 毫秒\n",{"type":394,"tag":485,"props":6397,"children":6398},{"class":487,"line":966},[6399,6404,6408,6412,6416,6420],{"type":394,"tag":485,"props":6400,"children":6401},{"style":566},[6402],{"type":400,"value":6403},"              ss",{"type":394,"tag":485,"props":6405,"children":6406},{"style":540},[6407],{"type":400,"value":677},{"type":394,"tag":485,"props":6409,"children":6410},{"style":534},[6411],{"type":400,"value":3064},{"type":394,"tag":485,"props":6413,"children":6414},{"style":540},[6415],{"type":400,"value":800},{"type":394,"tag":485,"props":6417,"children":6418},{"style":534},[6419],{"type":400,"value":805},{"type":394,"tag":485,"props":6421,"children":6422},{"style":540},[6423],{"type":400,"value":5863},{"type":394,"tag":485,"props":6425,"children":6426},{"class":487,"line":1022},[6427,6432],{"type":394,"tag":485,"props":6428,"children":6429},{"style":566},[6430],{"type":400,"value":6431},"              logname",{"type":394,"tag":485,"props":6433,"children":6434},{"style":540},[6435],{"type":400,"value":652},{"type":394,"tag":6437,"props":6438,"children":6439},"style",{},[6440],{"type":400,"value":6441},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":388,"searchDepth":515,"depth":515,"links":6443},[6444,6445,6446,6447],{"id":404,"depth":515,"text":404},{"id":465,"depth":515,"text":465},{"id":3447,"depth":515,"text":3447},{"id":3460,"depth":515,"text":3460},"markdown","content:8.source-code:_cpp:kingdb.md","content","8.source-code/_cpp/kingdb.md","md",[6454,6455],{"_path":365,"title":364,"description":388},{"_path":6456,"title":6457,"description":388},"/source-code/_es/array-slice","Array.prototype.slice",1708107579223]