[{"data":1,"prerenderedAt":6240},["ShallowReactive",2],{"navigation":3,"/source-code/_cpp/kingdb":161,"/source-code/_cpp/kingdb-surround":6232},[4,35,92,98,125,131,155],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29,32],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🚝 四十二篇系列","/flows/fourty-two",{"title":15,"_path":16},"🌃 长夜梦","/flows/long-night-dream",{"title":18,"_path":19},"🌌 万物联结与幸福感","/flows/everything",{"title":21,"_path":22},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":24,"_path":25},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":27,"_path":28},"🌧️ 我的腼腆","/flows/shy",{"title":30,"_path":31},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":33,"_path":34},"📝 心流归档","/flows/archive",{"title":36,"_path":37,"children":38},"技术博客 / Coder","/articles",[39,41,44,47,50,53,56,59,62,65,68,71,74,77,80,83,86,89],{"title":40,"_path":37},"🦁 欢迎",{"title":42,"_path":43},"🖌️ Blockies Animation","/maps/_fe-framework/motion/blockies-animation",{"title":45,"_path":46},"🌪️ Tailwind v4 如何兼容预处理器","/articles/tailwind4-with-sass",{"title":48,"_path":49},"🥞 在 tailwind 中使用现代化 CSS Layers","/articles/tailwind-sass-and-css-layer",{"title":51,"_path":52},"💻 本地部署 Qwen 翻译网页","/articles/local-translator",{"title":54,"_path":55},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":57,"_path":58},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":60,"_path":61},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":63,"_path":64},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":66,"_path":67},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":69,"_path":70},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":72,"_path":73},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":75,"_path":76},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":78,"_path":79},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":81,"_path":82},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":84,"_path":85},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":87,"_path":88},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":90,"_path":91},"📝 技术博客归档","/articles/archive",{"title":93,"_path":94,"children":95},"读书笔记 / Notes","/books",[96],{"title":97,"_path":94},"📕 读书笔记",{"title":99,"_path":100,"children":101},"吉他剧场 / Music","/music",[102,104,107,110,113,116,119,122],{"title":103,"_path":100},"🎸 FingerStyle！",{"title":105,"_path":106},"🌬️ 等待的风","/music/wind",{"title":108,"_path":109},"💕 约定的海洋","/music/ocean",{"title":111,"_path":112},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":114,"_path":115},"🌏 残酷天使的行动纲领","/music/eva",{"title":117,"_path":118},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":120,"_path":121},"🍷 Wu Wei","/music/wu-wei",{"title":123,"_path":124},"🌅 无题","/music/untitled",{"title":126,"_path":127,"children":128},"知识地图 / Maps","/maps",[129],{"title":130,"_path":127},"🏁 知识地图",{"title":132,"_path":133,"children":134},"造物 / Make","/tools",[135,137,140,143,146,149,152],{"title":136,"_path":133},"🧰 工具收集",{"title":138,"_path":139},"📕 博客","/tools/blog",{"title":141,"_path":142},"🥥 Coconut","/tools/coconut",{"title":144,"_path":145},"🧶 网易云音乐歌单排序","/tools/netease-sorter",{"title":147,"_path":148},"🌐 AnySort","/tools/anysort",{"title":150,"_path":151},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":153,"_path":154},"👓 Crapto","/tools/crypto-inline",{"title":156,"_path":157,"children":158},"我 / About","/hire",[159],{"title":160,"_path":157},"📬 技术简历",{"_path":162,"_dir":163,"_draft":164,"_partial":165,"_locale":166,"title":167,"description":166,"body":168,"_type":6226,"_id":6227,"_source":6228,"_file":6229,"_stem":6230,"_extension":6231},"/source-code/_cpp/kingdb","_cpp",false,true,"","KingDB",{"type":169,"children":170,"toc":6220},"root",[171,179,185,191,207,212,236,241,246,251,1110,1115,1123,1128,1133,1138,1144,1149,1570,1575,1580,2030,2035,2136,2141,2146,2151,2689,2695,2700,2967,2973,2978,3223,3228,3241,3246,3513,3518,3523,4234,4239,4420,4424,4429,5047,5052,5057,5110,5115,5134,5507,5512,5677,5682,5687,6214],{"type":172,"tag":173,"props":174,"children":176},"element","h1",{"id":175},"kingdb",[177],{"type":178,"value":167},"text",{"type":172,"tag":180,"props":181,"children":183},"h2",{"id":182},"概述",[184],{"type":178,"value":182},{"type":172,"tag":186,"props":187,"children":188},"p",{},[189],{"type":178,"value":190},"源码分两部分，从相关的测试文件，到核心源码。参考 IKVS 系列文章给的架构图，核心源码的阅读顺序沿着 Put、Delete、Get 三个接口，由 Database 一路向 Buffer、Event Manager、Storage Engine、HSTable Manager、File System 相关、Index 前进。最好再看相关快照、迭代器、Multipart 等部分。期间如果遇到简单的帮助函数会先讲帮助函数。",{"type":172,"tag":186,"props":192,"children":193},{},[194,196,205],{"type":178,"value":195},"本来想从第一个 Git Commit 开始看起的。但我 checkout 过去之后，碰到了一堆编译问题，根本跑不通，索性就直接回到 master 来看最新代码了。本文章的源码快照见 ",{"type":172,"tag":197,"props":198,"children":202},"a",{"href":199,"rel":200},"https://github.com/goossaert/kingdb/tree/58994280e789fc7248d61371f03a6c04c844c197",[201],"nofollow",[203],{"type":178,"value":204},"KingDB@58994",{"type":178,"value":206},"。阅读源码前可以先看一下 KingDB 的 Readme：doc/kingdb.md 以及 doc/kingserver.md。",{"type":172,"tag":186,"props":208,"children":209},{},[210],{"type":178,"value":211},"下文可能出现的缩写：",{"type":172,"tag":213,"props":214,"children":215},"ul",{},[216,222],{"type":172,"tag":217,"props":218,"children":219},"li",{},[220],{"type":178,"value":221},"KDB：KingDB，泛指，有时指 KingDB 程序，有时指 KingDB 源码。",{"type":172,"tag":217,"props":223,"children":224},{},[225,227,234],{"type":178,"value":226},"IKVS：作者相关 KingDB 做的一些调研及笔记的博客系列。这个系列从 13 年开始写，现在还没写完... 见 ",{"type":172,"tag":197,"props":228,"children":231},{"href":229,"rel":230},"https://codecapsule.com/2012/11/07/ikvs-implementing-a-key-value-store-table-of-contents/",[201],[232],{"type":178,"value":233},"IKVS",{"type":178,"value":235},"。",{"type":172,"tag":186,"props":237,"children":238},{},[239],{"type":178,"value":240},"另，为了简便起见，下文给出的代码很可能并非原本的代码，而是截取或经过剔除后的部分代码。比如说，去除了某函数中的错误处理，使之代码更短，更容易展示。",{"type":172,"tag":180,"props":242,"children":244},{"id":243},"从测试开始",[245],{"type":178,"value":243},{"type":172,"tag":186,"props":247,"children":248},{},[249],{"type":178,"value":250},"Emmanuel 给了一个典型的 KDB 用户使用示例，见 unit-tests/kingdb_user.cc。通过此示例，能大概了解 KDB 的接口及如何使用该接口。创建数据库、存入、读取前都需要创建对应的参数配置 Options；这些动作通过 Status 对象来回传操作成功与否。",{"type":172,"tag":252,"props":253,"children":257},"pre",{"code":254,"language":255,"meta":166,"className":256,"style":166},"#include \u003Ckingdb/kdb.h>\n\nint main() {\n  kdb::Status s;\n  kdb::DatabaseOptions db_options;\n  kdb::Database db(db_options, \"mylocaldb\");\n  s = db.Open();\n  if (!s.IsOK()) {\n    fprintf(stderr, \"Could not open the database: %s\\n\", s.ToString().c_str());\n    exit(1);\n  }\n\n  std::string key1(\"key1\");\n  std::string value1(\"value1\");\n\n  kdb::WriteOptions write_options;\n  s = db.Put(write_options, key1, value1);\n\n  kdb::ReadOptions read_options;\n  std::string out_str;\n  s = db.Get(read_options, key1, &out_str);\n  if (s.IsOK() && out_str == \"value1\") {\n    printf(\"Data successfully stored and retrieved\\n\"); \n  } else {\n    printf(\"An error occurred\\n\"); \n  }\n\n  return 0;\n}\n","cpp","language-cpp shiki shiki-themes material-theme-lighter github-light github-dark monokai",[258],{"type":172,"tag":259,"props":260,"children":261},"code",{"__ignoreMap":166},[262,291,300,327,353,374,431,466,508,589,612,621,629,672,713,721,742,798,806,827,848,908,972,1012,1030,1067,1075,1083,1101],{"type":172,"tag":263,"props":264,"children":267},"span",{"class":265,"line":266},"line",1,[268,274,280,286],{"type":172,"tag":263,"props":269,"children":271},{"style":270},"--shiki-light:#39ADB5;--shiki-light-font-style:italic;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#F92672;--shiki-sepia-font-style:inherit",[272],{"type":178,"value":273},"#include",{"type":172,"tag":263,"props":275,"children":277},{"style":276},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[278],{"type":178,"value":279}," \u003C",{"type":172,"tag":263,"props":281,"children":283},{"style":282},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[284],{"type":178,"value":285},"kingdb/kdb.h",{"type":172,"tag":263,"props":287,"children":288},{"style":276},[289],{"type":178,"value":290},">\n",{"type":172,"tag":263,"props":292,"children":294},{"class":265,"line":293},2,[295],{"type":172,"tag":263,"props":296,"children":297},{"emptyLinePlaceholder":165},[298],{"type":178,"value":299},"\n",{"type":172,"tag":263,"props":301,"children":303},{"class":265,"line":302},3,[304,310,316,322],{"type":172,"tag":263,"props":305,"children":307},{"style":306},"--shiki-light:#9C3EDA;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic",[308],{"type":178,"value":309},"int",{"type":172,"tag":263,"props":311,"children":313},{"style":312},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[314],{"type":178,"value":315}," main",{"type":172,"tag":263,"props":317,"children":319},{"style":318},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[320],{"type":178,"value":321},"()",{"type":172,"tag":263,"props":323,"children":324},{"style":318},[325],{"type":178,"value":326}," {\n",{"type":172,"tag":263,"props":328,"children":330},{"class":265,"line":329},4,[331,337,342,348],{"type":172,"tag":263,"props":332,"children":334},{"style":333},"--shiki-light:#E2931D;--shiki-light-text-decoration:inherit;--shiki-default:#6F42C1;--shiki-default-text-decoration:inherit;--shiki-dark:#B392F0;--shiki-dark-text-decoration:inherit;--shiki-sepia:#A6E22E;--shiki-sepia-text-decoration:underline",[335],{"type":178,"value":336},"  kdb",{"type":172,"tag":263,"props":338,"children":339},{"style":318},[340],{"type":178,"value":341},"::",{"type":172,"tag":263,"props":343,"children":345},{"style":344},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[346],{"type":178,"value":347},"Status s",{"type":172,"tag":263,"props":349,"children":350},{"style":318},[351],{"type":178,"value":352},";\n",{"type":172,"tag":263,"props":354,"children":356},{"class":265,"line":355},5,[357,361,365,370],{"type":172,"tag":263,"props":358,"children":359},{"style":333},[360],{"type":178,"value":336},{"type":172,"tag":263,"props":362,"children":363},{"style":318},[364],{"type":178,"value":341},{"type":172,"tag":263,"props":366,"children":367},{"style":344},[368],{"type":178,"value":369},"DatabaseOptions db_options",{"type":172,"tag":263,"props":371,"children":372},{"style":318},[373],{"type":178,"value":352},{"type":172,"tag":263,"props":375,"children":377},{"class":265,"line":376},6,[378,382,386,391,396,401,406,411,416,421,426],{"type":172,"tag":263,"props":379,"children":380},{"style":333},[381],{"type":178,"value":336},{"type":172,"tag":263,"props":383,"children":384},{"style":318},[385],{"type":178,"value":341},{"type":172,"tag":263,"props":387,"children":388},{"style":344},[389],{"type":178,"value":390},"Database ",{"type":172,"tag":263,"props":392,"children":393},{"style":312},[394],{"type":178,"value":395},"db",{"type":172,"tag":263,"props":397,"children":398},{"style":318},[399],{"type":178,"value":400},"(",{"type":172,"tag":263,"props":402,"children":403},{"style":344},[404],{"type":178,"value":405},"db_options",{"type":172,"tag":263,"props":407,"children":408},{"style":318},[409],{"type":178,"value":410},",",{"type":172,"tag":263,"props":412,"children":413},{"style":276},[414],{"type":178,"value":415}," \"",{"type":172,"tag":263,"props":417,"children":418},{"style":282},[419],{"type":178,"value":420},"mylocaldb",{"type":172,"tag":263,"props":422,"children":423},{"style":276},[424],{"type":178,"value":425},"\"",{"type":172,"tag":263,"props":427,"children":428},{"style":318},[429],{"type":178,"value":430},");\n",{"type":172,"tag":263,"props":432,"children":434},{"class":265,"line":433},7,[435,440,446,451,456,461],{"type":172,"tag":263,"props":436,"children":437},{"style":344},[438],{"type":178,"value":439},"  s ",{"type":172,"tag":263,"props":441,"children":443},{"style":442},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[444],{"type":178,"value":445},"=",{"type":172,"tag":263,"props":447,"children":448},{"style":344},[449],{"type":178,"value":450}," db",{"type":172,"tag":263,"props":452,"children":453},{"style":318},[454],{"type":178,"value":455},".",{"type":172,"tag":263,"props":457,"children":458},{"style":312},[459],{"type":178,"value":460},"Open",{"type":172,"tag":263,"props":462,"children":463},{"style":318},[464],{"type":178,"value":465},"();\n",{"type":172,"tag":263,"props":467,"children":469},{"class":265,"line":468},8,[470,475,480,485,490,494,499,504],{"type":172,"tag":263,"props":471,"children":472},{"style":270},[473],{"type":178,"value":474},"  if",{"type":172,"tag":263,"props":476,"children":477},{"style":318},[478],{"type":178,"value":479}," (",{"type":172,"tag":263,"props":481,"children":482},{"style":442},[483],{"type":178,"value":484},"!",{"type":172,"tag":263,"props":486,"children":487},{"style":344},[488],{"type":178,"value":489},"s",{"type":172,"tag":263,"props":491,"children":492},{"style":318},[493],{"type":178,"value":455},{"type":172,"tag":263,"props":495,"children":496},{"style":312},[497],{"type":178,"value":498},"IsOK",{"type":172,"tag":263,"props":500,"children":501},{"style":318},[502],{"type":178,"value":503},"())",{"type":172,"tag":263,"props":505,"children":506},{"style":318},[507],{"type":178,"value":326},{"type":172,"tag":263,"props":509,"children":511},{"class":265,"line":510},9,[512,517,521,527,531,535,540,546,552,556,560,565,569,574,579,584],{"type":172,"tag":263,"props":513,"children":514},{"style":312},[515],{"type":178,"value":516},"    fprintf",{"type":172,"tag":263,"props":518,"children":519},{"style":318},[520],{"type":178,"value":400},{"type":172,"tag":263,"props":522,"children":524},{"style":523},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[525],{"type":178,"value":526},"stderr",{"type":172,"tag":263,"props":528,"children":529},{"style":318},[530],{"type":178,"value":410},{"type":172,"tag":263,"props":532,"children":533},{"style":276},[534],{"type":178,"value":415},{"type":172,"tag":263,"props":536,"children":537},{"style":282},[538],{"type":178,"value":539},"Could not open the database: ",{"type":172,"tag":263,"props":541,"children":543},{"style":542},"--shiki-light:#E53935;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[544],{"type":178,"value":545},"%s",{"type":172,"tag":263,"props":547,"children":549},{"style":548},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[550],{"type":178,"value":551},"\\n",{"type":172,"tag":263,"props":553,"children":554},{"style":276},[555],{"type":178,"value":425},{"type":172,"tag":263,"props":557,"children":558},{"style":318},[559],{"type":178,"value":410},{"type":172,"tag":263,"props":561,"children":562},{"style":344},[563],{"type":178,"value":564}," s",{"type":172,"tag":263,"props":566,"children":567},{"style":318},[568],{"type":178,"value":455},{"type":172,"tag":263,"props":570,"children":571},{"style":312},[572],{"type":178,"value":573},"ToString",{"type":172,"tag":263,"props":575,"children":576},{"style":318},[577],{"type":178,"value":578},"().",{"type":172,"tag":263,"props":580,"children":581},{"style":312},[582],{"type":178,"value":583},"c_str",{"type":172,"tag":263,"props":585,"children":586},{"style":318},[587],{"type":178,"value":588},"());\n",{"type":172,"tag":263,"props":590,"children":592},{"class":265,"line":591},10,[593,598,602,608],{"type":172,"tag":263,"props":594,"children":595},{"style":312},[596],{"type":178,"value":597},"    exit",{"type":172,"tag":263,"props":599,"children":600},{"style":318},[601],{"type":178,"value":400},{"type":172,"tag":263,"props":603,"children":605},{"style":604},"--shiki-light:#F76D47;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[606],{"type":178,"value":607},"1",{"type":172,"tag":263,"props":609,"children":610},{"style":318},[611],{"type":178,"value":430},{"type":172,"tag":263,"props":613,"children":615},{"class":265,"line":614},11,[616],{"type":172,"tag":263,"props":617,"children":618},{"style":318},[619],{"type":178,"value":620},"  }\n",{"type":172,"tag":263,"props":622,"children":624},{"class":265,"line":623},12,[625],{"type":172,"tag":263,"props":626,"children":627},{"emptyLinePlaceholder":165},[628],{"type":178,"value":299},{"type":172,"tag":263,"props":630,"children":632},{"class":265,"line":631},13,[633,638,642,647,652,656,660,664,668],{"type":172,"tag":263,"props":634,"children":635},{"style":333},[636],{"type":178,"value":637},"  std",{"type":172,"tag":263,"props":639,"children":640},{"style":318},[641],{"type":178,"value":341},{"type":172,"tag":263,"props":643,"children":644},{"style":344},[645],{"type":178,"value":646},"string ",{"type":172,"tag":263,"props":648,"children":649},{"style":312},[650],{"type":178,"value":651},"key1",{"type":172,"tag":263,"props":653,"children":654},{"style":318},[655],{"type":178,"value":400},{"type":172,"tag":263,"props":657,"children":658},{"style":276},[659],{"type":178,"value":425},{"type":172,"tag":263,"props":661,"children":662},{"style":282},[663],{"type":178,"value":651},{"type":172,"tag":263,"props":665,"children":666},{"style":276},[667],{"type":178,"value":425},{"type":172,"tag":263,"props":669,"children":670},{"style":318},[671],{"type":178,"value":430},{"type":172,"tag":263,"props":673,"children":675},{"class":265,"line":674},14,[676,680,684,688,693,697,701,705,709],{"type":172,"tag":263,"props":677,"children":678},{"style":333},[679],{"type":178,"value":637},{"type":172,"tag":263,"props":681,"children":682},{"style":318},[683],{"type":178,"value":341},{"type":172,"tag":263,"props":685,"children":686},{"style":344},[687],{"type":178,"value":646},{"type":172,"tag":263,"props":689,"children":690},{"style":312},[691],{"type":178,"value":692},"value1",{"type":172,"tag":263,"props":694,"children":695},{"style":318},[696],{"type":178,"value":400},{"type":172,"tag":263,"props":698,"children":699},{"style":276},[700],{"type":178,"value":425},{"type":172,"tag":263,"props":702,"children":703},{"style":282},[704],{"type":178,"value":692},{"type":172,"tag":263,"props":706,"children":707},{"style":276},[708],{"type":178,"value":425},{"type":172,"tag":263,"props":710,"children":711},{"style":318},[712],{"type":178,"value":430},{"type":172,"tag":263,"props":714,"children":716},{"class":265,"line":715},15,[717],{"type":172,"tag":263,"props":718,"children":719},{"emptyLinePlaceholder":165},[720],{"type":178,"value":299},{"type":172,"tag":263,"props":722,"children":724},{"class":265,"line":723},16,[725,729,733,738],{"type":172,"tag":263,"props":726,"children":727},{"style":333},[728],{"type":178,"value":336},{"type":172,"tag":263,"props":730,"children":731},{"style":318},[732],{"type":178,"value":341},{"type":172,"tag":263,"props":734,"children":735},{"style":344},[736],{"type":178,"value":737},"WriteOptions write_options",{"type":172,"tag":263,"props":739,"children":740},{"style":318},[741],{"type":178,"value":352},{"type":172,"tag":263,"props":743,"children":745},{"class":265,"line":744},17,[746,750,754,758,762,767,771,776,780,785,789,794],{"type":172,"tag":263,"props":747,"children":748},{"style":344},[749],{"type":178,"value":439},{"type":172,"tag":263,"props":751,"children":752},{"style":442},[753],{"type":178,"value":445},{"type":172,"tag":263,"props":755,"children":756},{"style":344},[757],{"type":178,"value":450},{"type":172,"tag":263,"props":759,"children":760},{"style":318},[761],{"type":178,"value":455},{"type":172,"tag":263,"props":763,"children":764},{"style":312},[765],{"type":178,"value":766},"Put",{"type":172,"tag":263,"props":768,"children":769},{"style":318},[770],{"type":178,"value":400},{"type":172,"tag":263,"props":772,"children":773},{"style":344},[774],{"type":178,"value":775},"write_options",{"type":172,"tag":263,"props":777,"children":778},{"style":318},[779],{"type":178,"value":410},{"type":172,"tag":263,"props":781,"children":782},{"style":344},[783],{"type":178,"value":784}," key1",{"type":172,"tag":263,"props":786,"children":787},{"style":318},[788],{"type":178,"value":410},{"type":172,"tag":263,"props":790,"children":791},{"style":344},[792],{"type":178,"value":793}," value1",{"type":172,"tag":263,"props":795,"children":796},{"style":318},[797],{"type":178,"value":430},{"type":172,"tag":263,"props":799,"children":801},{"class":265,"line":800},18,[802],{"type":172,"tag":263,"props":803,"children":804},{"emptyLinePlaceholder":165},[805],{"type":178,"value":299},{"type":172,"tag":263,"props":807,"children":809},{"class":265,"line":808},19,[810,814,818,823],{"type":172,"tag":263,"props":811,"children":812},{"style":333},[813],{"type":178,"value":336},{"type":172,"tag":263,"props":815,"children":816},{"style":318},[817],{"type":178,"value":341},{"type":172,"tag":263,"props":819,"children":820},{"style":344},[821],{"type":178,"value":822},"ReadOptions read_options",{"type":172,"tag":263,"props":824,"children":825},{"style":318},[826],{"type":178,"value":352},{"type":172,"tag":263,"props":828,"children":830},{"class":265,"line":829},20,[831,835,839,844],{"type":172,"tag":263,"props":832,"children":833},{"style":333},[834],{"type":178,"value":637},{"type":172,"tag":263,"props":836,"children":837},{"style":318},[838],{"type":178,"value":341},{"type":172,"tag":263,"props":840,"children":841},{"style":344},[842],{"type":178,"value":843},"string out_str",{"type":172,"tag":263,"props":845,"children":846},{"style":318},[847],{"type":178,"value":352},{"type":172,"tag":263,"props":849,"children":851},{"class":265,"line":850},21,[852,856,860,864,868,873,877,882,886,890,894,899,904],{"type":172,"tag":263,"props":853,"children":854},{"style":344},[855],{"type":178,"value":439},{"type":172,"tag":263,"props":857,"children":858},{"style":442},[859],{"type":178,"value":445},{"type":172,"tag":263,"props":861,"children":862},{"style":344},[863],{"type":178,"value":450},{"type":172,"tag":263,"props":865,"children":866},{"style":318},[867],{"type":178,"value":455},{"type":172,"tag":263,"props":869,"children":870},{"style":312},[871],{"type":178,"value":872},"Get",{"type":172,"tag":263,"props":874,"children":875},{"style":318},[876],{"type":178,"value":400},{"type":172,"tag":263,"props":878,"children":879},{"style":344},[880],{"type":178,"value":881},"read_options",{"type":172,"tag":263,"props":883,"children":884},{"style":318},[885],{"type":178,"value":410},{"type":172,"tag":263,"props":887,"children":888},{"style":344},[889],{"type":178,"value":784},{"type":172,"tag":263,"props":891,"children":892},{"style":318},[893],{"type":178,"value":410},{"type":172,"tag":263,"props":895,"children":896},{"style":442},[897],{"type":178,"value":898}," &",{"type":172,"tag":263,"props":900,"children":901},{"style":344},[902],{"type":178,"value":903},"out_str",{"type":172,"tag":263,"props":905,"children":906},{"style":318},[907],{"type":178,"value":430},{"type":172,"tag":263,"props":909,"children":911},{"class":265,"line":910},22,[912,916,920,924,928,932,936,941,946,951,955,959,963,968],{"type":172,"tag":263,"props":913,"children":914},{"style":270},[915],{"type":178,"value":474},{"type":172,"tag":263,"props":917,"children":918},{"style":318},[919],{"type":178,"value":479},{"type":172,"tag":263,"props":921,"children":922},{"style":344},[923],{"type":178,"value":489},{"type":172,"tag":263,"props":925,"children":926},{"style":318},[927],{"type":178,"value":455},{"type":172,"tag":263,"props":929,"children":930},{"style":312},[931],{"type":178,"value":498},{"type":172,"tag":263,"props":933,"children":934},{"style":318},[935],{"type":178,"value":321},{"type":172,"tag":263,"props":937,"children":938},{"style":442},[939],{"type":178,"value":940}," &&",{"type":172,"tag":263,"props":942,"children":943},{"style":344},[944],{"type":178,"value":945}," out_str ",{"type":172,"tag":263,"props":947,"children":948},{"style":442},[949],{"type":178,"value":950},"==",{"type":172,"tag":263,"props":952,"children":953},{"style":276},[954],{"type":178,"value":415},{"type":172,"tag":263,"props":956,"children":957},{"style":282},[958],{"type":178,"value":692},{"type":172,"tag":263,"props":960,"children":961},{"style":276},[962],{"type":178,"value":425},{"type":172,"tag":263,"props":964,"children":965},{"style":318},[966],{"type":178,"value":967},")",{"type":172,"tag":263,"props":969,"children":970},{"style":318},[971],{"type":178,"value":326},{"type":172,"tag":263,"props":973,"children":975},{"class":265,"line":974},23,[976,981,985,989,994,998,1002,1007],{"type":172,"tag":263,"props":977,"children":978},{"style":312},[979],{"type":178,"value":980},"    printf",{"type":172,"tag":263,"props":982,"children":983},{"style":318},[984],{"type":178,"value":400},{"type":172,"tag":263,"props":986,"children":987},{"style":276},[988],{"type":178,"value":425},{"type":172,"tag":263,"props":990,"children":991},{"style":282},[992],{"type":178,"value":993},"Data successfully stored and retrieved",{"type":172,"tag":263,"props":995,"children":996},{"style":548},[997],{"type":178,"value":551},{"type":172,"tag":263,"props":999,"children":1000},{"style":276},[1001],{"type":178,"value":425},{"type":172,"tag":263,"props":1003,"children":1004},{"style":318},[1005],{"type":178,"value":1006},");",{"type":172,"tag":263,"props":1008,"children":1009},{"style":523},[1010],{"type":178,"value":1011}," \n",{"type":172,"tag":263,"props":1013,"children":1015},{"class":265,"line":1014},24,[1016,1021,1026],{"type":172,"tag":263,"props":1017,"children":1018},{"style":318},[1019],{"type":178,"value":1020},"  }",{"type":172,"tag":263,"props":1022,"children":1023},{"style":270},[1024],{"type":178,"value":1025}," else",{"type":172,"tag":263,"props":1027,"children":1028},{"style":318},[1029],{"type":178,"value":326},{"type":172,"tag":263,"props":1031,"children":1033},{"class":265,"line":1032},25,[1034,1038,1042,1046,1051,1055,1059,1063],{"type":172,"tag":263,"props":1035,"children":1036},{"style":312},[1037],{"type":178,"value":980},{"type":172,"tag":263,"props":1039,"children":1040},{"style":318},[1041],{"type":178,"value":400},{"type":172,"tag":263,"props":1043,"children":1044},{"style":276},[1045],{"type":178,"value":425},{"type":172,"tag":263,"props":1047,"children":1048},{"style":282},[1049],{"type":178,"value":1050},"An error occurred",{"type":172,"tag":263,"props":1052,"children":1053},{"style":548},[1054],{"type":178,"value":551},{"type":172,"tag":263,"props":1056,"children":1057},{"style":276},[1058],{"type":178,"value":425},{"type":172,"tag":263,"props":1060,"children":1061},{"style":318},[1062],{"type":178,"value":1006},{"type":172,"tag":263,"props":1064,"children":1065},{"style":523},[1066],{"type":178,"value":1011},{"type":172,"tag":263,"props":1068,"children":1070},{"class":265,"line":1069},26,[1071],{"type":172,"tag":263,"props":1072,"children":1073},{"style":318},[1074],{"type":178,"value":620},{"type":172,"tag":263,"props":1076,"children":1078},{"class":265,"line":1077},27,[1079],{"type":172,"tag":263,"props":1080,"children":1081},{"emptyLinePlaceholder":165},[1082],{"type":178,"value":299},{"type":172,"tag":263,"props":1084,"children":1086},{"class":265,"line":1085},28,[1087,1092,1097],{"type":172,"tag":263,"props":1088,"children":1089},{"style":270},[1090],{"type":178,"value":1091},"  return",{"type":172,"tag":263,"props":1093,"children":1094},{"style":604},[1095],{"type":178,"value":1096}," 0",{"type":172,"tag":263,"props":1098,"children":1099},{"style":318},[1100],{"type":178,"value":352},{"type":172,"tag":263,"props":1102,"children":1104},{"class":265,"line":1103},29,[1105],{"type":172,"tag":263,"props":1106,"children":1107},{"style":318},[1108],{"type":178,"value":1109},"}\n",{"type":172,"tag":186,"props":1111,"children":1112},{},[1113],{"type":178,"value":1114},"测试的入口文件是 unit-tests/test_db.cc。以我看过的 JS 库来看，这是一个基本的功能测试。编译好 KDB 之后，运行编译出的二进制文件 test_db 可以开始测试。测试结果输出到控制台，如下代码所示。",{"type":172,"tag":252,"props":1116,"children":1118},{"code":1117},"==== Test DBTest.CloseAndReopen\n==== Test DBTest.RepairInvalidDatabaseOptionFile\n==== Test DBTest.KeysWithNullBytes\n==== Test DBTest.TestStringInterface\nDatabase Options: Stage 0 - Incompressible data with LZ4 compression enabled\nDatabase Options: Stage 1 - Compressible data with LZ4 compression enabled\nDatabase Options: Stage 2 - Compression disabled\nDatabase Options: Stage 3 - 64-bit MurmurHash3\nDatabase Options: Stage 4 - Checksum verification with incompressible data\nDatabase Options: Stage 5 - Checksum verification with compressible data\nDatabase Options: Stage 6 - Checksum verification with compression disabled\nDatabase Options: Stage 7 - Synced writes\nDatabase Options: Stage 8 - Small-sized HSTables with compression disabled\nDatabase Options: Stage 9 - Small-sized HSTables with incompressible data and LZ4 compression\nDatabase Options: Stage 10 - Small-sized HSTables with compressible data and LZ4 compression\nDatabase Options: Stage 11 - Direct mode for Write Buffer (incompressible data with LZ4 compression enabled)\nDatabase Options: Stage 12 - Direct mode for Write Buffer (compressible data with LZ4 compression enabled)\n==== Test DBTest.MultipartReader\n// the same with last stages\n==== Test DBTest.SingleThreadSmallEntries\n// the same with last stages\n==== Test DBTest.SingleThreadSnapshot\n// the same with last stages\n==== Test DBTest.SingleThreadSmallEntriesCompaction\n// the same with last stages\n==== Test DBTest.SequentialIterator\n// the same with last stages\n==== Test DBTest.SingleThreadSingleLargeEntry\n// the same with last stages\n==== Test DBTest.FileUtil\nmysize: 268435456\nOK\n89 ms\nFree size: 944 GB\n==== PASSED 11 tests\n",[1119],{"type":172,"tag":259,"props":1120,"children":1121},{"__ignoreMap":166},[1122],{"type":178,"value":1117},{"type":172,"tag":186,"props":1124,"children":1125},{},[1126],{"type":178,"value":1127},"每个功能点如数据库初始化和关闭 CloseAndReopen、存入带结束符的键 KeysWithNullBytes 都使用对应继承了 DBTest 的测试类进行测试。涉及到与数据库交互的功能部分如 TestStringInterface 使用循环，遍历了所有数据库 Options 可以设置的情况（但是只是二维循环，没有测试参数间的组合）。即对应上文的 Stage 1、Stage 2...",{"type":172,"tag":186,"props":1129,"children":1130},{},[1131],{"type":178,"value":1132},"在 test_db 创建相应的测试类时，会自动调用测试套件（unit-tests/testharness.cc）中的 RegisterTest 把测试函数储存起来。以便运行测试时，通过读取环境变量来判断是否要跳过某类测试。",{"type":172,"tag":186,"props":1134,"children":1135},{},[1136],{"type":178,"value":1137},"测试代码的实现还有一些有意思的地方，以下提及。",{"type":172,"tag":1139,"props":1140,"children":1142},"h4",{"id":1141},"信号处理",[1143],{"type":178,"value":1141},{"type":172,"tag":186,"props":1145,"children":1146},{},[1147],{"type":178,"value":1148},"和数据库核心的入口函数一样，使用 signal 挂载了对 SIGSEGV、SIGABRT 信号的处理。这两个信号分别指代系统内存错误和系统中断。而处理函数非常简单，就是 IKVS 中提到的“let it die”风格：输出调用栈，立马结束程序。",{"type":172,"tag":252,"props":1150,"children":1152},{"code":1151,"language":255,"meta":166,"className":256,"style":166},"void handler(int sig) {\n  int depth_max = 20;\n  void *array[depth_max];\n  size_t depth;\n  // backtrace 将前 depth_max 层栈帧记录到 array 数组中，\n  // 再通过 backtrace_symbols_fd 输出到 stderr。\n  // 文档见：https://man7.org/linux/man-pages/man3/backtrace.3.html\n  depth = backtrace(array, depth_max);\n  fprintf(stderr, \"Error: signal %d:\\n\", sig);\n  backtrace_symbols_fd(array, depth, STDERR_FILENO);\n  exit(1);\n}\nint main() {\n  signal(SIGSEGV, handler);\n  signal(SIGABRT, handler);\n  return kdb::test::RunAllTests();\n}\n",[1153],{"type":172,"tag":259,"props":1154,"children":1155},{"__ignoreMap":166},[1156,1191,1217,1250,1267,1276,1284,1292,1330,1389,1426,1446,1453,1472,1501,1529,1563],{"type":172,"tag":263,"props":1157,"children":1158},{"class":265,"line":266},[1159,1164,1169,1173,1177,1183,1187],{"type":172,"tag":263,"props":1160,"children":1161},{"style":306},[1162],{"type":178,"value":1163},"void",{"type":172,"tag":263,"props":1165,"children":1166},{"style":312},[1167],{"type":178,"value":1168}," handler",{"type":172,"tag":263,"props":1170,"children":1171},{"style":318},[1172],{"type":178,"value":400},{"type":172,"tag":263,"props":1174,"children":1175},{"style":306},[1176],{"type":178,"value":309},{"type":172,"tag":263,"props":1178,"children":1180},{"style":1179},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#E36209;--shiki-default-font-style:inherit;--shiki-dark:#FFAB70;--shiki-dark-font-style:inherit;--shiki-sepia:#FD971F;--shiki-sepia-font-style:italic",[1181],{"type":178,"value":1182}," sig",{"type":172,"tag":263,"props":1184,"children":1185},{"style":318},[1186],{"type":178,"value":967},{"type":172,"tag":263,"props":1188,"children":1189},{"style":318},[1190],{"type":178,"value":326},{"type":172,"tag":263,"props":1192,"children":1193},{"class":265,"line":293},[1194,1199,1204,1208,1213],{"type":172,"tag":263,"props":1195,"children":1196},{"style":306},[1197],{"type":178,"value":1198},"  int",{"type":172,"tag":263,"props":1200,"children":1201},{"style":344},[1202],{"type":178,"value":1203}," depth_max ",{"type":172,"tag":263,"props":1205,"children":1206},{"style":442},[1207],{"type":178,"value":445},{"type":172,"tag":263,"props":1209,"children":1210},{"style":604},[1211],{"type":178,"value":1212}," 20",{"type":172,"tag":263,"props":1214,"children":1215},{"style":318},[1216],{"type":178,"value":352},{"type":172,"tag":263,"props":1218,"children":1219},{"class":265,"line":302},[1220,1225,1230,1235,1240,1245],{"type":172,"tag":263,"props":1221,"children":1222},{"style":306},[1223],{"type":178,"value":1224},"  void",{"type":172,"tag":263,"props":1226,"children":1227},{"style":442},[1228],{"type":178,"value":1229}," *",{"type":172,"tag":263,"props":1231,"children":1232},{"style":344},[1233],{"type":178,"value":1234},"array",{"type":172,"tag":263,"props":1236,"children":1237},{"style":318},[1238],{"type":178,"value":1239},"[",{"type":172,"tag":263,"props":1241,"children":1242},{"style":344},[1243],{"type":178,"value":1244},"depth_max",{"type":172,"tag":263,"props":1246,"children":1247},{"style":318},[1248],{"type":178,"value":1249},"];\n",{"type":172,"tag":263,"props":1251,"children":1252},{"class":265,"line":329},[1253,1258,1263],{"type":172,"tag":263,"props":1254,"children":1255},{"style":306},[1256],{"type":178,"value":1257},"  size_t",{"type":172,"tag":263,"props":1259,"children":1260},{"style":344},[1261],{"type":178,"value":1262}," depth",{"type":172,"tag":263,"props":1264,"children":1265},{"style":318},[1266],{"type":178,"value":352},{"type":172,"tag":263,"props":1268,"children":1269},{"class":265,"line":355},[1270],{"type":172,"tag":263,"props":1271,"children":1273},{"style":1272},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit",[1274],{"type":178,"value":1275},"  // backtrace 将前 depth_max 层栈帧记录到 array 数组中，\n",{"type":172,"tag":263,"props":1277,"children":1278},{"class":265,"line":376},[1279],{"type":172,"tag":263,"props":1280,"children":1281},{"style":1272},[1282],{"type":178,"value":1283},"  // 再通过 backtrace_symbols_fd 输出到 stderr。\n",{"type":172,"tag":263,"props":1285,"children":1286},{"class":265,"line":433},[1287],{"type":172,"tag":263,"props":1288,"children":1289},{"style":1272},[1290],{"type":178,"value":1291},"  // 文档见：https://man7.org/linux/man-pages/man3/backtrace.3.html\n",{"type":172,"tag":263,"props":1293,"children":1294},{"class":265,"line":468},[1295,1300,1304,1309,1313,1317,1321,1326],{"type":172,"tag":263,"props":1296,"children":1297},{"style":344},[1298],{"type":178,"value":1299},"  depth ",{"type":172,"tag":263,"props":1301,"children":1302},{"style":442},[1303],{"type":178,"value":445},{"type":172,"tag":263,"props":1305,"children":1306},{"style":312},[1307],{"type":178,"value":1308}," backtrace",{"type":172,"tag":263,"props":1310,"children":1311},{"style":318},[1312],{"type":178,"value":400},{"type":172,"tag":263,"props":1314,"children":1315},{"style":344},[1316],{"type":178,"value":1234},{"type":172,"tag":263,"props":1318,"children":1319},{"style":318},[1320],{"type":178,"value":410},{"type":172,"tag":263,"props":1322,"children":1323},{"style":344},[1324],{"type":178,"value":1325}," depth_max",{"type":172,"tag":263,"props":1327,"children":1328},{"style":318},[1329],{"type":178,"value":430},{"type":172,"tag":263,"props":1331,"children":1332},{"class":265,"line":510},[1333,1338,1342,1346,1350,1354,1359,1364,1369,1373,1377,1381,1385],{"type":172,"tag":263,"props":1334,"children":1335},{"style":312},[1336],{"type":178,"value":1337},"  fprintf",{"type":172,"tag":263,"props":1339,"children":1340},{"style":318},[1341],{"type":178,"value":400},{"type":172,"tag":263,"props":1343,"children":1344},{"style":344},[1345],{"type":178,"value":526},{"type":172,"tag":263,"props":1347,"children":1348},{"style":318},[1349],{"type":178,"value":410},{"type":172,"tag":263,"props":1351,"children":1352},{"style":276},[1353],{"type":178,"value":415},{"type":172,"tag":263,"props":1355,"children":1356},{"style":282},[1357],{"type":178,"value":1358},"Error: signal ",{"type":172,"tag":263,"props":1360,"children":1361},{"style":542},[1362],{"type":178,"value":1363},"%d",{"type":172,"tag":263,"props":1365,"children":1366},{"style":282},[1367],{"type":178,"value":1368},":",{"type":172,"tag":263,"props":1370,"children":1371},{"style":548},[1372],{"type":178,"value":551},{"type":172,"tag":263,"props":1374,"children":1375},{"style":276},[1376],{"type":178,"value":425},{"type":172,"tag":263,"props":1378,"children":1379},{"style":318},[1380],{"type":178,"value":410},{"type":172,"tag":263,"props":1382,"children":1383},{"style":344},[1384],{"type":178,"value":1182},{"type":172,"tag":263,"props":1386,"children":1387},{"style":318},[1388],{"type":178,"value":430},{"type":172,"tag":263,"props":1390,"children":1391},{"class":265,"line":591},[1392,1397,1401,1405,1409,1413,1417,1422],{"type":172,"tag":263,"props":1393,"children":1394},{"style":312},[1395],{"type":178,"value":1396},"  backtrace_symbols_fd",{"type":172,"tag":263,"props":1398,"children":1399},{"style":318},[1400],{"type":178,"value":400},{"type":172,"tag":263,"props":1402,"children":1403},{"style":344},[1404],{"type":178,"value":1234},{"type":172,"tag":263,"props":1406,"children":1407},{"style":318},[1408],{"type":178,"value":410},{"type":172,"tag":263,"props":1410,"children":1411},{"style":344},[1412],{"type":178,"value":1262},{"type":172,"tag":263,"props":1414,"children":1415},{"style":318},[1416],{"type":178,"value":410},{"type":172,"tag":263,"props":1418,"children":1419},{"style":344},[1420],{"type":178,"value":1421}," STDERR_FILENO",{"type":172,"tag":263,"props":1423,"children":1424},{"style":318},[1425],{"type":178,"value":430},{"type":172,"tag":263,"props":1427,"children":1428},{"class":265,"line":614},[1429,1434,1438,1442],{"type":172,"tag":263,"props":1430,"children":1431},{"style":312},[1432],{"type":178,"value":1433},"  exit",{"type":172,"tag":263,"props":1435,"children":1436},{"style":318},[1437],{"type":178,"value":400},{"type":172,"tag":263,"props":1439,"children":1440},{"style":604},[1441],{"type":178,"value":607},{"type":172,"tag":263,"props":1443,"children":1444},{"style":318},[1445],{"type":178,"value":430},{"type":172,"tag":263,"props":1447,"children":1448},{"class":265,"line":623},[1449],{"type":172,"tag":263,"props":1450,"children":1451},{"style":318},[1452],{"type":178,"value":1109},{"type":172,"tag":263,"props":1454,"children":1455},{"class":265,"line":631},[1456,1460,1464,1468],{"type":172,"tag":263,"props":1457,"children":1458},{"style":306},[1459],{"type":178,"value":309},{"type":172,"tag":263,"props":1461,"children":1462},{"style":312},[1463],{"type":178,"value":315},{"type":172,"tag":263,"props":1465,"children":1466},{"style":318},[1467],{"type":178,"value":321},{"type":172,"tag":263,"props":1469,"children":1470},{"style":318},[1471],{"type":178,"value":326},{"type":172,"tag":263,"props":1473,"children":1474},{"class":265,"line":674},[1475,1480,1484,1489,1493,1497],{"type":172,"tag":263,"props":1476,"children":1477},{"style":312},[1478],{"type":178,"value":1479},"  signal",{"type":172,"tag":263,"props":1481,"children":1482},{"style":318},[1483],{"type":178,"value":400},{"type":172,"tag":263,"props":1485,"children":1486},{"style":344},[1487],{"type":178,"value":1488},"SIGSEGV",{"type":172,"tag":263,"props":1490,"children":1491},{"style":318},[1492],{"type":178,"value":410},{"type":172,"tag":263,"props":1494,"children":1495},{"style":344},[1496],{"type":178,"value":1168},{"type":172,"tag":263,"props":1498,"children":1499},{"style":318},[1500],{"type":178,"value":430},{"type":172,"tag":263,"props":1502,"children":1503},{"class":265,"line":715},[1504,1508,1512,1517,1521,1525],{"type":172,"tag":263,"props":1505,"children":1506},{"style":312},[1507],{"type":178,"value":1479},{"type":172,"tag":263,"props":1509,"children":1510},{"style":318},[1511],{"type":178,"value":400},{"type":172,"tag":263,"props":1513,"children":1514},{"style":344},[1515],{"type":178,"value":1516},"SIGABRT",{"type":172,"tag":263,"props":1518,"children":1519},{"style":318},[1520],{"type":178,"value":410},{"type":172,"tag":263,"props":1522,"children":1523},{"style":344},[1524],{"type":178,"value":1168},{"type":172,"tag":263,"props":1526,"children":1527},{"style":318},[1528],{"type":178,"value":430},{"type":172,"tag":263,"props":1530,"children":1531},{"class":265,"line":723},[1532,1536,1541,1545,1550,1554,1559],{"type":172,"tag":263,"props":1533,"children":1534},{"style":270},[1535],{"type":178,"value":1091},{"type":172,"tag":263,"props":1537,"children":1538},{"style":333},[1539],{"type":178,"value":1540}," kdb",{"type":172,"tag":263,"props":1542,"children":1543},{"style":318},[1544],{"type":178,"value":341},{"type":172,"tag":263,"props":1546,"children":1547},{"style":333},[1548],{"type":178,"value":1549},"test",{"type":172,"tag":263,"props":1551,"children":1552},{"style":318},[1553],{"type":178,"value":341},{"type":172,"tag":263,"props":1555,"children":1556},{"style":312},[1557],{"type":178,"value":1558},"RunAllTests",{"type":172,"tag":263,"props":1560,"children":1561},{"style":318},[1562],{"type":178,"value":465},{"type":172,"tag":263,"props":1564,"children":1565},{"class":265,"line":744},[1566],{"type":172,"tag":263,"props":1567,"children":1568},{"style":318},[1569],{"type":178,"value":1109},{"type":172,"tag":1139,"props":1571,"children":1573},{"id":1572},"使用宏创建测试类",[1574],{"type":178,"value":1572},{"type":172,"tag":186,"props":1576,"children":1577},{},[1578],{"type":178,"value":1579},"test_db 中的类是使用宏定义的。如下代码，TEST 展开的新类，继承了 DBTest，实现了 _RunIt 接口以便调用测试函数。TCONCAT 宏顾名思义就是连接，使用标记黏贴运算符把两个字符串或实参连接在一起并视为一个新的标记。_Test_ 和 name 连接在一起后，就是新类的名称，如 _Test_CloseAndReopen。",{"type":172,"tag":252,"props":1581,"children":1583},{"code":1582,"language":255,"meta":166,"className":256,"style":166},"TEST(DBTest, CloseAndReopen) {\n  // ...\n}\n#define TEST(base,name)                                                 \\\nclass TCONCAT(_Test_,name) : public base {                              \\\n public:                                                                \\\n  void _Run();                                                          \\\n  static void _RunIt() {                                                \\\n    TCONCAT(_Test_,name) t;                                             \\\n    t._Run();                                                           \\\n  }                                                                     \\\n};                                                                      \\\nbool TCONCAT(_Test_ignored_,name) =                                     \\\n  ::kdb::test::RegisterTest(#base, #name, &TCONCAT(_Test_,name)::_RunIt); \\\n",[1584],{"type":172,"tag":259,"props":1585,"children":1586},{"__ignoreMap":166},[1587,1621,1629,1636,1676,1725,1743,1765,1798,1841,1867,1879,1892,1935],{"type":172,"tag":263,"props":1588,"children":1589},{"class":265,"line":266},[1590,1595,1599,1604,1608,1613,1617],{"type":172,"tag":263,"props":1591,"children":1592},{"style":312},[1593],{"type":178,"value":1594},"TEST",{"type":172,"tag":263,"props":1596,"children":1597},{"style":318},[1598],{"type":178,"value":400},{"type":172,"tag":263,"props":1600,"children":1601},{"style":344},[1602],{"type":178,"value":1603},"DBTest",{"type":172,"tag":263,"props":1605,"children":1606},{"style":318},[1607],{"type":178,"value":410},{"type":172,"tag":263,"props":1609,"children":1610},{"style":344},[1611],{"type":178,"value":1612}," CloseAndReopen",{"type":172,"tag":263,"props":1614,"children":1615},{"style":318},[1616],{"type":178,"value":967},{"type":172,"tag":263,"props":1618,"children":1619},{"style":318},[1620],{"type":178,"value":326},{"type":172,"tag":263,"props":1622,"children":1623},{"class":265,"line":293},[1624],{"type":172,"tag":263,"props":1625,"children":1626},{"style":1272},[1627],{"type":178,"value":1628},"  // ...\n",{"type":172,"tag":263,"props":1630,"children":1631},{"class":265,"line":302},[1632],{"type":172,"tag":263,"props":1633,"children":1634},{"style":318},[1635],{"type":178,"value":1109},{"type":172,"tag":263,"props":1637,"children":1638},{"class":265,"line":329},[1639,1644,1649,1653,1658,1662,1667,1671],{"type":172,"tag":263,"props":1640,"children":1641},{"style":270},[1642],{"type":178,"value":1643},"#define",{"type":172,"tag":263,"props":1645,"children":1646},{"style":312},[1647],{"type":178,"value":1648}," TEST",{"type":172,"tag":263,"props":1650,"children":1651},{"style":318},[1652],{"type":178,"value":400},{"type":172,"tag":263,"props":1654,"children":1655},{"style":1179},[1656],{"type":178,"value":1657},"base",{"type":172,"tag":263,"props":1659,"children":1660},{"style":318},[1661],{"type":178,"value":410},{"type":172,"tag":263,"props":1663,"children":1664},{"style":1179},[1665],{"type":178,"value":1666},"name",{"type":172,"tag":263,"props":1668,"children":1669},{"style":318},[1670],{"type":178,"value":967},{"type":172,"tag":263,"props":1672,"children":1673},{"style":548},[1674],{"type":178,"value":1675},"                                                 \\\n",{"type":172,"tag":263,"props":1677,"children":1678},{"class":265,"line":355},[1679,1684,1689,1693,1698,1702,1706,1710,1715,1720],{"type":172,"tag":263,"props":1680,"children":1681},{"style":306},[1682],{"type":178,"value":1683},"class",{"type":172,"tag":263,"props":1685,"children":1686},{"style":312},[1687],{"type":178,"value":1688}," TCONCAT",{"type":172,"tag":263,"props":1690,"children":1691},{"style":318},[1692],{"type":178,"value":400},{"type":172,"tag":263,"props":1694,"children":1695},{"style":333},[1696],{"type":178,"value":1697},"_Test_",{"type":172,"tag":263,"props":1699,"children":1700},{"style":318},[1701],{"type":178,"value":410},{"type":172,"tag":263,"props":1703,"children":1704},{"style":333},[1705],{"type":178,"value":1666},{"type":172,"tag":263,"props":1707,"children":1708},{"style":318},[1709],{"type":178,"value":967},{"type":172,"tag":263,"props":1711,"children":1712},{"style":344},[1713],{"type":178,"value":1714}," : public base ",{"type":172,"tag":263,"props":1716,"children":1717},{"style":318},[1718],{"type":178,"value":1719},"{",{"type":172,"tag":263,"props":1721,"children":1722},{"style":548},[1723],{"type":178,"value":1724},"                              \\\n",{"type":172,"tag":263,"props":1726,"children":1727},{"class":265,"line":376},[1728,1733,1738],{"type":172,"tag":263,"props":1729,"children":1730},{"style":306},[1731],{"type":178,"value":1732}," public",{"type":172,"tag":263,"props":1734,"children":1736},{"style":1735},"--shiki-light:#39ADB5;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic",[1737],{"type":178,"value":1368},{"type":172,"tag":263,"props":1739,"children":1740},{"style":548},[1741],{"type":178,"value":1742},"                                                                \\\n",{"type":172,"tag":263,"props":1744,"children":1745},{"class":265,"line":433},[1746,1750,1755,1760],{"type":172,"tag":263,"props":1747,"children":1748},{"style":306},[1749],{"type":178,"value":1224},{"type":172,"tag":263,"props":1751,"children":1752},{"style":312},[1753],{"type":178,"value":1754}," _Run",{"type":172,"tag":263,"props":1756,"children":1757},{"style":318},[1758],{"type":178,"value":1759},"();",{"type":172,"tag":263,"props":1761,"children":1762},{"style":548},[1763],{"type":178,"value":1764},"                                                          \\\n",{"type":172,"tag":263,"props":1766,"children":1767},{"class":265,"line":468},[1768,1774,1779,1784,1788,1793],{"type":172,"tag":263,"props":1769,"children":1771},{"style":1770},"--shiki-light:#9C3EDA;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[1772],{"type":178,"value":1773},"  static",{"type":172,"tag":263,"props":1775,"children":1776},{"style":306},[1777],{"type":178,"value":1778}," void",{"type":172,"tag":263,"props":1780,"children":1781},{"style":312},[1782],{"type":178,"value":1783}," _RunIt",{"type":172,"tag":263,"props":1785,"children":1786},{"style":318},[1787],{"type":178,"value":321},{"type":172,"tag":263,"props":1789,"children":1790},{"style":318},[1791],{"type":178,"value":1792}," {",{"type":172,"tag":263,"props":1794,"children":1795},{"style":548},[1796],{"type":178,"value":1797},"                                                \\\n",{"type":172,"tag":263,"props":1799,"children":1800},{"class":265,"line":510},[1801,1806,1810,1814,1818,1822,1826,1831,1836],{"type":172,"tag":263,"props":1802,"children":1803},{"style":312},[1804],{"type":178,"value":1805},"    TCONCAT",{"type":172,"tag":263,"props":1807,"children":1808},{"style":318},[1809],{"type":178,"value":400},{"type":172,"tag":263,"props":1811,"children":1812},{"style":523},[1813],{"type":178,"value":1697},{"type":172,"tag":263,"props":1815,"children":1816},{"style":318},[1817],{"type":178,"value":410},{"type":172,"tag":263,"props":1819,"children":1820},{"style":523},[1821],{"type":178,"value":1666},{"type":172,"tag":263,"props":1823,"children":1824},{"style":318},[1825],{"type":178,"value":967},{"type":172,"tag":263,"props":1827,"children":1828},{"style":523},[1829],{"type":178,"value":1830}," t",{"type":172,"tag":263,"props":1832,"children":1833},{"style":318},[1834],{"type":178,"value":1835},";",{"type":172,"tag":263,"props":1837,"children":1838},{"style":548},[1839],{"type":178,"value":1840},"                                             \\\n",{"type":172,"tag":263,"props":1842,"children":1843},{"class":265,"line":591},[1844,1849,1853,1858,1862],{"type":172,"tag":263,"props":1845,"children":1846},{"style":344},[1847],{"type":178,"value":1848},"    t",{"type":172,"tag":263,"props":1850,"children":1851},{"style":318},[1852],{"type":178,"value":455},{"type":172,"tag":263,"props":1854,"children":1855},{"style":312},[1856],{"type":178,"value":1857},"_Run",{"type":172,"tag":263,"props":1859,"children":1860},{"style":318},[1861],{"type":178,"value":1759},{"type":172,"tag":263,"props":1863,"children":1864},{"style":548},[1865],{"type":178,"value":1866},"                                                           \\\n",{"type":172,"tag":263,"props":1868,"children":1869},{"class":265,"line":614},[1870,1874],{"type":172,"tag":263,"props":1871,"children":1872},{"style":318},[1873],{"type":178,"value":1020},{"type":172,"tag":263,"props":1875,"children":1876},{"style":548},[1877],{"type":178,"value":1878},"                                                                     \\\n",{"type":172,"tag":263,"props":1880,"children":1881},{"class":265,"line":623},[1882,1887],{"type":172,"tag":263,"props":1883,"children":1884},{"style":318},[1885],{"type":178,"value":1886},"};",{"type":172,"tag":263,"props":1888,"children":1889},{"style":548},[1890],{"type":178,"value":1891},"                                                                      \\\n",{"type":172,"tag":263,"props":1893,"children":1894},{"class":265,"line":631},[1895,1900,1904,1908,1913,1917,1921,1925,1930],{"type":172,"tag":263,"props":1896,"children":1897},{"style":306},[1898],{"type":178,"value":1899},"bool",{"type":172,"tag":263,"props":1901,"children":1902},{"style":312},[1903],{"type":178,"value":1688},{"type":172,"tag":263,"props":1905,"children":1906},{"style":318},[1907],{"type":178,"value":400},{"type":172,"tag":263,"props":1909,"children":1910},{"style":333},[1911],{"type":178,"value":1912},"_Test_ignored_",{"type":172,"tag":263,"props":1914,"children":1915},{"style":318},[1916],{"type":178,"value":410},{"type":172,"tag":263,"props":1918,"children":1919},{"style":333},[1920],{"type":178,"value":1666},{"type":172,"tag":263,"props":1922,"children":1923},{"style":318},[1924],{"type":178,"value":967},{"type":172,"tag":263,"props":1926,"children":1927},{"style":442},[1928],{"type":178,"value":1929}," =",{"type":172,"tag":263,"props":1931,"children":1932},{"style":548},[1933],{"type":178,"value":1934},"                                     \\\n",{"type":172,"tag":263,"props":1936,"children":1937},{"class":265,"line":674},[1938,1943,1948,1952,1956,1960,1965,1969,1974,1978,1983,1987,1991,1996,2000,2004,2008,2012,2016,2021,2025],{"type":172,"tag":263,"props":1939,"children":1940},{"style":344},[1941],{"type":178,"value":1942},"  ::",{"type":172,"tag":263,"props":1944,"children":1945},{"style":333},[1946],{"type":178,"value":1947},"kdb",{"type":172,"tag":263,"props":1949,"children":1950},{"style":318},[1951],{"type":178,"value":341},{"type":172,"tag":263,"props":1953,"children":1954},{"style":333},[1955],{"type":178,"value":1549},{"type":172,"tag":263,"props":1957,"children":1958},{"style":318},[1959],{"type":178,"value":341},{"type":172,"tag":263,"props":1961,"children":1962},{"style":312},[1963],{"type":178,"value":1964},"RegisterTest",{"type":172,"tag":263,"props":1966,"children":1967},{"style":318},[1968],{"type":178,"value":400},{"type":172,"tag":263,"props":1970,"children":1971},{"style":344},[1972],{"type":178,"value":1973},"#base",{"type":172,"tag":263,"props":1975,"children":1976},{"style":318},[1977],{"type":178,"value":410},{"type":172,"tag":263,"props":1979,"children":1980},{"style":344},[1981],{"type":178,"value":1982}," #name",{"type":172,"tag":263,"props":1984,"children":1985},{"style":318},[1986],{"type":178,"value":410},{"type":172,"tag":263,"props":1988,"children":1989},{"style":442},[1990],{"type":178,"value":898},{"type":172,"tag":263,"props":1992,"children":1993},{"style":312},[1994],{"type":178,"value":1995},"TCONCAT",{"type":172,"tag":263,"props":1997,"children":1998},{"style":318},[1999],{"type":178,"value":400},{"type":172,"tag":263,"props":2001,"children":2002},{"style":344},[2003],{"type":178,"value":1697},{"type":172,"tag":263,"props":2005,"children":2006},{"style":318},[2007],{"type":178,"value":410},{"type":172,"tag":263,"props":2009,"children":2010},{"style":344},[2011],{"type":178,"value":1666},{"type":172,"tag":263,"props":2013,"children":2014},{"style":318},[2015],{"type":178,"value":967},{"type":172,"tag":263,"props":2017,"children":2018},{"style":344},[2019],{"type":178,"value":2020},"::_RunIt",{"type":172,"tag":263,"props":2022,"children":2023},{"style":318},[2024],{"type":178,"value":1006},{"type":172,"tag":263,"props":2026,"children":2027},{"style":548},[2028],{"type":178,"value":2029}," \\\n",{"type":172,"tag":186,"props":2031,"children":2032},{},[2033],{"type":178,"value":2034},"可是，既然有 TCONCAT，为什么还要定义一个 TCONCAT1 宏呢？",{"type":172,"tag":252,"props":2036,"children":2038},{"code":2037,"language":255,"meta":166,"className":256,"style":166},"#define TCONCAT(a,b) TCONCAT1(a,b)\n#define TCONCAT1(a,b) a##b\n",[2039],{"type":172,"tag":259,"props":2040,"children":2041},{"__ignoreMap":166},[2042,2100],{"type":172,"tag":263,"props":2043,"children":2044},{"class":265,"line":266},[2045,2049,2053,2057,2061,2065,2070,2074,2079,2083,2087,2091,2095],{"type":172,"tag":263,"props":2046,"children":2047},{"style":270},[2048],{"type":178,"value":1643},{"type":172,"tag":263,"props":2050,"children":2051},{"style":312},[2052],{"type":178,"value":1688},{"type":172,"tag":263,"props":2054,"children":2055},{"style":318},[2056],{"type":178,"value":400},{"type":172,"tag":263,"props":2058,"children":2059},{"style":1179},[2060],{"type":178,"value":197},{"type":172,"tag":263,"props":2062,"children":2063},{"style":318},[2064],{"type":178,"value":410},{"type":172,"tag":263,"props":2066,"children":2067},{"style":1179},[2068],{"type":178,"value":2069},"b",{"type":172,"tag":263,"props":2071,"children":2072},{"style":318},[2073],{"type":178,"value":967},{"type":172,"tag":263,"props":2075,"children":2076},{"style":312},[2077],{"type":178,"value":2078}," TCONCAT1",{"type":172,"tag":263,"props":2080,"children":2081},{"style":318},[2082],{"type":178,"value":400},{"type":172,"tag":263,"props":2084,"children":2085},{"style":344},[2086],{"type":178,"value":197},{"type":172,"tag":263,"props":2088,"children":2089},{"style":318},[2090],{"type":178,"value":410},{"type":172,"tag":263,"props":2092,"children":2093},{"style":344},[2094],{"type":178,"value":2069},{"type":172,"tag":263,"props":2096,"children":2097},{"style":318},[2098],{"type":178,"value":2099},")\n",{"type":172,"tag":263,"props":2101,"children":2102},{"class":265,"line":293},[2103,2107,2111,2115,2119,2123,2127,2131],{"type":172,"tag":263,"props":2104,"children":2105},{"style":270},[2106],{"type":178,"value":1643},{"type":172,"tag":263,"props":2108,"children":2109},{"style":312},[2110],{"type":178,"value":2078},{"type":172,"tag":263,"props":2112,"children":2113},{"style":318},[2114],{"type":178,"value":400},{"type":172,"tag":263,"props":2116,"children":2117},{"style":1179},[2118],{"type":178,"value":197},{"type":172,"tag":263,"props":2120,"children":2121},{"style":318},[2122],{"type":178,"value":410},{"type":172,"tag":263,"props":2124,"children":2125},{"style":1179},[2126],{"type":178,"value":2069},{"type":172,"tag":263,"props":2128,"children":2129},{"style":318},[2130],{"type":178,"value":967},{"type":172,"tag":263,"props":2132,"children":2133},{"style":344},[2134],{"type":178,"value":2135}," a##b\n",{"type":172,"tag":186,"props":2137,"children":2138},{},[2139],{"type":178,"value":2140},"这就要提到宏的一个特殊规则了，如果宏参数使用了字符串化运算符（#）或标记黏贴运算符（##），那么即便参数是宏也不会展开。所以需要一个间接宏 TCONCAT1，以达到先展开参数（如果参数是宏的化），再调用标记黏贴运算符的目的。从 test_db 可以看到，测试类的名词都不是宏，所以这里本不需要 TCONCAT1 这个间接宏。但是考虑到程序的健壮性，加上更好。",{"type":172,"tag":1139,"props":2142,"children":2144},{"id":2143},"断言宏",[2145],{"type":178,"value":2143},{"type":172,"tag":186,"props":2147,"children":2148},{},[2149],{"type":178,"value":2150},"测试代码中的断言也是使用的宏来定义的。相比 TCONCAT 简单很多了，但其特点是可以记录抛错的文件以及行号。以下代码实现了 ASSERT_EQ 的定义。Tester 用于记录宏展开时所在的文件 __FILE__、行号 __LINE__ 以及断言结果。一但断言失败，记录到 ok_ 成员变量中。在 Tester 析构时，会把相关信息一并打印出来。",{"type":172,"tag":252,"props":2152,"children":2154},{"code":2153,"language":255,"meta":166,"className":256,"style":166},"class Tester {\n#define BINARY_OP(name,op)                              \\\n  template \u003Cclass X, class Y>                           \\\n  Tester& name(const X& x, const Y& y) {                \\\n    if (! (x op y)) {                                   \\\n      ss_ \u003C\u003C \" failed: \" \u003C\u003C x \u003C\u003C (\" \" #op \" \") \u003C\u003C y;    \\\n      ok_ = false;                                      \\\n    }                                                   \\\n    return *this;                                       \\\n  }\n  BINARY_OP(IsEq, ==)\n#undef BINARY_OP\n}\n#define ASSERT_EQ(a,b) ::kdb::test::Tester(__FILE__, __LINE__).IsEq((a),(b))\n",[2155],{"type":172,"tag":259,"props":2156,"children":2157},{"__ignoreMap":166},[2158,2174,2211,2256,2331,2370,2456,2483,2496,2523,2530,2560,2573,2580],{"type":172,"tag":263,"props":2159,"children":2160},{"class":265,"line":266},[2161,2165,2170],{"type":172,"tag":263,"props":2162,"children":2163},{"style":306},[2164],{"type":178,"value":1683},{"type":172,"tag":263,"props":2166,"children":2167},{"style":333},[2168],{"type":178,"value":2169}," Tester",{"type":172,"tag":263,"props":2171,"children":2172},{"style":318},[2173],{"type":178,"value":326},{"type":172,"tag":263,"props":2175,"children":2176},{"class":265,"line":293},[2177,2181,2186,2190,2194,2198,2203,2207],{"type":172,"tag":263,"props":2178,"children":2179},{"style":270},[2180],{"type":178,"value":1643},{"type":172,"tag":263,"props":2182,"children":2183},{"style":312},[2184],{"type":178,"value":2185}," BINARY_OP",{"type":172,"tag":263,"props":2187,"children":2188},{"style":318},[2189],{"type":178,"value":400},{"type":172,"tag":263,"props":2191,"children":2192},{"style":1179},[2193],{"type":178,"value":1666},{"type":172,"tag":263,"props":2195,"children":2196},{"style":318},[2197],{"type":178,"value":410},{"type":172,"tag":263,"props":2199,"children":2200},{"style":1179},[2201],{"type":178,"value":2202},"op",{"type":172,"tag":263,"props":2204,"children":2205},{"style":318},[2206],{"type":178,"value":967},{"type":172,"tag":263,"props":2208,"children":2209},{"style":548},[2210],{"type":178,"value":1724},{"type":172,"tag":263,"props":2212,"children":2213},{"class":265,"line":302},[2214,2219,2223,2227,2232,2236,2241,2246,2251],{"type":172,"tag":263,"props":2215,"children":2216},{"style":306},[2217],{"type":178,"value":2218},"  template",{"type":172,"tag":263,"props":2220,"children":2221},{"style":318},[2222],{"type":178,"value":279},{"type":172,"tag":263,"props":2224,"children":2225},{"style":306},[2226],{"type":178,"value":1683},{"type":172,"tag":263,"props":2228,"children":2229},{"style":333},[2230],{"type":178,"value":2231}," X",{"type":172,"tag":263,"props":2233,"children":2234},{"style":318},[2235],{"type":178,"value":410},{"type":172,"tag":263,"props":2237,"children":2238},{"style":306},[2239],{"type":178,"value":2240}," class",{"type":172,"tag":263,"props":2242,"children":2243},{"style":333},[2244],{"type":178,"value":2245}," Y",{"type":172,"tag":263,"props":2247,"children":2248},{"style":318},[2249],{"type":178,"value":2250},">",{"type":172,"tag":263,"props":2252,"children":2253},{"style":548},[2254],{"type":178,"value":2255},"                           \\\n",{"type":172,"tag":263,"props":2257,"children":2258},{"class":265,"line":329},[2259,2264,2269,2274,2278,2283,2287,2291,2296,2300,2305,2309,2313,2318,2322,2326],{"type":172,"tag":263,"props":2260,"children":2261},{"style":333},[2262],{"type":178,"value":2263},"  Tester",{"type":172,"tag":263,"props":2265,"children":2266},{"style":1770},[2267],{"type":178,"value":2268},"&",{"type":172,"tag":263,"props":2270,"children":2271},{"style":312},[2272],{"type":178,"value":2273}," name",{"type":172,"tag":263,"props":2275,"children":2276},{"style":318},[2277],{"type":178,"value":400},{"type":172,"tag":263,"props":2279,"children":2280},{"style":1770},[2281],{"type":178,"value":2282},"const",{"type":172,"tag":263,"props":2284,"children":2285},{"style":333},[2286],{"type":178,"value":2231},{"type":172,"tag":263,"props":2288,"children":2289},{"style":1770},[2290],{"type":178,"value":2268},{"type":172,"tag":263,"props":2292,"children":2293},{"style":1179},[2294],{"type":178,"value":2295}," x",{"type":172,"tag":263,"props":2297,"children":2298},{"style":318},[2299],{"type":178,"value":410},{"type":172,"tag":263,"props":2301,"children":2302},{"style":1770},[2303],{"type":178,"value":2304}," const",{"type":172,"tag":263,"props":2306,"children":2307},{"style":333},[2308],{"type":178,"value":2245},{"type":172,"tag":263,"props":2310,"children":2311},{"style":1770},[2312],{"type":178,"value":2268},{"type":172,"tag":263,"props":2314,"children":2315},{"style":1179},[2316],{"type":178,"value":2317}," y",{"type":172,"tag":263,"props":2319,"children":2320},{"style":318},[2321],{"type":178,"value":967},{"type":172,"tag":263,"props":2323,"children":2324},{"style":318},[2325],{"type":178,"value":1792},{"type":172,"tag":263,"props":2327,"children":2328},{"style":548},[2329],{"type":178,"value":2330},"                \\\n",{"type":172,"tag":263,"props":2332,"children":2333},{"class":265,"line":355},[2334,2339,2343,2347,2351,2356,2361,2365],{"type":172,"tag":263,"props":2335,"children":2336},{"style":270},[2337],{"type":178,"value":2338},"    if",{"type":172,"tag":263,"props":2340,"children":2341},{"style":318},[2342],{"type":178,"value":479},{"type":172,"tag":263,"props":2344,"children":2345},{"style":442},[2346],{"type":178,"value":484},{"type":172,"tag":263,"props":2348,"children":2349},{"style":318},[2350],{"type":178,"value":479},{"type":172,"tag":263,"props":2352,"children":2353},{"style":523},[2354],{"type":178,"value":2355},"x op y",{"type":172,"tag":263,"props":2357,"children":2358},{"style":318},[2359],{"type":178,"value":2360},"))",{"type":172,"tag":263,"props":2362,"children":2363},{"style":318},[2364],{"type":178,"value":1792},{"type":172,"tag":263,"props":2366,"children":2367},{"style":548},[2368],{"type":178,"value":2369},"                                   \\\n",{"type":172,"tag":263,"props":2371,"children":2372},{"class":265,"line":376},[2373,2378,2383,2387,2392,2396,2401,2406,2410,2414,2418,2422,2427,2431,2435,2439,2443,2447,2451],{"type":172,"tag":263,"props":2374,"children":2375},{"style":523},[2376],{"type":178,"value":2377},"      ss_ ",{"type":172,"tag":263,"props":2379,"children":2380},{"style":442},[2381],{"type":178,"value":2382},"\u003C\u003C",{"type":172,"tag":263,"props":2384,"children":2385},{"style":276},[2386],{"type":178,"value":415},{"type":172,"tag":263,"props":2388,"children":2389},{"style":282},[2390],{"type":178,"value":2391}," failed: ",{"type":172,"tag":263,"props":2393,"children":2394},{"style":276},[2395],{"type":178,"value":425},{"type":172,"tag":263,"props":2397,"children":2398},{"style":442},[2399],{"type":178,"value":2400}," \u003C\u003C",{"type":172,"tag":263,"props":2402,"children":2403},{"style":523},[2404],{"type":178,"value":2405}," x ",{"type":172,"tag":263,"props":2407,"children":2408},{"style":442},[2409],{"type":178,"value":2382},{"type":172,"tag":263,"props":2411,"children":2412},{"style":318},[2413],{"type":178,"value":479},{"type":172,"tag":263,"props":2415,"children":2416},{"style":276},[2417],{"type":178,"value":425},{"type":172,"tag":263,"props":2419,"children":2420},{"style":276},[2421],{"type":178,"value":415},{"type":172,"tag":263,"props":2423,"children":2424},{"style":344},[2425],{"type":178,"value":2426}," #op",{"type":172,"tag":263,"props":2428,"children":2429},{"style":276},[2430],{"type":178,"value":415},{"type":172,"tag":263,"props":2432,"children":2433},{"style":276},[2434],{"type":178,"value":415},{"type":172,"tag":263,"props":2436,"children":2437},{"style":318},[2438],{"type":178,"value":967},{"type":172,"tag":263,"props":2440,"children":2441},{"style":442},[2442],{"type":178,"value":2400},{"type":172,"tag":263,"props":2444,"children":2445},{"style":523},[2446],{"type":178,"value":2317},{"type":172,"tag":263,"props":2448,"children":2449},{"style":318},[2450],{"type":178,"value":1835},{"type":172,"tag":263,"props":2452,"children":2453},{"style":548},[2454],{"type":178,"value":2455},"    \\\n",{"type":172,"tag":263,"props":2457,"children":2458},{"class":265,"line":433},[2459,2464,2468,2474,2478],{"type":172,"tag":263,"props":2460,"children":2461},{"style":523},[2462],{"type":178,"value":2463},"      ok_ ",{"type":172,"tag":263,"props":2465,"children":2466},{"style":442},[2467],{"type":178,"value":445},{"type":172,"tag":263,"props":2469,"children":2471},{"style":2470},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[2472],{"type":178,"value":2473}," false",{"type":172,"tag":263,"props":2475,"children":2476},{"style":318},[2477],{"type":178,"value":1835},{"type":172,"tag":263,"props":2479,"children":2480},{"style":548},[2481],{"type":178,"value":2482},"                                      \\\n",{"type":172,"tag":263,"props":2484,"children":2485},{"class":265,"line":468},[2486,2491],{"type":172,"tag":263,"props":2487,"children":2488},{"style":318},[2489],{"type":178,"value":2490},"    }",{"type":172,"tag":263,"props":2492,"children":2493},{"style":548},[2494],{"type":178,"value":2495},"                                                   \\\n",{"type":172,"tag":263,"props":2497,"children":2498},{"class":265,"line":510},[2499,2504,2508,2514,2518],{"type":172,"tag":263,"props":2500,"children":2501},{"style":270},[2502],{"type":178,"value":2503},"    return",{"type":172,"tag":263,"props":2505,"children":2506},{"style":442},[2507],{"type":178,"value":1229},{"type":172,"tag":263,"props":2509,"children":2511},{"style":2510},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[2512],{"type":178,"value":2513},"this",{"type":172,"tag":263,"props":2515,"children":2516},{"style":318},[2517],{"type":178,"value":1835},{"type":172,"tag":263,"props":2519,"children":2520},{"style":548},[2521],{"type":178,"value":2522},"                                       \\\n",{"type":172,"tag":263,"props":2524,"children":2525},{"class":265,"line":591},[2526],{"type":172,"tag":263,"props":2527,"children":2528},{"style":318},[2529],{"type":178,"value":620},{"type":172,"tag":263,"props":2531,"children":2532},{"class":265,"line":614},[2533,2538,2542,2547,2551,2556],{"type":172,"tag":263,"props":2534,"children":2535},{"style":312},[2536],{"type":178,"value":2537},"  BINARY_OP",{"type":172,"tag":263,"props":2539,"children":2540},{"style":318},[2541],{"type":178,"value":400},{"type":172,"tag":263,"props":2543,"children":2544},{"style":333},[2545],{"type":178,"value":2546},"IsEq",{"type":172,"tag":263,"props":2548,"children":2549},{"style":318},[2550],{"type":178,"value":410},{"type":172,"tag":263,"props":2552,"children":2553},{"style":442},[2554],{"type":178,"value":2555}," ==",{"type":172,"tag":263,"props":2557,"children":2558},{"style":318},[2559],{"type":178,"value":2099},{"type":172,"tag":263,"props":2561,"children":2562},{"class":265,"line":623},[2563,2568],{"type":172,"tag":263,"props":2564,"children":2565},{"style":270},[2566],{"type":178,"value":2567},"#undef",{"type":172,"tag":263,"props":2569,"children":2570},{"style":312},[2571],{"type":178,"value":2572}," BINARY_OP\n",{"type":172,"tag":263,"props":2574,"children":2575},{"class":265,"line":631},[2576],{"type":172,"tag":263,"props":2577,"children":2578},{"style":523},[2579],{"type":178,"value":1109},{"type":172,"tag":263,"props":2581,"children":2582},{"class":265,"line":674},[2583,2587,2592,2596,2600,2604,2608,2612,2617,2621,2625,2629,2633,2638,2642,2648,2652,2657,2662,2666,2671,2675,2680,2684],{"type":172,"tag":263,"props":2584,"children":2585},{"style":270},[2586],{"type":178,"value":1643},{"type":172,"tag":263,"props":2588,"children":2589},{"style":312},[2590],{"type":178,"value":2591}," ASSERT_EQ",{"type":172,"tag":263,"props":2593,"children":2594},{"style":318},[2595],{"type":178,"value":400},{"type":172,"tag":263,"props":2597,"children":2598},{"style":1179},[2599],{"type":178,"value":197},{"type":172,"tag":263,"props":2601,"children":2602},{"style":318},[2603],{"type":178,"value":410},{"type":172,"tag":263,"props":2605,"children":2606},{"style":1179},[2607],{"type":178,"value":2069},{"type":172,"tag":263,"props":2609,"children":2610},{"style":318},[2611],{"type":178,"value":967},{"type":172,"tag":263,"props":2613,"children":2614},{"style":523},[2615],{"type":178,"value":2616}," ::",{"type":172,"tag":263,"props":2618,"children":2619},{"style":333},[2620],{"type":178,"value":1947},{"type":172,"tag":263,"props":2622,"children":2623},{"style":318},[2624],{"type":178,"value":341},{"type":172,"tag":263,"props":2626,"children":2627},{"style":333},[2628],{"type":178,"value":1549},{"type":172,"tag":263,"props":2630,"children":2631},{"style":318},[2632],{"type":178,"value":341},{"type":172,"tag":263,"props":2634,"children":2635},{"style":312},[2636],{"type":178,"value":2637},"Tester",{"type":172,"tag":263,"props":2639,"children":2640},{"style":318},[2641],{"type":178,"value":400},{"type":172,"tag":263,"props":2643,"children":2645},{"style":2644},"--shiki-light:#E2931D;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#F8F8F2",[2646],{"type":178,"value":2647},"__FILE__",{"type":172,"tag":263,"props":2649,"children":2650},{"style":318},[2651],{"type":178,"value":410},{"type":172,"tag":263,"props":2653,"children":2654},{"style":2644},[2655],{"type":178,"value":2656}," __LINE__",{"type":172,"tag":263,"props":2658,"children":2659},{"style":318},[2660],{"type":178,"value":2661},").",{"type":172,"tag":263,"props":2663,"children":2664},{"style":312},[2665],{"type":178,"value":2546},{"type":172,"tag":263,"props":2667,"children":2668},{"style":318},[2669],{"type":178,"value":2670},"((",{"type":172,"tag":263,"props":2672,"children":2673},{"style":523},[2674],{"type":178,"value":197},{"type":172,"tag":263,"props":2676,"children":2677},{"style":318},[2678],{"type":178,"value":2679},"),(",{"type":172,"tag":263,"props":2681,"children":2682},{"style":523},[2683],{"type":178,"value":2069},{"type":172,"tag":263,"props":2685,"children":2686},{"style":318},[2687],{"type":178,"value":2688},"))\n",{"type":172,"tag":1139,"props":2690,"children":2692},{"id":2691},"stringrepeatntimes",[2693],{"type":178,"value":2694},"string.repeat(ntimes)",{"type":172,"tag":186,"props":2696,"children":2697},{},[2698],{"type":178,"value":2699},"写 JavaScript 时经常用到 String 的原型方法 repeat，用来把 n 个内容重复的字符串拼接为一个新字符串。也许是 C++ 标准库没有提供相应的算法，KDB 使用了一种和 repeat 完全不一样的处理思路。KDB 使用 StringStream 填充一定位数内容，还可以不用考虑值的长度。",{"type":172,"tag":252,"props":2701,"children":2703},{"code":2702,"language":255,"meta":166,"className":256,"style":166},"std::stringstream ss;\nss \u003C\u003C std::setfill ('0') \u003C\u003C std::setw (16);\nss \u003C\u003C 1;\nss.str(); // result is: \"0000000000000001\"\nss \u003C\u003C std::setfill ('0') \u003C\u003C std::setw (16);\nss \u003C\u003C 1123;\nss.str(); // result is: \"0000000000001123\"\n",[2704],{"type":172,"tag":259,"props":2705,"children":2706},{"__ignoreMap":166},[2707,2728,2806,2826,2852,2923,2943],{"type":172,"tag":263,"props":2708,"children":2709},{"class":265,"line":266},[2710,2715,2719,2724],{"type":172,"tag":263,"props":2711,"children":2712},{"style":333},[2713],{"type":178,"value":2714},"std",{"type":172,"tag":263,"props":2716,"children":2717},{"style":318},[2718],{"type":178,"value":341},{"type":172,"tag":263,"props":2720,"children":2721},{"style":344},[2722],{"type":178,"value":2723},"stringstream ss",{"type":172,"tag":263,"props":2725,"children":2726},{"style":318},[2727],{"type":178,"value":352},{"type":172,"tag":263,"props":2729,"children":2730},{"class":265,"line":293},[2731,2736,2740,2745,2749,2754,2758,2763,2768,2772,2776,2780,2784,2788,2793,2797,2802],{"type":172,"tag":263,"props":2732,"children":2733},{"style":344},[2734],{"type":178,"value":2735},"ss ",{"type":172,"tag":263,"props":2737,"children":2738},{"style":442},[2739],{"type":178,"value":2382},{"type":172,"tag":263,"props":2741,"children":2742},{"style":333},[2743],{"type":178,"value":2744}," std",{"type":172,"tag":263,"props":2746,"children":2747},{"style":318},[2748],{"type":178,"value":341},{"type":172,"tag":263,"props":2750,"children":2751},{"style":312},[2752],{"type":178,"value":2753},"setfill",{"type":172,"tag":263,"props":2755,"children":2756},{"style":318},[2757],{"type":178,"value":479},{"type":172,"tag":263,"props":2759,"children":2760},{"style":276},[2761],{"type":178,"value":2762},"'",{"type":172,"tag":263,"props":2764,"children":2765},{"style":282},[2766],{"type":178,"value":2767},"0",{"type":172,"tag":263,"props":2769,"children":2770},{"style":276},[2771],{"type":178,"value":2762},{"type":172,"tag":263,"props":2773,"children":2774},{"style":318},[2775],{"type":178,"value":967},{"type":172,"tag":263,"props":2777,"children":2778},{"style":442},[2779],{"type":178,"value":2400},{"type":172,"tag":263,"props":2781,"children":2782},{"style":333},[2783],{"type":178,"value":2744},{"type":172,"tag":263,"props":2785,"children":2786},{"style":318},[2787],{"type":178,"value":341},{"type":172,"tag":263,"props":2789,"children":2790},{"style":312},[2791],{"type":178,"value":2792},"setw",{"type":172,"tag":263,"props":2794,"children":2795},{"style":318},[2796],{"type":178,"value":479},{"type":172,"tag":263,"props":2798,"children":2799},{"style":604},[2800],{"type":178,"value":2801},"16",{"type":172,"tag":263,"props":2803,"children":2804},{"style":318},[2805],{"type":178,"value":430},{"type":172,"tag":263,"props":2807,"children":2808},{"class":265,"line":302},[2809,2813,2817,2822],{"type":172,"tag":263,"props":2810,"children":2811},{"style":344},[2812],{"type":178,"value":2735},{"type":172,"tag":263,"props":2814,"children":2815},{"style":442},[2816],{"type":178,"value":2382},{"type":172,"tag":263,"props":2818,"children":2819},{"style":604},[2820],{"type":178,"value":2821}," 1",{"type":172,"tag":263,"props":2823,"children":2824},{"style":318},[2825],{"type":178,"value":352},{"type":172,"tag":263,"props":2827,"children":2828},{"class":265,"line":329},[2829,2834,2838,2843,2847],{"type":172,"tag":263,"props":2830,"children":2831},{"style":344},[2832],{"type":178,"value":2833},"ss",{"type":172,"tag":263,"props":2835,"children":2836},{"style":318},[2837],{"type":178,"value":455},{"type":172,"tag":263,"props":2839,"children":2840},{"style":312},[2841],{"type":178,"value":2842},"str",{"type":172,"tag":263,"props":2844,"children":2845},{"style":318},[2846],{"type":178,"value":1759},{"type":172,"tag":263,"props":2848,"children":2849},{"style":1272},[2850],{"type":178,"value":2851}," // result is: \"0000000000000001\"\n",{"type":172,"tag":263,"props":2853,"children":2854},{"class":265,"line":355},[2855,2859,2863,2867,2871,2875,2879,2883,2887,2891,2895,2899,2903,2907,2911,2915,2919],{"type":172,"tag":263,"props":2856,"children":2857},{"style":344},[2858],{"type":178,"value":2735},{"type":172,"tag":263,"props":2860,"children":2861},{"style":442},[2862],{"type":178,"value":2382},{"type":172,"tag":263,"props":2864,"children":2865},{"style":333},[2866],{"type":178,"value":2744},{"type":172,"tag":263,"props":2868,"children":2869},{"style":318},[2870],{"type":178,"value":341},{"type":172,"tag":263,"props":2872,"children":2873},{"style":312},[2874],{"type":178,"value":2753},{"type":172,"tag":263,"props":2876,"children":2877},{"style":318},[2878],{"type":178,"value":479},{"type":172,"tag":263,"props":2880,"children":2881},{"style":276},[2882],{"type":178,"value":2762},{"type":172,"tag":263,"props":2884,"children":2885},{"style":282},[2886],{"type":178,"value":2767},{"type":172,"tag":263,"props":2888,"children":2889},{"style":276},[2890],{"type":178,"value":2762},{"type":172,"tag":263,"props":2892,"children":2893},{"style":318},[2894],{"type":178,"value":967},{"type":172,"tag":263,"props":2896,"children":2897},{"style":442},[2898],{"type":178,"value":2400},{"type":172,"tag":263,"props":2900,"children":2901},{"style":333},[2902],{"type":178,"value":2744},{"type":172,"tag":263,"props":2904,"children":2905},{"style":318},[2906],{"type":178,"value":341},{"type":172,"tag":263,"props":2908,"children":2909},{"style":312},[2910],{"type":178,"value":2792},{"type":172,"tag":263,"props":2912,"children":2913},{"style":318},[2914],{"type":178,"value":479},{"type":172,"tag":263,"props":2916,"children":2917},{"style":604},[2918],{"type":178,"value":2801},{"type":172,"tag":263,"props":2920,"children":2921},{"style":318},[2922],{"type":178,"value":430},{"type":172,"tag":263,"props":2924,"children":2925},{"class":265,"line":376},[2926,2930,2934,2939],{"type":172,"tag":263,"props":2927,"children":2928},{"style":344},[2929],{"type":178,"value":2735},{"type":172,"tag":263,"props":2931,"children":2932},{"style":442},[2933],{"type":178,"value":2382},{"type":172,"tag":263,"props":2935,"children":2936},{"style":604},[2937],{"type":178,"value":2938}," 1123",{"type":172,"tag":263,"props":2940,"children":2941},{"style":318},[2942],{"type":178,"value":352},{"type":172,"tag":263,"props":2944,"children":2945},{"class":265,"line":433},[2946,2950,2954,2958,2962],{"type":172,"tag":263,"props":2947,"children":2948},{"style":344},[2949],{"type":178,"value":2833},{"type":172,"tag":263,"props":2951,"children":2952},{"style":318},[2953],{"type":178,"value":455},{"type":172,"tag":263,"props":2955,"children":2956},{"style":312},[2957],{"type":178,"value":2842},{"type":172,"tag":263,"props":2959,"children":2960},{"style":318},[2961],{"type":178,"value":1759},{"type":172,"tag":263,"props":2963,"children":2964},{"style":1272},[2965],{"type":178,"value":2966}," // result is: \"0000000000001123\"\n",{"type":172,"tag":1139,"props":2968,"children":2970},{"id":2969},"c-风格的随机数",[2971],{"type":178,"value":2972},"C++ 风格的随机数",{"type":172,"tag":186,"props":2974,"children":2975},{},[2976],{"type":178,"value":2977},"一个有意思的地方时，KDB 代码中随处可见 C 编程风格的源码。但是测试用例中生成随机数确实 C++ 风格的。",{"type":172,"tag":252,"props":2979,"children":2981},{"code":2980,"language":255,"meta":166,"className":256,"style":166},"std::mt19937 generator = std::mt19937();\nstd::uniform_int_distribution\u003Cint> random_dist(0,255);\n// ...\nfor (int i = 0; i \u003C size; i++) {\n  str[i] = static_cast\u003Cchar>(random_dist(generator));\n}\n",[2982],{"type":172,"tag":259,"props":2983,"children":2984},{"__ignoreMap":166},[2985,3022,3077,3085,3153,3216],{"type":172,"tag":263,"props":2986,"children":2987},{"class":265,"line":266},[2988,2992,2996,3001,3005,3009,3013,3018],{"type":172,"tag":263,"props":2989,"children":2990},{"style":333},[2991],{"type":178,"value":2714},{"type":172,"tag":263,"props":2993,"children":2994},{"style":318},[2995],{"type":178,"value":341},{"type":172,"tag":263,"props":2997,"children":2998},{"style":344},[2999],{"type":178,"value":3000},"mt19937 generator ",{"type":172,"tag":263,"props":3002,"children":3003},{"style":442},[3004],{"type":178,"value":445},{"type":172,"tag":263,"props":3006,"children":3007},{"style":333},[3008],{"type":178,"value":2744},{"type":172,"tag":263,"props":3010,"children":3011},{"style":318},[3012],{"type":178,"value":341},{"type":172,"tag":263,"props":3014,"children":3015},{"style":312},[3016],{"type":178,"value":3017},"mt19937",{"type":172,"tag":263,"props":3019,"children":3020},{"style":318},[3021],{"type":178,"value":465},{"type":172,"tag":263,"props":3023,"children":3024},{"class":265,"line":293},[3025,3029,3033,3038,3043,3047,3051,3056,3060,3064,3068,3073],{"type":172,"tag":263,"props":3026,"children":3027},{"style":333},[3028],{"type":178,"value":2714},{"type":172,"tag":263,"props":3030,"children":3031},{"style":318},[3032],{"type":178,"value":341},{"type":172,"tag":263,"props":3034,"children":3035},{"style":333},[3036],{"type":178,"value":3037},"uniform_int_distribution",{"type":172,"tag":263,"props":3039,"children":3040},{"style":318},[3041],{"type":178,"value":3042},"\u003C",{"type":172,"tag":263,"props":3044,"children":3045},{"style":306},[3046],{"type":178,"value":309},{"type":172,"tag":263,"props":3048,"children":3049},{"style":318},[3050],{"type":178,"value":2250},{"type":172,"tag":263,"props":3052,"children":3053},{"style":312},[3054],{"type":178,"value":3055}," random_dist",{"type":172,"tag":263,"props":3057,"children":3058},{"style":318},[3059],{"type":178,"value":400},{"type":172,"tag":263,"props":3061,"children":3062},{"style":604},[3063],{"type":178,"value":2767},{"type":172,"tag":263,"props":3065,"children":3066},{"style":318},[3067],{"type":178,"value":410},{"type":172,"tag":263,"props":3069,"children":3070},{"style":604},[3071],{"type":178,"value":3072},"255",{"type":172,"tag":263,"props":3074,"children":3075},{"style":318},[3076],{"type":178,"value":430},{"type":172,"tag":263,"props":3078,"children":3079},{"class":265,"line":302},[3080],{"type":172,"tag":263,"props":3081,"children":3082},{"style":1272},[3083],{"type":178,"value":3084},"// ...\n",{"type":172,"tag":263,"props":3086,"children":3087},{"class":265,"line":329},[3088,3093,3097,3101,3106,3110,3114,3118,3122,3126,3131,3135,3140,3145,3149],{"type":172,"tag":263,"props":3089,"children":3090},{"style":270},[3091],{"type":178,"value":3092},"for",{"type":172,"tag":263,"props":3094,"children":3095},{"style":318},[3096],{"type":178,"value":479},{"type":172,"tag":263,"props":3098,"children":3099},{"style":306},[3100],{"type":178,"value":309},{"type":172,"tag":263,"props":3102,"children":3103},{"style":344},[3104],{"type":178,"value":3105}," i ",{"type":172,"tag":263,"props":3107,"children":3108},{"style":442},[3109],{"type":178,"value":445},{"type":172,"tag":263,"props":3111,"children":3112},{"style":604},[3113],{"type":178,"value":1096},{"type":172,"tag":263,"props":3115,"children":3116},{"style":318},[3117],{"type":178,"value":1835},{"type":172,"tag":263,"props":3119,"children":3120},{"style":344},[3121],{"type":178,"value":3105},{"type":172,"tag":263,"props":3123,"children":3124},{"style":442},[3125],{"type":178,"value":3042},{"type":172,"tag":263,"props":3127,"children":3128},{"style":344},[3129],{"type":178,"value":3130}," size",{"type":172,"tag":263,"props":3132,"children":3133},{"style":318},[3134],{"type":178,"value":1835},{"type":172,"tag":263,"props":3136,"children":3137},{"style":344},[3138],{"type":178,"value":3139}," i",{"type":172,"tag":263,"props":3141,"children":3142},{"style":442},[3143],{"type":178,"value":3144},"++",{"type":172,"tag":263,"props":3146,"children":3147},{"style":318},[3148],{"type":178,"value":967},{"type":172,"tag":263,"props":3150,"children":3151},{"style":318},[3152],{"type":178,"value":326},{"type":172,"tag":263,"props":3154,"children":3155},{"class":265,"line":355},[3156,3161,3165,3170,3175,3179,3184,3189,3193,3197,3202,3206,3211],{"type":172,"tag":263,"props":3157,"children":3158},{"style":344},[3159],{"type":178,"value":3160},"  str",{"type":172,"tag":263,"props":3162,"children":3163},{"style":318},[3164],{"type":178,"value":1239},{"type":172,"tag":263,"props":3166,"children":3167},{"style":523},[3168],{"type":178,"value":3169},"i",{"type":172,"tag":263,"props":3171,"children":3172},{"style":318},[3173],{"type":178,"value":3174},"]",{"type":172,"tag":263,"props":3176,"children":3177},{"style":442},[3178],{"type":178,"value":1929},{"type":172,"tag":263,"props":3180,"children":3181},{"style":442},[3182],{"type":178,"value":3183}," static_cast\u003C",{"type":172,"tag":263,"props":3185,"children":3186},{"style":306},[3187],{"type":178,"value":3188},"char",{"type":172,"tag":263,"props":3190,"children":3191},{"style":442},[3192],{"type":178,"value":2250},{"type":172,"tag":263,"props":3194,"children":3195},{"style":318},[3196],{"type":178,"value":400},{"type":172,"tag":263,"props":3198,"children":3199},{"style":312},[3200],{"type":178,"value":3201},"random_dist",{"type":172,"tag":263,"props":3203,"children":3204},{"style":318},[3205],{"type":178,"value":400},{"type":172,"tag":263,"props":3207,"children":3208},{"style":523},[3209],{"type":178,"value":3210},"generator",{"type":172,"tag":263,"props":3212,"children":3213},{"style":318},[3214],{"type":178,"value":3215},"));\n",{"type":172,"tag":263,"props":3217,"children":3218},{"class":265,"line":376},[3219],{"type":172,"tag":263,"props":3220,"children":3221},{"style":318},[3222],{"type":178,"value":1109},{"type":172,"tag":180,"props":3224,"children":3226},{"id":3225},"接口层",[3227],{"type":178,"value":3225},{"type":172,"tag":186,"props":3229,"children":3230},{},[3231,3233,3239],{"type":178,"value":3232},"接口的声明位于 interface/kingdb.h，实现则是 interface/kingdb.cc。KingDB 类给 Database 和 Snapshot 定义了要求实现的 Get、Put、Delete、NewIterater、Open、Close、Flush、Compact、NewMultipartReader 接口。KDB 有自己的数据传输格式 ByteArray，诸如 Get、Put 这些接口在 KingDB 类中对应方法得到了重载，以实现通过 std::string 来传递键、值或者两者，可视为为接受 ByteArray 的方法的包装。所有数据库操作方法都返回 Status 对象，相关异常部分的简介见",{"type":172,"tag":197,"props":3234,"children":3236},{"href":3235},"#%E5%BC%82%E5%B8%B8%E4%B8%8E%E6%97%A5%E5%BF%97",[3237],{"type":178,"value":3238},"异常与日志",{"type":178,"value":3240},"小节。",{"type":172,"tag":186,"props":3242,"children":3243},{},[3244],{"type":178,"value":3245},"重载方法的实现示例如下，即先把 std::string 转回 ByteArray 再调用子类（Database 或 Snapshot）的实现。",{"type":172,"tag":252,"props":3247,"children":3249},{"code":3248,"language":255,"meta":166,"className":256,"style":166},"virtual Status Put(WriteOptions& write_options, const std::string& key, const std::string& chunk) {\n  ByteArray byte_array_key = NewDeepCopyByteArray(key.c_str(), key.size());\n  ByteArray byte_array_chunk = NewDeepCopyByteArray(chunk.c_str(), chunk.size());\n  return Put(write_options, byte_array_key, byte_array_chunk);\n}\n",[3250],{"type":172,"tag":259,"props":3251,"children":3252},{"__ignoreMap":166},[3253,3356,3412,3465,3506],{"type":172,"tag":263,"props":3254,"children":3255},{"class":265,"line":266},[3256,3261,3266,3271,3275,3280,3284,3289,3293,3297,3301,3305,3310,3314,3319,3323,3327,3331,3335,3339,3343,3348,3352],{"type":172,"tag":263,"props":3257,"children":3258},{"style":1770},[3259],{"type":178,"value":3260},"virtual",{"type":172,"tag":263,"props":3262,"children":3263},{"style":333},[3264],{"type":178,"value":3265}," Status",{"type":172,"tag":263,"props":3267,"children":3268},{"style":312},[3269],{"type":178,"value":3270}," Put",{"type":172,"tag":263,"props":3272,"children":3273},{"style":318},[3274],{"type":178,"value":400},{"type":172,"tag":263,"props":3276,"children":3277},{"style":333},[3278],{"type":178,"value":3279},"WriteOptions",{"type":172,"tag":263,"props":3281,"children":3282},{"style":1770},[3283],{"type":178,"value":2268},{"type":172,"tag":263,"props":3285,"children":3286},{"style":1179},[3287],{"type":178,"value":3288}," write_options",{"type":172,"tag":263,"props":3290,"children":3291},{"style":318},[3292],{"type":178,"value":410},{"type":172,"tag":263,"props":3294,"children":3295},{"style":1770},[3296],{"type":178,"value":2304},{"type":172,"tag":263,"props":3298,"children":3299},{"style":333},[3300],{"type":178,"value":2744},{"type":172,"tag":263,"props":3302,"children":3303},{"style":318},[3304],{"type":178,"value":341},{"type":172,"tag":263,"props":3306,"children":3307},{"style":333},[3308],{"type":178,"value":3309},"string",{"type":172,"tag":263,"props":3311,"children":3312},{"style":1770},[3313],{"type":178,"value":2268},{"type":172,"tag":263,"props":3315,"children":3316},{"style":1179},[3317],{"type":178,"value":3318}," key",{"type":172,"tag":263,"props":3320,"children":3321},{"style":318},[3322],{"type":178,"value":410},{"type":172,"tag":263,"props":3324,"children":3325},{"style":1770},[3326],{"type":178,"value":2304},{"type":172,"tag":263,"props":3328,"children":3329},{"style":333},[3330],{"type":178,"value":2744},{"type":172,"tag":263,"props":3332,"children":3333},{"style":318},[3334],{"type":178,"value":341},{"type":172,"tag":263,"props":3336,"children":3337},{"style":333},[3338],{"type":178,"value":3309},{"type":172,"tag":263,"props":3340,"children":3341},{"style":1770},[3342],{"type":178,"value":2268},{"type":172,"tag":263,"props":3344,"children":3345},{"style":1179},[3346],{"type":178,"value":3347}," chunk",{"type":172,"tag":263,"props":3349,"children":3350},{"style":318},[3351],{"type":178,"value":967},{"type":172,"tag":263,"props":3353,"children":3354},{"style":318},[3355],{"type":178,"value":326},{"type":172,"tag":263,"props":3357,"children":3358},{"class":265,"line":293},[3359,3364,3368,3373,3377,3382,3386,3390,3395,3399,3403,3408],{"type":172,"tag":263,"props":3360,"children":3361},{"style":344},[3362],{"type":178,"value":3363},"  ByteArray byte_array_key ",{"type":172,"tag":263,"props":3365,"children":3366},{"style":442},[3367],{"type":178,"value":445},{"type":172,"tag":263,"props":3369,"children":3370},{"style":312},[3371],{"type":178,"value":3372}," NewDeepCopyByteArray",{"type":172,"tag":263,"props":3374,"children":3375},{"style":318},[3376],{"type":178,"value":400},{"type":172,"tag":263,"props":3378,"children":3379},{"style":344},[3380],{"type":178,"value":3381},"key",{"type":172,"tag":263,"props":3383,"children":3384},{"style":318},[3385],{"type":178,"value":455},{"type":172,"tag":263,"props":3387,"children":3388},{"style":312},[3389],{"type":178,"value":583},{"type":172,"tag":263,"props":3391,"children":3392},{"style":318},[3393],{"type":178,"value":3394},"(),",{"type":172,"tag":263,"props":3396,"children":3397},{"style":344},[3398],{"type":178,"value":3318},{"type":172,"tag":263,"props":3400,"children":3401},{"style":318},[3402],{"type":178,"value":455},{"type":172,"tag":263,"props":3404,"children":3405},{"style":312},[3406],{"type":178,"value":3407},"size",{"type":172,"tag":263,"props":3409,"children":3410},{"style":318},[3411],{"type":178,"value":588},{"type":172,"tag":263,"props":3413,"children":3414},{"class":265,"line":302},[3415,3420,3424,3428,3432,3437,3441,3445,3449,3453,3457,3461],{"type":172,"tag":263,"props":3416,"children":3417},{"style":344},[3418],{"type":178,"value":3419},"  ByteArray byte_array_chunk ",{"type":172,"tag":263,"props":3421,"children":3422},{"style":442},[3423],{"type":178,"value":445},{"type":172,"tag":263,"props":3425,"children":3426},{"style":312},[3427],{"type":178,"value":3372},{"type":172,"tag":263,"props":3429,"children":3430},{"style":318},[3431],{"type":178,"value":400},{"type":172,"tag":263,"props":3433,"children":3434},{"style":344},[3435],{"type":178,"value":3436},"chunk",{"type":172,"tag":263,"props":3438,"children":3439},{"style":318},[3440],{"type":178,"value":455},{"type":172,"tag":263,"props":3442,"children":3443},{"style":312},[3444],{"type":178,"value":583},{"type":172,"tag":263,"props":3446,"children":3447},{"style":318},[3448],{"type":178,"value":3394},{"type":172,"tag":263,"props":3450,"children":3451},{"style":344},[3452],{"type":178,"value":3347},{"type":172,"tag":263,"props":3454,"children":3455},{"style":318},[3456],{"type":178,"value":455},{"type":172,"tag":263,"props":3458,"children":3459},{"style":312},[3460],{"type":178,"value":3407},{"type":172,"tag":263,"props":3462,"children":3463},{"style":318},[3464],{"type":178,"value":588},{"type":172,"tag":263,"props":3466,"children":3467},{"class":265,"line":329},[3468,3472,3476,3480,3484,3488,3493,3497,3502],{"type":172,"tag":263,"props":3469,"children":3470},{"style":270},[3471],{"type":178,"value":1091},{"type":172,"tag":263,"props":3473,"children":3474},{"style":312},[3475],{"type":178,"value":3270},{"type":172,"tag":263,"props":3477,"children":3478},{"style":318},[3479],{"type":178,"value":400},{"type":172,"tag":263,"props":3481,"children":3482},{"style":344},[3483],{"type":178,"value":775},{"type":172,"tag":263,"props":3485,"children":3486},{"style":318},[3487],{"type":178,"value":410},{"type":172,"tag":263,"props":3489,"children":3490},{"style":344},[3491],{"type":178,"value":3492}," byte_array_key",{"type":172,"tag":263,"props":3494,"children":3495},{"style":318},[3496],{"type":178,"value":410},{"type":172,"tag":263,"props":3498,"children":3499},{"style":344},[3500],{"type":178,"value":3501}," byte_array_chunk",{"type":172,"tag":263,"props":3503,"children":3504},{"style":318},[3505],{"type":178,"value":430},{"type":172,"tag":263,"props":3507,"children":3508},{"class":265,"line":355},[3509],{"type":172,"tag":263,"props":3510,"children":3511},{"style":318},[3512],{"type":178,"value":1109},{"type":172,"tag":1139,"props":3514,"children":3516},{"id":3515},"数据库开关",[3517],{"type":178,"value":3515},{"type":172,"tag":186,"props":3519,"children":3520},{},[3521],{"type":178,"value":3522},"数据库的开启与关闭，分别对应 Database 类的 Open 和 Close 方法。开启时，通过 stat 库函数找到数据库路径以及配置文件，使用 open 库函数获取其文件描述符。配置文件须先用 flock 锁住，使用 mmap 映射后再读取；如果没有那么分情况写入。之后，创建好 EventManager、WriteBuffer 和 StorageEngine 的实例，就完成了。关闭时过程类似，锁定住配置文件后再关闭，同时删除以上创建的实例。可以发现，资源申请全放在了 Open 中，而资源的销毁放在了 Close 中，而 Database 类析构时会自动调用 Close，所以这是一个类似 RAII 的资源管理过程。",{"type":172,"tag":252,"props":3524,"children":3526},{"code":3525,"language":255,"meta":166,"className":256,"style":166},"class Database: public KingDB {\n  virtual ~Database() { Close(); }\n  virtual Status Open() override {\n    std::string filepath_dboptions = DatabaseOptions::GetPath(dbname_);\n    fd_dboptions_ = open(filepath_dboptions.c_str(), O_RDONLY, 0644);\n    flock(fd_dboptions_, LOCK_EX | LOCK_NB);\n    Mmap mmap(filepath_dboptions, info.st_size);\n    Status status_dboptions = DatabaseOptionEncoder::DecodeFrom(mmap.datafile(), mmap.filesize(), &db_options_candidate);\n    // ...\n    em_ = new EventManager();\n    wb_ = new WriteBuffer(db_options_, em_);\n    se_ = new StorageEngine(db_options_, em_, dbname_);\n    return Status::OK(); \n  }\n  virtual void Close() override {\n    flock(fd_dboptions_, LOCK_UN);\n    close(fd_dboptions_);\n    wb_->Close();\n    se_->Close();\n    delete wb_;\n    delete se_;\n    delete em_;\n  }\n}\n",[3527],{"type":172,"tag":259,"props":3528,"children":3529},{"__ignoreMap":166},[3530,3559,3594,3623,3671,3732,3772,3815,3893,3901,3927,3970,4020,4048,4055,4082,4110,4130,4152,4172,4189,4205,4220,4227],{"type":172,"tag":263,"props":3531,"children":3532},{"class":265,"line":266},[3533,3537,3542,3546,3550,3555],{"type":172,"tag":263,"props":3534,"children":3535},{"style":306},[3536],{"type":178,"value":1683},{"type":172,"tag":263,"props":3538,"children":3539},{"style":333},[3540],{"type":178,"value":3541}," Database",{"type":172,"tag":263,"props":3543,"children":3544},{"style":318},[3545],{"type":178,"value":1368},{"type":172,"tag":263,"props":3547,"children":3548},{"style":306},[3549],{"type":178,"value":1732},{"type":172,"tag":263,"props":3551,"children":3552},{"style":333},[3553],{"type":178,"value":3554}," KingDB",{"type":172,"tag":263,"props":3556,"children":3557},{"style":318},[3558],{"type":178,"value":326},{"type":172,"tag":263,"props":3560,"children":3561},{"class":265,"line":293},[3562,3567,3572,3576,3580,3585,3589],{"type":172,"tag":263,"props":3563,"children":3564},{"style":1770},[3565],{"type":178,"value":3566},"  virtual",{"type":172,"tag":263,"props":3568,"children":3569},{"style":312},[3570],{"type":178,"value":3571}," ~Database",{"type":172,"tag":263,"props":3573,"children":3574},{"style":318},[3575],{"type":178,"value":321},{"type":172,"tag":263,"props":3577,"children":3578},{"style":318},[3579],{"type":178,"value":1792},{"type":172,"tag":263,"props":3581,"children":3582},{"style":312},[3583],{"type":178,"value":3584}," Close",{"type":172,"tag":263,"props":3586,"children":3587},{"style":318},[3588],{"type":178,"value":1759},{"type":172,"tag":263,"props":3590,"children":3591},{"style":318},[3592],{"type":178,"value":3593}," }\n",{"type":172,"tag":263,"props":3595,"children":3596},{"class":265,"line":302},[3597,3601,3605,3610,3614,3619],{"type":172,"tag":263,"props":3598,"children":3599},{"style":1770},[3600],{"type":178,"value":3566},{"type":172,"tag":263,"props":3602,"children":3603},{"style":333},[3604],{"type":178,"value":3265},{"type":172,"tag":263,"props":3606,"children":3607},{"style":312},[3608],{"type":178,"value":3609}," Open",{"type":172,"tag":263,"props":3611,"children":3612},{"style":318},[3613],{"type":178,"value":321},{"type":172,"tag":263,"props":3615,"children":3616},{"style":1770},[3617],{"type":178,"value":3618}," override",{"type":172,"tag":263,"props":3620,"children":3621},{"style":318},[3622],{"type":178,"value":326},{"type":172,"tag":263,"props":3624,"children":3625},{"class":265,"line":329},[3626,3631,3635,3640,3644,3649,3653,3658,3662,3667],{"type":172,"tag":263,"props":3627,"children":3628},{"style":333},[3629],{"type":178,"value":3630},"    std",{"type":172,"tag":263,"props":3632,"children":3633},{"style":318},[3634],{"type":178,"value":341},{"type":172,"tag":263,"props":3636,"children":3637},{"style":523},[3638],{"type":178,"value":3639},"string filepath_dboptions ",{"type":172,"tag":263,"props":3641,"children":3642},{"style":442},[3643],{"type":178,"value":445},{"type":172,"tag":263,"props":3645,"children":3646},{"style":333},[3647],{"type":178,"value":3648}," DatabaseOptions",{"type":172,"tag":263,"props":3650,"children":3651},{"style":318},[3652],{"type":178,"value":341},{"type":172,"tag":263,"props":3654,"children":3655},{"style":312},[3656],{"type":178,"value":3657},"GetPath",{"type":172,"tag":263,"props":3659,"children":3660},{"style":318},[3661],{"type":178,"value":400},{"type":172,"tag":263,"props":3663,"children":3664},{"style":523},[3665],{"type":178,"value":3666},"dbname_",{"type":172,"tag":263,"props":3668,"children":3669},{"style":318},[3670],{"type":178,"value":430},{"type":172,"tag":263,"props":3672,"children":3673},{"class":265,"line":355},[3674,3679,3683,3688,3692,3697,3701,3705,3709,3714,3718,3723,3728],{"type":172,"tag":263,"props":3675,"children":3676},{"style":523},[3677],{"type":178,"value":3678},"    fd_dboptions_ ",{"type":172,"tag":263,"props":3680,"children":3681},{"style":442},[3682],{"type":178,"value":445},{"type":172,"tag":263,"props":3684,"children":3685},{"style":312},[3686],{"type":178,"value":3687}," open",{"type":172,"tag":263,"props":3689,"children":3690},{"style":318},[3691],{"type":178,"value":400},{"type":172,"tag":263,"props":3693,"children":3694},{"style":344},[3695],{"type":178,"value":3696},"filepath_dboptions",{"type":172,"tag":263,"props":3698,"children":3699},{"style":318},[3700],{"type":178,"value":455},{"type":172,"tag":263,"props":3702,"children":3703},{"style":312},[3704],{"type":178,"value":583},{"type":172,"tag":263,"props":3706,"children":3707},{"style":318},[3708],{"type":178,"value":3394},{"type":172,"tag":263,"props":3710,"children":3711},{"style":523},[3712],{"type":178,"value":3713}," O_RDONLY",{"type":172,"tag":263,"props":3715,"children":3716},{"style":318},[3717],{"type":178,"value":410},{"type":172,"tag":263,"props":3719,"children":3721},{"style":3720},"--shiki-light:#F76D47;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[3722],{"type":178,"value":1096},{"type":172,"tag":263,"props":3724,"children":3725},{"style":604},[3726],{"type":178,"value":3727},"644",{"type":172,"tag":263,"props":3729,"children":3730},{"style":318},[3731],{"type":178,"value":430},{"type":172,"tag":263,"props":3733,"children":3734},{"class":265,"line":376},[3735,3740,3744,3749,3753,3758,3763,3768],{"type":172,"tag":263,"props":3736,"children":3737},{"style":312},[3738],{"type":178,"value":3739},"    flock",{"type":172,"tag":263,"props":3741,"children":3742},{"style":318},[3743],{"type":178,"value":400},{"type":172,"tag":263,"props":3745,"children":3746},{"style":523},[3747],{"type":178,"value":3748},"fd_dboptions_",{"type":172,"tag":263,"props":3750,"children":3751},{"style":318},[3752],{"type":178,"value":410},{"type":172,"tag":263,"props":3754,"children":3755},{"style":523},[3756],{"type":178,"value":3757}," LOCK_EX ",{"type":172,"tag":263,"props":3759,"children":3760},{"style":442},[3761],{"type":178,"value":3762},"|",{"type":172,"tag":263,"props":3764,"children":3765},{"style":523},[3766],{"type":178,"value":3767}," LOCK_NB",{"type":172,"tag":263,"props":3769,"children":3770},{"style":318},[3771],{"type":178,"value":430},{"type":172,"tag":263,"props":3773,"children":3774},{"class":265,"line":433},[3775,3780,3785,3789,3793,3797,3802,3806,3811],{"type":172,"tag":263,"props":3776,"children":3777},{"style":523},[3778],{"type":178,"value":3779},"    Mmap ",{"type":172,"tag":263,"props":3781,"children":3782},{"style":312},[3783],{"type":178,"value":3784},"mmap",{"type":172,"tag":263,"props":3786,"children":3787},{"style":318},[3788],{"type":178,"value":400},{"type":172,"tag":263,"props":3790,"children":3791},{"style":523},[3792],{"type":178,"value":3696},{"type":172,"tag":263,"props":3794,"children":3795},{"style":318},[3796],{"type":178,"value":410},{"type":172,"tag":263,"props":3798,"children":3799},{"style":344},[3800],{"type":178,"value":3801}," info",{"type":172,"tag":263,"props":3803,"children":3804},{"style":318},[3805],{"type":178,"value":455},{"type":172,"tag":263,"props":3807,"children":3808},{"style":344},[3809],{"type":178,"value":3810},"st_size",{"type":172,"tag":263,"props":3812,"children":3813},{"style":318},[3814],{"type":178,"value":430},{"type":172,"tag":263,"props":3816,"children":3817},{"class":265,"line":468},[3818,3823,3827,3832,3836,3841,3845,3849,3853,3858,3862,3867,3871,3876,3880,3884,3889],{"type":172,"tag":263,"props":3819,"children":3820},{"style":523},[3821],{"type":178,"value":3822},"    Status status_dboptions ",{"type":172,"tag":263,"props":3824,"children":3825},{"style":442},[3826],{"type":178,"value":445},{"type":172,"tag":263,"props":3828,"children":3829},{"style":333},[3830],{"type":178,"value":3831}," DatabaseOptionEncoder",{"type":172,"tag":263,"props":3833,"children":3834},{"style":318},[3835],{"type":178,"value":341},{"type":172,"tag":263,"props":3837,"children":3838},{"style":312},[3839],{"type":178,"value":3840},"DecodeFrom",{"type":172,"tag":263,"props":3842,"children":3843},{"style":318},[3844],{"type":178,"value":400},{"type":172,"tag":263,"props":3846,"children":3847},{"style":344},[3848],{"type":178,"value":3784},{"type":172,"tag":263,"props":3850,"children":3851},{"style":318},[3852],{"type":178,"value":455},{"type":172,"tag":263,"props":3854,"children":3855},{"style":312},[3856],{"type":178,"value":3857},"datafile",{"type":172,"tag":263,"props":3859,"children":3860},{"style":318},[3861],{"type":178,"value":3394},{"type":172,"tag":263,"props":3863,"children":3864},{"style":344},[3865],{"type":178,"value":3866}," mmap",{"type":172,"tag":263,"props":3868,"children":3869},{"style":318},[3870],{"type":178,"value":455},{"type":172,"tag":263,"props":3872,"children":3873},{"style":312},[3874],{"type":178,"value":3875},"filesize",{"type":172,"tag":263,"props":3877,"children":3878},{"style":318},[3879],{"type":178,"value":3394},{"type":172,"tag":263,"props":3881,"children":3882},{"style":442},[3883],{"type":178,"value":898},{"type":172,"tag":263,"props":3885,"children":3886},{"style":523},[3887],{"type":178,"value":3888},"db_options_candidate",{"type":172,"tag":263,"props":3890,"children":3891},{"style":318},[3892],{"type":178,"value":430},{"type":172,"tag":263,"props":3894,"children":3895},{"class":265,"line":510},[3896],{"type":172,"tag":263,"props":3897,"children":3898},{"style":1272},[3899],{"type":178,"value":3900},"    // ...\n",{"type":172,"tag":263,"props":3902,"children":3903},{"class":265,"line":591},[3904,3909,3913,3918,3923],{"type":172,"tag":263,"props":3905,"children":3906},{"style":523},[3907],{"type":178,"value":3908},"    em_ ",{"type":172,"tag":263,"props":3910,"children":3911},{"style":442},[3912],{"type":178,"value":445},{"type":172,"tag":263,"props":3914,"children":3915},{"style":442},[3916],{"type":178,"value":3917}," new",{"type":172,"tag":263,"props":3919,"children":3920},{"style":312},[3921],{"type":178,"value":3922}," EventManager",{"type":172,"tag":263,"props":3924,"children":3925},{"style":318},[3926],{"type":178,"value":465},{"type":172,"tag":263,"props":3928,"children":3929},{"class":265,"line":614},[3930,3935,3939,3943,3948,3952,3957,3961,3966],{"type":172,"tag":263,"props":3931,"children":3932},{"style":523},[3933],{"type":178,"value":3934},"    wb_ ",{"type":172,"tag":263,"props":3936,"children":3937},{"style":442},[3938],{"type":178,"value":445},{"type":172,"tag":263,"props":3940,"children":3941},{"style":442},[3942],{"type":178,"value":3917},{"type":172,"tag":263,"props":3944,"children":3945},{"style":312},[3946],{"type":178,"value":3947}," WriteBuffer",{"type":172,"tag":263,"props":3949,"children":3950},{"style":318},[3951],{"type":178,"value":400},{"type":172,"tag":263,"props":3953,"children":3954},{"style":523},[3955],{"type":178,"value":3956},"db_options_",{"type":172,"tag":263,"props":3958,"children":3959},{"style":318},[3960],{"type":178,"value":410},{"type":172,"tag":263,"props":3962,"children":3963},{"style":523},[3964],{"type":178,"value":3965}," em_",{"type":172,"tag":263,"props":3967,"children":3968},{"style":318},[3969],{"type":178,"value":430},{"type":172,"tag":263,"props":3971,"children":3972},{"class":265,"line":623},[3973,3978,3982,3986,3991,3995,3999,4003,4007,4011,4016],{"type":172,"tag":263,"props":3974,"children":3975},{"style":523},[3976],{"type":178,"value":3977},"    se_ ",{"type":172,"tag":263,"props":3979,"children":3980},{"style":442},[3981],{"type":178,"value":445},{"type":172,"tag":263,"props":3983,"children":3984},{"style":442},[3985],{"type":178,"value":3917},{"type":172,"tag":263,"props":3987,"children":3988},{"style":312},[3989],{"type":178,"value":3990}," StorageEngine",{"type":172,"tag":263,"props":3992,"children":3993},{"style":318},[3994],{"type":178,"value":400},{"type":172,"tag":263,"props":3996,"children":3997},{"style":523},[3998],{"type":178,"value":3956},{"type":172,"tag":263,"props":4000,"children":4001},{"style":318},[4002],{"type":178,"value":410},{"type":172,"tag":263,"props":4004,"children":4005},{"style":523},[4006],{"type":178,"value":3965},{"type":172,"tag":263,"props":4008,"children":4009},{"style":318},[4010],{"type":178,"value":410},{"type":172,"tag":263,"props":4012,"children":4013},{"style":523},[4014],{"type":178,"value":4015}," dbname_",{"type":172,"tag":263,"props":4017,"children":4018},{"style":318},[4019],{"type":178,"value":430},{"type":172,"tag":263,"props":4021,"children":4022},{"class":265,"line":631},[4023,4027,4031,4035,4040,4044],{"type":172,"tag":263,"props":4024,"children":4025},{"style":270},[4026],{"type":178,"value":2503},{"type":172,"tag":263,"props":4028,"children":4029},{"style":333},[4030],{"type":178,"value":3265},{"type":172,"tag":263,"props":4032,"children":4033},{"style":318},[4034],{"type":178,"value":341},{"type":172,"tag":263,"props":4036,"children":4037},{"style":312},[4038],{"type":178,"value":4039},"OK",{"type":172,"tag":263,"props":4041,"children":4042},{"style":318},[4043],{"type":178,"value":1759},{"type":172,"tag":263,"props":4045,"children":4046},{"style":523},[4047],{"type":178,"value":1011},{"type":172,"tag":263,"props":4049,"children":4050},{"class":265,"line":674},[4051],{"type":172,"tag":263,"props":4052,"children":4053},{"style":318},[4054],{"type":178,"value":620},{"type":172,"tag":263,"props":4056,"children":4057},{"class":265,"line":715},[4058,4062,4066,4070,4074,4078],{"type":172,"tag":263,"props":4059,"children":4060},{"style":1770},[4061],{"type":178,"value":3566},{"type":172,"tag":263,"props":4063,"children":4064},{"style":306},[4065],{"type":178,"value":1778},{"type":172,"tag":263,"props":4067,"children":4068},{"style":312},[4069],{"type":178,"value":3584},{"type":172,"tag":263,"props":4071,"children":4072},{"style":318},[4073],{"type":178,"value":321},{"type":172,"tag":263,"props":4075,"children":4076},{"style":1770},[4077],{"type":178,"value":3618},{"type":172,"tag":263,"props":4079,"children":4080},{"style":318},[4081],{"type":178,"value":326},{"type":172,"tag":263,"props":4083,"children":4084},{"class":265,"line":723},[4085,4089,4093,4097,4101,4106],{"type":172,"tag":263,"props":4086,"children":4087},{"style":312},[4088],{"type":178,"value":3739},{"type":172,"tag":263,"props":4090,"children":4091},{"style":318},[4092],{"type":178,"value":400},{"type":172,"tag":263,"props":4094,"children":4095},{"style":523},[4096],{"type":178,"value":3748},{"type":172,"tag":263,"props":4098,"children":4099},{"style":318},[4100],{"type":178,"value":410},{"type":172,"tag":263,"props":4102,"children":4103},{"style":523},[4104],{"type":178,"value":4105}," LOCK_UN",{"type":172,"tag":263,"props":4107,"children":4108},{"style":318},[4109],{"type":178,"value":430},{"type":172,"tag":263,"props":4111,"children":4112},{"class":265,"line":744},[4113,4118,4122,4126],{"type":172,"tag":263,"props":4114,"children":4115},{"style":312},[4116],{"type":178,"value":4117},"    close",{"type":172,"tag":263,"props":4119,"children":4120},{"style":318},[4121],{"type":178,"value":400},{"type":172,"tag":263,"props":4123,"children":4124},{"style":523},[4125],{"type":178,"value":3748},{"type":172,"tag":263,"props":4127,"children":4128},{"style":318},[4129],{"type":178,"value":430},{"type":172,"tag":263,"props":4131,"children":4132},{"class":265,"line":800},[4133,4138,4143,4148],{"type":172,"tag":263,"props":4134,"children":4135},{"style":344},[4136],{"type":178,"value":4137},"    wb_",{"type":172,"tag":263,"props":4139,"children":4140},{"style":318},[4141],{"type":178,"value":4142},"->",{"type":172,"tag":263,"props":4144,"children":4145},{"style":312},[4146],{"type":178,"value":4147},"Close",{"type":172,"tag":263,"props":4149,"children":4150},{"style":318},[4151],{"type":178,"value":465},{"type":172,"tag":263,"props":4153,"children":4154},{"class":265,"line":808},[4155,4160,4164,4168],{"type":172,"tag":263,"props":4156,"children":4157},{"style":344},[4158],{"type":178,"value":4159},"    se_",{"type":172,"tag":263,"props":4161,"children":4162},{"style":318},[4163],{"type":178,"value":4142},{"type":172,"tag":263,"props":4165,"children":4166},{"style":312},[4167],{"type":178,"value":4147},{"type":172,"tag":263,"props":4169,"children":4170},{"style":318},[4171],{"type":178,"value":465},{"type":172,"tag":263,"props":4173,"children":4174},{"class":265,"line":829},[4175,4180,4185],{"type":172,"tag":263,"props":4176,"children":4177},{"style":442},[4178],{"type":178,"value":4179},"    delete",{"type":172,"tag":263,"props":4181,"children":4182},{"style":523},[4183],{"type":178,"value":4184}," wb_",{"type":172,"tag":263,"props":4186,"children":4187},{"style":318},[4188],{"type":178,"value":352},{"type":172,"tag":263,"props":4190,"children":4191},{"class":265,"line":850},[4192,4196,4201],{"type":172,"tag":263,"props":4193,"children":4194},{"style":442},[4195],{"type":178,"value":4179},{"type":172,"tag":263,"props":4197,"children":4198},{"style":523},[4199],{"type":178,"value":4200}," se_",{"type":172,"tag":263,"props":4202,"children":4203},{"style":318},[4204],{"type":178,"value":352},{"type":172,"tag":263,"props":4206,"children":4207},{"class":265,"line":910},[4208,4212,4216],{"type":172,"tag":263,"props":4209,"children":4210},{"style":442},[4211],{"type":178,"value":4179},{"type":172,"tag":263,"props":4213,"children":4214},{"style":523},[4215],{"type":178,"value":3965},{"type":172,"tag":263,"props":4217,"children":4218},{"style":318},[4219],{"type":178,"value":352},{"type":172,"tag":263,"props":4221,"children":4222},{"class":265,"line":974},[4223],{"type":172,"tag":263,"props":4224,"children":4225},{"style":318},[4226],{"type":178,"value":620},{"type":172,"tag":263,"props":4228,"children":4229},{"class":265,"line":1014},[4230],{"type":172,"tag":263,"props":4231,"children":4232},{"style":318},[4233],{"type":178,"value":1109},{"type":172,"tag":186,"props":4235,"children":4236},{},[4237],{"type":178,"value":4238},"因为数据库不能同时关闭或是开启，所以 Open 以及 Close 中都使用了 std::unique_lock 进行锁定。",{"type":172,"tag":252,"props":4240,"children":4242},{"code":4241,"language":255,"meta":166,"className":256,"style":166},"virtual Status Open() override {\n  std::unique_lock\u003Cstd::mutex> lock(mutex_close_);\n}\nvirtual void Close() override {\n  std::unique_lock\u003Cstd::mutex> lock(mutex_close_);\n}\n",[4243],{"type":172,"tag":259,"props":4244,"children":4245},{"__ignoreMap":166},[4246,4273,4328,4335,4362,4413],{"type":172,"tag":263,"props":4247,"children":4248},{"class":265,"line":266},[4249,4253,4257,4261,4265,4269],{"type":172,"tag":263,"props":4250,"children":4251},{"style":1770},[4252],{"type":178,"value":3260},{"type":172,"tag":263,"props":4254,"children":4255},{"style":333},[4256],{"type":178,"value":3265},{"type":172,"tag":263,"props":4258,"children":4259},{"style":312},[4260],{"type":178,"value":3609},{"type":172,"tag":263,"props":4262,"children":4263},{"style":318},[4264],{"type":178,"value":321},{"type":172,"tag":263,"props":4266,"children":4267},{"style":1770},[4268],{"type":178,"value":3618},{"type":172,"tag":263,"props":4270,"children":4271},{"style":318},[4272],{"type":178,"value":326},{"type":172,"tag":263,"props":4274,"children":4275},{"class":265,"line":293},[4276,4280,4284,4289,4293,4297,4301,4306,4310,4315,4319,4324],{"type":172,"tag":263,"props":4277,"children":4278},{"style":333},[4279],{"type":178,"value":637},{"type":172,"tag":263,"props":4281,"children":4282},{"style":318},[4283],{"type":178,"value":341},{"type":172,"tag":263,"props":4285,"children":4286},{"style":344},[4287],{"type":178,"value":4288},"unique_lock",{"type":172,"tag":263,"props":4290,"children":4291},{"style":442},[4292],{"type":178,"value":3042},{"type":172,"tag":263,"props":4294,"children":4295},{"style":333},[4296],{"type":178,"value":2714},{"type":172,"tag":263,"props":4298,"children":4299},{"style":318},[4300],{"type":178,"value":341},{"type":172,"tag":263,"props":4302,"children":4303},{"style":344},[4304],{"type":178,"value":4305},"mutex",{"type":172,"tag":263,"props":4307,"children":4308},{"style":442},[4309],{"type":178,"value":2250},{"type":172,"tag":263,"props":4311,"children":4312},{"style":312},[4313],{"type":178,"value":4314}," lock",{"type":172,"tag":263,"props":4316,"children":4317},{"style":318},[4318],{"type":178,"value":400},{"type":172,"tag":263,"props":4320,"children":4321},{"style":344},[4322],{"type":178,"value":4323},"mutex_close_",{"type":172,"tag":263,"props":4325,"children":4326},{"style":318},[4327],{"type":178,"value":430},{"type":172,"tag":263,"props":4329,"children":4330},{"class":265,"line":302},[4331],{"type":172,"tag":263,"props":4332,"children":4333},{"style":318},[4334],{"type":178,"value":1109},{"type":172,"tag":263,"props":4336,"children":4337},{"class":265,"line":329},[4338,4342,4346,4350,4354,4358],{"type":172,"tag":263,"props":4339,"children":4340},{"style":1770},[4341],{"type":178,"value":3260},{"type":172,"tag":263,"props":4343,"children":4344},{"style":306},[4345],{"type":178,"value":1778},{"type":172,"tag":263,"props":4347,"children":4348},{"style":312},[4349],{"type":178,"value":3584},{"type":172,"tag":263,"props":4351,"children":4352},{"style":318},[4353],{"type":178,"value":321},{"type":172,"tag":263,"props":4355,"children":4356},{"style":1770},[4357],{"type":178,"value":3618},{"type":172,"tag":263,"props":4359,"children":4360},{"style":318},[4361],{"type":178,"value":326},{"type":172,"tag":263,"props":4363,"children":4364},{"class":265,"line":355},[4365,4369,4373,4377,4381,4385,4389,4393,4397,4401,4405,4409],{"type":172,"tag":263,"props":4366,"children":4367},{"style":333},[4368],{"type":178,"value":637},{"type":172,"tag":263,"props":4370,"children":4371},{"style":318},[4372],{"type":178,"value":341},{"type":172,"tag":263,"props":4374,"children":4375},{"style":344},[4376],{"type":178,"value":4288},{"type":172,"tag":263,"props":4378,"children":4379},{"style":442},[4380],{"type":178,"value":3042},{"type":172,"tag":263,"props":4382,"children":4383},{"style":333},[4384],{"type":178,"value":2714},{"type":172,"tag":263,"props":4386,"children":4387},{"style":318},[4388],{"type":178,"value":341},{"type":172,"tag":263,"props":4390,"children":4391},{"style":344},[4392],{"type":178,"value":4305},{"type":172,"tag":263,"props":4394,"children":4395},{"style":442},[4396],{"type":178,"value":2250},{"type":172,"tag":263,"props":4398,"children":4399},{"style":312},[4400],{"type":178,"value":4314},{"type":172,"tag":263,"props":4402,"children":4403},{"style":318},[4404],{"type":178,"value":400},{"type":172,"tag":263,"props":4406,"children":4407},{"style":344},[4408],{"type":178,"value":4323},{"type":172,"tag":263,"props":4410,"children":4411},{"style":318},[4412],{"type":178,"value":430},{"type":172,"tag":263,"props":4414,"children":4415},{"class":265,"line":376},[4416],{"type":172,"tag":263,"props":4417,"children":4418},{"style":318},[4419],{"type":178,"value":1109},{"type":172,"tag":180,"props":4421,"children":4422},{"id":3238},[4423],{"type":178,"value":3238},{"type":172,"tag":186,"props":4425,"children":4426},{},[4427],{"type":178,"value":4428},"代码没有使用 C++ 风格的异常捕获，取而代之的是设计了状态类 Status。就像 kingdb_user 示例展示的，所有数据库操作都会返回一个状态实例，通过调用其 IsOK 方法，调用者可以判断处出操作有没有成功；如果失败了，可以使用 ToString 方法把出错原因输出。尽管这种设计会带来额外的内存开销，且使每次调用都带来轻微的性能消耗，不过这种消耗可以避免魔法数值，它将错误码和核心解耦，使代码有更佳的可读性。",{"type":172,"tag":252,"props":4430,"children":4432},{"code":4431,"language":255,"meta":166,"className":256,"style":166},"class Status {\n  // ...\n  static Status OK() { return Status(); }\n  bool IsOK() const { return (code_ == kOK); }\n  // ...\n  enum Code {\n    kOK = 0, \n    kNotFound = 1,\n    kDeleteOrder = 2,\n    kInvalidArgument = 3,\n    kIOError = 4,\n    kDone = 5,\n    kMultipartRequired = 6\n  };\n  // ...\n}\nstd::string Status::ToString() const {\n  if (message1_ == \"\") {\n    return \"OK\";\n  } else {\n    char tmp[30];\n    const char* type;\n    switch (code()) {\n      case kOK:\n        type = \"OK\";\n        break;\n      // ...\n    }\n    // ...\n    return result;\n  }\n}\n",[4433],{"type":172,"tag":259,"props":4434,"children":4435},{"__ignoreMap":166},[4436,4451,4458,4499,4554,4561,4578,4603,4624,4645,4666,4687,4708,4725,4733,4740,4747,4786,4819,4842,4857,4883,4910,4934,4951,4979,4991,4999,5007,5014,5031,5039],{"type":172,"tag":263,"props":4437,"children":4438},{"class":265,"line":266},[4439,4443,4447],{"type":172,"tag":263,"props":4440,"children":4441},{"style":306},[4442],{"type":178,"value":1683},{"type":172,"tag":263,"props":4444,"children":4445},{"style":333},[4446],{"type":178,"value":3265},{"type":172,"tag":263,"props":4448,"children":4449},{"style":318},[4450],{"type":178,"value":326},{"type":172,"tag":263,"props":4452,"children":4453},{"class":265,"line":293},[4454],{"type":172,"tag":263,"props":4455,"children":4456},{"style":1272},[4457],{"type":178,"value":1628},{"type":172,"tag":263,"props":4459,"children":4460},{"class":265,"line":302},[4461,4465,4469,4474,4478,4482,4487,4491,4495],{"type":172,"tag":263,"props":4462,"children":4463},{"style":1770},[4464],{"type":178,"value":1773},{"type":172,"tag":263,"props":4466,"children":4467},{"style":333},[4468],{"type":178,"value":3265},{"type":172,"tag":263,"props":4470,"children":4471},{"style":312},[4472],{"type":178,"value":4473}," OK",{"type":172,"tag":263,"props":4475,"children":4476},{"style":318},[4477],{"type":178,"value":321},{"type":172,"tag":263,"props":4479,"children":4480},{"style":318},[4481],{"type":178,"value":1792},{"type":172,"tag":263,"props":4483,"children":4484},{"style":270},[4485],{"type":178,"value":4486}," return",{"type":172,"tag":263,"props":4488,"children":4489},{"style":312},[4490],{"type":178,"value":3265},{"type":172,"tag":263,"props":4492,"children":4493},{"style":318},[4494],{"type":178,"value":1759},{"type":172,"tag":263,"props":4496,"children":4497},{"style":318},[4498],{"type":178,"value":3593},{"type":172,"tag":263,"props":4500,"children":4501},{"class":265,"line":329},[4502,4507,4512,4516,4520,4524,4528,4532,4537,4541,4546,4550],{"type":172,"tag":263,"props":4503,"children":4504},{"style":306},[4505],{"type":178,"value":4506},"  bool",{"type":172,"tag":263,"props":4508,"children":4509},{"style":312},[4510],{"type":178,"value":4511}," IsOK",{"type":172,"tag":263,"props":4513,"children":4514},{"style":318},[4515],{"type":178,"value":321},{"type":172,"tag":263,"props":4517,"children":4518},{"style":1770},[4519],{"type":178,"value":2304},{"type":172,"tag":263,"props":4521,"children":4522},{"style":318},[4523],{"type":178,"value":1792},{"type":172,"tag":263,"props":4525,"children":4526},{"style":270},[4527],{"type":178,"value":4486},{"type":172,"tag":263,"props":4529,"children":4530},{"style":318},[4531],{"type":178,"value":479},{"type":172,"tag":263,"props":4533,"children":4534},{"style":523},[4535],{"type":178,"value":4536},"code_ ",{"type":172,"tag":263,"props":4538,"children":4539},{"style":442},[4540],{"type":178,"value":950},{"type":172,"tag":263,"props":4542,"children":4543},{"style":523},[4544],{"type":178,"value":4545}," kOK",{"type":172,"tag":263,"props":4547,"children":4548},{"style":318},[4549],{"type":178,"value":1006},{"type":172,"tag":263,"props":4551,"children":4552},{"style":318},[4553],{"type":178,"value":3593},{"type":172,"tag":263,"props":4555,"children":4556},{"class":265,"line":355},[4557],{"type":172,"tag":263,"props":4558,"children":4559},{"style":1272},[4560],{"type":178,"value":1628},{"type":172,"tag":263,"props":4562,"children":4563},{"class":265,"line":376},[4564,4569,4574],{"type":172,"tag":263,"props":4565,"children":4566},{"style":306},[4567],{"type":178,"value":4568},"  enum",{"type":172,"tag":263,"props":4570,"children":4571},{"style":333},[4572],{"type":178,"value":4573}," Code",{"type":172,"tag":263,"props":4575,"children":4576},{"style":318},[4577],{"type":178,"value":326},{"type":172,"tag":263,"props":4579,"children":4580},{"class":265,"line":433},[4581,4587,4591,4595,4599],{"type":172,"tag":263,"props":4582,"children":4584},{"style":4583},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#F8F8F2",[4585],{"type":178,"value":4586},"    kOK",{"type":172,"tag":263,"props":4588,"children":4589},{"style":442},[4590],{"type":178,"value":1929},{"type":172,"tag":263,"props":4592,"children":4593},{"style":604},[4594],{"type":178,"value":1096},{"type":172,"tag":263,"props":4596,"children":4597},{"style":318},[4598],{"type":178,"value":410},{"type":172,"tag":263,"props":4600,"children":4601},{"style":523},[4602],{"type":178,"value":1011},{"type":172,"tag":263,"props":4604,"children":4605},{"class":265,"line":468},[4606,4611,4615,4619],{"type":172,"tag":263,"props":4607,"children":4608},{"style":4583},[4609],{"type":178,"value":4610},"    kNotFound",{"type":172,"tag":263,"props":4612,"children":4613},{"style":442},[4614],{"type":178,"value":1929},{"type":172,"tag":263,"props":4616,"children":4617},{"style":604},[4618],{"type":178,"value":2821},{"type":172,"tag":263,"props":4620,"children":4621},{"style":318},[4622],{"type":178,"value":4623},",\n",{"type":172,"tag":263,"props":4625,"children":4626},{"class":265,"line":510},[4627,4632,4636,4641],{"type":172,"tag":263,"props":4628,"children":4629},{"style":4583},[4630],{"type":178,"value":4631},"    kDeleteOrder",{"type":172,"tag":263,"props":4633,"children":4634},{"style":442},[4635],{"type":178,"value":1929},{"type":172,"tag":263,"props":4637,"children":4638},{"style":604},[4639],{"type":178,"value":4640}," 2",{"type":172,"tag":263,"props":4642,"children":4643},{"style":318},[4644],{"type":178,"value":4623},{"type":172,"tag":263,"props":4646,"children":4647},{"class":265,"line":591},[4648,4653,4657,4662],{"type":172,"tag":263,"props":4649,"children":4650},{"style":4583},[4651],{"type":178,"value":4652},"    kInvalidArgument",{"type":172,"tag":263,"props":4654,"children":4655},{"style":442},[4656],{"type":178,"value":1929},{"type":172,"tag":263,"props":4658,"children":4659},{"style":604},[4660],{"type":178,"value":4661}," 3",{"type":172,"tag":263,"props":4663,"children":4664},{"style":318},[4665],{"type":178,"value":4623},{"type":172,"tag":263,"props":4667,"children":4668},{"class":265,"line":614},[4669,4674,4678,4683],{"type":172,"tag":263,"props":4670,"children":4671},{"style":4583},[4672],{"type":178,"value":4673},"    kIOError",{"type":172,"tag":263,"props":4675,"children":4676},{"style":442},[4677],{"type":178,"value":1929},{"type":172,"tag":263,"props":4679,"children":4680},{"style":604},[4681],{"type":178,"value":4682}," 4",{"type":172,"tag":263,"props":4684,"children":4685},{"style":318},[4686],{"type":178,"value":4623},{"type":172,"tag":263,"props":4688,"children":4689},{"class":265,"line":623},[4690,4695,4699,4704],{"type":172,"tag":263,"props":4691,"children":4692},{"style":4583},[4693],{"type":178,"value":4694},"    kDone",{"type":172,"tag":263,"props":4696,"children":4697},{"style":442},[4698],{"type":178,"value":1929},{"type":172,"tag":263,"props":4700,"children":4701},{"style":604},[4702],{"type":178,"value":4703}," 5",{"type":172,"tag":263,"props":4705,"children":4706},{"style":318},[4707],{"type":178,"value":4623},{"type":172,"tag":263,"props":4709,"children":4710},{"class":265,"line":631},[4711,4716,4720],{"type":172,"tag":263,"props":4712,"children":4713},{"style":4583},[4714],{"type":178,"value":4715},"    kMultipartRequired",{"type":172,"tag":263,"props":4717,"children":4718},{"style":442},[4719],{"type":178,"value":1929},{"type":172,"tag":263,"props":4721,"children":4722},{"style":604},[4723],{"type":178,"value":4724}," 6\n",{"type":172,"tag":263,"props":4726,"children":4727},{"class":265,"line":674},[4728],{"type":172,"tag":263,"props":4729,"children":4730},{"style":318},[4731],{"type":178,"value":4732},"  };\n",{"type":172,"tag":263,"props":4734,"children":4735},{"class":265,"line":715},[4736],{"type":172,"tag":263,"props":4737,"children":4738},{"style":1272},[4739],{"type":178,"value":1628},{"type":172,"tag":263,"props":4741,"children":4742},{"class":265,"line":723},[4743],{"type":172,"tag":263,"props":4744,"children":4745},{"style":318},[4746],{"type":178,"value":1109},{"type":172,"tag":263,"props":4748,"children":4749},{"class":265,"line":744},[4750,4754,4758,4762,4766,4770,4774,4778,4782],{"type":172,"tag":263,"props":4751,"children":4752},{"style":333},[4753],{"type":178,"value":2714},{"type":172,"tag":263,"props":4755,"children":4756},{"style":318},[4757],{"type":178,"value":341},{"type":172,"tag":263,"props":4759,"children":4760},{"style":333},[4761],{"type":178,"value":3309},{"type":172,"tag":263,"props":4763,"children":4764},{"style":333},[4765],{"type":178,"value":3265},{"type":172,"tag":263,"props":4767,"children":4768},{"style":318},[4769],{"type":178,"value":341},{"type":172,"tag":263,"props":4771,"children":4772},{"style":312},[4773],{"type":178,"value":573},{"type":172,"tag":263,"props":4775,"children":4776},{"style":318},[4777],{"type":178,"value":321},{"type":172,"tag":263,"props":4779,"children":4780},{"style":1770},[4781],{"type":178,"value":2304},{"type":172,"tag":263,"props":4783,"children":4784},{"style":318},[4785],{"type":178,"value":326},{"type":172,"tag":263,"props":4787,"children":4788},{"class":265,"line":800},[4789,4793,4797,4802,4806,4811,4815],{"type":172,"tag":263,"props":4790,"children":4791},{"style":270},[4792],{"type":178,"value":474},{"type":172,"tag":263,"props":4794,"children":4795},{"style":318},[4796],{"type":178,"value":479},{"type":172,"tag":263,"props":4798,"children":4799},{"style":523},[4800],{"type":178,"value":4801},"message1_ ",{"type":172,"tag":263,"props":4803,"children":4804},{"style":442},[4805],{"type":178,"value":950},{"type":172,"tag":263,"props":4807,"children":4808},{"style":276},[4809],{"type":178,"value":4810}," \"\"",{"type":172,"tag":263,"props":4812,"children":4813},{"style":318},[4814],{"type":178,"value":967},{"type":172,"tag":263,"props":4816,"children":4817},{"style":318},[4818],{"type":178,"value":326},{"type":172,"tag":263,"props":4820,"children":4821},{"class":265,"line":808},[4822,4826,4830,4834,4838],{"type":172,"tag":263,"props":4823,"children":4824},{"style":270},[4825],{"type":178,"value":2503},{"type":172,"tag":263,"props":4827,"children":4828},{"style":276},[4829],{"type":178,"value":415},{"type":172,"tag":263,"props":4831,"children":4832},{"style":282},[4833],{"type":178,"value":4039},{"type":172,"tag":263,"props":4835,"children":4836},{"style":276},[4837],{"type":178,"value":425},{"type":172,"tag":263,"props":4839,"children":4840},{"style":318},[4841],{"type":178,"value":352},{"type":172,"tag":263,"props":4843,"children":4844},{"class":265,"line":829},[4845,4849,4853],{"type":172,"tag":263,"props":4846,"children":4847},{"style":318},[4848],{"type":178,"value":1020},{"type":172,"tag":263,"props":4850,"children":4851},{"style":270},[4852],{"type":178,"value":1025},{"type":172,"tag":263,"props":4854,"children":4855},{"style":318},[4856],{"type":178,"value":326},{"type":172,"tag":263,"props":4858,"children":4859},{"class":265,"line":850},[4860,4865,4870,4874,4879],{"type":172,"tag":263,"props":4861,"children":4862},{"style":306},[4863],{"type":178,"value":4864},"    char",{"type":172,"tag":263,"props":4866,"children":4867},{"style":344},[4868],{"type":178,"value":4869}," tmp",{"type":172,"tag":263,"props":4871,"children":4872},{"style":318},[4873],{"type":178,"value":1239},{"type":172,"tag":263,"props":4875,"children":4876},{"style":604},[4877],{"type":178,"value":4878},"30",{"type":172,"tag":263,"props":4880,"children":4881},{"style":318},[4882],{"type":178,"value":1249},{"type":172,"tag":263,"props":4884,"children":4885},{"class":265,"line":910},[4886,4891,4896,4901,4906],{"type":172,"tag":263,"props":4887,"children":4888},{"style":1770},[4889],{"type":178,"value":4890},"    const",{"type":172,"tag":263,"props":4892,"children":4893},{"style":306},[4894],{"type":178,"value":4895}," char",{"type":172,"tag":263,"props":4897,"children":4898},{"style":442},[4899],{"type":178,"value":4900},"*",{"type":172,"tag":263,"props":4902,"children":4903},{"style":523},[4904],{"type":178,"value":4905}," type",{"type":172,"tag":263,"props":4907,"children":4908},{"style":318},[4909],{"type":178,"value":352},{"type":172,"tag":263,"props":4911,"children":4912},{"class":265,"line":974},[4913,4918,4922,4926,4930],{"type":172,"tag":263,"props":4914,"children":4915},{"style":270},[4916],{"type":178,"value":4917},"    switch",{"type":172,"tag":263,"props":4919,"children":4920},{"style":318},[4921],{"type":178,"value":479},{"type":172,"tag":263,"props":4923,"children":4924},{"style":312},[4925],{"type":178,"value":259},{"type":172,"tag":263,"props":4927,"children":4928},{"style":318},[4929],{"type":178,"value":503},{"type":172,"tag":263,"props":4931,"children":4932},{"style":318},[4933],{"type":178,"value":326},{"type":172,"tag":263,"props":4935,"children":4936},{"class":265,"line":1014},[4937,4942,4946],{"type":172,"tag":263,"props":4938,"children":4939},{"style":270},[4940],{"type":178,"value":4941},"      case",{"type":172,"tag":263,"props":4943,"children":4944},{"style":523},[4945],{"type":178,"value":4545},{"type":172,"tag":263,"props":4947,"children":4948},{"style":318},[4949],{"type":178,"value":4950},":\n",{"type":172,"tag":263,"props":4952,"children":4953},{"class":265,"line":1032},[4954,4959,4963,4967,4971,4975],{"type":172,"tag":263,"props":4955,"children":4956},{"style":523},[4957],{"type":178,"value":4958},"        type ",{"type":172,"tag":263,"props":4960,"children":4961},{"style":442},[4962],{"type":178,"value":445},{"type":172,"tag":263,"props":4964,"children":4965},{"style":276},[4966],{"type":178,"value":415},{"type":172,"tag":263,"props":4968,"children":4969},{"style":282},[4970],{"type":178,"value":4039},{"type":172,"tag":263,"props":4972,"children":4973},{"style":276},[4974],{"type":178,"value":425},{"type":172,"tag":263,"props":4976,"children":4977},{"style":318},[4978],{"type":178,"value":352},{"type":172,"tag":263,"props":4980,"children":4981},{"class":265,"line":1069},[4982,4987],{"type":172,"tag":263,"props":4983,"children":4984},{"style":270},[4985],{"type":178,"value":4986},"        break",{"type":172,"tag":263,"props":4988,"children":4989},{"style":318},[4990],{"type":178,"value":352},{"type":172,"tag":263,"props":4992,"children":4993},{"class":265,"line":1077},[4994],{"type":172,"tag":263,"props":4995,"children":4996},{"style":1272},[4997],{"type":178,"value":4998},"      // ...\n",{"type":172,"tag":263,"props":5000,"children":5001},{"class":265,"line":1085},[5002],{"type":172,"tag":263,"props":5003,"children":5004},{"style":318},[5005],{"type":178,"value":5006},"    }\n",{"type":172,"tag":263,"props":5008,"children":5009},{"class":265,"line":1103},[5010],{"type":172,"tag":263,"props":5011,"children":5012},{"style":1272},[5013],{"type":178,"value":3900},{"type":172,"tag":263,"props":5015,"children":5017},{"class":265,"line":5016},30,[5018,5022,5027],{"type":172,"tag":263,"props":5019,"children":5020},{"style":270},[5021],{"type":178,"value":2503},{"type":172,"tag":263,"props":5023,"children":5024},{"style":523},[5025],{"type":178,"value":5026}," result",{"type":172,"tag":263,"props":5028,"children":5029},{"style":318},[5030],{"type":178,"value":352},{"type":172,"tag":263,"props":5032,"children":5034},{"class":265,"line":5033},31,[5035],{"type":172,"tag":263,"props":5036,"children":5037},{"style":318},[5038],{"type":178,"value":620},{"type":172,"tag":263,"props":5040,"children":5042},{"class":265,"line":5041},32,[5043],{"type":172,"tag":263,"props":5044,"children":5045},{"style":318},[5046],{"type":178,"value":1109},{"type":172,"tag":186,"props":5048,"children":5049},{},[5050],{"type":178,"value":5051},"KDB 内部代码出现异常时会使用日志将其记录下来。如果没有日志，那么在排查代码问题时简直就是噩梦。KDB 有两套日志的输出目标，分别是系统输出和标准输出设备。日志类记录输出目标、日志级别、线程锁等成员，并通过静态方法 Logv 实现记录日志。锁的最大用处是保证记录顺序。仅有当出现最高级别的日志（kLogLevelEMERG）时，才会跳过锁直接写入。出现 kLogLevelEMERG 时意味着程序遇到了紧急问题，通常会直接退出或是返回 Status 异常，所以这个时候需要及时记录。",{"type":172,"tag":186,"props":5053,"children":5054},{},[5055],{"type":178,"value":5056},"日志级别的划分参考了 Syslog：",{"type":172,"tag":213,"props":5058,"children":5059},{},[5060,5065,5070,5075,5080,5085,5090,5095,5100,5105],{"type":172,"tag":217,"props":5061,"children":5062},{},[5063],{"type":178,"value":5064},"silent: all logging is turned off",{"type":172,"tag":217,"props":5066,"children":5067},{},[5068],{"type":178,"value":5069},"emerg: system is unusable, imminent crash",{"type":172,"tag":217,"props":5071,"children":5072},{},[5073],{"type":178,"value":5074},"alert: error event, immediate action required",{"type":172,"tag":217,"props":5076,"children":5077},{},[5078],{"type":178,"value":5079},"crit: error event, immediate action required",{"type":172,"tag":217,"props":5081,"children":5082},{},[5083],{"type":178,"value":5084},"error: error event, action is required but is not urgent",{"type":172,"tag":217,"props":5086,"children":5087},{},[5088],{"type":178,"value":5089},"warn: events that can be harmful if no action is taken",{"type":172,"tag":217,"props":5091,"children":5092},{},[5093],{"type":178,"value":5094},"notice: unusual events, but no immediate action required",{"type":172,"tag":217,"props":5096,"children":5097},{},[5098],{"type":178,"value":5099},"info: normal operation events, no action required",{"type":172,"tag":217,"props":5101,"children":5102},{},[5103],{"type":178,"value":5104},"debug: events used for debugging, no action required",{"type":172,"tag":217,"props":5106,"children":5107},{},[5108],{"type":178,"value":5109},"trace: fine-grained events used for debugging, no action required",{"type":172,"tag":1139,"props":5111,"children":5113},{"id":5112},"日志调用用宏还是函数",[5114],{"type":178,"value":5112},{"type":172,"tag":186,"props":5116,"children":5117},{},[5118,5120,5126,5128,5132],{"type":178,"value":5119},"原先的提交中，日志调用被定义在了宏里，直接调用 Logger::Logv 去记录。日志宏中使用子宏 ",{"type":172,"tag":5121,"props":5122,"children":5123},"strong",{},[5124],{"type":178,"value":5125},"VA_ARGS",{"type":178,"value":5127}," 来记录可变参数。",{"type":172,"tag":5121,"props":5129,"children":5130},{},[5131],{"type":178,"value":5125},{"type":178,"value":5133}," 前面有标记黏贴运算符的原因是当日志宏的可变参数为空时，可以把末尾的逗号去掉。",{"type":172,"tag":252,"props":5135,"children":5137},{"code":5136,"language":255,"meta":166,"className":256,"style":166},"class log {\n  static void emerg(const char* logname, const char* format, ...) {\n    va_list args;\n    va_start(args, format);\n    Logger::Logv(false, Logger::kLogLevelEMERG, LOG_EMERG, logname, format, args);\n    va_end(args);\n  }\n}\n// ...\n#define LOG_EMERG(logname, fmt, ...) \\\n        Logger::Logv(false, Logger::kLogLevelEMERG, logname, fmt, ##__VA_ARGS__)\n",[5138],{"type":172,"tag":259,"props":5139,"children":5140},{"__ignoreMap":166},[5141,5157,5232,5244,5273,5355,5375,5382,5389,5396,5438],{"type":172,"tag":263,"props":5142,"children":5143},{"class":265,"line":266},[5144,5148,5153],{"type":172,"tag":263,"props":5145,"children":5146},{"style":306},[5147],{"type":178,"value":1683},{"type":172,"tag":263,"props":5149,"children":5150},{"style":333},[5151],{"type":178,"value":5152}," log",{"type":172,"tag":263,"props":5154,"children":5155},{"style":318},[5156],{"type":178,"value":326},{"type":172,"tag":263,"props":5158,"children":5159},{"class":265,"line":293},[5160,5164,5168,5173,5177,5181,5185,5189,5194,5198,5202,5206,5210,5215,5219,5224,5228],{"type":172,"tag":263,"props":5161,"children":5162},{"style":1770},[5163],{"type":178,"value":1773},{"type":172,"tag":263,"props":5165,"children":5166},{"style":306},[5167],{"type":178,"value":1778},{"type":172,"tag":263,"props":5169,"children":5170},{"style":312},[5171],{"type":178,"value":5172}," emerg",{"type":172,"tag":263,"props":5174,"children":5175},{"style":318},[5176],{"type":178,"value":400},{"type":172,"tag":263,"props":5178,"children":5179},{"style":1770},[5180],{"type":178,"value":2282},{"type":172,"tag":263,"props":5182,"children":5183},{"style":306},[5184],{"type":178,"value":4895},{"type":172,"tag":263,"props":5186,"children":5187},{"style":1770},[5188],{"type":178,"value":4900},{"type":172,"tag":263,"props":5190,"children":5191},{"style":1179},[5192],{"type":178,"value":5193}," logname",{"type":172,"tag":263,"props":5195,"children":5196},{"style":318},[5197],{"type":178,"value":410},{"type":172,"tag":263,"props":5199,"children":5200},{"style":1770},[5201],{"type":178,"value":2304},{"type":172,"tag":263,"props":5203,"children":5204},{"style":306},[5205],{"type":178,"value":4895},{"type":172,"tag":263,"props":5207,"children":5208},{"style":1770},[5209],{"type":178,"value":4900},{"type":172,"tag":263,"props":5211,"children":5212},{"style":1179},[5213],{"type":178,"value":5214}," format",{"type":172,"tag":263,"props":5216,"children":5217},{"style":318},[5218],{"type":178,"value":410},{"type":172,"tag":263,"props":5220,"children":5221},{"style":523},[5222],{"type":178,"value":5223}," ...",{"type":172,"tag":263,"props":5225,"children":5226},{"style":318},[5227],{"type":178,"value":967},{"type":172,"tag":263,"props":5229,"children":5230},{"style":318},[5231],{"type":178,"value":326},{"type":172,"tag":263,"props":5233,"children":5234},{"class":265,"line":302},[5235,5240],{"type":172,"tag":263,"props":5236,"children":5237},{"style":523},[5238],{"type":178,"value":5239},"    va_list args",{"type":172,"tag":263,"props":5241,"children":5242},{"style":318},[5243],{"type":178,"value":352},{"type":172,"tag":263,"props":5245,"children":5246},{"class":265,"line":329},[5247,5252,5256,5261,5265,5269],{"type":172,"tag":263,"props":5248,"children":5249},{"style":312},[5250],{"type":178,"value":5251},"    va_start",{"type":172,"tag":263,"props":5253,"children":5254},{"style":318},[5255],{"type":178,"value":400},{"type":172,"tag":263,"props":5257,"children":5258},{"style":523},[5259],{"type":178,"value":5260},"args",{"type":172,"tag":263,"props":5262,"children":5263},{"style":318},[5264],{"type":178,"value":410},{"type":172,"tag":263,"props":5266,"children":5267},{"style":523},[5268],{"type":178,"value":5214},{"type":172,"tag":263,"props":5270,"children":5271},{"style":318},[5272],{"type":178,"value":430},{"type":172,"tag":263,"props":5274,"children":5275},{"class":265,"line":355},[5276,5281,5285,5290,5294,5299,5303,5308,5312,5317,5321,5326,5330,5334,5338,5342,5346,5351],{"type":172,"tag":263,"props":5277,"children":5278},{"style":333},[5279],{"type":178,"value":5280},"    Logger",{"type":172,"tag":263,"props":5282,"children":5283},{"style":318},[5284],{"type":178,"value":341},{"type":172,"tag":263,"props":5286,"children":5287},{"style":312},[5288],{"type":178,"value":5289},"Logv",{"type":172,"tag":263,"props":5291,"children":5292},{"style":318},[5293],{"type":178,"value":400},{"type":172,"tag":263,"props":5295,"children":5296},{"style":2470},[5297],{"type":178,"value":5298},"false",{"type":172,"tag":263,"props":5300,"children":5301},{"style":318},[5302],{"type":178,"value":410},{"type":172,"tag":263,"props":5304,"children":5305},{"style":333},[5306],{"type":178,"value":5307}," Logger",{"type":172,"tag":263,"props":5309,"children":5310},{"style":318},[5311],{"type":178,"value":341},{"type":172,"tag":263,"props":5313,"children":5314},{"style":523},[5315],{"type":178,"value":5316},"kLogLevelEMERG",{"type":172,"tag":263,"props":5318,"children":5319},{"style":318},[5320],{"type":178,"value":410},{"type":172,"tag":263,"props":5322,"children":5323},{"style":523},[5324],{"type":178,"value":5325}," LOG_EMERG",{"type":172,"tag":263,"props":5327,"children":5328},{"style":318},[5329],{"type":178,"value":410},{"type":172,"tag":263,"props":5331,"children":5332},{"style":523},[5333],{"type":178,"value":5193},{"type":172,"tag":263,"props":5335,"children":5336},{"style":318},[5337],{"type":178,"value":410},{"type":172,"tag":263,"props":5339,"children":5340},{"style":523},[5341],{"type":178,"value":5214},{"type":172,"tag":263,"props":5343,"children":5344},{"style":318},[5345],{"type":178,"value":410},{"type":172,"tag":263,"props":5347,"children":5348},{"style":523},[5349],{"type":178,"value":5350}," args",{"type":172,"tag":263,"props":5352,"children":5353},{"style":318},[5354],{"type":178,"value":430},{"type":172,"tag":263,"props":5356,"children":5357},{"class":265,"line":376},[5358,5363,5367,5371],{"type":172,"tag":263,"props":5359,"children":5360},{"style":312},[5361],{"type":178,"value":5362},"    va_end",{"type":172,"tag":263,"props":5364,"children":5365},{"style":318},[5366],{"type":178,"value":400},{"type":172,"tag":263,"props":5368,"children":5369},{"style":523},[5370],{"type":178,"value":5260},{"type":172,"tag":263,"props":5372,"children":5373},{"style":318},[5374],{"type":178,"value":430},{"type":172,"tag":263,"props":5376,"children":5377},{"class":265,"line":433},[5378],{"type":172,"tag":263,"props":5379,"children":5380},{"style":318},[5381],{"type":178,"value":620},{"type":172,"tag":263,"props":5383,"children":5384},{"class":265,"line":468},[5385],{"type":172,"tag":263,"props":5386,"children":5387},{"style":318},[5388],{"type":178,"value":1109},{"type":172,"tag":263,"props":5390,"children":5391},{"class":265,"line":510},[5392],{"type":172,"tag":263,"props":5393,"children":5394},{"style":1272},[5395],{"type":178,"value":3084},{"type":172,"tag":263,"props":5397,"children":5398},{"class":265,"line":591},[5399,5403,5407,5411,5416,5420,5425,5429,5434],{"type":172,"tag":263,"props":5400,"children":5401},{"style":270},[5402],{"type":178,"value":1643},{"type":172,"tag":263,"props":5404,"children":5405},{"style":312},[5406],{"type":178,"value":5325},{"type":172,"tag":263,"props":5408,"children":5409},{"style":318},[5410],{"type":178,"value":400},{"type":172,"tag":263,"props":5412,"children":5413},{"style":1179},[5414],{"type":178,"value":5415},"logname",{"type":172,"tag":263,"props":5417,"children":5418},{"style":318},[5419],{"type":178,"value":410},{"type":172,"tag":263,"props":5421,"children":5422},{"style":1179},[5423],{"type":178,"value":5424}," fmt",{"type":172,"tag":263,"props":5426,"children":5427},{"style":318},[5428],{"type":178,"value":410},{"type":172,"tag":263,"props":5430,"children":5431},{"style":318},[5432],{"type":178,"value":5433}," ...)",{"type":172,"tag":263,"props":5435,"children":5436},{"style":548},[5437],{"type":178,"value":2029},{"type":172,"tag":263,"props":5439,"children":5440},{"class":265,"line":614},[5441,5446,5450,5454,5458,5462,5466,5470,5474,5478,5482,5486,5490,5494,5498,5503],{"type":172,"tag":263,"props":5442,"children":5443},{"style":333},[5444],{"type":178,"value":5445},"        Logger",{"type":172,"tag":263,"props":5447,"children":5448},{"style":318},[5449],{"type":178,"value":341},{"type":172,"tag":263,"props":5451,"children":5452},{"style":312},[5453],{"type":178,"value":5289},{"type":172,"tag":263,"props":5455,"children":5456},{"style":318},[5457],{"type":178,"value":400},{"type":172,"tag":263,"props":5459,"children":5460},{"style":2470},[5461],{"type":178,"value":5298},{"type":172,"tag":263,"props":5463,"children":5464},{"style":318},[5465],{"type":178,"value":410},{"type":172,"tag":263,"props":5467,"children":5468},{"style":333},[5469],{"type":178,"value":5307},{"type":172,"tag":263,"props":5471,"children":5472},{"style":318},[5473],{"type":178,"value":341},{"type":172,"tag":263,"props":5475,"children":5476},{"style":523},[5477],{"type":178,"value":5316},{"type":172,"tag":263,"props":5479,"children":5480},{"style":318},[5481],{"type":178,"value":410},{"type":172,"tag":263,"props":5483,"children":5484},{"style":523},[5485],{"type":178,"value":5193},{"type":172,"tag":263,"props":5487,"children":5488},{"style":318},[5489],{"type":178,"value":410},{"type":172,"tag":263,"props":5491,"children":5492},{"style":523},[5493],{"type":178,"value":5424},{"type":172,"tag":263,"props":5495,"children":5496},{"style":318},[5497],{"type":178,"value":410},{"type":172,"tag":263,"props":5499,"children":5500},{"style":344},[5501],{"type":178,"value":5502}," ##__VA_ARGS__",{"type":172,"tag":263,"props":5504,"children":5505},{"style":318},[5506],{"type":178,"value":2099},{"type":172,"tag":186,"props":5508,"children":5509},{},[5510],{"type":178,"value":5511},"尚不清楚为什么不用宏，而是使用运行时的方法调用（即 log 的 public 方法）。猜测可能是因为宏不能跨行？因为我看到了这种很长的调用。",{"type":172,"tag":252,"props":5513,"children":5515},{"code":5514,"language":255,"meta":166,"className":256,"style":166},"log::trace(\n  \"Database::PutPartValidSize()\",\n  \"[%s] size_chunk:%\" PRIu64 \" offset_chunk:%\" PRIu64,\n  key.ToString().c_str(),\n  chunk.size(),\n  offset_chunk\n);\n",[5516],{"type":172,"tag":259,"props":5517,"children":5518},{"__ignoreMap":166},[5519,5541,5562,5613,5642,5662,5670],{"type":172,"tag":263,"props":5520,"children":5521},{"class":265,"line":266},[5522,5527,5531,5536],{"type":172,"tag":263,"props":5523,"children":5524},{"style":333},[5525],{"type":178,"value":5526},"log",{"type":172,"tag":263,"props":5528,"children":5529},{"style":318},[5530],{"type":178,"value":341},{"type":172,"tag":263,"props":5532,"children":5533},{"style":312},[5534],{"type":178,"value":5535},"trace",{"type":172,"tag":263,"props":5537,"children":5538},{"style":318},[5539],{"type":178,"value":5540},"(\n",{"type":172,"tag":263,"props":5542,"children":5543},{"class":265,"line":293},[5544,5549,5554,5558],{"type":172,"tag":263,"props":5545,"children":5546},{"style":276},[5547],{"type":178,"value":5548},"  \"",{"type":172,"tag":263,"props":5550,"children":5551},{"style":282},[5552],{"type":178,"value":5553},"Database::PutPartValidSize()",{"type":172,"tag":263,"props":5555,"children":5556},{"style":276},[5557],{"type":178,"value":425},{"type":172,"tag":263,"props":5559,"children":5560},{"style":318},[5561],{"type":178,"value":4623},{"type":172,"tag":263,"props":5563,"children":5564},{"class":265,"line":302},[5565,5569,5573,5577,5582,5586,5591,5595,5600,5604,5609],{"type":172,"tag":263,"props":5566,"children":5567},{"style":276},[5568],{"type":178,"value":5548},{"type":172,"tag":263,"props":5570,"children":5571},{"style":282},[5572],{"type":178,"value":1239},{"type":172,"tag":263,"props":5574,"children":5575},{"style":542},[5576],{"type":178,"value":545},{"type":172,"tag":263,"props":5578,"children":5579},{"style":282},[5580],{"type":178,"value":5581},"] size_chunk:%",{"type":172,"tag":263,"props":5583,"children":5584},{"style":276},[5585],{"type":178,"value":425},{"type":172,"tag":263,"props":5587,"children":5588},{"style":344},[5589],{"type":178,"value":5590}," PRIu64 ",{"type":172,"tag":263,"props":5592,"children":5593},{"style":276},[5594],{"type":178,"value":425},{"type":172,"tag":263,"props":5596,"children":5597},{"style":282},[5598],{"type":178,"value":5599}," offset_chunk:%",{"type":172,"tag":263,"props":5601,"children":5602},{"style":276},[5603],{"type":178,"value":425},{"type":172,"tag":263,"props":5605,"children":5606},{"style":344},[5607],{"type":178,"value":5608}," PRIu64",{"type":172,"tag":263,"props":5610,"children":5611},{"style":318},[5612],{"type":178,"value":4623},{"type":172,"tag":263,"props":5614,"children":5615},{"class":265,"line":329},[5616,5621,5625,5629,5633,5637],{"type":172,"tag":263,"props":5617,"children":5618},{"style":344},[5619],{"type":178,"value":5620},"  key",{"type":172,"tag":263,"props":5622,"children":5623},{"style":318},[5624],{"type":178,"value":455},{"type":172,"tag":263,"props":5626,"children":5627},{"style":312},[5628],{"type":178,"value":573},{"type":172,"tag":263,"props":5630,"children":5631},{"style":318},[5632],{"type":178,"value":578},{"type":172,"tag":263,"props":5634,"children":5635},{"style":312},[5636],{"type":178,"value":583},{"type":172,"tag":263,"props":5638,"children":5639},{"style":318},[5640],{"type":178,"value":5641},"(),\n",{"type":172,"tag":263,"props":5643,"children":5644},{"class":265,"line":355},[5645,5650,5654,5658],{"type":172,"tag":263,"props":5646,"children":5647},{"style":344},[5648],{"type":178,"value":5649},"  chunk",{"type":172,"tag":263,"props":5651,"children":5652},{"style":318},[5653],{"type":178,"value":455},{"type":172,"tag":263,"props":5655,"children":5656},{"style":312},[5657],{"type":178,"value":3407},{"type":172,"tag":263,"props":5659,"children":5660},{"style":318},[5661],{"type":178,"value":5641},{"type":172,"tag":263,"props":5663,"children":5664},{"class":265,"line":376},[5665],{"type":172,"tag":263,"props":5666,"children":5667},{"style":344},[5668],{"type":178,"value":5669},"  offset_chunk\n",{"type":172,"tag":263,"props":5671,"children":5672},{"class":265,"line":433},[5673],{"type":172,"tag":263,"props":5674,"children":5675},{"style":318},[5676],{"type":178,"value":430},{"type":172,"tag":1139,"props":5678,"children":5680},{"id":5679},"日志时间",[5681],{"type":178,"value":5679},{"type":172,"tag":186,"props":5683,"children":5684},{},[5685],{"type":178,"value":5686},"使用系统输出（syslog）时不需要手动记录时间，但是把日志打印出来时却是要的。尤其是在调试时，精确时间非常有用。KDB 使用 Linux 的 timeval、tm 两个结构体，分别拿到精确时间及可读时间，再格式化输出。",{"type":172,"tag":252,"props":5688,"children":5690},{"code":5689,"language":255,"meta":166,"className":256,"style":166},"struct timeval now_tv;\ngettimeofday(&now_tv, NULL);\nconst time_t seconds = now_tv.tv_sec;\nstruct tm t;\n// 初始化 tm 时需要用到当前秒数，\n// 所以需要提前初始化 now_tv\nlocaltime_r(&seconds, &t);\np += snprintf(p, limit - p,\n              \"%04d/%02d/%02d-%02d:%02d:%02d.%06d %s %s \",\n              t.tm_year + 1900,\n              t.tm_mon + 1,\n              t.tm_mday,\n              t.tm_hour,\n              t.tm_min,\n              t.tm_sec,\n              static_cast\u003Cint>(now_tv.tv_usec), // 毫秒\n              ss.str().c_str(),\n              logname);\n",[5691],{"type":172,"tag":259,"props":5692,"children":5693},{"__ignoreMap":166},[5694,5716,5750,5788,5808,5816,5824,5862,5911,5992,6023,6051,6071,6091,6111,6131,6174,6202],{"type":172,"tag":263,"props":5695,"children":5696},{"class":265,"line":266},[5697,5702,5707,5712],{"type":172,"tag":263,"props":5698,"children":5699},{"style":306},[5700],{"type":178,"value":5701},"struct",{"type":172,"tag":263,"props":5703,"children":5704},{"style":333},[5705],{"type":178,"value":5706}," timeval",{"type":172,"tag":263,"props":5708,"children":5709},{"style":344},[5710],{"type":178,"value":5711}," now_tv",{"type":172,"tag":263,"props":5713,"children":5714},{"style":318},[5715],{"type":178,"value":352},{"type":172,"tag":263,"props":5717,"children":5718},{"class":265,"line":293},[5719,5724,5728,5732,5737,5741,5746],{"type":172,"tag":263,"props":5720,"children":5721},{"style":312},[5722],{"type":178,"value":5723},"gettimeofday",{"type":172,"tag":263,"props":5725,"children":5726},{"style":318},[5727],{"type":178,"value":400},{"type":172,"tag":263,"props":5729,"children":5730},{"style":442},[5731],{"type":178,"value":2268},{"type":172,"tag":263,"props":5733,"children":5734},{"style":344},[5735],{"type":178,"value":5736},"now_tv",{"type":172,"tag":263,"props":5738,"children":5739},{"style":318},[5740],{"type":178,"value":410},{"type":172,"tag":263,"props":5742,"children":5743},{"style":2470},[5744],{"type":178,"value":5745}," NULL",{"type":172,"tag":263,"props":5747,"children":5748},{"style":318},[5749],{"type":178,"value":430},{"type":172,"tag":263,"props":5751,"children":5752},{"class":265,"line":302},[5753,5757,5762,5767,5771,5775,5779,5784],{"type":172,"tag":263,"props":5754,"children":5755},{"style":1770},[5756],{"type":178,"value":2282},{"type":172,"tag":263,"props":5758,"children":5759},{"style":306},[5760],{"type":178,"value":5761}," time_t",{"type":172,"tag":263,"props":5763,"children":5764},{"style":344},[5765],{"type":178,"value":5766}," seconds ",{"type":172,"tag":263,"props":5768,"children":5769},{"style":442},[5770],{"type":178,"value":445},{"type":172,"tag":263,"props":5772,"children":5773},{"style":344},[5774],{"type":178,"value":5711},{"type":172,"tag":263,"props":5776,"children":5777},{"style":318},[5778],{"type":178,"value":455},{"type":172,"tag":263,"props":5780,"children":5781},{"style":344},[5782],{"type":178,"value":5783},"tv_sec",{"type":172,"tag":263,"props":5785,"children":5786},{"style":318},[5787],{"type":178,"value":352},{"type":172,"tag":263,"props":5789,"children":5790},{"class":265,"line":329},[5791,5795,5800,5804],{"type":172,"tag":263,"props":5792,"children":5793},{"style":306},[5794],{"type":178,"value":5701},{"type":172,"tag":263,"props":5796,"children":5797},{"style":333},[5798],{"type":178,"value":5799}," tm",{"type":172,"tag":263,"props":5801,"children":5802},{"style":344},[5803],{"type":178,"value":1830},{"type":172,"tag":263,"props":5805,"children":5806},{"style":318},[5807],{"type":178,"value":352},{"type":172,"tag":263,"props":5809,"children":5810},{"class":265,"line":355},[5811],{"type":172,"tag":263,"props":5812,"children":5813},{"style":1272},[5814],{"type":178,"value":5815},"// 初始化 tm 时需要用到当前秒数，\n",{"type":172,"tag":263,"props":5817,"children":5818},{"class":265,"line":376},[5819],{"type":172,"tag":263,"props":5820,"children":5821},{"style":1272},[5822],{"type":178,"value":5823},"// 所以需要提前初始化 now_tv\n",{"type":172,"tag":263,"props":5825,"children":5826},{"class":265,"line":433},[5827,5832,5836,5840,5845,5849,5853,5858],{"type":172,"tag":263,"props":5828,"children":5829},{"style":312},[5830],{"type":178,"value":5831},"localtime_r",{"type":172,"tag":263,"props":5833,"children":5834},{"style":318},[5835],{"type":178,"value":400},{"type":172,"tag":263,"props":5837,"children":5838},{"style":442},[5839],{"type":178,"value":2268},{"type":172,"tag":263,"props":5841,"children":5842},{"style":344},[5843],{"type":178,"value":5844},"seconds",{"type":172,"tag":263,"props":5846,"children":5847},{"style":318},[5848],{"type":178,"value":410},{"type":172,"tag":263,"props":5850,"children":5851},{"style":442},[5852],{"type":178,"value":898},{"type":172,"tag":263,"props":5854,"children":5855},{"style":344},[5856],{"type":178,"value":5857},"t",{"type":172,"tag":263,"props":5859,"children":5860},{"style":318},[5861],{"type":178,"value":430},{"type":172,"tag":263,"props":5863,"children":5864},{"class":265,"line":468},[5865,5870,5875,5880,5884,5888,5892,5897,5902,5907],{"type":172,"tag":263,"props":5866,"children":5867},{"style":344},[5868],{"type":178,"value":5869},"p ",{"type":172,"tag":263,"props":5871,"children":5872},{"style":442},[5873],{"type":178,"value":5874},"+=",{"type":172,"tag":263,"props":5876,"children":5877},{"style":312},[5878],{"type":178,"value":5879}," snprintf",{"type":172,"tag":263,"props":5881,"children":5882},{"style":318},[5883],{"type":178,"value":400},{"type":172,"tag":263,"props":5885,"children":5886},{"style":344},[5887],{"type":178,"value":186},{"type":172,"tag":263,"props":5889,"children":5890},{"style":318},[5891],{"type":178,"value":410},{"type":172,"tag":263,"props":5893,"children":5894},{"style":344},[5895],{"type":178,"value":5896}," limit ",{"type":172,"tag":263,"props":5898,"children":5899},{"style":442},[5900],{"type":178,"value":5901},"-",{"type":172,"tag":263,"props":5903,"children":5904},{"style":344},[5905],{"type":178,"value":5906}," p",{"type":172,"tag":263,"props":5908,"children":5909},{"style":318},[5910],{"type":178,"value":4623},{"type":172,"tag":263,"props":5912,"children":5913},{"class":265,"line":510},[5914,5919,5924,5929,5934,5938,5942,5946,5950,5954,5958,5962,5966,5970,5975,5980,5984,5988],{"type":172,"tag":263,"props":5915,"children":5916},{"style":276},[5917],{"type":178,"value":5918},"              \"",{"type":172,"tag":263,"props":5920,"children":5921},{"style":542},[5922],{"type":178,"value":5923},"%04d",{"type":172,"tag":263,"props":5925,"children":5926},{"style":282},[5927],{"type":178,"value":5928},"/",{"type":172,"tag":263,"props":5930,"children":5931},{"style":542},[5932],{"type":178,"value":5933},"%02d",{"type":172,"tag":263,"props":5935,"children":5936},{"style":282},[5937],{"type":178,"value":5928},{"type":172,"tag":263,"props":5939,"children":5940},{"style":542},[5941],{"type":178,"value":5933},{"type":172,"tag":263,"props":5943,"children":5944},{"style":282},[5945],{"type":178,"value":5901},{"type":172,"tag":263,"props":5947,"children":5948},{"style":542},[5949],{"type":178,"value":5933},{"type":172,"tag":263,"props":5951,"children":5952},{"style":282},[5953],{"type":178,"value":1368},{"type":172,"tag":263,"props":5955,"children":5956},{"style":542},[5957],{"type":178,"value":5933},{"type":172,"tag":263,"props":5959,"children":5960},{"style":282},[5961],{"type":178,"value":1368},{"type":172,"tag":263,"props":5963,"children":5964},{"style":542},[5965],{"type":178,"value":5933},{"type":172,"tag":263,"props":5967,"children":5968},{"style":282},[5969],{"type":178,"value":455},{"type":172,"tag":263,"props":5971,"children":5972},{"style":542},[5973],{"type":178,"value":5974},"%06d",{"type":172,"tag":263,"props":5976,"children":5977},{"style":542},[5978],{"type":178,"value":5979}," %s",{"type":172,"tag":263,"props":5981,"children":5982},{"style":542},[5983],{"type":178,"value":5979},{"type":172,"tag":263,"props":5985,"children":5986},{"style":276},[5987],{"type":178,"value":415},{"type":172,"tag":263,"props":5989,"children":5990},{"style":318},[5991],{"type":178,"value":4623},{"type":172,"tag":263,"props":5993,"children":5994},{"class":265,"line":591},[5995,6000,6004,6009,6014,6019],{"type":172,"tag":263,"props":5996,"children":5997},{"style":344},[5998],{"type":178,"value":5999},"              t",{"type":172,"tag":263,"props":6001,"children":6002},{"style":318},[6003],{"type":178,"value":455},{"type":172,"tag":263,"props":6005,"children":6006},{"style":344},[6007],{"type":178,"value":6008},"tm_year ",{"type":172,"tag":263,"props":6010,"children":6011},{"style":442},[6012],{"type":178,"value":6013},"+",{"type":172,"tag":263,"props":6015,"children":6016},{"style":604},[6017],{"type":178,"value":6018}," 1900",{"type":172,"tag":263,"props":6020,"children":6021},{"style":318},[6022],{"type":178,"value":4623},{"type":172,"tag":263,"props":6024,"children":6025},{"class":265,"line":614},[6026,6030,6034,6039,6043,6047],{"type":172,"tag":263,"props":6027,"children":6028},{"style":344},[6029],{"type":178,"value":5999},{"type":172,"tag":263,"props":6031,"children":6032},{"style":318},[6033],{"type":178,"value":455},{"type":172,"tag":263,"props":6035,"children":6036},{"style":344},[6037],{"type":178,"value":6038},"tm_mon ",{"type":172,"tag":263,"props":6040,"children":6041},{"style":442},[6042],{"type":178,"value":6013},{"type":172,"tag":263,"props":6044,"children":6045},{"style":604},[6046],{"type":178,"value":2821},{"type":172,"tag":263,"props":6048,"children":6049},{"style":318},[6050],{"type":178,"value":4623},{"type":172,"tag":263,"props":6052,"children":6053},{"class":265,"line":623},[6054,6058,6062,6067],{"type":172,"tag":263,"props":6055,"children":6056},{"style":344},[6057],{"type":178,"value":5999},{"type":172,"tag":263,"props":6059,"children":6060},{"style":318},[6061],{"type":178,"value":455},{"type":172,"tag":263,"props":6063,"children":6064},{"style":344},[6065],{"type":178,"value":6066},"tm_mday",{"type":172,"tag":263,"props":6068,"children":6069},{"style":318},[6070],{"type":178,"value":4623},{"type":172,"tag":263,"props":6072,"children":6073},{"class":265,"line":631},[6074,6078,6082,6087],{"type":172,"tag":263,"props":6075,"children":6076},{"style":344},[6077],{"type":178,"value":5999},{"type":172,"tag":263,"props":6079,"children":6080},{"style":318},[6081],{"type":178,"value":455},{"type":172,"tag":263,"props":6083,"children":6084},{"style":344},[6085],{"type":178,"value":6086},"tm_hour",{"type":172,"tag":263,"props":6088,"children":6089},{"style":318},[6090],{"type":178,"value":4623},{"type":172,"tag":263,"props":6092,"children":6093},{"class":265,"line":674},[6094,6098,6102,6107],{"type":172,"tag":263,"props":6095,"children":6096},{"style":344},[6097],{"type":178,"value":5999},{"type":172,"tag":263,"props":6099,"children":6100},{"style":318},[6101],{"type":178,"value":455},{"type":172,"tag":263,"props":6103,"children":6104},{"style":344},[6105],{"type":178,"value":6106},"tm_min",{"type":172,"tag":263,"props":6108,"children":6109},{"style":318},[6110],{"type":178,"value":4623},{"type":172,"tag":263,"props":6112,"children":6113},{"class":265,"line":715},[6114,6118,6122,6127],{"type":172,"tag":263,"props":6115,"children":6116},{"style":344},[6117],{"type":178,"value":5999},{"type":172,"tag":263,"props":6119,"children":6120},{"style":318},[6121],{"type":178,"value":455},{"type":172,"tag":263,"props":6123,"children":6124},{"style":344},[6125],{"type":178,"value":6126},"tm_sec",{"type":172,"tag":263,"props":6128,"children":6129},{"style":318},[6130],{"type":178,"value":4623},{"type":172,"tag":263,"props":6132,"children":6133},{"class":265,"line":723},[6134,6139,6143,6147,6151,6155,6159,6164,6169],{"type":172,"tag":263,"props":6135,"children":6136},{"style":442},[6137],{"type":178,"value":6138},"              static_cast\u003C",{"type":172,"tag":263,"props":6140,"children":6141},{"style":306},[6142],{"type":178,"value":309},{"type":172,"tag":263,"props":6144,"children":6145},{"style":442},[6146],{"type":178,"value":2250},{"type":172,"tag":263,"props":6148,"children":6149},{"style":318},[6150],{"type":178,"value":400},{"type":172,"tag":263,"props":6152,"children":6153},{"style":344},[6154],{"type":178,"value":5736},{"type":172,"tag":263,"props":6156,"children":6157},{"style":318},[6158],{"type":178,"value":455},{"type":172,"tag":263,"props":6160,"children":6161},{"style":344},[6162],{"type":178,"value":6163},"tv_usec",{"type":172,"tag":263,"props":6165,"children":6166},{"style":318},[6167],{"type":178,"value":6168},"),",{"type":172,"tag":263,"props":6170,"children":6171},{"style":1272},[6172],{"type":178,"value":6173}," // 毫秒\n",{"type":172,"tag":263,"props":6175,"children":6176},{"class":265,"line":744},[6177,6182,6186,6190,6194,6198],{"type":172,"tag":263,"props":6178,"children":6179},{"style":344},[6180],{"type":178,"value":6181},"              ss",{"type":172,"tag":263,"props":6183,"children":6184},{"style":318},[6185],{"type":178,"value":455},{"type":172,"tag":263,"props":6187,"children":6188},{"style":312},[6189],{"type":178,"value":2842},{"type":172,"tag":263,"props":6191,"children":6192},{"style":318},[6193],{"type":178,"value":578},{"type":172,"tag":263,"props":6195,"children":6196},{"style":312},[6197],{"type":178,"value":583},{"type":172,"tag":263,"props":6199,"children":6200},{"style":318},[6201],{"type":178,"value":5641},{"type":172,"tag":263,"props":6203,"children":6204},{"class":265,"line":800},[6205,6210],{"type":172,"tag":263,"props":6206,"children":6207},{"style":344},[6208],{"type":178,"value":6209},"              logname",{"type":172,"tag":263,"props":6211,"children":6212},{"style":318},[6213],{"type":178,"value":430},{"type":172,"tag":6215,"props":6216,"children":6217},"style",{},[6218],{"type":178,"value":6219},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":166,"searchDepth":293,"depth":293,"links":6221},[6222,6223,6224,6225],{"id":182,"depth":293,"text":182},{"id":243,"depth":293,"text":243},{"id":3225,"depth":293,"text":3225},{"id":3238,"depth":293,"text":3238},"markdown","content:8.source-code:_cpp:kingdb.md","content","8.source-code/_cpp/kingdb.md","8.source-code/_cpp/kingdb","md",[6233,6237],{"_path":6234,"title":6235,"description":6236},"/source-code/_architecture/awade","Awade","中兴的一套低码系统。Jigsaw 是其前端组件库。",{"_path":6238,"title":6239,"description":166},"/source-code/_es/array-slice","Array.prototype.slice",1750854662642]