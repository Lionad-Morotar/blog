[{"data":1,"prerenderedAt":6237},["ShallowReactive",2],{"navigation":3,"/source-code/_cpp/kingdb":158,"/source-code/_cpp/kingdb-surround":6229},[4,35,89,95,122,128,152],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29,32],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🚝 四十二篇系列","/flows/fourty-two",{"title":15,"_path":16},"🌃 长夜梦","/flows/long-night-dream",{"title":18,"_path":19},"🌌 万物联结与幸福感","/flows/everything",{"title":21,"_path":22},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":24,"_path":25},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":27,"_path":28},"🌧️ 我的腼腆","/flows/shy",{"title":30,"_path":31},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":33,"_path":34},"📝 心流归档","/flows/archive",{"title":36,"_path":37,"children":38},"技术博客 / Coder","/articles",[39,41,44,47,50,53,56,59,62,65,68,71,74,77,80,83,86],{"title":40,"_path":37},"🦁 欢迎",{"title":42,"_path":43},"🌪️ Tailwind v4 如何兼容预处理器","/articles/tailwind4-with-sass",{"title":45,"_path":46},"🥞 在 tailwind 中使用现代化 CSS Layers","/articles/tailwind-sass-and-css-layer",{"title":48,"_path":49},"💻 本地部署 Qwen 翻译网页","/articles/local-translator",{"title":51,"_path":52},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":54,"_path":55},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":57,"_path":58},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":60,"_path":61},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":63,"_path":64},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":66,"_path":67},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":69,"_path":70},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":72,"_path":73},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":75,"_path":76},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":78,"_path":79},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":81,"_path":82},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":84,"_path":85},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":87,"_path":88},"📝 技术博客归档","/articles/archive",{"title":90,"_path":91,"children":92},"读书笔记 / Notes","/books",[93],{"title":94,"_path":91},"📕 读书笔记",{"title":96,"_path":97,"children":98},"吉他剧场 / Music","/music",[99,101,104,107,110,113,116,119],{"title":100,"_path":97},"🎸 FingerStyle！",{"title":102,"_path":103},"🌬️ 等待的风","/music/wind",{"title":105,"_path":106},"💕 约定的海洋","/music/ocean",{"title":108,"_path":109},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":111,"_path":112},"🌏 残酷天使的行动纲领","/music/eva",{"title":114,"_path":115},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":117,"_path":118},"🍷 Wu Wei","/music/wu-wei",{"title":120,"_path":121},"🌅 无题","/music/untitled",{"title":123,"_path":124,"children":125},"知识地图 / Maps","/maps",[126],{"title":127,"_path":124},"🏁 知识地图",{"title":129,"_path":130,"children":131},"造物 / Make","/tools",[132,134,137,140,143,146,149],{"title":133,"_path":130},"🧰 工具收集",{"title":135,"_path":136},"📕 博客","/tools/blog",{"title":138,"_path":139},"🥥 Coconut","/tools/coconut",{"title":141,"_path":142},"🧶 网易云音乐歌单排序","/tools/netease-sorter",{"title":144,"_path":145},"🌐 AnySort","/tools/anysort",{"title":147,"_path":148},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":150,"_path":151},"👓 Crapto","/tools/crypto-inline",{"title":153,"_path":154,"children":155},"我 / About","/hire",[156],{"title":157,"_path":154},"📬 技术简历",{"_path":159,"_dir":160,"_draft":161,"_partial":162,"_locale":163,"title":164,"description":163,"body":165,"_type":6223,"_id":6224,"_source":6225,"_file":6226,"_stem":6227,"_extension":6228},"/source-code/_cpp/kingdb","_cpp",false,true,"","KingDB",{"type":166,"children":167,"toc":6217},"root",[168,176,182,188,204,209,233,238,243,248,1107,1112,1120,1125,1130,1135,1141,1146,1567,1572,1577,2027,2032,2133,2138,2143,2148,2686,2692,2697,2964,2970,2975,3220,3225,3238,3243,3510,3515,3520,4231,4236,4417,4421,4426,5044,5049,5054,5107,5112,5131,5504,5509,5674,5679,5684,6211],{"type":169,"tag":170,"props":171,"children":173},"element","h1",{"id":172},"kingdb",[174],{"type":175,"value":164},"text",{"type":169,"tag":177,"props":178,"children":180},"h2",{"id":179},"概述",[181],{"type":175,"value":179},{"type":169,"tag":183,"props":184,"children":185},"p",{},[186],{"type":175,"value":187},"源码分两部分，从相关的测试文件，到核心源码。参考 IKVS 系列文章给的架构图，核心源码的阅读顺序沿着 Put、Delete、Get 三个接口，由 Database 一路向 Buffer、Event Manager、Storage Engine、HSTable Manager、File System 相关、Index 前进。最好再看相关快照、迭代器、Multipart 等部分。期间如果遇到简单的帮助函数会先讲帮助函数。",{"type":169,"tag":183,"props":189,"children":190},{},[191,193,202],{"type":175,"value":192},"本来想从第一个 Git Commit 开始看起的。但我 checkout 过去之后，碰到了一堆编译问题，根本跑不通，索性就直接回到 master 来看最新代码了。本文章的源码快照见 ",{"type":169,"tag":194,"props":195,"children":199},"a",{"href":196,"rel":197},"https://github.com/goossaert/kingdb/tree/58994280e789fc7248d61371f03a6c04c844c197",[198],"nofollow",[200],{"type":175,"value":201},"KingDB@58994",{"type":175,"value":203},"。阅读源码前可以先看一下 KingDB 的 Readme：doc/kingdb.md 以及 doc/kingserver.md。",{"type":169,"tag":183,"props":205,"children":206},{},[207],{"type":175,"value":208},"下文可能出现的缩写：",{"type":169,"tag":210,"props":211,"children":212},"ul",{},[213,219],{"type":169,"tag":214,"props":215,"children":216},"li",{},[217],{"type":175,"value":218},"KDB：KingDB，泛指，有时指 KingDB 程序，有时指 KingDB 源码。",{"type":169,"tag":214,"props":220,"children":221},{},[222,224,231],{"type":175,"value":223},"IKVS：作者相关 KingDB 做的一些调研及笔记的博客系列。这个系列从 13 年开始写，现在还没写完... 见 ",{"type":169,"tag":194,"props":225,"children":228},{"href":226,"rel":227},"https://codecapsule.com/2012/11/07/ikvs-implementing-a-key-value-store-table-of-contents/",[198],[229],{"type":175,"value":230},"IKVS",{"type":175,"value":232},"。",{"type":169,"tag":183,"props":234,"children":235},{},[236],{"type":175,"value":237},"另，为了简便起见，下文给出的代码很可能并非原本的代码，而是截取或经过剔除后的部分代码。比如说，去除了某函数中的错误处理，使之代码更短，更容易展示。",{"type":169,"tag":177,"props":239,"children":241},{"id":240},"从测试开始",[242],{"type":175,"value":240},{"type":169,"tag":183,"props":244,"children":245},{},[246],{"type":175,"value":247},"Emmanuel 给了一个典型的 KDB 用户使用示例，见 unit-tests/kingdb_user.cc。通过此示例，能大概了解 KDB 的接口及如何使用该接口。创建数据库、存入、读取前都需要创建对应的参数配置 Options；这些动作通过 Status 对象来回传操作成功与否。",{"type":169,"tag":249,"props":250,"children":254},"pre",{"code":251,"language":252,"meta":163,"className":253,"style":163},"#include \u003Ckingdb/kdb.h>\n\nint main() {\n  kdb::Status s;\n  kdb::DatabaseOptions db_options;\n  kdb::Database db(db_options, \"mylocaldb\");\n  s = db.Open();\n  if (!s.IsOK()) {\n    fprintf(stderr, \"Could not open the database: %s\\n\", s.ToString().c_str());\n    exit(1);\n  }\n\n  std::string key1(\"key1\");\n  std::string value1(\"value1\");\n\n  kdb::WriteOptions write_options;\n  s = db.Put(write_options, key1, value1);\n\n  kdb::ReadOptions read_options;\n  std::string out_str;\n  s = db.Get(read_options, key1, &out_str);\n  if (s.IsOK() && out_str == \"value1\") {\n    printf(\"Data successfully stored and retrieved\\n\"); \n  } else {\n    printf(\"An error occurred\\n\"); \n  }\n\n  return 0;\n}\n","cpp","language-cpp shiki shiki-themes material-theme-lighter github-light github-dark monokai",[255],{"type":169,"tag":256,"props":257,"children":258},"code",{"__ignoreMap":163},[259,288,297,324,350,371,428,463,505,586,609,618,626,669,710,718,739,795,803,824,845,905,969,1009,1027,1064,1072,1080,1098],{"type":169,"tag":260,"props":261,"children":264},"span",{"class":262,"line":263},"line",1,[265,271,277,283],{"type":169,"tag":260,"props":266,"children":268},{"style":267},"--shiki-light:#39ADB5;--shiki-light-font-style:italic;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#F92672;--shiki-sepia-font-style:inherit",[269],{"type":175,"value":270},"#include",{"type":169,"tag":260,"props":272,"children":274},{"style":273},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[275],{"type":175,"value":276}," \u003C",{"type":169,"tag":260,"props":278,"children":280},{"style":279},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[281],{"type":175,"value":282},"kingdb/kdb.h",{"type":169,"tag":260,"props":284,"children":285},{"style":273},[286],{"type":175,"value":287},">\n",{"type":169,"tag":260,"props":289,"children":291},{"class":262,"line":290},2,[292],{"type":169,"tag":260,"props":293,"children":294},{"emptyLinePlaceholder":162},[295],{"type":175,"value":296},"\n",{"type":169,"tag":260,"props":298,"children":300},{"class":262,"line":299},3,[301,307,313,319],{"type":169,"tag":260,"props":302,"children":304},{"style":303},"--shiki-light:#9C3EDA;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic",[305],{"type":175,"value":306},"int",{"type":169,"tag":260,"props":308,"children":310},{"style":309},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[311],{"type":175,"value":312}," main",{"type":169,"tag":260,"props":314,"children":316},{"style":315},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[317],{"type":175,"value":318},"()",{"type":169,"tag":260,"props":320,"children":321},{"style":315},[322],{"type":175,"value":323}," {\n",{"type":169,"tag":260,"props":325,"children":327},{"class":262,"line":326},4,[328,334,339,345],{"type":169,"tag":260,"props":329,"children":331},{"style":330},"--shiki-light:#E2931D;--shiki-light-text-decoration:inherit;--shiki-default:#6F42C1;--shiki-default-text-decoration:inherit;--shiki-dark:#B392F0;--shiki-dark-text-decoration:inherit;--shiki-sepia:#A6E22E;--shiki-sepia-text-decoration:underline",[332],{"type":175,"value":333},"  kdb",{"type":169,"tag":260,"props":335,"children":336},{"style":315},[337],{"type":175,"value":338},"::",{"type":169,"tag":260,"props":340,"children":342},{"style":341},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[343],{"type":175,"value":344},"Status s",{"type":169,"tag":260,"props":346,"children":347},{"style":315},[348],{"type":175,"value":349},";\n",{"type":169,"tag":260,"props":351,"children":353},{"class":262,"line":352},5,[354,358,362,367],{"type":169,"tag":260,"props":355,"children":356},{"style":330},[357],{"type":175,"value":333},{"type":169,"tag":260,"props":359,"children":360},{"style":315},[361],{"type":175,"value":338},{"type":169,"tag":260,"props":363,"children":364},{"style":341},[365],{"type":175,"value":366},"DatabaseOptions db_options",{"type":169,"tag":260,"props":368,"children":369},{"style":315},[370],{"type":175,"value":349},{"type":169,"tag":260,"props":372,"children":374},{"class":262,"line":373},6,[375,379,383,388,393,398,403,408,413,418,423],{"type":169,"tag":260,"props":376,"children":377},{"style":330},[378],{"type":175,"value":333},{"type":169,"tag":260,"props":380,"children":381},{"style":315},[382],{"type":175,"value":338},{"type":169,"tag":260,"props":384,"children":385},{"style":341},[386],{"type":175,"value":387},"Database ",{"type":169,"tag":260,"props":389,"children":390},{"style":309},[391],{"type":175,"value":392},"db",{"type":169,"tag":260,"props":394,"children":395},{"style":315},[396],{"type":175,"value":397},"(",{"type":169,"tag":260,"props":399,"children":400},{"style":341},[401],{"type":175,"value":402},"db_options",{"type":169,"tag":260,"props":404,"children":405},{"style":315},[406],{"type":175,"value":407},",",{"type":169,"tag":260,"props":409,"children":410},{"style":273},[411],{"type":175,"value":412}," \"",{"type":169,"tag":260,"props":414,"children":415},{"style":279},[416],{"type":175,"value":417},"mylocaldb",{"type":169,"tag":260,"props":419,"children":420},{"style":273},[421],{"type":175,"value":422},"\"",{"type":169,"tag":260,"props":424,"children":425},{"style":315},[426],{"type":175,"value":427},");\n",{"type":169,"tag":260,"props":429,"children":431},{"class":262,"line":430},7,[432,437,443,448,453,458],{"type":169,"tag":260,"props":433,"children":434},{"style":341},[435],{"type":175,"value":436},"  s ",{"type":169,"tag":260,"props":438,"children":440},{"style":439},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[441],{"type":175,"value":442},"=",{"type":169,"tag":260,"props":444,"children":445},{"style":341},[446],{"type":175,"value":447}," db",{"type":169,"tag":260,"props":449,"children":450},{"style":315},[451],{"type":175,"value":452},".",{"type":169,"tag":260,"props":454,"children":455},{"style":309},[456],{"type":175,"value":457},"Open",{"type":169,"tag":260,"props":459,"children":460},{"style":315},[461],{"type":175,"value":462},"();\n",{"type":169,"tag":260,"props":464,"children":466},{"class":262,"line":465},8,[467,472,477,482,487,491,496,501],{"type":169,"tag":260,"props":468,"children":469},{"style":267},[470],{"type":175,"value":471},"  if",{"type":169,"tag":260,"props":473,"children":474},{"style":315},[475],{"type":175,"value":476}," (",{"type":169,"tag":260,"props":478,"children":479},{"style":439},[480],{"type":175,"value":481},"!",{"type":169,"tag":260,"props":483,"children":484},{"style":341},[485],{"type":175,"value":486},"s",{"type":169,"tag":260,"props":488,"children":489},{"style":315},[490],{"type":175,"value":452},{"type":169,"tag":260,"props":492,"children":493},{"style":309},[494],{"type":175,"value":495},"IsOK",{"type":169,"tag":260,"props":497,"children":498},{"style":315},[499],{"type":175,"value":500},"())",{"type":169,"tag":260,"props":502,"children":503},{"style":315},[504],{"type":175,"value":323},{"type":169,"tag":260,"props":506,"children":508},{"class":262,"line":507},9,[509,514,518,524,528,532,537,543,549,553,557,562,566,571,576,581],{"type":169,"tag":260,"props":510,"children":511},{"style":309},[512],{"type":175,"value":513},"    fprintf",{"type":169,"tag":260,"props":515,"children":516},{"style":315},[517],{"type":175,"value":397},{"type":169,"tag":260,"props":519,"children":521},{"style":520},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[522],{"type":175,"value":523},"stderr",{"type":169,"tag":260,"props":525,"children":526},{"style":315},[527],{"type":175,"value":407},{"type":169,"tag":260,"props":529,"children":530},{"style":273},[531],{"type":175,"value":412},{"type":169,"tag":260,"props":533,"children":534},{"style":279},[535],{"type":175,"value":536},"Could not open the database: ",{"type":169,"tag":260,"props":538,"children":540},{"style":539},"--shiki-light:#E53935;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[541],{"type":175,"value":542},"%s",{"type":169,"tag":260,"props":544,"children":546},{"style":545},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[547],{"type":175,"value":548},"\\n",{"type":169,"tag":260,"props":550,"children":551},{"style":273},[552],{"type":175,"value":422},{"type":169,"tag":260,"props":554,"children":555},{"style":315},[556],{"type":175,"value":407},{"type":169,"tag":260,"props":558,"children":559},{"style":341},[560],{"type":175,"value":561}," s",{"type":169,"tag":260,"props":563,"children":564},{"style":315},[565],{"type":175,"value":452},{"type":169,"tag":260,"props":567,"children":568},{"style":309},[569],{"type":175,"value":570},"ToString",{"type":169,"tag":260,"props":572,"children":573},{"style":315},[574],{"type":175,"value":575},"().",{"type":169,"tag":260,"props":577,"children":578},{"style":309},[579],{"type":175,"value":580},"c_str",{"type":169,"tag":260,"props":582,"children":583},{"style":315},[584],{"type":175,"value":585},"());\n",{"type":169,"tag":260,"props":587,"children":589},{"class":262,"line":588},10,[590,595,599,605],{"type":169,"tag":260,"props":591,"children":592},{"style":309},[593],{"type":175,"value":594},"    exit",{"type":169,"tag":260,"props":596,"children":597},{"style":315},[598],{"type":175,"value":397},{"type":169,"tag":260,"props":600,"children":602},{"style":601},"--shiki-light:#F76D47;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[603],{"type":175,"value":604},"1",{"type":169,"tag":260,"props":606,"children":607},{"style":315},[608],{"type":175,"value":427},{"type":169,"tag":260,"props":610,"children":612},{"class":262,"line":611},11,[613],{"type":169,"tag":260,"props":614,"children":615},{"style":315},[616],{"type":175,"value":617},"  }\n",{"type":169,"tag":260,"props":619,"children":621},{"class":262,"line":620},12,[622],{"type":169,"tag":260,"props":623,"children":624},{"emptyLinePlaceholder":162},[625],{"type":175,"value":296},{"type":169,"tag":260,"props":627,"children":629},{"class":262,"line":628},13,[630,635,639,644,649,653,657,661,665],{"type":169,"tag":260,"props":631,"children":632},{"style":330},[633],{"type":175,"value":634},"  std",{"type":169,"tag":260,"props":636,"children":637},{"style":315},[638],{"type":175,"value":338},{"type":169,"tag":260,"props":640,"children":641},{"style":341},[642],{"type":175,"value":643},"string ",{"type":169,"tag":260,"props":645,"children":646},{"style":309},[647],{"type":175,"value":648},"key1",{"type":169,"tag":260,"props":650,"children":651},{"style":315},[652],{"type":175,"value":397},{"type":169,"tag":260,"props":654,"children":655},{"style":273},[656],{"type":175,"value":422},{"type":169,"tag":260,"props":658,"children":659},{"style":279},[660],{"type":175,"value":648},{"type":169,"tag":260,"props":662,"children":663},{"style":273},[664],{"type":175,"value":422},{"type":169,"tag":260,"props":666,"children":667},{"style":315},[668],{"type":175,"value":427},{"type":169,"tag":260,"props":670,"children":672},{"class":262,"line":671},14,[673,677,681,685,690,694,698,702,706],{"type":169,"tag":260,"props":674,"children":675},{"style":330},[676],{"type":175,"value":634},{"type":169,"tag":260,"props":678,"children":679},{"style":315},[680],{"type":175,"value":338},{"type":169,"tag":260,"props":682,"children":683},{"style":341},[684],{"type":175,"value":643},{"type":169,"tag":260,"props":686,"children":687},{"style":309},[688],{"type":175,"value":689},"value1",{"type":169,"tag":260,"props":691,"children":692},{"style":315},[693],{"type":175,"value":397},{"type":169,"tag":260,"props":695,"children":696},{"style":273},[697],{"type":175,"value":422},{"type":169,"tag":260,"props":699,"children":700},{"style":279},[701],{"type":175,"value":689},{"type":169,"tag":260,"props":703,"children":704},{"style":273},[705],{"type":175,"value":422},{"type":169,"tag":260,"props":707,"children":708},{"style":315},[709],{"type":175,"value":427},{"type":169,"tag":260,"props":711,"children":713},{"class":262,"line":712},15,[714],{"type":169,"tag":260,"props":715,"children":716},{"emptyLinePlaceholder":162},[717],{"type":175,"value":296},{"type":169,"tag":260,"props":719,"children":721},{"class":262,"line":720},16,[722,726,730,735],{"type":169,"tag":260,"props":723,"children":724},{"style":330},[725],{"type":175,"value":333},{"type":169,"tag":260,"props":727,"children":728},{"style":315},[729],{"type":175,"value":338},{"type":169,"tag":260,"props":731,"children":732},{"style":341},[733],{"type":175,"value":734},"WriteOptions write_options",{"type":169,"tag":260,"props":736,"children":737},{"style":315},[738],{"type":175,"value":349},{"type":169,"tag":260,"props":740,"children":742},{"class":262,"line":741},17,[743,747,751,755,759,764,768,773,777,782,786,791],{"type":169,"tag":260,"props":744,"children":745},{"style":341},[746],{"type":175,"value":436},{"type":169,"tag":260,"props":748,"children":749},{"style":439},[750],{"type":175,"value":442},{"type":169,"tag":260,"props":752,"children":753},{"style":341},[754],{"type":175,"value":447},{"type":169,"tag":260,"props":756,"children":757},{"style":315},[758],{"type":175,"value":452},{"type":169,"tag":260,"props":760,"children":761},{"style":309},[762],{"type":175,"value":763},"Put",{"type":169,"tag":260,"props":765,"children":766},{"style":315},[767],{"type":175,"value":397},{"type":169,"tag":260,"props":769,"children":770},{"style":341},[771],{"type":175,"value":772},"write_options",{"type":169,"tag":260,"props":774,"children":775},{"style":315},[776],{"type":175,"value":407},{"type":169,"tag":260,"props":778,"children":779},{"style":341},[780],{"type":175,"value":781}," key1",{"type":169,"tag":260,"props":783,"children":784},{"style":315},[785],{"type":175,"value":407},{"type":169,"tag":260,"props":787,"children":788},{"style":341},[789],{"type":175,"value":790}," value1",{"type":169,"tag":260,"props":792,"children":793},{"style":315},[794],{"type":175,"value":427},{"type":169,"tag":260,"props":796,"children":798},{"class":262,"line":797},18,[799],{"type":169,"tag":260,"props":800,"children":801},{"emptyLinePlaceholder":162},[802],{"type":175,"value":296},{"type":169,"tag":260,"props":804,"children":806},{"class":262,"line":805},19,[807,811,815,820],{"type":169,"tag":260,"props":808,"children":809},{"style":330},[810],{"type":175,"value":333},{"type":169,"tag":260,"props":812,"children":813},{"style":315},[814],{"type":175,"value":338},{"type":169,"tag":260,"props":816,"children":817},{"style":341},[818],{"type":175,"value":819},"ReadOptions read_options",{"type":169,"tag":260,"props":821,"children":822},{"style":315},[823],{"type":175,"value":349},{"type":169,"tag":260,"props":825,"children":827},{"class":262,"line":826},20,[828,832,836,841],{"type":169,"tag":260,"props":829,"children":830},{"style":330},[831],{"type":175,"value":634},{"type":169,"tag":260,"props":833,"children":834},{"style":315},[835],{"type":175,"value":338},{"type":169,"tag":260,"props":837,"children":838},{"style":341},[839],{"type":175,"value":840},"string out_str",{"type":169,"tag":260,"props":842,"children":843},{"style":315},[844],{"type":175,"value":349},{"type":169,"tag":260,"props":846,"children":848},{"class":262,"line":847},21,[849,853,857,861,865,870,874,879,883,887,891,896,901],{"type":169,"tag":260,"props":850,"children":851},{"style":341},[852],{"type":175,"value":436},{"type":169,"tag":260,"props":854,"children":855},{"style":439},[856],{"type":175,"value":442},{"type":169,"tag":260,"props":858,"children":859},{"style":341},[860],{"type":175,"value":447},{"type":169,"tag":260,"props":862,"children":863},{"style":315},[864],{"type":175,"value":452},{"type":169,"tag":260,"props":866,"children":867},{"style":309},[868],{"type":175,"value":869},"Get",{"type":169,"tag":260,"props":871,"children":872},{"style":315},[873],{"type":175,"value":397},{"type":169,"tag":260,"props":875,"children":876},{"style":341},[877],{"type":175,"value":878},"read_options",{"type":169,"tag":260,"props":880,"children":881},{"style":315},[882],{"type":175,"value":407},{"type":169,"tag":260,"props":884,"children":885},{"style":341},[886],{"type":175,"value":781},{"type":169,"tag":260,"props":888,"children":889},{"style":315},[890],{"type":175,"value":407},{"type":169,"tag":260,"props":892,"children":893},{"style":439},[894],{"type":175,"value":895}," &",{"type":169,"tag":260,"props":897,"children":898},{"style":341},[899],{"type":175,"value":900},"out_str",{"type":169,"tag":260,"props":902,"children":903},{"style":315},[904],{"type":175,"value":427},{"type":169,"tag":260,"props":906,"children":908},{"class":262,"line":907},22,[909,913,917,921,925,929,933,938,943,948,952,956,960,965],{"type":169,"tag":260,"props":910,"children":911},{"style":267},[912],{"type":175,"value":471},{"type":169,"tag":260,"props":914,"children":915},{"style":315},[916],{"type":175,"value":476},{"type":169,"tag":260,"props":918,"children":919},{"style":341},[920],{"type":175,"value":486},{"type":169,"tag":260,"props":922,"children":923},{"style":315},[924],{"type":175,"value":452},{"type":169,"tag":260,"props":926,"children":927},{"style":309},[928],{"type":175,"value":495},{"type":169,"tag":260,"props":930,"children":931},{"style":315},[932],{"type":175,"value":318},{"type":169,"tag":260,"props":934,"children":935},{"style":439},[936],{"type":175,"value":937}," &&",{"type":169,"tag":260,"props":939,"children":940},{"style":341},[941],{"type":175,"value":942}," out_str ",{"type":169,"tag":260,"props":944,"children":945},{"style":439},[946],{"type":175,"value":947},"==",{"type":169,"tag":260,"props":949,"children":950},{"style":273},[951],{"type":175,"value":412},{"type":169,"tag":260,"props":953,"children":954},{"style":279},[955],{"type":175,"value":689},{"type":169,"tag":260,"props":957,"children":958},{"style":273},[959],{"type":175,"value":422},{"type":169,"tag":260,"props":961,"children":962},{"style":315},[963],{"type":175,"value":964},")",{"type":169,"tag":260,"props":966,"children":967},{"style":315},[968],{"type":175,"value":323},{"type":169,"tag":260,"props":970,"children":972},{"class":262,"line":971},23,[973,978,982,986,991,995,999,1004],{"type":169,"tag":260,"props":974,"children":975},{"style":309},[976],{"type":175,"value":977},"    printf",{"type":169,"tag":260,"props":979,"children":980},{"style":315},[981],{"type":175,"value":397},{"type":169,"tag":260,"props":983,"children":984},{"style":273},[985],{"type":175,"value":422},{"type":169,"tag":260,"props":987,"children":988},{"style":279},[989],{"type":175,"value":990},"Data successfully stored and retrieved",{"type":169,"tag":260,"props":992,"children":993},{"style":545},[994],{"type":175,"value":548},{"type":169,"tag":260,"props":996,"children":997},{"style":273},[998],{"type":175,"value":422},{"type":169,"tag":260,"props":1000,"children":1001},{"style":315},[1002],{"type":175,"value":1003},");",{"type":169,"tag":260,"props":1005,"children":1006},{"style":520},[1007],{"type":175,"value":1008}," \n",{"type":169,"tag":260,"props":1010,"children":1012},{"class":262,"line":1011},24,[1013,1018,1023],{"type":169,"tag":260,"props":1014,"children":1015},{"style":315},[1016],{"type":175,"value":1017},"  }",{"type":169,"tag":260,"props":1019,"children":1020},{"style":267},[1021],{"type":175,"value":1022}," else",{"type":169,"tag":260,"props":1024,"children":1025},{"style":315},[1026],{"type":175,"value":323},{"type":169,"tag":260,"props":1028,"children":1030},{"class":262,"line":1029},25,[1031,1035,1039,1043,1048,1052,1056,1060],{"type":169,"tag":260,"props":1032,"children":1033},{"style":309},[1034],{"type":175,"value":977},{"type":169,"tag":260,"props":1036,"children":1037},{"style":315},[1038],{"type":175,"value":397},{"type":169,"tag":260,"props":1040,"children":1041},{"style":273},[1042],{"type":175,"value":422},{"type":169,"tag":260,"props":1044,"children":1045},{"style":279},[1046],{"type":175,"value":1047},"An error occurred",{"type":169,"tag":260,"props":1049,"children":1050},{"style":545},[1051],{"type":175,"value":548},{"type":169,"tag":260,"props":1053,"children":1054},{"style":273},[1055],{"type":175,"value":422},{"type":169,"tag":260,"props":1057,"children":1058},{"style":315},[1059],{"type":175,"value":1003},{"type":169,"tag":260,"props":1061,"children":1062},{"style":520},[1063],{"type":175,"value":1008},{"type":169,"tag":260,"props":1065,"children":1067},{"class":262,"line":1066},26,[1068],{"type":169,"tag":260,"props":1069,"children":1070},{"style":315},[1071],{"type":175,"value":617},{"type":169,"tag":260,"props":1073,"children":1075},{"class":262,"line":1074},27,[1076],{"type":169,"tag":260,"props":1077,"children":1078},{"emptyLinePlaceholder":162},[1079],{"type":175,"value":296},{"type":169,"tag":260,"props":1081,"children":1083},{"class":262,"line":1082},28,[1084,1089,1094],{"type":169,"tag":260,"props":1085,"children":1086},{"style":267},[1087],{"type":175,"value":1088},"  return",{"type":169,"tag":260,"props":1090,"children":1091},{"style":601},[1092],{"type":175,"value":1093}," 0",{"type":169,"tag":260,"props":1095,"children":1096},{"style":315},[1097],{"type":175,"value":349},{"type":169,"tag":260,"props":1099,"children":1101},{"class":262,"line":1100},29,[1102],{"type":169,"tag":260,"props":1103,"children":1104},{"style":315},[1105],{"type":175,"value":1106},"}\n",{"type":169,"tag":183,"props":1108,"children":1109},{},[1110],{"type":175,"value":1111},"测试的入口文件是 unit-tests/test_db.cc。以我看过的 JS 库来看，这是一个基本的功能测试。编译好 KDB 之后，运行编译出的二进制文件 test_db 可以开始测试。测试结果输出到控制台，如下代码所示。",{"type":169,"tag":249,"props":1113,"children":1115},{"code":1114},"==== Test DBTest.CloseAndReopen\n==== Test DBTest.RepairInvalidDatabaseOptionFile\n==== Test DBTest.KeysWithNullBytes\n==== Test DBTest.TestStringInterface\nDatabase Options: Stage 0 - Incompressible data with LZ4 compression enabled\nDatabase Options: Stage 1 - Compressible data with LZ4 compression enabled\nDatabase Options: Stage 2 - Compression disabled\nDatabase Options: Stage 3 - 64-bit MurmurHash3\nDatabase Options: Stage 4 - Checksum verification with incompressible data\nDatabase Options: Stage 5 - Checksum verification with compressible data\nDatabase Options: Stage 6 - Checksum verification with compression disabled\nDatabase Options: Stage 7 - Synced writes\nDatabase Options: Stage 8 - Small-sized HSTables with compression disabled\nDatabase Options: Stage 9 - Small-sized HSTables with incompressible data and LZ4 compression\nDatabase Options: Stage 10 - Small-sized HSTables with compressible data and LZ4 compression\nDatabase Options: Stage 11 - Direct mode for Write Buffer (incompressible data with LZ4 compression enabled)\nDatabase Options: Stage 12 - Direct mode for Write Buffer (compressible data with LZ4 compression enabled)\n==== Test DBTest.MultipartReader\n// the same with last stages\n==== Test DBTest.SingleThreadSmallEntries\n// the same with last stages\n==== Test DBTest.SingleThreadSnapshot\n// the same with last stages\n==== Test DBTest.SingleThreadSmallEntriesCompaction\n// the same with last stages\n==== Test DBTest.SequentialIterator\n// the same with last stages\n==== Test DBTest.SingleThreadSingleLargeEntry\n// the same with last stages\n==== Test DBTest.FileUtil\nmysize: 268435456\nOK\n89 ms\nFree size: 944 GB\n==== PASSED 11 tests\n",[1116],{"type":169,"tag":256,"props":1117,"children":1118},{"__ignoreMap":163},[1119],{"type":175,"value":1114},{"type":169,"tag":183,"props":1121,"children":1122},{},[1123],{"type":175,"value":1124},"每个功能点如数据库初始化和关闭 CloseAndReopen、存入带结束符的键 KeysWithNullBytes 都使用对应继承了 DBTest 的测试类进行测试。涉及到与数据库交互的功能部分如 TestStringInterface 使用循环，遍历了所有数据库 Options 可以设置的情况（但是只是二维循环，没有测试参数间的组合）。即对应上文的 Stage 1、Stage 2...",{"type":169,"tag":183,"props":1126,"children":1127},{},[1128],{"type":175,"value":1129},"在 test_db 创建相应的测试类时，会自动调用测试套件（unit-tests/testharness.cc）中的 RegisterTest 把测试函数储存起来。以便运行测试时，通过读取环境变量来判断是否要跳过某类测试。",{"type":169,"tag":183,"props":1131,"children":1132},{},[1133],{"type":175,"value":1134},"测试代码的实现还有一些有意思的地方，以下提及。",{"type":169,"tag":1136,"props":1137,"children":1139},"h4",{"id":1138},"信号处理",[1140],{"type":175,"value":1138},{"type":169,"tag":183,"props":1142,"children":1143},{},[1144],{"type":175,"value":1145},"和数据库核心的入口函数一样，使用 signal 挂载了对 SIGSEGV、SIGABRT 信号的处理。这两个信号分别指代系统内存错误和系统中断。而处理函数非常简单，就是 IKVS 中提到的“let it die”风格：输出调用栈，立马结束程序。",{"type":169,"tag":249,"props":1147,"children":1149},{"code":1148,"language":252,"meta":163,"className":253,"style":163},"void handler(int sig) {\n  int depth_max = 20;\n  void *array[depth_max];\n  size_t depth;\n  // backtrace 将前 depth_max 层栈帧记录到 array 数组中，\n  // 再通过 backtrace_symbols_fd 输出到 stderr。\n  // 文档见：https://man7.org/linux/man-pages/man3/backtrace.3.html\n  depth = backtrace(array, depth_max);\n  fprintf(stderr, \"Error: signal %d:\\n\", sig);\n  backtrace_symbols_fd(array, depth, STDERR_FILENO);\n  exit(1);\n}\nint main() {\n  signal(SIGSEGV, handler);\n  signal(SIGABRT, handler);\n  return kdb::test::RunAllTests();\n}\n",[1150],{"type":169,"tag":256,"props":1151,"children":1152},{"__ignoreMap":163},[1153,1188,1214,1247,1264,1273,1281,1289,1327,1386,1423,1443,1450,1469,1498,1526,1560],{"type":169,"tag":260,"props":1154,"children":1155},{"class":262,"line":263},[1156,1161,1166,1170,1174,1180,1184],{"type":169,"tag":260,"props":1157,"children":1158},{"style":303},[1159],{"type":175,"value":1160},"void",{"type":169,"tag":260,"props":1162,"children":1163},{"style":309},[1164],{"type":175,"value":1165}," handler",{"type":169,"tag":260,"props":1167,"children":1168},{"style":315},[1169],{"type":175,"value":397},{"type":169,"tag":260,"props":1171,"children":1172},{"style":303},[1173],{"type":175,"value":306},{"type":169,"tag":260,"props":1175,"children":1177},{"style":1176},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#E36209;--shiki-default-font-style:inherit;--shiki-dark:#FFAB70;--shiki-dark-font-style:inherit;--shiki-sepia:#FD971F;--shiki-sepia-font-style:italic",[1178],{"type":175,"value":1179}," sig",{"type":169,"tag":260,"props":1181,"children":1182},{"style":315},[1183],{"type":175,"value":964},{"type":169,"tag":260,"props":1185,"children":1186},{"style":315},[1187],{"type":175,"value":323},{"type":169,"tag":260,"props":1189,"children":1190},{"class":262,"line":290},[1191,1196,1201,1205,1210],{"type":169,"tag":260,"props":1192,"children":1193},{"style":303},[1194],{"type":175,"value":1195},"  int",{"type":169,"tag":260,"props":1197,"children":1198},{"style":341},[1199],{"type":175,"value":1200}," depth_max ",{"type":169,"tag":260,"props":1202,"children":1203},{"style":439},[1204],{"type":175,"value":442},{"type":169,"tag":260,"props":1206,"children":1207},{"style":601},[1208],{"type":175,"value":1209}," 20",{"type":169,"tag":260,"props":1211,"children":1212},{"style":315},[1213],{"type":175,"value":349},{"type":169,"tag":260,"props":1215,"children":1216},{"class":262,"line":299},[1217,1222,1227,1232,1237,1242],{"type":169,"tag":260,"props":1218,"children":1219},{"style":303},[1220],{"type":175,"value":1221},"  void",{"type":169,"tag":260,"props":1223,"children":1224},{"style":439},[1225],{"type":175,"value":1226}," *",{"type":169,"tag":260,"props":1228,"children":1229},{"style":341},[1230],{"type":175,"value":1231},"array",{"type":169,"tag":260,"props":1233,"children":1234},{"style":315},[1235],{"type":175,"value":1236},"[",{"type":169,"tag":260,"props":1238,"children":1239},{"style":341},[1240],{"type":175,"value":1241},"depth_max",{"type":169,"tag":260,"props":1243,"children":1244},{"style":315},[1245],{"type":175,"value":1246},"];\n",{"type":169,"tag":260,"props":1248,"children":1249},{"class":262,"line":326},[1250,1255,1260],{"type":169,"tag":260,"props":1251,"children":1252},{"style":303},[1253],{"type":175,"value":1254},"  size_t",{"type":169,"tag":260,"props":1256,"children":1257},{"style":341},[1258],{"type":175,"value":1259}," depth",{"type":169,"tag":260,"props":1261,"children":1262},{"style":315},[1263],{"type":175,"value":349},{"type":169,"tag":260,"props":1265,"children":1266},{"class":262,"line":352},[1267],{"type":169,"tag":260,"props":1268,"children":1270},{"style":1269},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit",[1271],{"type":175,"value":1272},"  // backtrace 将前 depth_max 层栈帧记录到 array 数组中，\n",{"type":169,"tag":260,"props":1274,"children":1275},{"class":262,"line":373},[1276],{"type":169,"tag":260,"props":1277,"children":1278},{"style":1269},[1279],{"type":175,"value":1280},"  // 再通过 backtrace_symbols_fd 输出到 stderr。\n",{"type":169,"tag":260,"props":1282,"children":1283},{"class":262,"line":430},[1284],{"type":169,"tag":260,"props":1285,"children":1286},{"style":1269},[1287],{"type":175,"value":1288},"  // 文档见：https://man7.org/linux/man-pages/man3/backtrace.3.html\n",{"type":169,"tag":260,"props":1290,"children":1291},{"class":262,"line":465},[1292,1297,1301,1306,1310,1314,1318,1323],{"type":169,"tag":260,"props":1293,"children":1294},{"style":341},[1295],{"type":175,"value":1296},"  depth ",{"type":169,"tag":260,"props":1298,"children":1299},{"style":439},[1300],{"type":175,"value":442},{"type":169,"tag":260,"props":1302,"children":1303},{"style":309},[1304],{"type":175,"value":1305}," backtrace",{"type":169,"tag":260,"props":1307,"children":1308},{"style":315},[1309],{"type":175,"value":397},{"type":169,"tag":260,"props":1311,"children":1312},{"style":341},[1313],{"type":175,"value":1231},{"type":169,"tag":260,"props":1315,"children":1316},{"style":315},[1317],{"type":175,"value":407},{"type":169,"tag":260,"props":1319,"children":1320},{"style":341},[1321],{"type":175,"value":1322}," depth_max",{"type":169,"tag":260,"props":1324,"children":1325},{"style":315},[1326],{"type":175,"value":427},{"type":169,"tag":260,"props":1328,"children":1329},{"class":262,"line":507},[1330,1335,1339,1343,1347,1351,1356,1361,1366,1370,1374,1378,1382],{"type":169,"tag":260,"props":1331,"children":1332},{"style":309},[1333],{"type":175,"value":1334},"  fprintf",{"type":169,"tag":260,"props":1336,"children":1337},{"style":315},[1338],{"type":175,"value":397},{"type":169,"tag":260,"props":1340,"children":1341},{"style":341},[1342],{"type":175,"value":523},{"type":169,"tag":260,"props":1344,"children":1345},{"style":315},[1346],{"type":175,"value":407},{"type":169,"tag":260,"props":1348,"children":1349},{"style":273},[1350],{"type":175,"value":412},{"type":169,"tag":260,"props":1352,"children":1353},{"style":279},[1354],{"type":175,"value":1355},"Error: signal ",{"type":169,"tag":260,"props":1357,"children":1358},{"style":539},[1359],{"type":175,"value":1360},"%d",{"type":169,"tag":260,"props":1362,"children":1363},{"style":279},[1364],{"type":175,"value":1365},":",{"type":169,"tag":260,"props":1367,"children":1368},{"style":545},[1369],{"type":175,"value":548},{"type":169,"tag":260,"props":1371,"children":1372},{"style":273},[1373],{"type":175,"value":422},{"type":169,"tag":260,"props":1375,"children":1376},{"style":315},[1377],{"type":175,"value":407},{"type":169,"tag":260,"props":1379,"children":1380},{"style":341},[1381],{"type":175,"value":1179},{"type":169,"tag":260,"props":1383,"children":1384},{"style":315},[1385],{"type":175,"value":427},{"type":169,"tag":260,"props":1387,"children":1388},{"class":262,"line":588},[1389,1394,1398,1402,1406,1410,1414,1419],{"type":169,"tag":260,"props":1390,"children":1391},{"style":309},[1392],{"type":175,"value":1393},"  backtrace_symbols_fd",{"type":169,"tag":260,"props":1395,"children":1396},{"style":315},[1397],{"type":175,"value":397},{"type":169,"tag":260,"props":1399,"children":1400},{"style":341},[1401],{"type":175,"value":1231},{"type":169,"tag":260,"props":1403,"children":1404},{"style":315},[1405],{"type":175,"value":407},{"type":169,"tag":260,"props":1407,"children":1408},{"style":341},[1409],{"type":175,"value":1259},{"type":169,"tag":260,"props":1411,"children":1412},{"style":315},[1413],{"type":175,"value":407},{"type":169,"tag":260,"props":1415,"children":1416},{"style":341},[1417],{"type":175,"value":1418}," STDERR_FILENO",{"type":169,"tag":260,"props":1420,"children":1421},{"style":315},[1422],{"type":175,"value":427},{"type":169,"tag":260,"props":1424,"children":1425},{"class":262,"line":611},[1426,1431,1435,1439],{"type":169,"tag":260,"props":1427,"children":1428},{"style":309},[1429],{"type":175,"value":1430},"  exit",{"type":169,"tag":260,"props":1432,"children":1433},{"style":315},[1434],{"type":175,"value":397},{"type":169,"tag":260,"props":1436,"children":1437},{"style":601},[1438],{"type":175,"value":604},{"type":169,"tag":260,"props":1440,"children":1441},{"style":315},[1442],{"type":175,"value":427},{"type":169,"tag":260,"props":1444,"children":1445},{"class":262,"line":620},[1446],{"type":169,"tag":260,"props":1447,"children":1448},{"style":315},[1449],{"type":175,"value":1106},{"type":169,"tag":260,"props":1451,"children":1452},{"class":262,"line":628},[1453,1457,1461,1465],{"type":169,"tag":260,"props":1454,"children":1455},{"style":303},[1456],{"type":175,"value":306},{"type":169,"tag":260,"props":1458,"children":1459},{"style":309},[1460],{"type":175,"value":312},{"type":169,"tag":260,"props":1462,"children":1463},{"style":315},[1464],{"type":175,"value":318},{"type":169,"tag":260,"props":1466,"children":1467},{"style":315},[1468],{"type":175,"value":323},{"type":169,"tag":260,"props":1470,"children":1471},{"class":262,"line":671},[1472,1477,1481,1486,1490,1494],{"type":169,"tag":260,"props":1473,"children":1474},{"style":309},[1475],{"type":175,"value":1476},"  signal",{"type":169,"tag":260,"props":1478,"children":1479},{"style":315},[1480],{"type":175,"value":397},{"type":169,"tag":260,"props":1482,"children":1483},{"style":341},[1484],{"type":175,"value":1485},"SIGSEGV",{"type":169,"tag":260,"props":1487,"children":1488},{"style":315},[1489],{"type":175,"value":407},{"type":169,"tag":260,"props":1491,"children":1492},{"style":341},[1493],{"type":175,"value":1165},{"type":169,"tag":260,"props":1495,"children":1496},{"style":315},[1497],{"type":175,"value":427},{"type":169,"tag":260,"props":1499,"children":1500},{"class":262,"line":712},[1501,1505,1509,1514,1518,1522],{"type":169,"tag":260,"props":1502,"children":1503},{"style":309},[1504],{"type":175,"value":1476},{"type":169,"tag":260,"props":1506,"children":1507},{"style":315},[1508],{"type":175,"value":397},{"type":169,"tag":260,"props":1510,"children":1511},{"style":341},[1512],{"type":175,"value":1513},"SIGABRT",{"type":169,"tag":260,"props":1515,"children":1516},{"style":315},[1517],{"type":175,"value":407},{"type":169,"tag":260,"props":1519,"children":1520},{"style":341},[1521],{"type":175,"value":1165},{"type":169,"tag":260,"props":1523,"children":1524},{"style":315},[1525],{"type":175,"value":427},{"type":169,"tag":260,"props":1527,"children":1528},{"class":262,"line":720},[1529,1533,1538,1542,1547,1551,1556],{"type":169,"tag":260,"props":1530,"children":1531},{"style":267},[1532],{"type":175,"value":1088},{"type":169,"tag":260,"props":1534,"children":1535},{"style":330},[1536],{"type":175,"value":1537}," kdb",{"type":169,"tag":260,"props":1539,"children":1540},{"style":315},[1541],{"type":175,"value":338},{"type":169,"tag":260,"props":1543,"children":1544},{"style":330},[1545],{"type":175,"value":1546},"test",{"type":169,"tag":260,"props":1548,"children":1549},{"style":315},[1550],{"type":175,"value":338},{"type":169,"tag":260,"props":1552,"children":1553},{"style":309},[1554],{"type":175,"value":1555},"RunAllTests",{"type":169,"tag":260,"props":1557,"children":1558},{"style":315},[1559],{"type":175,"value":462},{"type":169,"tag":260,"props":1561,"children":1562},{"class":262,"line":741},[1563],{"type":169,"tag":260,"props":1564,"children":1565},{"style":315},[1566],{"type":175,"value":1106},{"type":169,"tag":1136,"props":1568,"children":1570},{"id":1569},"使用宏创建测试类",[1571],{"type":175,"value":1569},{"type":169,"tag":183,"props":1573,"children":1574},{},[1575],{"type":175,"value":1576},"test_db 中的类是使用宏定义的。如下代码，TEST 展开的新类，继承了 DBTest，实现了 _RunIt 接口以便调用测试函数。TCONCAT 宏顾名思义就是连接，使用标记黏贴运算符把两个字符串或实参连接在一起并视为一个新的标记。_Test_ 和 name 连接在一起后，就是新类的名称，如 _Test_CloseAndReopen。",{"type":169,"tag":249,"props":1578,"children":1580},{"code":1579,"language":252,"meta":163,"className":253,"style":163},"TEST(DBTest, CloseAndReopen) {\n  // ...\n}\n#define TEST(base,name)                                                 \\\nclass TCONCAT(_Test_,name) : public base {                              \\\n public:                                                                \\\n  void _Run();                                                          \\\n  static void _RunIt() {                                                \\\n    TCONCAT(_Test_,name) t;                                             \\\n    t._Run();                                                           \\\n  }                                                                     \\\n};                                                                      \\\nbool TCONCAT(_Test_ignored_,name) =                                     \\\n  ::kdb::test::RegisterTest(#base, #name, &TCONCAT(_Test_,name)::_RunIt); \\\n",[1581],{"type":169,"tag":256,"props":1582,"children":1583},{"__ignoreMap":163},[1584,1618,1626,1633,1673,1722,1740,1762,1795,1838,1864,1876,1889,1932],{"type":169,"tag":260,"props":1585,"children":1586},{"class":262,"line":263},[1587,1592,1596,1601,1605,1610,1614],{"type":169,"tag":260,"props":1588,"children":1589},{"style":309},[1590],{"type":175,"value":1591},"TEST",{"type":169,"tag":260,"props":1593,"children":1594},{"style":315},[1595],{"type":175,"value":397},{"type":169,"tag":260,"props":1597,"children":1598},{"style":341},[1599],{"type":175,"value":1600},"DBTest",{"type":169,"tag":260,"props":1602,"children":1603},{"style":315},[1604],{"type":175,"value":407},{"type":169,"tag":260,"props":1606,"children":1607},{"style":341},[1608],{"type":175,"value":1609}," CloseAndReopen",{"type":169,"tag":260,"props":1611,"children":1612},{"style":315},[1613],{"type":175,"value":964},{"type":169,"tag":260,"props":1615,"children":1616},{"style":315},[1617],{"type":175,"value":323},{"type":169,"tag":260,"props":1619,"children":1620},{"class":262,"line":290},[1621],{"type":169,"tag":260,"props":1622,"children":1623},{"style":1269},[1624],{"type":175,"value":1625},"  // ...\n",{"type":169,"tag":260,"props":1627,"children":1628},{"class":262,"line":299},[1629],{"type":169,"tag":260,"props":1630,"children":1631},{"style":315},[1632],{"type":175,"value":1106},{"type":169,"tag":260,"props":1634,"children":1635},{"class":262,"line":326},[1636,1641,1646,1650,1655,1659,1664,1668],{"type":169,"tag":260,"props":1637,"children":1638},{"style":267},[1639],{"type":175,"value":1640},"#define",{"type":169,"tag":260,"props":1642,"children":1643},{"style":309},[1644],{"type":175,"value":1645}," TEST",{"type":169,"tag":260,"props":1647,"children":1648},{"style":315},[1649],{"type":175,"value":397},{"type":169,"tag":260,"props":1651,"children":1652},{"style":1176},[1653],{"type":175,"value":1654},"base",{"type":169,"tag":260,"props":1656,"children":1657},{"style":315},[1658],{"type":175,"value":407},{"type":169,"tag":260,"props":1660,"children":1661},{"style":1176},[1662],{"type":175,"value":1663},"name",{"type":169,"tag":260,"props":1665,"children":1666},{"style":315},[1667],{"type":175,"value":964},{"type":169,"tag":260,"props":1669,"children":1670},{"style":545},[1671],{"type":175,"value":1672},"                                                 \\\n",{"type":169,"tag":260,"props":1674,"children":1675},{"class":262,"line":352},[1676,1681,1686,1690,1695,1699,1703,1707,1712,1717],{"type":169,"tag":260,"props":1677,"children":1678},{"style":303},[1679],{"type":175,"value":1680},"class",{"type":169,"tag":260,"props":1682,"children":1683},{"style":309},[1684],{"type":175,"value":1685}," TCONCAT",{"type":169,"tag":260,"props":1687,"children":1688},{"style":315},[1689],{"type":175,"value":397},{"type":169,"tag":260,"props":1691,"children":1692},{"style":330},[1693],{"type":175,"value":1694},"_Test_",{"type":169,"tag":260,"props":1696,"children":1697},{"style":315},[1698],{"type":175,"value":407},{"type":169,"tag":260,"props":1700,"children":1701},{"style":330},[1702],{"type":175,"value":1663},{"type":169,"tag":260,"props":1704,"children":1705},{"style":315},[1706],{"type":175,"value":964},{"type":169,"tag":260,"props":1708,"children":1709},{"style":341},[1710],{"type":175,"value":1711}," : public base ",{"type":169,"tag":260,"props":1713,"children":1714},{"style":315},[1715],{"type":175,"value":1716},"{",{"type":169,"tag":260,"props":1718,"children":1719},{"style":545},[1720],{"type":175,"value":1721},"                              \\\n",{"type":169,"tag":260,"props":1723,"children":1724},{"class":262,"line":373},[1725,1730,1735],{"type":169,"tag":260,"props":1726,"children":1727},{"style":303},[1728],{"type":175,"value":1729}," public",{"type":169,"tag":260,"props":1731,"children":1733},{"style":1732},"--shiki-light:#39ADB5;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic",[1734],{"type":175,"value":1365},{"type":169,"tag":260,"props":1736,"children":1737},{"style":545},[1738],{"type":175,"value":1739},"                                                                \\\n",{"type":169,"tag":260,"props":1741,"children":1742},{"class":262,"line":430},[1743,1747,1752,1757],{"type":169,"tag":260,"props":1744,"children":1745},{"style":303},[1746],{"type":175,"value":1221},{"type":169,"tag":260,"props":1748,"children":1749},{"style":309},[1750],{"type":175,"value":1751}," _Run",{"type":169,"tag":260,"props":1753,"children":1754},{"style":315},[1755],{"type":175,"value":1756},"();",{"type":169,"tag":260,"props":1758,"children":1759},{"style":545},[1760],{"type":175,"value":1761},"                                                          \\\n",{"type":169,"tag":260,"props":1763,"children":1764},{"class":262,"line":465},[1765,1771,1776,1781,1785,1790],{"type":169,"tag":260,"props":1766,"children":1768},{"style":1767},"--shiki-light:#9C3EDA;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[1769],{"type":175,"value":1770},"  static",{"type":169,"tag":260,"props":1772,"children":1773},{"style":303},[1774],{"type":175,"value":1775}," void",{"type":169,"tag":260,"props":1777,"children":1778},{"style":309},[1779],{"type":175,"value":1780}," _RunIt",{"type":169,"tag":260,"props":1782,"children":1783},{"style":315},[1784],{"type":175,"value":318},{"type":169,"tag":260,"props":1786,"children":1787},{"style":315},[1788],{"type":175,"value":1789}," {",{"type":169,"tag":260,"props":1791,"children":1792},{"style":545},[1793],{"type":175,"value":1794},"                                                \\\n",{"type":169,"tag":260,"props":1796,"children":1797},{"class":262,"line":507},[1798,1803,1807,1811,1815,1819,1823,1828,1833],{"type":169,"tag":260,"props":1799,"children":1800},{"style":309},[1801],{"type":175,"value":1802},"    TCONCAT",{"type":169,"tag":260,"props":1804,"children":1805},{"style":315},[1806],{"type":175,"value":397},{"type":169,"tag":260,"props":1808,"children":1809},{"style":520},[1810],{"type":175,"value":1694},{"type":169,"tag":260,"props":1812,"children":1813},{"style":315},[1814],{"type":175,"value":407},{"type":169,"tag":260,"props":1816,"children":1817},{"style":520},[1818],{"type":175,"value":1663},{"type":169,"tag":260,"props":1820,"children":1821},{"style":315},[1822],{"type":175,"value":964},{"type":169,"tag":260,"props":1824,"children":1825},{"style":520},[1826],{"type":175,"value":1827}," t",{"type":169,"tag":260,"props":1829,"children":1830},{"style":315},[1831],{"type":175,"value":1832},";",{"type":169,"tag":260,"props":1834,"children":1835},{"style":545},[1836],{"type":175,"value":1837},"                                             \\\n",{"type":169,"tag":260,"props":1839,"children":1840},{"class":262,"line":588},[1841,1846,1850,1855,1859],{"type":169,"tag":260,"props":1842,"children":1843},{"style":341},[1844],{"type":175,"value":1845},"    t",{"type":169,"tag":260,"props":1847,"children":1848},{"style":315},[1849],{"type":175,"value":452},{"type":169,"tag":260,"props":1851,"children":1852},{"style":309},[1853],{"type":175,"value":1854},"_Run",{"type":169,"tag":260,"props":1856,"children":1857},{"style":315},[1858],{"type":175,"value":1756},{"type":169,"tag":260,"props":1860,"children":1861},{"style":545},[1862],{"type":175,"value":1863},"                                                           \\\n",{"type":169,"tag":260,"props":1865,"children":1866},{"class":262,"line":611},[1867,1871],{"type":169,"tag":260,"props":1868,"children":1869},{"style":315},[1870],{"type":175,"value":1017},{"type":169,"tag":260,"props":1872,"children":1873},{"style":545},[1874],{"type":175,"value":1875},"                                                                     \\\n",{"type":169,"tag":260,"props":1877,"children":1878},{"class":262,"line":620},[1879,1884],{"type":169,"tag":260,"props":1880,"children":1881},{"style":315},[1882],{"type":175,"value":1883},"};",{"type":169,"tag":260,"props":1885,"children":1886},{"style":545},[1887],{"type":175,"value":1888},"                                                                      \\\n",{"type":169,"tag":260,"props":1890,"children":1891},{"class":262,"line":628},[1892,1897,1901,1905,1910,1914,1918,1922,1927],{"type":169,"tag":260,"props":1893,"children":1894},{"style":303},[1895],{"type":175,"value":1896},"bool",{"type":169,"tag":260,"props":1898,"children":1899},{"style":309},[1900],{"type":175,"value":1685},{"type":169,"tag":260,"props":1902,"children":1903},{"style":315},[1904],{"type":175,"value":397},{"type":169,"tag":260,"props":1906,"children":1907},{"style":330},[1908],{"type":175,"value":1909},"_Test_ignored_",{"type":169,"tag":260,"props":1911,"children":1912},{"style":315},[1913],{"type":175,"value":407},{"type":169,"tag":260,"props":1915,"children":1916},{"style":330},[1917],{"type":175,"value":1663},{"type":169,"tag":260,"props":1919,"children":1920},{"style":315},[1921],{"type":175,"value":964},{"type":169,"tag":260,"props":1923,"children":1924},{"style":439},[1925],{"type":175,"value":1926}," =",{"type":169,"tag":260,"props":1928,"children":1929},{"style":545},[1930],{"type":175,"value":1931},"                                     \\\n",{"type":169,"tag":260,"props":1933,"children":1934},{"class":262,"line":671},[1935,1940,1945,1949,1953,1957,1962,1966,1971,1975,1980,1984,1988,1993,1997,2001,2005,2009,2013,2018,2022],{"type":169,"tag":260,"props":1936,"children":1937},{"style":341},[1938],{"type":175,"value":1939},"  ::",{"type":169,"tag":260,"props":1941,"children":1942},{"style":330},[1943],{"type":175,"value":1944},"kdb",{"type":169,"tag":260,"props":1946,"children":1947},{"style":315},[1948],{"type":175,"value":338},{"type":169,"tag":260,"props":1950,"children":1951},{"style":330},[1952],{"type":175,"value":1546},{"type":169,"tag":260,"props":1954,"children":1955},{"style":315},[1956],{"type":175,"value":338},{"type":169,"tag":260,"props":1958,"children":1959},{"style":309},[1960],{"type":175,"value":1961},"RegisterTest",{"type":169,"tag":260,"props":1963,"children":1964},{"style":315},[1965],{"type":175,"value":397},{"type":169,"tag":260,"props":1967,"children":1968},{"style":341},[1969],{"type":175,"value":1970},"#base",{"type":169,"tag":260,"props":1972,"children":1973},{"style":315},[1974],{"type":175,"value":407},{"type":169,"tag":260,"props":1976,"children":1977},{"style":341},[1978],{"type":175,"value":1979}," #name",{"type":169,"tag":260,"props":1981,"children":1982},{"style":315},[1983],{"type":175,"value":407},{"type":169,"tag":260,"props":1985,"children":1986},{"style":439},[1987],{"type":175,"value":895},{"type":169,"tag":260,"props":1989,"children":1990},{"style":309},[1991],{"type":175,"value":1992},"TCONCAT",{"type":169,"tag":260,"props":1994,"children":1995},{"style":315},[1996],{"type":175,"value":397},{"type":169,"tag":260,"props":1998,"children":1999},{"style":341},[2000],{"type":175,"value":1694},{"type":169,"tag":260,"props":2002,"children":2003},{"style":315},[2004],{"type":175,"value":407},{"type":169,"tag":260,"props":2006,"children":2007},{"style":341},[2008],{"type":175,"value":1663},{"type":169,"tag":260,"props":2010,"children":2011},{"style":315},[2012],{"type":175,"value":964},{"type":169,"tag":260,"props":2014,"children":2015},{"style":341},[2016],{"type":175,"value":2017},"::_RunIt",{"type":169,"tag":260,"props":2019,"children":2020},{"style":315},[2021],{"type":175,"value":1003},{"type":169,"tag":260,"props":2023,"children":2024},{"style":545},[2025],{"type":175,"value":2026}," \\\n",{"type":169,"tag":183,"props":2028,"children":2029},{},[2030],{"type":175,"value":2031},"可是，既然有 TCONCAT，为什么还要定义一个 TCONCAT1 宏呢？",{"type":169,"tag":249,"props":2033,"children":2035},{"code":2034,"language":252,"meta":163,"className":253,"style":163},"#define TCONCAT(a,b) TCONCAT1(a,b)\n#define TCONCAT1(a,b) a##b\n",[2036],{"type":169,"tag":256,"props":2037,"children":2038},{"__ignoreMap":163},[2039,2097],{"type":169,"tag":260,"props":2040,"children":2041},{"class":262,"line":263},[2042,2046,2050,2054,2058,2062,2067,2071,2076,2080,2084,2088,2092],{"type":169,"tag":260,"props":2043,"children":2044},{"style":267},[2045],{"type":175,"value":1640},{"type":169,"tag":260,"props":2047,"children":2048},{"style":309},[2049],{"type":175,"value":1685},{"type":169,"tag":260,"props":2051,"children":2052},{"style":315},[2053],{"type":175,"value":397},{"type":169,"tag":260,"props":2055,"children":2056},{"style":1176},[2057],{"type":175,"value":194},{"type":169,"tag":260,"props":2059,"children":2060},{"style":315},[2061],{"type":175,"value":407},{"type":169,"tag":260,"props":2063,"children":2064},{"style":1176},[2065],{"type":175,"value":2066},"b",{"type":169,"tag":260,"props":2068,"children":2069},{"style":315},[2070],{"type":175,"value":964},{"type":169,"tag":260,"props":2072,"children":2073},{"style":309},[2074],{"type":175,"value":2075}," TCONCAT1",{"type":169,"tag":260,"props":2077,"children":2078},{"style":315},[2079],{"type":175,"value":397},{"type":169,"tag":260,"props":2081,"children":2082},{"style":341},[2083],{"type":175,"value":194},{"type":169,"tag":260,"props":2085,"children":2086},{"style":315},[2087],{"type":175,"value":407},{"type":169,"tag":260,"props":2089,"children":2090},{"style":341},[2091],{"type":175,"value":2066},{"type":169,"tag":260,"props":2093,"children":2094},{"style":315},[2095],{"type":175,"value":2096},")\n",{"type":169,"tag":260,"props":2098,"children":2099},{"class":262,"line":290},[2100,2104,2108,2112,2116,2120,2124,2128],{"type":169,"tag":260,"props":2101,"children":2102},{"style":267},[2103],{"type":175,"value":1640},{"type":169,"tag":260,"props":2105,"children":2106},{"style":309},[2107],{"type":175,"value":2075},{"type":169,"tag":260,"props":2109,"children":2110},{"style":315},[2111],{"type":175,"value":397},{"type":169,"tag":260,"props":2113,"children":2114},{"style":1176},[2115],{"type":175,"value":194},{"type":169,"tag":260,"props":2117,"children":2118},{"style":315},[2119],{"type":175,"value":407},{"type":169,"tag":260,"props":2121,"children":2122},{"style":1176},[2123],{"type":175,"value":2066},{"type":169,"tag":260,"props":2125,"children":2126},{"style":315},[2127],{"type":175,"value":964},{"type":169,"tag":260,"props":2129,"children":2130},{"style":341},[2131],{"type":175,"value":2132}," a##b\n",{"type":169,"tag":183,"props":2134,"children":2135},{},[2136],{"type":175,"value":2137},"这就要提到宏的一个特殊规则了，如果宏参数使用了字符串化运算符（#）或标记黏贴运算符（##），那么即便参数是宏也不会展开。所以需要一个间接宏 TCONCAT1，以达到先展开参数（如果参数是宏的化），再调用标记黏贴运算符的目的。从 test_db 可以看到，测试类的名词都不是宏，所以这里本不需要 TCONCAT1 这个间接宏。但是考虑到程序的健壮性，加上更好。",{"type":169,"tag":1136,"props":2139,"children":2141},{"id":2140},"断言宏",[2142],{"type":175,"value":2140},{"type":169,"tag":183,"props":2144,"children":2145},{},[2146],{"type":175,"value":2147},"测试代码中的断言也是使用的宏来定义的。相比 TCONCAT 简单很多了，但其特点是可以记录抛错的文件以及行号。以下代码实现了 ASSERT_EQ 的定义。Tester 用于记录宏展开时所在的文件 __FILE__、行号 __LINE__ 以及断言结果。一但断言失败，记录到 ok_ 成员变量中。在 Tester 析构时，会把相关信息一并打印出来。",{"type":169,"tag":249,"props":2149,"children":2151},{"code":2150,"language":252,"meta":163,"className":253,"style":163},"class Tester {\n#define BINARY_OP(name,op)                              \\\n  template \u003Cclass X, class Y>                           \\\n  Tester& name(const X& x, const Y& y) {                \\\n    if (! (x op y)) {                                   \\\n      ss_ \u003C\u003C \" failed: \" \u003C\u003C x \u003C\u003C (\" \" #op \" \") \u003C\u003C y;    \\\n      ok_ = false;                                      \\\n    }                                                   \\\n    return *this;                                       \\\n  }\n  BINARY_OP(IsEq, ==)\n#undef BINARY_OP\n}\n#define ASSERT_EQ(a,b) ::kdb::test::Tester(__FILE__, __LINE__).IsEq((a),(b))\n",[2152],{"type":169,"tag":256,"props":2153,"children":2154},{"__ignoreMap":163},[2155,2171,2208,2253,2328,2367,2453,2480,2493,2520,2527,2557,2570,2577],{"type":169,"tag":260,"props":2156,"children":2157},{"class":262,"line":263},[2158,2162,2167],{"type":169,"tag":260,"props":2159,"children":2160},{"style":303},[2161],{"type":175,"value":1680},{"type":169,"tag":260,"props":2163,"children":2164},{"style":330},[2165],{"type":175,"value":2166}," Tester",{"type":169,"tag":260,"props":2168,"children":2169},{"style":315},[2170],{"type":175,"value":323},{"type":169,"tag":260,"props":2172,"children":2173},{"class":262,"line":290},[2174,2178,2183,2187,2191,2195,2200,2204],{"type":169,"tag":260,"props":2175,"children":2176},{"style":267},[2177],{"type":175,"value":1640},{"type":169,"tag":260,"props":2179,"children":2180},{"style":309},[2181],{"type":175,"value":2182}," BINARY_OP",{"type":169,"tag":260,"props":2184,"children":2185},{"style":315},[2186],{"type":175,"value":397},{"type":169,"tag":260,"props":2188,"children":2189},{"style":1176},[2190],{"type":175,"value":1663},{"type":169,"tag":260,"props":2192,"children":2193},{"style":315},[2194],{"type":175,"value":407},{"type":169,"tag":260,"props":2196,"children":2197},{"style":1176},[2198],{"type":175,"value":2199},"op",{"type":169,"tag":260,"props":2201,"children":2202},{"style":315},[2203],{"type":175,"value":964},{"type":169,"tag":260,"props":2205,"children":2206},{"style":545},[2207],{"type":175,"value":1721},{"type":169,"tag":260,"props":2209,"children":2210},{"class":262,"line":299},[2211,2216,2220,2224,2229,2233,2238,2243,2248],{"type":169,"tag":260,"props":2212,"children":2213},{"style":303},[2214],{"type":175,"value":2215},"  template",{"type":169,"tag":260,"props":2217,"children":2218},{"style":315},[2219],{"type":175,"value":276},{"type":169,"tag":260,"props":2221,"children":2222},{"style":303},[2223],{"type":175,"value":1680},{"type":169,"tag":260,"props":2225,"children":2226},{"style":330},[2227],{"type":175,"value":2228}," X",{"type":169,"tag":260,"props":2230,"children":2231},{"style":315},[2232],{"type":175,"value":407},{"type":169,"tag":260,"props":2234,"children":2235},{"style":303},[2236],{"type":175,"value":2237}," class",{"type":169,"tag":260,"props":2239,"children":2240},{"style":330},[2241],{"type":175,"value":2242}," Y",{"type":169,"tag":260,"props":2244,"children":2245},{"style":315},[2246],{"type":175,"value":2247},">",{"type":169,"tag":260,"props":2249,"children":2250},{"style":545},[2251],{"type":175,"value":2252},"                           \\\n",{"type":169,"tag":260,"props":2254,"children":2255},{"class":262,"line":326},[2256,2261,2266,2271,2275,2280,2284,2288,2293,2297,2302,2306,2310,2315,2319,2323],{"type":169,"tag":260,"props":2257,"children":2258},{"style":330},[2259],{"type":175,"value":2260},"  Tester",{"type":169,"tag":260,"props":2262,"children":2263},{"style":1767},[2264],{"type":175,"value":2265},"&",{"type":169,"tag":260,"props":2267,"children":2268},{"style":309},[2269],{"type":175,"value":2270}," name",{"type":169,"tag":260,"props":2272,"children":2273},{"style":315},[2274],{"type":175,"value":397},{"type":169,"tag":260,"props":2276,"children":2277},{"style":1767},[2278],{"type":175,"value":2279},"const",{"type":169,"tag":260,"props":2281,"children":2282},{"style":330},[2283],{"type":175,"value":2228},{"type":169,"tag":260,"props":2285,"children":2286},{"style":1767},[2287],{"type":175,"value":2265},{"type":169,"tag":260,"props":2289,"children":2290},{"style":1176},[2291],{"type":175,"value":2292}," x",{"type":169,"tag":260,"props":2294,"children":2295},{"style":315},[2296],{"type":175,"value":407},{"type":169,"tag":260,"props":2298,"children":2299},{"style":1767},[2300],{"type":175,"value":2301}," const",{"type":169,"tag":260,"props":2303,"children":2304},{"style":330},[2305],{"type":175,"value":2242},{"type":169,"tag":260,"props":2307,"children":2308},{"style":1767},[2309],{"type":175,"value":2265},{"type":169,"tag":260,"props":2311,"children":2312},{"style":1176},[2313],{"type":175,"value":2314}," y",{"type":169,"tag":260,"props":2316,"children":2317},{"style":315},[2318],{"type":175,"value":964},{"type":169,"tag":260,"props":2320,"children":2321},{"style":315},[2322],{"type":175,"value":1789},{"type":169,"tag":260,"props":2324,"children":2325},{"style":545},[2326],{"type":175,"value":2327},"                \\\n",{"type":169,"tag":260,"props":2329,"children":2330},{"class":262,"line":352},[2331,2336,2340,2344,2348,2353,2358,2362],{"type":169,"tag":260,"props":2332,"children":2333},{"style":267},[2334],{"type":175,"value":2335},"    if",{"type":169,"tag":260,"props":2337,"children":2338},{"style":315},[2339],{"type":175,"value":476},{"type":169,"tag":260,"props":2341,"children":2342},{"style":439},[2343],{"type":175,"value":481},{"type":169,"tag":260,"props":2345,"children":2346},{"style":315},[2347],{"type":175,"value":476},{"type":169,"tag":260,"props":2349,"children":2350},{"style":520},[2351],{"type":175,"value":2352},"x op y",{"type":169,"tag":260,"props":2354,"children":2355},{"style":315},[2356],{"type":175,"value":2357},"))",{"type":169,"tag":260,"props":2359,"children":2360},{"style":315},[2361],{"type":175,"value":1789},{"type":169,"tag":260,"props":2363,"children":2364},{"style":545},[2365],{"type":175,"value":2366},"                                   \\\n",{"type":169,"tag":260,"props":2368,"children":2369},{"class":262,"line":373},[2370,2375,2380,2384,2389,2393,2398,2403,2407,2411,2415,2419,2424,2428,2432,2436,2440,2444,2448],{"type":169,"tag":260,"props":2371,"children":2372},{"style":520},[2373],{"type":175,"value":2374},"      ss_ ",{"type":169,"tag":260,"props":2376,"children":2377},{"style":439},[2378],{"type":175,"value":2379},"\u003C\u003C",{"type":169,"tag":260,"props":2381,"children":2382},{"style":273},[2383],{"type":175,"value":412},{"type":169,"tag":260,"props":2385,"children":2386},{"style":279},[2387],{"type":175,"value":2388}," failed: ",{"type":169,"tag":260,"props":2390,"children":2391},{"style":273},[2392],{"type":175,"value":422},{"type":169,"tag":260,"props":2394,"children":2395},{"style":439},[2396],{"type":175,"value":2397}," \u003C\u003C",{"type":169,"tag":260,"props":2399,"children":2400},{"style":520},[2401],{"type":175,"value":2402}," x ",{"type":169,"tag":260,"props":2404,"children":2405},{"style":439},[2406],{"type":175,"value":2379},{"type":169,"tag":260,"props":2408,"children":2409},{"style":315},[2410],{"type":175,"value":476},{"type":169,"tag":260,"props":2412,"children":2413},{"style":273},[2414],{"type":175,"value":422},{"type":169,"tag":260,"props":2416,"children":2417},{"style":273},[2418],{"type":175,"value":412},{"type":169,"tag":260,"props":2420,"children":2421},{"style":341},[2422],{"type":175,"value":2423}," #op",{"type":169,"tag":260,"props":2425,"children":2426},{"style":273},[2427],{"type":175,"value":412},{"type":169,"tag":260,"props":2429,"children":2430},{"style":273},[2431],{"type":175,"value":412},{"type":169,"tag":260,"props":2433,"children":2434},{"style":315},[2435],{"type":175,"value":964},{"type":169,"tag":260,"props":2437,"children":2438},{"style":439},[2439],{"type":175,"value":2397},{"type":169,"tag":260,"props":2441,"children":2442},{"style":520},[2443],{"type":175,"value":2314},{"type":169,"tag":260,"props":2445,"children":2446},{"style":315},[2447],{"type":175,"value":1832},{"type":169,"tag":260,"props":2449,"children":2450},{"style":545},[2451],{"type":175,"value":2452},"    \\\n",{"type":169,"tag":260,"props":2454,"children":2455},{"class":262,"line":430},[2456,2461,2465,2471,2475],{"type":169,"tag":260,"props":2457,"children":2458},{"style":520},[2459],{"type":175,"value":2460},"      ok_ ",{"type":169,"tag":260,"props":2462,"children":2463},{"style":439},[2464],{"type":175,"value":442},{"type":169,"tag":260,"props":2466,"children":2468},{"style":2467},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[2469],{"type":175,"value":2470}," false",{"type":169,"tag":260,"props":2472,"children":2473},{"style":315},[2474],{"type":175,"value":1832},{"type":169,"tag":260,"props":2476,"children":2477},{"style":545},[2478],{"type":175,"value":2479},"                                      \\\n",{"type":169,"tag":260,"props":2481,"children":2482},{"class":262,"line":465},[2483,2488],{"type":169,"tag":260,"props":2484,"children":2485},{"style":315},[2486],{"type":175,"value":2487},"    }",{"type":169,"tag":260,"props":2489,"children":2490},{"style":545},[2491],{"type":175,"value":2492},"                                                   \\\n",{"type":169,"tag":260,"props":2494,"children":2495},{"class":262,"line":507},[2496,2501,2505,2511,2515],{"type":169,"tag":260,"props":2497,"children":2498},{"style":267},[2499],{"type":175,"value":2500},"    return",{"type":169,"tag":260,"props":2502,"children":2503},{"style":439},[2504],{"type":175,"value":1226},{"type":169,"tag":260,"props":2506,"children":2508},{"style":2507},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[2509],{"type":175,"value":2510},"this",{"type":169,"tag":260,"props":2512,"children":2513},{"style":315},[2514],{"type":175,"value":1832},{"type":169,"tag":260,"props":2516,"children":2517},{"style":545},[2518],{"type":175,"value":2519},"                                       \\\n",{"type":169,"tag":260,"props":2521,"children":2522},{"class":262,"line":588},[2523],{"type":169,"tag":260,"props":2524,"children":2525},{"style":315},[2526],{"type":175,"value":617},{"type":169,"tag":260,"props":2528,"children":2529},{"class":262,"line":611},[2530,2535,2539,2544,2548,2553],{"type":169,"tag":260,"props":2531,"children":2532},{"style":309},[2533],{"type":175,"value":2534},"  BINARY_OP",{"type":169,"tag":260,"props":2536,"children":2537},{"style":315},[2538],{"type":175,"value":397},{"type":169,"tag":260,"props":2540,"children":2541},{"style":330},[2542],{"type":175,"value":2543},"IsEq",{"type":169,"tag":260,"props":2545,"children":2546},{"style":315},[2547],{"type":175,"value":407},{"type":169,"tag":260,"props":2549,"children":2550},{"style":439},[2551],{"type":175,"value":2552}," ==",{"type":169,"tag":260,"props":2554,"children":2555},{"style":315},[2556],{"type":175,"value":2096},{"type":169,"tag":260,"props":2558,"children":2559},{"class":262,"line":620},[2560,2565],{"type":169,"tag":260,"props":2561,"children":2562},{"style":267},[2563],{"type":175,"value":2564},"#undef",{"type":169,"tag":260,"props":2566,"children":2567},{"style":309},[2568],{"type":175,"value":2569}," BINARY_OP\n",{"type":169,"tag":260,"props":2571,"children":2572},{"class":262,"line":628},[2573],{"type":169,"tag":260,"props":2574,"children":2575},{"style":520},[2576],{"type":175,"value":1106},{"type":169,"tag":260,"props":2578,"children":2579},{"class":262,"line":671},[2580,2584,2589,2593,2597,2601,2605,2609,2614,2618,2622,2626,2630,2635,2639,2645,2649,2654,2659,2663,2668,2672,2677,2681],{"type":169,"tag":260,"props":2581,"children":2582},{"style":267},[2583],{"type":175,"value":1640},{"type":169,"tag":260,"props":2585,"children":2586},{"style":309},[2587],{"type":175,"value":2588}," ASSERT_EQ",{"type":169,"tag":260,"props":2590,"children":2591},{"style":315},[2592],{"type":175,"value":397},{"type":169,"tag":260,"props":2594,"children":2595},{"style":1176},[2596],{"type":175,"value":194},{"type":169,"tag":260,"props":2598,"children":2599},{"style":315},[2600],{"type":175,"value":407},{"type":169,"tag":260,"props":2602,"children":2603},{"style":1176},[2604],{"type":175,"value":2066},{"type":169,"tag":260,"props":2606,"children":2607},{"style":315},[2608],{"type":175,"value":964},{"type":169,"tag":260,"props":2610,"children":2611},{"style":520},[2612],{"type":175,"value":2613}," ::",{"type":169,"tag":260,"props":2615,"children":2616},{"style":330},[2617],{"type":175,"value":1944},{"type":169,"tag":260,"props":2619,"children":2620},{"style":315},[2621],{"type":175,"value":338},{"type":169,"tag":260,"props":2623,"children":2624},{"style":330},[2625],{"type":175,"value":1546},{"type":169,"tag":260,"props":2627,"children":2628},{"style":315},[2629],{"type":175,"value":338},{"type":169,"tag":260,"props":2631,"children":2632},{"style":309},[2633],{"type":175,"value":2634},"Tester",{"type":169,"tag":260,"props":2636,"children":2637},{"style":315},[2638],{"type":175,"value":397},{"type":169,"tag":260,"props":2640,"children":2642},{"style":2641},"--shiki-light:#E2931D;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#F8F8F2",[2643],{"type":175,"value":2644},"__FILE__",{"type":169,"tag":260,"props":2646,"children":2647},{"style":315},[2648],{"type":175,"value":407},{"type":169,"tag":260,"props":2650,"children":2651},{"style":2641},[2652],{"type":175,"value":2653}," __LINE__",{"type":169,"tag":260,"props":2655,"children":2656},{"style":315},[2657],{"type":175,"value":2658},").",{"type":169,"tag":260,"props":2660,"children":2661},{"style":309},[2662],{"type":175,"value":2543},{"type":169,"tag":260,"props":2664,"children":2665},{"style":315},[2666],{"type":175,"value":2667},"((",{"type":169,"tag":260,"props":2669,"children":2670},{"style":520},[2671],{"type":175,"value":194},{"type":169,"tag":260,"props":2673,"children":2674},{"style":315},[2675],{"type":175,"value":2676},"),(",{"type":169,"tag":260,"props":2678,"children":2679},{"style":520},[2680],{"type":175,"value":2066},{"type":169,"tag":260,"props":2682,"children":2683},{"style":315},[2684],{"type":175,"value":2685},"))\n",{"type":169,"tag":1136,"props":2687,"children":2689},{"id":2688},"stringrepeatntimes",[2690],{"type":175,"value":2691},"string.repeat(ntimes)",{"type":169,"tag":183,"props":2693,"children":2694},{},[2695],{"type":175,"value":2696},"写 JavaScript 时经常用到 String 的原型方法 repeat，用来把 n 个内容重复的字符串拼接为一个新字符串。也许是 C++ 标准库没有提供相应的算法，KDB 使用了一种和 repeat 完全不一样的处理思路。KDB 使用 StringStream 填充一定位数内容，还可以不用考虑值的长度。",{"type":169,"tag":249,"props":2698,"children":2700},{"code":2699,"language":252,"meta":163,"className":253,"style":163},"std::stringstream ss;\nss \u003C\u003C std::setfill ('0') \u003C\u003C std::setw (16);\nss \u003C\u003C 1;\nss.str(); // result is: \"0000000000000001\"\nss \u003C\u003C std::setfill ('0') \u003C\u003C std::setw (16);\nss \u003C\u003C 1123;\nss.str(); // result is: \"0000000000001123\"\n",[2701],{"type":169,"tag":256,"props":2702,"children":2703},{"__ignoreMap":163},[2704,2725,2803,2823,2849,2920,2940],{"type":169,"tag":260,"props":2705,"children":2706},{"class":262,"line":263},[2707,2712,2716,2721],{"type":169,"tag":260,"props":2708,"children":2709},{"style":330},[2710],{"type":175,"value":2711},"std",{"type":169,"tag":260,"props":2713,"children":2714},{"style":315},[2715],{"type":175,"value":338},{"type":169,"tag":260,"props":2717,"children":2718},{"style":341},[2719],{"type":175,"value":2720},"stringstream ss",{"type":169,"tag":260,"props":2722,"children":2723},{"style":315},[2724],{"type":175,"value":349},{"type":169,"tag":260,"props":2726,"children":2727},{"class":262,"line":290},[2728,2733,2737,2742,2746,2751,2755,2760,2765,2769,2773,2777,2781,2785,2790,2794,2799],{"type":169,"tag":260,"props":2729,"children":2730},{"style":341},[2731],{"type":175,"value":2732},"ss ",{"type":169,"tag":260,"props":2734,"children":2735},{"style":439},[2736],{"type":175,"value":2379},{"type":169,"tag":260,"props":2738,"children":2739},{"style":330},[2740],{"type":175,"value":2741}," std",{"type":169,"tag":260,"props":2743,"children":2744},{"style":315},[2745],{"type":175,"value":338},{"type":169,"tag":260,"props":2747,"children":2748},{"style":309},[2749],{"type":175,"value":2750},"setfill",{"type":169,"tag":260,"props":2752,"children":2753},{"style":315},[2754],{"type":175,"value":476},{"type":169,"tag":260,"props":2756,"children":2757},{"style":273},[2758],{"type":175,"value":2759},"'",{"type":169,"tag":260,"props":2761,"children":2762},{"style":279},[2763],{"type":175,"value":2764},"0",{"type":169,"tag":260,"props":2766,"children":2767},{"style":273},[2768],{"type":175,"value":2759},{"type":169,"tag":260,"props":2770,"children":2771},{"style":315},[2772],{"type":175,"value":964},{"type":169,"tag":260,"props":2774,"children":2775},{"style":439},[2776],{"type":175,"value":2397},{"type":169,"tag":260,"props":2778,"children":2779},{"style":330},[2780],{"type":175,"value":2741},{"type":169,"tag":260,"props":2782,"children":2783},{"style":315},[2784],{"type":175,"value":338},{"type":169,"tag":260,"props":2786,"children":2787},{"style":309},[2788],{"type":175,"value":2789},"setw",{"type":169,"tag":260,"props":2791,"children":2792},{"style":315},[2793],{"type":175,"value":476},{"type":169,"tag":260,"props":2795,"children":2796},{"style":601},[2797],{"type":175,"value":2798},"16",{"type":169,"tag":260,"props":2800,"children":2801},{"style":315},[2802],{"type":175,"value":427},{"type":169,"tag":260,"props":2804,"children":2805},{"class":262,"line":299},[2806,2810,2814,2819],{"type":169,"tag":260,"props":2807,"children":2808},{"style":341},[2809],{"type":175,"value":2732},{"type":169,"tag":260,"props":2811,"children":2812},{"style":439},[2813],{"type":175,"value":2379},{"type":169,"tag":260,"props":2815,"children":2816},{"style":601},[2817],{"type":175,"value":2818}," 1",{"type":169,"tag":260,"props":2820,"children":2821},{"style":315},[2822],{"type":175,"value":349},{"type":169,"tag":260,"props":2824,"children":2825},{"class":262,"line":326},[2826,2831,2835,2840,2844],{"type":169,"tag":260,"props":2827,"children":2828},{"style":341},[2829],{"type":175,"value":2830},"ss",{"type":169,"tag":260,"props":2832,"children":2833},{"style":315},[2834],{"type":175,"value":452},{"type":169,"tag":260,"props":2836,"children":2837},{"style":309},[2838],{"type":175,"value":2839},"str",{"type":169,"tag":260,"props":2841,"children":2842},{"style":315},[2843],{"type":175,"value":1756},{"type":169,"tag":260,"props":2845,"children":2846},{"style":1269},[2847],{"type":175,"value":2848}," // result is: \"0000000000000001\"\n",{"type":169,"tag":260,"props":2850,"children":2851},{"class":262,"line":352},[2852,2856,2860,2864,2868,2872,2876,2880,2884,2888,2892,2896,2900,2904,2908,2912,2916],{"type":169,"tag":260,"props":2853,"children":2854},{"style":341},[2855],{"type":175,"value":2732},{"type":169,"tag":260,"props":2857,"children":2858},{"style":439},[2859],{"type":175,"value":2379},{"type":169,"tag":260,"props":2861,"children":2862},{"style":330},[2863],{"type":175,"value":2741},{"type":169,"tag":260,"props":2865,"children":2866},{"style":315},[2867],{"type":175,"value":338},{"type":169,"tag":260,"props":2869,"children":2870},{"style":309},[2871],{"type":175,"value":2750},{"type":169,"tag":260,"props":2873,"children":2874},{"style":315},[2875],{"type":175,"value":476},{"type":169,"tag":260,"props":2877,"children":2878},{"style":273},[2879],{"type":175,"value":2759},{"type":169,"tag":260,"props":2881,"children":2882},{"style":279},[2883],{"type":175,"value":2764},{"type":169,"tag":260,"props":2885,"children":2886},{"style":273},[2887],{"type":175,"value":2759},{"type":169,"tag":260,"props":2889,"children":2890},{"style":315},[2891],{"type":175,"value":964},{"type":169,"tag":260,"props":2893,"children":2894},{"style":439},[2895],{"type":175,"value":2397},{"type":169,"tag":260,"props":2897,"children":2898},{"style":330},[2899],{"type":175,"value":2741},{"type":169,"tag":260,"props":2901,"children":2902},{"style":315},[2903],{"type":175,"value":338},{"type":169,"tag":260,"props":2905,"children":2906},{"style":309},[2907],{"type":175,"value":2789},{"type":169,"tag":260,"props":2909,"children":2910},{"style":315},[2911],{"type":175,"value":476},{"type":169,"tag":260,"props":2913,"children":2914},{"style":601},[2915],{"type":175,"value":2798},{"type":169,"tag":260,"props":2917,"children":2918},{"style":315},[2919],{"type":175,"value":427},{"type":169,"tag":260,"props":2921,"children":2922},{"class":262,"line":373},[2923,2927,2931,2936],{"type":169,"tag":260,"props":2924,"children":2925},{"style":341},[2926],{"type":175,"value":2732},{"type":169,"tag":260,"props":2928,"children":2929},{"style":439},[2930],{"type":175,"value":2379},{"type":169,"tag":260,"props":2932,"children":2933},{"style":601},[2934],{"type":175,"value":2935}," 1123",{"type":169,"tag":260,"props":2937,"children":2938},{"style":315},[2939],{"type":175,"value":349},{"type":169,"tag":260,"props":2941,"children":2942},{"class":262,"line":430},[2943,2947,2951,2955,2959],{"type":169,"tag":260,"props":2944,"children":2945},{"style":341},[2946],{"type":175,"value":2830},{"type":169,"tag":260,"props":2948,"children":2949},{"style":315},[2950],{"type":175,"value":452},{"type":169,"tag":260,"props":2952,"children":2953},{"style":309},[2954],{"type":175,"value":2839},{"type":169,"tag":260,"props":2956,"children":2957},{"style":315},[2958],{"type":175,"value":1756},{"type":169,"tag":260,"props":2960,"children":2961},{"style":1269},[2962],{"type":175,"value":2963}," // result is: \"0000000000001123\"\n",{"type":169,"tag":1136,"props":2965,"children":2967},{"id":2966},"c-风格的随机数",[2968],{"type":175,"value":2969},"C++ 风格的随机数",{"type":169,"tag":183,"props":2971,"children":2972},{},[2973],{"type":175,"value":2974},"一个有意思的地方时，KDB 代码中随处可见 C 编程风格的源码。但是测试用例中生成随机数确实 C++ 风格的。",{"type":169,"tag":249,"props":2976,"children":2978},{"code":2977,"language":252,"meta":163,"className":253,"style":163},"std::mt19937 generator = std::mt19937();\nstd::uniform_int_distribution\u003Cint> random_dist(0,255);\n// ...\nfor (int i = 0; i \u003C size; i++) {\n  str[i] = static_cast\u003Cchar>(random_dist(generator));\n}\n",[2979],{"type":169,"tag":256,"props":2980,"children":2981},{"__ignoreMap":163},[2982,3019,3074,3082,3150,3213],{"type":169,"tag":260,"props":2983,"children":2984},{"class":262,"line":263},[2985,2989,2993,2998,3002,3006,3010,3015],{"type":169,"tag":260,"props":2986,"children":2987},{"style":330},[2988],{"type":175,"value":2711},{"type":169,"tag":260,"props":2990,"children":2991},{"style":315},[2992],{"type":175,"value":338},{"type":169,"tag":260,"props":2994,"children":2995},{"style":341},[2996],{"type":175,"value":2997},"mt19937 generator ",{"type":169,"tag":260,"props":2999,"children":3000},{"style":439},[3001],{"type":175,"value":442},{"type":169,"tag":260,"props":3003,"children":3004},{"style":330},[3005],{"type":175,"value":2741},{"type":169,"tag":260,"props":3007,"children":3008},{"style":315},[3009],{"type":175,"value":338},{"type":169,"tag":260,"props":3011,"children":3012},{"style":309},[3013],{"type":175,"value":3014},"mt19937",{"type":169,"tag":260,"props":3016,"children":3017},{"style":315},[3018],{"type":175,"value":462},{"type":169,"tag":260,"props":3020,"children":3021},{"class":262,"line":290},[3022,3026,3030,3035,3040,3044,3048,3053,3057,3061,3065,3070],{"type":169,"tag":260,"props":3023,"children":3024},{"style":330},[3025],{"type":175,"value":2711},{"type":169,"tag":260,"props":3027,"children":3028},{"style":315},[3029],{"type":175,"value":338},{"type":169,"tag":260,"props":3031,"children":3032},{"style":330},[3033],{"type":175,"value":3034},"uniform_int_distribution",{"type":169,"tag":260,"props":3036,"children":3037},{"style":315},[3038],{"type":175,"value":3039},"\u003C",{"type":169,"tag":260,"props":3041,"children":3042},{"style":303},[3043],{"type":175,"value":306},{"type":169,"tag":260,"props":3045,"children":3046},{"style":315},[3047],{"type":175,"value":2247},{"type":169,"tag":260,"props":3049,"children":3050},{"style":309},[3051],{"type":175,"value":3052}," random_dist",{"type":169,"tag":260,"props":3054,"children":3055},{"style":315},[3056],{"type":175,"value":397},{"type":169,"tag":260,"props":3058,"children":3059},{"style":601},[3060],{"type":175,"value":2764},{"type":169,"tag":260,"props":3062,"children":3063},{"style":315},[3064],{"type":175,"value":407},{"type":169,"tag":260,"props":3066,"children":3067},{"style":601},[3068],{"type":175,"value":3069},"255",{"type":169,"tag":260,"props":3071,"children":3072},{"style":315},[3073],{"type":175,"value":427},{"type":169,"tag":260,"props":3075,"children":3076},{"class":262,"line":299},[3077],{"type":169,"tag":260,"props":3078,"children":3079},{"style":1269},[3080],{"type":175,"value":3081},"// ...\n",{"type":169,"tag":260,"props":3083,"children":3084},{"class":262,"line":326},[3085,3090,3094,3098,3103,3107,3111,3115,3119,3123,3128,3132,3137,3142,3146],{"type":169,"tag":260,"props":3086,"children":3087},{"style":267},[3088],{"type":175,"value":3089},"for",{"type":169,"tag":260,"props":3091,"children":3092},{"style":315},[3093],{"type":175,"value":476},{"type":169,"tag":260,"props":3095,"children":3096},{"style":303},[3097],{"type":175,"value":306},{"type":169,"tag":260,"props":3099,"children":3100},{"style":341},[3101],{"type":175,"value":3102}," i ",{"type":169,"tag":260,"props":3104,"children":3105},{"style":439},[3106],{"type":175,"value":442},{"type":169,"tag":260,"props":3108,"children":3109},{"style":601},[3110],{"type":175,"value":1093},{"type":169,"tag":260,"props":3112,"children":3113},{"style":315},[3114],{"type":175,"value":1832},{"type":169,"tag":260,"props":3116,"children":3117},{"style":341},[3118],{"type":175,"value":3102},{"type":169,"tag":260,"props":3120,"children":3121},{"style":439},[3122],{"type":175,"value":3039},{"type":169,"tag":260,"props":3124,"children":3125},{"style":341},[3126],{"type":175,"value":3127}," size",{"type":169,"tag":260,"props":3129,"children":3130},{"style":315},[3131],{"type":175,"value":1832},{"type":169,"tag":260,"props":3133,"children":3134},{"style":341},[3135],{"type":175,"value":3136}," i",{"type":169,"tag":260,"props":3138,"children":3139},{"style":439},[3140],{"type":175,"value":3141},"++",{"type":169,"tag":260,"props":3143,"children":3144},{"style":315},[3145],{"type":175,"value":964},{"type":169,"tag":260,"props":3147,"children":3148},{"style":315},[3149],{"type":175,"value":323},{"type":169,"tag":260,"props":3151,"children":3152},{"class":262,"line":352},[3153,3158,3162,3167,3172,3176,3181,3186,3190,3194,3199,3203,3208],{"type":169,"tag":260,"props":3154,"children":3155},{"style":341},[3156],{"type":175,"value":3157},"  str",{"type":169,"tag":260,"props":3159,"children":3160},{"style":315},[3161],{"type":175,"value":1236},{"type":169,"tag":260,"props":3163,"children":3164},{"style":520},[3165],{"type":175,"value":3166},"i",{"type":169,"tag":260,"props":3168,"children":3169},{"style":315},[3170],{"type":175,"value":3171},"]",{"type":169,"tag":260,"props":3173,"children":3174},{"style":439},[3175],{"type":175,"value":1926},{"type":169,"tag":260,"props":3177,"children":3178},{"style":439},[3179],{"type":175,"value":3180}," static_cast\u003C",{"type":169,"tag":260,"props":3182,"children":3183},{"style":303},[3184],{"type":175,"value":3185},"char",{"type":169,"tag":260,"props":3187,"children":3188},{"style":439},[3189],{"type":175,"value":2247},{"type":169,"tag":260,"props":3191,"children":3192},{"style":315},[3193],{"type":175,"value":397},{"type":169,"tag":260,"props":3195,"children":3196},{"style":309},[3197],{"type":175,"value":3198},"random_dist",{"type":169,"tag":260,"props":3200,"children":3201},{"style":315},[3202],{"type":175,"value":397},{"type":169,"tag":260,"props":3204,"children":3205},{"style":520},[3206],{"type":175,"value":3207},"generator",{"type":169,"tag":260,"props":3209,"children":3210},{"style":315},[3211],{"type":175,"value":3212},"));\n",{"type":169,"tag":260,"props":3214,"children":3215},{"class":262,"line":373},[3216],{"type":169,"tag":260,"props":3217,"children":3218},{"style":315},[3219],{"type":175,"value":1106},{"type":169,"tag":177,"props":3221,"children":3223},{"id":3222},"接口层",[3224],{"type":175,"value":3222},{"type":169,"tag":183,"props":3226,"children":3227},{},[3228,3230,3236],{"type":175,"value":3229},"接口的声明位于 interface/kingdb.h，实现则是 interface/kingdb.cc。KingDB 类给 Database 和 Snapshot 定义了要求实现的 Get、Put、Delete、NewIterater、Open、Close、Flush、Compact、NewMultipartReader 接口。KDB 有自己的数据传输格式 ByteArray，诸如 Get、Put 这些接口在 KingDB 类中对应方法得到了重载，以实现通过 std::string 来传递键、值或者两者，可视为为接受 ByteArray 的方法的包装。所有数据库操作方法都返回 Status 对象，相关异常部分的简介见",{"type":169,"tag":194,"props":3231,"children":3233},{"href":3232},"#%E5%BC%82%E5%B8%B8%E4%B8%8E%E6%97%A5%E5%BF%97",[3234],{"type":175,"value":3235},"异常与日志",{"type":175,"value":3237},"小节。",{"type":169,"tag":183,"props":3239,"children":3240},{},[3241],{"type":175,"value":3242},"重载方法的实现示例如下，即先把 std::string 转回 ByteArray 再调用子类（Database 或 Snapshot）的实现。",{"type":169,"tag":249,"props":3244,"children":3246},{"code":3245,"language":252,"meta":163,"className":253,"style":163},"virtual Status Put(WriteOptions& write_options, const std::string& key, const std::string& chunk) {\n  ByteArray byte_array_key = NewDeepCopyByteArray(key.c_str(), key.size());\n  ByteArray byte_array_chunk = NewDeepCopyByteArray(chunk.c_str(), chunk.size());\n  return Put(write_options, byte_array_key, byte_array_chunk);\n}\n",[3247],{"type":169,"tag":256,"props":3248,"children":3249},{"__ignoreMap":163},[3250,3353,3409,3462,3503],{"type":169,"tag":260,"props":3251,"children":3252},{"class":262,"line":263},[3253,3258,3263,3268,3272,3277,3281,3286,3290,3294,3298,3302,3307,3311,3316,3320,3324,3328,3332,3336,3340,3345,3349],{"type":169,"tag":260,"props":3254,"children":3255},{"style":1767},[3256],{"type":175,"value":3257},"virtual",{"type":169,"tag":260,"props":3259,"children":3260},{"style":330},[3261],{"type":175,"value":3262}," Status",{"type":169,"tag":260,"props":3264,"children":3265},{"style":309},[3266],{"type":175,"value":3267}," Put",{"type":169,"tag":260,"props":3269,"children":3270},{"style":315},[3271],{"type":175,"value":397},{"type":169,"tag":260,"props":3273,"children":3274},{"style":330},[3275],{"type":175,"value":3276},"WriteOptions",{"type":169,"tag":260,"props":3278,"children":3279},{"style":1767},[3280],{"type":175,"value":2265},{"type":169,"tag":260,"props":3282,"children":3283},{"style":1176},[3284],{"type":175,"value":3285}," write_options",{"type":169,"tag":260,"props":3287,"children":3288},{"style":315},[3289],{"type":175,"value":407},{"type":169,"tag":260,"props":3291,"children":3292},{"style":1767},[3293],{"type":175,"value":2301},{"type":169,"tag":260,"props":3295,"children":3296},{"style":330},[3297],{"type":175,"value":2741},{"type":169,"tag":260,"props":3299,"children":3300},{"style":315},[3301],{"type":175,"value":338},{"type":169,"tag":260,"props":3303,"children":3304},{"style":330},[3305],{"type":175,"value":3306},"string",{"type":169,"tag":260,"props":3308,"children":3309},{"style":1767},[3310],{"type":175,"value":2265},{"type":169,"tag":260,"props":3312,"children":3313},{"style":1176},[3314],{"type":175,"value":3315}," key",{"type":169,"tag":260,"props":3317,"children":3318},{"style":315},[3319],{"type":175,"value":407},{"type":169,"tag":260,"props":3321,"children":3322},{"style":1767},[3323],{"type":175,"value":2301},{"type":169,"tag":260,"props":3325,"children":3326},{"style":330},[3327],{"type":175,"value":2741},{"type":169,"tag":260,"props":3329,"children":3330},{"style":315},[3331],{"type":175,"value":338},{"type":169,"tag":260,"props":3333,"children":3334},{"style":330},[3335],{"type":175,"value":3306},{"type":169,"tag":260,"props":3337,"children":3338},{"style":1767},[3339],{"type":175,"value":2265},{"type":169,"tag":260,"props":3341,"children":3342},{"style":1176},[3343],{"type":175,"value":3344}," chunk",{"type":169,"tag":260,"props":3346,"children":3347},{"style":315},[3348],{"type":175,"value":964},{"type":169,"tag":260,"props":3350,"children":3351},{"style":315},[3352],{"type":175,"value":323},{"type":169,"tag":260,"props":3354,"children":3355},{"class":262,"line":290},[3356,3361,3365,3370,3374,3379,3383,3387,3392,3396,3400,3405],{"type":169,"tag":260,"props":3357,"children":3358},{"style":341},[3359],{"type":175,"value":3360},"  ByteArray byte_array_key ",{"type":169,"tag":260,"props":3362,"children":3363},{"style":439},[3364],{"type":175,"value":442},{"type":169,"tag":260,"props":3366,"children":3367},{"style":309},[3368],{"type":175,"value":3369}," NewDeepCopyByteArray",{"type":169,"tag":260,"props":3371,"children":3372},{"style":315},[3373],{"type":175,"value":397},{"type":169,"tag":260,"props":3375,"children":3376},{"style":341},[3377],{"type":175,"value":3378},"key",{"type":169,"tag":260,"props":3380,"children":3381},{"style":315},[3382],{"type":175,"value":452},{"type":169,"tag":260,"props":3384,"children":3385},{"style":309},[3386],{"type":175,"value":580},{"type":169,"tag":260,"props":3388,"children":3389},{"style":315},[3390],{"type":175,"value":3391},"(),",{"type":169,"tag":260,"props":3393,"children":3394},{"style":341},[3395],{"type":175,"value":3315},{"type":169,"tag":260,"props":3397,"children":3398},{"style":315},[3399],{"type":175,"value":452},{"type":169,"tag":260,"props":3401,"children":3402},{"style":309},[3403],{"type":175,"value":3404},"size",{"type":169,"tag":260,"props":3406,"children":3407},{"style":315},[3408],{"type":175,"value":585},{"type":169,"tag":260,"props":3410,"children":3411},{"class":262,"line":299},[3412,3417,3421,3425,3429,3434,3438,3442,3446,3450,3454,3458],{"type":169,"tag":260,"props":3413,"children":3414},{"style":341},[3415],{"type":175,"value":3416},"  ByteArray byte_array_chunk ",{"type":169,"tag":260,"props":3418,"children":3419},{"style":439},[3420],{"type":175,"value":442},{"type":169,"tag":260,"props":3422,"children":3423},{"style":309},[3424],{"type":175,"value":3369},{"type":169,"tag":260,"props":3426,"children":3427},{"style":315},[3428],{"type":175,"value":397},{"type":169,"tag":260,"props":3430,"children":3431},{"style":341},[3432],{"type":175,"value":3433},"chunk",{"type":169,"tag":260,"props":3435,"children":3436},{"style":315},[3437],{"type":175,"value":452},{"type":169,"tag":260,"props":3439,"children":3440},{"style":309},[3441],{"type":175,"value":580},{"type":169,"tag":260,"props":3443,"children":3444},{"style":315},[3445],{"type":175,"value":3391},{"type":169,"tag":260,"props":3447,"children":3448},{"style":341},[3449],{"type":175,"value":3344},{"type":169,"tag":260,"props":3451,"children":3452},{"style":315},[3453],{"type":175,"value":452},{"type":169,"tag":260,"props":3455,"children":3456},{"style":309},[3457],{"type":175,"value":3404},{"type":169,"tag":260,"props":3459,"children":3460},{"style":315},[3461],{"type":175,"value":585},{"type":169,"tag":260,"props":3463,"children":3464},{"class":262,"line":326},[3465,3469,3473,3477,3481,3485,3490,3494,3499],{"type":169,"tag":260,"props":3466,"children":3467},{"style":267},[3468],{"type":175,"value":1088},{"type":169,"tag":260,"props":3470,"children":3471},{"style":309},[3472],{"type":175,"value":3267},{"type":169,"tag":260,"props":3474,"children":3475},{"style":315},[3476],{"type":175,"value":397},{"type":169,"tag":260,"props":3478,"children":3479},{"style":341},[3480],{"type":175,"value":772},{"type":169,"tag":260,"props":3482,"children":3483},{"style":315},[3484],{"type":175,"value":407},{"type":169,"tag":260,"props":3486,"children":3487},{"style":341},[3488],{"type":175,"value":3489}," byte_array_key",{"type":169,"tag":260,"props":3491,"children":3492},{"style":315},[3493],{"type":175,"value":407},{"type":169,"tag":260,"props":3495,"children":3496},{"style":341},[3497],{"type":175,"value":3498}," byte_array_chunk",{"type":169,"tag":260,"props":3500,"children":3501},{"style":315},[3502],{"type":175,"value":427},{"type":169,"tag":260,"props":3504,"children":3505},{"class":262,"line":352},[3506],{"type":169,"tag":260,"props":3507,"children":3508},{"style":315},[3509],{"type":175,"value":1106},{"type":169,"tag":1136,"props":3511,"children":3513},{"id":3512},"数据库开关",[3514],{"type":175,"value":3512},{"type":169,"tag":183,"props":3516,"children":3517},{},[3518],{"type":175,"value":3519},"数据库的开启与关闭，分别对应 Database 类的 Open 和 Close 方法。开启时，通过 stat 库函数找到数据库路径以及配置文件，使用 open 库函数获取其文件描述符。配置文件须先用 flock 锁住，使用 mmap 映射后再读取；如果没有那么分情况写入。之后，创建好 EventManager、WriteBuffer 和 StorageEngine 的实例，就完成了。关闭时过程类似，锁定住配置文件后再关闭，同时删除以上创建的实例。可以发现，资源申请全放在了 Open 中，而资源的销毁放在了 Close 中，而 Database 类析构时会自动调用 Close，所以这是一个类似 RAII 的资源管理过程。",{"type":169,"tag":249,"props":3521,"children":3523},{"code":3522,"language":252,"meta":163,"className":253,"style":163},"class Database: public KingDB {\n  virtual ~Database() { Close(); }\n  virtual Status Open() override {\n    std::string filepath_dboptions = DatabaseOptions::GetPath(dbname_);\n    fd_dboptions_ = open(filepath_dboptions.c_str(), O_RDONLY, 0644);\n    flock(fd_dboptions_, LOCK_EX | LOCK_NB);\n    Mmap mmap(filepath_dboptions, info.st_size);\n    Status status_dboptions = DatabaseOptionEncoder::DecodeFrom(mmap.datafile(), mmap.filesize(), &db_options_candidate);\n    // ...\n    em_ = new EventManager();\n    wb_ = new WriteBuffer(db_options_, em_);\n    se_ = new StorageEngine(db_options_, em_, dbname_);\n    return Status::OK(); \n  }\n  virtual void Close() override {\n    flock(fd_dboptions_, LOCK_UN);\n    close(fd_dboptions_);\n    wb_->Close();\n    se_->Close();\n    delete wb_;\n    delete se_;\n    delete em_;\n  }\n}\n",[3524],{"type":169,"tag":256,"props":3525,"children":3526},{"__ignoreMap":163},[3527,3556,3591,3620,3668,3729,3769,3812,3890,3898,3924,3967,4017,4045,4052,4079,4107,4127,4149,4169,4186,4202,4217,4224],{"type":169,"tag":260,"props":3528,"children":3529},{"class":262,"line":263},[3530,3534,3539,3543,3547,3552],{"type":169,"tag":260,"props":3531,"children":3532},{"style":303},[3533],{"type":175,"value":1680},{"type":169,"tag":260,"props":3535,"children":3536},{"style":330},[3537],{"type":175,"value":3538}," Database",{"type":169,"tag":260,"props":3540,"children":3541},{"style":315},[3542],{"type":175,"value":1365},{"type":169,"tag":260,"props":3544,"children":3545},{"style":303},[3546],{"type":175,"value":1729},{"type":169,"tag":260,"props":3548,"children":3549},{"style":330},[3550],{"type":175,"value":3551}," KingDB",{"type":169,"tag":260,"props":3553,"children":3554},{"style":315},[3555],{"type":175,"value":323},{"type":169,"tag":260,"props":3557,"children":3558},{"class":262,"line":290},[3559,3564,3569,3573,3577,3582,3586],{"type":169,"tag":260,"props":3560,"children":3561},{"style":1767},[3562],{"type":175,"value":3563},"  virtual",{"type":169,"tag":260,"props":3565,"children":3566},{"style":309},[3567],{"type":175,"value":3568}," ~Database",{"type":169,"tag":260,"props":3570,"children":3571},{"style":315},[3572],{"type":175,"value":318},{"type":169,"tag":260,"props":3574,"children":3575},{"style":315},[3576],{"type":175,"value":1789},{"type":169,"tag":260,"props":3578,"children":3579},{"style":309},[3580],{"type":175,"value":3581}," Close",{"type":169,"tag":260,"props":3583,"children":3584},{"style":315},[3585],{"type":175,"value":1756},{"type":169,"tag":260,"props":3587,"children":3588},{"style":315},[3589],{"type":175,"value":3590}," }\n",{"type":169,"tag":260,"props":3592,"children":3593},{"class":262,"line":299},[3594,3598,3602,3607,3611,3616],{"type":169,"tag":260,"props":3595,"children":3596},{"style":1767},[3597],{"type":175,"value":3563},{"type":169,"tag":260,"props":3599,"children":3600},{"style":330},[3601],{"type":175,"value":3262},{"type":169,"tag":260,"props":3603,"children":3604},{"style":309},[3605],{"type":175,"value":3606}," Open",{"type":169,"tag":260,"props":3608,"children":3609},{"style":315},[3610],{"type":175,"value":318},{"type":169,"tag":260,"props":3612,"children":3613},{"style":1767},[3614],{"type":175,"value":3615}," override",{"type":169,"tag":260,"props":3617,"children":3618},{"style":315},[3619],{"type":175,"value":323},{"type":169,"tag":260,"props":3621,"children":3622},{"class":262,"line":326},[3623,3628,3632,3637,3641,3646,3650,3655,3659,3664],{"type":169,"tag":260,"props":3624,"children":3625},{"style":330},[3626],{"type":175,"value":3627},"    std",{"type":169,"tag":260,"props":3629,"children":3630},{"style":315},[3631],{"type":175,"value":338},{"type":169,"tag":260,"props":3633,"children":3634},{"style":520},[3635],{"type":175,"value":3636},"string filepath_dboptions ",{"type":169,"tag":260,"props":3638,"children":3639},{"style":439},[3640],{"type":175,"value":442},{"type":169,"tag":260,"props":3642,"children":3643},{"style":330},[3644],{"type":175,"value":3645}," DatabaseOptions",{"type":169,"tag":260,"props":3647,"children":3648},{"style":315},[3649],{"type":175,"value":338},{"type":169,"tag":260,"props":3651,"children":3652},{"style":309},[3653],{"type":175,"value":3654},"GetPath",{"type":169,"tag":260,"props":3656,"children":3657},{"style":315},[3658],{"type":175,"value":397},{"type":169,"tag":260,"props":3660,"children":3661},{"style":520},[3662],{"type":175,"value":3663},"dbname_",{"type":169,"tag":260,"props":3665,"children":3666},{"style":315},[3667],{"type":175,"value":427},{"type":169,"tag":260,"props":3669,"children":3670},{"class":262,"line":352},[3671,3676,3680,3685,3689,3694,3698,3702,3706,3711,3715,3720,3725],{"type":169,"tag":260,"props":3672,"children":3673},{"style":520},[3674],{"type":175,"value":3675},"    fd_dboptions_ ",{"type":169,"tag":260,"props":3677,"children":3678},{"style":439},[3679],{"type":175,"value":442},{"type":169,"tag":260,"props":3681,"children":3682},{"style":309},[3683],{"type":175,"value":3684}," open",{"type":169,"tag":260,"props":3686,"children":3687},{"style":315},[3688],{"type":175,"value":397},{"type":169,"tag":260,"props":3690,"children":3691},{"style":341},[3692],{"type":175,"value":3693},"filepath_dboptions",{"type":169,"tag":260,"props":3695,"children":3696},{"style":315},[3697],{"type":175,"value":452},{"type":169,"tag":260,"props":3699,"children":3700},{"style":309},[3701],{"type":175,"value":580},{"type":169,"tag":260,"props":3703,"children":3704},{"style":315},[3705],{"type":175,"value":3391},{"type":169,"tag":260,"props":3707,"children":3708},{"style":520},[3709],{"type":175,"value":3710}," O_RDONLY",{"type":169,"tag":260,"props":3712,"children":3713},{"style":315},[3714],{"type":175,"value":407},{"type":169,"tag":260,"props":3716,"children":3718},{"style":3717},"--shiki-light:#F76D47;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[3719],{"type":175,"value":1093},{"type":169,"tag":260,"props":3721,"children":3722},{"style":601},[3723],{"type":175,"value":3724},"644",{"type":169,"tag":260,"props":3726,"children":3727},{"style":315},[3728],{"type":175,"value":427},{"type":169,"tag":260,"props":3730,"children":3731},{"class":262,"line":373},[3732,3737,3741,3746,3750,3755,3760,3765],{"type":169,"tag":260,"props":3733,"children":3734},{"style":309},[3735],{"type":175,"value":3736},"    flock",{"type":169,"tag":260,"props":3738,"children":3739},{"style":315},[3740],{"type":175,"value":397},{"type":169,"tag":260,"props":3742,"children":3743},{"style":520},[3744],{"type":175,"value":3745},"fd_dboptions_",{"type":169,"tag":260,"props":3747,"children":3748},{"style":315},[3749],{"type":175,"value":407},{"type":169,"tag":260,"props":3751,"children":3752},{"style":520},[3753],{"type":175,"value":3754}," LOCK_EX ",{"type":169,"tag":260,"props":3756,"children":3757},{"style":439},[3758],{"type":175,"value":3759},"|",{"type":169,"tag":260,"props":3761,"children":3762},{"style":520},[3763],{"type":175,"value":3764}," LOCK_NB",{"type":169,"tag":260,"props":3766,"children":3767},{"style":315},[3768],{"type":175,"value":427},{"type":169,"tag":260,"props":3770,"children":3771},{"class":262,"line":430},[3772,3777,3782,3786,3790,3794,3799,3803,3808],{"type":169,"tag":260,"props":3773,"children":3774},{"style":520},[3775],{"type":175,"value":3776},"    Mmap ",{"type":169,"tag":260,"props":3778,"children":3779},{"style":309},[3780],{"type":175,"value":3781},"mmap",{"type":169,"tag":260,"props":3783,"children":3784},{"style":315},[3785],{"type":175,"value":397},{"type":169,"tag":260,"props":3787,"children":3788},{"style":520},[3789],{"type":175,"value":3693},{"type":169,"tag":260,"props":3791,"children":3792},{"style":315},[3793],{"type":175,"value":407},{"type":169,"tag":260,"props":3795,"children":3796},{"style":341},[3797],{"type":175,"value":3798}," info",{"type":169,"tag":260,"props":3800,"children":3801},{"style":315},[3802],{"type":175,"value":452},{"type":169,"tag":260,"props":3804,"children":3805},{"style":341},[3806],{"type":175,"value":3807},"st_size",{"type":169,"tag":260,"props":3809,"children":3810},{"style":315},[3811],{"type":175,"value":427},{"type":169,"tag":260,"props":3813,"children":3814},{"class":262,"line":465},[3815,3820,3824,3829,3833,3838,3842,3846,3850,3855,3859,3864,3868,3873,3877,3881,3886],{"type":169,"tag":260,"props":3816,"children":3817},{"style":520},[3818],{"type":175,"value":3819},"    Status status_dboptions ",{"type":169,"tag":260,"props":3821,"children":3822},{"style":439},[3823],{"type":175,"value":442},{"type":169,"tag":260,"props":3825,"children":3826},{"style":330},[3827],{"type":175,"value":3828}," DatabaseOptionEncoder",{"type":169,"tag":260,"props":3830,"children":3831},{"style":315},[3832],{"type":175,"value":338},{"type":169,"tag":260,"props":3834,"children":3835},{"style":309},[3836],{"type":175,"value":3837},"DecodeFrom",{"type":169,"tag":260,"props":3839,"children":3840},{"style":315},[3841],{"type":175,"value":397},{"type":169,"tag":260,"props":3843,"children":3844},{"style":341},[3845],{"type":175,"value":3781},{"type":169,"tag":260,"props":3847,"children":3848},{"style":315},[3849],{"type":175,"value":452},{"type":169,"tag":260,"props":3851,"children":3852},{"style":309},[3853],{"type":175,"value":3854},"datafile",{"type":169,"tag":260,"props":3856,"children":3857},{"style":315},[3858],{"type":175,"value":3391},{"type":169,"tag":260,"props":3860,"children":3861},{"style":341},[3862],{"type":175,"value":3863}," mmap",{"type":169,"tag":260,"props":3865,"children":3866},{"style":315},[3867],{"type":175,"value":452},{"type":169,"tag":260,"props":3869,"children":3870},{"style":309},[3871],{"type":175,"value":3872},"filesize",{"type":169,"tag":260,"props":3874,"children":3875},{"style":315},[3876],{"type":175,"value":3391},{"type":169,"tag":260,"props":3878,"children":3879},{"style":439},[3880],{"type":175,"value":895},{"type":169,"tag":260,"props":3882,"children":3883},{"style":520},[3884],{"type":175,"value":3885},"db_options_candidate",{"type":169,"tag":260,"props":3887,"children":3888},{"style":315},[3889],{"type":175,"value":427},{"type":169,"tag":260,"props":3891,"children":3892},{"class":262,"line":507},[3893],{"type":169,"tag":260,"props":3894,"children":3895},{"style":1269},[3896],{"type":175,"value":3897},"    // ...\n",{"type":169,"tag":260,"props":3899,"children":3900},{"class":262,"line":588},[3901,3906,3910,3915,3920],{"type":169,"tag":260,"props":3902,"children":3903},{"style":520},[3904],{"type":175,"value":3905},"    em_ ",{"type":169,"tag":260,"props":3907,"children":3908},{"style":439},[3909],{"type":175,"value":442},{"type":169,"tag":260,"props":3911,"children":3912},{"style":439},[3913],{"type":175,"value":3914}," new",{"type":169,"tag":260,"props":3916,"children":3917},{"style":309},[3918],{"type":175,"value":3919}," EventManager",{"type":169,"tag":260,"props":3921,"children":3922},{"style":315},[3923],{"type":175,"value":462},{"type":169,"tag":260,"props":3925,"children":3926},{"class":262,"line":611},[3927,3932,3936,3940,3945,3949,3954,3958,3963],{"type":169,"tag":260,"props":3928,"children":3929},{"style":520},[3930],{"type":175,"value":3931},"    wb_ ",{"type":169,"tag":260,"props":3933,"children":3934},{"style":439},[3935],{"type":175,"value":442},{"type":169,"tag":260,"props":3937,"children":3938},{"style":439},[3939],{"type":175,"value":3914},{"type":169,"tag":260,"props":3941,"children":3942},{"style":309},[3943],{"type":175,"value":3944}," WriteBuffer",{"type":169,"tag":260,"props":3946,"children":3947},{"style":315},[3948],{"type":175,"value":397},{"type":169,"tag":260,"props":3950,"children":3951},{"style":520},[3952],{"type":175,"value":3953},"db_options_",{"type":169,"tag":260,"props":3955,"children":3956},{"style":315},[3957],{"type":175,"value":407},{"type":169,"tag":260,"props":3959,"children":3960},{"style":520},[3961],{"type":175,"value":3962}," em_",{"type":169,"tag":260,"props":3964,"children":3965},{"style":315},[3966],{"type":175,"value":427},{"type":169,"tag":260,"props":3968,"children":3969},{"class":262,"line":620},[3970,3975,3979,3983,3988,3992,3996,4000,4004,4008,4013],{"type":169,"tag":260,"props":3971,"children":3972},{"style":520},[3973],{"type":175,"value":3974},"    se_ ",{"type":169,"tag":260,"props":3976,"children":3977},{"style":439},[3978],{"type":175,"value":442},{"type":169,"tag":260,"props":3980,"children":3981},{"style":439},[3982],{"type":175,"value":3914},{"type":169,"tag":260,"props":3984,"children":3985},{"style":309},[3986],{"type":175,"value":3987}," StorageEngine",{"type":169,"tag":260,"props":3989,"children":3990},{"style":315},[3991],{"type":175,"value":397},{"type":169,"tag":260,"props":3993,"children":3994},{"style":520},[3995],{"type":175,"value":3953},{"type":169,"tag":260,"props":3997,"children":3998},{"style":315},[3999],{"type":175,"value":407},{"type":169,"tag":260,"props":4001,"children":4002},{"style":520},[4003],{"type":175,"value":3962},{"type":169,"tag":260,"props":4005,"children":4006},{"style":315},[4007],{"type":175,"value":407},{"type":169,"tag":260,"props":4009,"children":4010},{"style":520},[4011],{"type":175,"value":4012}," dbname_",{"type":169,"tag":260,"props":4014,"children":4015},{"style":315},[4016],{"type":175,"value":427},{"type":169,"tag":260,"props":4018,"children":4019},{"class":262,"line":628},[4020,4024,4028,4032,4037,4041],{"type":169,"tag":260,"props":4021,"children":4022},{"style":267},[4023],{"type":175,"value":2500},{"type":169,"tag":260,"props":4025,"children":4026},{"style":330},[4027],{"type":175,"value":3262},{"type":169,"tag":260,"props":4029,"children":4030},{"style":315},[4031],{"type":175,"value":338},{"type":169,"tag":260,"props":4033,"children":4034},{"style":309},[4035],{"type":175,"value":4036},"OK",{"type":169,"tag":260,"props":4038,"children":4039},{"style":315},[4040],{"type":175,"value":1756},{"type":169,"tag":260,"props":4042,"children":4043},{"style":520},[4044],{"type":175,"value":1008},{"type":169,"tag":260,"props":4046,"children":4047},{"class":262,"line":671},[4048],{"type":169,"tag":260,"props":4049,"children":4050},{"style":315},[4051],{"type":175,"value":617},{"type":169,"tag":260,"props":4053,"children":4054},{"class":262,"line":712},[4055,4059,4063,4067,4071,4075],{"type":169,"tag":260,"props":4056,"children":4057},{"style":1767},[4058],{"type":175,"value":3563},{"type":169,"tag":260,"props":4060,"children":4061},{"style":303},[4062],{"type":175,"value":1775},{"type":169,"tag":260,"props":4064,"children":4065},{"style":309},[4066],{"type":175,"value":3581},{"type":169,"tag":260,"props":4068,"children":4069},{"style":315},[4070],{"type":175,"value":318},{"type":169,"tag":260,"props":4072,"children":4073},{"style":1767},[4074],{"type":175,"value":3615},{"type":169,"tag":260,"props":4076,"children":4077},{"style":315},[4078],{"type":175,"value":323},{"type":169,"tag":260,"props":4080,"children":4081},{"class":262,"line":720},[4082,4086,4090,4094,4098,4103],{"type":169,"tag":260,"props":4083,"children":4084},{"style":309},[4085],{"type":175,"value":3736},{"type":169,"tag":260,"props":4087,"children":4088},{"style":315},[4089],{"type":175,"value":397},{"type":169,"tag":260,"props":4091,"children":4092},{"style":520},[4093],{"type":175,"value":3745},{"type":169,"tag":260,"props":4095,"children":4096},{"style":315},[4097],{"type":175,"value":407},{"type":169,"tag":260,"props":4099,"children":4100},{"style":520},[4101],{"type":175,"value":4102}," LOCK_UN",{"type":169,"tag":260,"props":4104,"children":4105},{"style":315},[4106],{"type":175,"value":427},{"type":169,"tag":260,"props":4108,"children":4109},{"class":262,"line":741},[4110,4115,4119,4123],{"type":169,"tag":260,"props":4111,"children":4112},{"style":309},[4113],{"type":175,"value":4114},"    close",{"type":169,"tag":260,"props":4116,"children":4117},{"style":315},[4118],{"type":175,"value":397},{"type":169,"tag":260,"props":4120,"children":4121},{"style":520},[4122],{"type":175,"value":3745},{"type":169,"tag":260,"props":4124,"children":4125},{"style":315},[4126],{"type":175,"value":427},{"type":169,"tag":260,"props":4128,"children":4129},{"class":262,"line":797},[4130,4135,4140,4145],{"type":169,"tag":260,"props":4131,"children":4132},{"style":341},[4133],{"type":175,"value":4134},"    wb_",{"type":169,"tag":260,"props":4136,"children":4137},{"style":315},[4138],{"type":175,"value":4139},"->",{"type":169,"tag":260,"props":4141,"children":4142},{"style":309},[4143],{"type":175,"value":4144},"Close",{"type":169,"tag":260,"props":4146,"children":4147},{"style":315},[4148],{"type":175,"value":462},{"type":169,"tag":260,"props":4150,"children":4151},{"class":262,"line":805},[4152,4157,4161,4165],{"type":169,"tag":260,"props":4153,"children":4154},{"style":341},[4155],{"type":175,"value":4156},"    se_",{"type":169,"tag":260,"props":4158,"children":4159},{"style":315},[4160],{"type":175,"value":4139},{"type":169,"tag":260,"props":4162,"children":4163},{"style":309},[4164],{"type":175,"value":4144},{"type":169,"tag":260,"props":4166,"children":4167},{"style":315},[4168],{"type":175,"value":462},{"type":169,"tag":260,"props":4170,"children":4171},{"class":262,"line":826},[4172,4177,4182],{"type":169,"tag":260,"props":4173,"children":4174},{"style":439},[4175],{"type":175,"value":4176},"    delete",{"type":169,"tag":260,"props":4178,"children":4179},{"style":520},[4180],{"type":175,"value":4181}," wb_",{"type":169,"tag":260,"props":4183,"children":4184},{"style":315},[4185],{"type":175,"value":349},{"type":169,"tag":260,"props":4187,"children":4188},{"class":262,"line":847},[4189,4193,4198],{"type":169,"tag":260,"props":4190,"children":4191},{"style":439},[4192],{"type":175,"value":4176},{"type":169,"tag":260,"props":4194,"children":4195},{"style":520},[4196],{"type":175,"value":4197}," se_",{"type":169,"tag":260,"props":4199,"children":4200},{"style":315},[4201],{"type":175,"value":349},{"type":169,"tag":260,"props":4203,"children":4204},{"class":262,"line":907},[4205,4209,4213],{"type":169,"tag":260,"props":4206,"children":4207},{"style":439},[4208],{"type":175,"value":4176},{"type":169,"tag":260,"props":4210,"children":4211},{"style":520},[4212],{"type":175,"value":3962},{"type":169,"tag":260,"props":4214,"children":4215},{"style":315},[4216],{"type":175,"value":349},{"type":169,"tag":260,"props":4218,"children":4219},{"class":262,"line":971},[4220],{"type":169,"tag":260,"props":4221,"children":4222},{"style":315},[4223],{"type":175,"value":617},{"type":169,"tag":260,"props":4225,"children":4226},{"class":262,"line":1011},[4227],{"type":169,"tag":260,"props":4228,"children":4229},{"style":315},[4230],{"type":175,"value":1106},{"type":169,"tag":183,"props":4232,"children":4233},{},[4234],{"type":175,"value":4235},"因为数据库不能同时关闭或是开启，所以 Open 以及 Close 中都使用了 std::unique_lock 进行锁定。",{"type":169,"tag":249,"props":4237,"children":4239},{"code":4238,"language":252,"meta":163,"className":253,"style":163},"virtual Status Open() override {\n  std::unique_lock\u003Cstd::mutex> lock(mutex_close_);\n}\nvirtual void Close() override {\n  std::unique_lock\u003Cstd::mutex> lock(mutex_close_);\n}\n",[4240],{"type":169,"tag":256,"props":4241,"children":4242},{"__ignoreMap":163},[4243,4270,4325,4332,4359,4410],{"type":169,"tag":260,"props":4244,"children":4245},{"class":262,"line":263},[4246,4250,4254,4258,4262,4266],{"type":169,"tag":260,"props":4247,"children":4248},{"style":1767},[4249],{"type":175,"value":3257},{"type":169,"tag":260,"props":4251,"children":4252},{"style":330},[4253],{"type":175,"value":3262},{"type":169,"tag":260,"props":4255,"children":4256},{"style":309},[4257],{"type":175,"value":3606},{"type":169,"tag":260,"props":4259,"children":4260},{"style":315},[4261],{"type":175,"value":318},{"type":169,"tag":260,"props":4263,"children":4264},{"style":1767},[4265],{"type":175,"value":3615},{"type":169,"tag":260,"props":4267,"children":4268},{"style":315},[4269],{"type":175,"value":323},{"type":169,"tag":260,"props":4271,"children":4272},{"class":262,"line":290},[4273,4277,4281,4286,4290,4294,4298,4303,4307,4312,4316,4321],{"type":169,"tag":260,"props":4274,"children":4275},{"style":330},[4276],{"type":175,"value":634},{"type":169,"tag":260,"props":4278,"children":4279},{"style":315},[4280],{"type":175,"value":338},{"type":169,"tag":260,"props":4282,"children":4283},{"style":341},[4284],{"type":175,"value":4285},"unique_lock",{"type":169,"tag":260,"props":4287,"children":4288},{"style":439},[4289],{"type":175,"value":3039},{"type":169,"tag":260,"props":4291,"children":4292},{"style":330},[4293],{"type":175,"value":2711},{"type":169,"tag":260,"props":4295,"children":4296},{"style":315},[4297],{"type":175,"value":338},{"type":169,"tag":260,"props":4299,"children":4300},{"style":341},[4301],{"type":175,"value":4302},"mutex",{"type":169,"tag":260,"props":4304,"children":4305},{"style":439},[4306],{"type":175,"value":2247},{"type":169,"tag":260,"props":4308,"children":4309},{"style":309},[4310],{"type":175,"value":4311}," lock",{"type":169,"tag":260,"props":4313,"children":4314},{"style":315},[4315],{"type":175,"value":397},{"type":169,"tag":260,"props":4317,"children":4318},{"style":341},[4319],{"type":175,"value":4320},"mutex_close_",{"type":169,"tag":260,"props":4322,"children":4323},{"style":315},[4324],{"type":175,"value":427},{"type":169,"tag":260,"props":4326,"children":4327},{"class":262,"line":299},[4328],{"type":169,"tag":260,"props":4329,"children":4330},{"style":315},[4331],{"type":175,"value":1106},{"type":169,"tag":260,"props":4333,"children":4334},{"class":262,"line":326},[4335,4339,4343,4347,4351,4355],{"type":169,"tag":260,"props":4336,"children":4337},{"style":1767},[4338],{"type":175,"value":3257},{"type":169,"tag":260,"props":4340,"children":4341},{"style":303},[4342],{"type":175,"value":1775},{"type":169,"tag":260,"props":4344,"children":4345},{"style":309},[4346],{"type":175,"value":3581},{"type":169,"tag":260,"props":4348,"children":4349},{"style":315},[4350],{"type":175,"value":318},{"type":169,"tag":260,"props":4352,"children":4353},{"style":1767},[4354],{"type":175,"value":3615},{"type":169,"tag":260,"props":4356,"children":4357},{"style":315},[4358],{"type":175,"value":323},{"type":169,"tag":260,"props":4360,"children":4361},{"class":262,"line":352},[4362,4366,4370,4374,4378,4382,4386,4390,4394,4398,4402,4406],{"type":169,"tag":260,"props":4363,"children":4364},{"style":330},[4365],{"type":175,"value":634},{"type":169,"tag":260,"props":4367,"children":4368},{"style":315},[4369],{"type":175,"value":338},{"type":169,"tag":260,"props":4371,"children":4372},{"style":341},[4373],{"type":175,"value":4285},{"type":169,"tag":260,"props":4375,"children":4376},{"style":439},[4377],{"type":175,"value":3039},{"type":169,"tag":260,"props":4379,"children":4380},{"style":330},[4381],{"type":175,"value":2711},{"type":169,"tag":260,"props":4383,"children":4384},{"style":315},[4385],{"type":175,"value":338},{"type":169,"tag":260,"props":4387,"children":4388},{"style":341},[4389],{"type":175,"value":4302},{"type":169,"tag":260,"props":4391,"children":4392},{"style":439},[4393],{"type":175,"value":2247},{"type":169,"tag":260,"props":4395,"children":4396},{"style":309},[4397],{"type":175,"value":4311},{"type":169,"tag":260,"props":4399,"children":4400},{"style":315},[4401],{"type":175,"value":397},{"type":169,"tag":260,"props":4403,"children":4404},{"style":341},[4405],{"type":175,"value":4320},{"type":169,"tag":260,"props":4407,"children":4408},{"style":315},[4409],{"type":175,"value":427},{"type":169,"tag":260,"props":4411,"children":4412},{"class":262,"line":373},[4413],{"type":169,"tag":260,"props":4414,"children":4415},{"style":315},[4416],{"type":175,"value":1106},{"type":169,"tag":177,"props":4418,"children":4419},{"id":3235},[4420],{"type":175,"value":3235},{"type":169,"tag":183,"props":4422,"children":4423},{},[4424],{"type":175,"value":4425},"代码没有使用 C++ 风格的异常捕获，取而代之的是设计了状态类 Status。就像 kingdb_user 示例展示的，所有数据库操作都会返回一个状态实例，通过调用其 IsOK 方法，调用者可以判断处出操作有没有成功；如果失败了，可以使用 ToString 方法把出错原因输出。尽管这种设计会带来额外的内存开销，且使每次调用都带来轻微的性能消耗，不过这种消耗可以避免魔法数值，它将错误码和核心解耦，使代码有更佳的可读性。",{"type":169,"tag":249,"props":4427,"children":4429},{"code":4428,"language":252,"meta":163,"className":253,"style":163},"class Status {\n  // ...\n  static Status OK() { return Status(); }\n  bool IsOK() const { return (code_ == kOK); }\n  // ...\n  enum Code {\n    kOK = 0, \n    kNotFound = 1,\n    kDeleteOrder = 2,\n    kInvalidArgument = 3,\n    kIOError = 4,\n    kDone = 5,\n    kMultipartRequired = 6\n  };\n  // ...\n}\nstd::string Status::ToString() const {\n  if (message1_ == \"\") {\n    return \"OK\";\n  } else {\n    char tmp[30];\n    const char* type;\n    switch (code()) {\n      case kOK:\n        type = \"OK\";\n        break;\n      // ...\n    }\n    // ...\n    return result;\n  }\n}\n",[4430],{"type":169,"tag":256,"props":4431,"children":4432},{"__ignoreMap":163},[4433,4448,4455,4496,4551,4558,4575,4600,4621,4642,4663,4684,4705,4722,4730,4737,4744,4783,4816,4839,4854,4880,4907,4931,4948,4976,4988,4996,5004,5011,5028,5036],{"type":169,"tag":260,"props":4434,"children":4435},{"class":262,"line":263},[4436,4440,4444],{"type":169,"tag":260,"props":4437,"children":4438},{"style":303},[4439],{"type":175,"value":1680},{"type":169,"tag":260,"props":4441,"children":4442},{"style":330},[4443],{"type":175,"value":3262},{"type":169,"tag":260,"props":4445,"children":4446},{"style":315},[4447],{"type":175,"value":323},{"type":169,"tag":260,"props":4449,"children":4450},{"class":262,"line":290},[4451],{"type":169,"tag":260,"props":4452,"children":4453},{"style":1269},[4454],{"type":175,"value":1625},{"type":169,"tag":260,"props":4456,"children":4457},{"class":262,"line":299},[4458,4462,4466,4471,4475,4479,4484,4488,4492],{"type":169,"tag":260,"props":4459,"children":4460},{"style":1767},[4461],{"type":175,"value":1770},{"type":169,"tag":260,"props":4463,"children":4464},{"style":330},[4465],{"type":175,"value":3262},{"type":169,"tag":260,"props":4467,"children":4468},{"style":309},[4469],{"type":175,"value":4470}," OK",{"type":169,"tag":260,"props":4472,"children":4473},{"style":315},[4474],{"type":175,"value":318},{"type":169,"tag":260,"props":4476,"children":4477},{"style":315},[4478],{"type":175,"value":1789},{"type":169,"tag":260,"props":4480,"children":4481},{"style":267},[4482],{"type":175,"value":4483}," return",{"type":169,"tag":260,"props":4485,"children":4486},{"style":309},[4487],{"type":175,"value":3262},{"type":169,"tag":260,"props":4489,"children":4490},{"style":315},[4491],{"type":175,"value":1756},{"type":169,"tag":260,"props":4493,"children":4494},{"style":315},[4495],{"type":175,"value":3590},{"type":169,"tag":260,"props":4497,"children":4498},{"class":262,"line":326},[4499,4504,4509,4513,4517,4521,4525,4529,4534,4538,4543,4547],{"type":169,"tag":260,"props":4500,"children":4501},{"style":303},[4502],{"type":175,"value":4503},"  bool",{"type":169,"tag":260,"props":4505,"children":4506},{"style":309},[4507],{"type":175,"value":4508}," IsOK",{"type":169,"tag":260,"props":4510,"children":4511},{"style":315},[4512],{"type":175,"value":318},{"type":169,"tag":260,"props":4514,"children":4515},{"style":1767},[4516],{"type":175,"value":2301},{"type":169,"tag":260,"props":4518,"children":4519},{"style":315},[4520],{"type":175,"value":1789},{"type":169,"tag":260,"props":4522,"children":4523},{"style":267},[4524],{"type":175,"value":4483},{"type":169,"tag":260,"props":4526,"children":4527},{"style":315},[4528],{"type":175,"value":476},{"type":169,"tag":260,"props":4530,"children":4531},{"style":520},[4532],{"type":175,"value":4533},"code_ ",{"type":169,"tag":260,"props":4535,"children":4536},{"style":439},[4537],{"type":175,"value":947},{"type":169,"tag":260,"props":4539,"children":4540},{"style":520},[4541],{"type":175,"value":4542}," kOK",{"type":169,"tag":260,"props":4544,"children":4545},{"style":315},[4546],{"type":175,"value":1003},{"type":169,"tag":260,"props":4548,"children":4549},{"style":315},[4550],{"type":175,"value":3590},{"type":169,"tag":260,"props":4552,"children":4553},{"class":262,"line":352},[4554],{"type":169,"tag":260,"props":4555,"children":4556},{"style":1269},[4557],{"type":175,"value":1625},{"type":169,"tag":260,"props":4559,"children":4560},{"class":262,"line":373},[4561,4566,4571],{"type":169,"tag":260,"props":4562,"children":4563},{"style":303},[4564],{"type":175,"value":4565},"  enum",{"type":169,"tag":260,"props":4567,"children":4568},{"style":330},[4569],{"type":175,"value":4570}," Code",{"type":169,"tag":260,"props":4572,"children":4573},{"style":315},[4574],{"type":175,"value":323},{"type":169,"tag":260,"props":4576,"children":4577},{"class":262,"line":430},[4578,4584,4588,4592,4596],{"type":169,"tag":260,"props":4579,"children":4581},{"style":4580},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#F8F8F2",[4582],{"type":175,"value":4583},"    kOK",{"type":169,"tag":260,"props":4585,"children":4586},{"style":439},[4587],{"type":175,"value":1926},{"type":169,"tag":260,"props":4589,"children":4590},{"style":601},[4591],{"type":175,"value":1093},{"type":169,"tag":260,"props":4593,"children":4594},{"style":315},[4595],{"type":175,"value":407},{"type":169,"tag":260,"props":4597,"children":4598},{"style":520},[4599],{"type":175,"value":1008},{"type":169,"tag":260,"props":4601,"children":4602},{"class":262,"line":465},[4603,4608,4612,4616],{"type":169,"tag":260,"props":4604,"children":4605},{"style":4580},[4606],{"type":175,"value":4607},"    kNotFound",{"type":169,"tag":260,"props":4609,"children":4610},{"style":439},[4611],{"type":175,"value":1926},{"type":169,"tag":260,"props":4613,"children":4614},{"style":601},[4615],{"type":175,"value":2818},{"type":169,"tag":260,"props":4617,"children":4618},{"style":315},[4619],{"type":175,"value":4620},",\n",{"type":169,"tag":260,"props":4622,"children":4623},{"class":262,"line":507},[4624,4629,4633,4638],{"type":169,"tag":260,"props":4625,"children":4626},{"style":4580},[4627],{"type":175,"value":4628},"    kDeleteOrder",{"type":169,"tag":260,"props":4630,"children":4631},{"style":439},[4632],{"type":175,"value":1926},{"type":169,"tag":260,"props":4634,"children":4635},{"style":601},[4636],{"type":175,"value":4637}," 2",{"type":169,"tag":260,"props":4639,"children":4640},{"style":315},[4641],{"type":175,"value":4620},{"type":169,"tag":260,"props":4643,"children":4644},{"class":262,"line":588},[4645,4650,4654,4659],{"type":169,"tag":260,"props":4646,"children":4647},{"style":4580},[4648],{"type":175,"value":4649},"    kInvalidArgument",{"type":169,"tag":260,"props":4651,"children":4652},{"style":439},[4653],{"type":175,"value":1926},{"type":169,"tag":260,"props":4655,"children":4656},{"style":601},[4657],{"type":175,"value":4658}," 3",{"type":169,"tag":260,"props":4660,"children":4661},{"style":315},[4662],{"type":175,"value":4620},{"type":169,"tag":260,"props":4664,"children":4665},{"class":262,"line":611},[4666,4671,4675,4680],{"type":169,"tag":260,"props":4667,"children":4668},{"style":4580},[4669],{"type":175,"value":4670},"    kIOError",{"type":169,"tag":260,"props":4672,"children":4673},{"style":439},[4674],{"type":175,"value":1926},{"type":169,"tag":260,"props":4676,"children":4677},{"style":601},[4678],{"type":175,"value":4679}," 4",{"type":169,"tag":260,"props":4681,"children":4682},{"style":315},[4683],{"type":175,"value":4620},{"type":169,"tag":260,"props":4685,"children":4686},{"class":262,"line":620},[4687,4692,4696,4701],{"type":169,"tag":260,"props":4688,"children":4689},{"style":4580},[4690],{"type":175,"value":4691},"    kDone",{"type":169,"tag":260,"props":4693,"children":4694},{"style":439},[4695],{"type":175,"value":1926},{"type":169,"tag":260,"props":4697,"children":4698},{"style":601},[4699],{"type":175,"value":4700}," 5",{"type":169,"tag":260,"props":4702,"children":4703},{"style":315},[4704],{"type":175,"value":4620},{"type":169,"tag":260,"props":4706,"children":4707},{"class":262,"line":628},[4708,4713,4717],{"type":169,"tag":260,"props":4709,"children":4710},{"style":4580},[4711],{"type":175,"value":4712},"    kMultipartRequired",{"type":169,"tag":260,"props":4714,"children":4715},{"style":439},[4716],{"type":175,"value":1926},{"type":169,"tag":260,"props":4718,"children":4719},{"style":601},[4720],{"type":175,"value":4721}," 6\n",{"type":169,"tag":260,"props":4723,"children":4724},{"class":262,"line":671},[4725],{"type":169,"tag":260,"props":4726,"children":4727},{"style":315},[4728],{"type":175,"value":4729},"  };\n",{"type":169,"tag":260,"props":4731,"children":4732},{"class":262,"line":712},[4733],{"type":169,"tag":260,"props":4734,"children":4735},{"style":1269},[4736],{"type":175,"value":1625},{"type":169,"tag":260,"props":4738,"children":4739},{"class":262,"line":720},[4740],{"type":169,"tag":260,"props":4741,"children":4742},{"style":315},[4743],{"type":175,"value":1106},{"type":169,"tag":260,"props":4745,"children":4746},{"class":262,"line":741},[4747,4751,4755,4759,4763,4767,4771,4775,4779],{"type":169,"tag":260,"props":4748,"children":4749},{"style":330},[4750],{"type":175,"value":2711},{"type":169,"tag":260,"props":4752,"children":4753},{"style":315},[4754],{"type":175,"value":338},{"type":169,"tag":260,"props":4756,"children":4757},{"style":330},[4758],{"type":175,"value":3306},{"type":169,"tag":260,"props":4760,"children":4761},{"style":330},[4762],{"type":175,"value":3262},{"type":169,"tag":260,"props":4764,"children":4765},{"style":315},[4766],{"type":175,"value":338},{"type":169,"tag":260,"props":4768,"children":4769},{"style":309},[4770],{"type":175,"value":570},{"type":169,"tag":260,"props":4772,"children":4773},{"style":315},[4774],{"type":175,"value":318},{"type":169,"tag":260,"props":4776,"children":4777},{"style":1767},[4778],{"type":175,"value":2301},{"type":169,"tag":260,"props":4780,"children":4781},{"style":315},[4782],{"type":175,"value":323},{"type":169,"tag":260,"props":4784,"children":4785},{"class":262,"line":797},[4786,4790,4794,4799,4803,4808,4812],{"type":169,"tag":260,"props":4787,"children":4788},{"style":267},[4789],{"type":175,"value":471},{"type":169,"tag":260,"props":4791,"children":4792},{"style":315},[4793],{"type":175,"value":476},{"type":169,"tag":260,"props":4795,"children":4796},{"style":520},[4797],{"type":175,"value":4798},"message1_ ",{"type":169,"tag":260,"props":4800,"children":4801},{"style":439},[4802],{"type":175,"value":947},{"type":169,"tag":260,"props":4804,"children":4805},{"style":273},[4806],{"type":175,"value":4807}," \"\"",{"type":169,"tag":260,"props":4809,"children":4810},{"style":315},[4811],{"type":175,"value":964},{"type":169,"tag":260,"props":4813,"children":4814},{"style":315},[4815],{"type":175,"value":323},{"type":169,"tag":260,"props":4817,"children":4818},{"class":262,"line":805},[4819,4823,4827,4831,4835],{"type":169,"tag":260,"props":4820,"children":4821},{"style":267},[4822],{"type":175,"value":2500},{"type":169,"tag":260,"props":4824,"children":4825},{"style":273},[4826],{"type":175,"value":412},{"type":169,"tag":260,"props":4828,"children":4829},{"style":279},[4830],{"type":175,"value":4036},{"type":169,"tag":260,"props":4832,"children":4833},{"style":273},[4834],{"type":175,"value":422},{"type":169,"tag":260,"props":4836,"children":4837},{"style":315},[4838],{"type":175,"value":349},{"type":169,"tag":260,"props":4840,"children":4841},{"class":262,"line":826},[4842,4846,4850],{"type":169,"tag":260,"props":4843,"children":4844},{"style":315},[4845],{"type":175,"value":1017},{"type":169,"tag":260,"props":4847,"children":4848},{"style":267},[4849],{"type":175,"value":1022},{"type":169,"tag":260,"props":4851,"children":4852},{"style":315},[4853],{"type":175,"value":323},{"type":169,"tag":260,"props":4855,"children":4856},{"class":262,"line":847},[4857,4862,4867,4871,4876],{"type":169,"tag":260,"props":4858,"children":4859},{"style":303},[4860],{"type":175,"value":4861},"    char",{"type":169,"tag":260,"props":4863,"children":4864},{"style":341},[4865],{"type":175,"value":4866}," tmp",{"type":169,"tag":260,"props":4868,"children":4869},{"style":315},[4870],{"type":175,"value":1236},{"type":169,"tag":260,"props":4872,"children":4873},{"style":601},[4874],{"type":175,"value":4875},"30",{"type":169,"tag":260,"props":4877,"children":4878},{"style":315},[4879],{"type":175,"value":1246},{"type":169,"tag":260,"props":4881,"children":4882},{"class":262,"line":907},[4883,4888,4893,4898,4903],{"type":169,"tag":260,"props":4884,"children":4885},{"style":1767},[4886],{"type":175,"value":4887},"    const",{"type":169,"tag":260,"props":4889,"children":4890},{"style":303},[4891],{"type":175,"value":4892}," char",{"type":169,"tag":260,"props":4894,"children":4895},{"style":439},[4896],{"type":175,"value":4897},"*",{"type":169,"tag":260,"props":4899,"children":4900},{"style":520},[4901],{"type":175,"value":4902}," type",{"type":169,"tag":260,"props":4904,"children":4905},{"style":315},[4906],{"type":175,"value":349},{"type":169,"tag":260,"props":4908,"children":4909},{"class":262,"line":971},[4910,4915,4919,4923,4927],{"type":169,"tag":260,"props":4911,"children":4912},{"style":267},[4913],{"type":175,"value":4914},"    switch",{"type":169,"tag":260,"props":4916,"children":4917},{"style":315},[4918],{"type":175,"value":476},{"type":169,"tag":260,"props":4920,"children":4921},{"style":309},[4922],{"type":175,"value":256},{"type":169,"tag":260,"props":4924,"children":4925},{"style":315},[4926],{"type":175,"value":500},{"type":169,"tag":260,"props":4928,"children":4929},{"style":315},[4930],{"type":175,"value":323},{"type":169,"tag":260,"props":4932,"children":4933},{"class":262,"line":1011},[4934,4939,4943],{"type":169,"tag":260,"props":4935,"children":4936},{"style":267},[4937],{"type":175,"value":4938},"      case",{"type":169,"tag":260,"props":4940,"children":4941},{"style":520},[4942],{"type":175,"value":4542},{"type":169,"tag":260,"props":4944,"children":4945},{"style":315},[4946],{"type":175,"value":4947},":\n",{"type":169,"tag":260,"props":4949,"children":4950},{"class":262,"line":1029},[4951,4956,4960,4964,4968,4972],{"type":169,"tag":260,"props":4952,"children":4953},{"style":520},[4954],{"type":175,"value":4955},"        type ",{"type":169,"tag":260,"props":4957,"children":4958},{"style":439},[4959],{"type":175,"value":442},{"type":169,"tag":260,"props":4961,"children":4962},{"style":273},[4963],{"type":175,"value":412},{"type":169,"tag":260,"props":4965,"children":4966},{"style":279},[4967],{"type":175,"value":4036},{"type":169,"tag":260,"props":4969,"children":4970},{"style":273},[4971],{"type":175,"value":422},{"type":169,"tag":260,"props":4973,"children":4974},{"style":315},[4975],{"type":175,"value":349},{"type":169,"tag":260,"props":4977,"children":4978},{"class":262,"line":1066},[4979,4984],{"type":169,"tag":260,"props":4980,"children":4981},{"style":267},[4982],{"type":175,"value":4983},"        break",{"type":169,"tag":260,"props":4985,"children":4986},{"style":315},[4987],{"type":175,"value":349},{"type":169,"tag":260,"props":4989,"children":4990},{"class":262,"line":1074},[4991],{"type":169,"tag":260,"props":4992,"children":4993},{"style":1269},[4994],{"type":175,"value":4995},"      // ...\n",{"type":169,"tag":260,"props":4997,"children":4998},{"class":262,"line":1082},[4999],{"type":169,"tag":260,"props":5000,"children":5001},{"style":315},[5002],{"type":175,"value":5003},"    }\n",{"type":169,"tag":260,"props":5005,"children":5006},{"class":262,"line":1100},[5007],{"type":169,"tag":260,"props":5008,"children":5009},{"style":1269},[5010],{"type":175,"value":3897},{"type":169,"tag":260,"props":5012,"children":5014},{"class":262,"line":5013},30,[5015,5019,5024],{"type":169,"tag":260,"props":5016,"children":5017},{"style":267},[5018],{"type":175,"value":2500},{"type":169,"tag":260,"props":5020,"children":5021},{"style":520},[5022],{"type":175,"value":5023}," result",{"type":169,"tag":260,"props":5025,"children":5026},{"style":315},[5027],{"type":175,"value":349},{"type":169,"tag":260,"props":5029,"children":5031},{"class":262,"line":5030},31,[5032],{"type":169,"tag":260,"props":5033,"children":5034},{"style":315},[5035],{"type":175,"value":617},{"type":169,"tag":260,"props":5037,"children":5039},{"class":262,"line":5038},32,[5040],{"type":169,"tag":260,"props":5041,"children":5042},{"style":315},[5043],{"type":175,"value":1106},{"type":169,"tag":183,"props":5045,"children":5046},{},[5047],{"type":175,"value":5048},"KDB 内部代码出现异常时会使用日志将其记录下来。如果没有日志，那么在排查代码问题时简直就是噩梦。KDB 有两套日志的输出目标，分别是系统输出和标准输出设备。日志类记录输出目标、日志级别、线程锁等成员，并通过静态方法 Logv 实现记录日志。锁的最大用处是保证记录顺序。仅有当出现最高级别的日志（kLogLevelEMERG）时，才会跳过锁直接写入。出现 kLogLevelEMERG 时意味着程序遇到了紧急问题，通常会直接退出或是返回 Status 异常，所以这个时候需要及时记录。",{"type":169,"tag":183,"props":5050,"children":5051},{},[5052],{"type":175,"value":5053},"日志级别的划分参考了 Syslog：",{"type":169,"tag":210,"props":5055,"children":5056},{},[5057,5062,5067,5072,5077,5082,5087,5092,5097,5102],{"type":169,"tag":214,"props":5058,"children":5059},{},[5060],{"type":175,"value":5061},"silent: all logging is turned off",{"type":169,"tag":214,"props":5063,"children":5064},{},[5065],{"type":175,"value":5066},"emerg: system is unusable, imminent crash",{"type":169,"tag":214,"props":5068,"children":5069},{},[5070],{"type":175,"value":5071},"alert: error event, immediate action required",{"type":169,"tag":214,"props":5073,"children":5074},{},[5075],{"type":175,"value":5076},"crit: error event, immediate action required",{"type":169,"tag":214,"props":5078,"children":5079},{},[5080],{"type":175,"value":5081},"error: error event, action is required but is not urgent",{"type":169,"tag":214,"props":5083,"children":5084},{},[5085],{"type":175,"value":5086},"warn: events that can be harmful if no action is taken",{"type":169,"tag":214,"props":5088,"children":5089},{},[5090],{"type":175,"value":5091},"notice: unusual events, but no immediate action required",{"type":169,"tag":214,"props":5093,"children":5094},{},[5095],{"type":175,"value":5096},"info: normal operation events, no action required",{"type":169,"tag":214,"props":5098,"children":5099},{},[5100],{"type":175,"value":5101},"debug: events used for debugging, no action required",{"type":169,"tag":214,"props":5103,"children":5104},{},[5105],{"type":175,"value":5106},"trace: fine-grained events used for debugging, no action required",{"type":169,"tag":1136,"props":5108,"children":5110},{"id":5109},"日志调用用宏还是函数",[5111],{"type":175,"value":5109},{"type":169,"tag":183,"props":5113,"children":5114},{},[5115,5117,5123,5125,5129],{"type":175,"value":5116},"原先的提交中，日志调用被定义在了宏里，直接调用 Logger::Logv 去记录。日志宏中使用子宏 ",{"type":169,"tag":5118,"props":5119,"children":5120},"strong",{},[5121],{"type":175,"value":5122},"VA_ARGS",{"type":175,"value":5124}," 来记录可变参数。",{"type":169,"tag":5118,"props":5126,"children":5127},{},[5128],{"type":175,"value":5122},{"type":175,"value":5130}," 前面有标记黏贴运算符的原因是当日志宏的可变参数为空时，可以把末尾的逗号去掉。",{"type":169,"tag":249,"props":5132,"children":5134},{"code":5133,"language":252,"meta":163,"className":253,"style":163},"class log {\n  static void emerg(const char* logname, const char* format, ...) {\n    va_list args;\n    va_start(args, format);\n    Logger::Logv(false, Logger::kLogLevelEMERG, LOG_EMERG, logname, format, args);\n    va_end(args);\n  }\n}\n// ...\n#define LOG_EMERG(logname, fmt, ...) \\\n        Logger::Logv(false, Logger::kLogLevelEMERG, logname, fmt, ##__VA_ARGS__)\n",[5135],{"type":169,"tag":256,"props":5136,"children":5137},{"__ignoreMap":163},[5138,5154,5229,5241,5270,5352,5372,5379,5386,5393,5435],{"type":169,"tag":260,"props":5139,"children":5140},{"class":262,"line":263},[5141,5145,5150],{"type":169,"tag":260,"props":5142,"children":5143},{"style":303},[5144],{"type":175,"value":1680},{"type":169,"tag":260,"props":5146,"children":5147},{"style":330},[5148],{"type":175,"value":5149}," log",{"type":169,"tag":260,"props":5151,"children":5152},{"style":315},[5153],{"type":175,"value":323},{"type":169,"tag":260,"props":5155,"children":5156},{"class":262,"line":290},[5157,5161,5165,5170,5174,5178,5182,5186,5191,5195,5199,5203,5207,5212,5216,5221,5225],{"type":169,"tag":260,"props":5158,"children":5159},{"style":1767},[5160],{"type":175,"value":1770},{"type":169,"tag":260,"props":5162,"children":5163},{"style":303},[5164],{"type":175,"value":1775},{"type":169,"tag":260,"props":5166,"children":5167},{"style":309},[5168],{"type":175,"value":5169}," emerg",{"type":169,"tag":260,"props":5171,"children":5172},{"style":315},[5173],{"type":175,"value":397},{"type":169,"tag":260,"props":5175,"children":5176},{"style":1767},[5177],{"type":175,"value":2279},{"type":169,"tag":260,"props":5179,"children":5180},{"style":303},[5181],{"type":175,"value":4892},{"type":169,"tag":260,"props":5183,"children":5184},{"style":1767},[5185],{"type":175,"value":4897},{"type":169,"tag":260,"props":5187,"children":5188},{"style":1176},[5189],{"type":175,"value":5190}," logname",{"type":169,"tag":260,"props":5192,"children":5193},{"style":315},[5194],{"type":175,"value":407},{"type":169,"tag":260,"props":5196,"children":5197},{"style":1767},[5198],{"type":175,"value":2301},{"type":169,"tag":260,"props":5200,"children":5201},{"style":303},[5202],{"type":175,"value":4892},{"type":169,"tag":260,"props":5204,"children":5205},{"style":1767},[5206],{"type":175,"value":4897},{"type":169,"tag":260,"props":5208,"children":5209},{"style":1176},[5210],{"type":175,"value":5211}," format",{"type":169,"tag":260,"props":5213,"children":5214},{"style":315},[5215],{"type":175,"value":407},{"type":169,"tag":260,"props":5217,"children":5218},{"style":520},[5219],{"type":175,"value":5220}," ...",{"type":169,"tag":260,"props":5222,"children":5223},{"style":315},[5224],{"type":175,"value":964},{"type":169,"tag":260,"props":5226,"children":5227},{"style":315},[5228],{"type":175,"value":323},{"type":169,"tag":260,"props":5230,"children":5231},{"class":262,"line":299},[5232,5237],{"type":169,"tag":260,"props":5233,"children":5234},{"style":520},[5235],{"type":175,"value":5236},"    va_list args",{"type":169,"tag":260,"props":5238,"children":5239},{"style":315},[5240],{"type":175,"value":349},{"type":169,"tag":260,"props":5242,"children":5243},{"class":262,"line":326},[5244,5249,5253,5258,5262,5266],{"type":169,"tag":260,"props":5245,"children":5246},{"style":309},[5247],{"type":175,"value":5248},"    va_start",{"type":169,"tag":260,"props":5250,"children":5251},{"style":315},[5252],{"type":175,"value":397},{"type":169,"tag":260,"props":5254,"children":5255},{"style":520},[5256],{"type":175,"value":5257},"args",{"type":169,"tag":260,"props":5259,"children":5260},{"style":315},[5261],{"type":175,"value":407},{"type":169,"tag":260,"props":5263,"children":5264},{"style":520},[5265],{"type":175,"value":5211},{"type":169,"tag":260,"props":5267,"children":5268},{"style":315},[5269],{"type":175,"value":427},{"type":169,"tag":260,"props":5271,"children":5272},{"class":262,"line":352},[5273,5278,5282,5287,5291,5296,5300,5305,5309,5314,5318,5323,5327,5331,5335,5339,5343,5348],{"type":169,"tag":260,"props":5274,"children":5275},{"style":330},[5276],{"type":175,"value":5277},"    Logger",{"type":169,"tag":260,"props":5279,"children":5280},{"style":315},[5281],{"type":175,"value":338},{"type":169,"tag":260,"props":5283,"children":5284},{"style":309},[5285],{"type":175,"value":5286},"Logv",{"type":169,"tag":260,"props":5288,"children":5289},{"style":315},[5290],{"type":175,"value":397},{"type":169,"tag":260,"props":5292,"children":5293},{"style":2467},[5294],{"type":175,"value":5295},"false",{"type":169,"tag":260,"props":5297,"children":5298},{"style":315},[5299],{"type":175,"value":407},{"type":169,"tag":260,"props":5301,"children":5302},{"style":330},[5303],{"type":175,"value":5304}," Logger",{"type":169,"tag":260,"props":5306,"children":5307},{"style":315},[5308],{"type":175,"value":338},{"type":169,"tag":260,"props":5310,"children":5311},{"style":520},[5312],{"type":175,"value":5313},"kLogLevelEMERG",{"type":169,"tag":260,"props":5315,"children":5316},{"style":315},[5317],{"type":175,"value":407},{"type":169,"tag":260,"props":5319,"children":5320},{"style":520},[5321],{"type":175,"value":5322}," LOG_EMERG",{"type":169,"tag":260,"props":5324,"children":5325},{"style":315},[5326],{"type":175,"value":407},{"type":169,"tag":260,"props":5328,"children":5329},{"style":520},[5330],{"type":175,"value":5190},{"type":169,"tag":260,"props":5332,"children":5333},{"style":315},[5334],{"type":175,"value":407},{"type":169,"tag":260,"props":5336,"children":5337},{"style":520},[5338],{"type":175,"value":5211},{"type":169,"tag":260,"props":5340,"children":5341},{"style":315},[5342],{"type":175,"value":407},{"type":169,"tag":260,"props":5344,"children":5345},{"style":520},[5346],{"type":175,"value":5347}," args",{"type":169,"tag":260,"props":5349,"children":5350},{"style":315},[5351],{"type":175,"value":427},{"type":169,"tag":260,"props":5353,"children":5354},{"class":262,"line":373},[5355,5360,5364,5368],{"type":169,"tag":260,"props":5356,"children":5357},{"style":309},[5358],{"type":175,"value":5359},"    va_end",{"type":169,"tag":260,"props":5361,"children":5362},{"style":315},[5363],{"type":175,"value":397},{"type":169,"tag":260,"props":5365,"children":5366},{"style":520},[5367],{"type":175,"value":5257},{"type":169,"tag":260,"props":5369,"children":5370},{"style":315},[5371],{"type":175,"value":427},{"type":169,"tag":260,"props":5373,"children":5374},{"class":262,"line":430},[5375],{"type":169,"tag":260,"props":5376,"children":5377},{"style":315},[5378],{"type":175,"value":617},{"type":169,"tag":260,"props":5380,"children":5381},{"class":262,"line":465},[5382],{"type":169,"tag":260,"props":5383,"children":5384},{"style":315},[5385],{"type":175,"value":1106},{"type":169,"tag":260,"props":5387,"children":5388},{"class":262,"line":507},[5389],{"type":169,"tag":260,"props":5390,"children":5391},{"style":1269},[5392],{"type":175,"value":3081},{"type":169,"tag":260,"props":5394,"children":5395},{"class":262,"line":588},[5396,5400,5404,5408,5413,5417,5422,5426,5431],{"type":169,"tag":260,"props":5397,"children":5398},{"style":267},[5399],{"type":175,"value":1640},{"type":169,"tag":260,"props":5401,"children":5402},{"style":309},[5403],{"type":175,"value":5322},{"type":169,"tag":260,"props":5405,"children":5406},{"style":315},[5407],{"type":175,"value":397},{"type":169,"tag":260,"props":5409,"children":5410},{"style":1176},[5411],{"type":175,"value":5412},"logname",{"type":169,"tag":260,"props":5414,"children":5415},{"style":315},[5416],{"type":175,"value":407},{"type":169,"tag":260,"props":5418,"children":5419},{"style":1176},[5420],{"type":175,"value":5421}," fmt",{"type":169,"tag":260,"props":5423,"children":5424},{"style":315},[5425],{"type":175,"value":407},{"type":169,"tag":260,"props":5427,"children":5428},{"style":315},[5429],{"type":175,"value":5430}," ...)",{"type":169,"tag":260,"props":5432,"children":5433},{"style":545},[5434],{"type":175,"value":2026},{"type":169,"tag":260,"props":5436,"children":5437},{"class":262,"line":611},[5438,5443,5447,5451,5455,5459,5463,5467,5471,5475,5479,5483,5487,5491,5495,5500],{"type":169,"tag":260,"props":5439,"children":5440},{"style":330},[5441],{"type":175,"value":5442},"        Logger",{"type":169,"tag":260,"props":5444,"children":5445},{"style":315},[5446],{"type":175,"value":338},{"type":169,"tag":260,"props":5448,"children":5449},{"style":309},[5450],{"type":175,"value":5286},{"type":169,"tag":260,"props":5452,"children":5453},{"style":315},[5454],{"type":175,"value":397},{"type":169,"tag":260,"props":5456,"children":5457},{"style":2467},[5458],{"type":175,"value":5295},{"type":169,"tag":260,"props":5460,"children":5461},{"style":315},[5462],{"type":175,"value":407},{"type":169,"tag":260,"props":5464,"children":5465},{"style":330},[5466],{"type":175,"value":5304},{"type":169,"tag":260,"props":5468,"children":5469},{"style":315},[5470],{"type":175,"value":338},{"type":169,"tag":260,"props":5472,"children":5473},{"style":520},[5474],{"type":175,"value":5313},{"type":169,"tag":260,"props":5476,"children":5477},{"style":315},[5478],{"type":175,"value":407},{"type":169,"tag":260,"props":5480,"children":5481},{"style":520},[5482],{"type":175,"value":5190},{"type":169,"tag":260,"props":5484,"children":5485},{"style":315},[5486],{"type":175,"value":407},{"type":169,"tag":260,"props":5488,"children":5489},{"style":520},[5490],{"type":175,"value":5421},{"type":169,"tag":260,"props":5492,"children":5493},{"style":315},[5494],{"type":175,"value":407},{"type":169,"tag":260,"props":5496,"children":5497},{"style":341},[5498],{"type":175,"value":5499}," ##__VA_ARGS__",{"type":169,"tag":260,"props":5501,"children":5502},{"style":315},[5503],{"type":175,"value":2096},{"type":169,"tag":183,"props":5505,"children":5506},{},[5507],{"type":175,"value":5508},"尚不清楚为什么不用宏，而是使用运行时的方法调用（即 log 的 public 方法）。猜测可能是因为宏不能跨行？因为我看到了这种很长的调用。",{"type":169,"tag":249,"props":5510,"children":5512},{"code":5511,"language":252,"meta":163,"className":253,"style":163},"log::trace(\n  \"Database::PutPartValidSize()\",\n  \"[%s] size_chunk:%\" PRIu64 \" offset_chunk:%\" PRIu64,\n  key.ToString().c_str(),\n  chunk.size(),\n  offset_chunk\n);\n",[5513],{"type":169,"tag":256,"props":5514,"children":5515},{"__ignoreMap":163},[5516,5538,5559,5610,5639,5659,5667],{"type":169,"tag":260,"props":5517,"children":5518},{"class":262,"line":263},[5519,5524,5528,5533],{"type":169,"tag":260,"props":5520,"children":5521},{"style":330},[5522],{"type":175,"value":5523},"log",{"type":169,"tag":260,"props":5525,"children":5526},{"style":315},[5527],{"type":175,"value":338},{"type":169,"tag":260,"props":5529,"children":5530},{"style":309},[5531],{"type":175,"value":5532},"trace",{"type":169,"tag":260,"props":5534,"children":5535},{"style":315},[5536],{"type":175,"value":5537},"(\n",{"type":169,"tag":260,"props":5539,"children":5540},{"class":262,"line":290},[5541,5546,5551,5555],{"type":169,"tag":260,"props":5542,"children":5543},{"style":273},[5544],{"type":175,"value":5545},"  \"",{"type":169,"tag":260,"props":5547,"children":5548},{"style":279},[5549],{"type":175,"value":5550},"Database::PutPartValidSize()",{"type":169,"tag":260,"props":5552,"children":5553},{"style":273},[5554],{"type":175,"value":422},{"type":169,"tag":260,"props":5556,"children":5557},{"style":315},[5558],{"type":175,"value":4620},{"type":169,"tag":260,"props":5560,"children":5561},{"class":262,"line":299},[5562,5566,5570,5574,5579,5583,5588,5592,5597,5601,5606],{"type":169,"tag":260,"props":5563,"children":5564},{"style":273},[5565],{"type":175,"value":5545},{"type":169,"tag":260,"props":5567,"children":5568},{"style":279},[5569],{"type":175,"value":1236},{"type":169,"tag":260,"props":5571,"children":5572},{"style":539},[5573],{"type":175,"value":542},{"type":169,"tag":260,"props":5575,"children":5576},{"style":279},[5577],{"type":175,"value":5578},"] size_chunk:%",{"type":169,"tag":260,"props":5580,"children":5581},{"style":273},[5582],{"type":175,"value":422},{"type":169,"tag":260,"props":5584,"children":5585},{"style":341},[5586],{"type":175,"value":5587}," PRIu64 ",{"type":169,"tag":260,"props":5589,"children":5590},{"style":273},[5591],{"type":175,"value":422},{"type":169,"tag":260,"props":5593,"children":5594},{"style":279},[5595],{"type":175,"value":5596}," offset_chunk:%",{"type":169,"tag":260,"props":5598,"children":5599},{"style":273},[5600],{"type":175,"value":422},{"type":169,"tag":260,"props":5602,"children":5603},{"style":341},[5604],{"type":175,"value":5605}," PRIu64",{"type":169,"tag":260,"props":5607,"children":5608},{"style":315},[5609],{"type":175,"value":4620},{"type":169,"tag":260,"props":5611,"children":5612},{"class":262,"line":326},[5613,5618,5622,5626,5630,5634],{"type":169,"tag":260,"props":5614,"children":5615},{"style":341},[5616],{"type":175,"value":5617},"  key",{"type":169,"tag":260,"props":5619,"children":5620},{"style":315},[5621],{"type":175,"value":452},{"type":169,"tag":260,"props":5623,"children":5624},{"style":309},[5625],{"type":175,"value":570},{"type":169,"tag":260,"props":5627,"children":5628},{"style":315},[5629],{"type":175,"value":575},{"type":169,"tag":260,"props":5631,"children":5632},{"style":309},[5633],{"type":175,"value":580},{"type":169,"tag":260,"props":5635,"children":5636},{"style":315},[5637],{"type":175,"value":5638},"(),\n",{"type":169,"tag":260,"props":5640,"children":5641},{"class":262,"line":352},[5642,5647,5651,5655],{"type":169,"tag":260,"props":5643,"children":5644},{"style":341},[5645],{"type":175,"value":5646},"  chunk",{"type":169,"tag":260,"props":5648,"children":5649},{"style":315},[5650],{"type":175,"value":452},{"type":169,"tag":260,"props":5652,"children":5653},{"style":309},[5654],{"type":175,"value":3404},{"type":169,"tag":260,"props":5656,"children":5657},{"style":315},[5658],{"type":175,"value":5638},{"type":169,"tag":260,"props":5660,"children":5661},{"class":262,"line":373},[5662],{"type":169,"tag":260,"props":5663,"children":5664},{"style":341},[5665],{"type":175,"value":5666},"  offset_chunk\n",{"type":169,"tag":260,"props":5668,"children":5669},{"class":262,"line":430},[5670],{"type":169,"tag":260,"props":5671,"children":5672},{"style":315},[5673],{"type":175,"value":427},{"type":169,"tag":1136,"props":5675,"children":5677},{"id":5676},"日志时间",[5678],{"type":175,"value":5676},{"type":169,"tag":183,"props":5680,"children":5681},{},[5682],{"type":175,"value":5683},"使用系统输出（syslog）时不需要手动记录时间，但是把日志打印出来时却是要的。尤其是在调试时，精确时间非常有用。KDB 使用 Linux 的 timeval、tm 两个结构体，分别拿到精确时间及可读时间，再格式化输出。",{"type":169,"tag":249,"props":5685,"children":5687},{"code":5686,"language":252,"meta":163,"className":253,"style":163},"struct timeval now_tv;\ngettimeofday(&now_tv, NULL);\nconst time_t seconds = now_tv.tv_sec;\nstruct tm t;\n// 初始化 tm 时需要用到当前秒数，\n// 所以需要提前初始化 now_tv\nlocaltime_r(&seconds, &t);\np += snprintf(p, limit - p,\n              \"%04d/%02d/%02d-%02d:%02d:%02d.%06d %s %s \",\n              t.tm_year + 1900,\n              t.tm_mon + 1,\n              t.tm_mday,\n              t.tm_hour,\n              t.tm_min,\n              t.tm_sec,\n              static_cast\u003Cint>(now_tv.tv_usec), // 毫秒\n              ss.str().c_str(),\n              logname);\n",[5688],{"type":169,"tag":256,"props":5689,"children":5690},{"__ignoreMap":163},[5691,5713,5747,5785,5805,5813,5821,5859,5908,5989,6020,6048,6068,6088,6108,6128,6171,6199],{"type":169,"tag":260,"props":5692,"children":5693},{"class":262,"line":263},[5694,5699,5704,5709],{"type":169,"tag":260,"props":5695,"children":5696},{"style":303},[5697],{"type":175,"value":5698},"struct",{"type":169,"tag":260,"props":5700,"children":5701},{"style":330},[5702],{"type":175,"value":5703}," timeval",{"type":169,"tag":260,"props":5705,"children":5706},{"style":341},[5707],{"type":175,"value":5708}," now_tv",{"type":169,"tag":260,"props":5710,"children":5711},{"style":315},[5712],{"type":175,"value":349},{"type":169,"tag":260,"props":5714,"children":5715},{"class":262,"line":290},[5716,5721,5725,5729,5734,5738,5743],{"type":169,"tag":260,"props":5717,"children":5718},{"style":309},[5719],{"type":175,"value":5720},"gettimeofday",{"type":169,"tag":260,"props":5722,"children":5723},{"style":315},[5724],{"type":175,"value":397},{"type":169,"tag":260,"props":5726,"children":5727},{"style":439},[5728],{"type":175,"value":2265},{"type":169,"tag":260,"props":5730,"children":5731},{"style":341},[5732],{"type":175,"value":5733},"now_tv",{"type":169,"tag":260,"props":5735,"children":5736},{"style":315},[5737],{"type":175,"value":407},{"type":169,"tag":260,"props":5739,"children":5740},{"style":2467},[5741],{"type":175,"value":5742}," NULL",{"type":169,"tag":260,"props":5744,"children":5745},{"style":315},[5746],{"type":175,"value":427},{"type":169,"tag":260,"props":5748,"children":5749},{"class":262,"line":299},[5750,5754,5759,5764,5768,5772,5776,5781],{"type":169,"tag":260,"props":5751,"children":5752},{"style":1767},[5753],{"type":175,"value":2279},{"type":169,"tag":260,"props":5755,"children":5756},{"style":303},[5757],{"type":175,"value":5758}," time_t",{"type":169,"tag":260,"props":5760,"children":5761},{"style":341},[5762],{"type":175,"value":5763}," seconds ",{"type":169,"tag":260,"props":5765,"children":5766},{"style":439},[5767],{"type":175,"value":442},{"type":169,"tag":260,"props":5769,"children":5770},{"style":341},[5771],{"type":175,"value":5708},{"type":169,"tag":260,"props":5773,"children":5774},{"style":315},[5775],{"type":175,"value":452},{"type":169,"tag":260,"props":5777,"children":5778},{"style":341},[5779],{"type":175,"value":5780},"tv_sec",{"type":169,"tag":260,"props":5782,"children":5783},{"style":315},[5784],{"type":175,"value":349},{"type":169,"tag":260,"props":5786,"children":5787},{"class":262,"line":326},[5788,5792,5797,5801],{"type":169,"tag":260,"props":5789,"children":5790},{"style":303},[5791],{"type":175,"value":5698},{"type":169,"tag":260,"props":5793,"children":5794},{"style":330},[5795],{"type":175,"value":5796}," tm",{"type":169,"tag":260,"props":5798,"children":5799},{"style":341},[5800],{"type":175,"value":1827},{"type":169,"tag":260,"props":5802,"children":5803},{"style":315},[5804],{"type":175,"value":349},{"type":169,"tag":260,"props":5806,"children":5807},{"class":262,"line":352},[5808],{"type":169,"tag":260,"props":5809,"children":5810},{"style":1269},[5811],{"type":175,"value":5812},"// 初始化 tm 时需要用到当前秒数，\n",{"type":169,"tag":260,"props":5814,"children":5815},{"class":262,"line":373},[5816],{"type":169,"tag":260,"props":5817,"children":5818},{"style":1269},[5819],{"type":175,"value":5820},"// 所以需要提前初始化 now_tv\n",{"type":169,"tag":260,"props":5822,"children":5823},{"class":262,"line":430},[5824,5829,5833,5837,5842,5846,5850,5855],{"type":169,"tag":260,"props":5825,"children":5826},{"style":309},[5827],{"type":175,"value":5828},"localtime_r",{"type":169,"tag":260,"props":5830,"children":5831},{"style":315},[5832],{"type":175,"value":397},{"type":169,"tag":260,"props":5834,"children":5835},{"style":439},[5836],{"type":175,"value":2265},{"type":169,"tag":260,"props":5838,"children":5839},{"style":341},[5840],{"type":175,"value":5841},"seconds",{"type":169,"tag":260,"props":5843,"children":5844},{"style":315},[5845],{"type":175,"value":407},{"type":169,"tag":260,"props":5847,"children":5848},{"style":439},[5849],{"type":175,"value":895},{"type":169,"tag":260,"props":5851,"children":5852},{"style":341},[5853],{"type":175,"value":5854},"t",{"type":169,"tag":260,"props":5856,"children":5857},{"style":315},[5858],{"type":175,"value":427},{"type":169,"tag":260,"props":5860,"children":5861},{"class":262,"line":465},[5862,5867,5872,5877,5881,5885,5889,5894,5899,5904],{"type":169,"tag":260,"props":5863,"children":5864},{"style":341},[5865],{"type":175,"value":5866},"p ",{"type":169,"tag":260,"props":5868,"children":5869},{"style":439},[5870],{"type":175,"value":5871},"+=",{"type":169,"tag":260,"props":5873,"children":5874},{"style":309},[5875],{"type":175,"value":5876}," snprintf",{"type":169,"tag":260,"props":5878,"children":5879},{"style":315},[5880],{"type":175,"value":397},{"type":169,"tag":260,"props":5882,"children":5883},{"style":341},[5884],{"type":175,"value":183},{"type":169,"tag":260,"props":5886,"children":5887},{"style":315},[5888],{"type":175,"value":407},{"type":169,"tag":260,"props":5890,"children":5891},{"style":341},[5892],{"type":175,"value":5893}," limit ",{"type":169,"tag":260,"props":5895,"children":5896},{"style":439},[5897],{"type":175,"value":5898},"-",{"type":169,"tag":260,"props":5900,"children":5901},{"style":341},[5902],{"type":175,"value":5903}," p",{"type":169,"tag":260,"props":5905,"children":5906},{"style":315},[5907],{"type":175,"value":4620},{"type":169,"tag":260,"props":5909,"children":5910},{"class":262,"line":507},[5911,5916,5921,5926,5931,5935,5939,5943,5947,5951,5955,5959,5963,5967,5972,5977,5981,5985],{"type":169,"tag":260,"props":5912,"children":5913},{"style":273},[5914],{"type":175,"value":5915},"              \"",{"type":169,"tag":260,"props":5917,"children":5918},{"style":539},[5919],{"type":175,"value":5920},"%04d",{"type":169,"tag":260,"props":5922,"children":5923},{"style":279},[5924],{"type":175,"value":5925},"/",{"type":169,"tag":260,"props":5927,"children":5928},{"style":539},[5929],{"type":175,"value":5930},"%02d",{"type":169,"tag":260,"props":5932,"children":5933},{"style":279},[5934],{"type":175,"value":5925},{"type":169,"tag":260,"props":5936,"children":5937},{"style":539},[5938],{"type":175,"value":5930},{"type":169,"tag":260,"props":5940,"children":5941},{"style":279},[5942],{"type":175,"value":5898},{"type":169,"tag":260,"props":5944,"children":5945},{"style":539},[5946],{"type":175,"value":5930},{"type":169,"tag":260,"props":5948,"children":5949},{"style":279},[5950],{"type":175,"value":1365},{"type":169,"tag":260,"props":5952,"children":5953},{"style":539},[5954],{"type":175,"value":5930},{"type":169,"tag":260,"props":5956,"children":5957},{"style":279},[5958],{"type":175,"value":1365},{"type":169,"tag":260,"props":5960,"children":5961},{"style":539},[5962],{"type":175,"value":5930},{"type":169,"tag":260,"props":5964,"children":5965},{"style":279},[5966],{"type":175,"value":452},{"type":169,"tag":260,"props":5968,"children":5969},{"style":539},[5970],{"type":175,"value":5971},"%06d",{"type":169,"tag":260,"props":5973,"children":5974},{"style":539},[5975],{"type":175,"value":5976}," %s",{"type":169,"tag":260,"props":5978,"children":5979},{"style":539},[5980],{"type":175,"value":5976},{"type":169,"tag":260,"props":5982,"children":5983},{"style":273},[5984],{"type":175,"value":412},{"type":169,"tag":260,"props":5986,"children":5987},{"style":315},[5988],{"type":175,"value":4620},{"type":169,"tag":260,"props":5990,"children":5991},{"class":262,"line":588},[5992,5997,6001,6006,6011,6016],{"type":169,"tag":260,"props":5993,"children":5994},{"style":341},[5995],{"type":175,"value":5996},"              t",{"type":169,"tag":260,"props":5998,"children":5999},{"style":315},[6000],{"type":175,"value":452},{"type":169,"tag":260,"props":6002,"children":6003},{"style":341},[6004],{"type":175,"value":6005},"tm_year ",{"type":169,"tag":260,"props":6007,"children":6008},{"style":439},[6009],{"type":175,"value":6010},"+",{"type":169,"tag":260,"props":6012,"children":6013},{"style":601},[6014],{"type":175,"value":6015}," 1900",{"type":169,"tag":260,"props":6017,"children":6018},{"style":315},[6019],{"type":175,"value":4620},{"type":169,"tag":260,"props":6021,"children":6022},{"class":262,"line":611},[6023,6027,6031,6036,6040,6044],{"type":169,"tag":260,"props":6024,"children":6025},{"style":341},[6026],{"type":175,"value":5996},{"type":169,"tag":260,"props":6028,"children":6029},{"style":315},[6030],{"type":175,"value":452},{"type":169,"tag":260,"props":6032,"children":6033},{"style":341},[6034],{"type":175,"value":6035},"tm_mon ",{"type":169,"tag":260,"props":6037,"children":6038},{"style":439},[6039],{"type":175,"value":6010},{"type":169,"tag":260,"props":6041,"children":6042},{"style":601},[6043],{"type":175,"value":2818},{"type":169,"tag":260,"props":6045,"children":6046},{"style":315},[6047],{"type":175,"value":4620},{"type":169,"tag":260,"props":6049,"children":6050},{"class":262,"line":620},[6051,6055,6059,6064],{"type":169,"tag":260,"props":6052,"children":6053},{"style":341},[6054],{"type":175,"value":5996},{"type":169,"tag":260,"props":6056,"children":6057},{"style":315},[6058],{"type":175,"value":452},{"type":169,"tag":260,"props":6060,"children":6061},{"style":341},[6062],{"type":175,"value":6063},"tm_mday",{"type":169,"tag":260,"props":6065,"children":6066},{"style":315},[6067],{"type":175,"value":4620},{"type":169,"tag":260,"props":6069,"children":6070},{"class":262,"line":628},[6071,6075,6079,6084],{"type":169,"tag":260,"props":6072,"children":6073},{"style":341},[6074],{"type":175,"value":5996},{"type":169,"tag":260,"props":6076,"children":6077},{"style":315},[6078],{"type":175,"value":452},{"type":169,"tag":260,"props":6080,"children":6081},{"style":341},[6082],{"type":175,"value":6083},"tm_hour",{"type":169,"tag":260,"props":6085,"children":6086},{"style":315},[6087],{"type":175,"value":4620},{"type":169,"tag":260,"props":6089,"children":6090},{"class":262,"line":671},[6091,6095,6099,6104],{"type":169,"tag":260,"props":6092,"children":6093},{"style":341},[6094],{"type":175,"value":5996},{"type":169,"tag":260,"props":6096,"children":6097},{"style":315},[6098],{"type":175,"value":452},{"type":169,"tag":260,"props":6100,"children":6101},{"style":341},[6102],{"type":175,"value":6103},"tm_min",{"type":169,"tag":260,"props":6105,"children":6106},{"style":315},[6107],{"type":175,"value":4620},{"type":169,"tag":260,"props":6109,"children":6110},{"class":262,"line":712},[6111,6115,6119,6124],{"type":169,"tag":260,"props":6112,"children":6113},{"style":341},[6114],{"type":175,"value":5996},{"type":169,"tag":260,"props":6116,"children":6117},{"style":315},[6118],{"type":175,"value":452},{"type":169,"tag":260,"props":6120,"children":6121},{"style":341},[6122],{"type":175,"value":6123},"tm_sec",{"type":169,"tag":260,"props":6125,"children":6126},{"style":315},[6127],{"type":175,"value":4620},{"type":169,"tag":260,"props":6129,"children":6130},{"class":262,"line":720},[6131,6136,6140,6144,6148,6152,6156,6161,6166],{"type":169,"tag":260,"props":6132,"children":6133},{"style":439},[6134],{"type":175,"value":6135},"              static_cast\u003C",{"type":169,"tag":260,"props":6137,"children":6138},{"style":303},[6139],{"type":175,"value":306},{"type":169,"tag":260,"props":6141,"children":6142},{"style":439},[6143],{"type":175,"value":2247},{"type":169,"tag":260,"props":6145,"children":6146},{"style":315},[6147],{"type":175,"value":397},{"type":169,"tag":260,"props":6149,"children":6150},{"style":341},[6151],{"type":175,"value":5733},{"type":169,"tag":260,"props":6153,"children":6154},{"style":315},[6155],{"type":175,"value":452},{"type":169,"tag":260,"props":6157,"children":6158},{"style":341},[6159],{"type":175,"value":6160},"tv_usec",{"type":169,"tag":260,"props":6162,"children":6163},{"style":315},[6164],{"type":175,"value":6165},"),",{"type":169,"tag":260,"props":6167,"children":6168},{"style":1269},[6169],{"type":175,"value":6170}," // 毫秒\n",{"type":169,"tag":260,"props":6172,"children":6173},{"class":262,"line":741},[6174,6179,6183,6187,6191,6195],{"type":169,"tag":260,"props":6175,"children":6176},{"style":341},[6177],{"type":175,"value":6178},"              ss",{"type":169,"tag":260,"props":6180,"children":6181},{"style":315},[6182],{"type":175,"value":452},{"type":169,"tag":260,"props":6184,"children":6185},{"style":309},[6186],{"type":175,"value":2839},{"type":169,"tag":260,"props":6188,"children":6189},{"style":315},[6190],{"type":175,"value":575},{"type":169,"tag":260,"props":6192,"children":6193},{"style":309},[6194],{"type":175,"value":580},{"type":169,"tag":260,"props":6196,"children":6197},{"style":315},[6198],{"type":175,"value":5638},{"type":169,"tag":260,"props":6200,"children":6201},{"class":262,"line":797},[6202,6207],{"type":169,"tag":260,"props":6203,"children":6204},{"style":341},[6205],{"type":175,"value":6206},"              logname",{"type":169,"tag":260,"props":6208,"children":6209},{"style":315},[6210],{"type":175,"value":427},{"type":169,"tag":6212,"props":6213,"children":6214},"style",{},[6215],{"type":175,"value":6216},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":163,"searchDepth":290,"depth":290,"links":6218},[6219,6220,6221,6222],{"id":179,"depth":290,"text":179},{"id":240,"depth":290,"text":240},{"id":3222,"depth":290,"text":3222},{"id":3235,"depth":290,"text":3235},"markdown","content:8.source-code:_cpp:kingdb.md","content","8.source-code/_cpp/kingdb.md","8.source-code/_cpp/kingdb","md",[6230,6234],{"_path":6231,"title":6232,"description":6233},"/source-code/_architecture/awade","Awade","中兴的一套低码系统。Jigsaw 是其前端组件库。",{"_path":6235,"title":6236,"description":163},"/source-code/_es/array-slice","Array.prototype.slice",1748756325795]