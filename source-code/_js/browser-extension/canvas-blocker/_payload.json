[{"data":1,"prerenderedAt":2096},["ShallowReactive",2],{"navigation":3,"/source-code/_js/browser-extension/canvas-blocker":161,"/source-code/_js/browser-extension/canvas-blocker-surround":2089},[4,35,92,98,125,131,155],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29,32],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🚝 四十二篇系列","/flows/fourty-two",{"title":15,"_path":16},"🌃 长夜梦","/flows/long-night-dream",{"title":18,"_path":19},"🌌 万物联结与幸福感","/flows/everything",{"title":21,"_path":22},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":24,"_path":25},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":27,"_path":28},"🌧️ 我的腼腆","/flows/shy",{"title":30,"_path":31},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":33,"_path":34},"📝 心流归档","/flows/archive",{"title":36,"_path":37,"children":38},"技术博客 / Coder","/articles",[39,41,44,47,50,53,56,59,62,65,68,71,74,77,80,83,86,89],{"title":40,"_path":37},"🦁 欢迎",{"title":42,"_path":43},"🖌️ Blockies Animation","/maps/_fe-framework/motion/blockies-animation",{"title":45,"_path":46},"🌪️ Tailwind v4 如何兼容预处理器","/articles/tailwind4-with-sass",{"title":48,"_path":49},"🥞 在 tailwind 中使用现代化 CSS Layers","/articles/tailwind-sass-and-css-layer",{"title":51,"_path":52},"💻 本地部署 Qwen 翻译网页","/articles/local-translator",{"title":54,"_path":55},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":57,"_path":58},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":60,"_path":61},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":63,"_path":64},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":66,"_path":67},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":69,"_path":70},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":72,"_path":73},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":75,"_path":76},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":78,"_path":79},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":81,"_path":82},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":84,"_path":85},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":87,"_path":88},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":90,"_path":91},"📝 技术博客归档","/articles/archive",{"title":93,"_path":94,"children":95},"读书笔记 / Notes","/books",[96],{"title":97,"_path":94},"📕 读书笔记",{"title":99,"_path":100,"children":101},"吉他剧场 / Music","/music",[102,104,107,110,113,116,119,122],{"title":103,"_path":100},"🎸 FingerStyle！",{"title":105,"_path":106},"🌬️ 等待的风","/music/wind",{"title":108,"_path":109},"💕 约定的海洋","/music/ocean",{"title":111,"_path":112},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":114,"_path":115},"🌏 残酷天使的行动纲领","/music/eva",{"title":117,"_path":118},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":120,"_path":121},"🍷 Wu Wei","/music/wu-wei",{"title":123,"_path":124},"🌅 无题","/music/untitled",{"title":126,"_path":127,"children":128},"知识地图 / Maps","/maps",[129],{"title":130,"_path":127},"🏁 知识地图",{"title":132,"_path":133,"children":134},"造物 / Make","/tools",[135,137,140,143,146,149,152],{"title":136,"_path":133},"🧰 工具收集",{"title":138,"_path":139},"📕 博客","/tools/blog",{"title":141,"_path":142},"🥥 Coconut","/tools/coconut",{"title":144,"_path":145},"🧶 网易云音乐歌单排序","/tools/netease-sorter",{"title":147,"_path":148},"🌐 AnySort","/tools/anysort",{"title":150,"_path":151},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":153,"_path":154},"👓 Crapto","/tools/crypto-inline",{"title":156,"_path":157,"children":158},"我 / About","/hire",[159],{"title":160,"_path":157},"📬 技术简历",{"_path":162,"_dir":163,"_draft":164,"_partial":165,"_locale":166,"title":167,"description":168,"body":169,"_type":2083,"_id":2084,"_source":2085,"_file":2086,"_stem":2087,"_extension":2088},"/source-code/_js/browser-extension/canvas-blocker","browser-extension",false,true,"","Canvas Blocker","Canvas Blocker 是一个浏览器扩展，能够拦截多种类型的指纹追踪。",{"type":170,"children":171,"toc":2073},"root",[172,180,186,236,241,247,252,257,634,639,644,651,656,681,686,844,849,1432,1438,1443,1456,1461,2038,2044,2049,2054,2067],{"type":173,"tag":174,"props":175,"children":177},"element","h2",{"id":176},"前言",[178],{"type":179,"value":176},"text",{"type":173,"tag":181,"props":182,"children":183},"p",{},[184],{"type":179,"value":185},"最近在看一些反反爬相关的东西，期间找到了 Canvas Blocker 这个神奇的库。他是一个浏览器扩展，声称能拦截以下几种类型的指纹追踪：",{"type":173,"tag":187,"props":188,"children":189},"ul",{},[190,196,201,206,211,216,221,226,231],{"type":173,"tag":191,"props":192,"children":193},"li",{},[194],{"type":179,"value":195},"Canvas 2D",{"type":173,"tag":191,"props":197,"children":198},{},[199],{"type":179,"value":200},"WebGL",{"type":173,"tag":191,"props":202,"children":203},{},[204],{"type":179,"value":205},"Web Audio",{"type":173,"tag":191,"props":207,"children":208},{},[209],{"type":179,"value":210},"History",{"type":173,"tag":191,"props":212,"children":213},{},[214],{"type":179,"value":215},"Window",{"type":173,"tag":191,"props":217,"children":218},{},[219],{"type":179,"value":220},"DOMRect",{"type":173,"tag":191,"props":222,"children":223},{},[224],{"type":179,"value":225},"TextMetrics",{"type":173,"tag":191,"props":227,"children":228},{},[229],{"type":179,"value":230},"Navigator",{"type":173,"tag":191,"props":232,"children":233},{},[234],{"type":179,"value":235},"Screen",{"type":173,"tag":181,"props":237,"children":238},{},[239],{"type":179,"value":240},"让我们大致拆解一下，看看其原理是什么。",{"type":173,"tag":174,"props":242,"children":244},{"id":243},"intercept",[245],{"type":179,"value":246},"Intercept",{"type":173,"tag":181,"props":248,"children":249},{},[250],{"type":179,"value":251},"Blocker 最主要的思路就是用伪造的函数篡改属性的 Getter 以及某些 API。",{"type":173,"tag":181,"props":253,"children":254},{},[255],{"type":179,"value":256},"篡改的入口在 intercept.js 中，先根据页面 URL 检查当前页面是否允许篡改，允许的话就通过 interceptFns、interceptGetters 实施具体步骤。",{"type":173,"tag":258,"props":259,"children":263},"pre",{"className":260,"code":261,"language":262,"meta":166,"style":166},"language-js shiki shiki-themes material-theme-lighter github-light github-dark monokai","scope.intercept = function intercept({subject: windowToProcess}, apis){\n  const siteStatus = apis.check({url: getURL(windowToProcess)})\n  logging.verbose(\"status for page\", windowToProcess, siteStatus)\n  if (siteStatus.mode !== \"allow\"){\n    interceptFunctions(windowToProcess, siteStatus, apis)\n    interceptGetters(windowToProcess, siteStatus, apis)\n  }\n}\n","js",[264],{"type":173,"tag":265,"props":266,"children":267},"code",{"__ignoreMap":166},[268,345,426,485,542,579,616,625],{"type":173,"tag":269,"props":270,"children":273},"span",{"class":271,"line":272},"line",1,[274,280,286,291,297,303,308,313,319,324,330,335,340],{"type":173,"tag":269,"props":275,"children":277},{"style":276},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[278],{"type":179,"value":279},"scope",{"type":173,"tag":269,"props":281,"children":283},{"style":282},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[284],{"type":179,"value":285},".",{"type":173,"tag":269,"props":287,"children":289},{"style":288},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[290],{"type":179,"value":243},{"type":173,"tag":269,"props":292,"children":294},{"style":293},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[295],{"type":179,"value":296}," =",{"type":173,"tag":269,"props":298,"children":300},{"style":299},"--shiki-light:#9C3EDA;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic",[301],{"type":179,"value":302}," function",{"type":173,"tag":269,"props":304,"children":305},{"style":288},[306],{"type":179,"value":307}," intercept",{"type":173,"tag":269,"props":309,"children":310},{"style":282},[311],{"type":179,"value":312},"({",{"type":173,"tag":269,"props":314,"children":316},{"style":315},"--shiki-light:#E53935;--shiki-default:#E36209;--shiki-dark:#FFAB70;--shiki-sepia:#F8F8F2",[317],{"type":179,"value":318},"subject",{"type":173,"tag":269,"props":320,"children":321},{"style":282},[322],{"type":179,"value":323},":",{"type":173,"tag":269,"props":325,"children":327},{"style":326},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#E36209;--shiki-default-font-style:inherit;--shiki-dark:#FFAB70;--shiki-dark-font-style:inherit;--shiki-sepia:#FD971F;--shiki-sepia-font-style:italic",[328],{"type":179,"value":329}," windowToProcess",{"type":173,"tag":269,"props":331,"children":332},{"style":282},[333],{"type":179,"value":334},"},",{"type":173,"tag":269,"props":336,"children":337},{"style":326},[338],{"type":179,"value":339}," apis",{"type":173,"tag":269,"props":341,"children":342},{"style":282},[343],{"type":179,"value":344},"){\n",{"type":173,"tag":269,"props":346,"children":348},{"class":271,"line":347},2,[349,354,360,364,368,372,377,383,388,393,397,402,406,411,416,421],{"type":173,"tag":269,"props":350,"children":351},{"style":299},[352],{"type":179,"value":353},"  const",{"type":173,"tag":269,"props":355,"children":357},{"style":356},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#F8F8F2",[358],{"type":179,"value":359}," siteStatus",{"type":173,"tag":269,"props":361,"children":362},{"style":293},[363],{"type":179,"value":296},{"type":173,"tag":269,"props":365,"children":366},{"style":276},[367],{"type":179,"value":339},{"type":173,"tag":269,"props":369,"children":370},{"style":282},[371],{"type":179,"value":285},{"type":173,"tag":269,"props":373,"children":374},{"style":288},[375],{"type":179,"value":376},"check",{"type":173,"tag":269,"props":378,"children":380},{"style":379},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[381],{"type":179,"value":382},"(",{"type":173,"tag":269,"props":384,"children":385},{"style":282},[386],{"type":179,"value":387},"{",{"type":173,"tag":269,"props":389,"children":390},{"style":379},[391],{"type":179,"value":392},"url",{"type":173,"tag":269,"props":394,"children":395},{"style":282},[396],{"type":179,"value":323},{"type":173,"tag":269,"props":398,"children":399},{"style":288},[400],{"type":179,"value":401}," getURL",{"type":173,"tag":269,"props":403,"children":404},{"style":379},[405],{"type":179,"value":382},{"type":173,"tag":269,"props":407,"children":408},{"style":276},[409],{"type":179,"value":410},"windowToProcess",{"type":173,"tag":269,"props":412,"children":413},{"style":379},[414],{"type":179,"value":415},")",{"type":173,"tag":269,"props":417,"children":418},{"style":282},[419],{"type":179,"value":420},"}",{"type":173,"tag":269,"props":422,"children":423},{"style":379},[424],{"type":179,"value":425},")\n",{"type":173,"tag":269,"props":427,"children":429},{"class":271,"line":428},3,[430,435,439,444,448,454,460,464,469,473,477,481],{"type":173,"tag":269,"props":431,"children":432},{"style":276},[433],{"type":179,"value":434},"  logging",{"type":173,"tag":269,"props":436,"children":437},{"style":282},[438],{"type":179,"value":285},{"type":173,"tag":269,"props":440,"children":441},{"style":288},[442],{"type":179,"value":443},"verbose",{"type":173,"tag":269,"props":445,"children":446},{"style":379},[447],{"type":179,"value":382},{"type":173,"tag":269,"props":449,"children":451},{"style":450},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[452],{"type":179,"value":453},"\"",{"type":173,"tag":269,"props":455,"children":457},{"style":456},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[458],{"type":179,"value":459},"status for page",{"type":173,"tag":269,"props":461,"children":462},{"style":450},[463],{"type":179,"value":453},{"type":173,"tag":269,"props":465,"children":466},{"style":282},[467],{"type":179,"value":468},",",{"type":173,"tag":269,"props":470,"children":471},{"style":276},[472],{"type":179,"value":329},{"type":173,"tag":269,"props":474,"children":475},{"style":282},[476],{"type":179,"value":468},{"type":173,"tag":269,"props":478,"children":479},{"style":276},[480],{"type":179,"value":359},{"type":173,"tag":269,"props":482,"children":483},{"style":379},[484],{"type":179,"value":425},{"type":173,"tag":269,"props":486,"children":488},{"class":271,"line":487},4,[489,495,500,505,509,514,519,524,529,533,537],{"type":173,"tag":269,"props":490,"children":492},{"style":491},"--shiki-light:#39ADB5;--shiki-light-font-style:italic;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#F92672;--shiki-sepia-font-style:inherit",[493],{"type":179,"value":494},"  if",{"type":173,"tag":269,"props":496,"children":497},{"style":379},[498],{"type":179,"value":499}," (",{"type":173,"tag":269,"props":501,"children":502},{"style":276},[503],{"type":179,"value":504},"siteStatus",{"type":173,"tag":269,"props":506,"children":507},{"style":282},[508],{"type":179,"value":285},{"type":173,"tag":269,"props":510,"children":511},{"style":276},[512],{"type":179,"value":513},"mode",{"type":173,"tag":269,"props":515,"children":516},{"style":293},[517],{"type":179,"value":518}," !==",{"type":173,"tag":269,"props":520,"children":521},{"style":450},[522],{"type":179,"value":523}," \"",{"type":173,"tag":269,"props":525,"children":526},{"style":456},[527],{"type":179,"value":528},"allow",{"type":173,"tag":269,"props":530,"children":531},{"style":450},[532],{"type":179,"value":453},{"type":173,"tag":269,"props":534,"children":535},{"style":379},[536],{"type":179,"value":415},{"type":173,"tag":269,"props":538,"children":539},{"style":282},[540],{"type":179,"value":541},"{\n",{"type":173,"tag":269,"props":543,"children":545},{"class":271,"line":544},5,[546,551,555,559,563,567,571,575],{"type":173,"tag":269,"props":547,"children":548},{"style":288},[549],{"type":179,"value":550},"    interceptFunctions",{"type":173,"tag":269,"props":552,"children":553},{"style":379},[554],{"type":179,"value":382},{"type":173,"tag":269,"props":556,"children":557},{"style":276},[558],{"type":179,"value":410},{"type":173,"tag":269,"props":560,"children":561},{"style":282},[562],{"type":179,"value":468},{"type":173,"tag":269,"props":564,"children":565},{"style":276},[566],{"type":179,"value":359},{"type":173,"tag":269,"props":568,"children":569},{"style":282},[570],{"type":179,"value":468},{"type":173,"tag":269,"props":572,"children":573},{"style":276},[574],{"type":179,"value":339},{"type":173,"tag":269,"props":576,"children":577},{"style":379},[578],{"type":179,"value":425},{"type":173,"tag":269,"props":580,"children":582},{"class":271,"line":581},6,[583,588,592,596,600,604,608,612],{"type":173,"tag":269,"props":584,"children":585},{"style":288},[586],{"type":179,"value":587},"    interceptGetters",{"type":173,"tag":269,"props":589,"children":590},{"style":379},[591],{"type":179,"value":382},{"type":173,"tag":269,"props":593,"children":594},{"style":276},[595],{"type":179,"value":410},{"type":173,"tag":269,"props":597,"children":598},{"style":282},[599],{"type":179,"value":468},{"type":173,"tag":269,"props":601,"children":602},{"style":276},[603],{"type":179,"value":359},{"type":173,"tag":269,"props":605,"children":606},{"style":282},[607],{"type":179,"value":468},{"type":173,"tag":269,"props":609,"children":610},{"style":276},[611],{"type":179,"value":339},{"type":173,"tag":269,"props":613,"children":614},{"style":379},[615],{"type":179,"value":425},{"type":173,"tag":269,"props":617,"children":619},{"class":271,"line":618},7,[620],{"type":173,"tag":269,"props":621,"children":622},{"style":282},[623],{"type":179,"value":624},"  }\n",{"type":173,"tag":269,"props":626,"children":628},{"class":271,"line":627},8,[629],{"type":173,"tag":269,"props":630,"children":631},{"style":282},[632],{"type":179,"value":633},"}\n",{"type":173,"tag":174,"props":635,"children":637},{"id":636},"window",[638],{"type":179,"value":215},{"type":173,"tag":181,"props":640,"children":641},{},[642],{"type":179,"value":643},"Blocker 篡改了 Window 的两个属性，window.name 和 window.opener。这两个属性和指纹没有直接关系，但却是一种“帮助函数”，能够帮助恶意网站追踪指纹以及窃取隐私。",{"type":173,"tag":645,"props":646,"children":648},"h3",{"id":647},"windowname",[649],{"type":179,"value":650},"window.name",{"type":173,"tag":181,"props":652,"children":653},{},[654],{"type":179,"value":655},"在过去的浏览器中，window.name 能够跨站点传输数据，并且能逃逸同源策略。从 Firefox 88 开始，用户通过点击超链接跳转到新页面时，window.name 将被置空，不过为了不造成更大的破坏，当用户从跳转后页面回到之前页面时，window.name 会被还原。",{"type":173,"tag":187,"props":657,"children":658},{},[659,671],{"type":173,"tag":191,"props":660,"children":661},{},[662],{"type":173,"tag":663,"props":664,"children":668},"a",{"href":665,"rel":666},"https://blog.mozilla.org/security/2021/04/19/firefox-88-combats-window-name-privacy-abuses/",[667],"nofollow",[669],{"type":179,"value":670},"Firefox 88 combats window.name privacy abuses",{"type":173,"tag":191,"props":672,"children":673},{},[674],{"type":173,"tag":663,"props":675,"children":678},{"href":676,"rel":677},"https://wpt.fyi/results/html/browsers/windows/clear-window-name.https.html?label=master&label=experimental&aligned",[667],[679],{"type":179,"value":680},"clear-window-name@web-platform-tests",{"type":173,"tag":181,"props":682,"children":683},{},[684],{"type":179,"value":685},"在使用 JS 设置 window.name 时，Blocker 会记录下设置的值。original.call 调用原有的 window.name setter；windowNames 只做记录，稍后会用到。",{"type":173,"tag":258,"props":687,"children":689},{"className":260,"code":688,"language":262,"meta":166,"style":166},"{\n  set name(name){\n    // 调用原有 setting 设置 window.name\n    original.call(this, ...arguments)\n    // 把 name 记录下来\n    windowNames.set(this, name)\n  }\n}\n",[690],{"type":173,"tag":265,"props":691,"children":692},{"__ignoreMap":166},[693,700,730,739,785,793,830,837],{"type":173,"tag":269,"props":694,"children":695},{"class":271,"line":272},[696],{"type":173,"tag":269,"props":697,"children":698},{"style":282},[699],{"type":179,"value":541},{"type":173,"tag":269,"props":701,"children":702},{"class":271,"line":347},[703,708,713,717,722,726],{"type":173,"tag":269,"props":704,"children":705},{"style":276},[706],{"type":179,"value":707},"  set",{"type":173,"tag":269,"props":709,"children":710},{"style":288},[711],{"type":179,"value":712}," name",{"type":173,"tag":269,"props":714,"children":715},{"style":379},[716],{"type":179,"value":382},{"type":173,"tag":269,"props":718,"children":719},{"style":276},[720],{"type":179,"value":721},"name",{"type":173,"tag":269,"props":723,"children":724},{"style":379},[725],{"type":179,"value":415},{"type":173,"tag":269,"props":727,"children":728},{"style":282},[729],{"type":179,"value":541},{"type":173,"tag":269,"props":731,"children":732},{"class":271,"line":428},[733],{"type":173,"tag":269,"props":734,"children":736},{"style":735},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit",[737],{"type":179,"value":738},"    // 调用原有 setting 设置 window.name\n",{"type":173,"tag":269,"props":740,"children":741},{"class":271,"line":487},[742,747,751,756,760,766,770,775,781],{"type":173,"tag":269,"props":743,"children":744},{"style":276},[745],{"type":179,"value":746},"    original",{"type":173,"tag":269,"props":748,"children":749},{"style":282},[750],{"type":179,"value":285},{"type":173,"tag":269,"props":752,"children":753},{"style":288},[754],{"type":179,"value":755},"call",{"type":173,"tag":269,"props":757,"children":758},{"style":379},[759],{"type":179,"value":382},{"type":173,"tag":269,"props":761,"children":763},{"style":762},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[764],{"type":179,"value":765},"this",{"type":173,"tag":269,"props":767,"children":768},{"style":282},[769],{"type":179,"value":468},{"type":173,"tag":269,"props":771,"children":772},{"style":293},[773],{"type":179,"value":774}," ...",{"type":173,"tag":269,"props":776,"children":778},{"style":777},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[779],{"type":179,"value":780},"arguments",{"type":173,"tag":269,"props":782,"children":783},{"style":379},[784],{"type":179,"value":425},{"type":173,"tag":269,"props":786,"children":787},{"class":271,"line":544},[788],{"type":173,"tag":269,"props":789,"children":790},{"style":735},[791],{"type":179,"value":792},"    // 把 name 记录下来\n",{"type":173,"tag":269,"props":794,"children":795},{"class":271,"line":581},[796,801,805,810,814,818,822,826],{"type":173,"tag":269,"props":797,"children":798},{"style":276},[799],{"type":179,"value":800},"    windowNames",{"type":173,"tag":269,"props":802,"children":803},{"style":282},[804],{"type":179,"value":285},{"type":173,"tag":269,"props":806,"children":807},{"style":288},[808],{"type":179,"value":809},"set",{"type":173,"tag":269,"props":811,"children":812},{"style":379},[813],{"type":179,"value":382},{"type":173,"tag":269,"props":815,"children":816},{"style":762},[817],{"type":179,"value":765},{"type":173,"tag":269,"props":819,"children":820},{"style":282},[821],{"type":179,"value":468},{"type":173,"tag":269,"props":823,"children":824},{"style":276},[825],{"type":179,"value":712},{"type":173,"tag":269,"props":827,"children":828},{"style":379},[829],{"type":179,"value":425},{"type":173,"tag":269,"props":831,"children":832},{"class":271,"line":618},[833],{"type":173,"tag":269,"props":834,"children":835},{"style":282},[836],{"type":179,"value":624},{"type":173,"tag":269,"props":838,"children":839},{"class":271,"line":627},[840],{"type":173,"tag":269,"props":841,"children":842},{"style":282},[843],{"type":179,"value":633},{"type":173,"tag":181,"props":845,"children":846},{},[847],{"type":179,"value":848},"因为只有通过显式的 window.name = 'xxx' 才会触发 windowNames 中记录的值的改变，所以一旦在 b.com 读取到的 window.name 不是 windowNames 记录的值，就说明浏览器泄露了 window.name，此时需要返回伪造的值。",{"type":173,"tag":258,"props":850,"children":852},{"className":260,"code":851,"language":262,"meta":166,"style":166},"{\n  get name(){\n    return checkerWrapper(checker, this, arguments, function(args, check){\n      const {notify, original, prefs} = check\n\n      // 读取 b.com 的 window.name 可能会返回 a.com 的 window.name\n      const originalName = original.call(this, ...args)\n\n      // 根据配置，iframes 中返回的 window.name 可以赦免此伪造规则，\n      // this !== this.top 是一种快速检测当前 window 是否在 iframe 中的方法\n      if (\n        this !== this.top &&\n        prefs(\"allowWindowNameInFrames\", this.location)\n      ){\n        return originalName\n      }\n\n      // 只有通过显式的 window.name = 'xxx' 才会触发 windowNames 中记录的值的改变，\n      // 所以一旦 windowNames 记录的值和 originalName 不一样，\n      // 就说明当前浏览器犯了 window.name 泄露的错误\n      const returnedName = windowNames.get(this) || \"\"\n      if (originalName !== returnedName){\n        notify(\"fakedWindowReadout\")\n      }\n      return returnedName\n    });\n  }\n}\n",[853],{"type":173,"tag":265,"props":854,"children":855},{"__ignoreMap":166},[856,863,884,954,1003,1011,1019,1071,1078,1087,1096,1110,1141,1188,1201,1215,1224,1232,1241,1250,1259,1313,1346,1376,1384,1398,1416,1424],{"type":173,"tag":269,"props":857,"children":858},{"class":271,"line":272},[859],{"type":173,"tag":269,"props":860,"children":861},{"style":282},[862],{"type":179,"value":541},{"type":173,"tag":269,"props":864,"children":865},{"class":271,"line":347},[866,871,875,880],{"type":173,"tag":269,"props":867,"children":868},{"style":276},[869],{"type":179,"value":870},"  get",{"type":173,"tag":269,"props":872,"children":873},{"style":288},[874],{"type":179,"value":712},{"type":173,"tag":269,"props":876,"children":877},{"style":379},[878],{"type":179,"value":879},"()",{"type":173,"tag":269,"props":881,"children":882},{"style":282},[883],{"type":179,"value":541},{"type":173,"tag":269,"props":885,"children":886},{"class":271,"line":428},[887,892,897,901,906,910,915,919,924,928,932,936,941,945,950],{"type":173,"tag":269,"props":888,"children":889},{"style":491},[890],{"type":179,"value":891},"    return",{"type":173,"tag":269,"props":893,"children":894},{"style":288},[895],{"type":179,"value":896}," checkerWrapper",{"type":173,"tag":269,"props":898,"children":899},{"style":379},[900],{"type":179,"value":382},{"type":173,"tag":269,"props":902,"children":903},{"style":276},[904],{"type":179,"value":905},"checker",{"type":173,"tag":269,"props":907,"children":908},{"style":282},[909],{"type":179,"value":468},{"type":173,"tag":269,"props":911,"children":912},{"style":762},[913],{"type":179,"value":914}," this",{"type":173,"tag":269,"props":916,"children":917},{"style":282},[918],{"type":179,"value":468},{"type":173,"tag":269,"props":920,"children":921},{"style":777},[922],{"type":179,"value":923}," arguments",{"type":173,"tag":269,"props":925,"children":926},{"style":282},[927],{"type":179,"value":468},{"type":173,"tag":269,"props":929,"children":930},{"style":299},[931],{"type":179,"value":302},{"type":173,"tag":269,"props":933,"children":934},{"style":282},[935],{"type":179,"value":382},{"type":173,"tag":269,"props":937,"children":938},{"style":326},[939],{"type":179,"value":940},"args",{"type":173,"tag":269,"props":942,"children":943},{"style":282},[944],{"type":179,"value":468},{"type":173,"tag":269,"props":946,"children":947},{"style":326},[948],{"type":179,"value":949}," check",{"type":173,"tag":269,"props":951,"children":952},{"style":282},[953],{"type":179,"value":344},{"type":173,"tag":269,"props":955,"children":956},{"class":271,"line":487},[957,962,967,972,976,981,985,990,994,998],{"type":173,"tag":269,"props":958,"children":959},{"style":299},[960],{"type":179,"value":961},"      const",{"type":173,"tag":269,"props":963,"children":964},{"style":282},[965],{"type":179,"value":966}," {",{"type":173,"tag":269,"props":968,"children":969},{"style":356},[970],{"type":179,"value":971},"notify",{"type":173,"tag":269,"props":973,"children":974},{"style":282},[975],{"type":179,"value":468},{"type":173,"tag":269,"props":977,"children":978},{"style":356},[979],{"type":179,"value":980}," original",{"type":173,"tag":269,"props":982,"children":983},{"style":282},[984],{"type":179,"value":468},{"type":173,"tag":269,"props":986,"children":987},{"style":356},[988],{"type":179,"value":989}," prefs",{"type":173,"tag":269,"props":991,"children":992},{"style":282},[993],{"type":179,"value":420},{"type":173,"tag":269,"props":995,"children":996},{"style":293},[997],{"type":179,"value":296},{"type":173,"tag":269,"props":999,"children":1000},{"style":276},[1001],{"type":179,"value":1002}," check\n",{"type":173,"tag":269,"props":1004,"children":1005},{"class":271,"line":544},[1006],{"type":173,"tag":269,"props":1007,"children":1008},{"emptyLinePlaceholder":165},[1009],{"type":179,"value":1010},"\n",{"type":173,"tag":269,"props":1012,"children":1013},{"class":271,"line":581},[1014],{"type":173,"tag":269,"props":1015,"children":1016},{"style":735},[1017],{"type":179,"value":1018},"      // 读取 b.com 的 window.name 可能会返回 a.com 的 window.name\n",{"type":173,"tag":269,"props":1020,"children":1021},{"class":271,"line":618},[1022,1026,1031,1035,1039,1043,1047,1051,1055,1059,1063,1067],{"type":173,"tag":269,"props":1023,"children":1024},{"style":299},[1025],{"type":179,"value":961},{"type":173,"tag":269,"props":1027,"children":1028},{"style":356},[1029],{"type":179,"value":1030}," originalName",{"type":173,"tag":269,"props":1032,"children":1033},{"style":293},[1034],{"type":179,"value":296},{"type":173,"tag":269,"props":1036,"children":1037},{"style":276},[1038],{"type":179,"value":980},{"type":173,"tag":269,"props":1040,"children":1041},{"style":282},[1042],{"type":179,"value":285},{"type":173,"tag":269,"props":1044,"children":1045},{"style":288},[1046],{"type":179,"value":755},{"type":173,"tag":269,"props":1048,"children":1049},{"style":379},[1050],{"type":179,"value":382},{"type":173,"tag":269,"props":1052,"children":1053},{"style":762},[1054],{"type":179,"value":765},{"type":173,"tag":269,"props":1056,"children":1057},{"style":282},[1058],{"type":179,"value":468},{"type":173,"tag":269,"props":1060,"children":1061},{"style":293},[1062],{"type":179,"value":774},{"type":173,"tag":269,"props":1064,"children":1065},{"style":276},[1066],{"type":179,"value":940},{"type":173,"tag":269,"props":1068,"children":1069},{"style":379},[1070],{"type":179,"value":425},{"type":173,"tag":269,"props":1072,"children":1073},{"class":271,"line":627},[1074],{"type":173,"tag":269,"props":1075,"children":1076},{"emptyLinePlaceholder":165},[1077],{"type":179,"value":1010},{"type":173,"tag":269,"props":1079,"children":1081},{"class":271,"line":1080},9,[1082],{"type":173,"tag":269,"props":1083,"children":1084},{"style":735},[1085],{"type":179,"value":1086},"      // 根据配置，iframes 中返回的 window.name 可以赦免此伪造规则，\n",{"type":173,"tag":269,"props":1088,"children":1090},{"class":271,"line":1089},10,[1091],{"type":173,"tag":269,"props":1092,"children":1093},{"style":735},[1094],{"type":179,"value":1095},"      // this !== this.top 是一种快速检测当前 window 是否在 iframe 中的方法\n",{"type":173,"tag":269,"props":1097,"children":1099},{"class":271,"line":1098},11,[1100,1105],{"type":173,"tag":269,"props":1101,"children":1102},{"style":491},[1103],{"type":179,"value":1104},"      if",{"type":173,"tag":269,"props":1106,"children":1107},{"style":379},[1108],{"type":179,"value":1109}," (\n",{"type":173,"tag":269,"props":1111,"children":1113},{"class":271,"line":1112},12,[1114,1119,1123,1127,1131,1136],{"type":173,"tag":269,"props":1115,"children":1116},{"style":762},[1117],{"type":179,"value":1118},"        this",{"type":173,"tag":269,"props":1120,"children":1121},{"style":293},[1122],{"type":179,"value":518},{"type":173,"tag":269,"props":1124,"children":1125},{"style":762},[1126],{"type":179,"value":914},{"type":173,"tag":269,"props":1128,"children":1129},{"style":282},[1130],{"type":179,"value":285},{"type":173,"tag":269,"props":1132,"children":1133},{"style":276},[1134],{"type":179,"value":1135},"top",{"type":173,"tag":269,"props":1137,"children":1138},{"style":293},[1139],{"type":179,"value":1140}," &&\n",{"type":173,"tag":269,"props":1142,"children":1144},{"class":271,"line":1143},13,[1145,1150,1154,1158,1163,1167,1171,1175,1179,1184],{"type":173,"tag":269,"props":1146,"children":1147},{"style":288},[1148],{"type":179,"value":1149},"        prefs",{"type":173,"tag":269,"props":1151,"children":1152},{"style":379},[1153],{"type":179,"value":382},{"type":173,"tag":269,"props":1155,"children":1156},{"style":450},[1157],{"type":179,"value":453},{"type":173,"tag":269,"props":1159,"children":1160},{"style":456},[1161],{"type":179,"value":1162},"allowWindowNameInFrames",{"type":173,"tag":269,"props":1164,"children":1165},{"style":450},[1166],{"type":179,"value":453},{"type":173,"tag":269,"props":1168,"children":1169},{"style":282},[1170],{"type":179,"value":468},{"type":173,"tag":269,"props":1172,"children":1173},{"style":762},[1174],{"type":179,"value":914},{"type":173,"tag":269,"props":1176,"children":1177},{"style":282},[1178],{"type":179,"value":285},{"type":173,"tag":269,"props":1180,"children":1181},{"style":276},[1182],{"type":179,"value":1183},"location",{"type":173,"tag":269,"props":1185,"children":1186},{"style":379},[1187],{"type":179,"value":425},{"type":173,"tag":269,"props":1189,"children":1191},{"class":271,"line":1190},14,[1192,1197],{"type":173,"tag":269,"props":1193,"children":1194},{"style":379},[1195],{"type":179,"value":1196},"      )",{"type":173,"tag":269,"props":1198,"children":1199},{"style":282},[1200],{"type":179,"value":541},{"type":173,"tag":269,"props":1202,"children":1204},{"class":271,"line":1203},15,[1205,1210],{"type":173,"tag":269,"props":1206,"children":1207},{"style":491},[1208],{"type":179,"value":1209},"        return",{"type":173,"tag":269,"props":1211,"children":1212},{"style":276},[1213],{"type":179,"value":1214}," originalName\n",{"type":173,"tag":269,"props":1216,"children":1218},{"class":271,"line":1217},16,[1219],{"type":173,"tag":269,"props":1220,"children":1221},{"style":282},[1222],{"type":179,"value":1223},"      }\n",{"type":173,"tag":269,"props":1225,"children":1227},{"class":271,"line":1226},17,[1228],{"type":173,"tag":269,"props":1229,"children":1230},{"emptyLinePlaceholder":165},[1231],{"type":179,"value":1010},{"type":173,"tag":269,"props":1233,"children":1235},{"class":271,"line":1234},18,[1236],{"type":173,"tag":269,"props":1237,"children":1238},{"style":735},[1239],{"type":179,"value":1240},"      // 只有通过显式的 window.name = 'xxx' 才会触发 windowNames 中记录的值的改变，\n",{"type":173,"tag":269,"props":1242,"children":1244},{"class":271,"line":1243},19,[1245],{"type":173,"tag":269,"props":1246,"children":1247},{"style":735},[1248],{"type":179,"value":1249},"      // 所以一旦 windowNames 记录的值和 originalName 不一样，\n",{"type":173,"tag":269,"props":1251,"children":1253},{"class":271,"line":1252},20,[1254],{"type":173,"tag":269,"props":1255,"children":1256},{"style":735},[1257],{"type":179,"value":1258},"      // 就说明当前浏览器犯了 window.name 泄露的错误\n",{"type":173,"tag":269,"props":1260,"children":1262},{"class":271,"line":1261},21,[1263,1267,1272,1276,1281,1285,1290,1294,1298,1303,1308],{"type":173,"tag":269,"props":1264,"children":1265},{"style":299},[1266],{"type":179,"value":961},{"type":173,"tag":269,"props":1268,"children":1269},{"style":356},[1270],{"type":179,"value":1271}," returnedName",{"type":173,"tag":269,"props":1273,"children":1274},{"style":293},[1275],{"type":179,"value":296},{"type":173,"tag":269,"props":1277,"children":1278},{"style":276},[1279],{"type":179,"value":1280}," windowNames",{"type":173,"tag":269,"props":1282,"children":1283},{"style":282},[1284],{"type":179,"value":285},{"type":173,"tag":269,"props":1286,"children":1287},{"style":288},[1288],{"type":179,"value":1289},"get",{"type":173,"tag":269,"props":1291,"children":1292},{"style":379},[1293],{"type":179,"value":382},{"type":173,"tag":269,"props":1295,"children":1296},{"style":762},[1297],{"type":179,"value":765},{"type":173,"tag":269,"props":1299,"children":1300},{"style":379},[1301],{"type":179,"value":1302},") ",{"type":173,"tag":269,"props":1304,"children":1305},{"style":293},[1306],{"type":179,"value":1307},"||",{"type":173,"tag":269,"props":1309,"children":1310},{"style":450},[1311],{"type":179,"value":1312}," \"\"\n",{"type":173,"tag":269,"props":1314,"children":1316},{"class":271,"line":1315},22,[1317,1321,1325,1330,1334,1338,1342],{"type":173,"tag":269,"props":1318,"children":1319},{"style":491},[1320],{"type":179,"value":1104},{"type":173,"tag":269,"props":1322,"children":1323},{"style":379},[1324],{"type":179,"value":499},{"type":173,"tag":269,"props":1326,"children":1327},{"style":276},[1328],{"type":179,"value":1329},"originalName",{"type":173,"tag":269,"props":1331,"children":1332},{"style":293},[1333],{"type":179,"value":518},{"type":173,"tag":269,"props":1335,"children":1336},{"style":276},[1337],{"type":179,"value":1271},{"type":173,"tag":269,"props":1339,"children":1340},{"style":379},[1341],{"type":179,"value":415},{"type":173,"tag":269,"props":1343,"children":1344},{"style":282},[1345],{"type":179,"value":541},{"type":173,"tag":269,"props":1347,"children":1349},{"class":271,"line":1348},23,[1350,1355,1359,1363,1368,1372],{"type":173,"tag":269,"props":1351,"children":1352},{"style":288},[1353],{"type":179,"value":1354},"        notify",{"type":173,"tag":269,"props":1356,"children":1357},{"style":379},[1358],{"type":179,"value":382},{"type":173,"tag":269,"props":1360,"children":1361},{"style":450},[1362],{"type":179,"value":453},{"type":173,"tag":269,"props":1364,"children":1365},{"style":456},[1366],{"type":179,"value":1367},"fakedWindowReadout",{"type":173,"tag":269,"props":1369,"children":1370},{"style":450},[1371],{"type":179,"value":453},{"type":173,"tag":269,"props":1373,"children":1374},{"style":379},[1375],{"type":179,"value":425},{"type":173,"tag":269,"props":1377,"children":1379},{"class":271,"line":1378},24,[1380],{"type":173,"tag":269,"props":1381,"children":1382},{"style":282},[1383],{"type":179,"value":1223},{"type":173,"tag":269,"props":1385,"children":1387},{"class":271,"line":1386},25,[1388,1393],{"type":173,"tag":269,"props":1389,"children":1390},{"style":491},[1391],{"type":179,"value":1392},"      return",{"type":173,"tag":269,"props":1394,"children":1395},{"style":276},[1396],{"type":179,"value":1397}," returnedName\n",{"type":173,"tag":269,"props":1399,"children":1401},{"class":271,"line":1400},26,[1402,1407,1411],{"type":173,"tag":269,"props":1403,"children":1404},{"style":282},[1405],{"type":179,"value":1406},"    }",{"type":173,"tag":269,"props":1408,"children":1409},{"style":379},[1410],{"type":179,"value":415},{"type":173,"tag":269,"props":1412,"children":1413},{"style":282},[1414],{"type":179,"value":1415},";\n",{"type":173,"tag":269,"props":1417,"children":1419},{"class":271,"line":1418},27,[1420],{"type":173,"tag":269,"props":1421,"children":1422},{"style":282},[1423],{"type":179,"value":624},{"type":173,"tag":269,"props":1425,"children":1427},{"class":271,"line":1426},28,[1428],{"type":173,"tag":269,"props":1429,"children":1430},{"style":282},[1431],{"type":179,"value":633},{"type":173,"tag":174,"props":1433,"children":1435},{"id":1434},"windowopener",[1436],{"type":179,"value":1437},"window.opener",{"type":173,"tag":181,"props":1439,"children":1440},{},[1441],{"type":179,"value":1442},"在过去的浏览器中，当页面通过超链接或 window.open 的方式从 A 网站跳转到 B 网站时，如果制定了 target 属性却没有指定 rel=\"norefer\" 属性，那么在 B 网站是可以使用 window.opener 获取到 A 网站的部分信息的。也就是说，在 B 网站中可以修改 window.opener.location.href = 'x' 从而让 A 网站自动跳转到 X 网站。如果页面跳转时使用 target=\"__blank\" 打开了新页面，那么用户更加不可能注意到 A 网站的恶意跳转。",{"type":173,"tag":187,"props":1444,"children":1445},{},[1446],{"type":173,"tag":191,"props":1447,"children":1448},{},[1449],{"type":173,"tag":663,"props":1450,"children":1453},{"href":1451,"rel":1452},"https://cwe.mitre.org/data/definitions/1022.html",[667],[1454],{"type":179,"value":1455},"CWE-1022: Use of Web Link to Untrusted Target with window.opener Access",{"type":173,"tag":181,"props":1457,"children":1458},{},[1459],{"type":179,"value":1460},"Blocker 对 window.opener 的防范比较简单，直接返回 null 就完事儿了。考虑到现代浏览器已经修复了这个漏洞，该篡改的设置的值默认是关闭的。",{"type":173,"tag":258,"props":1462,"children":1464},{"className":260,"code":1463,"language":262,"meta":166,"style":166},"{\n  // 修改 Getter 使 window.opener 一直返回 null\n  getterGenerator: function(checker){\n    const temp = {\n      get opener(){\n        return checkerWrapper(checker, this, arguments, function(args, check){\n          const {notify, original} = check\n          const originalOpener = original.call(this, ...args)\n          if (originalOpener !== null){\n            notify(\"fakedWindowReadout\")\n          }\n          return null\n        })\n      }\n    }\n    return Object.getOwnPropertyDescriptor(temp, \"opener\").get\n  },\n  // 修改 Descriptor.Value 使得 window.opener 一直返回 null，\n  // 这是一种兼容，在部分浏览器中，\n  //  window.opener 是通过 value 而不是 getter 获取的值\n  valueGenerator: function({original, notify}){\n    if (original !== null){\n      notify(\"fakedWindowReadout\")\n    }\n    return null\n  }\n}\n",[1465],{"type":173,"tag":265,"props":1466,"children":1467},{"__ignoreMap":166},[1468,1475,1483,1512,1534,1553,1616,1652,1704,1739,1767,1775,1788,1800,1807,1815,1875,1883,1891,1899,1907,1946,1978,2006,2013,2024,2031],{"type":173,"tag":269,"props":1469,"children":1470},{"class":271,"line":272},[1471],{"type":173,"tag":269,"props":1472,"children":1473},{"style":282},[1474],{"type":179,"value":541},{"type":173,"tag":269,"props":1476,"children":1477},{"class":271,"line":347},[1478],{"type":173,"tag":269,"props":1479,"children":1480},{"style":735},[1481],{"type":179,"value":1482},"  // 修改 Getter 使 window.opener 一直返回 null\n",{"type":173,"tag":269,"props":1484,"children":1485},{"class":271,"line":428},[1486,1492,1496,1500,1504,1508],{"type":173,"tag":269,"props":1487,"children":1489},{"style":1488},"--shiki-light:#E2931D;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#F8F8F2",[1490],{"type":179,"value":1491},"  getterGenerator",{"type":173,"tag":269,"props":1493,"children":1494},{"style":282},[1495],{"type":179,"value":323},{"type":173,"tag":269,"props":1497,"children":1498},{"style":299},[1499],{"type":179,"value":302},{"type":173,"tag":269,"props":1501,"children":1502},{"style":282},[1503],{"type":179,"value":382},{"type":173,"tag":269,"props":1505,"children":1506},{"style":326},[1507],{"type":179,"value":905},{"type":173,"tag":269,"props":1509,"children":1510},{"style":282},[1511],{"type":179,"value":344},{"type":173,"tag":269,"props":1513,"children":1514},{"class":271,"line":487},[1515,1520,1525,1529],{"type":173,"tag":269,"props":1516,"children":1517},{"style":299},[1518],{"type":179,"value":1519},"    const",{"type":173,"tag":269,"props":1521,"children":1522},{"style":356},[1523],{"type":179,"value":1524}," temp",{"type":173,"tag":269,"props":1526,"children":1527},{"style":293},[1528],{"type":179,"value":296},{"type":173,"tag":269,"props":1530,"children":1531},{"style":282},[1532],{"type":179,"value":1533}," {\n",{"type":173,"tag":269,"props":1535,"children":1536},{"class":271,"line":544},[1537,1542,1548],{"type":173,"tag":269,"props":1538,"children":1539},{"style":299},[1540],{"type":179,"value":1541},"      get",{"type":173,"tag":269,"props":1543,"children":1545},{"style":1544},"--shiki-light:#E53935;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[1546],{"type":179,"value":1547}," opener",{"type":173,"tag":269,"props":1549,"children":1550},{"style":282},[1551],{"type":179,"value":1552},"(){\n",{"type":173,"tag":269,"props":1554,"children":1555},{"class":271,"line":581},[1556,1560,1564,1568,1572,1576,1580,1584,1588,1592,1596,1600,1604,1608,1612],{"type":173,"tag":269,"props":1557,"children":1558},{"style":491},[1559],{"type":179,"value":1209},{"type":173,"tag":269,"props":1561,"children":1562},{"style":288},[1563],{"type":179,"value":896},{"type":173,"tag":269,"props":1565,"children":1566},{"style":379},[1567],{"type":179,"value":382},{"type":173,"tag":269,"props":1569,"children":1570},{"style":276},[1571],{"type":179,"value":905},{"type":173,"tag":269,"props":1573,"children":1574},{"style":282},[1575],{"type":179,"value":468},{"type":173,"tag":269,"props":1577,"children":1578},{"style":762},[1579],{"type":179,"value":914},{"type":173,"tag":269,"props":1581,"children":1582},{"style":282},[1583],{"type":179,"value":468},{"type":173,"tag":269,"props":1585,"children":1586},{"style":777},[1587],{"type":179,"value":923},{"type":173,"tag":269,"props":1589,"children":1590},{"style":282},[1591],{"type":179,"value":468},{"type":173,"tag":269,"props":1593,"children":1594},{"style":299},[1595],{"type":179,"value":302},{"type":173,"tag":269,"props":1597,"children":1598},{"style":282},[1599],{"type":179,"value":382},{"type":173,"tag":269,"props":1601,"children":1602},{"style":326},[1603],{"type":179,"value":940},{"type":173,"tag":269,"props":1605,"children":1606},{"style":282},[1607],{"type":179,"value":468},{"type":173,"tag":269,"props":1609,"children":1610},{"style":326},[1611],{"type":179,"value":949},{"type":173,"tag":269,"props":1613,"children":1614},{"style":282},[1615],{"type":179,"value":344},{"type":173,"tag":269,"props":1617,"children":1618},{"class":271,"line":618},[1619,1624,1628,1632,1636,1640,1644,1648],{"type":173,"tag":269,"props":1620,"children":1621},{"style":299},[1622],{"type":179,"value":1623},"          const",{"type":173,"tag":269,"props":1625,"children":1626},{"style":282},[1627],{"type":179,"value":966},{"type":173,"tag":269,"props":1629,"children":1630},{"style":356},[1631],{"type":179,"value":971},{"type":173,"tag":269,"props":1633,"children":1634},{"style":282},[1635],{"type":179,"value":468},{"type":173,"tag":269,"props":1637,"children":1638},{"style":356},[1639],{"type":179,"value":980},{"type":173,"tag":269,"props":1641,"children":1642},{"style":282},[1643],{"type":179,"value":420},{"type":173,"tag":269,"props":1645,"children":1646},{"style":293},[1647],{"type":179,"value":296},{"type":173,"tag":269,"props":1649,"children":1650},{"style":276},[1651],{"type":179,"value":1002},{"type":173,"tag":269,"props":1653,"children":1654},{"class":271,"line":627},[1655,1659,1664,1668,1672,1676,1680,1684,1688,1692,1696,1700],{"type":173,"tag":269,"props":1656,"children":1657},{"style":299},[1658],{"type":179,"value":1623},{"type":173,"tag":269,"props":1660,"children":1661},{"style":356},[1662],{"type":179,"value":1663}," originalOpener",{"type":173,"tag":269,"props":1665,"children":1666},{"style":293},[1667],{"type":179,"value":296},{"type":173,"tag":269,"props":1669,"children":1670},{"style":276},[1671],{"type":179,"value":980},{"type":173,"tag":269,"props":1673,"children":1674},{"style":282},[1675],{"type":179,"value":285},{"type":173,"tag":269,"props":1677,"children":1678},{"style":288},[1679],{"type":179,"value":755},{"type":173,"tag":269,"props":1681,"children":1682},{"style":379},[1683],{"type":179,"value":382},{"type":173,"tag":269,"props":1685,"children":1686},{"style":762},[1687],{"type":179,"value":765},{"type":173,"tag":269,"props":1689,"children":1690},{"style":282},[1691],{"type":179,"value":468},{"type":173,"tag":269,"props":1693,"children":1694},{"style":293},[1695],{"type":179,"value":774},{"type":173,"tag":269,"props":1697,"children":1698},{"style":276},[1699],{"type":179,"value":940},{"type":173,"tag":269,"props":1701,"children":1702},{"style":379},[1703],{"type":179,"value":425},{"type":173,"tag":269,"props":1705,"children":1706},{"class":271,"line":1080},[1707,1712,1716,1721,1725,1731,1735],{"type":173,"tag":269,"props":1708,"children":1709},{"style":491},[1710],{"type":179,"value":1711},"          if",{"type":173,"tag":269,"props":1713,"children":1714},{"style":379},[1715],{"type":179,"value":499},{"type":173,"tag":269,"props":1717,"children":1718},{"style":276},[1719],{"type":179,"value":1720},"originalOpener",{"type":173,"tag":269,"props":1722,"children":1723},{"style":293},[1724],{"type":179,"value":518},{"type":173,"tag":269,"props":1726,"children":1728},{"style":1727},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[1729],{"type":179,"value":1730}," null",{"type":173,"tag":269,"props":1732,"children":1733},{"style":379},[1734],{"type":179,"value":415},{"type":173,"tag":269,"props":1736,"children":1737},{"style":282},[1738],{"type":179,"value":541},{"type":173,"tag":269,"props":1740,"children":1741},{"class":271,"line":1089},[1742,1747,1751,1755,1759,1763],{"type":173,"tag":269,"props":1743,"children":1744},{"style":288},[1745],{"type":179,"value":1746},"            notify",{"type":173,"tag":269,"props":1748,"children":1749},{"style":379},[1750],{"type":179,"value":382},{"type":173,"tag":269,"props":1752,"children":1753},{"style":450},[1754],{"type":179,"value":453},{"type":173,"tag":269,"props":1756,"children":1757},{"style":456},[1758],{"type":179,"value":1367},{"type":173,"tag":269,"props":1760,"children":1761},{"style":450},[1762],{"type":179,"value":453},{"type":173,"tag":269,"props":1764,"children":1765},{"style":379},[1766],{"type":179,"value":425},{"type":173,"tag":269,"props":1768,"children":1769},{"class":271,"line":1098},[1770],{"type":173,"tag":269,"props":1771,"children":1772},{"style":282},[1773],{"type":179,"value":1774},"          }\n",{"type":173,"tag":269,"props":1776,"children":1777},{"class":271,"line":1112},[1778,1783],{"type":173,"tag":269,"props":1779,"children":1780},{"style":491},[1781],{"type":179,"value":1782},"          return",{"type":173,"tag":269,"props":1784,"children":1785},{"style":1727},[1786],{"type":179,"value":1787}," null\n",{"type":173,"tag":269,"props":1789,"children":1790},{"class":271,"line":1143},[1791,1796],{"type":173,"tag":269,"props":1792,"children":1793},{"style":282},[1794],{"type":179,"value":1795},"        }",{"type":173,"tag":269,"props":1797,"children":1798},{"style":379},[1799],{"type":179,"value":425},{"type":173,"tag":269,"props":1801,"children":1802},{"class":271,"line":1190},[1803],{"type":173,"tag":269,"props":1804,"children":1805},{"style":282},[1806],{"type":179,"value":1223},{"type":173,"tag":269,"props":1808,"children":1809},{"class":271,"line":1203},[1810],{"type":173,"tag":269,"props":1811,"children":1812},{"style":282},[1813],{"type":179,"value":1814},"    }\n",{"type":173,"tag":269,"props":1816,"children":1817},{"class":271,"line":1217},[1818,1822,1827,1831,1836,1840,1845,1849,1853,1858,1862,1866,1870],{"type":173,"tag":269,"props":1819,"children":1820},{"style":491},[1821],{"type":179,"value":891},{"type":173,"tag":269,"props":1823,"children":1824},{"style":276},[1825],{"type":179,"value":1826}," Object",{"type":173,"tag":269,"props":1828,"children":1829},{"style":282},[1830],{"type":179,"value":285},{"type":173,"tag":269,"props":1832,"children":1833},{"style":288},[1834],{"type":179,"value":1835},"getOwnPropertyDescriptor",{"type":173,"tag":269,"props":1837,"children":1838},{"style":379},[1839],{"type":179,"value":382},{"type":173,"tag":269,"props":1841,"children":1842},{"style":276},[1843],{"type":179,"value":1844},"temp",{"type":173,"tag":269,"props":1846,"children":1847},{"style":282},[1848],{"type":179,"value":468},{"type":173,"tag":269,"props":1850,"children":1851},{"style":450},[1852],{"type":179,"value":523},{"type":173,"tag":269,"props":1854,"children":1855},{"style":456},[1856],{"type":179,"value":1857},"opener",{"type":173,"tag":269,"props":1859,"children":1860},{"style":450},[1861],{"type":179,"value":453},{"type":173,"tag":269,"props":1863,"children":1864},{"style":379},[1865],{"type":179,"value":415},{"type":173,"tag":269,"props":1867,"children":1868},{"style":282},[1869],{"type":179,"value":285},{"type":173,"tag":269,"props":1871,"children":1872},{"style":276},[1873],{"type":179,"value":1874},"get\n",{"type":173,"tag":269,"props":1876,"children":1877},{"class":271,"line":1226},[1878],{"type":173,"tag":269,"props":1879,"children":1880},{"style":282},[1881],{"type":179,"value":1882},"  },\n",{"type":173,"tag":269,"props":1884,"children":1885},{"class":271,"line":1234},[1886],{"type":173,"tag":269,"props":1887,"children":1888},{"style":735},[1889],{"type":179,"value":1890},"  // 修改 Descriptor.Value 使得 window.opener 一直返回 null，\n",{"type":173,"tag":269,"props":1892,"children":1893},{"class":271,"line":1243},[1894],{"type":173,"tag":269,"props":1895,"children":1896},{"style":735},[1897],{"type":179,"value":1898},"  // 这是一种兼容，在部分浏览器中，\n",{"type":173,"tag":269,"props":1900,"children":1901},{"class":271,"line":1252},[1902],{"type":173,"tag":269,"props":1903,"children":1904},{"style":735},[1905],{"type":179,"value":1906},"  //  window.opener 是通过 value 而不是 getter 获取的值\n",{"type":173,"tag":269,"props":1908,"children":1909},{"class":271,"line":1261},[1910,1915,1919,1923,1927,1932,1936,1941],{"type":173,"tag":269,"props":1911,"children":1912},{"style":1488},[1913],{"type":179,"value":1914},"  valueGenerator",{"type":173,"tag":269,"props":1916,"children":1917},{"style":282},[1918],{"type":179,"value":323},{"type":173,"tag":269,"props":1920,"children":1921},{"style":299},[1922],{"type":179,"value":302},{"type":173,"tag":269,"props":1924,"children":1925},{"style":282},[1926],{"type":179,"value":312},{"type":173,"tag":269,"props":1928,"children":1929},{"style":326},[1930],{"type":179,"value":1931},"original",{"type":173,"tag":269,"props":1933,"children":1934},{"style":282},[1935],{"type":179,"value":468},{"type":173,"tag":269,"props":1937,"children":1938},{"style":326},[1939],{"type":179,"value":1940}," notify",{"type":173,"tag":269,"props":1942,"children":1943},{"style":282},[1944],{"type":179,"value":1945},"}){\n",{"type":173,"tag":269,"props":1947,"children":1948},{"class":271,"line":1315},[1949,1954,1958,1962,1966,1970,1974],{"type":173,"tag":269,"props":1950,"children":1951},{"style":491},[1952],{"type":179,"value":1953},"    if",{"type":173,"tag":269,"props":1955,"children":1956},{"style":379},[1957],{"type":179,"value":499},{"type":173,"tag":269,"props":1959,"children":1960},{"style":276},[1961],{"type":179,"value":1931},{"type":173,"tag":269,"props":1963,"children":1964},{"style":293},[1965],{"type":179,"value":518},{"type":173,"tag":269,"props":1967,"children":1968},{"style":1727},[1969],{"type":179,"value":1730},{"type":173,"tag":269,"props":1971,"children":1972},{"style":379},[1973],{"type":179,"value":415},{"type":173,"tag":269,"props":1975,"children":1976},{"style":282},[1977],{"type":179,"value":541},{"type":173,"tag":269,"props":1979,"children":1980},{"class":271,"line":1348},[1981,1986,1990,1994,1998,2002],{"type":173,"tag":269,"props":1982,"children":1983},{"style":288},[1984],{"type":179,"value":1985},"      notify",{"type":173,"tag":269,"props":1987,"children":1988},{"style":379},[1989],{"type":179,"value":382},{"type":173,"tag":269,"props":1991,"children":1992},{"style":450},[1993],{"type":179,"value":453},{"type":173,"tag":269,"props":1995,"children":1996},{"style":456},[1997],{"type":179,"value":1367},{"type":173,"tag":269,"props":1999,"children":2000},{"style":450},[2001],{"type":179,"value":453},{"type":173,"tag":269,"props":2003,"children":2004},{"style":379},[2005],{"type":179,"value":425},{"type":173,"tag":269,"props":2007,"children":2008},{"class":271,"line":1378},[2009],{"type":173,"tag":269,"props":2010,"children":2011},{"style":282},[2012],{"type":179,"value":1814},{"type":173,"tag":269,"props":2014,"children":2015},{"class":271,"line":1386},[2016,2020],{"type":173,"tag":269,"props":2017,"children":2018},{"style":491},[2019],{"type":179,"value":891},{"type":173,"tag":269,"props":2021,"children":2022},{"style":1727},[2023],{"type":179,"value":1787},{"type":173,"tag":269,"props":2025,"children":2026},{"class":271,"line":1400},[2027],{"type":173,"tag":269,"props":2028,"children":2029},{"style":282},[2030],{"type":179,"value":624},{"type":173,"tag":269,"props":2032,"children":2033},{"class":271,"line":1418},[2034],{"type":173,"tag":269,"props":2035,"children":2036},{"style":282},[2037],{"type":179,"value":633},{"type":173,"tag":174,"props":2039,"children":2041},{"id":2040},"canvas",[2042],{"type":179,"value":2043},"Canvas",{"type":173,"tag":181,"props":2045,"children":2046},{},[2047],{"type":179,"value":2048},"伪造了 getContext、getDataURL 等 API，并替代了原本正常的 API。",{"type":173,"tag":174,"props":2050,"children":2052},{"id":2051},"相关链接",[2053],{"type":179,"value":2051},{"type":173,"tag":187,"props":2055,"children":2056},{},[2057],{"type":173,"tag":191,"props":2058,"children":2059},{},[2060],{"type":173,"tag":663,"props":2061,"children":2064},{"href":2062,"rel":2063},"https://github.com/kkapsner/CanvasBlocker",[667],[2065],{"type":179,"value":2066},"CanvasBlocker",{"type":173,"tag":2068,"props":2069,"children":2070},"style",{},[2071],{"type":179,"value":2072},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":166,"searchDepth":347,"depth":347,"links":2074},[2075,2076,2077,2080,2081,2082],{"id":176,"depth":347,"text":176},{"id":243,"depth":347,"text":246},{"id":636,"depth":347,"text":215,"children":2078},[2079],{"id":647,"depth":428,"text":650},{"id":1434,"depth":347,"text":1437},{"id":2040,"depth":347,"text":2043},{"id":2051,"depth":347,"text":2051},"markdown","content:8.source-code:_js:browser-extension:canvas-blocker.md","content","8.source-code/_js/browser-extension/canvas-blocker.md","8.source-code/_js/browser-extension/canvas-blocker","md",[2090,2093],{"_path":2091,"title":2092,"description":166},"/source-code/_es/object-assign","Object.prototype.assign",{"_path":2094,"title":2095,"description":166},"/source-code/_js/element-plus","ElementPlus",1750854655442]