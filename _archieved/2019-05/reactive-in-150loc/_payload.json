[{"data":1,"prerenderedAt":5907},["ShallowReactive",2],{"navigation":3,"/_archieved/2019-05/reactive-in-150loc":410,"/_archieved/2019-05/reactive-in-150loc-surround":5900},[4,32,83,102,129,135,141,147,393,399,405],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🌃 长夜梦","/flows/long-night-dream",{"title":15,"_path":16},"🌌 万物联结与幸福感","/flows/everything",{"title":18,"_path":19},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":21,"_path":22},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":24,"_path":25},"🌧️ 我的腼腆","/flows/shy",{"title":27,"_path":28},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":30,"_path":31},"📝 心流归档","/flows/fold",{"title":33,"_path":34,"children":35},"技术博客 / Coder","/articles",[36,38,41,44,47,50,53,56,59,62,65,68,71,74,77,80],{"title":37,"_path":34},"🦁 为什么我要写博客",{"title":39,"_path":40},"💻 本地部署 Qwen 翻译网页","/articles/local-translator",{"title":42,"_path":43},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":45,"_path":46},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":48,"_path":49},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":51,"_path":52},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":54,"_path":55},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":57,"_path":58},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":60,"_path":61},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":63,"_path":64},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":66,"_path":67},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":69,"_path":70},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":72,"_path":73},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":75,"_path":76},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":78,"_path":79},"🚝 四十二篇系列","/articles/fourty-two",{"title":81,"_path":82},"📝 技术博客归档","/articles/fold",{"title":84,"_path":85,"children":86},"造物 / Make","/tools",[87,90,93,96,99],{"title":88,"_path":89},"🧶 网易云音乐歌单排序","/tools/netease-sorter",{"title":91,"_path":92},"🌐 AnySort","/tools/anysort",{"title":94,"_path":95},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":97,"_path":98},"👓 Crapto","/tools/crypto-inline",{"title":100,"_path":101},"🖨️ any-to-base64","/tools/any-to-base64",{"title":103,"_path":104,"children":105},"吉他剧场 / Music","/music",[106,108,111,114,117,120,123,126],{"title":107,"_path":104},"🎸 FingerStyle！",{"title":109,"_path":110},"🌬️ 等待的风","/music/wind",{"title":112,"_path":113},"💕 约定的海洋","/music/ocean",{"title":115,"_path":116},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":118,"_path":119},"🌏 残酷天使的行动纲领","/music/eva",{"title":121,"_path":122},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":124,"_path":125},"🍷 Wu Wei","/music/wu-wei",{"title":127,"_path":128},"🌅 无题","/music/untitled",{"title":130,"_path":131,"children":132},"画点什么 / Paint","/paint",[133],{"title":134,"_path":131},"🚧 正在施工",{"title":136,"_path":137,"children":138},"读书笔记 / Notes","/books",[139],{"title":140,"_path":137},"📕 读书笔记",{"title":142,"_path":143,"children":144},"知识地图 / Maps","/maps",[145],{"title":146,"_path":143},"🏁 知识地图",{"title":148,"_path":149,"children":150},"零散的笔记 / Gists","/gists",[151,153,156,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255,258,261,264,267,270,273,276,279,282,285,288,291,294,297,300,303,306,309,312,315,318,321,324,327,330,333,336,339,342,345,348,351,354,357,360,363,366,369,372,375,378,381,384,387,390],{"title":152,"_path":149},"🧊 Gists",{"title":154,"_path":155},"网站的可访问性","/gists/accessibility",{"title":157,"_path":158},"Bit","/gists/bit",{"title":160,"_path":161},"图片模糊","/gists/blur",{"title":163,"_path":164},"渲染相关笔记","/gists/c4d",{"title":166,"_path":167},"CDN 问题记录","/gists/cdn",{"title":169,"_path":170},"消毒剂","/gists/cleaner",{"title":172,"_path":173},"Windows Command","/gists/cmd",{"title":175,"_path":176},"Command","/gists/command",{"title":178,"_path":179},"复杂科学","/gists/complexity-science",{"title":181,"_path":182},"GitHub Copilot","/gists/copilot",{"title":184,"_path":185},"宇宙","/gists/cosmos",{"title":187,"_path":188},"C++","/gists/cpp",{"title":190,"_path":191},"Data Structure","/gists/data-structure",{"title":193,"_path":194},"DEPRESSION","/gists/depression",{"title":196,"_path":197},"设计模式","/gists/design-patterns",{"title":199,"_path":200},"Developer Experience","/gists/developer-experience",{"title":202,"_path":203},"Device Metrics","/gists/device-metrix",{"title":205,"_path":206},"数字化转型","/gists/digital-transformation",{"title":208,"_path":209},"ECMAScript Language Specification","/gists/ecmascript-specification",{"title":211,"_path":212},"正则表达式","/gists/eegex",{"title":214,"_path":215},"Emoji","/gists/emoji",{"title":217,"_path":218},"工程","/gists/engineering",{"title":220,"_path":221},"熵","/gists/entropy",{"title":223,"_path":224},"Environment","/gists/environment",{"title":226,"_path":227},"Erlang","/gists/erlang",{"title":229,"_path":230},"逃离塔克夫","/gists/escape-from-tarkov",{"title":232,"_path":233},"ESNext (ES6-ES11)","/gists/esnext",{"title":235,"_path":236},"Eval！","/gists/eval",{"title":238,"_path":239},"Flutter","/gists/flutter",{"title":241,"_path":242},"字体","/gists/font",{"title":244,"_path":245},"JS 函数式编程","/gists/functional",{"title":247,"_path":248},"游戏化","/gists/gamification",{"title":250,"_path":251},"Google C++ Standard","/gists/google-cpp-standard",{"title":253,"_path":254},"双向链接完全体","/gists/graph",{"title":256,"_path":257},"Hardwares","/gists/hardwares",{"title":259,"_path":260},"哈希冲突","/gists/hash-collision",{"title":262,"_path":263},"信息设计","/gists/information-design",{"title":265,"_path":266},"InstantPage","/gists/instant.page",{"title":268,"_path":269},"ISUX 遇见大数据可视化系列","/gists/isux-data-visualization",{"title":271,"_path":272},"KVStore","/gists/key-value-db",{"title":274,"_path":275},"Kubernetes","/gists/kubernetes",{"title":277,"_path":278},"Makefile","/gists/makefile",{"title":280,"_path":281},"Markdown Inline Style","/gists/markdown-nice",{"title":283,"_path":284},"小程序","/gists/miniapp",{"title":286,"_path":287},"减小页面快照体积","/gists/minify-html",{"title":289,"_path":290},"mklink","/gists/mklink",{"title":292,"_path":293},"Mock","/gists/mock",{"title":295,"_path":296},"多人协作系统","/gists/multiplayer",{"title":298,"_path":299},"多端应用","/gists/multy-end-app",{"title":301,"_path":302},"神经科学","/gists/neuroscience",{"title":304,"_path":305},"OO","/gists/oo",{"title":307,"_path":308},"Opinioned Personal Folder","/gists/opinioned-personal-folder",{"title":310,"_path":311},"PInvoke","/gists/pinvoke",{"title":313,"_path":314},"像素","/gists/pixel",{"title":316,"_path":317},"PowerShell","/gists/powershell",{"title":319,"_path":320},"量子","/gists/quantum",{"title":322,"_path":323},"保持好奇心","/gists/questions",{"title":325,"_path":326},"React Native","/gists/react-native",{"title":328,"_path":329},"博客改版碰到的浏览器平滑滚动问题","/gists/scroll",{"title":331,"_path":332},"SEO","/gists/seo",{"title":334,"_path":335},"Shader","/gists/shader",{"title":337,"_path":338},"Shape Up","/gists/shape-up",{"title":340,"_path":341},"睡觉","/gists/sleep",{"title":343,"_path":344},"记录奇怪的问题","/gists/solved",{"title":346,"_path":347},"States","/gists/states",{"title":349,"_path":350},"Storage","/gists/storage",{"title":352,"_path":353},"音视频流处理","/gists/stream-cli",{"title":355,"_path":356},"Symbol","/gists/symbol",{"title":358,"_path":359},"系统论","/gists/systems-theory",{"title":361,"_path":362},"Taro","/gists/taro",{"title":364,"_path":365},"任务切片","/gists/task-slice",{"title":367,"_path":368},"技术偏好","/gists/tech-dudge",{"title":370,"_path":371},"Untitled","/gists/untitled",{"title":373,"_path":374},"可变字体","/gists/variable-font",{"title":376,"_path":377},"视觉错觉","/gists/visual-illusion",{"title":379,"_path":380},"SS(SSR)","/gists/vpn",{"title":382,"_path":383},"VS Code 插件开发","/gists/vscode-plugin",{"title":385,"_path":386},"Web Components","/gists/web-components",{"title":388,"_path":389},"Windows","/gists/windows",{"title":391,"_path":392},"查缺补漏","/gists/wrong",{"title":394,"_path":395,"children":396},"代码笔记 / Gists","/source-code",[397],{"title":398,"_path":395},"🚄 代码笔记",{"title":400,"_path":401,"children":402},"我 / Abount","/hire",[403],{"title":404,"_path":401},"📬 技术简历",{"title":406,"_path":407,"children":408},"todo","/todo",[409],{"title":406,"_path":407},{"_path":411,"_dir":412,"_draft":413,"_partial":414,"_locale":415,"title":416,"description":417,"body":418,"_type":5894,"_id":5895,"_source":5896,"_file":5897,"_stem":5898,"_extension":5899},"/_archieved/2019-05/reactive-in-150loc","2019-05",false,true,"","🚀 150 行代码带你实现小程序中的数据侦听","本文介绍了在 150 行代码内使用 defineProperty 实现一个简单的拥有事件发布订阅能力的状态管理库的思路。",{"type":419,"children":420,"toc":5872},"root",[421,429,444,449,728,740,745,750,755,760,773,1054,1067,1072,1079,1091,1345,1350,1733,1738,1743,1748,1905,2047,2052,2058,2063,2068,2077,2082,2090,2096,2101,2357,2362,2367,2840,2845,2874,3649,3655,3668,4004,4017,4030,4552,4557,4562,4567,4572,4585,5101,5106,5112,5117,5122,5346,5352,5357,5577,5701,5713,5843,5848,5853,5866],{"type":422,"tag":423,"props":424,"children":426},"element","h2",{"id":425},"前言",[427],{"type":428,"value":425},"text",{"type":422,"tag":430,"props":431,"children":432},"p",{},[433,435,442],{"type":428,"value":434},"在小程序项目中, 我们的通常会使用到使用到一个全局对象作为各个页面通用的数据存储容器, 将它绑定到 app 对象后, 就能在每一个页面都自由的操纵这个对象. 然而在实践中, 由于这个对象及其属性不具备响应式条件, 它不能直接参与业务逻辑的编写, 能力仅仅局限于数据储存. 若是在 VueJS 项目中, 我们可能经常使用到",{"type":422,"tag":436,"props":437,"children":439},"code",{"className":438},[],[440],{"type":428,"value":441},"Vue.$watch",{"type":428,"value":443},"去侦听某个数据是否发生变化, 小程序却缺乏这种能力.",{"type":422,"tag":430,"props":445,"children":446},{},[447],{"type":428,"value":448},"在这篇文章中, 我将用 150 行代码, 手把手带你打造一个小程序也可以使用的侦听器(下简称 VX):",{"type":422,"tag":450,"props":451,"children":455},"pre",{"className":452,"code":453,"language":454,"meta":415,"style":415},"language-js shiki shiki-themes material-theme-lighter github-light github-dark monokai","// 一个快速赋值的语法糖函数, 可以创建结构为 { value: a { b: { val: ''} } } 的对象\nvx.set('value.a.d', { val: '' })\n// 对某个属性进行侦听, 如果发生改变, 则执行相应函数(可多次watch以执行多个函数)\nvx.watch('value.a.d.val', newVal => {\n  console.log(`val改变为 : `, newVal)\n})\nvalue.a.d.val = 3 // val改编为 : 3\n","js",[456],{"type":422,"tag":436,"props":457,"children":458},{"__ignoreMap":415},[459,471,550,559,614,662,675],{"type":422,"tag":460,"props":461,"children":464},"span",{"class":462,"line":463},"line",1,[465],{"type":422,"tag":460,"props":466,"children":468},{"style":467},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit",[469],{"type":428,"value":470},"// 一个快速赋值的语法糖函数, 可以创建结构为 { value: a { b: { val: ''} } } 的对象\n",{"type":422,"tag":460,"props":472,"children":474},{"class":462,"line":473},2,[475,481,487,493,498,504,510,514,519,524,530,535,540,545],{"type":422,"tag":460,"props":476,"children":478},{"style":477},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[479],{"type":428,"value":480},"vx",{"type":422,"tag":460,"props":482,"children":484},{"style":483},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[485],{"type":428,"value":486},".",{"type":422,"tag":460,"props":488,"children":490},{"style":489},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[491],{"type":428,"value":492},"set",{"type":422,"tag":460,"props":494,"children":495},{"style":477},[496],{"type":428,"value":497},"(",{"type":422,"tag":460,"props":499,"children":501},{"style":500},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[502],{"type":428,"value":503},"'",{"type":422,"tag":460,"props":505,"children":507},{"style":506},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[508],{"type":428,"value":509},"value.a.d",{"type":422,"tag":460,"props":511,"children":512},{"style":500},[513],{"type":428,"value":503},{"type":422,"tag":460,"props":515,"children":516},{"style":483},[517],{"type":428,"value":518},",",{"type":422,"tag":460,"props":520,"children":521},{"style":483},[522],{"type":428,"value":523}," {",{"type":422,"tag":460,"props":525,"children":527},{"style":526},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[528],{"type":428,"value":529}," val",{"type":422,"tag":460,"props":531,"children":532},{"style":483},[533],{"type":428,"value":534},":",{"type":422,"tag":460,"props":536,"children":537},{"style":500},[538],{"type":428,"value":539}," ''",{"type":422,"tag":460,"props":541,"children":542},{"style":483},[543],{"type":428,"value":544}," }",{"type":422,"tag":460,"props":546,"children":547},{"style":477},[548],{"type":428,"value":549},")\n",{"type":422,"tag":460,"props":551,"children":553},{"class":462,"line":552},3,[554],{"type":422,"tag":460,"props":555,"children":556},{"style":467},[557],{"type":428,"value":558},"// 对某个属性进行侦听, 如果发生改变, 则执行相应函数(可多次watch以执行多个函数)\n",{"type":422,"tag":460,"props":560,"children":562},{"class":462,"line":561},4,[563,567,571,576,580,584,589,593,597,603,609],{"type":422,"tag":460,"props":564,"children":565},{"style":477},[566],{"type":428,"value":480},{"type":422,"tag":460,"props":568,"children":569},{"style":483},[570],{"type":428,"value":486},{"type":422,"tag":460,"props":572,"children":573},{"style":489},[574],{"type":428,"value":575},"watch",{"type":422,"tag":460,"props":577,"children":578},{"style":477},[579],{"type":428,"value":497},{"type":422,"tag":460,"props":581,"children":582},{"style":500},[583],{"type":428,"value":503},{"type":422,"tag":460,"props":585,"children":586},{"style":506},[587],{"type":428,"value":588},"value.a.d.val",{"type":422,"tag":460,"props":590,"children":591},{"style":500},[592],{"type":428,"value":503},{"type":422,"tag":460,"props":594,"children":595},{"style":483},[596],{"type":428,"value":518},{"type":422,"tag":460,"props":598,"children":600},{"style":599},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#E36209;--shiki-default-font-style:inherit;--shiki-dark:#FFAB70;--shiki-dark-font-style:inherit;--shiki-sepia:#FD971F;--shiki-sepia-font-style:italic",[601],{"type":428,"value":602}," newVal",{"type":422,"tag":460,"props":604,"children":606},{"style":605},"--shiki-light:#9C3EDA;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic",[607],{"type":428,"value":608}," =>",{"type":422,"tag":460,"props":610,"children":611},{"style":483},[612],{"type":428,"value":613}," {\n",{"type":422,"tag":460,"props":615,"children":617},{"class":462,"line":616},5,[618,623,627,632,636,641,646,650,654,658],{"type":422,"tag":460,"props":619,"children":620},{"style":477},[621],{"type":428,"value":622},"  console",{"type":422,"tag":460,"props":624,"children":625},{"style":483},[626],{"type":428,"value":486},{"type":422,"tag":460,"props":628,"children":629},{"style":489},[630],{"type":428,"value":631},"log",{"type":422,"tag":460,"props":633,"children":634},{"style":526},[635],{"type":428,"value":497},{"type":422,"tag":460,"props":637,"children":638},{"style":500},[639],{"type":428,"value":640},"`",{"type":422,"tag":460,"props":642,"children":643},{"style":506},[644],{"type":428,"value":645},"val改变为 : ",{"type":422,"tag":460,"props":647,"children":648},{"style":500},[649],{"type":428,"value":640},{"type":422,"tag":460,"props":651,"children":652},{"style":483},[653],{"type":428,"value":518},{"type":422,"tag":460,"props":655,"children":656},{"style":477},[657],{"type":428,"value":602},{"type":422,"tag":460,"props":659,"children":660},{"style":526},[661],{"type":428,"value":549},{"type":422,"tag":460,"props":663,"children":665},{"class":462,"line":664},6,[666,671],{"type":422,"tag":460,"props":667,"children":668},{"style":483},[669],{"type":428,"value":670},"}",{"type":422,"tag":460,"props":672,"children":673},{"style":477},[674],{"type":428,"value":549},{"type":422,"tag":460,"props":676,"children":678},{"class":462,"line":677},7,[679,684,688,693,697,702,706,711,717,723],{"type":422,"tag":460,"props":680,"children":681},{"style":477},[682],{"type":428,"value":683},"value",{"type":422,"tag":460,"props":685,"children":686},{"style":483},[687],{"type":428,"value":486},{"type":422,"tag":460,"props":689,"children":690},{"style":477},[691],{"type":428,"value":692},"a",{"type":422,"tag":460,"props":694,"children":695},{"style":483},[696],{"type":428,"value":486},{"type":422,"tag":460,"props":698,"children":699},{"style":477},[700],{"type":428,"value":701},"d",{"type":422,"tag":460,"props":703,"children":704},{"style":483},[705],{"type":428,"value":486},{"type":422,"tag":460,"props":707,"children":708},{"style":477},[709],{"type":428,"value":710},"val ",{"type":422,"tag":460,"props":712,"children":714},{"style":713},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[715],{"type":428,"value":716},"=",{"type":422,"tag":460,"props":718,"children":720},{"style":719},"--shiki-light:#F76D47;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[721],{"type":428,"value":722}," 3",{"type":422,"tag":460,"props":724,"children":725},{"style":467},[726],{"type":428,"value":727}," // val改编为 : 3\n",{"type":422,"tag":430,"props":729,"children":730},{},[731,733,738],{"type":428,"value":732},"使用 VX 侦听器, 我们可以更加方便的管理各个页面的状态. 同时, 我们凭借",{"type":422,"tag":436,"props":734,"children":736},{"className":735},[],[737],{"type":428,"value":575},{"type":428,"value":739},"语法, 可以更优雅地编写业务逻辑.",{"type":422,"tag":430,"props":741,"children":742},{},[743],{"type":428,"value":744},"坐稳了, 三轮车准备启动了~ 各位评论见~ 😋",{"type":422,"tag":423,"props":746,"children":748},{"id":747},"稍微理一理思路",[749],{"type":428,"value":747},{"type":422,"tag":430,"props":751,"children":752},{},[753],{"type":428,"value":754},"在全局对象中, 我们不一定要对每一个属性都进行侦听, 所以 VX 主要的功能就是通过 set 去设置某个具体属性的 setter/getter, 同时通过 watch 向添加该属性添加需要订阅的回调函数.",{"type":422,"tag":423,"props":756,"children":758},{"id":757},"依赖对象的实现",[759],{"type":428,"value":757},{"type":422,"tag":430,"props":761,"children":762},{},[763,765,771],{"type":428,"value":764},"首先我们需要造一个通用的",{"type":422,"tag":766,"props":767,"children":768},"strong",{},[769],{"type":428,"value":770},"依赖对象",{"type":428,"value":772},", 依赖对象携带一个订阅数组用于存放一组回调函数, 同时它还应该包括一些操作订阅数组能力(如添加订阅, 清空订阅)的函数",{"type":422,"tag":450,"props":774,"children":776},{"className":452,"code":775,"language":454,"meta":415,"style":415},"class Dep {\n  constructor () {\n    this.subs = []\n  }\n  // 将回调添加到数组中\n  addSub (fn) { /*...*/ }\n  delSub (fn) { /*...*/ }\n  // 执行数组中每一项函数\n  notify (newVal, oldVal) {\n    this.subs.forEach(func => func(newVal, oldVal))\n  }\n}\n",[777],{"type":422,"tag":436,"props":778,"children":779},{"__ignoreMap":415},[780,798,815,843,851,859,897,929,938,973,1037,1045],{"type":422,"tag":460,"props":781,"children":782},{"class":462,"line":463},[783,788,794],{"type":422,"tag":460,"props":784,"children":785},{"style":605},[786],{"type":428,"value":787},"class",{"type":422,"tag":460,"props":789,"children":791},{"style":790},"--shiki-light:#E2931D;--shiki-light-text-decoration:inherit;--shiki-default:#6F42C1;--shiki-default-text-decoration:inherit;--shiki-dark:#B392F0;--shiki-dark-text-decoration:inherit;--shiki-sepia:#A6E22E;--shiki-sepia-text-decoration:underline",[792],{"type":428,"value":793}," Dep",{"type":422,"tag":460,"props":795,"children":796},{"style":483},[797],{"type":428,"value":613},{"type":422,"tag":460,"props":799,"children":800},{"class":462,"line":473},[801,806,811],{"type":422,"tag":460,"props":802,"children":803},{"style":605},[804],{"type":428,"value":805},"  constructor",{"type":422,"tag":460,"props":807,"children":808},{"style":483},[809],{"type":428,"value":810}," ()",{"type":422,"tag":460,"props":812,"children":813},{"style":483},[814],{"type":428,"value":613},{"type":422,"tag":460,"props":816,"children":817},{"class":462,"line":552},[818,824,828,833,838],{"type":422,"tag":460,"props":819,"children":821},{"style":820},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[822],{"type":428,"value":823},"    this",{"type":422,"tag":460,"props":825,"children":826},{"style":483},[827],{"type":428,"value":486},{"type":422,"tag":460,"props":829,"children":830},{"style":477},[831],{"type":428,"value":832},"subs",{"type":422,"tag":460,"props":834,"children":835},{"style":713},[836],{"type":428,"value":837}," =",{"type":422,"tag":460,"props":839,"children":840},{"style":526},[841],{"type":428,"value":842}," []\n",{"type":422,"tag":460,"props":844,"children":845},{"class":462,"line":561},[846],{"type":422,"tag":460,"props":847,"children":848},{"style":483},[849],{"type":428,"value":850},"  }\n",{"type":422,"tag":460,"props":852,"children":853},{"class":462,"line":616},[854],{"type":422,"tag":460,"props":855,"children":856},{"style":467},[857],{"type":428,"value":858},"  // 将回调添加到数组中\n",{"type":422,"tag":460,"props":860,"children":861},{"class":462,"line":664},[862,868,873,878,883,887,892],{"type":422,"tag":460,"props":863,"children":865},{"style":864},"--shiki-light:#E53935;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[866],{"type":428,"value":867},"  addSub",{"type":422,"tag":460,"props":869,"children":870},{"style":483},[871],{"type":428,"value":872}," (",{"type":422,"tag":460,"props":874,"children":875},{"style":599},[876],{"type":428,"value":877},"fn",{"type":422,"tag":460,"props":879,"children":880},{"style":483},[881],{"type":428,"value":882},")",{"type":422,"tag":460,"props":884,"children":885},{"style":483},[886],{"type":428,"value":523},{"type":422,"tag":460,"props":888,"children":889},{"style":467},[890],{"type":428,"value":891}," /*...*/",{"type":422,"tag":460,"props":893,"children":894},{"style":483},[895],{"type":428,"value":896}," }\n",{"type":422,"tag":460,"props":898,"children":899},{"class":462,"line":677},[900,905,909,913,917,921,925],{"type":422,"tag":460,"props":901,"children":902},{"style":864},[903],{"type":428,"value":904},"  delSub",{"type":422,"tag":460,"props":906,"children":907},{"style":483},[908],{"type":428,"value":872},{"type":422,"tag":460,"props":910,"children":911},{"style":599},[912],{"type":428,"value":877},{"type":422,"tag":460,"props":914,"children":915},{"style":483},[916],{"type":428,"value":882},{"type":422,"tag":460,"props":918,"children":919},{"style":483},[920],{"type":428,"value":523},{"type":422,"tag":460,"props":922,"children":923},{"style":467},[924],{"type":428,"value":891},{"type":422,"tag":460,"props":926,"children":927},{"style":483},[928],{"type":428,"value":896},{"type":422,"tag":460,"props":930,"children":932},{"class":462,"line":931},8,[933],{"type":422,"tag":460,"props":934,"children":935},{"style":467},[936],{"type":428,"value":937},"  // 执行数组中每一项函数\n",{"type":422,"tag":460,"props":939,"children":941},{"class":462,"line":940},9,[942,947,951,956,960,965,969],{"type":422,"tag":460,"props":943,"children":944},{"style":864},[945],{"type":428,"value":946},"  notify",{"type":422,"tag":460,"props":948,"children":949},{"style":483},[950],{"type":428,"value":872},{"type":422,"tag":460,"props":952,"children":953},{"style":599},[954],{"type":428,"value":955},"newVal",{"type":422,"tag":460,"props":957,"children":958},{"style":483},[959],{"type":428,"value":518},{"type":422,"tag":460,"props":961,"children":962},{"style":599},[963],{"type":428,"value":964}," oldVal",{"type":422,"tag":460,"props":966,"children":967},{"style":483},[968],{"type":428,"value":882},{"type":422,"tag":460,"props":970,"children":971},{"style":483},[972],{"type":428,"value":613},{"type":422,"tag":460,"props":974,"children":976},{"class":462,"line":975},10,[977,981,985,989,993,998,1002,1007,1011,1016,1020,1024,1028,1032],{"type":422,"tag":460,"props":978,"children":979},{"style":820},[980],{"type":428,"value":823},{"type":422,"tag":460,"props":982,"children":983},{"style":483},[984],{"type":428,"value":486},{"type":422,"tag":460,"props":986,"children":987},{"style":477},[988],{"type":428,"value":832},{"type":422,"tag":460,"props":990,"children":991},{"style":483},[992],{"type":428,"value":486},{"type":422,"tag":460,"props":994,"children":995},{"style":489},[996],{"type":428,"value":997},"forEach",{"type":422,"tag":460,"props":999,"children":1000},{"style":526},[1001],{"type":428,"value":497},{"type":422,"tag":460,"props":1003,"children":1004},{"style":599},[1005],{"type":428,"value":1006},"func",{"type":422,"tag":460,"props":1008,"children":1009},{"style":605},[1010],{"type":428,"value":608},{"type":422,"tag":460,"props":1012,"children":1013},{"style":489},[1014],{"type":428,"value":1015}," func",{"type":422,"tag":460,"props":1017,"children":1018},{"style":526},[1019],{"type":428,"value":497},{"type":422,"tag":460,"props":1021,"children":1022},{"style":477},[1023],{"type":428,"value":955},{"type":422,"tag":460,"props":1025,"children":1026},{"style":483},[1027],{"type":428,"value":518},{"type":422,"tag":460,"props":1029,"children":1030},{"style":477},[1031],{"type":428,"value":964},{"type":422,"tag":460,"props":1033,"children":1034},{"style":526},[1035],{"type":428,"value":1036},"))\n",{"type":422,"tag":460,"props":1038,"children":1040},{"class":462,"line":1039},11,[1041],{"type":422,"tag":460,"props":1042,"children":1043},{"style":483},[1044],{"type":428,"value":850},{"type":422,"tag":460,"props":1046,"children":1048},{"class":462,"line":1047},12,[1049],{"type":422,"tag":460,"props":1050,"children":1051},{"style":483},[1052],{"type":428,"value":1053},"}\n",{"type":422,"tag":430,"props":1055,"children":1056},{},[1057,1059,1065],{"type":428,"value":1058},"全局对象中每一个响应式属性(及其每一个子属性), 都应该和一个新的 Dep 实例保持一一对应的关系, 这样我们进行侦听变化, 执行订阅的回调函数时, 只需要找到对应的实例执行",{"type":422,"tag":436,"props":1060,"children":1062},{"className":1061},[],[1063],{"type":428,"value":1064},"notify",{"type":428,"value":1066},"通知更新即可.",{"type":422,"tag":423,"props":1068,"children":1070},{"id":1069},"设置响应式属性",[1071],{"type":428,"value":1069},{"type":422,"tag":1073,"props":1074,"children":1076},"h3",{"id":1075},"defineproperty",[1077],{"type":428,"value":1078},"defineProperty",{"type":422,"tag":430,"props":1080,"children":1081},{},[1082,1084,1089],{"type":428,"value":1083},"可能是因为接触 DefineProperty 要比接触 Proxy 早一些的缘故, 代码使用了前者进行响应式的实现, Object.defineProperty 方法会直接在一个对象上定义一个新属性, 这里快速过一遍",{"type":422,"tag":436,"props":1085,"children":1087},{"className":1086},[],[1088],{"type":428,"value":1078},{"type":428,"value":1090},"具体配置:",{"type":422,"tag":450,"props":1092,"children":1094},{"className":452,"code":1093,"language":454,"meta":415,"style":415},"// @param obj 要在其上定义属性的对象\n// @param key 要定义或修改的属性的名称\nObject.defineProperty(obj, key, {\n  // 该属性是否能被枚举\n  enumerable: true,\n  // 该属性能否被删除\n  configurable: true,\n  // 访问该属性则会执行此方法\n  get: () => {\n    return val\n  },\n  // 修改该属性时会执行此方法\n  set: newVal => {\n    val = newVal\n  },\n  // value & writeble 不能和 getter/setter 同时出现\n})\n",[1095],{"type":422,"tag":436,"props":1096,"children":1097},{"__ignoreMap":415},[1098,1106,1114,1152,1160,1183,1191,1211,1219,1243,1257,1265,1273,1298,1316,1324,1333],{"type":422,"tag":460,"props":1099,"children":1100},{"class":462,"line":463},[1101],{"type":422,"tag":460,"props":1102,"children":1103},{"style":467},[1104],{"type":428,"value":1105},"// @param obj 要在其上定义属性的对象\n",{"type":422,"tag":460,"props":1107,"children":1108},{"class":462,"line":473},[1109],{"type":422,"tag":460,"props":1110,"children":1111},{"style":467},[1112],{"type":428,"value":1113},"// @param key 要定义或修改的属性的名称\n",{"type":422,"tag":460,"props":1115,"children":1116},{"class":462,"line":552},[1117,1122,1126,1130,1135,1139,1144,1148],{"type":422,"tag":460,"props":1118,"children":1119},{"style":477},[1120],{"type":428,"value":1121},"Object",{"type":422,"tag":460,"props":1123,"children":1124},{"style":483},[1125],{"type":428,"value":486},{"type":422,"tag":460,"props":1127,"children":1128},{"style":489},[1129],{"type":428,"value":1078},{"type":422,"tag":460,"props":1131,"children":1132},{"style":477},[1133],{"type":428,"value":1134},"(obj",{"type":422,"tag":460,"props":1136,"children":1137},{"style":483},[1138],{"type":428,"value":518},{"type":422,"tag":460,"props":1140,"children":1141},{"style":477},[1142],{"type":428,"value":1143}," key",{"type":422,"tag":460,"props":1145,"children":1146},{"style":483},[1147],{"type":428,"value":518},{"type":422,"tag":460,"props":1149,"children":1150},{"style":483},[1151],{"type":428,"value":613},{"type":422,"tag":460,"props":1153,"children":1154},{"class":462,"line":561},[1155],{"type":422,"tag":460,"props":1156,"children":1157},{"style":467},[1158],{"type":428,"value":1159},"  // 该属性是否能被枚举\n",{"type":422,"tag":460,"props":1161,"children":1162},{"class":462,"line":616},[1163,1168,1172,1178],{"type":422,"tag":460,"props":1164,"children":1165},{"style":526},[1166],{"type":428,"value":1167},"  enumerable",{"type":422,"tag":460,"props":1169,"children":1170},{"style":483},[1171],{"type":428,"value":534},{"type":422,"tag":460,"props":1173,"children":1175},{"style":1174},"--shiki-light:#FF5370;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[1176],{"type":428,"value":1177}," true",{"type":422,"tag":460,"props":1179,"children":1180},{"style":483},[1181],{"type":428,"value":1182},",\n",{"type":422,"tag":460,"props":1184,"children":1185},{"class":462,"line":664},[1186],{"type":422,"tag":460,"props":1187,"children":1188},{"style":467},[1189],{"type":428,"value":1190},"  // 该属性能否被删除\n",{"type":422,"tag":460,"props":1192,"children":1193},{"class":462,"line":677},[1194,1199,1203,1207],{"type":422,"tag":460,"props":1195,"children":1196},{"style":526},[1197],{"type":428,"value":1198},"  configurable",{"type":422,"tag":460,"props":1200,"children":1201},{"style":483},[1202],{"type":428,"value":534},{"type":422,"tag":460,"props":1204,"children":1205},{"style":1174},[1206],{"type":428,"value":1177},{"type":422,"tag":460,"props":1208,"children":1209},{"style":483},[1210],{"type":428,"value":1182},{"type":422,"tag":460,"props":1212,"children":1213},{"class":462,"line":931},[1214],{"type":422,"tag":460,"props":1215,"children":1216},{"style":467},[1217],{"type":428,"value":1218},"  // 访问该属性则会执行此方法\n",{"type":422,"tag":460,"props":1220,"children":1221},{"class":462,"line":940},[1222,1227,1231,1235,1239],{"type":422,"tag":460,"props":1223,"children":1224},{"style":489},[1225],{"type":428,"value":1226},"  get",{"type":422,"tag":460,"props":1228,"children":1229},{"style":483},[1230],{"type":428,"value":534},{"type":422,"tag":460,"props":1232,"children":1233},{"style":483},[1234],{"type":428,"value":810},{"type":422,"tag":460,"props":1236,"children":1237},{"style":605},[1238],{"type":428,"value":608},{"type":422,"tag":460,"props":1240,"children":1241},{"style":483},[1242],{"type":428,"value":613},{"type":422,"tag":460,"props":1244,"children":1245},{"class":462,"line":975},[1246,1252],{"type":422,"tag":460,"props":1247,"children":1249},{"style":1248},"--shiki-light:#39ADB5;--shiki-light-font-style:italic;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#F92672;--shiki-sepia-font-style:inherit",[1250],{"type":428,"value":1251},"    return",{"type":422,"tag":460,"props":1253,"children":1254},{"style":477},[1255],{"type":428,"value":1256}," val\n",{"type":422,"tag":460,"props":1258,"children":1259},{"class":462,"line":1039},[1260],{"type":422,"tag":460,"props":1261,"children":1262},{"style":483},[1263],{"type":428,"value":1264},"  },\n",{"type":422,"tag":460,"props":1266,"children":1267},{"class":462,"line":1047},[1268],{"type":422,"tag":460,"props":1269,"children":1270},{"style":467},[1271],{"type":428,"value":1272},"  // 修改该属性时会执行此方法\n",{"type":422,"tag":460,"props":1274,"children":1276},{"class":462,"line":1275},13,[1277,1282,1286,1290,1294],{"type":422,"tag":460,"props":1278,"children":1279},{"style":489},[1280],{"type":428,"value":1281},"  set",{"type":422,"tag":460,"props":1283,"children":1284},{"style":483},[1285],{"type":428,"value":534},{"type":422,"tag":460,"props":1287,"children":1288},{"style":599},[1289],{"type":428,"value":602},{"type":422,"tag":460,"props":1291,"children":1292},{"style":605},[1293],{"type":428,"value":608},{"type":422,"tag":460,"props":1295,"children":1296},{"style":483},[1297],{"type":428,"value":613},{"type":422,"tag":460,"props":1299,"children":1301},{"class":462,"line":1300},14,[1302,1307,1311],{"type":422,"tag":460,"props":1303,"children":1304},{"style":477},[1305],{"type":428,"value":1306},"    val",{"type":422,"tag":460,"props":1308,"children":1309},{"style":713},[1310],{"type":428,"value":837},{"type":422,"tag":460,"props":1312,"children":1313},{"style":477},[1314],{"type":428,"value":1315}," newVal\n",{"type":422,"tag":460,"props":1317,"children":1319},{"class":462,"line":1318},15,[1320],{"type":422,"tag":460,"props":1321,"children":1322},{"style":483},[1323],{"type":428,"value":1264},{"type":422,"tag":460,"props":1325,"children":1327},{"class":462,"line":1326},16,[1328],{"type":422,"tag":460,"props":1329,"children":1330},{"style":467},[1331],{"type":428,"value":1332},"  // value & writeble 不能和 getter/setter 同时出现\n",{"type":422,"tag":460,"props":1334,"children":1336},{"class":462,"line":1335},17,[1337,1341],{"type":422,"tag":460,"props":1338,"children":1339},{"style":483},[1340],{"type":428,"value":670},{"type":422,"tag":460,"props":1342,"children":1343},{"style":477},[1344],{"type":428,"value":549},{"type":422,"tag":430,"props":1346,"children":1347},{},[1348],{"type":428,"value":1349},"通过对 defineProperty 进行上层封装, 我们可以轻松的实现在全局对象上设置响应式属性功能, 在此, 我们结合刚才定义的 Dep 对象, 将一个新的 dep 实例绑定到新增属性的 setter 中:",{"type":422,"tag":450,"props":1351,"children":1353},{"className":452,"code":1352,"language":454,"meta":415,"style":415},"set (key, val, options = {}, obj = this.store) {\n  const dep = new Dep()\n  Object.defineProperty(obj, key, {\n    enumerable: true,\n    configurable: true,\n    get: () => {\n      return val\n    },\n    set: newVal => {\n      if (newVal === val) {\n        return\n      }\n      dep.notify(newVal, val)\n      val = newVal\n    }\n  })\n}\n",[1354],{"type":422,"tag":436,"props":1355,"children":1356},{"__ignoreMap":415},[1357,1423,1455,1496,1516,1536,1560,1572,1580,1604,1638,1646,1654,1690,1706,1714,1726],{"type":422,"tag":460,"props":1358,"children":1359},{"class":462,"line":463},[1360,1364,1369,1373,1377,1381,1386,1390,1395,1400,1404,1409,1413,1418],{"type":422,"tag":460,"props":1361,"children":1362},{"style":489},[1363],{"type":428,"value":492},{"type":422,"tag":460,"props":1365,"children":1366},{"style":477},[1367],{"type":428,"value":1368}," (key",{"type":422,"tag":460,"props":1370,"children":1371},{"style":483},[1372],{"type":428,"value":518},{"type":422,"tag":460,"props":1374,"children":1375},{"style":477},[1376],{"type":428,"value":529},{"type":422,"tag":460,"props":1378,"children":1379},{"style":483},[1380],{"type":428,"value":518},{"type":422,"tag":460,"props":1382,"children":1383},{"style":477},[1384],{"type":428,"value":1385}," options ",{"type":422,"tag":460,"props":1387,"children":1388},{"style":713},[1389],{"type":428,"value":716},{"type":422,"tag":460,"props":1391,"children":1392},{"style":483},[1393],{"type":428,"value":1394}," {},",{"type":422,"tag":460,"props":1396,"children":1397},{"style":477},[1398],{"type":428,"value":1399}," obj ",{"type":422,"tag":460,"props":1401,"children":1402},{"style":713},[1403],{"type":428,"value":716},{"type":422,"tag":460,"props":1405,"children":1406},{"style":820},[1407],{"type":428,"value":1408}," this",{"type":422,"tag":460,"props":1410,"children":1411},{"style":483},[1412],{"type":428,"value":486},{"type":422,"tag":460,"props":1414,"children":1415},{"style":477},[1416],{"type":428,"value":1417},"store) ",{"type":422,"tag":460,"props":1419,"children":1420},{"style":483},[1421],{"type":428,"value":1422},"{\n",{"type":422,"tag":460,"props":1424,"children":1425},{"class":462,"line":473},[1426,1431,1437,1441,1446,1450],{"type":422,"tag":460,"props":1427,"children":1428},{"style":605},[1429],{"type":428,"value":1430},"  const",{"type":422,"tag":460,"props":1432,"children":1434},{"style":1433},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#F8F8F2",[1435],{"type":428,"value":1436}," dep",{"type":422,"tag":460,"props":1438,"children":1439},{"style":713},[1440],{"type":428,"value":837},{"type":422,"tag":460,"props":1442,"children":1443},{"style":713},[1444],{"type":428,"value":1445}," new",{"type":422,"tag":460,"props":1447,"children":1448},{"style":489},[1449],{"type":428,"value":793},{"type":422,"tag":460,"props":1451,"children":1452},{"style":526},[1453],{"type":428,"value":1454},"()\n",{"type":422,"tag":460,"props":1456,"children":1457},{"class":462,"line":552},[1458,1463,1467,1471,1475,1480,1484,1488,1492],{"type":422,"tag":460,"props":1459,"children":1460},{"style":477},[1461],{"type":428,"value":1462},"  Object",{"type":422,"tag":460,"props":1464,"children":1465},{"style":483},[1466],{"type":428,"value":486},{"type":422,"tag":460,"props":1468,"children":1469},{"style":489},[1470],{"type":428,"value":1078},{"type":422,"tag":460,"props":1472,"children":1473},{"style":526},[1474],{"type":428,"value":497},{"type":422,"tag":460,"props":1476,"children":1477},{"style":477},[1478],{"type":428,"value":1479},"obj",{"type":422,"tag":460,"props":1481,"children":1482},{"style":483},[1483],{"type":428,"value":518},{"type":422,"tag":460,"props":1485,"children":1486},{"style":477},[1487],{"type":428,"value":1143},{"type":422,"tag":460,"props":1489,"children":1490},{"style":483},[1491],{"type":428,"value":518},{"type":422,"tag":460,"props":1493,"children":1494},{"style":483},[1495],{"type":428,"value":613},{"type":422,"tag":460,"props":1497,"children":1498},{"class":462,"line":561},[1499,1504,1508,1512],{"type":422,"tag":460,"props":1500,"children":1501},{"style":526},[1502],{"type":428,"value":1503},"    enumerable",{"type":422,"tag":460,"props":1505,"children":1506},{"style":483},[1507],{"type":428,"value":534},{"type":422,"tag":460,"props":1509,"children":1510},{"style":1174},[1511],{"type":428,"value":1177},{"type":422,"tag":460,"props":1513,"children":1514},{"style":483},[1515],{"type":428,"value":1182},{"type":422,"tag":460,"props":1517,"children":1518},{"class":462,"line":616},[1519,1524,1528,1532],{"type":422,"tag":460,"props":1520,"children":1521},{"style":526},[1522],{"type":428,"value":1523},"    configurable",{"type":422,"tag":460,"props":1525,"children":1526},{"style":483},[1527],{"type":428,"value":534},{"type":422,"tag":460,"props":1529,"children":1530},{"style":1174},[1531],{"type":428,"value":1177},{"type":422,"tag":460,"props":1533,"children":1534},{"style":483},[1535],{"type":428,"value":1182},{"type":422,"tag":460,"props":1537,"children":1538},{"class":462,"line":664},[1539,1544,1548,1552,1556],{"type":422,"tag":460,"props":1540,"children":1541},{"style":489},[1542],{"type":428,"value":1543},"    get",{"type":422,"tag":460,"props":1545,"children":1546},{"style":483},[1547],{"type":428,"value":534},{"type":422,"tag":460,"props":1549,"children":1550},{"style":483},[1551],{"type":428,"value":810},{"type":422,"tag":460,"props":1553,"children":1554},{"style":605},[1555],{"type":428,"value":608},{"type":422,"tag":460,"props":1557,"children":1558},{"style":483},[1559],{"type":428,"value":613},{"type":422,"tag":460,"props":1561,"children":1562},{"class":462,"line":677},[1563,1568],{"type":422,"tag":460,"props":1564,"children":1565},{"style":1248},[1566],{"type":428,"value":1567},"      return",{"type":422,"tag":460,"props":1569,"children":1570},{"style":477},[1571],{"type":428,"value":1256},{"type":422,"tag":460,"props":1573,"children":1574},{"class":462,"line":931},[1575],{"type":422,"tag":460,"props":1576,"children":1577},{"style":483},[1578],{"type":428,"value":1579},"    },\n",{"type":422,"tag":460,"props":1581,"children":1582},{"class":462,"line":940},[1583,1588,1592,1596,1600],{"type":422,"tag":460,"props":1584,"children":1585},{"style":489},[1586],{"type":428,"value":1587},"    set",{"type":422,"tag":460,"props":1589,"children":1590},{"style":483},[1591],{"type":428,"value":534},{"type":422,"tag":460,"props":1593,"children":1594},{"style":599},[1595],{"type":428,"value":602},{"type":422,"tag":460,"props":1597,"children":1598},{"style":605},[1599],{"type":428,"value":608},{"type":422,"tag":460,"props":1601,"children":1602},{"style":483},[1603],{"type":428,"value":613},{"type":422,"tag":460,"props":1605,"children":1606},{"class":462,"line":975},[1607,1612,1616,1620,1625,1629,1634],{"type":422,"tag":460,"props":1608,"children":1609},{"style":1248},[1610],{"type":428,"value":1611},"      if",{"type":422,"tag":460,"props":1613,"children":1614},{"style":526},[1615],{"type":428,"value":872},{"type":422,"tag":460,"props":1617,"children":1618},{"style":477},[1619],{"type":428,"value":955},{"type":422,"tag":460,"props":1621,"children":1622},{"style":713},[1623],{"type":428,"value":1624}," ===",{"type":422,"tag":460,"props":1626,"children":1627},{"style":477},[1628],{"type":428,"value":529},{"type":422,"tag":460,"props":1630,"children":1631},{"style":526},[1632],{"type":428,"value":1633},") ",{"type":422,"tag":460,"props":1635,"children":1636},{"style":483},[1637],{"type":428,"value":1422},{"type":422,"tag":460,"props":1639,"children":1640},{"class":462,"line":1039},[1641],{"type":422,"tag":460,"props":1642,"children":1643},{"style":1248},[1644],{"type":428,"value":1645},"        return\n",{"type":422,"tag":460,"props":1647,"children":1648},{"class":462,"line":1047},[1649],{"type":422,"tag":460,"props":1650,"children":1651},{"style":483},[1652],{"type":428,"value":1653},"      }\n",{"type":422,"tag":460,"props":1655,"children":1656},{"class":462,"line":1275},[1657,1662,1666,1670,1674,1678,1682,1686],{"type":422,"tag":460,"props":1658,"children":1659},{"style":477},[1660],{"type":428,"value":1661},"      dep",{"type":422,"tag":460,"props":1663,"children":1664},{"style":483},[1665],{"type":428,"value":486},{"type":422,"tag":460,"props":1667,"children":1668},{"style":489},[1669],{"type":428,"value":1064},{"type":422,"tag":460,"props":1671,"children":1672},{"style":526},[1673],{"type":428,"value":497},{"type":422,"tag":460,"props":1675,"children":1676},{"style":477},[1677],{"type":428,"value":955},{"type":422,"tag":460,"props":1679,"children":1680},{"style":483},[1681],{"type":428,"value":518},{"type":422,"tag":460,"props":1683,"children":1684},{"style":477},[1685],{"type":428,"value":529},{"type":422,"tag":460,"props":1687,"children":1688},{"style":526},[1689],{"type":428,"value":549},{"type":422,"tag":460,"props":1691,"children":1692},{"class":462,"line":1300},[1693,1698,1702],{"type":422,"tag":460,"props":1694,"children":1695},{"style":477},[1696],{"type":428,"value":1697},"      val",{"type":422,"tag":460,"props":1699,"children":1700},{"style":713},[1701],{"type":428,"value":837},{"type":422,"tag":460,"props":1703,"children":1704},{"style":477},[1705],{"type":428,"value":1315},{"type":422,"tag":460,"props":1707,"children":1708},{"class":462,"line":1318},[1709],{"type":422,"tag":460,"props":1710,"children":1711},{"style":483},[1712],{"type":428,"value":1713},"    }\n",{"type":422,"tag":460,"props":1715,"children":1716},{"class":462,"line":1326},[1717,1722],{"type":422,"tag":460,"props":1718,"children":1719},{"style":483},[1720],{"type":428,"value":1721},"  }",{"type":422,"tag":460,"props":1723,"children":1724},{"style":526},[1725],{"type":428,"value":549},{"type":422,"tag":460,"props":1727,"children":1728},{"class":462,"line":1335},[1729],{"type":422,"tag":460,"props":1730,"children":1731},{"style":483},[1732],{"type":428,"value":1053},{"type":422,"tag":430,"props":1734,"children":1735},{},[1736],{"type":428,"value":1737},"每当对应属性被赋值, 就会执行依赖数组中的回调函数.",{"type":422,"tag":430,"props":1739,"children":1740},{},[1741],{"type":428,"value":1742},"不过这样还不够, 我们还得想办法获取到这个 dep 实例, 才能给它的依赖数组填充函数.",{"type":422,"tag":430,"props":1744,"children":1745},{},[1746],{"type":428,"value":1747},"这边提供一个很简单的思路, 并不推荐实践中这么做:",{"type":422,"tag":450,"props":1749,"children":1751},{"className":452,"code":1750,"language":454,"meta":415,"style":415},"set (key, val, options = {}, obj = this.store) {\n  const dep = new Dep()\n  Object.defineProperty(obj, key, {})\n  return dep\n}\n",[1752],{"type":422,"tag":436,"props":1753,"children":1754},{"__ignoreMap":415},[1755,1814,1841,1885,1898],{"type":422,"tag":460,"props":1756,"children":1757},{"class":462,"line":463},[1758,1762,1766,1770,1774,1778,1782,1786,1790,1794,1798,1802,1806,1810],{"type":422,"tag":460,"props":1759,"children":1760},{"style":489},[1761],{"type":428,"value":492},{"type":422,"tag":460,"props":1763,"children":1764},{"style":477},[1765],{"type":428,"value":1368},{"type":422,"tag":460,"props":1767,"children":1768},{"style":483},[1769],{"type":428,"value":518},{"type":422,"tag":460,"props":1771,"children":1772},{"style":477},[1773],{"type":428,"value":529},{"type":422,"tag":460,"props":1775,"children":1776},{"style":483},[1777],{"type":428,"value":518},{"type":422,"tag":460,"props":1779,"children":1780},{"style":477},[1781],{"type":428,"value":1385},{"type":422,"tag":460,"props":1783,"children":1784},{"style":713},[1785],{"type":428,"value":716},{"type":422,"tag":460,"props":1787,"children":1788},{"style":483},[1789],{"type":428,"value":1394},{"type":422,"tag":460,"props":1791,"children":1792},{"style":477},[1793],{"type":428,"value":1399},{"type":422,"tag":460,"props":1795,"children":1796},{"style":713},[1797],{"type":428,"value":716},{"type":422,"tag":460,"props":1799,"children":1800},{"style":820},[1801],{"type":428,"value":1408},{"type":422,"tag":460,"props":1803,"children":1804},{"style":483},[1805],{"type":428,"value":486},{"type":422,"tag":460,"props":1807,"children":1808},{"style":477},[1809],{"type":428,"value":1417},{"type":422,"tag":460,"props":1811,"children":1812},{"style":483},[1813],{"type":428,"value":1422},{"type":422,"tag":460,"props":1815,"children":1816},{"class":462,"line":473},[1817,1821,1825,1829,1833,1837],{"type":422,"tag":460,"props":1818,"children":1819},{"style":605},[1820],{"type":428,"value":1430},{"type":422,"tag":460,"props":1822,"children":1823},{"style":1433},[1824],{"type":428,"value":1436},{"type":422,"tag":460,"props":1826,"children":1827},{"style":713},[1828],{"type":428,"value":837},{"type":422,"tag":460,"props":1830,"children":1831},{"style":713},[1832],{"type":428,"value":1445},{"type":422,"tag":460,"props":1834,"children":1835},{"style":489},[1836],{"type":428,"value":793},{"type":422,"tag":460,"props":1838,"children":1839},{"style":526},[1840],{"type":428,"value":1454},{"type":422,"tag":460,"props":1842,"children":1843},{"class":462,"line":552},[1844,1848,1852,1856,1860,1864,1868,1872,1876,1881],{"type":422,"tag":460,"props":1845,"children":1846},{"style":477},[1847],{"type":428,"value":1462},{"type":422,"tag":460,"props":1849,"children":1850},{"style":483},[1851],{"type":428,"value":486},{"type":422,"tag":460,"props":1853,"children":1854},{"style":489},[1855],{"type":428,"value":1078},{"type":422,"tag":460,"props":1857,"children":1858},{"style":526},[1859],{"type":428,"value":497},{"type":422,"tag":460,"props":1861,"children":1862},{"style":477},[1863],{"type":428,"value":1479},{"type":422,"tag":460,"props":1865,"children":1866},{"style":483},[1867],{"type":428,"value":518},{"type":422,"tag":460,"props":1869,"children":1870},{"style":477},[1871],{"type":428,"value":1143},{"type":422,"tag":460,"props":1873,"children":1874},{"style":483},[1875],{"type":428,"value":518},{"type":422,"tag":460,"props":1877,"children":1878},{"style":483},[1879],{"type":428,"value":1880}," {}",{"type":422,"tag":460,"props":1882,"children":1883},{"style":526},[1884],{"type":428,"value":549},{"type":422,"tag":460,"props":1886,"children":1887},{"class":462,"line":561},[1888,1893],{"type":422,"tag":460,"props":1889,"children":1890},{"style":1248},[1891],{"type":428,"value":1892},"  return",{"type":422,"tag":460,"props":1894,"children":1895},{"style":477},[1896],{"type":428,"value":1897}," dep\n",{"type":422,"tag":460,"props":1899,"children":1900},{"class":462,"line":616},[1901],{"type":422,"tag":460,"props":1902,"children":1903},{"style":483},[1904],{"type":428,"value":1053},{"type":422,"tag":450,"props":1906,"children":1908},{"className":452,"code":1907,"language":454,"meta":415,"style":415},"const valueDep = set('value', b, {})\nvalueDep.addSub(() => { console.log('value changed!') })\n",[1909],{"type":422,"tag":436,"props":1910,"children":1911},{"__ignoreMap":415},[1912,1971],{"type":422,"tag":460,"props":1913,"children":1914},{"class":462,"line":463},[1915,1920,1925,1929,1934,1938,1942,1946,1950,1954,1959,1963,1967],{"type":422,"tag":460,"props":1916,"children":1917},{"style":605},[1918],{"type":428,"value":1919},"const",{"type":422,"tag":460,"props":1921,"children":1922},{"style":1433},[1923],{"type":428,"value":1924}," valueDep",{"type":422,"tag":460,"props":1926,"children":1927},{"style":713},[1928],{"type":428,"value":837},{"type":422,"tag":460,"props":1930,"children":1931},{"style":489},[1932],{"type":428,"value":1933}," set",{"type":422,"tag":460,"props":1935,"children":1936},{"style":477},[1937],{"type":428,"value":497},{"type":422,"tag":460,"props":1939,"children":1940},{"style":500},[1941],{"type":428,"value":503},{"type":422,"tag":460,"props":1943,"children":1944},{"style":506},[1945],{"type":428,"value":683},{"type":422,"tag":460,"props":1947,"children":1948},{"style":500},[1949],{"type":428,"value":503},{"type":422,"tag":460,"props":1951,"children":1952},{"style":483},[1953],{"type":428,"value":518},{"type":422,"tag":460,"props":1955,"children":1956},{"style":477},[1957],{"type":428,"value":1958}," b",{"type":422,"tag":460,"props":1960,"children":1961},{"style":483},[1962],{"type":428,"value":518},{"type":422,"tag":460,"props":1964,"children":1965},{"style":483},[1966],{"type":428,"value":1880},{"type":422,"tag":460,"props":1968,"children":1969},{"style":477},[1970],{"type":428,"value":549},{"type":422,"tag":460,"props":1972,"children":1973},{"class":462,"line":473},[1974,1979,1983,1988,1992,1997,2001,2005,2010,2014,2018,2022,2026,2031,2035,2039,2043],{"type":422,"tag":460,"props":1975,"children":1976},{"style":477},[1977],{"type":428,"value":1978},"valueDep",{"type":422,"tag":460,"props":1980,"children":1981},{"style":483},[1982],{"type":428,"value":486},{"type":422,"tag":460,"props":1984,"children":1985},{"style":489},[1986],{"type":428,"value":1987},"addSub",{"type":422,"tag":460,"props":1989,"children":1990},{"style":477},[1991],{"type":428,"value":497},{"type":422,"tag":460,"props":1993,"children":1994},{"style":483},[1995],{"type":428,"value":1996},"()",{"type":422,"tag":460,"props":1998,"children":1999},{"style":605},[2000],{"type":428,"value":608},{"type":422,"tag":460,"props":2002,"children":2003},{"style":483},[2004],{"type":428,"value":523},{"type":422,"tag":460,"props":2006,"children":2007},{"style":477},[2008],{"type":428,"value":2009}," console",{"type":422,"tag":460,"props":2011,"children":2012},{"style":483},[2013],{"type":428,"value":486},{"type":422,"tag":460,"props":2015,"children":2016},{"style":489},[2017],{"type":428,"value":631},{"type":422,"tag":460,"props":2019,"children":2020},{"style":526},[2021],{"type":428,"value":497},{"type":422,"tag":460,"props":2023,"children":2024},{"style":500},[2025],{"type":428,"value":503},{"type":422,"tag":460,"props":2027,"children":2028},{"style":506},[2029],{"type":428,"value":2030},"value changed!",{"type":422,"tag":460,"props":2032,"children":2033},{"style":500},[2034],{"type":428,"value":503},{"type":422,"tag":460,"props":2036,"children":2037},{"style":526},[2038],{"type":428,"value":1633},{"type":422,"tag":460,"props":2040,"children":2041},{"style":483},[2042],{"type":428,"value":670},{"type":422,"tag":460,"props":2044,"children":2045},{"style":477},[2046],{"type":428,"value":549},{"type":422,"tag":430,"props":2048,"children":2049},{},[2050],{"type":428,"value":2051},"虽然代码能使用了, 就是是看起来怪怪的~ 😋 我们的三轮车开进了岔路~",{"type":422,"tag":423,"props":2053,"children":2055},{"id":2054},"通过-watch-添加订阅",[2056],{"type":428,"value":2057},"通过 watch 添加订阅",{"type":422,"tag":1073,"props":2059,"children":2061},{"id":2060},"喝口水我们继续",[2062],{"type":428,"value":2060},{"type":422,"tag":430,"props":2064,"children":2065},{},[2066],{"type":428,"value":2067},"《黑客与画家》中曾经提到这样一个观点, 我深有体会:",{"type":422,"tag":2069,"props":2070,"children":2071},"blockquote",{},[2072],{"type":422,"tag":430,"props":2073,"children":2074},{},[2075],{"type":428,"value":2076},"如果你觉得你的代码奇怪, 那么往往它是错的",{"type":422,"tag":430,"props":2078,"children":2079},{},[2080],{"type":428,"value":2081},"上面的那一串代码仅仅是能跑通的水平, 我们需要加入更多的细节和思考, 有时候只需要坐下来稍微看一下代码, 就会有各种想法蹦出来:",{"type":422,"tag":2069,"props":2083,"children":2084},{},[2085],{"type":422,"tag":430,"props":2086,"children":2087},{},[2088],{"type":428,"value":2089},"构思这种东西有一个特点，那就是它会导致更多的构思。你有没有注意过，坐下来写东西的时候，一半的构思是写作时产生的？",{"type":422,"tag":1073,"props":2091,"children":2093},{"id":2092},"隐藏-dep",[2094],{"type":428,"value":2095},"隐藏 Dep",{"type":422,"tag":430,"props":2097,"children":2098},{},[2099],{"type":428,"value":2100},"这些内容应和外部是解耦的. 首先一点, 我们创建一个侦听器类, 用于封装我们侦听所用到的所有方法, 它包含了我们想要的全局对象以及操作它的方法(如 watch,set):",{"type":422,"tag":450,"props":2102,"children":2104},{"className":452,"code":2103,"language":454,"meta":415,"style":415},"class VX {\n  constructor () {\n    this.store = Object.create(null)\n  }\n  watch (key, fn, obj = this.store) {}\n  set (key, val, options = {}, obj = this.store) {}\n}\nconst vx = new VX()\n",[2105],{"type":422,"tag":436,"props":2106,"children":2107},{"__ignoreMap":415},[2108,2124,2139,2187,2194,2254,2322,2329],{"type":422,"tag":460,"props":2109,"children":2110},{"class":462,"line":463},[2111,2115,2120],{"type":422,"tag":460,"props":2112,"children":2113},{"style":605},[2114],{"type":428,"value":787},{"type":422,"tag":460,"props":2116,"children":2117},{"style":790},[2118],{"type":428,"value":2119}," VX",{"type":422,"tag":460,"props":2121,"children":2122},{"style":483},[2123],{"type":428,"value":613},{"type":422,"tag":460,"props":2125,"children":2126},{"class":462,"line":473},[2127,2131,2135],{"type":422,"tag":460,"props":2128,"children":2129},{"style":605},[2130],{"type":428,"value":805},{"type":422,"tag":460,"props":2132,"children":2133},{"style":483},[2134],{"type":428,"value":810},{"type":422,"tag":460,"props":2136,"children":2137},{"style":483},[2138],{"type":428,"value":613},{"type":422,"tag":460,"props":2140,"children":2141},{"class":462,"line":552},[2142,2146,2150,2155,2159,2164,2168,2173,2177,2183],{"type":422,"tag":460,"props":2143,"children":2144},{"style":820},[2145],{"type":428,"value":823},{"type":422,"tag":460,"props":2147,"children":2148},{"style":483},[2149],{"type":428,"value":486},{"type":422,"tag":460,"props":2151,"children":2152},{"style":477},[2153],{"type":428,"value":2154},"store",{"type":422,"tag":460,"props":2156,"children":2157},{"style":713},[2158],{"type":428,"value":837},{"type":422,"tag":460,"props":2160,"children":2161},{"style":477},[2162],{"type":428,"value":2163}," Object",{"type":422,"tag":460,"props":2165,"children":2166},{"style":483},[2167],{"type":428,"value":486},{"type":422,"tag":460,"props":2169,"children":2170},{"style":489},[2171],{"type":428,"value":2172},"create",{"type":422,"tag":460,"props":2174,"children":2175},{"style":526},[2176],{"type":428,"value":497},{"type":422,"tag":460,"props":2178,"children":2180},{"style":2179},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[2181],{"type":428,"value":2182},"null",{"type":422,"tag":460,"props":2184,"children":2185},{"style":526},[2186],{"type":428,"value":549},{"type":422,"tag":460,"props":2188,"children":2189},{"class":462,"line":561},[2190],{"type":422,"tag":460,"props":2191,"children":2192},{"style":483},[2193],{"type":428,"value":850},{"type":422,"tag":460,"props":2195,"children":2196},{"class":462,"line":616},[2197,2202,2206,2211,2215,2220,2224,2229,2233,2237,2241,2245,2249],{"type":422,"tag":460,"props":2198,"children":2199},{"style":864},[2200],{"type":428,"value":2201},"  watch",{"type":422,"tag":460,"props":2203,"children":2204},{"style":483},[2205],{"type":428,"value":872},{"type":422,"tag":460,"props":2207,"children":2208},{"style":599},[2209],{"type":428,"value":2210},"key",{"type":422,"tag":460,"props":2212,"children":2213},{"style":483},[2214],{"type":428,"value":518},{"type":422,"tag":460,"props":2216,"children":2217},{"style":599},[2218],{"type":428,"value":2219}," fn",{"type":422,"tag":460,"props":2221,"children":2222},{"style":483},[2223],{"type":428,"value":518},{"type":422,"tag":460,"props":2225,"children":2226},{"style":599},[2227],{"type":428,"value":2228}," obj",{"type":422,"tag":460,"props":2230,"children":2231},{"style":713},[2232],{"type":428,"value":837},{"type":422,"tag":460,"props":2234,"children":2235},{"style":820},[2236],{"type":428,"value":1408},{"type":422,"tag":460,"props":2238,"children":2239},{"style":483},[2240],{"type":428,"value":486},{"type":422,"tag":460,"props":2242,"children":2243},{"style":477},[2244],{"type":428,"value":2154},{"type":422,"tag":460,"props":2246,"children":2247},{"style":483},[2248],{"type":428,"value":882},{"type":422,"tag":460,"props":2250,"children":2251},{"style":483},[2252],{"type":428,"value":2253}," {}\n",{"type":422,"tag":460,"props":2255,"children":2256},{"class":462,"line":664},[2257,2261,2265,2269,2273,2277,2281,2286,2290,2294,2298,2302,2306,2310,2314,2318],{"type":422,"tag":460,"props":2258,"children":2259},{"style":864},[2260],{"type":428,"value":1281},{"type":422,"tag":460,"props":2262,"children":2263},{"style":483},[2264],{"type":428,"value":872},{"type":422,"tag":460,"props":2266,"children":2267},{"style":599},[2268],{"type":428,"value":2210},{"type":422,"tag":460,"props":2270,"children":2271},{"style":483},[2272],{"type":428,"value":518},{"type":422,"tag":460,"props":2274,"children":2275},{"style":599},[2276],{"type":428,"value":529},{"type":422,"tag":460,"props":2278,"children":2279},{"style":483},[2280],{"type":428,"value":518},{"type":422,"tag":460,"props":2282,"children":2283},{"style":599},[2284],{"type":428,"value":2285}," options",{"type":422,"tag":460,"props":2287,"children":2288},{"style":713},[2289],{"type":428,"value":837},{"type":422,"tag":460,"props":2291,"children":2292},{"style":483},[2293],{"type":428,"value":1394},{"type":422,"tag":460,"props":2295,"children":2296},{"style":599},[2297],{"type":428,"value":2228},{"type":422,"tag":460,"props":2299,"children":2300},{"style":713},[2301],{"type":428,"value":837},{"type":422,"tag":460,"props":2303,"children":2304},{"style":820},[2305],{"type":428,"value":1408},{"type":422,"tag":460,"props":2307,"children":2308},{"style":483},[2309],{"type":428,"value":486},{"type":422,"tag":460,"props":2311,"children":2312},{"style":477},[2313],{"type":428,"value":2154},{"type":422,"tag":460,"props":2315,"children":2316},{"style":483},[2317],{"type":428,"value":882},{"type":422,"tag":460,"props":2319,"children":2320},{"style":483},[2321],{"type":428,"value":2253},{"type":422,"tag":460,"props":2323,"children":2324},{"class":462,"line":677},[2325],{"type":422,"tag":460,"props":2326,"children":2327},{"style":483},[2328],{"type":428,"value":1053},{"type":422,"tag":460,"props":2330,"children":2331},{"class":462,"line":931},[2332,2336,2341,2345,2349,2353],{"type":422,"tag":460,"props":2333,"children":2334},{"style":605},[2335],{"type":428,"value":1919},{"type":422,"tag":460,"props":2337,"children":2338},{"style":1433},[2339],{"type":428,"value":2340}," vx",{"type":422,"tag":460,"props":2342,"children":2343},{"style":713},[2344],{"type":428,"value":837},{"type":422,"tag":460,"props":2346,"children":2347},{"style":713},[2348],{"type":428,"value":1445},{"type":422,"tag":460,"props":2350,"children":2351},{"style":489},[2352],{"type":428,"value":2119},{"type":422,"tag":460,"props":2354,"children":2355},{"style":477},[2356],{"type":428,"value":1454},{"type":422,"tag":430,"props":2358,"children":2359},{},[2360],{"type":428,"value":2361},"我们可以在 watch 中给对象某个属性添加回调, 就不用去直接操作 Dep 依赖数组了. 只是, 我们在业务代码中调用 watch, 要怎么去获取 obj.key 对应的 dep 呢?",{"type":422,"tag":430,"props":2363,"children":2364},{},[2365],{"type":428,"value":2366},"我们设置一个全局的 depHandler, 在 obj.key 的 getter 中主动将 depHandler 设置为当前 obj.key 的 dep 实例, 那么我们在 watch 函数里, 只要用任意操作触发 obj.key 的 getter, 就能通过 depHandler 得到它的 dep 实例了, 代码形如:",{"type":422,"tag":450,"props":2368,"children":2370},{"className":452,"code":2369,"language":454,"meta":415,"style":415},"  // 一开始没有持有dep实例\n  let handleDep = null\n  class VX {\n    watch (key, fn, obj = this.store) {\n      console.log(obj.key) // 使用任意操作触发obj.key的getter, 那么handleDep将自动引用obj.key的dep实例\n      handleDep.addSub(fn)\n    }\n    set (key, val, options = {}, obj = this.store) {\n      const dep = new Dep()\n      Object.defineProperty(obj, key, {\n        enumerable: true,\n        configurable: true,\n        get: () => {\n          handleDep = dep\n          return val\n        },\n        set: newVal => {}\n      })\n    }\n  }\n",[2371],{"type":422,"tag":436,"props":2372,"children":2373},{"__ignoreMap":415},[2374,2382,2404,2420,2476,2517,2545,2552,2619,2647,2687,2707,2727,2751,2767,2779,2787,2811,2824,2832],{"type":422,"tag":460,"props":2375,"children":2376},{"class":462,"line":463},[2377],{"type":422,"tag":460,"props":2378,"children":2379},{"style":467},[2380],{"type":428,"value":2381},"  // 一开始没有持有dep实例\n",{"type":422,"tag":460,"props":2383,"children":2384},{"class":462,"line":473},[2385,2390,2395,2399],{"type":422,"tag":460,"props":2386,"children":2387},{"style":605},[2388],{"type":428,"value":2389},"  let",{"type":422,"tag":460,"props":2391,"children":2392},{"style":477},[2393],{"type":428,"value":2394}," handleDep ",{"type":422,"tag":460,"props":2396,"children":2397},{"style":713},[2398],{"type":428,"value":716},{"type":422,"tag":460,"props":2400,"children":2401},{"style":2179},[2402],{"type":428,"value":2403}," null\n",{"type":422,"tag":460,"props":2405,"children":2406},{"class":462,"line":552},[2407,2412,2416],{"type":422,"tag":460,"props":2408,"children":2409},{"style":605},[2410],{"type":428,"value":2411},"  class",{"type":422,"tag":460,"props":2413,"children":2414},{"style":790},[2415],{"type":428,"value":2119},{"type":422,"tag":460,"props":2417,"children":2418},{"style":483},[2419],{"type":428,"value":613},{"type":422,"tag":460,"props":2421,"children":2422},{"class":462,"line":561},[2423,2428,2432,2436,2440,2444,2448,2452,2456,2460,2464,2468,2472],{"type":422,"tag":460,"props":2424,"children":2425},{"style":864},[2426],{"type":428,"value":2427},"    watch",{"type":422,"tag":460,"props":2429,"children":2430},{"style":483},[2431],{"type":428,"value":872},{"type":422,"tag":460,"props":2433,"children":2434},{"style":599},[2435],{"type":428,"value":2210},{"type":422,"tag":460,"props":2437,"children":2438},{"style":483},[2439],{"type":428,"value":518},{"type":422,"tag":460,"props":2441,"children":2442},{"style":599},[2443],{"type":428,"value":2219},{"type":422,"tag":460,"props":2445,"children":2446},{"style":483},[2447],{"type":428,"value":518},{"type":422,"tag":460,"props":2449,"children":2450},{"style":599},[2451],{"type":428,"value":2228},{"type":422,"tag":460,"props":2453,"children":2454},{"style":713},[2455],{"type":428,"value":837},{"type":422,"tag":460,"props":2457,"children":2458},{"style":820},[2459],{"type":428,"value":1408},{"type":422,"tag":460,"props":2461,"children":2462},{"style":483},[2463],{"type":428,"value":486},{"type":422,"tag":460,"props":2465,"children":2466},{"style":477},[2467],{"type":428,"value":2154},{"type":422,"tag":460,"props":2469,"children":2470},{"style":483},[2471],{"type":428,"value":882},{"type":422,"tag":460,"props":2473,"children":2474},{"style":483},[2475],{"type":428,"value":613},{"type":422,"tag":460,"props":2477,"children":2478},{"class":462,"line":616},[2479,2484,2488,2492,2496,2500,2504,2508,2512],{"type":422,"tag":460,"props":2480,"children":2481},{"style":477},[2482],{"type":428,"value":2483},"      console",{"type":422,"tag":460,"props":2485,"children":2486},{"style":483},[2487],{"type":428,"value":486},{"type":422,"tag":460,"props":2489,"children":2490},{"style":489},[2491],{"type":428,"value":631},{"type":422,"tag":460,"props":2493,"children":2494},{"style":526},[2495],{"type":428,"value":497},{"type":422,"tag":460,"props":2497,"children":2498},{"style":477},[2499],{"type":428,"value":1479},{"type":422,"tag":460,"props":2501,"children":2502},{"style":483},[2503],{"type":428,"value":486},{"type":422,"tag":460,"props":2505,"children":2506},{"style":477},[2507],{"type":428,"value":2210},{"type":422,"tag":460,"props":2509,"children":2510},{"style":526},[2511],{"type":428,"value":1633},{"type":422,"tag":460,"props":2513,"children":2514},{"style":467},[2515],{"type":428,"value":2516},"// 使用任意操作触发obj.key的getter, 那么handleDep将自动引用obj.key的dep实例\n",{"type":422,"tag":460,"props":2518,"children":2519},{"class":462,"line":664},[2520,2525,2529,2533,2537,2541],{"type":422,"tag":460,"props":2521,"children":2522},{"style":477},[2523],{"type":428,"value":2524},"      handleDep",{"type":422,"tag":460,"props":2526,"children":2527},{"style":483},[2528],{"type":428,"value":486},{"type":422,"tag":460,"props":2530,"children":2531},{"style":489},[2532],{"type":428,"value":1987},{"type":422,"tag":460,"props":2534,"children":2535},{"style":526},[2536],{"type":428,"value":497},{"type":422,"tag":460,"props":2538,"children":2539},{"style":477},[2540],{"type":428,"value":877},{"type":422,"tag":460,"props":2542,"children":2543},{"style":526},[2544],{"type":428,"value":549},{"type":422,"tag":460,"props":2546,"children":2547},{"class":462,"line":677},[2548],{"type":422,"tag":460,"props":2549,"children":2550},{"style":483},[2551],{"type":428,"value":1713},{"type":422,"tag":460,"props":2553,"children":2554},{"class":462,"line":931},[2555,2559,2563,2567,2571,2575,2579,2583,2587,2591,2595,2599,2603,2607,2611,2615],{"type":422,"tag":460,"props":2556,"children":2557},{"style":864},[2558],{"type":428,"value":1587},{"type":422,"tag":460,"props":2560,"children":2561},{"style":483},[2562],{"type":428,"value":872},{"type":422,"tag":460,"props":2564,"children":2565},{"style":599},[2566],{"type":428,"value":2210},{"type":422,"tag":460,"props":2568,"children":2569},{"style":483},[2570],{"type":428,"value":518},{"type":422,"tag":460,"props":2572,"children":2573},{"style":599},[2574],{"type":428,"value":529},{"type":422,"tag":460,"props":2576,"children":2577},{"style":483},[2578],{"type":428,"value":518},{"type":422,"tag":460,"props":2580,"children":2581},{"style":599},[2582],{"type":428,"value":2285},{"type":422,"tag":460,"props":2584,"children":2585},{"style":713},[2586],{"type":428,"value":837},{"type":422,"tag":460,"props":2588,"children":2589},{"style":483},[2590],{"type":428,"value":1394},{"type":422,"tag":460,"props":2592,"children":2593},{"style":599},[2594],{"type":428,"value":2228},{"type":422,"tag":460,"props":2596,"children":2597},{"style":713},[2598],{"type":428,"value":837},{"type":422,"tag":460,"props":2600,"children":2601},{"style":820},[2602],{"type":428,"value":1408},{"type":422,"tag":460,"props":2604,"children":2605},{"style":483},[2606],{"type":428,"value":486},{"type":422,"tag":460,"props":2608,"children":2609},{"style":477},[2610],{"type":428,"value":2154},{"type":422,"tag":460,"props":2612,"children":2613},{"style":483},[2614],{"type":428,"value":882},{"type":422,"tag":460,"props":2616,"children":2617},{"style":483},[2618],{"type":428,"value":613},{"type":422,"tag":460,"props":2620,"children":2621},{"class":462,"line":940},[2622,2627,2631,2635,2639,2643],{"type":422,"tag":460,"props":2623,"children":2624},{"style":605},[2625],{"type":428,"value":2626},"      const",{"type":422,"tag":460,"props":2628,"children":2629},{"style":1433},[2630],{"type":428,"value":1436},{"type":422,"tag":460,"props":2632,"children":2633},{"style":713},[2634],{"type":428,"value":837},{"type":422,"tag":460,"props":2636,"children":2637},{"style":713},[2638],{"type":428,"value":1445},{"type":422,"tag":460,"props":2640,"children":2641},{"style":489},[2642],{"type":428,"value":793},{"type":422,"tag":460,"props":2644,"children":2645},{"style":526},[2646],{"type":428,"value":1454},{"type":422,"tag":460,"props":2648,"children":2649},{"class":462,"line":975},[2650,2655,2659,2663,2667,2671,2675,2679,2683],{"type":422,"tag":460,"props":2651,"children":2652},{"style":477},[2653],{"type":428,"value":2654},"      Object",{"type":422,"tag":460,"props":2656,"children":2657},{"style":483},[2658],{"type":428,"value":486},{"type":422,"tag":460,"props":2660,"children":2661},{"style":489},[2662],{"type":428,"value":1078},{"type":422,"tag":460,"props":2664,"children":2665},{"style":526},[2666],{"type":428,"value":497},{"type":422,"tag":460,"props":2668,"children":2669},{"style":477},[2670],{"type":428,"value":1479},{"type":422,"tag":460,"props":2672,"children":2673},{"style":483},[2674],{"type":428,"value":518},{"type":422,"tag":460,"props":2676,"children":2677},{"style":477},[2678],{"type":428,"value":1143},{"type":422,"tag":460,"props":2680,"children":2681},{"style":483},[2682],{"type":428,"value":518},{"type":422,"tag":460,"props":2684,"children":2685},{"style":483},[2686],{"type":428,"value":613},{"type":422,"tag":460,"props":2688,"children":2689},{"class":462,"line":1039},[2690,2695,2699,2703],{"type":422,"tag":460,"props":2691,"children":2692},{"style":526},[2693],{"type":428,"value":2694},"        enumerable",{"type":422,"tag":460,"props":2696,"children":2697},{"style":483},[2698],{"type":428,"value":534},{"type":422,"tag":460,"props":2700,"children":2701},{"style":1174},[2702],{"type":428,"value":1177},{"type":422,"tag":460,"props":2704,"children":2705},{"style":483},[2706],{"type":428,"value":1182},{"type":422,"tag":460,"props":2708,"children":2709},{"class":462,"line":1047},[2710,2715,2719,2723],{"type":422,"tag":460,"props":2711,"children":2712},{"style":526},[2713],{"type":428,"value":2714},"        configurable",{"type":422,"tag":460,"props":2716,"children":2717},{"style":483},[2718],{"type":428,"value":534},{"type":422,"tag":460,"props":2720,"children":2721},{"style":1174},[2722],{"type":428,"value":1177},{"type":422,"tag":460,"props":2724,"children":2725},{"style":483},[2726],{"type":428,"value":1182},{"type":422,"tag":460,"props":2728,"children":2729},{"class":462,"line":1275},[2730,2735,2739,2743,2747],{"type":422,"tag":460,"props":2731,"children":2732},{"style":489},[2733],{"type":428,"value":2734},"        get",{"type":422,"tag":460,"props":2736,"children":2737},{"style":483},[2738],{"type":428,"value":534},{"type":422,"tag":460,"props":2740,"children":2741},{"style":483},[2742],{"type":428,"value":810},{"type":422,"tag":460,"props":2744,"children":2745},{"style":605},[2746],{"type":428,"value":608},{"type":422,"tag":460,"props":2748,"children":2749},{"style":483},[2750],{"type":428,"value":613},{"type":422,"tag":460,"props":2752,"children":2753},{"class":462,"line":1300},[2754,2759,2763],{"type":422,"tag":460,"props":2755,"children":2756},{"style":477},[2757],{"type":428,"value":2758},"          handleDep",{"type":422,"tag":460,"props":2760,"children":2761},{"style":713},[2762],{"type":428,"value":837},{"type":422,"tag":460,"props":2764,"children":2765},{"style":477},[2766],{"type":428,"value":1897},{"type":422,"tag":460,"props":2768,"children":2769},{"class":462,"line":1318},[2770,2775],{"type":422,"tag":460,"props":2771,"children":2772},{"style":1248},[2773],{"type":428,"value":2774},"          return",{"type":422,"tag":460,"props":2776,"children":2777},{"style":477},[2778],{"type":428,"value":1256},{"type":422,"tag":460,"props":2780,"children":2781},{"class":462,"line":1326},[2782],{"type":422,"tag":460,"props":2783,"children":2784},{"style":483},[2785],{"type":428,"value":2786},"        },\n",{"type":422,"tag":460,"props":2788,"children":2789},{"class":462,"line":1335},[2790,2795,2799,2803,2807],{"type":422,"tag":460,"props":2791,"children":2792},{"style":489},[2793],{"type":428,"value":2794},"        set",{"type":422,"tag":460,"props":2796,"children":2797},{"style":483},[2798],{"type":428,"value":534},{"type":422,"tag":460,"props":2800,"children":2801},{"style":599},[2802],{"type":428,"value":602},{"type":422,"tag":460,"props":2804,"children":2805},{"style":605},[2806],{"type":428,"value":608},{"type":422,"tag":460,"props":2808,"children":2809},{"style":483},[2810],{"type":428,"value":2253},{"type":422,"tag":460,"props":2812,"children":2814},{"class":462,"line":2813},18,[2815,2820],{"type":422,"tag":460,"props":2816,"children":2817},{"style":483},[2818],{"type":428,"value":2819},"      }",{"type":422,"tag":460,"props":2821,"children":2822},{"style":526},[2823],{"type":428,"value":549},{"type":422,"tag":460,"props":2825,"children":2827},{"class":462,"line":2826},19,[2828],{"type":422,"tag":460,"props":2829,"children":2830},{"style":483},[2831],{"type":428,"value":1713},{"type":422,"tag":460,"props":2833,"children":2835},{"class":462,"line":2834},20,[2836],{"type":422,"tag":460,"props":2837,"children":2838},{"style":483},[2839],{"type":428,"value":850},{"type":422,"tag":1073,"props":2841,"children":2843},{"id":2842},"主动收集依赖",[2844],{"type":428,"value":2842},{"type":422,"tag":430,"props":2846,"children":2847},{},[2848,2850,2856,2858,2864,2866,2872],{"type":428,"value":2849},"我们增加",{"type":422,"tag":436,"props":2851,"children":2853},{"className":2852},[],[2854],{"type":428,"value":2855},"handleDep.addSub(fn)",{"type":428,"value":2857},"添加回调函数的逻辑, 其实可以直接放到 getter 中, 首先在 Dep 类中封装一个'主动'收集依赖的",{"type":422,"tag":436,"props":2859,"children":2861},{"className":2860},[],[2862],{"type":428,"value":2863},"collect",{"type":428,"value":2865},"方法, 他会将全局",{"type":422,"tag":436,"props":2867,"children":2869},{"className":2868},[],[2870],{"type":428,"value":2871},"handleFn",{"type":428,"value":2873},"存放到订阅数组中, 这样一来, 在 watch 函数中, 我们只要触发 obj.key 的 getter, 就可以主动收集依赖了:",{"type":422,"tag":450,"props":2875,"children":2877},{"className":452,"code":2876,"language":454,"meta":415,"style":415},"let handleFn = null\nclass Dep {\n  addSub (fn) {}\n  delSub (fn) {}\n  clear () {}\n  collect (fn = handleFn) {\n    if (fn && !this.subs.find(x => x === fn)) {\n      this.addSub(fn)\n    }\n  }\n  notify (newVal, oldVal) {}\n}\n\nlet handleDep = null\nclass VX {\n  watch (key, fn, obj = this.store) {\n    handleFn = fn\n    console.log(obj.key)\n  }\n  set (key, val, options = {}, obj = this.store) {\n    const dep = new Dep()\n    Object.defineProperty(obj, key, {\n      enumerable: true,\n      configurable: true,\n      get: () => {\n        handleDep = dep\n        handleDep.collect()\n        return val\n      },\n      set: newVal => {}\n    })\n  }\n}\n",[2878],{"type":422,"tag":436,"props":2879,"children":2880},{"__ignoreMap":415},[2881,2902,2917,2940,2963,2979,3012,3095,3123,3130,3137,3168,3175,3183,3202,3217,3272,3289,3325,3332,3399,3428,3469,3490,3511,3536,3553,3573,3586,3595,3620,3633,3641],{"type":422,"tag":460,"props":2882,"children":2883},{"class":462,"line":463},[2884,2889,2894,2898],{"type":422,"tag":460,"props":2885,"children":2886},{"style":605},[2887],{"type":428,"value":2888},"let",{"type":422,"tag":460,"props":2890,"children":2891},{"style":477},[2892],{"type":428,"value":2893}," handleFn ",{"type":422,"tag":460,"props":2895,"children":2896},{"style":713},[2897],{"type":428,"value":716},{"type":422,"tag":460,"props":2899,"children":2900},{"style":2179},[2901],{"type":428,"value":2403},{"type":422,"tag":460,"props":2903,"children":2904},{"class":462,"line":473},[2905,2909,2913],{"type":422,"tag":460,"props":2906,"children":2907},{"style":605},[2908],{"type":428,"value":787},{"type":422,"tag":460,"props":2910,"children":2911},{"style":790},[2912],{"type":428,"value":793},{"type":422,"tag":460,"props":2914,"children":2915},{"style":483},[2916],{"type":428,"value":613},{"type":422,"tag":460,"props":2918,"children":2919},{"class":462,"line":552},[2920,2924,2928,2932,2936],{"type":422,"tag":460,"props":2921,"children":2922},{"style":864},[2923],{"type":428,"value":867},{"type":422,"tag":460,"props":2925,"children":2926},{"style":483},[2927],{"type":428,"value":872},{"type":422,"tag":460,"props":2929,"children":2930},{"style":599},[2931],{"type":428,"value":877},{"type":422,"tag":460,"props":2933,"children":2934},{"style":483},[2935],{"type":428,"value":882},{"type":422,"tag":460,"props":2937,"children":2938},{"style":483},[2939],{"type":428,"value":2253},{"type":422,"tag":460,"props":2941,"children":2942},{"class":462,"line":561},[2943,2947,2951,2955,2959],{"type":422,"tag":460,"props":2944,"children":2945},{"style":864},[2946],{"type":428,"value":904},{"type":422,"tag":460,"props":2948,"children":2949},{"style":483},[2950],{"type":428,"value":872},{"type":422,"tag":460,"props":2952,"children":2953},{"style":599},[2954],{"type":428,"value":877},{"type":422,"tag":460,"props":2956,"children":2957},{"style":483},[2958],{"type":428,"value":882},{"type":422,"tag":460,"props":2960,"children":2961},{"style":483},[2962],{"type":428,"value":2253},{"type":422,"tag":460,"props":2964,"children":2965},{"class":462,"line":616},[2966,2971,2975],{"type":422,"tag":460,"props":2967,"children":2968},{"style":864},[2969],{"type":428,"value":2970},"  clear",{"type":422,"tag":460,"props":2972,"children":2973},{"style":483},[2974],{"type":428,"value":810},{"type":422,"tag":460,"props":2976,"children":2977},{"style":483},[2978],{"type":428,"value":2253},{"type":422,"tag":460,"props":2980,"children":2981},{"class":462,"line":664},[2982,2987,2991,2995,2999,3004,3008],{"type":422,"tag":460,"props":2983,"children":2984},{"style":864},[2985],{"type":428,"value":2986},"  collect",{"type":422,"tag":460,"props":2988,"children":2989},{"style":483},[2990],{"type":428,"value":872},{"type":422,"tag":460,"props":2992,"children":2993},{"style":599},[2994],{"type":428,"value":877},{"type":422,"tag":460,"props":2996,"children":2997},{"style":713},[2998],{"type":428,"value":837},{"type":422,"tag":460,"props":3000,"children":3001},{"style":477},[3002],{"type":428,"value":3003}," handleFn",{"type":422,"tag":460,"props":3005,"children":3006},{"style":483},[3007],{"type":428,"value":882},{"type":422,"tag":460,"props":3009,"children":3010},{"style":483},[3011],{"type":428,"value":613},{"type":422,"tag":460,"props":3013,"children":3014},{"class":462,"line":677},[3015,3020,3024,3028,3033,3038,3043,3047,3051,3055,3060,3064,3069,3073,3078,3082,3086,3091],{"type":422,"tag":460,"props":3016,"children":3017},{"style":1248},[3018],{"type":428,"value":3019},"    if",{"type":422,"tag":460,"props":3021,"children":3022},{"style":526},[3023],{"type":428,"value":872},{"type":422,"tag":460,"props":3025,"children":3026},{"style":477},[3027],{"type":428,"value":877},{"type":422,"tag":460,"props":3029,"children":3030},{"style":713},[3031],{"type":428,"value":3032}," &&",{"type":422,"tag":460,"props":3034,"children":3035},{"style":713},[3036],{"type":428,"value":3037}," !",{"type":422,"tag":460,"props":3039,"children":3040},{"style":820},[3041],{"type":428,"value":3042},"this",{"type":422,"tag":460,"props":3044,"children":3045},{"style":483},[3046],{"type":428,"value":486},{"type":422,"tag":460,"props":3048,"children":3049},{"style":477},[3050],{"type":428,"value":832},{"type":422,"tag":460,"props":3052,"children":3053},{"style":483},[3054],{"type":428,"value":486},{"type":422,"tag":460,"props":3056,"children":3057},{"style":489},[3058],{"type":428,"value":3059},"find",{"type":422,"tag":460,"props":3061,"children":3062},{"style":526},[3063],{"type":428,"value":497},{"type":422,"tag":460,"props":3065,"children":3066},{"style":599},[3067],{"type":428,"value":3068},"x",{"type":422,"tag":460,"props":3070,"children":3071},{"style":605},[3072],{"type":428,"value":608},{"type":422,"tag":460,"props":3074,"children":3075},{"style":477},[3076],{"type":428,"value":3077}," x",{"type":422,"tag":460,"props":3079,"children":3080},{"style":713},[3081],{"type":428,"value":1624},{"type":422,"tag":460,"props":3083,"children":3084},{"style":477},[3085],{"type":428,"value":2219},{"type":422,"tag":460,"props":3087,"children":3088},{"style":526},[3089],{"type":428,"value":3090},")) ",{"type":422,"tag":460,"props":3092,"children":3093},{"style":483},[3094],{"type":428,"value":1422},{"type":422,"tag":460,"props":3096,"children":3097},{"class":462,"line":931},[3098,3103,3107,3111,3115,3119],{"type":422,"tag":460,"props":3099,"children":3100},{"style":820},[3101],{"type":428,"value":3102},"      this",{"type":422,"tag":460,"props":3104,"children":3105},{"style":483},[3106],{"type":428,"value":486},{"type":422,"tag":460,"props":3108,"children":3109},{"style":489},[3110],{"type":428,"value":1987},{"type":422,"tag":460,"props":3112,"children":3113},{"style":526},[3114],{"type":428,"value":497},{"type":422,"tag":460,"props":3116,"children":3117},{"style":477},[3118],{"type":428,"value":877},{"type":422,"tag":460,"props":3120,"children":3121},{"style":526},[3122],{"type":428,"value":549},{"type":422,"tag":460,"props":3124,"children":3125},{"class":462,"line":940},[3126],{"type":422,"tag":460,"props":3127,"children":3128},{"style":483},[3129],{"type":428,"value":1713},{"type":422,"tag":460,"props":3131,"children":3132},{"class":462,"line":975},[3133],{"type":422,"tag":460,"props":3134,"children":3135},{"style":483},[3136],{"type":428,"value":850},{"type":422,"tag":460,"props":3138,"children":3139},{"class":462,"line":1039},[3140,3144,3148,3152,3156,3160,3164],{"type":422,"tag":460,"props":3141,"children":3142},{"style":864},[3143],{"type":428,"value":946},{"type":422,"tag":460,"props":3145,"children":3146},{"style":483},[3147],{"type":428,"value":872},{"type":422,"tag":460,"props":3149,"children":3150},{"style":599},[3151],{"type":428,"value":955},{"type":422,"tag":460,"props":3153,"children":3154},{"style":483},[3155],{"type":428,"value":518},{"type":422,"tag":460,"props":3157,"children":3158},{"style":599},[3159],{"type":428,"value":964},{"type":422,"tag":460,"props":3161,"children":3162},{"style":483},[3163],{"type":428,"value":882},{"type":422,"tag":460,"props":3165,"children":3166},{"style":483},[3167],{"type":428,"value":2253},{"type":422,"tag":460,"props":3169,"children":3170},{"class":462,"line":1047},[3171],{"type":422,"tag":460,"props":3172,"children":3173},{"style":483},[3174],{"type":428,"value":1053},{"type":422,"tag":460,"props":3176,"children":3177},{"class":462,"line":1275},[3178],{"type":422,"tag":460,"props":3179,"children":3180},{"emptyLinePlaceholder":414},[3181],{"type":428,"value":3182},"\n",{"type":422,"tag":460,"props":3184,"children":3185},{"class":462,"line":1300},[3186,3190,3194,3198],{"type":422,"tag":460,"props":3187,"children":3188},{"style":605},[3189],{"type":428,"value":2888},{"type":422,"tag":460,"props":3191,"children":3192},{"style":477},[3193],{"type":428,"value":2394},{"type":422,"tag":460,"props":3195,"children":3196},{"style":713},[3197],{"type":428,"value":716},{"type":422,"tag":460,"props":3199,"children":3200},{"style":2179},[3201],{"type":428,"value":2403},{"type":422,"tag":460,"props":3203,"children":3204},{"class":462,"line":1318},[3205,3209,3213],{"type":422,"tag":460,"props":3206,"children":3207},{"style":605},[3208],{"type":428,"value":787},{"type":422,"tag":460,"props":3210,"children":3211},{"style":790},[3212],{"type":428,"value":2119},{"type":422,"tag":460,"props":3214,"children":3215},{"style":483},[3216],{"type":428,"value":613},{"type":422,"tag":460,"props":3218,"children":3219},{"class":462,"line":1326},[3220,3224,3228,3232,3236,3240,3244,3248,3252,3256,3260,3264,3268],{"type":422,"tag":460,"props":3221,"children":3222},{"style":864},[3223],{"type":428,"value":2201},{"type":422,"tag":460,"props":3225,"children":3226},{"style":483},[3227],{"type":428,"value":872},{"type":422,"tag":460,"props":3229,"children":3230},{"style":599},[3231],{"type":428,"value":2210},{"type":422,"tag":460,"props":3233,"children":3234},{"style":483},[3235],{"type":428,"value":518},{"type":422,"tag":460,"props":3237,"children":3238},{"style":599},[3239],{"type":428,"value":2219},{"type":422,"tag":460,"props":3241,"children":3242},{"style":483},[3243],{"type":428,"value":518},{"type":422,"tag":460,"props":3245,"children":3246},{"style":599},[3247],{"type":428,"value":2228},{"type":422,"tag":460,"props":3249,"children":3250},{"style":713},[3251],{"type":428,"value":837},{"type":422,"tag":460,"props":3253,"children":3254},{"style":820},[3255],{"type":428,"value":1408},{"type":422,"tag":460,"props":3257,"children":3258},{"style":483},[3259],{"type":428,"value":486},{"type":422,"tag":460,"props":3261,"children":3262},{"style":477},[3263],{"type":428,"value":2154},{"type":422,"tag":460,"props":3265,"children":3266},{"style":483},[3267],{"type":428,"value":882},{"type":422,"tag":460,"props":3269,"children":3270},{"style":483},[3271],{"type":428,"value":613},{"type":422,"tag":460,"props":3273,"children":3274},{"class":462,"line":1335},[3275,3280,3284],{"type":422,"tag":460,"props":3276,"children":3277},{"style":477},[3278],{"type":428,"value":3279},"    handleFn",{"type":422,"tag":460,"props":3281,"children":3282},{"style":713},[3283],{"type":428,"value":837},{"type":422,"tag":460,"props":3285,"children":3286},{"style":477},[3287],{"type":428,"value":3288}," fn\n",{"type":422,"tag":460,"props":3290,"children":3291},{"class":462,"line":2813},[3292,3297,3301,3305,3309,3313,3317,3321],{"type":422,"tag":460,"props":3293,"children":3294},{"style":477},[3295],{"type":428,"value":3296},"    console",{"type":422,"tag":460,"props":3298,"children":3299},{"style":483},[3300],{"type":428,"value":486},{"type":422,"tag":460,"props":3302,"children":3303},{"style":489},[3304],{"type":428,"value":631},{"type":422,"tag":460,"props":3306,"children":3307},{"style":526},[3308],{"type":428,"value":497},{"type":422,"tag":460,"props":3310,"children":3311},{"style":477},[3312],{"type":428,"value":1479},{"type":422,"tag":460,"props":3314,"children":3315},{"style":483},[3316],{"type":428,"value":486},{"type":422,"tag":460,"props":3318,"children":3319},{"style":477},[3320],{"type":428,"value":2210},{"type":422,"tag":460,"props":3322,"children":3323},{"style":526},[3324],{"type":428,"value":549},{"type":422,"tag":460,"props":3326,"children":3327},{"class":462,"line":2826},[3328],{"type":422,"tag":460,"props":3329,"children":3330},{"style":483},[3331],{"type":428,"value":850},{"type":422,"tag":460,"props":3333,"children":3334},{"class":462,"line":2834},[3335,3339,3343,3347,3351,3355,3359,3363,3367,3371,3375,3379,3383,3387,3391,3395],{"type":422,"tag":460,"props":3336,"children":3337},{"style":864},[3338],{"type":428,"value":1281},{"type":422,"tag":460,"props":3340,"children":3341},{"style":483},[3342],{"type":428,"value":872},{"type":422,"tag":460,"props":3344,"children":3345},{"style":599},[3346],{"type":428,"value":2210},{"type":422,"tag":460,"props":3348,"children":3349},{"style":483},[3350],{"type":428,"value":518},{"type":422,"tag":460,"props":3352,"children":3353},{"style":599},[3354],{"type":428,"value":529},{"type":422,"tag":460,"props":3356,"children":3357},{"style":483},[3358],{"type":428,"value":518},{"type":422,"tag":460,"props":3360,"children":3361},{"style":599},[3362],{"type":428,"value":2285},{"type":422,"tag":460,"props":3364,"children":3365},{"style":713},[3366],{"type":428,"value":837},{"type":422,"tag":460,"props":3368,"children":3369},{"style":483},[3370],{"type":428,"value":1394},{"type":422,"tag":460,"props":3372,"children":3373},{"style":599},[3374],{"type":428,"value":2228},{"type":422,"tag":460,"props":3376,"children":3377},{"style":713},[3378],{"type":428,"value":837},{"type":422,"tag":460,"props":3380,"children":3381},{"style":820},[3382],{"type":428,"value":1408},{"type":422,"tag":460,"props":3384,"children":3385},{"style":483},[3386],{"type":428,"value":486},{"type":422,"tag":460,"props":3388,"children":3389},{"style":477},[3390],{"type":428,"value":2154},{"type":422,"tag":460,"props":3392,"children":3393},{"style":483},[3394],{"type":428,"value":882},{"type":422,"tag":460,"props":3396,"children":3397},{"style":483},[3398],{"type":428,"value":613},{"type":422,"tag":460,"props":3400,"children":3402},{"class":462,"line":3401},21,[3403,3408,3412,3416,3420,3424],{"type":422,"tag":460,"props":3404,"children":3405},{"style":605},[3406],{"type":428,"value":3407},"    const",{"type":422,"tag":460,"props":3409,"children":3410},{"style":1433},[3411],{"type":428,"value":1436},{"type":422,"tag":460,"props":3413,"children":3414},{"style":713},[3415],{"type":428,"value":837},{"type":422,"tag":460,"props":3417,"children":3418},{"style":713},[3419],{"type":428,"value":1445},{"type":422,"tag":460,"props":3421,"children":3422},{"style":489},[3423],{"type":428,"value":793},{"type":422,"tag":460,"props":3425,"children":3426},{"style":526},[3427],{"type":428,"value":1454},{"type":422,"tag":460,"props":3429,"children":3431},{"class":462,"line":3430},22,[3432,3437,3441,3445,3449,3453,3457,3461,3465],{"type":422,"tag":460,"props":3433,"children":3434},{"style":477},[3435],{"type":428,"value":3436},"    Object",{"type":422,"tag":460,"props":3438,"children":3439},{"style":483},[3440],{"type":428,"value":486},{"type":422,"tag":460,"props":3442,"children":3443},{"style":489},[3444],{"type":428,"value":1078},{"type":422,"tag":460,"props":3446,"children":3447},{"style":526},[3448],{"type":428,"value":497},{"type":422,"tag":460,"props":3450,"children":3451},{"style":477},[3452],{"type":428,"value":1479},{"type":422,"tag":460,"props":3454,"children":3455},{"style":483},[3456],{"type":428,"value":518},{"type":422,"tag":460,"props":3458,"children":3459},{"style":477},[3460],{"type":428,"value":1143},{"type":422,"tag":460,"props":3462,"children":3463},{"style":483},[3464],{"type":428,"value":518},{"type":422,"tag":460,"props":3466,"children":3467},{"style":483},[3468],{"type":428,"value":613},{"type":422,"tag":460,"props":3470,"children":3472},{"class":462,"line":3471},23,[3473,3478,3482,3486],{"type":422,"tag":460,"props":3474,"children":3475},{"style":526},[3476],{"type":428,"value":3477},"      enumerable",{"type":422,"tag":460,"props":3479,"children":3480},{"style":483},[3481],{"type":428,"value":534},{"type":422,"tag":460,"props":3483,"children":3484},{"style":1174},[3485],{"type":428,"value":1177},{"type":422,"tag":460,"props":3487,"children":3488},{"style":483},[3489],{"type":428,"value":1182},{"type":422,"tag":460,"props":3491,"children":3493},{"class":462,"line":3492},24,[3494,3499,3503,3507],{"type":422,"tag":460,"props":3495,"children":3496},{"style":526},[3497],{"type":428,"value":3498},"      configurable",{"type":422,"tag":460,"props":3500,"children":3501},{"style":483},[3502],{"type":428,"value":534},{"type":422,"tag":460,"props":3504,"children":3505},{"style":1174},[3506],{"type":428,"value":1177},{"type":422,"tag":460,"props":3508,"children":3509},{"style":483},[3510],{"type":428,"value":1182},{"type":422,"tag":460,"props":3512,"children":3514},{"class":462,"line":3513},25,[3515,3520,3524,3528,3532],{"type":422,"tag":460,"props":3516,"children":3517},{"style":489},[3518],{"type":428,"value":3519},"      get",{"type":422,"tag":460,"props":3521,"children":3522},{"style":483},[3523],{"type":428,"value":534},{"type":422,"tag":460,"props":3525,"children":3526},{"style":483},[3527],{"type":428,"value":810},{"type":422,"tag":460,"props":3529,"children":3530},{"style":605},[3531],{"type":428,"value":608},{"type":422,"tag":460,"props":3533,"children":3534},{"style":483},[3535],{"type":428,"value":613},{"type":422,"tag":460,"props":3537,"children":3539},{"class":462,"line":3538},26,[3540,3545,3549],{"type":422,"tag":460,"props":3541,"children":3542},{"style":477},[3543],{"type":428,"value":3544},"        handleDep",{"type":422,"tag":460,"props":3546,"children":3547},{"style":713},[3548],{"type":428,"value":837},{"type":422,"tag":460,"props":3550,"children":3551},{"style":477},[3552],{"type":428,"value":1897},{"type":422,"tag":460,"props":3554,"children":3556},{"class":462,"line":3555},27,[3557,3561,3565,3569],{"type":422,"tag":460,"props":3558,"children":3559},{"style":477},[3560],{"type":428,"value":3544},{"type":422,"tag":460,"props":3562,"children":3563},{"style":483},[3564],{"type":428,"value":486},{"type":422,"tag":460,"props":3566,"children":3567},{"style":489},[3568],{"type":428,"value":2863},{"type":422,"tag":460,"props":3570,"children":3571},{"style":526},[3572],{"type":428,"value":1454},{"type":422,"tag":460,"props":3574,"children":3576},{"class":462,"line":3575},28,[3577,3582],{"type":422,"tag":460,"props":3578,"children":3579},{"style":1248},[3580],{"type":428,"value":3581},"        return",{"type":422,"tag":460,"props":3583,"children":3584},{"style":477},[3585],{"type":428,"value":1256},{"type":422,"tag":460,"props":3587,"children":3589},{"class":462,"line":3588},29,[3590],{"type":422,"tag":460,"props":3591,"children":3592},{"style":483},[3593],{"type":428,"value":3594},"      },\n",{"type":422,"tag":460,"props":3596,"children":3598},{"class":462,"line":3597},30,[3599,3604,3608,3612,3616],{"type":422,"tag":460,"props":3600,"children":3601},{"style":489},[3602],{"type":428,"value":3603},"      set",{"type":422,"tag":460,"props":3605,"children":3606},{"style":483},[3607],{"type":428,"value":534},{"type":422,"tag":460,"props":3609,"children":3610},{"style":599},[3611],{"type":428,"value":602},{"type":422,"tag":460,"props":3613,"children":3614},{"style":605},[3615],{"type":428,"value":608},{"type":422,"tag":460,"props":3617,"children":3618},{"style":483},[3619],{"type":428,"value":2253},{"type":422,"tag":460,"props":3621,"children":3623},{"class":462,"line":3622},31,[3624,3629],{"type":422,"tag":460,"props":3625,"children":3626},{"style":483},[3627],{"type":428,"value":3628},"    }",{"type":422,"tag":460,"props":3630,"children":3631},{"style":526},[3632],{"type":428,"value":549},{"type":422,"tag":460,"props":3634,"children":3636},{"class":462,"line":3635},32,[3637],{"type":422,"tag":460,"props":3638,"children":3639},{"style":483},[3640],{"type":428,"value":850},{"type":422,"tag":460,"props":3642,"children":3644},{"class":462,"line":3643},33,[3645],{"type":422,"tag":460,"props":3646,"children":3647},{"style":483},[3648],{"type":428,"value":1053},{"type":422,"tag":423,"props":3650,"children":3652},{"id":3651},"处理-key-值为对象链的情况",[3653],{"type":428,"value":3654},"处理 key 值为对象链的情况",{"type":422,"tag":430,"props":3656,"children":3657},{},[3658,3660,3666],{"type":428,"value":3659},"在先前的 watch 函数中, 我们使用 console.log(obj.key)去触发对应属性的 getter, 如果我们调用方式是",{"type":422,"tag":436,"props":3661,"children":3663},{"className":3662},[],[3664],{"type":428,"value":3665},"watch('a.b.c')",{"type":428,"value":3667},"就无能为力了. 这里我们封装一个通用方法, 用于处理对象链字符串的形式:",{"type":422,"tag":450,"props":3669,"children":3671},{"className":452,"code":3670,"language":454,"meta":415,"style":415},"// 通过将字符串'a.b'分割为['a', 'b'], 再使用一个while循环就可以走完这个对象链\nfunction walkChains (key, obj) {\n  const segments = key.split('.')\n  let deepObj = obj\n  while (segments.length) {\n    deepObj = deepObj[segments.shift()]\n  }\n}\nclass VX {\n  watch (key, fn, obj = this.store) {\n    handleFn = fn\n    walkChains(key, obj)\n  }\n}\n",[3672],{"type":422,"tag":436,"props":3673,"children":3674},{"__ignoreMap":415},[3675,3683,3720,3769,3790,3824,3863,3870,3877,3892,3947,3962,3990,3997],{"type":422,"tag":460,"props":3676,"children":3677},{"class":462,"line":463},[3678],{"type":422,"tag":460,"props":3679,"children":3680},{"style":467},[3681],{"type":428,"value":3682},"// 通过将字符串'a.b'分割为['a', 'b'], 再使用一个while循环就可以走完这个对象链\n",{"type":422,"tag":460,"props":3684,"children":3685},{"class":462,"line":473},[3686,3691,3696,3700,3704,3708,3712,3716],{"type":422,"tag":460,"props":3687,"children":3688},{"style":605},[3689],{"type":428,"value":3690},"function",{"type":422,"tag":460,"props":3692,"children":3693},{"style":489},[3694],{"type":428,"value":3695}," walkChains",{"type":422,"tag":460,"props":3697,"children":3698},{"style":483},[3699],{"type":428,"value":872},{"type":422,"tag":460,"props":3701,"children":3702},{"style":599},[3703],{"type":428,"value":2210},{"type":422,"tag":460,"props":3705,"children":3706},{"style":483},[3707],{"type":428,"value":518},{"type":422,"tag":460,"props":3709,"children":3710},{"style":599},[3711],{"type":428,"value":2228},{"type":422,"tag":460,"props":3713,"children":3714},{"style":483},[3715],{"type":428,"value":882},{"type":422,"tag":460,"props":3717,"children":3718},{"style":483},[3719],{"type":428,"value":613},{"type":422,"tag":460,"props":3721,"children":3722},{"class":462,"line":552},[3723,3727,3732,3736,3740,3744,3749,3753,3757,3761,3765],{"type":422,"tag":460,"props":3724,"children":3725},{"style":605},[3726],{"type":428,"value":1430},{"type":422,"tag":460,"props":3728,"children":3729},{"style":1433},[3730],{"type":428,"value":3731}," segments",{"type":422,"tag":460,"props":3733,"children":3734},{"style":713},[3735],{"type":428,"value":837},{"type":422,"tag":460,"props":3737,"children":3738},{"style":477},[3739],{"type":428,"value":1143},{"type":422,"tag":460,"props":3741,"children":3742},{"style":483},[3743],{"type":428,"value":486},{"type":422,"tag":460,"props":3745,"children":3746},{"style":489},[3747],{"type":428,"value":3748},"split",{"type":422,"tag":460,"props":3750,"children":3751},{"style":526},[3752],{"type":428,"value":497},{"type":422,"tag":460,"props":3754,"children":3755},{"style":500},[3756],{"type":428,"value":503},{"type":422,"tag":460,"props":3758,"children":3759},{"style":506},[3760],{"type":428,"value":486},{"type":422,"tag":460,"props":3762,"children":3763},{"style":500},[3764],{"type":428,"value":503},{"type":422,"tag":460,"props":3766,"children":3767},{"style":526},[3768],{"type":428,"value":549},{"type":422,"tag":460,"props":3770,"children":3771},{"class":462,"line":561},[3772,3776,3781,3785],{"type":422,"tag":460,"props":3773,"children":3774},{"style":605},[3775],{"type":428,"value":2389},{"type":422,"tag":460,"props":3777,"children":3778},{"style":477},[3779],{"type":428,"value":3780}," deepObj",{"type":422,"tag":460,"props":3782,"children":3783},{"style":713},[3784],{"type":428,"value":837},{"type":422,"tag":460,"props":3786,"children":3787},{"style":477},[3788],{"type":428,"value":3789}," obj\n",{"type":422,"tag":460,"props":3791,"children":3792},{"class":462,"line":616},[3793,3798,3802,3807,3811,3816,3820],{"type":422,"tag":460,"props":3794,"children":3795},{"style":1248},[3796],{"type":428,"value":3797},"  while",{"type":422,"tag":460,"props":3799,"children":3800},{"style":526},[3801],{"type":428,"value":872},{"type":422,"tag":460,"props":3803,"children":3804},{"style":477},[3805],{"type":428,"value":3806},"segments",{"type":422,"tag":460,"props":3808,"children":3809},{"style":483},[3810],{"type":428,"value":486},{"type":422,"tag":460,"props":3812,"children":3813},{"style":1433},[3814],{"type":428,"value":3815},"length",{"type":422,"tag":460,"props":3817,"children":3818},{"style":526},[3819],{"type":428,"value":1633},{"type":422,"tag":460,"props":3821,"children":3822},{"style":483},[3823],{"type":428,"value":1422},{"type":422,"tag":460,"props":3825,"children":3826},{"class":462,"line":664},[3827,3832,3836,3840,3845,3849,3853,3858],{"type":422,"tag":460,"props":3828,"children":3829},{"style":477},[3830],{"type":428,"value":3831},"    deepObj",{"type":422,"tag":460,"props":3833,"children":3834},{"style":713},[3835],{"type":428,"value":837},{"type":422,"tag":460,"props":3837,"children":3838},{"style":477},[3839],{"type":428,"value":3780},{"type":422,"tag":460,"props":3841,"children":3842},{"style":526},[3843],{"type":428,"value":3844},"[",{"type":422,"tag":460,"props":3846,"children":3847},{"style":477},[3848],{"type":428,"value":3806},{"type":422,"tag":460,"props":3850,"children":3851},{"style":483},[3852],{"type":428,"value":486},{"type":422,"tag":460,"props":3854,"children":3855},{"style":489},[3856],{"type":428,"value":3857},"shift",{"type":422,"tag":460,"props":3859,"children":3860},{"style":526},[3861],{"type":428,"value":3862},"()]\n",{"type":422,"tag":460,"props":3864,"children":3865},{"class":462,"line":677},[3866],{"type":422,"tag":460,"props":3867,"children":3868},{"style":483},[3869],{"type":428,"value":850},{"type":422,"tag":460,"props":3871,"children":3872},{"class":462,"line":931},[3873],{"type":422,"tag":460,"props":3874,"children":3875},{"style":483},[3876],{"type":428,"value":1053},{"type":422,"tag":460,"props":3878,"children":3879},{"class":462,"line":940},[3880,3884,3888],{"type":422,"tag":460,"props":3881,"children":3882},{"style":605},[3883],{"type":428,"value":787},{"type":422,"tag":460,"props":3885,"children":3886},{"style":790},[3887],{"type":428,"value":2119},{"type":422,"tag":460,"props":3889,"children":3890},{"style":483},[3891],{"type":428,"value":613},{"type":422,"tag":460,"props":3893,"children":3894},{"class":462,"line":975},[3895,3899,3903,3907,3911,3915,3919,3923,3927,3931,3935,3939,3943],{"type":422,"tag":460,"props":3896,"children":3897},{"style":864},[3898],{"type":428,"value":2201},{"type":422,"tag":460,"props":3900,"children":3901},{"style":483},[3902],{"type":428,"value":872},{"type":422,"tag":460,"props":3904,"children":3905},{"style":599},[3906],{"type":428,"value":2210},{"type":422,"tag":460,"props":3908,"children":3909},{"style":483},[3910],{"type":428,"value":518},{"type":422,"tag":460,"props":3912,"children":3913},{"style":599},[3914],{"type":428,"value":2219},{"type":422,"tag":460,"props":3916,"children":3917},{"style":483},[3918],{"type":428,"value":518},{"type":422,"tag":460,"props":3920,"children":3921},{"style":599},[3922],{"type":428,"value":2228},{"type":422,"tag":460,"props":3924,"children":3925},{"style":713},[3926],{"type":428,"value":837},{"type":422,"tag":460,"props":3928,"children":3929},{"style":820},[3930],{"type":428,"value":1408},{"type":422,"tag":460,"props":3932,"children":3933},{"style":483},[3934],{"type":428,"value":486},{"type":422,"tag":460,"props":3936,"children":3937},{"style":477},[3938],{"type":428,"value":2154},{"type":422,"tag":460,"props":3940,"children":3941},{"style":483},[3942],{"type":428,"value":882},{"type":422,"tag":460,"props":3944,"children":3945},{"style":483},[3946],{"type":428,"value":613},{"type":422,"tag":460,"props":3948,"children":3949},{"class":462,"line":1039},[3950,3954,3958],{"type":422,"tag":460,"props":3951,"children":3952},{"style":477},[3953],{"type":428,"value":3279},{"type":422,"tag":460,"props":3955,"children":3956},{"style":713},[3957],{"type":428,"value":837},{"type":422,"tag":460,"props":3959,"children":3960},{"style":477},[3961],{"type":428,"value":3288},{"type":422,"tag":460,"props":3963,"children":3964},{"class":462,"line":1047},[3965,3970,3974,3978,3982,3986],{"type":422,"tag":460,"props":3966,"children":3967},{"style":489},[3968],{"type":428,"value":3969},"    walkChains",{"type":422,"tag":460,"props":3971,"children":3972},{"style":526},[3973],{"type":428,"value":497},{"type":422,"tag":460,"props":3975,"children":3976},{"style":477},[3977],{"type":428,"value":2210},{"type":422,"tag":460,"props":3979,"children":3980},{"style":483},[3981],{"type":428,"value":518},{"type":422,"tag":460,"props":3983,"children":3984},{"style":477},[3985],{"type":428,"value":2228},{"type":422,"tag":460,"props":3987,"children":3988},{"style":526},[3989],{"type":428,"value":549},{"type":422,"tag":460,"props":3991,"children":3992},{"class":462,"line":1275},[3993],{"type":422,"tag":460,"props":3994,"children":3995},{"style":483},[3996],{"type":428,"value":850},{"type":422,"tag":460,"props":3998,"children":3999},{"class":462,"line":1300},[4000],{"type":422,"tag":460,"props":4001,"children":4002},{"style":483},[4003],{"type":428,"value":1053},{"type":422,"tag":430,"props":4005,"children":4006},{},[4007,4009,4015],{"type":428,"value":4008},"在 set 方法中处理对象链字符串稍微有些不同, 因为如果",{"type":422,"tag":436,"props":4010,"children":4012},{"className":4011},[],[4013],{"type":428,"value":4014},"set('a.b')",{"type":428,"value":4016},"时, 没有在我们全局对象中找到 a 属性, 这里应该抛错.",{"type":422,"tag":430,"props":4018,"children":4019},{},[4020,4022,4028],{"type":428,"value":4021},"实际的处理中, 需要推断'obj.a'以及'obj.a.b'是否存在. 假设没有'obj.a', 那么我们应该创建一个新的对象, 并且给新的对象添加属性'b', 所以代码类似",{"type":422,"tag":436,"props":4023,"children":4025},{"className":4024},[],[4026],{"type":428,"value":4027},"walkChains",{"type":428,"value":4029},"函数, 只是稍作一层判断:",{"type":422,"tag":450,"props":4031,"children":4033},{"className":452,"code":4032,"language":454,"meta":415,"style":415},"set (key, val, obj) {\n  const segments = key.split('.')\n  // 这里需要注意, 我们只处理到倒数第二个属性\n  while (segments.length > 1) {\n    const handleKey = segments.shift()\n    const handleVal = obj[handleKey]\n    // 存在'obj.a'的情况\n    if (typeof handleVal === 'object') {\n      obj = handleVal\n    // 不存在'obj.a'则给a属性赋一个非响应式的对象\n    } else if (!handleVal) {\n      obj = (\n        key = handleKey,\n        obj[handleKey] = {},\n        obj[handleKey]\n      )\n    } else {\n      console.trace('already has val')\n    }\n  }\n  // 最后一个属性要手动赋值\n  key = segments[0]\n}\n",[4034],{"type":422,"tag":436,"props":4035,"children":4036},{"__ignoreMap":415},[4037,4069,4116,4124,4165,4197,4231,4239,4285,4302,4310,4349,4365,4385,4415,4434,4442,4457,4494,4501,4508,4516,4545],{"type":422,"tag":460,"props":4038,"children":4039},{"class":462,"line":463},[4040,4044,4048,4052,4056,4060,4065],{"type":422,"tag":460,"props":4041,"children":4042},{"style":489},[4043],{"type":428,"value":492},{"type":422,"tag":460,"props":4045,"children":4046},{"style":477},[4047],{"type":428,"value":1368},{"type":422,"tag":460,"props":4049,"children":4050},{"style":483},[4051],{"type":428,"value":518},{"type":422,"tag":460,"props":4053,"children":4054},{"style":477},[4055],{"type":428,"value":529},{"type":422,"tag":460,"props":4057,"children":4058},{"style":483},[4059],{"type":428,"value":518},{"type":422,"tag":460,"props":4061,"children":4062},{"style":477},[4063],{"type":428,"value":4064}," obj) ",{"type":422,"tag":460,"props":4066,"children":4067},{"style":483},[4068],{"type":428,"value":1422},{"type":422,"tag":460,"props":4070,"children":4071},{"class":462,"line":473},[4072,4076,4080,4084,4088,4092,4096,4100,4104,4108,4112],{"type":422,"tag":460,"props":4073,"children":4074},{"style":605},[4075],{"type":428,"value":1430},{"type":422,"tag":460,"props":4077,"children":4078},{"style":1433},[4079],{"type":428,"value":3731},{"type":422,"tag":460,"props":4081,"children":4082},{"style":713},[4083],{"type":428,"value":837},{"type":422,"tag":460,"props":4085,"children":4086},{"style":477},[4087],{"type":428,"value":1143},{"type":422,"tag":460,"props":4089,"children":4090},{"style":483},[4091],{"type":428,"value":486},{"type":422,"tag":460,"props":4093,"children":4094},{"style":489},[4095],{"type":428,"value":3748},{"type":422,"tag":460,"props":4097,"children":4098},{"style":526},[4099],{"type":428,"value":497},{"type":422,"tag":460,"props":4101,"children":4102},{"style":500},[4103],{"type":428,"value":503},{"type":422,"tag":460,"props":4105,"children":4106},{"style":506},[4107],{"type":428,"value":486},{"type":422,"tag":460,"props":4109,"children":4110},{"style":500},[4111],{"type":428,"value":503},{"type":422,"tag":460,"props":4113,"children":4114},{"style":526},[4115],{"type":428,"value":549},{"type":422,"tag":460,"props":4117,"children":4118},{"class":462,"line":552},[4119],{"type":422,"tag":460,"props":4120,"children":4121},{"style":467},[4122],{"type":428,"value":4123},"  // 这里需要注意, 我们只处理到倒数第二个属性\n",{"type":422,"tag":460,"props":4125,"children":4126},{"class":462,"line":561},[4127,4131,4135,4139,4143,4147,4152,4157,4161],{"type":422,"tag":460,"props":4128,"children":4129},{"style":1248},[4130],{"type":428,"value":3797},{"type":422,"tag":460,"props":4132,"children":4133},{"style":526},[4134],{"type":428,"value":872},{"type":422,"tag":460,"props":4136,"children":4137},{"style":477},[4138],{"type":428,"value":3806},{"type":422,"tag":460,"props":4140,"children":4141},{"style":483},[4142],{"type":428,"value":486},{"type":422,"tag":460,"props":4144,"children":4145},{"style":1433},[4146],{"type":428,"value":3815},{"type":422,"tag":460,"props":4148,"children":4149},{"style":713},[4150],{"type":428,"value":4151}," >",{"type":422,"tag":460,"props":4153,"children":4154},{"style":719},[4155],{"type":428,"value":4156}," 1",{"type":422,"tag":460,"props":4158,"children":4159},{"style":526},[4160],{"type":428,"value":1633},{"type":422,"tag":460,"props":4162,"children":4163},{"style":483},[4164],{"type":428,"value":1422},{"type":422,"tag":460,"props":4166,"children":4167},{"class":462,"line":616},[4168,4172,4177,4181,4185,4189,4193],{"type":422,"tag":460,"props":4169,"children":4170},{"style":605},[4171],{"type":428,"value":3407},{"type":422,"tag":460,"props":4173,"children":4174},{"style":1433},[4175],{"type":428,"value":4176}," handleKey",{"type":422,"tag":460,"props":4178,"children":4179},{"style":713},[4180],{"type":428,"value":837},{"type":422,"tag":460,"props":4182,"children":4183},{"style":477},[4184],{"type":428,"value":3731},{"type":422,"tag":460,"props":4186,"children":4187},{"style":483},[4188],{"type":428,"value":486},{"type":422,"tag":460,"props":4190,"children":4191},{"style":489},[4192],{"type":428,"value":3857},{"type":422,"tag":460,"props":4194,"children":4195},{"style":526},[4196],{"type":428,"value":1454},{"type":422,"tag":460,"props":4198,"children":4199},{"class":462,"line":664},[4200,4204,4209,4213,4217,4221,4226],{"type":422,"tag":460,"props":4201,"children":4202},{"style":605},[4203],{"type":428,"value":3407},{"type":422,"tag":460,"props":4205,"children":4206},{"style":1433},[4207],{"type":428,"value":4208}," handleVal",{"type":422,"tag":460,"props":4210,"children":4211},{"style":713},[4212],{"type":428,"value":837},{"type":422,"tag":460,"props":4214,"children":4215},{"style":477},[4216],{"type":428,"value":2228},{"type":422,"tag":460,"props":4218,"children":4219},{"style":526},[4220],{"type":428,"value":3844},{"type":422,"tag":460,"props":4222,"children":4223},{"style":477},[4224],{"type":428,"value":4225},"handleKey",{"type":422,"tag":460,"props":4227,"children":4228},{"style":526},[4229],{"type":428,"value":4230},"]\n",{"type":422,"tag":460,"props":4232,"children":4233},{"class":462,"line":677},[4234],{"type":422,"tag":460,"props":4235,"children":4236},{"style":467},[4237],{"type":428,"value":4238},"    // 存在'obj.a'的情况\n",{"type":422,"tag":460,"props":4240,"children":4241},{"class":462,"line":931},[4242,4246,4250,4255,4259,4263,4268,4273,4277,4281],{"type":422,"tag":460,"props":4243,"children":4244},{"style":1248},[4245],{"type":428,"value":3019},{"type":422,"tag":460,"props":4247,"children":4248},{"style":526},[4249],{"type":428,"value":872},{"type":422,"tag":460,"props":4251,"children":4252},{"style":713},[4253],{"type":428,"value":4254},"typeof",{"type":422,"tag":460,"props":4256,"children":4257},{"style":477},[4258],{"type":428,"value":4208},{"type":422,"tag":460,"props":4260,"children":4261},{"style":713},[4262],{"type":428,"value":1624},{"type":422,"tag":460,"props":4264,"children":4265},{"style":500},[4266],{"type":428,"value":4267}," '",{"type":422,"tag":460,"props":4269,"children":4270},{"style":506},[4271],{"type":428,"value":4272},"object",{"type":422,"tag":460,"props":4274,"children":4275},{"style":500},[4276],{"type":428,"value":503},{"type":422,"tag":460,"props":4278,"children":4279},{"style":526},[4280],{"type":428,"value":1633},{"type":422,"tag":460,"props":4282,"children":4283},{"style":483},[4284],{"type":428,"value":1422},{"type":422,"tag":460,"props":4286,"children":4287},{"class":462,"line":940},[4288,4293,4297],{"type":422,"tag":460,"props":4289,"children":4290},{"style":477},[4291],{"type":428,"value":4292},"      obj",{"type":422,"tag":460,"props":4294,"children":4295},{"style":713},[4296],{"type":428,"value":837},{"type":422,"tag":460,"props":4298,"children":4299},{"style":477},[4300],{"type":428,"value":4301}," handleVal\n",{"type":422,"tag":460,"props":4303,"children":4304},{"class":462,"line":975},[4305],{"type":422,"tag":460,"props":4306,"children":4307},{"style":467},[4308],{"type":428,"value":4309},"    // 不存在'obj.a'则给a属性赋一个非响应式的对象\n",{"type":422,"tag":460,"props":4311,"children":4312},{"class":462,"line":1039},[4313,4317,4322,4327,4331,4336,4341,4345],{"type":422,"tag":460,"props":4314,"children":4315},{"style":483},[4316],{"type":428,"value":3628},{"type":422,"tag":460,"props":4318,"children":4319},{"style":1248},[4320],{"type":428,"value":4321}," else",{"type":422,"tag":460,"props":4323,"children":4324},{"style":1248},[4325],{"type":428,"value":4326}," if",{"type":422,"tag":460,"props":4328,"children":4329},{"style":526},[4330],{"type":428,"value":872},{"type":422,"tag":460,"props":4332,"children":4333},{"style":713},[4334],{"type":428,"value":4335},"!",{"type":422,"tag":460,"props":4337,"children":4338},{"style":477},[4339],{"type":428,"value":4340},"handleVal",{"type":422,"tag":460,"props":4342,"children":4343},{"style":526},[4344],{"type":428,"value":1633},{"type":422,"tag":460,"props":4346,"children":4347},{"style":483},[4348],{"type":428,"value":1422},{"type":422,"tag":460,"props":4350,"children":4351},{"class":462,"line":1047},[4352,4356,4360],{"type":422,"tag":460,"props":4353,"children":4354},{"style":489},[4355],{"type":428,"value":4292},{"type":422,"tag":460,"props":4357,"children":4358},{"style":713},[4359],{"type":428,"value":837},{"type":422,"tag":460,"props":4361,"children":4362},{"style":526},[4363],{"type":428,"value":4364}," (\n",{"type":422,"tag":460,"props":4366,"children":4367},{"class":462,"line":1275},[4368,4373,4377,4381],{"type":422,"tag":460,"props":4369,"children":4370},{"style":477},[4371],{"type":428,"value":4372},"        key",{"type":422,"tag":460,"props":4374,"children":4375},{"style":713},[4376],{"type":428,"value":837},{"type":422,"tag":460,"props":4378,"children":4379},{"style":599},[4380],{"type":428,"value":4176},{"type":422,"tag":460,"props":4382,"children":4383},{"style":483},[4384],{"type":428,"value":1182},{"type":422,"tag":460,"props":4386,"children":4387},{"class":462,"line":1300},[4388,4393,4397,4401,4406,4410],{"type":422,"tag":460,"props":4389,"children":4390},{"style":477},[4391],{"type":428,"value":4392},"        obj",{"type":422,"tag":460,"props":4394,"children":4395},{"style":526},[4396],{"type":428,"value":3844},{"type":422,"tag":460,"props":4398,"children":4399},{"style":477},[4400],{"type":428,"value":4225},{"type":422,"tag":460,"props":4402,"children":4403},{"style":526},[4404],{"type":428,"value":4405},"] ",{"type":422,"tag":460,"props":4407,"children":4408},{"style":713},[4409],{"type":428,"value":716},{"type":422,"tag":460,"props":4411,"children":4412},{"style":483},[4413],{"type":428,"value":4414}," {},\n",{"type":422,"tag":460,"props":4416,"children":4417},{"class":462,"line":1318},[4418,4422,4426,4430],{"type":422,"tag":460,"props":4419,"children":4420},{"style":477},[4421],{"type":428,"value":4392},{"type":422,"tag":460,"props":4423,"children":4424},{"style":526},[4425],{"type":428,"value":3844},{"type":422,"tag":460,"props":4427,"children":4428},{"style":477},[4429],{"type":428,"value":4225},{"type":422,"tag":460,"props":4431,"children":4432},{"style":526},[4433],{"type":428,"value":4230},{"type":422,"tag":460,"props":4435,"children":4436},{"class":462,"line":1326},[4437],{"type":422,"tag":460,"props":4438,"children":4439},{"style":526},[4440],{"type":428,"value":4441},"      )\n",{"type":422,"tag":460,"props":4443,"children":4444},{"class":462,"line":1335},[4445,4449,4453],{"type":422,"tag":460,"props":4446,"children":4447},{"style":483},[4448],{"type":428,"value":3628},{"type":422,"tag":460,"props":4450,"children":4451},{"style":1248},[4452],{"type":428,"value":4321},{"type":422,"tag":460,"props":4454,"children":4455},{"style":483},[4456],{"type":428,"value":613},{"type":422,"tag":460,"props":4458,"children":4459},{"class":462,"line":2813},[4460,4464,4468,4473,4477,4481,4486,4490],{"type":422,"tag":460,"props":4461,"children":4462},{"style":477},[4463],{"type":428,"value":2483},{"type":422,"tag":460,"props":4465,"children":4466},{"style":483},[4467],{"type":428,"value":486},{"type":422,"tag":460,"props":4469,"children":4470},{"style":489},[4471],{"type":428,"value":4472},"trace",{"type":422,"tag":460,"props":4474,"children":4475},{"style":526},[4476],{"type":428,"value":497},{"type":422,"tag":460,"props":4478,"children":4479},{"style":500},[4480],{"type":428,"value":503},{"type":422,"tag":460,"props":4482,"children":4483},{"style":506},[4484],{"type":428,"value":4485},"already has val",{"type":422,"tag":460,"props":4487,"children":4488},{"style":500},[4489],{"type":428,"value":503},{"type":422,"tag":460,"props":4491,"children":4492},{"style":526},[4493],{"type":428,"value":549},{"type":422,"tag":460,"props":4495,"children":4496},{"class":462,"line":2826},[4497],{"type":422,"tag":460,"props":4498,"children":4499},{"style":483},[4500],{"type":428,"value":1713},{"type":422,"tag":460,"props":4502,"children":4503},{"class":462,"line":2834},[4504],{"type":422,"tag":460,"props":4505,"children":4506},{"style":483},[4507],{"type":428,"value":850},{"type":422,"tag":460,"props":4509,"children":4510},{"class":462,"line":3401},[4511],{"type":422,"tag":460,"props":4512,"children":4513},{"style":467},[4514],{"type":428,"value":4515},"  // 最后一个属性要手动赋值\n",{"type":422,"tag":460,"props":4517,"children":4518},{"class":462,"line":3430},[4519,4524,4528,4532,4536,4541],{"type":422,"tag":460,"props":4520,"children":4521},{"style":477},[4522],{"type":428,"value":4523},"  key",{"type":422,"tag":460,"props":4525,"children":4526},{"style":713},[4527],{"type":428,"value":837},{"type":422,"tag":460,"props":4529,"children":4530},{"style":477},[4531],{"type":428,"value":3731},{"type":422,"tag":460,"props":4533,"children":4534},{"style":526},[4535],{"type":428,"value":3844},{"type":422,"tag":460,"props":4537,"children":4538},{"style":719},[4539],{"type":428,"value":4540},"0",{"type":422,"tag":460,"props":4542,"children":4543},{"style":526},[4544],{"type":428,"value":4230},{"type":422,"tag":460,"props":4546,"children":4547},{"class":462,"line":3471},[4548],{"type":422,"tag":460,"props":4549,"children":4550},{"style":483},[4551],{"type":428,"value":1053},{"type":422,"tag":423,"props":4553,"children":4555},{"id":4554},"业务场景应用",[4556],{"type":428,"value":4554},{"type":422,"tag":1073,"props":4558,"children":4560},{"id":4559},"小程序跨页面刷新数据",[4561],{"type":428,"value":4559},{"type":422,"tag":430,"props":4563,"children":4564},{},[4565],{"type":428,"value":4566},"我们经常碰到在小程序中由 A 页面跳转到 B 页面, 如果 B 页面进行了一些操作, 希望 A 页面自动刷新数据的情况. 但是由于 A 页面跳转到 B 页面不同(也许是 redirect,也许是 navigate), 处理方法也不尽相同.",{"type":422,"tag":430,"props":4568,"children":4569},{},[4570],{"type":428,"value":4571},"使用 navigate 方式跳转后, A 页面不会被注销, 所以我们一般会通过全局对象去贮存 A 页面实例(也就是 A 页面的 this 对象), 然后在 B 页面直接调用相应的方法(如 A.refreshList())进行刷新操作.",{"type":422,"tag":430,"props":4573,"children":4574},{},[4575,4577,4583],{"type":428,"value":4576},"引入 VX 后, 我们可以在",{"type":422,"tag":436,"props":4578,"children":4580},{"className":4579},[],[4581],{"type":428,"value":4582},"onload",{"type":428,"value":4584},"生命周期直接调用 watch 方法添加订阅:",{"type":422,"tag":450,"props":4586,"children":4588},{"className":452,"code":4587,"language":454,"meta":415,"style":415},"// app.js\nimport VX from '@/utils/suites/vx'\nconst vx = new VX()\napp.vx = vx\napp.store = vx.store\napp.vx.set('userType', '商户')\n\n// page a\nonLoad () {\n  app.vx.watch('userType', userType => {\n    if (userType === '商户') {\n      // ...\n    } else if (userType === '管理员') {\n      // ...\n    }\n  }, {\n    immediate: true\n  })\n}\n\n// page b\nswitchUserType () {\n  app.store.userType = '管理员'\n}\n",[4589],{"type":422,"tag":436,"props":4590,"children":4591},{"__ignoreMap":415},[4592,4600,4632,4659,4685,4718,4779,4786,4794,4811,4868,4907,4915,4963,4970,4977,4989,5006,5017,5024,5031,5039,5055,5094],{"type":422,"tag":460,"props":4593,"children":4594},{"class":462,"line":463},[4595],{"type":422,"tag":460,"props":4596,"children":4597},{"style":467},[4598],{"type":428,"value":4599},"// app.js\n",{"type":422,"tag":460,"props":4601,"children":4602},{"class":462,"line":473},[4603,4608,4613,4618,4622,4627],{"type":422,"tag":460,"props":4604,"children":4605},{"style":1248},[4606],{"type":428,"value":4607},"import",{"type":422,"tag":460,"props":4609,"children":4610},{"style":477},[4611],{"type":428,"value":4612}," VX ",{"type":422,"tag":460,"props":4614,"children":4615},{"style":1248},[4616],{"type":428,"value":4617},"from",{"type":422,"tag":460,"props":4619,"children":4620},{"style":500},[4621],{"type":428,"value":4267},{"type":422,"tag":460,"props":4623,"children":4624},{"style":506},[4625],{"type":428,"value":4626},"@/utils/suites/vx",{"type":422,"tag":460,"props":4628,"children":4629},{"style":500},[4630],{"type":428,"value":4631},"'\n",{"type":422,"tag":460,"props":4633,"children":4634},{"class":462,"line":552},[4635,4639,4643,4647,4651,4655],{"type":422,"tag":460,"props":4636,"children":4637},{"style":605},[4638],{"type":428,"value":1919},{"type":422,"tag":460,"props":4640,"children":4641},{"style":1433},[4642],{"type":428,"value":2340},{"type":422,"tag":460,"props":4644,"children":4645},{"style":713},[4646],{"type":428,"value":837},{"type":422,"tag":460,"props":4648,"children":4649},{"style":713},[4650],{"type":428,"value":1445},{"type":422,"tag":460,"props":4652,"children":4653},{"style":489},[4654],{"type":428,"value":2119},{"type":422,"tag":460,"props":4656,"children":4657},{"style":477},[4658],{"type":428,"value":1454},{"type":422,"tag":460,"props":4660,"children":4661},{"class":462,"line":561},[4662,4667,4671,4676,4680],{"type":422,"tag":460,"props":4663,"children":4664},{"style":477},[4665],{"type":428,"value":4666},"app",{"type":422,"tag":460,"props":4668,"children":4669},{"style":483},[4670],{"type":428,"value":486},{"type":422,"tag":460,"props":4672,"children":4673},{"style":477},[4674],{"type":428,"value":4675},"vx ",{"type":422,"tag":460,"props":4677,"children":4678},{"style":713},[4679],{"type":428,"value":716},{"type":422,"tag":460,"props":4681,"children":4682},{"style":477},[4683],{"type":428,"value":4684}," vx\n",{"type":422,"tag":460,"props":4686,"children":4687},{"class":462,"line":616},[4688,4692,4696,4701,4705,4709,4713],{"type":422,"tag":460,"props":4689,"children":4690},{"style":477},[4691],{"type":428,"value":4666},{"type":422,"tag":460,"props":4693,"children":4694},{"style":483},[4695],{"type":428,"value":486},{"type":422,"tag":460,"props":4697,"children":4698},{"style":477},[4699],{"type":428,"value":4700},"store ",{"type":422,"tag":460,"props":4702,"children":4703},{"style":713},[4704],{"type":428,"value":716},{"type":422,"tag":460,"props":4706,"children":4707},{"style":477},[4708],{"type":428,"value":2340},{"type":422,"tag":460,"props":4710,"children":4711},{"style":483},[4712],{"type":428,"value":486},{"type":422,"tag":460,"props":4714,"children":4715},{"style":477},[4716],{"type":428,"value":4717},"store\n",{"type":422,"tag":460,"props":4719,"children":4720},{"class":462,"line":664},[4721,4725,4729,4733,4737,4741,4745,4749,4754,4758,4762,4766,4771,4775],{"type":422,"tag":460,"props":4722,"children":4723},{"style":477},[4724],{"type":428,"value":4666},{"type":422,"tag":460,"props":4726,"children":4727},{"style":483},[4728],{"type":428,"value":486},{"type":422,"tag":460,"props":4730,"children":4731},{"style":477},[4732],{"type":428,"value":480},{"type":422,"tag":460,"props":4734,"children":4735},{"style":483},[4736],{"type":428,"value":486},{"type":422,"tag":460,"props":4738,"children":4739},{"style":489},[4740],{"type":428,"value":492},{"type":422,"tag":460,"props":4742,"children":4743},{"style":477},[4744],{"type":428,"value":497},{"type":422,"tag":460,"props":4746,"children":4747},{"style":500},[4748],{"type":428,"value":503},{"type":422,"tag":460,"props":4750,"children":4751},{"style":506},[4752],{"type":428,"value":4753},"userType",{"type":422,"tag":460,"props":4755,"children":4756},{"style":500},[4757],{"type":428,"value":503},{"type":422,"tag":460,"props":4759,"children":4760},{"style":483},[4761],{"type":428,"value":518},{"type":422,"tag":460,"props":4763,"children":4764},{"style":500},[4765],{"type":428,"value":4267},{"type":422,"tag":460,"props":4767,"children":4768},{"style":506},[4769],{"type":428,"value":4770},"商户",{"type":422,"tag":460,"props":4772,"children":4773},{"style":500},[4774],{"type":428,"value":503},{"type":422,"tag":460,"props":4776,"children":4777},{"style":477},[4778],{"type":428,"value":549},{"type":422,"tag":460,"props":4780,"children":4781},{"class":462,"line":677},[4782],{"type":422,"tag":460,"props":4783,"children":4784},{"emptyLinePlaceholder":414},[4785],{"type":428,"value":3182},{"type":422,"tag":460,"props":4787,"children":4788},{"class":462,"line":931},[4789],{"type":422,"tag":460,"props":4790,"children":4791},{"style":467},[4792],{"type":428,"value":4793},"// page a\n",{"type":422,"tag":460,"props":4795,"children":4796},{"class":462,"line":940},[4797,4802,4807],{"type":422,"tag":460,"props":4798,"children":4799},{"style":489},[4800],{"type":428,"value":4801},"onLoad",{"type":422,"tag":460,"props":4803,"children":4804},{"style":477},[4805],{"type":428,"value":4806}," () ",{"type":422,"tag":460,"props":4808,"children":4809},{"style":483},[4810],{"type":428,"value":1422},{"type":422,"tag":460,"props":4812,"children":4813},{"class":462,"line":975},[4814,4819,4823,4827,4831,4835,4839,4843,4847,4851,4855,4860,4864],{"type":422,"tag":460,"props":4815,"children":4816},{"style":477},[4817],{"type":428,"value":4818},"  app",{"type":422,"tag":460,"props":4820,"children":4821},{"style":483},[4822],{"type":428,"value":486},{"type":422,"tag":460,"props":4824,"children":4825},{"style":477},[4826],{"type":428,"value":480},{"type":422,"tag":460,"props":4828,"children":4829},{"style":483},[4830],{"type":428,"value":486},{"type":422,"tag":460,"props":4832,"children":4833},{"style":489},[4834],{"type":428,"value":575},{"type":422,"tag":460,"props":4836,"children":4837},{"style":526},[4838],{"type":428,"value":497},{"type":422,"tag":460,"props":4840,"children":4841},{"style":500},[4842],{"type":428,"value":503},{"type":422,"tag":460,"props":4844,"children":4845},{"style":506},[4846],{"type":428,"value":4753},{"type":422,"tag":460,"props":4848,"children":4849},{"style":500},[4850],{"type":428,"value":503},{"type":422,"tag":460,"props":4852,"children":4853},{"style":483},[4854],{"type":428,"value":518},{"type":422,"tag":460,"props":4856,"children":4857},{"style":599},[4858],{"type":428,"value":4859}," userType",{"type":422,"tag":460,"props":4861,"children":4862},{"style":605},[4863],{"type":428,"value":608},{"type":422,"tag":460,"props":4865,"children":4866},{"style":483},[4867],{"type":428,"value":613},{"type":422,"tag":460,"props":4869,"children":4870},{"class":462,"line":1039},[4871,4875,4879,4883,4887,4891,4895,4899,4903],{"type":422,"tag":460,"props":4872,"children":4873},{"style":1248},[4874],{"type":428,"value":3019},{"type":422,"tag":460,"props":4876,"children":4877},{"style":526},[4878],{"type":428,"value":872},{"type":422,"tag":460,"props":4880,"children":4881},{"style":477},[4882],{"type":428,"value":4753},{"type":422,"tag":460,"props":4884,"children":4885},{"style":713},[4886],{"type":428,"value":1624},{"type":422,"tag":460,"props":4888,"children":4889},{"style":500},[4890],{"type":428,"value":4267},{"type":422,"tag":460,"props":4892,"children":4893},{"style":506},[4894],{"type":428,"value":4770},{"type":422,"tag":460,"props":4896,"children":4897},{"style":500},[4898],{"type":428,"value":503},{"type":422,"tag":460,"props":4900,"children":4901},{"style":526},[4902],{"type":428,"value":1633},{"type":422,"tag":460,"props":4904,"children":4905},{"style":483},[4906],{"type":428,"value":1422},{"type":422,"tag":460,"props":4908,"children":4909},{"class":462,"line":1047},[4910],{"type":422,"tag":460,"props":4911,"children":4912},{"style":467},[4913],{"type":428,"value":4914},"      // ...\n",{"type":422,"tag":460,"props":4916,"children":4917},{"class":462,"line":1275},[4918,4922,4926,4930,4934,4938,4942,4946,4951,4955,4959],{"type":422,"tag":460,"props":4919,"children":4920},{"style":483},[4921],{"type":428,"value":3628},{"type":422,"tag":460,"props":4923,"children":4924},{"style":1248},[4925],{"type":428,"value":4321},{"type":422,"tag":460,"props":4927,"children":4928},{"style":1248},[4929],{"type":428,"value":4326},{"type":422,"tag":460,"props":4931,"children":4932},{"style":526},[4933],{"type":428,"value":872},{"type":422,"tag":460,"props":4935,"children":4936},{"style":477},[4937],{"type":428,"value":4753},{"type":422,"tag":460,"props":4939,"children":4940},{"style":713},[4941],{"type":428,"value":1624},{"type":422,"tag":460,"props":4943,"children":4944},{"style":500},[4945],{"type":428,"value":4267},{"type":422,"tag":460,"props":4947,"children":4948},{"style":506},[4949],{"type":428,"value":4950},"管理员",{"type":422,"tag":460,"props":4952,"children":4953},{"style":500},[4954],{"type":428,"value":503},{"type":422,"tag":460,"props":4956,"children":4957},{"style":526},[4958],{"type":428,"value":1633},{"type":422,"tag":460,"props":4960,"children":4961},{"style":483},[4962],{"type":428,"value":1422},{"type":422,"tag":460,"props":4964,"children":4965},{"class":462,"line":1300},[4966],{"type":422,"tag":460,"props":4967,"children":4968},{"style":467},[4969],{"type":428,"value":4914},{"type":422,"tag":460,"props":4971,"children":4972},{"class":462,"line":1318},[4973],{"type":422,"tag":460,"props":4974,"children":4975},{"style":483},[4976],{"type":428,"value":1713},{"type":422,"tag":460,"props":4978,"children":4979},{"class":462,"line":1326},[4980,4985],{"type":422,"tag":460,"props":4981,"children":4982},{"style":483},[4983],{"type":428,"value":4984},"  },",{"type":422,"tag":460,"props":4986,"children":4987},{"style":483},[4988],{"type":428,"value":613},{"type":422,"tag":460,"props":4990,"children":4991},{"class":462,"line":1335},[4992,4997,5001],{"type":422,"tag":460,"props":4993,"children":4994},{"style":526},[4995],{"type":428,"value":4996},"    immediate",{"type":422,"tag":460,"props":4998,"children":4999},{"style":483},[5000],{"type":428,"value":534},{"type":422,"tag":460,"props":5002,"children":5003},{"style":1174},[5004],{"type":428,"value":5005}," true\n",{"type":422,"tag":460,"props":5007,"children":5008},{"class":462,"line":2813},[5009,5013],{"type":422,"tag":460,"props":5010,"children":5011},{"style":483},[5012],{"type":428,"value":1721},{"type":422,"tag":460,"props":5014,"children":5015},{"style":526},[5016],{"type":428,"value":549},{"type":422,"tag":460,"props":5018,"children":5019},{"class":462,"line":2826},[5020],{"type":422,"tag":460,"props":5021,"children":5022},{"style":483},[5023],{"type":428,"value":1053},{"type":422,"tag":460,"props":5025,"children":5026},{"class":462,"line":2834},[5027],{"type":422,"tag":460,"props":5028,"children":5029},{"emptyLinePlaceholder":414},[5030],{"type":428,"value":3182},{"type":422,"tag":460,"props":5032,"children":5033},{"class":462,"line":3401},[5034],{"type":422,"tag":460,"props":5035,"children":5036},{"style":467},[5037],{"type":428,"value":5038},"// page b\n",{"type":422,"tag":460,"props":5040,"children":5041},{"class":462,"line":3430},[5042,5047,5051],{"type":422,"tag":460,"props":5043,"children":5044},{"style":489},[5045],{"type":428,"value":5046},"switchUserType",{"type":422,"tag":460,"props":5048,"children":5049},{"style":477},[5050],{"type":428,"value":4806},{"type":422,"tag":460,"props":5052,"children":5053},{"style":483},[5054],{"type":428,"value":1422},{"type":422,"tag":460,"props":5056,"children":5057},{"class":462,"line":3471},[5058,5062,5066,5070,5074,5078,5082,5086,5090],{"type":422,"tag":460,"props":5059,"children":5060},{"style":477},[5061],{"type":428,"value":4818},{"type":422,"tag":460,"props":5063,"children":5064},{"style":483},[5065],{"type":428,"value":486},{"type":422,"tag":460,"props":5067,"children":5068},{"style":477},[5069],{"type":428,"value":2154},{"type":422,"tag":460,"props":5071,"children":5072},{"style":483},[5073],{"type":428,"value":486},{"type":422,"tag":460,"props":5075,"children":5076},{"style":477},[5077],{"type":428,"value":4753},{"type":422,"tag":460,"props":5079,"children":5080},{"style":713},[5081],{"type":428,"value":837},{"type":422,"tag":460,"props":5083,"children":5084},{"style":500},[5085],{"type":428,"value":4267},{"type":422,"tag":460,"props":5087,"children":5088},{"style":506},[5089],{"type":428,"value":4950},{"type":422,"tag":460,"props":5091,"children":5092},{"style":500},[5093],{"type":428,"value":4631},{"type":422,"tag":460,"props":5095,"children":5096},{"class":462,"line":3492},[5097],{"type":422,"tag":460,"props":5098,"children":5099},{"style":483},[5100],{"type":428,"value":1053},{"type":422,"tag":423,"props":5102,"children":5104},{"id":5103},"可能遇到的问题",[5105],{"type":428,"value":5103},{"type":422,"tag":1073,"props":5107,"children":5109},{"id":5108},"给-watch-方法添加的函数设置立即执行",[5110],{"type":428,"value":5111},"给 watch 方法添加的函数设置立即执行",{"type":422,"tag":430,"props":5113,"children":5114},{},[5115],{"type":428,"value":5116},"有的时候我们希望通过 watch 添加函数的同时还立即执行该函数一次, 这个时候我们需要再定义额外的参数传递到 watch 中. 问题是这个函数不一定是同步函数.",{"type":422,"tag":430,"props":5118,"children":5119},{},[5120],{"type":428,"value":5121},"简单处理如下:",{"type":422,"tag":450,"props":5123,"children":5125},{"className":452,"code":5124,"language":454,"meta":415,"style":415},"class VX {\n  async watch (key, fn, options = { immediately: false }, obj = this.store) {\n    handleDep = fn\n    walkChains(key, obj)\n    options.immediately && await fn(options.defaultParams)\n  }\n}\n",[5126],{"type":422,"tag":436,"props":5127,"children":5128},{"__ignoreMap":415},[5129,5144,5237,5253,5280,5332,5339],{"type":422,"tag":460,"props":5130,"children":5131},{"class":462,"line":463},[5132,5136,5140],{"type":422,"tag":460,"props":5133,"children":5134},{"style":605},[5135],{"type":428,"value":787},{"type":422,"tag":460,"props":5137,"children":5138},{"style":790},[5139],{"type":428,"value":2119},{"type":422,"tag":460,"props":5141,"children":5142},{"style":483},[5143],{"type":428,"value":613},{"type":422,"tag":460,"props":5145,"children":5146},{"class":462,"line":473},[5147,5153,5158,5162,5166,5170,5174,5178,5182,5186,5190,5195,5199,5204,5209,5213,5217,5221,5225,5229,5233],{"type":422,"tag":460,"props":5148,"children":5150},{"style":5149},"--shiki-light:#9C3EDA;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[5151],{"type":428,"value":5152},"  async",{"type":422,"tag":460,"props":5154,"children":5155},{"style":864},[5156],{"type":428,"value":5157}," watch",{"type":422,"tag":460,"props":5159,"children":5160},{"style":483},[5161],{"type":428,"value":872},{"type":422,"tag":460,"props":5163,"children":5164},{"style":599},[5165],{"type":428,"value":2210},{"type":422,"tag":460,"props":5167,"children":5168},{"style":483},[5169],{"type":428,"value":518},{"type":422,"tag":460,"props":5171,"children":5172},{"style":599},[5173],{"type":428,"value":2219},{"type":422,"tag":460,"props":5175,"children":5176},{"style":483},[5177],{"type":428,"value":518},{"type":422,"tag":460,"props":5179,"children":5180},{"style":599},[5181],{"type":428,"value":2285},{"type":422,"tag":460,"props":5183,"children":5184},{"style":713},[5185],{"type":428,"value":837},{"type":422,"tag":460,"props":5187,"children":5188},{"style":483},[5189],{"type":428,"value":523},{"type":422,"tag":460,"props":5191,"children":5192},{"style":526},[5193],{"type":428,"value":5194}," immediately",{"type":422,"tag":460,"props":5196,"children":5197},{"style":483},[5198],{"type":428,"value":534},{"type":422,"tag":460,"props":5200,"children":5201},{"style":1174},[5202],{"type":428,"value":5203}," false",{"type":422,"tag":460,"props":5205,"children":5206},{"style":483},[5207],{"type":428,"value":5208}," },",{"type":422,"tag":460,"props":5210,"children":5211},{"style":599},[5212],{"type":428,"value":2228},{"type":422,"tag":460,"props":5214,"children":5215},{"style":713},[5216],{"type":428,"value":837},{"type":422,"tag":460,"props":5218,"children":5219},{"style":820},[5220],{"type":428,"value":1408},{"type":422,"tag":460,"props":5222,"children":5223},{"style":483},[5224],{"type":428,"value":486},{"type":422,"tag":460,"props":5226,"children":5227},{"style":477},[5228],{"type":428,"value":2154},{"type":422,"tag":460,"props":5230,"children":5231},{"style":483},[5232],{"type":428,"value":882},{"type":422,"tag":460,"props":5234,"children":5235},{"style":483},[5236],{"type":428,"value":613},{"type":422,"tag":460,"props":5238,"children":5239},{"class":462,"line":552},[5240,5245,5249],{"type":422,"tag":460,"props":5241,"children":5242},{"style":477},[5243],{"type":428,"value":5244},"    handleDep",{"type":422,"tag":460,"props":5246,"children":5247},{"style":713},[5248],{"type":428,"value":837},{"type":422,"tag":460,"props":5250,"children":5251},{"style":477},[5252],{"type":428,"value":3288},{"type":422,"tag":460,"props":5254,"children":5255},{"class":462,"line":561},[5256,5260,5264,5268,5272,5276],{"type":422,"tag":460,"props":5257,"children":5258},{"style":489},[5259],{"type":428,"value":3969},{"type":422,"tag":460,"props":5261,"children":5262},{"style":526},[5263],{"type":428,"value":497},{"type":422,"tag":460,"props":5265,"children":5266},{"style":477},[5267],{"type":428,"value":2210},{"type":422,"tag":460,"props":5269,"children":5270},{"style":483},[5271],{"type":428,"value":518},{"type":422,"tag":460,"props":5273,"children":5274},{"style":477},[5275],{"type":428,"value":2228},{"type":422,"tag":460,"props":5277,"children":5278},{"style":526},[5279],{"type":428,"value":549},{"type":422,"tag":460,"props":5281,"children":5282},{"class":462,"line":616},[5283,5288,5292,5297,5301,5306,5310,5314,5319,5323,5328],{"type":422,"tag":460,"props":5284,"children":5285},{"style":477},[5286],{"type":428,"value":5287},"    options",{"type":422,"tag":460,"props":5289,"children":5290},{"style":483},[5291],{"type":428,"value":486},{"type":422,"tag":460,"props":5293,"children":5294},{"style":477},[5295],{"type":428,"value":5296},"immediately",{"type":422,"tag":460,"props":5298,"children":5299},{"style":713},[5300],{"type":428,"value":3032},{"type":422,"tag":460,"props":5302,"children":5303},{"style":1248},[5304],{"type":428,"value":5305}," await",{"type":422,"tag":460,"props":5307,"children":5308},{"style":489},[5309],{"type":428,"value":2219},{"type":422,"tag":460,"props":5311,"children":5312},{"style":526},[5313],{"type":428,"value":497},{"type":422,"tag":460,"props":5315,"children":5316},{"style":477},[5317],{"type":428,"value":5318},"options",{"type":422,"tag":460,"props":5320,"children":5321},{"style":483},[5322],{"type":428,"value":486},{"type":422,"tag":460,"props":5324,"children":5325},{"style":477},[5326],{"type":428,"value":5327},"defaultParams",{"type":422,"tag":460,"props":5329,"children":5330},{"style":526},[5331],{"type":428,"value":549},{"type":422,"tag":460,"props":5333,"children":5334},{"class":462,"line":664},[5335],{"type":422,"tag":460,"props":5336,"children":5337},{"style":483},[5338],{"type":428,"value":850},{"type":422,"tag":460,"props":5340,"children":5341},{"class":462,"line":677},[5342],{"type":422,"tag":460,"props":5343,"children":5344},{"style":483},[5345],{"type":428,"value":1053},{"type":422,"tag":1073,"props":5347,"children":5349},{"id":5348},"this-绑定丢失问题",[5350],{"type":428,"value":5351},"this 绑定丢失问题",{"type":422,"tag":430,"props":5353,"children":5354},{},[5355],{"type":428,"value":5356},"在我在对 VX 进行删除属性方法的扩展时, 我往 walkChain 函数中添加了一个执行回调函数的机制, 并且在删除属性这个方法直接调用了 walkChain:",{"type":422,"tag":450,"props":5358,"children":5360},{"className":452,"code":5359,"language":454,"meta":415,"style":415},"  function walkChains (key, obj, fn) {\n    const segments = key.split('.')\n    let deepObj = obj\n    while (segments.length) {\n      deepObj = deepObj[segments.shift()]\n      fn && fn()\n    }\n  }\n",[5361],{"type":422,"tag":436,"props":5362,"children":5363},{"__ignoreMap":415},[5364,5408,5455,5475,5507,5543,5563,5570],{"type":422,"tag":460,"props":5365,"children":5366},{"class":462,"line":463},[5367,5372,5376,5380,5384,5388,5392,5396,5400,5404],{"type":422,"tag":460,"props":5368,"children":5369},{"style":605},[5370],{"type":428,"value":5371},"  function",{"type":422,"tag":460,"props":5373,"children":5374},{"style":489},[5375],{"type":428,"value":3695},{"type":422,"tag":460,"props":5377,"children":5378},{"style":483},[5379],{"type":428,"value":872},{"type":422,"tag":460,"props":5381,"children":5382},{"style":599},[5383],{"type":428,"value":2210},{"type":422,"tag":460,"props":5385,"children":5386},{"style":483},[5387],{"type":428,"value":518},{"type":422,"tag":460,"props":5389,"children":5390},{"style":599},[5391],{"type":428,"value":2228},{"type":422,"tag":460,"props":5393,"children":5394},{"style":483},[5395],{"type":428,"value":518},{"type":422,"tag":460,"props":5397,"children":5398},{"style":599},[5399],{"type":428,"value":2219},{"type":422,"tag":460,"props":5401,"children":5402},{"style":483},[5403],{"type":428,"value":882},{"type":422,"tag":460,"props":5405,"children":5406},{"style":483},[5407],{"type":428,"value":613},{"type":422,"tag":460,"props":5409,"children":5410},{"class":462,"line":473},[5411,5415,5419,5423,5427,5431,5435,5439,5443,5447,5451],{"type":422,"tag":460,"props":5412,"children":5413},{"style":605},[5414],{"type":428,"value":3407},{"type":422,"tag":460,"props":5416,"children":5417},{"style":1433},[5418],{"type":428,"value":3731},{"type":422,"tag":460,"props":5420,"children":5421},{"style":713},[5422],{"type":428,"value":837},{"type":422,"tag":460,"props":5424,"children":5425},{"style":477},[5426],{"type":428,"value":1143},{"type":422,"tag":460,"props":5428,"children":5429},{"style":483},[5430],{"type":428,"value":486},{"type":422,"tag":460,"props":5432,"children":5433},{"style":489},[5434],{"type":428,"value":3748},{"type":422,"tag":460,"props":5436,"children":5437},{"style":526},[5438],{"type":428,"value":497},{"type":422,"tag":460,"props":5440,"children":5441},{"style":500},[5442],{"type":428,"value":503},{"type":422,"tag":460,"props":5444,"children":5445},{"style":506},[5446],{"type":428,"value":486},{"type":422,"tag":460,"props":5448,"children":5449},{"style":500},[5450],{"type":428,"value":503},{"type":422,"tag":460,"props":5452,"children":5453},{"style":526},[5454],{"type":428,"value":549},{"type":422,"tag":460,"props":5456,"children":5457},{"class":462,"line":552},[5458,5463,5467,5471],{"type":422,"tag":460,"props":5459,"children":5460},{"style":605},[5461],{"type":428,"value":5462},"    let",{"type":422,"tag":460,"props":5464,"children":5465},{"style":477},[5466],{"type":428,"value":3780},{"type":422,"tag":460,"props":5468,"children":5469},{"style":713},[5470],{"type":428,"value":837},{"type":422,"tag":460,"props":5472,"children":5473},{"style":477},[5474],{"type":428,"value":3789},{"type":422,"tag":460,"props":5476,"children":5477},{"class":462,"line":561},[5478,5483,5487,5491,5495,5499,5503],{"type":422,"tag":460,"props":5479,"children":5480},{"style":1248},[5481],{"type":428,"value":5482},"    while",{"type":422,"tag":460,"props":5484,"children":5485},{"style":526},[5486],{"type":428,"value":872},{"type":422,"tag":460,"props":5488,"children":5489},{"style":477},[5490],{"type":428,"value":3806},{"type":422,"tag":460,"props":5492,"children":5493},{"style":483},[5494],{"type":428,"value":486},{"type":422,"tag":460,"props":5496,"children":5497},{"style":1433},[5498],{"type":428,"value":3815},{"type":422,"tag":460,"props":5500,"children":5501},{"style":526},[5502],{"type":428,"value":1633},{"type":422,"tag":460,"props":5504,"children":5505},{"style":483},[5506],{"type":428,"value":1422},{"type":422,"tag":460,"props":5508,"children":5509},{"class":462,"line":616},[5510,5515,5519,5523,5527,5531,5535,5539],{"type":422,"tag":460,"props":5511,"children":5512},{"style":477},[5513],{"type":428,"value":5514},"      deepObj",{"type":422,"tag":460,"props":5516,"children":5517},{"style":713},[5518],{"type":428,"value":837},{"type":422,"tag":460,"props":5520,"children":5521},{"style":477},[5522],{"type":428,"value":3780},{"type":422,"tag":460,"props":5524,"children":5525},{"style":526},[5526],{"type":428,"value":3844},{"type":422,"tag":460,"props":5528,"children":5529},{"style":477},[5530],{"type":428,"value":3806},{"type":422,"tag":460,"props":5532,"children":5533},{"style":483},[5534],{"type":428,"value":486},{"type":422,"tag":460,"props":5536,"children":5537},{"style":489},[5538],{"type":428,"value":3857},{"type":422,"tag":460,"props":5540,"children":5541},{"style":526},[5542],{"type":428,"value":3862},{"type":422,"tag":460,"props":5544,"children":5545},{"class":462,"line":664},[5546,5551,5555,5559],{"type":422,"tag":460,"props":5547,"children":5548},{"style":477},[5549],{"type":428,"value":5550},"      fn",{"type":422,"tag":460,"props":5552,"children":5553},{"style":713},[5554],{"type":428,"value":3032},{"type":422,"tag":460,"props":5556,"children":5557},{"style":489},[5558],{"type":428,"value":2219},{"type":422,"tag":460,"props":5560,"children":5561},{"style":526},[5562],{"type":428,"value":1454},{"type":422,"tag":460,"props":5564,"children":5565},{"class":462,"line":677},[5566],{"type":422,"tag":460,"props":5567,"children":5568},{"style":483},[5569],{"type":428,"value":1713},{"type":422,"tag":460,"props":5571,"children":5572},{"class":462,"line":931},[5573],{"type":422,"tag":460,"props":5574,"children":5575},{"style":483},[5576],{"type":428,"value":850},{"type":422,"tag":450,"props":5578,"children":5580},{"className":452,"code":5579,"language":454,"meta":415,"style":415},"del (key, obj = this.store) {\n  walkChains(key, obj, handleDep.clear)\n  delete obj[key]\n}\n",[5581],{"type":422,"tag":436,"props":5582,"children":5583},{"__ignoreMap":415},[5584,5624,5670,5694],{"type":422,"tag":460,"props":5585,"children":5586},{"class":462,"line":463},[5587,5592,5596,5600,5604,5608,5612,5616,5620],{"type":422,"tag":460,"props":5588,"children":5589},{"style":489},[5590],{"type":428,"value":5591},"del",{"type":422,"tag":460,"props":5593,"children":5594},{"style":477},[5595],{"type":428,"value":1368},{"type":422,"tag":460,"props":5597,"children":5598},{"style":483},[5599],{"type":428,"value":518},{"type":422,"tag":460,"props":5601,"children":5602},{"style":477},[5603],{"type":428,"value":1399},{"type":422,"tag":460,"props":5605,"children":5606},{"style":713},[5607],{"type":428,"value":716},{"type":422,"tag":460,"props":5609,"children":5610},{"style":820},[5611],{"type":428,"value":1408},{"type":422,"tag":460,"props":5613,"children":5614},{"style":483},[5615],{"type":428,"value":486},{"type":422,"tag":460,"props":5617,"children":5618},{"style":477},[5619],{"type":428,"value":1417},{"type":422,"tag":460,"props":5621,"children":5622},{"style":483},[5623],{"type":428,"value":1422},{"type":422,"tag":460,"props":5625,"children":5626},{"class":462,"line":473},[5627,5632,5636,5640,5644,5648,5652,5657,5661,5666],{"type":422,"tag":460,"props":5628,"children":5629},{"style":489},[5630],{"type":428,"value":5631},"  walkChains",{"type":422,"tag":460,"props":5633,"children":5634},{"style":526},[5635],{"type":428,"value":497},{"type":422,"tag":460,"props":5637,"children":5638},{"style":477},[5639],{"type":428,"value":2210},{"type":422,"tag":460,"props":5641,"children":5642},{"style":483},[5643],{"type":428,"value":518},{"type":422,"tag":460,"props":5645,"children":5646},{"style":477},[5647],{"type":428,"value":2228},{"type":422,"tag":460,"props":5649,"children":5650},{"style":483},[5651],{"type":428,"value":518},{"type":422,"tag":460,"props":5653,"children":5654},{"style":477},[5655],{"type":428,"value":5656}," handleDep",{"type":422,"tag":460,"props":5658,"children":5659},{"style":483},[5660],{"type":428,"value":486},{"type":422,"tag":460,"props":5662,"children":5663},{"style":477},[5664],{"type":428,"value":5665},"clear",{"type":422,"tag":460,"props":5667,"children":5668},{"style":526},[5669],{"type":428,"value":549},{"type":422,"tag":460,"props":5671,"children":5672},{"class":462,"line":552},[5673,5678,5682,5686,5690],{"type":422,"tag":460,"props":5674,"children":5675},{"style":713},[5676],{"type":428,"value":5677},"  delete",{"type":422,"tag":460,"props":5679,"children":5680},{"style":477},[5681],{"type":428,"value":2228},{"type":422,"tag":460,"props":5683,"children":5684},{"style":526},[5685],{"type":428,"value":3844},{"type":422,"tag":460,"props":5687,"children":5688},{"style":477},[5689],{"type":428,"value":2210},{"type":422,"tag":460,"props":5691,"children":5692},{"style":526},[5693],{"type":428,"value":4230},{"type":422,"tag":460,"props":5695,"children":5696},{"class":462,"line":561},[5697],{"type":422,"tag":460,"props":5698,"children":5699},{"style":483},[5700],{"type":428,"value":1053},{"type":422,"tag":430,"props":5702,"children":5703},{},[5704,5706,5711],{"type":428,"value":5705},"因为 handleDep.clear 当成参数传递进 walkChains 中会",{"type":422,"tag":766,"props":5707,"children":5708},{},[5709],{"type":428,"value":5710},"丢失 this 绑定",{"type":428,"value":5712},", 所以上面那段代码其实是有问题的, 不过稍作修改就好了:",{"type":422,"tag":450,"props":5714,"children":5716},{"className":452,"code":5715,"language":454,"meta":415,"style":415},"  del (key, obj = this.store) {\n    walkChains(key, obj, () => handleDep.clear())\n    delete obj[key]\n  }\n",[5717],{"type":422,"tag":436,"props":5718,"children":5719},{"__ignoreMap":415},[5720,5760,5812,5836],{"type":422,"tag":460,"props":5721,"children":5722},{"class":462,"line":463},[5723,5728,5732,5736,5740,5744,5748,5752,5756],{"type":422,"tag":460,"props":5724,"children":5725},{"style":489},[5726],{"type":428,"value":5727},"  del",{"type":422,"tag":460,"props":5729,"children":5730},{"style":477},[5731],{"type":428,"value":1368},{"type":422,"tag":460,"props":5733,"children":5734},{"style":483},[5735],{"type":428,"value":518},{"type":422,"tag":460,"props":5737,"children":5738},{"style":477},[5739],{"type":428,"value":1399},{"type":422,"tag":460,"props":5741,"children":5742},{"style":713},[5743],{"type":428,"value":716},{"type":422,"tag":460,"props":5745,"children":5746},{"style":820},[5747],{"type":428,"value":1408},{"type":422,"tag":460,"props":5749,"children":5750},{"style":483},[5751],{"type":428,"value":486},{"type":422,"tag":460,"props":5753,"children":5754},{"style":477},[5755],{"type":428,"value":1417},{"type":422,"tag":460,"props":5757,"children":5758},{"style":483},[5759],{"type":428,"value":1422},{"type":422,"tag":460,"props":5761,"children":5762},{"class":462,"line":473},[5763,5767,5771,5775,5779,5783,5787,5791,5795,5799,5803,5807],{"type":422,"tag":460,"props":5764,"children":5765},{"style":489},[5766],{"type":428,"value":3969},{"type":422,"tag":460,"props":5768,"children":5769},{"style":526},[5770],{"type":428,"value":497},{"type":422,"tag":460,"props":5772,"children":5773},{"style":477},[5774],{"type":428,"value":2210},{"type":422,"tag":460,"props":5776,"children":5777},{"style":483},[5778],{"type":428,"value":518},{"type":422,"tag":460,"props":5780,"children":5781},{"style":477},[5782],{"type":428,"value":2228},{"type":422,"tag":460,"props":5784,"children":5785},{"style":483},[5786],{"type":428,"value":518},{"type":422,"tag":460,"props":5788,"children":5789},{"style":483},[5790],{"type":428,"value":810},{"type":422,"tag":460,"props":5792,"children":5793},{"style":605},[5794],{"type":428,"value":608},{"type":422,"tag":460,"props":5796,"children":5797},{"style":477},[5798],{"type":428,"value":5656},{"type":422,"tag":460,"props":5800,"children":5801},{"style":483},[5802],{"type":428,"value":486},{"type":422,"tag":460,"props":5804,"children":5805},{"style":489},[5806],{"type":428,"value":5665},{"type":422,"tag":460,"props":5808,"children":5809},{"style":526},[5810],{"type":428,"value":5811},"())\n",{"type":422,"tag":460,"props":5813,"children":5814},{"class":462,"line":552},[5815,5820,5824,5828,5832],{"type":422,"tag":460,"props":5816,"children":5817},{"style":713},[5818],{"type":428,"value":5819},"    delete",{"type":422,"tag":460,"props":5821,"children":5822},{"style":477},[5823],{"type":428,"value":2228},{"type":422,"tag":460,"props":5825,"children":5826},{"style":526},[5827],{"type":428,"value":3844},{"type":422,"tag":460,"props":5829,"children":5830},{"style":477},[5831],{"type":428,"value":2210},{"type":422,"tag":460,"props":5833,"children":5834},{"style":526},[5835],{"type":428,"value":4230},{"type":422,"tag":460,"props":5837,"children":5838},{"class":462,"line":561},[5839],{"type":422,"tag":460,"props":5840,"children":5841},{"style":483},[5842],{"type":428,"value":850},{"type":422,"tag":423,"props":5844,"children":5846},{"id":5845},"后语",[5847],{"type":428,"value":5845},{"type":422,"tag":430,"props":5849,"children":5850},{},[5851],{"type":428,"value":5852},"在这篇文章中, 我们通过对 defineProperty 进行封装, 实现了一个简单的对象属性侦听器的功能, 以弥补小程序所没有的$watch 能力. 在此基础上, 各位可以再对 VX 进行扩展, 更方便地去书写业务代码.",{"type":422,"tag":430,"props":5854,"children":5855},{},[5856,5858],{"type":428,"value":5857},"完整代码 ",{"type":422,"tag":692,"props":5859,"children":5863},{"href":5860,"rel":5861},"https://github.com/Lionad-Morotar/media-gear/blob/master/src/renderer/utils/suites/vx/index.js",[5862],"nofollow",[5864],{"type":428,"value":5865},"GitHub 直达",{"type":422,"tag":5867,"props":5868,"children":5869},"style",{},[5870],{"type":428,"value":5871},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":415,"searchDepth":473,"depth":473,"links":5873},[5874,5875,5876,5877,5880,5885,5886,5889,5893],{"id":425,"depth":473,"text":425},{"id":747,"depth":473,"text":747},{"id":757,"depth":473,"text":757},{"id":1069,"depth":473,"text":1069,"children":5878},[5879],{"id":1075,"depth":552,"text":1078},{"id":2054,"depth":473,"text":2057,"children":5881},[5882,5883,5884],{"id":2060,"depth":552,"text":2060},{"id":2092,"depth":552,"text":2095},{"id":2842,"depth":552,"text":2842},{"id":3651,"depth":473,"text":3654},{"id":4554,"depth":473,"text":4554,"children":5887},[5888],{"id":4559,"depth":552,"text":4559},{"id":5103,"depth":473,"text":5103,"children":5890},[5891,5892],{"id":5108,"depth":552,"text":5111},{"id":5348,"depth":552,"text":5351},{"id":5845,"depth":473,"text":5845},"markdown","content:_archieved:2019-05:reactive-in-150loc.md","content","_archieved/2019-05/reactive-in-150loc.md","_archieved/2019-05/reactive-in-150loc","md",[5901,5904],{"_path":5902,"title":5903,"description":415},"/_archieved/2018-10/noname","🌆 无题",{"_path":5905,"title":5906,"description":415},"/_archieved/2019-06/messy-in-two-years","💖 聊聊此次离职，毕业，及其它杂乱的事情",1732808707779]