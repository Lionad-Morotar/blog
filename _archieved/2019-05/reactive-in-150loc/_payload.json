[{"data":1,"prerenderedAt":5913},["ShallowReactive",2],{"navigation":3,"/_archieved/2019-05/reactive-in-150loc":416,"/_archieved/2019-05/reactive-in-150loc-surround":5906},[4,32,86,108,135,141,147,153,399,405,411],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🌃 长夜梦","/flows/long-night-dream",{"title":15,"_path":16},"🌌 万物联结与幸福感","/flows/everything",{"title":18,"_path":19},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":21,"_path":22},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":24,"_path":25},"🌧️ 我的腼腆","/flows/shy",{"title":27,"_path":28},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":30,"_path":31},"📝 心流归档","/flows/fold",{"title":33,"_path":34,"children":35},"技术博客 / Coder","/articles",[36,38,41,44,47,50,53,56,59,62,65,68,71,74,77,80,83],{"title":37,"_path":34},"🦁 为什么我要写博客",{"title":39,"_path":40},"🗂️ 使你的 Git Graph 变得清晰易懂","/articles/clean-git-tree",{"title":42,"_path":43},"💻 本地部署 Qwen 翻译网页","/articles/local-translator",{"title":45,"_path":46},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":48,"_path":49},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":51,"_path":52},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":54,"_path":55},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":57,"_path":58},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":60,"_path":61},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":63,"_path":64},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":66,"_path":67},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":69,"_path":70},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":72,"_path":73},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":75,"_path":76},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":78,"_path":79},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":81,"_path":82},"🚝 四十二篇系列","/articles/fourty-two",{"title":84,"_path":85},"📝 技术博客归档","/articles/fold",{"title":87,"_path":88,"children":89},"造物 / Make","/tools",[90,93,96,99,102,105],{"title":91,"_path":92},"🥥 Coconut","/tools/coconut",{"title":94,"_path":95},"🧶 网易云音乐歌单排序","/tools/netease-sorter",{"title":97,"_path":98},"🌐 AnySort","/tools/anysort",{"title":100,"_path":101},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":103,"_path":104},"👓 Crapto","/tools/crypto-inline",{"title":106,"_path":107},"🖨️ any-to-base64","/tools/any-to-base64",{"title":109,"_path":110,"children":111},"吉他剧场 / Music","/music",[112,114,117,120,123,126,129,132],{"title":113,"_path":110},"🎸 FingerStyle！",{"title":115,"_path":116},"🌬️ 等待的风","/music/wind",{"title":118,"_path":119},"💕 约定的海洋","/music/ocean",{"title":121,"_path":122},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":124,"_path":125},"🌏 残酷天使的行动纲领","/music/eva",{"title":127,"_path":128},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":130,"_path":131},"🍷 Wu Wei","/music/wu-wei",{"title":133,"_path":134},"🌅 无题","/music/untitled",{"title":136,"_path":137,"children":138},"画点什么 / Paint","/paint",[139],{"title":140,"_path":137},"🚧 正在施工",{"title":142,"_path":143,"children":144},"读书笔记 / Notes","/books",[145],{"title":146,"_path":143},"📕 读书笔记",{"title":148,"_path":149,"children":150},"知识地图 / Maps","/maps",[151],{"title":152,"_path":149},"🏁 知识地图",{"title":154,"_path":155,"children":156},"零散的笔记 / Gists","/gists",[157,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255,258,261,264,267,270,273,276,279,282,285,288,291,294,297,300,303,306,309,312,315,318,321,324,327,330,333,336,339,342,345,348,351,354,357,360,363,366,369,372,375,378,381,384,387,390,393,396],{"title":158,"_path":155},"🧊 Gists",{"title":160,"_path":161},"网站的可访问性","/gists/accessibility",{"title":163,"_path":164},"Bit","/gists/bit",{"title":166,"_path":167},"图片模糊","/gists/blur",{"title":169,"_path":170},"渲染相关笔记","/gists/c4d",{"title":172,"_path":173},"CDN 问题记录","/gists/cdn",{"title":175,"_path":176},"消毒剂","/gists/cleaner",{"title":178,"_path":179},"Windows Command","/gists/cmd",{"title":181,"_path":182},"Command","/gists/command",{"title":184,"_path":185},"复杂科学","/gists/complexity-science",{"title":187,"_path":188},"GitHub Copilot","/gists/copilot",{"title":190,"_path":191},"宇宙","/gists/cosmos",{"title":193,"_path":194},"C++","/gists/cpp",{"title":196,"_path":197},"Data Structure","/gists/data-structure",{"title":199,"_path":200},"DEPRESSION","/gists/depression",{"title":202,"_path":203},"设计模式","/gists/design-patterns",{"title":205,"_path":206},"Developer Experience","/gists/developer-experience",{"title":208,"_path":209},"Device Metrics","/gists/device-metrix",{"title":211,"_path":212},"数字化转型","/gists/digital-transformation",{"title":214,"_path":215},"ECMAScript Language Specification","/gists/ecmascript-specification",{"title":217,"_path":218},"正则表达式","/gists/eegex",{"title":220,"_path":221},"Emoji","/gists/emoji",{"title":223,"_path":224},"工程","/gists/engineering",{"title":226,"_path":227},"熵","/gists/entropy",{"title":229,"_path":230},"Environment","/gists/environment",{"title":232,"_path":233},"Erlang","/gists/erlang",{"title":235,"_path":236},"逃离塔克夫","/gists/escape-from-tarkov",{"title":238,"_path":239},"ESNext (ES6-ES11)","/gists/esnext",{"title":241,"_path":242},"Eval！","/gists/eval",{"title":244,"_path":245},"Flutter","/gists/flutter",{"title":247,"_path":248},"字体","/gists/font",{"title":250,"_path":251},"JS 函数式编程","/gists/functional",{"title":253,"_path":254},"游戏化","/gists/gamification",{"title":256,"_path":257},"Google C++ Standard","/gists/google-cpp-standard",{"title":259,"_path":260},"双向链接完全体","/gists/graph",{"title":262,"_path":263},"Hardwares","/gists/hardwares",{"title":265,"_path":266},"哈希冲突","/gists/hash-collision",{"title":268,"_path":269},"信息设计","/gists/information-design",{"title":271,"_path":272},"InstantPage","/gists/instant.page",{"title":274,"_path":275},"ISUX 遇见大数据可视化系列","/gists/isux-data-visualization",{"title":277,"_path":278},"KVStore","/gists/key-value-db",{"title":280,"_path":281},"Kubernetes","/gists/kubernetes",{"title":283,"_path":284},"Makefile","/gists/makefile",{"title":286,"_path":287},"Markdown Inline Style","/gists/markdown-nice",{"title":289,"_path":290},"小程序","/gists/miniapp",{"title":292,"_path":293},"减小页面快照体积","/gists/minify-html",{"title":295,"_path":296},"mklink","/gists/mklink",{"title":298,"_path":299},"Mock","/gists/mock",{"title":301,"_path":302},"多人协作系统","/gists/multiplayer",{"title":304,"_path":305},"多端应用","/gists/multy-end-app",{"title":307,"_path":308},"神经科学","/gists/neuroscience",{"title":310,"_path":311},"OO","/gists/oo",{"title":313,"_path":314},"Opinioned Personal Folder","/gists/opinioned-personal-folder",{"title":316,"_path":317},"PInvoke","/gists/pinvoke",{"title":319,"_path":320},"像素","/gists/pixel",{"title":322,"_path":323},"PowerShell","/gists/powershell",{"title":325,"_path":326},"量子","/gists/quantum",{"title":328,"_path":329},"保持好奇心","/gists/questions",{"title":331,"_path":332},"React Native","/gists/react-native",{"title":334,"_path":335},"博客改版碰到的浏览器平滑滚动问题","/gists/scroll",{"title":337,"_path":338},"SEO","/gists/seo",{"title":340,"_path":341},"Shader","/gists/shader",{"title":343,"_path":344},"Shape Up","/gists/shape-up",{"title":346,"_path":347},"睡觉","/gists/sleep",{"title":349,"_path":350},"记录奇怪的问题","/gists/solved",{"title":352,"_path":353},"States","/gists/states",{"title":355,"_path":356},"Storage","/gists/storage",{"title":358,"_path":359},"音视频流处理","/gists/stream-cli",{"title":361,"_path":362},"Symbol","/gists/symbol",{"title":364,"_path":365},"系统论","/gists/systems-theory",{"title":367,"_path":368},"Taro","/gists/taro",{"title":370,"_path":371},"任务切片","/gists/task-slice",{"title":373,"_path":374},"技术偏好","/gists/tech-dudge",{"title":376,"_path":377},"Untitled","/gists/untitled",{"title":379,"_path":380},"可变字体","/gists/variable-font",{"title":382,"_path":383},"视觉错觉","/gists/visual-illusion",{"title":385,"_path":386},"SS(SSR)","/gists/vpn",{"title":388,"_path":389},"VS Code 插件开发","/gists/vscode-plugin",{"title":391,"_path":392},"Web Components","/gists/web-components",{"title":394,"_path":395},"Windows","/gists/windows",{"title":397,"_path":398},"查缺补漏","/gists/wrong",{"title":400,"_path":401,"children":402},"代码笔记 / Gists","/source-code",[403],{"title":404,"_path":401},"🚄 代码笔记",{"title":406,"_path":407,"children":408},"我 / Abount","/hire",[409],{"title":410,"_path":407},"📬 技术简历",{"title":412,"_path":413,"children":414},"todo","/todo",[415],{"title":412,"_path":413},{"_path":417,"_dir":418,"_draft":419,"_partial":420,"_locale":421,"title":422,"description":423,"body":424,"_type":5900,"_id":5901,"_source":5902,"_file":5903,"_stem":5904,"_extension":5905},"/_archieved/2019-05/reactive-in-150loc","2019-05",false,true,"","🚀 150 行代码带你实现小程序中的数据侦听","本文介绍了在 150 行代码内使用 defineProperty 实现一个简单的拥有事件发布订阅能力的状态管理库的思路。",{"type":425,"children":426,"toc":5878},"root",[427,435,450,455,734,746,751,756,761,766,779,1060,1073,1078,1085,1097,1351,1356,1739,1744,1749,1754,1911,2053,2058,2064,2069,2074,2083,2088,2096,2102,2107,2363,2368,2373,2846,2851,2880,3655,3661,3674,4010,4023,4036,4558,4563,4568,4573,4578,4591,5107,5112,5118,5123,5128,5352,5358,5363,5583,5707,5719,5849,5854,5859,5872],{"type":428,"tag":429,"props":430,"children":432},"element","h2",{"id":431},"前言",[433],{"type":434,"value":431},"text",{"type":428,"tag":436,"props":437,"children":438},"p",{},[439,441,448],{"type":434,"value":440},"在小程序项目中, 我们的通常会使用到使用到一个全局对象作为各个页面通用的数据存储容器, 将它绑定到 app 对象后, 就能在每一个页面都自由的操纵这个对象. 然而在实践中, 由于这个对象及其属性不具备响应式条件, 它不能直接参与业务逻辑的编写, 能力仅仅局限于数据储存. 若是在 VueJS 项目中, 我们可能经常使用到",{"type":428,"tag":442,"props":443,"children":445},"code",{"className":444},[],[446],{"type":434,"value":447},"Vue.$watch",{"type":434,"value":449},"去侦听某个数据是否发生变化, 小程序却缺乏这种能力.",{"type":428,"tag":436,"props":451,"children":452},{},[453],{"type":434,"value":454},"在这篇文章中, 我将用 150 行代码, 手把手带你打造一个小程序也可以使用的侦听器(下简称 VX):",{"type":428,"tag":456,"props":457,"children":461},"pre",{"className":458,"code":459,"language":460,"meta":421,"style":421},"language-js shiki shiki-themes material-theme-lighter github-light github-dark monokai","// 一个快速赋值的语法糖函数, 可以创建结构为 { value: a { b: { val: ''} } } 的对象\nvx.set('value.a.d', { val: '' })\n// 对某个属性进行侦听, 如果发生改变, 则执行相应函数(可多次watch以执行多个函数)\nvx.watch('value.a.d.val', newVal => {\n  console.log(`val改变为 : `, newVal)\n})\nvalue.a.d.val = 3 // val改编为 : 3\n","js",[462],{"type":428,"tag":442,"props":463,"children":464},{"__ignoreMap":421},[465,477,556,565,620,668,681],{"type":428,"tag":466,"props":467,"children":470},"span",{"class":468,"line":469},"line",1,[471],{"type":428,"tag":466,"props":472,"children":474},{"style":473},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit",[475],{"type":434,"value":476},"// 一个快速赋值的语法糖函数, 可以创建结构为 { value: a { b: { val: ''} } } 的对象\n",{"type":428,"tag":466,"props":478,"children":480},{"class":468,"line":479},2,[481,487,493,499,504,510,516,520,525,530,536,541,546,551],{"type":428,"tag":466,"props":482,"children":484},{"style":483},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[485],{"type":434,"value":486},"vx",{"type":428,"tag":466,"props":488,"children":490},{"style":489},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[491],{"type":434,"value":492},".",{"type":428,"tag":466,"props":494,"children":496},{"style":495},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[497],{"type":434,"value":498},"set",{"type":428,"tag":466,"props":500,"children":501},{"style":483},[502],{"type":434,"value":503},"(",{"type":428,"tag":466,"props":505,"children":507},{"style":506},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[508],{"type":434,"value":509},"'",{"type":428,"tag":466,"props":511,"children":513},{"style":512},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[514],{"type":434,"value":515},"value.a.d",{"type":428,"tag":466,"props":517,"children":518},{"style":506},[519],{"type":434,"value":509},{"type":428,"tag":466,"props":521,"children":522},{"style":489},[523],{"type":434,"value":524},",",{"type":428,"tag":466,"props":526,"children":527},{"style":489},[528],{"type":434,"value":529}," {",{"type":428,"tag":466,"props":531,"children":533},{"style":532},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[534],{"type":434,"value":535}," val",{"type":428,"tag":466,"props":537,"children":538},{"style":489},[539],{"type":434,"value":540},":",{"type":428,"tag":466,"props":542,"children":543},{"style":506},[544],{"type":434,"value":545}," ''",{"type":428,"tag":466,"props":547,"children":548},{"style":489},[549],{"type":434,"value":550}," }",{"type":428,"tag":466,"props":552,"children":553},{"style":483},[554],{"type":434,"value":555},")\n",{"type":428,"tag":466,"props":557,"children":559},{"class":468,"line":558},3,[560],{"type":428,"tag":466,"props":561,"children":562},{"style":473},[563],{"type":434,"value":564},"// 对某个属性进行侦听, 如果发生改变, 则执行相应函数(可多次watch以执行多个函数)\n",{"type":428,"tag":466,"props":566,"children":568},{"class":468,"line":567},4,[569,573,577,582,586,590,595,599,603,609,615],{"type":428,"tag":466,"props":570,"children":571},{"style":483},[572],{"type":434,"value":486},{"type":428,"tag":466,"props":574,"children":575},{"style":489},[576],{"type":434,"value":492},{"type":428,"tag":466,"props":578,"children":579},{"style":495},[580],{"type":434,"value":581},"watch",{"type":428,"tag":466,"props":583,"children":584},{"style":483},[585],{"type":434,"value":503},{"type":428,"tag":466,"props":587,"children":588},{"style":506},[589],{"type":434,"value":509},{"type":428,"tag":466,"props":591,"children":592},{"style":512},[593],{"type":434,"value":594},"value.a.d.val",{"type":428,"tag":466,"props":596,"children":597},{"style":506},[598],{"type":434,"value":509},{"type":428,"tag":466,"props":600,"children":601},{"style":489},[602],{"type":434,"value":524},{"type":428,"tag":466,"props":604,"children":606},{"style":605},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#E36209;--shiki-default-font-style:inherit;--shiki-dark:#FFAB70;--shiki-dark-font-style:inherit;--shiki-sepia:#FD971F;--shiki-sepia-font-style:italic",[607],{"type":434,"value":608}," newVal",{"type":428,"tag":466,"props":610,"children":612},{"style":611},"--shiki-light:#9C3EDA;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic",[613],{"type":434,"value":614}," =>",{"type":428,"tag":466,"props":616,"children":617},{"style":489},[618],{"type":434,"value":619}," {\n",{"type":428,"tag":466,"props":621,"children":623},{"class":468,"line":622},5,[624,629,633,638,642,647,652,656,660,664],{"type":428,"tag":466,"props":625,"children":626},{"style":483},[627],{"type":434,"value":628},"  console",{"type":428,"tag":466,"props":630,"children":631},{"style":489},[632],{"type":434,"value":492},{"type":428,"tag":466,"props":634,"children":635},{"style":495},[636],{"type":434,"value":637},"log",{"type":428,"tag":466,"props":639,"children":640},{"style":532},[641],{"type":434,"value":503},{"type":428,"tag":466,"props":643,"children":644},{"style":506},[645],{"type":434,"value":646},"`",{"type":428,"tag":466,"props":648,"children":649},{"style":512},[650],{"type":434,"value":651},"val改变为 : ",{"type":428,"tag":466,"props":653,"children":654},{"style":506},[655],{"type":434,"value":646},{"type":428,"tag":466,"props":657,"children":658},{"style":489},[659],{"type":434,"value":524},{"type":428,"tag":466,"props":661,"children":662},{"style":483},[663],{"type":434,"value":608},{"type":428,"tag":466,"props":665,"children":666},{"style":532},[667],{"type":434,"value":555},{"type":428,"tag":466,"props":669,"children":671},{"class":468,"line":670},6,[672,677],{"type":428,"tag":466,"props":673,"children":674},{"style":489},[675],{"type":434,"value":676},"}",{"type":428,"tag":466,"props":678,"children":679},{"style":483},[680],{"type":434,"value":555},{"type":428,"tag":466,"props":682,"children":684},{"class":468,"line":683},7,[685,690,694,699,703,708,712,717,723,729],{"type":428,"tag":466,"props":686,"children":687},{"style":483},[688],{"type":434,"value":689},"value",{"type":428,"tag":466,"props":691,"children":692},{"style":489},[693],{"type":434,"value":492},{"type":428,"tag":466,"props":695,"children":696},{"style":483},[697],{"type":434,"value":698},"a",{"type":428,"tag":466,"props":700,"children":701},{"style":489},[702],{"type":434,"value":492},{"type":428,"tag":466,"props":704,"children":705},{"style":483},[706],{"type":434,"value":707},"d",{"type":428,"tag":466,"props":709,"children":710},{"style":489},[711],{"type":434,"value":492},{"type":428,"tag":466,"props":713,"children":714},{"style":483},[715],{"type":434,"value":716},"val ",{"type":428,"tag":466,"props":718,"children":720},{"style":719},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[721],{"type":434,"value":722},"=",{"type":428,"tag":466,"props":724,"children":726},{"style":725},"--shiki-light:#F76D47;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[727],{"type":434,"value":728}," 3",{"type":428,"tag":466,"props":730,"children":731},{"style":473},[732],{"type":434,"value":733}," // val改编为 : 3\n",{"type":428,"tag":436,"props":735,"children":736},{},[737,739,744],{"type":434,"value":738},"使用 VX 侦听器, 我们可以更加方便的管理各个页面的状态. 同时, 我们凭借",{"type":428,"tag":442,"props":740,"children":742},{"className":741},[],[743],{"type":434,"value":581},{"type":434,"value":745},"语法, 可以更优雅地编写业务逻辑.",{"type":428,"tag":436,"props":747,"children":748},{},[749],{"type":434,"value":750},"坐稳了, 三轮车准备启动了~ 各位评论见~ 😋",{"type":428,"tag":429,"props":752,"children":754},{"id":753},"稍微理一理思路",[755],{"type":434,"value":753},{"type":428,"tag":436,"props":757,"children":758},{},[759],{"type":434,"value":760},"在全局对象中, 我们不一定要对每一个属性都进行侦听, 所以 VX 主要的功能就是通过 set 去设置某个具体属性的 setter/getter, 同时通过 watch 向添加该属性添加需要订阅的回调函数.",{"type":428,"tag":429,"props":762,"children":764},{"id":763},"依赖对象的实现",[765],{"type":434,"value":763},{"type":428,"tag":436,"props":767,"children":768},{},[769,771,777],{"type":434,"value":770},"首先我们需要造一个通用的",{"type":428,"tag":772,"props":773,"children":774},"strong",{},[775],{"type":434,"value":776},"依赖对象",{"type":434,"value":778},", 依赖对象携带一个订阅数组用于存放一组回调函数, 同时它还应该包括一些操作订阅数组能力(如添加订阅, 清空订阅)的函数",{"type":428,"tag":456,"props":780,"children":782},{"className":458,"code":781,"language":460,"meta":421,"style":421},"class Dep {\n  constructor () {\n    this.subs = []\n  }\n  // 将回调添加到数组中\n  addSub (fn) { /*...*/ }\n  delSub (fn) { /*...*/ }\n  // 执行数组中每一项函数\n  notify (newVal, oldVal) {\n    this.subs.forEach(func => func(newVal, oldVal))\n  }\n}\n",[783],{"type":428,"tag":442,"props":784,"children":785},{"__ignoreMap":421},[786,804,821,849,857,865,903,935,944,979,1043,1051],{"type":428,"tag":466,"props":787,"children":788},{"class":468,"line":469},[789,794,800],{"type":428,"tag":466,"props":790,"children":791},{"style":611},[792],{"type":434,"value":793},"class",{"type":428,"tag":466,"props":795,"children":797},{"style":796},"--shiki-light:#E2931D;--shiki-light-text-decoration:inherit;--shiki-default:#6F42C1;--shiki-default-text-decoration:inherit;--shiki-dark:#B392F0;--shiki-dark-text-decoration:inherit;--shiki-sepia:#A6E22E;--shiki-sepia-text-decoration:underline",[798],{"type":434,"value":799}," Dep",{"type":428,"tag":466,"props":801,"children":802},{"style":489},[803],{"type":434,"value":619},{"type":428,"tag":466,"props":805,"children":806},{"class":468,"line":479},[807,812,817],{"type":428,"tag":466,"props":808,"children":809},{"style":611},[810],{"type":434,"value":811},"  constructor",{"type":428,"tag":466,"props":813,"children":814},{"style":489},[815],{"type":434,"value":816}," ()",{"type":428,"tag":466,"props":818,"children":819},{"style":489},[820],{"type":434,"value":619},{"type":428,"tag":466,"props":822,"children":823},{"class":468,"line":558},[824,830,834,839,844],{"type":428,"tag":466,"props":825,"children":827},{"style":826},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[828],{"type":434,"value":829},"    this",{"type":428,"tag":466,"props":831,"children":832},{"style":489},[833],{"type":434,"value":492},{"type":428,"tag":466,"props":835,"children":836},{"style":483},[837],{"type":434,"value":838},"subs",{"type":428,"tag":466,"props":840,"children":841},{"style":719},[842],{"type":434,"value":843}," =",{"type":428,"tag":466,"props":845,"children":846},{"style":532},[847],{"type":434,"value":848}," []\n",{"type":428,"tag":466,"props":850,"children":851},{"class":468,"line":567},[852],{"type":428,"tag":466,"props":853,"children":854},{"style":489},[855],{"type":434,"value":856},"  }\n",{"type":428,"tag":466,"props":858,"children":859},{"class":468,"line":622},[860],{"type":428,"tag":466,"props":861,"children":862},{"style":473},[863],{"type":434,"value":864},"  // 将回调添加到数组中\n",{"type":428,"tag":466,"props":866,"children":867},{"class":468,"line":670},[868,874,879,884,889,893,898],{"type":428,"tag":466,"props":869,"children":871},{"style":870},"--shiki-light:#E53935;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[872],{"type":434,"value":873},"  addSub",{"type":428,"tag":466,"props":875,"children":876},{"style":489},[877],{"type":434,"value":878}," (",{"type":428,"tag":466,"props":880,"children":881},{"style":605},[882],{"type":434,"value":883},"fn",{"type":428,"tag":466,"props":885,"children":886},{"style":489},[887],{"type":434,"value":888},")",{"type":428,"tag":466,"props":890,"children":891},{"style":489},[892],{"type":434,"value":529},{"type":428,"tag":466,"props":894,"children":895},{"style":473},[896],{"type":434,"value":897}," /*...*/",{"type":428,"tag":466,"props":899,"children":900},{"style":489},[901],{"type":434,"value":902}," }\n",{"type":428,"tag":466,"props":904,"children":905},{"class":468,"line":683},[906,911,915,919,923,927,931],{"type":428,"tag":466,"props":907,"children":908},{"style":870},[909],{"type":434,"value":910},"  delSub",{"type":428,"tag":466,"props":912,"children":913},{"style":489},[914],{"type":434,"value":878},{"type":428,"tag":466,"props":916,"children":917},{"style":605},[918],{"type":434,"value":883},{"type":428,"tag":466,"props":920,"children":921},{"style":489},[922],{"type":434,"value":888},{"type":428,"tag":466,"props":924,"children":925},{"style":489},[926],{"type":434,"value":529},{"type":428,"tag":466,"props":928,"children":929},{"style":473},[930],{"type":434,"value":897},{"type":428,"tag":466,"props":932,"children":933},{"style":489},[934],{"type":434,"value":902},{"type":428,"tag":466,"props":936,"children":938},{"class":468,"line":937},8,[939],{"type":428,"tag":466,"props":940,"children":941},{"style":473},[942],{"type":434,"value":943},"  // 执行数组中每一项函数\n",{"type":428,"tag":466,"props":945,"children":947},{"class":468,"line":946},9,[948,953,957,962,966,971,975],{"type":428,"tag":466,"props":949,"children":950},{"style":870},[951],{"type":434,"value":952},"  notify",{"type":428,"tag":466,"props":954,"children":955},{"style":489},[956],{"type":434,"value":878},{"type":428,"tag":466,"props":958,"children":959},{"style":605},[960],{"type":434,"value":961},"newVal",{"type":428,"tag":466,"props":963,"children":964},{"style":489},[965],{"type":434,"value":524},{"type":428,"tag":466,"props":967,"children":968},{"style":605},[969],{"type":434,"value":970}," oldVal",{"type":428,"tag":466,"props":972,"children":973},{"style":489},[974],{"type":434,"value":888},{"type":428,"tag":466,"props":976,"children":977},{"style":489},[978],{"type":434,"value":619},{"type":428,"tag":466,"props":980,"children":982},{"class":468,"line":981},10,[983,987,991,995,999,1004,1008,1013,1017,1022,1026,1030,1034,1038],{"type":428,"tag":466,"props":984,"children":985},{"style":826},[986],{"type":434,"value":829},{"type":428,"tag":466,"props":988,"children":989},{"style":489},[990],{"type":434,"value":492},{"type":428,"tag":466,"props":992,"children":993},{"style":483},[994],{"type":434,"value":838},{"type":428,"tag":466,"props":996,"children":997},{"style":489},[998],{"type":434,"value":492},{"type":428,"tag":466,"props":1000,"children":1001},{"style":495},[1002],{"type":434,"value":1003},"forEach",{"type":428,"tag":466,"props":1005,"children":1006},{"style":532},[1007],{"type":434,"value":503},{"type":428,"tag":466,"props":1009,"children":1010},{"style":605},[1011],{"type":434,"value":1012},"func",{"type":428,"tag":466,"props":1014,"children":1015},{"style":611},[1016],{"type":434,"value":614},{"type":428,"tag":466,"props":1018,"children":1019},{"style":495},[1020],{"type":434,"value":1021}," func",{"type":428,"tag":466,"props":1023,"children":1024},{"style":532},[1025],{"type":434,"value":503},{"type":428,"tag":466,"props":1027,"children":1028},{"style":483},[1029],{"type":434,"value":961},{"type":428,"tag":466,"props":1031,"children":1032},{"style":489},[1033],{"type":434,"value":524},{"type":428,"tag":466,"props":1035,"children":1036},{"style":483},[1037],{"type":434,"value":970},{"type":428,"tag":466,"props":1039,"children":1040},{"style":532},[1041],{"type":434,"value":1042},"))\n",{"type":428,"tag":466,"props":1044,"children":1046},{"class":468,"line":1045},11,[1047],{"type":428,"tag":466,"props":1048,"children":1049},{"style":489},[1050],{"type":434,"value":856},{"type":428,"tag":466,"props":1052,"children":1054},{"class":468,"line":1053},12,[1055],{"type":428,"tag":466,"props":1056,"children":1057},{"style":489},[1058],{"type":434,"value":1059},"}\n",{"type":428,"tag":436,"props":1061,"children":1062},{},[1063,1065,1071],{"type":434,"value":1064},"全局对象中每一个响应式属性(及其每一个子属性), 都应该和一个新的 Dep 实例保持一一对应的关系, 这样我们进行侦听变化, 执行订阅的回调函数时, 只需要找到对应的实例执行",{"type":428,"tag":442,"props":1066,"children":1068},{"className":1067},[],[1069],{"type":434,"value":1070},"notify",{"type":434,"value":1072},"通知更新即可.",{"type":428,"tag":429,"props":1074,"children":1076},{"id":1075},"设置响应式属性",[1077],{"type":434,"value":1075},{"type":428,"tag":1079,"props":1080,"children":1082},"h3",{"id":1081},"defineproperty",[1083],{"type":434,"value":1084},"defineProperty",{"type":428,"tag":436,"props":1086,"children":1087},{},[1088,1090,1095],{"type":434,"value":1089},"可能是因为接触 DefineProperty 要比接触 Proxy 早一些的缘故, 代码使用了前者进行响应式的实现, Object.defineProperty 方法会直接在一个对象上定义一个新属性, 这里快速过一遍",{"type":428,"tag":442,"props":1091,"children":1093},{"className":1092},[],[1094],{"type":434,"value":1084},{"type":434,"value":1096},"具体配置:",{"type":428,"tag":456,"props":1098,"children":1100},{"className":458,"code":1099,"language":460,"meta":421,"style":421},"// @param obj 要在其上定义属性的对象\n// @param key 要定义或修改的属性的名称\nObject.defineProperty(obj, key, {\n  // 该属性是否能被枚举\n  enumerable: true,\n  // 该属性能否被删除\n  configurable: true,\n  // 访问该属性则会执行此方法\n  get: () => {\n    return val\n  },\n  // 修改该属性时会执行此方法\n  set: newVal => {\n    val = newVal\n  },\n  // value & writeble 不能和 getter/setter 同时出现\n})\n",[1101],{"type":428,"tag":442,"props":1102,"children":1103},{"__ignoreMap":421},[1104,1112,1120,1158,1166,1189,1197,1217,1225,1249,1263,1271,1279,1304,1322,1330,1339],{"type":428,"tag":466,"props":1105,"children":1106},{"class":468,"line":469},[1107],{"type":428,"tag":466,"props":1108,"children":1109},{"style":473},[1110],{"type":434,"value":1111},"// @param obj 要在其上定义属性的对象\n",{"type":428,"tag":466,"props":1113,"children":1114},{"class":468,"line":479},[1115],{"type":428,"tag":466,"props":1116,"children":1117},{"style":473},[1118],{"type":434,"value":1119},"// @param key 要定义或修改的属性的名称\n",{"type":428,"tag":466,"props":1121,"children":1122},{"class":468,"line":558},[1123,1128,1132,1136,1141,1145,1150,1154],{"type":428,"tag":466,"props":1124,"children":1125},{"style":483},[1126],{"type":434,"value":1127},"Object",{"type":428,"tag":466,"props":1129,"children":1130},{"style":489},[1131],{"type":434,"value":492},{"type":428,"tag":466,"props":1133,"children":1134},{"style":495},[1135],{"type":434,"value":1084},{"type":428,"tag":466,"props":1137,"children":1138},{"style":483},[1139],{"type":434,"value":1140},"(obj",{"type":428,"tag":466,"props":1142,"children":1143},{"style":489},[1144],{"type":434,"value":524},{"type":428,"tag":466,"props":1146,"children":1147},{"style":483},[1148],{"type":434,"value":1149}," key",{"type":428,"tag":466,"props":1151,"children":1152},{"style":489},[1153],{"type":434,"value":524},{"type":428,"tag":466,"props":1155,"children":1156},{"style":489},[1157],{"type":434,"value":619},{"type":428,"tag":466,"props":1159,"children":1160},{"class":468,"line":567},[1161],{"type":428,"tag":466,"props":1162,"children":1163},{"style":473},[1164],{"type":434,"value":1165},"  // 该属性是否能被枚举\n",{"type":428,"tag":466,"props":1167,"children":1168},{"class":468,"line":622},[1169,1174,1178,1184],{"type":428,"tag":466,"props":1170,"children":1171},{"style":532},[1172],{"type":434,"value":1173},"  enumerable",{"type":428,"tag":466,"props":1175,"children":1176},{"style":489},[1177],{"type":434,"value":540},{"type":428,"tag":466,"props":1179,"children":1181},{"style":1180},"--shiki-light:#FF5370;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[1182],{"type":434,"value":1183}," true",{"type":428,"tag":466,"props":1185,"children":1186},{"style":489},[1187],{"type":434,"value":1188},",\n",{"type":428,"tag":466,"props":1190,"children":1191},{"class":468,"line":670},[1192],{"type":428,"tag":466,"props":1193,"children":1194},{"style":473},[1195],{"type":434,"value":1196},"  // 该属性能否被删除\n",{"type":428,"tag":466,"props":1198,"children":1199},{"class":468,"line":683},[1200,1205,1209,1213],{"type":428,"tag":466,"props":1201,"children":1202},{"style":532},[1203],{"type":434,"value":1204},"  configurable",{"type":428,"tag":466,"props":1206,"children":1207},{"style":489},[1208],{"type":434,"value":540},{"type":428,"tag":466,"props":1210,"children":1211},{"style":1180},[1212],{"type":434,"value":1183},{"type":428,"tag":466,"props":1214,"children":1215},{"style":489},[1216],{"type":434,"value":1188},{"type":428,"tag":466,"props":1218,"children":1219},{"class":468,"line":937},[1220],{"type":428,"tag":466,"props":1221,"children":1222},{"style":473},[1223],{"type":434,"value":1224},"  // 访问该属性则会执行此方法\n",{"type":428,"tag":466,"props":1226,"children":1227},{"class":468,"line":946},[1228,1233,1237,1241,1245],{"type":428,"tag":466,"props":1229,"children":1230},{"style":495},[1231],{"type":434,"value":1232},"  get",{"type":428,"tag":466,"props":1234,"children":1235},{"style":489},[1236],{"type":434,"value":540},{"type":428,"tag":466,"props":1238,"children":1239},{"style":489},[1240],{"type":434,"value":816},{"type":428,"tag":466,"props":1242,"children":1243},{"style":611},[1244],{"type":434,"value":614},{"type":428,"tag":466,"props":1246,"children":1247},{"style":489},[1248],{"type":434,"value":619},{"type":428,"tag":466,"props":1250,"children":1251},{"class":468,"line":981},[1252,1258],{"type":428,"tag":466,"props":1253,"children":1255},{"style":1254},"--shiki-light:#39ADB5;--shiki-light-font-style:italic;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#F92672;--shiki-sepia-font-style:inherit",[1256],{"type":434,"value":1257},"    return",{"type":428,"tag":466,"props":1259,"children":1260},{"style":483},[1261],{"type":434,"value":1262}," val\n",{"type":428,"tag":466,"props":1264,"children":1265},{"class":468,"line":1045},[1266],{"type":428,"tag":466,"props":1267,"children":1268},{"style":489},[1269],{"type":434,"value":1270},"  },\n",{"type":428,"tag":466,"props":1272,"children":1273},{"class":468,"line":1053},[1274],{"type":428,"tag":466,"props":1275,"children":1276},{"style":473},[1277],{"type":434,"value":1278},"  // 修改该属性时会执行此方法\n",{"type":428,"tag":466,"props":1280,"children":1282},{"class":468,"line":1281},13,[1283,1288,1292,1296,1300],{"type":428,"tag":466,"props":1284,"children":1285},{"style":495},[1286],{"type":434,"value":1287},"  set",{"type":428,"tag":466,"props":1289,"children":1290},{"style":489},[1291],{"type":434,"value":540},{"type":428,"tag":466,"props":1293,"children":1294},{"style":605},[1295],{"type":434,"value":608},{"type":428,"tag":466,"props":1297,"children":1298},{"style":611},[1299],{"type":434,"value":614},{"type":428,"tag":466,"props":1301,"children":1302},{"style":489},[1303],{"type":434,"value":619},{"type":428,"tag":466,"props":1305,"children":1307},{"class":468,"line":1306},14,[1308,1313,1317],{"type":428,"tag":466,"props":1309,"children":1310},{"style":483},[1311],{"type":434,"value":1312},"    val",{"type":428,"tag":466,"props":1314,"children":1315},{"style":719},[1316],{"type":434,"value":843},{"type":428,"tag":466,"props":1318,"children":1319},{"style":483},[1320],{"type":434,"value":1321}," newVal\n",{"type":428,"tag":466,"props":1323,"children":1325},{"class":468,"line":1324},15,[1326],{"type":428,"tag":466,"props":1327,"children":1328},{"style":489},[1329],{"type":434,"value":1270},{"type":428,"tag":466,"props":1331,"children":1333},{"class":468,"line":1332},16,[1334],{"type":428,"tag":466,"props":1335,"children":1336},{"style":473},[1337],{"type":434,"value":1338},"  // value & writeble 不能和 getter/setter 同时出现\n",{"type":428,"tag":466,"props":1340,"children":1342},{"class":468,"line":1341},17,[1343,1347],{"type":428,"tag":466,"props":1344,"children":1345},{"style":489},[1346],{"type":434,"value":676},{"type":428,"tag":466,"props":1348,"children":1349},{"style":483},[1350],{"type":434,"value":555},{"type":428,"tag":436,"props":1352,"children":1353},{},[1354],{"type":434,"value":1355},"通过对 defineProperty 进行上层封装, 我们可以轻松的实现在全局对象上设置响应式属性功能, 在此, 我们结合刚才定义的 Dep 对象, 将一个新的 dep 实例绑定到新增属性的 setter 中:",{"type":428,"tag":456,"props":1357,"children":1359},{"className":458,"code":1358,"language":460,"meta":421,"style":421},"set (key, val, options = {}, obj = this.store) {\n  const dep = new Dep()\n  Object.defineProperty(obj, key, {\n    enumerable: true,\n    configurable: true,\n    get: () => {\n      return val\n    },\n    set: newVal => {\n      if (newVal === val) {\n        return\n      }\n      dep.notify(newVal, val)\n      val = newVal\n    }\n  })\n}\n",[1360],{"type":428,"tag":442,"props":1361,"children":1362},{"__ignoreMap":421},[1363,1429,1461,1502,1522,1542,1566,1578,1586,1610,1644,1652,1660,1696,1712,1720,1732],{"type":428,"tag":466,"props":1364,"children":1365},{"class":468,"line":469},[1366,1370,1375,1379,1383,1387,1392,1396,1401,1406,1410,1415,1419,1424],{"type":428,"tag":466,"props":1367,"children":1368},{"style":495},[1369],{"type":434,"value":498},{"type":428,"tag":466,"props":1371,"children":1372},{"style":483},[1373],{"type":434,"value":1374}," (key",{"type":428,"tag":466,"props":1376,"children":1377},{"style":489},[1378],{"type":434,"value":524},{"type":428,"tag":466,"props":1380,"children":1381},{"style":483},[1382],{"type":434,"value":535},{"type":428,"tag":466,"props":1384,"children":1385},{"style":489},[1386],{"type":434,"value":524},{"type":428,"tag":466,"props":1388,"children":1389},{"style":483},[1390],{"type":434,"value":1391}," options ",{"type":428,"tag":466,"props":1393,"children":1394},{"style":719},[1395],{"type":434,"value":722},{"type":428,"tag":466,"props":1397,"children":1398},{"style":489},[1399],{"type":434,"value":1400}," {},",{"type":428,"tag":466,"props":1402,"children":1403},{"style":483},[1404],{"type":434,"value":1405}," obj ",{"type":428,"tag":466,"props":1407,"children":1408},{"style":719},[1409],{"type":434,"value":722},{"type":428,"tag":466,"props":1411,"children":1412},{"style":826},[1413],{"type":434,"value":1414}," this",{"type":428,"tag":466,"props":1416,"children":1417},{"style":489},[1418],{"type":434,"value":492},{"type":428,"tag":466,"props":1420,"children":1421},{"style":483},[1422],{"type":434,"value":1423},"store) ",{"type":428,"tag":466,"props":1425,"children":1426},{"style":489},[1427],{"type":434,"value":1428},"{\n",{"type":428,"tag":466,"props":1430,"children":1431},{"class":468,"line":479},[1432,1437,1443,1447,1452,1456],{"type":428,"tag":466,"props":1433,"children":1434},{"style":611},[1435],{"type":434,"value":1436},"  const",{"type":428,"tag":466,"props":1438,"children":1440},{"style":1439},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#F8F8F2",[1441],{"type":434,"value":1442}," dep",{"type":428,"tag":466,"props":1444,"children":1445},{"style":719},[1446],{"type":434,"value":843},{"type":428,"tag":466,"props":1448,"children":1449},{"style":719},[1450],{"type":434,"value":1451}," new",{"type":428,"tag":466,"props":1453,"children":1454},{"style":495},[1455],{"type":434,"value":799},{"type":428,"tag":466,"props":1457,"children":1458},{"style":532},[1459],{"type":434,"value":1460},"()\n",{"type":428,"tag":466,"props":1462,"children":1463},{"class":468,"line":558},[1464,1469,1473,1477,1481,1486,1490,1494,1498],{"type":428,"tag":466,"props":1465,"children":1466},{"style":483},[1467],{"type":434,"value":1468},"  Object",{"type":428,"tag":466,"props":1470,"children":1471},{"style":489},[1472],{"type":434,"value":492},{"type":428,"tag":466,"props":1474,"children":1475},{"style":495},[1476],{"type":434,"value":1084},{"type":428,"tag":466,"props":1478,"children":1479},{"style":532},[1480],{"type":434,"value":503},{"type":428,"tag":466,"props":1482,"children":1483},{"style":483},[1484],{"type":434,"value":1485},"obj",{"type":428,"tag":466,"props":1487,"children":1488},{"style":489},[1489],{"type":434,"value":524},{"type":428,"tag":466,"props":1491,"children":1492},{"style":483},[1493],{"type":434,"value":1149},{"type":428,"tag":466,"props":1495,"children":1496},{"style":489},[1497],{"type":434,"value":524},{"type":428,"tag":466,"props":1499,"children":1500},{"style":489},[1501],{"type":434,"value":619},{"type":428,"tag":466,"props":1503,"children":1504},{"class":468,"line":567},[1505,1510,1514,1518],{"type":428,"tag":466,"props":1506,"children":1507},{"style":532},[1508],{"type":434,"value":1509},"    enumerable",{"type":428,"tag":466,"props":1511,"children":1512},{"style":489},[1513],{"type":434,"value":540},{"type":428,"tag":466,"props":1515,"children":1516},{"style":1180},[1517],{"type":434,"value":1183},{"type":428,"tag":466,"props":1519,"children":1520},{"style":489},[1521],{"type":434,"value":1188},{"type":428,"tag":466,"props":1523,"children":1524},{"class":468,"line":622},[1525,1530,1534,1538],{"type":428,"tag":466,"props":1526,"children":1527},{"style":532},[1528],{"type":434,"value":1529},"    configurable",{"type":428,"tag":466,"props":1531,"children":1532},{"style":489},[1533],{"type":434,"value":540},{"type":428,"tag":466,"props":1535,"children":1536},{"style":1180},[1537],{"type":434,"value":1183},{"type":428,"tag":466,"props":1539,"children":1540},{"style":489},[1541],{"type":434,"value":1188},{"type":428,"tag":466,"props":1543,"children":1544},{"class":468,"line":670},[1545,1550,1554,1558,1562],{"type":428,"tag":466,"props":1546,"children":1547},{"style":495},[1548],{"type":434,"value":1549},"    get",{"type":428,"tag":466,"props":1551,"children":1552},{"style":489},[1553],{"type":434,"value":540},{"type":428,"tag":466,"props":1555,"children":1556},{"style":489},[1557],{"type":434,"value":816},{"type":428,"tag":466,"props":1559,"children":1560},{"style":611},[1561],{"type":434,"value":614},{"type":428,"tag":466,"props":1563,"children":1564},{"style":489},[1565],{"type":434,"value":619},{"type":428,"tag":466,"props":1567,"children":1568},{"class":468,"line":683},[1569,1574],{"type":428,"tag":466,"props":1570,"children":1571},{"style":1254},[1572],{"type":434,"value":1573},"      return",{"type":428,"tag":466,"props":1575,"children":1576},{"style":483},[1577],{"type":434,"value":1262},{"type":428,"tag":466,"props":1579,"children":1580},{"class":468,"line":937},[1581],{"type":428,"tag":466,"props":1582,"children":1583},{"style":489},[1584],{"type":434,"value":1585},"    },\n",{"type":428,"tag":466,"props":1587,"children":1588},{"class":468,"line":946},[1589,1594,1598,1602,1606],{"type":428,"tag":466,"props":1590,"children":1591},{"style":495},[1592],{"type":434,"value":1593},"    set",{"type":428,"tag":466,"props":1595,"children":1596},{"style":489},[1597],{"type":434,"value":540},{"type":428,"tag":466,"props":1599,"children":1600},{"style":605},[1601],{"type":434,"value":608},{"type":428,"tag":466,"props":1603,"children":1604},{"style":611},[1605],{"type":434,"value":614},{"type":428,"tag":466,"props":1607,"children":1608},{"style":489},[1609],{"type":434,"value":619},{"type":428,"tag":466,"props":1611,"children":1612},{"class":468,"line":981},[1613,1618,1622,1626,1631,1635,1640],{"type":428,"tag":466,"props":1614,"children":1615},{"style":1254},[1616],{"type":434,"value":1617},"      if",{"type":428,"tag":466,"props":1619,"children":1620},{"style":532},[1621],{"type":434,"value":878},{"type":428,"tag":466,"props":1623,"children":1624},{"style":483},[1625],{"type":434,"value":961},{"type":428,"tag":466,"props":1627,"children":1628},{"style":719},[1629],{"type":434,"value":1630}," ===",{"type":428,"tag":466,"props":1632,"children":1633},{"style":483},[1634],{"type":434,"value":535},{"type":428,"tag":466,"props":1636,"children":1637},{"style":532},[1638],{"type":434,"value":1639},") ",{"type":428,"tag":466,"props":1641,"children":1642},{"style":489},[1643],{"type":434,"value":1428},{"type":428,"tag":466,"props":1645,"children":1646},{"class":468,"line":1045},[1647],{"type":428,"tag":466,"props":1648,"children":1649},{"style":1254},[1650],{"type":434,"value":1651},"        return\n",{"type":428,"tag":466,"props":1653,"children":1654},{"class":468,"line":1053},[1655],{"type":428,"tag":466,"props":1656,"children":1657},{"style":489},[1658],{"type":434,"value":1659},"      }\n",{"type":428,"tag":466,"props":1661,"children":1662},{"class":468,"line":1281},[1663,1668,1672,1676,1680,1684,1688,1692],{"type":428,"tag":466,"props":1664,"children":1665},{"style":483},[1666],{"type":434,"value":1667},"      dep",{"type":428,"tag":466,"props":1669,"children":1670},{"style":489},[1671],{"type":434,"value":492},{"type":428,"tag":466,"props":1673,"children":1674},{"style":495},[1675],{"type":434,"value":1070},{"type":428,"tag":466,"props":1677,"children":1678},{"style":532},[1679],{"type":434,"value":503},{"type":428,"tag":466,"props":1681,"children":1682},{"style":483},[1683],{"type":434,"value":961},{"type":428,"tag":466,"props":1685,"children":1686},{"style":489},[1687],{"type":434,"value":524},{"type":428,"tag":466,"props":1689,"children":1690},{"style":483},[1691],{"type":434,"value":535},{"type":428,"tag":466,"props":1693,"children":1694},{"style":532},[1695],{"type":434,"value":555},{"type":428,"tag":466,"props":1697,"children":1698},{"class":468,"line":1306},[1699,1704,1708],{"type":428,"tag":466,"props":1700,"children":1701},{"style":483},[1702],{"type":434,"value":1703},"      val",{"type":428,"tag":466,"props":1705,"children":1706},{"style":719},[1707],{"type":434,"value":843},{"type":428,"tag":466,"props":1709,"children":1710},{"style":483},[1711],{"type":434,"value":1321},{"type":428,"tag":466,"props":1713,"children":1714},{"class":468,"line":1324},[1715],{"type":428,"tag":466,"props":1716,"children":1717},{"style":489},[1718],{"type":434,"value":1719},"    }\n",{"type":428,"tag":466,"props":1721,"children":1722},{"class":468,"line":1332},[1723,1728],{"type":428,"tag":466,"props":1724,"children":1725},{"style":489},[1726],{"type":434,"value":1727},"  }",{"type":428,"tag":466,"props":1729,"children":1730},{"style":532},[1731],{"type":434,"value":555},{"type":428,"tag":466,"props":1733,"children":1734},{"class":468,"line":1341},[1735],{"type":428,"tag":466,"props":1736,"children":1737},{"style":489},[1738],{"type":434,"value":1059},{"type":428,"tag":436,"props":1740,"children":1741},{},[1742],{"type":434,"value":1743},"每当对应属性被赋值, 就会执行依赖数组中的回调函数.",{"type":428,"tag":436,"props":1745,"children":1746},{},[1747],{"type":434,"value":1748},"不过这样还不够, 我们还得想办法获取到这个 dep 实例, 才能给它的依赖数组填充函数.",{"type":428,"tag":436,"props":1750,"children":1751},{},[1752],{"type":434,"value":1753},"这边提供一个很简单的思路, 并不推荐实践中这么做:",{"type":428,"tag":456,"props":1755,"children":1757},{"className":458,"code":1756,"language":460,"meta":421,"style":421},"set (key, val, options = {}, obj = this.store) {\n  const dep = new Dep()\n  Object.defineProperty(obj, key, {})\n  return dep\n}\n",[1758],{"type":428,"tag":442,"props":1759,"children":1760},{"__ignoreMap":421},[1761,1820,1847,1891,1904],{"type":428,"tag":466,"props":1762,"children":1763},{"class":468,"line":469},[1764,1768,1772,1776,1780,1784,1788,1792,1796,1800,1804,1808,1812,1816],{"type":428,"tag":466,"props":1765,"children":1766},{"style":495},[1767],{"type":434,"value":498},{"type":428,"tag":466,"props":1769,"children":1770},{"style":483},[1771],{"type":434,"value":1374},{"type":428,"tag":466,"props":1773,"children":1774},{"style":489},[1775],{"type":434,"value":524},{"type":428,"tag":466,"props":1777,"children":1778},{"style":483},[1779],{"type":434,"value":535},{"type":428,"tag":466,"props":1781,"children":1782},{"style":489},[1783],{"type":434,"value":524},{"type":428,"tag":466,"props":1785,"children":1786},{"style":483},[1787],{"type":434,"value":1391},{"type":428,"tag":466,"props":1789,"children":1790},{"style":719},[1791],{"type":434,"value":722},{"type":428,"tag":466,"props":1793,"children":1794},{"style":489},[1795],{"type":434,"value":1400},{"type":428,"tag":466,"props":1797,"children":1798},{"style":483},[1799],{"type":434,"value":1405},{"type":428,"tag":466,"props":1801,"children":1802},{"style":719},[1803],{"type":434,"value":722},{"type":428,"tag":466,"props":1805,"children":1806},{"style":826},[1807],{"type":434,"value":1414},{"type":428,"tag":466,"props":1809,"children":1810},{"style":489},[1811],{"type":434,"value":492},{"type":428,"tag":466,"props":1813,"children":1814},{"style":483},[1815],{"type":434,"value":1423},{"type":428,"tag":466,"props":1817,"children":1818},{"style":489},[1819],{"type":434,"value":1428},{"type":428,"tag":466,"props":1821,"children":1822},{"class":468,"line":479},[1823,1827,1831,1835,1839,1843],{"type":428,"tag":466,"props":1824,"children":1825},{"style":611},[1826],{"type":434,"value":1436},{"type":428,"tag":466,"props":1828,"children":1829},{"style":1439},[1830],{"type":434,"value":1442},{"type":428,"tag":466,"props":1832,"children":1833},{"style":719},[1834],{"type":434,"value":843},{"type":428,"tag":466,"props":1836,"children":1837},{"style":719},[1838],{"type":434,"value":1451},{"type":428,"tag":466,"props":1840,"children":1841},{"style":495},[1842],{"type":434,"value":799},{"type":428,"tag":466,"props":1844,"children":1845},{"style":532},[1846],{"type":434,"value":1460},{"type":428,"tag":466,"props":1848,"children":1849},{"class":468,"line":558},[1850,1854,1858,1862,1866,1870,1874,1878,1882,1887],{"type":428,"tag":466,"props":1851,"children":1852},{"style":483},[1853],{"type":434,"value":1468},{"type":428,"tag":466,"props":1855,"children":1856},{"style":489},[1857],{"type":434,"value":492},{"type":428,"tag":466,"props":1859,"children":1860},{"style":495},[1861],{"type":434,"value":1084},{"type":428,"tag":466,"props":1863,"children":1864},{"style":532},[1865],{"type":434,"value":503},{"type":428,"tag":466,"props":1867,"children":1868},{"style":483},[1869],{"type":434,"value":1485},{"type":428,"tag":466,"props":1871,"children":1872},{"style":489},[1873],{"type":434,"value":524},{"type":428,"tag":466,"props":1875,"children":1876},{"style":483},[1877],{"type":434,"value":1149},{"type":428,"tag":466,"props":1879,"children":1880},{"style":489},[1881],{"type":434,"value":524},{"type":428,"tag":466,"props":1883,"children":1884},{"style":489},[1885],{"type":434,"value":1886}," {}",{"type":428,"tag":466,"props":1888,"children":1889},{"style":532},[1890],{"type":434,"value":555},{"type":428,"tag":466,"props":1892,"children":1893},{"class":468,"line":567},[1894,1899],{"type":428,"tag":466,"props":1895,"children":1896},{"style":1254},[1897],{"type":434,"value":1898},"  return",{"type":428,"tag":466,"props":1900,"children":1901},{"style":483},[1902],{"type":434,"value":1903}," dep\n",{"type":428,"tag":466,"props":1905,"children":1906},{"class":468,"line":622},[1907],{"type":428,"tag":466,"props":1908,"children":1909},{"style":489},[1910],{"type":434,"value":1059},{"type":428,"tag":456,"props":1912,"children":1914},{"className":458,"code":1913,"language":460,"meta":421,"style":421},"const valueDep = set('value', b, {})\nvalueDep.addSub(() => { console.log('value changed!') })\n",[1915],{"type":428,"tag":442,"props":1916,"children":1917},{"__ignoreMap":421},[1918,1977],{"type":428,"tag":466,"props":1919,"children":1920},{"class":468,"line":469},[1921,1926,1931,1935,1940,1944,1948,1952,1956,1960,1965,1969,1973],{"type":428,"tag":466,"props":1922,"children":1923},{"style":611},[1924],{"type":434,"value":1925},"const",{"type":428,"tag":466,"props":1927,"children":1928},{"style":1439},[1929],{"type":434,"value":1930}," valueDep",{"type":428,"tag":466,"props":1932,"children":1933},{"style":719},[1934],{"type":434,"value":843},{"type":428,"tag":466,"props":1936,"children":1937},{"style":495},[1938],{"type":434,"value":1939}," set",{"type":428,"tag":466,"props":1941,"children":1942},{"style":483},[1943],{"type":434,"value":503},{"type":428,"tag":466,"props":1945,"children":1946},{"style":506},[1947],{"type":434,"value":509},{"type":428,"tag":466,"props":1949,"children":1950},{"style":512},[1951],{"type":434,"value":689},{"type":428,"tag":466,"props":1953,"children":1954},{"style":506},[1955],{"type":434,"value":509},{"type":428,"tag":466,"props":1957,"children":1958},{"style":489},[1959],{"type":434,"value":524},{"type":428,"tag":466,"props":1961,"children":1962},{"style":483},[1963],{"type":434,"value":1964}," b",{"type":428,"tag":466,"props":1966,"children":1967},{"style":489},[1968],{"type":434,"value":524},{"type":428,"tag":466,"props":1970,"children":1971},{"style":489},[1972],{"type":434,"value":1886},{"type":428,"tag":466,"props":1974,"children":1975},{"style":483},[1976],{"type":434,"value":555},{"type":428,"tag":466,"props":1978,"children":1979},{"class":468,"line":479},[1980,1985,1989,1994,1998,2003,2007,2011,2016,2020,2024,2028,2032,2037,2041,2045,2049],{"type":428,"tag":466,"props":1981,"children":1982},{"style":483},[1983],{"type":434,"value":1984},"valueDep",{"type":428,"tag":466,"props":1986,"children":1987},{"style":489},[1988],{"type":434,"value":492},{"type":428,"tag":466,"props":1990,"children":1991},{"style":495},[1992],{"type":434,"value":1993},"addSub",{"type":428,"tag":466,"props":1995,"children":1996},{"style":483},[1997],{"type":434,"value":503},{"type":428,"tag":466,"props":1999,"children":2000},{"style":489},[2001],{"type":434,"value":2002},"()",{"type":428,"tag":466,"props":2004,"children":2005},{"style":611},[2006],{"type":434,"value":614},{"type":428,"tag":466,"props":2008,"children":2009},{"style":489},[2010],{"type":434,"value":529},{"type":428,"tag":466,"props":2012,"children":2013},{"style":483},[2014],{"type":434,"value":2015}," console",{"type":428,"tag":466,"props":2017,"children":2018},{"style":489},[2019],{"type":434,"value":492},{"type":428,"tag":466,"props":2021,"children":2022},{"style":495},[2023],{"type":434,"value":637},{"type":428,"tag":466,"props":2025,"children":2026},{"style":532},[2027],{"type":434,"value":503},{"type":428,"tag":466,"props":2029,"children":2030},{"style":506},[2031],{"type":434,"value":509},{"type":428,"tag":466,"props":2033,"children":2034},{"style":512},[2035],{"type":434,"value":2036},"value changed!",{"type":428,"tag":466,"props":2038,"children":2039},{"style":506},[2040],{"type":434,"value":509},{"type":428,"tag":466,"props":2042,"children":2043},{"style":532},[2044],{"type":434,"value":1639},{"type":428,"tag":466,"props":2046,"children":2047},{"style":489},[2048],{"type":434,"value":676},{"type":428,"tag":466,"props":2050,"children":2051},{"style":483},[2052],{"type":434,"value":555},{"type":428,"tag":436,"props":2054,"children":2055},{},[2056],{"type":434,"value":2057},"虽然代码能使用了, 就是是看起来怪怪的~ 😋 我们的三轮车开进了岔路~",{"type":428,"tag":429,"props":2059,"children":2061},{"id":2060},"通过-watch-添加订阅",[2062],{"type":434,"value":2063},"通过 watch 添加订阅",{"type":428,"tag":1079,"props":2065,"children":2067},{"id":2066},"喝口水我们继续",[2068],{"type":434,"value":2066},{"type":428,"tag":436,"props":2070,"children":2071},{},[2072],{"type":434,"value":2073},"《黑客与画家》中曾经提到这样一个观点, 我深有体会:",{"type":428,"tag":2075,"props":2076,"children":2077},"blockquote",{},[2078],{"type":428,"tag":436,"props":2079,"children":2080},{},[2081],{"type":434,"value":2082},"如果你觉得你的代码奇怪, 那么往往它是错的",{"type":428,"tag":436,"props":2084,"children":2085},{},[2086],{"type":434,"value":2087},"上面的那一串代码仅仅是能跑通的水平, 我们需要加入更多的细节和思考, 有时候只需要坐下来稍微看一下代码, 就会有各种想法蹦出来:",{"type":428,"tag":2075,"props":2089,"children":2090},{},[2091],{"type":428,"tag":436,"props":2092,"children":2093},{},[2094],{"type":434,"value":2095},"构思这种东西有一个特点，那就是它会导致更多的构思。你有没有注意过，坐下来写东西的时候，一半的构思是写作时产生的？",{"type":428,"tag":1079,"props":2097,"children":2099},{"id":2098},"隐藏-dep",[2100],{"type":434,"value":2101},"隐藏 Dep",{"type":428,"tag":436,"props":2103,"children":2104},{},[2105],{"type":434,"value":2106},"这些内容应和外部是解耦的. 首先一点, 我们创建一个侦听器类, 用于封装我们侦听所用到的所有方法, 它包含了我们想要的全局对象以及操作它的方法(如 watch,set):",{"type":428,"tag":456,"props":2108,"children":2110},{"className":458,"code":2109,"language":460,"meta":421,"style":421},"class VX {\n  constructor () {\n    this.store = Object.create(null)\n  }\n  watch (key, fn, obj = this.store) {}\n  set (key, val, options = {}, obj = this.store) {}\n}\nconst vx = new VX()\n",[2111],{"type":428,"tag":442,"props":2112,"children":2113},{"__ignoreMap":421},[2114,2130,2145,2193,2200,2260,2328,2335],{"type":428,"tag":466,"props":2115,"children":2116},{"class":468,"line":469},[2117,2121,2126],{"type":428,"tag":466,"props":2118,"children":2119},{"style":611},[2120],{"type":434,"value":793},{"type":428,"tag":466,"props":2122,"children":2123},{"style":796},[2124],{"type":434,"value":2125}," VX",{"type":428,"tag":466,"props":2127,"children":2128},{"style":489},[2129],{"type":434,"value":619},{"type":428,"tag":466,"props":2131,"children":2132},{"class":468,"line":479},[2133,2137,2141],{"type":428,"tag":466,"props":2134,"children":2135},{"style":611},[2136],{"type":434,"value":811},{"type":428,"tag":466,"props":2138,"children":2139},{"style":489},[2140],{"type":434,"value":816},{"type":428,"tag":466,"props":2142,"children":2143},{"style":489},[2144],{"type":434,"value":619},{"type":428,"tag":466,"props":2146,"children":2147},{"class":468,"line":558},[2148,2152,2156,2161,2165,2170,2174,2179,2183,2189],{"type":428,"tag":466,"props":2149,"children":2150},{"style":826},[2151],{"type":434,"value":829},{"type":428,"tag":466,"props":2153,"children":2154},{"style":489},[2155],{"type":434,"value":492},{"type":428,"tag":466,"props":2157,"children":2158},{"style":483},[2159],{"type":434,"value":2160},"store",{"type":428,"tag":466,"props":2162,"children":2163},{"style":719},[2164],{"type":434,"value":843},{"type":428,"tag":466,"props":2166,"children":2167},{"style":483},[2168],{"type":434,"value":2169}," Object",{"type":428,"tag":466,"props":2171,"children":2172},{"style":489},[2173],{"type":434,"value":492},{"type":428,"tag":466,"props":2175,"children":2176},{"style":495},[2177],{"type":434,"value":2178},"create",{"type":428,"tag":466,"props":2180,"children":2181},{"style":532},[2182],{"type":434,"value":503},{"type":428,"tag":466,"props":2184,"children":2186},{"style":2185},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[2187],{"type":434,"value":2188},"null",{"type":428,"tag":466,"props":2190,"children":2191},{"style":532},[2192],{"type":434,"value":555},{"type":428,"tag":466,"props":2194,"children":2195},{"class":468,"line":567},[2196],{"type":428,"tag":466,"props":2197,"children":2198},{"style":489},[2199],{"type":434,"value":856},{"type":428,"tag":466,"props":2201,"children":2202},{"class":468,"line":622},[2203,2208,2212,2217,2221,2226,2230,2235,2239,2243,2247,2251,2255],{"type":428,"tag":466,"props":2204,"children":2205},{"style":870},[2206],{"type":434,"value":2207},"  watch",{"type":428,"tag":466,"props":2209,"children":2210},{"style":489},[2211],{"type":434,"value":878},{"type":428,"tag":466,"props":2213,"children":2214},{"style":605},[2215],{"type":434,"value":2216},"key",{"type":428,"tag":466,"props":2218,"children":2219},{"style":489},[2220],{"type":434,"value":524},{"type":428,"tag":466,"props":2222,"children":2223},{"style":605},[2224],{"type":434,"value":2225}," fn",{"type":428,"tag":466,"props":2227,"children":2228},{"style":489},[2229],{"type":434,"value":524},{"type":428,"tag":466,"props":2231,"children":2232},{"style":605},[2233],{"type":434,"value":2234}," obj",{"type":428,"tag":466,"props":2236,"children":2237},{"style":719},[2238],{"type":434,"value":843},{"type":428,"tag":466,"props":2240,"children":2241},{"style":826},[2242],{"type":434,"value":1414},{"type":428,"tag":466,"props":2244,"children":2245},{"style":489},[2246],{"type":434,"value":492},{"type":428,"tag":466,"props":2248,"children":2249},{"style":483},[2250],{"type":434,"value":2160},{"type":428,"tag":466,"props":2252,"children":2253},{"style":489},[2254],{"type":434,"value":888},{"type":428,"tag":466,"props":2256,"children":2257},{"style":489},[2258],{"type":434,"value":2259}," {}\n",{"type":428,"tag":466,"props":2261,"children":2262},{"class":468,"line":670},[2263,2267,2271,2275,2279,2283,2287,2292,2296,2300,2304,2308,2312,2316,2320,2324],{"type":428,"tag":466,"props":2264,"children":2265},{"style":870},[2266],{"type":434,"value":1287},{"type":428,"tag":466,"props":2268,"children":2269},{"style":489},[2270],{"type":434,"value":878},{"type":428,"tag":466,"props":2272,"children":2273},{"style":605},[2274],{"type":434,"value":2216},{"type":428,"tag":466,"props":2276,"children":2277},{"style":489},[2278],{"type":434,"value":524},{"type":428,"tag":466,"props":2280,"children":2281},{"style":605},[2282],{"type":434,"value":535},{"type":428,"tag":466,"props":2284,"children":2285},{"style":489},[2286],{"type":434,"value":524},{"type":428,"tag":466,"props":2288,"children":2289},{"style":605},[2290],{"type":434,"value":2291}," options",{"type":428,"tag":466,"props":2293,"children":2294},{"style":719},[2295],{"type":434,"value":843},{"type":428,"tag":466,"props":2297,"children":2298},{"style":489},[2299],{"type":434,"value":1400},{"type":428,"tag":466,"props":2301,"children":2302},{"style":605},[2303],{"type":434,"value":2234},{"type":428,"tag":466,"props":2305,"children":2306},{"style":719},[2307],{"type":434,"value":843},{"type":428,"tag":466,"props":2309,"children":2310},{"style":826},[2311],{"type":434,"value":1414},{"type":428,"tag":466,"props":2313,"children":2314},{"style":489},[2315],{"type":434,"value":492},{"type":428,"tag":466,"props":2317,"children":2318},{"style":483},[2319],{"type":434,"value":2160},{"type":428,"tag":466,"props":2321,"children":2322},{"style":489},[2323],{"type":434,"value":888},{"type":428,"tag":466,"props":2325,"children":2326},{"style":489},[2327],{"type":434,"value":2259},{"type":428,"tag":466,"props":2329,"children":2330},{"class":468,"line":683},[2331],{"type":428,"tag":466,"props":2332,"children":2333},{"style":489},[2334],{"type":434,"value":1059},{"type":428,"tag":466,"props":2336,"children":2337},{"class":468,"line":937},[2338,2342,2347,2351,2355,2359],{"type":428,"tag":466,"props":2339,"children":2340},{"style":611},[2341],{"type":434,"value":1925},{"type":428,"tag":466,"props":2343,"children":2344},{"style":1439},[2345],{"type":434,"value":2346}," vx",{"type":428,"tag":466,"props":2348,"children":2349},{"style":719},[2350],{"type":434,"value":843},{"type":428,"tag":466,"props":2352,"children":2353},{"style":719},[2354],{"type":434,"value":1451},{"type":428,"tag":466,"props":2356,"children":2357},{"style":495},[2358],{"type":434,"value":2125},{"type":428,"tag":466,"props":2360,"children":2361},{"style":483},[2362],{"type":434,"value":1460},{"type":428,"tag":436,"props":2364,"children":2365},{},[2366],{"type":434,"value":2367},"我们可以在 watch 中给对象某个属性添加回调, 就不用去直接操作 Dep 依赖数组了. 只是, 我们在业务代码中调用 watch, 要怎么去获取 obj.key 对应的 dep 呢?",{"type":428,"tag":436,"props":2369,"children":2370},{},[2371],{"type":434,"value":2372},"我们设置一个全局的 depHandler, 在 obj.key 的 getter 中主动将 depHandler 设置为当前 obj.key 的 dep 实例, 那么我们在 watch 函数里, 只要用任意操作触发 obj.key 的 getter, 就能通过 depHandler 得到它的 dep 实例了, 代码形如:",{"type":428,"tag":456,"props":2374,"children":2376},{"className":458,"code":2375,"language":460,"meta":421,"style":421},"  // 一开始没有持有dep实例\n  let handleDep = null\n  class VX {\n    watch (key, fn, obj = this.store) {\n      console.log(obj.key) // 使用任意操作触发obj.key的getter, 那么handleDep将自动引用obj.key的dep实例\n      handleDep.addSub(fn)\n    }\n    set (key, val, options = {}, obj = this.store) {\n      const dep = new Dep()\n      Object.defineProperty(obj, key, {\n        enumerable: true,\n        configurable: true,\n        get: () => {\n          handleDep = dep\n          return val\n        },\n        set: newVal => {}\n      })\n    }\n  }\n",[2377],{"type":428,"tag":442,"props":2378,"children":2379},{"__ignoreMap":421},[2380,2388,2410,2426,2482,2523,2551,2558,2625,2653,2693,2713,2733,2757,2773,2785,2793,2817,2830,2838],{"type":428,"tag":466,"props":2381,"children":2382},{"class":468,"line":469},[2383],{"type":428,"tag":466,"props":2384,"children":2385},{"style":473},[2386],{"type":434,"value":2387},"  // 一开始没有持有dep实例\n",{"type":428,"tag":466,"props":2389,"children":2390},{"class":468,"line":479},[2391,2396,2401,2405],{"type":428,"tag":466,"props":2392,"children":2393},{"style":611},[2394],{"type":434,"value":2395},"  let",{"type":428,"tag":466,"props":2397,"children":2398},{"style":483},[2399],{"type":434,"value":2400}," handleDep ",{"type":428,"tag":466,"props":2402,"children":2403},{"style":719},[2404],{"type":434,"value":722},{"type":428,"tag":466,"props":2406,"children":2407},{"style":2185},[2408],{"type":434,"value":2409}," null\n",{"type":428,"tag":466,"props":2411,"children":2412},{"class":468,"line":558},[2413,2418,2422],{"type":428,"tag":466,"props":2414,"children":2415},{"style":611},[2416],{"type":434,"value":2417},"  class",{"type":428,"tag":466,"props":2419,"children":2420},{"style":796},[2421],{"type":434,"value":2125},{"type":428,"tag":466,"props":2423,"children":2424},{"style":489},[2425],{"type":434,"value":619},{"type":428,"tag":466,"props":2427,"children":2428},{"class":468,"line":567},[2429,2434,2438,2442,2446,2450,2454,2458,2462,2466,2470,2474,2478],{"type":428,"tag":466,"props":2430,"children":2431},{"style":870},[2432],{"type":434,"value":2433},"    watch",{"type":428,"tag":466,"props":2435,"children":2436},{"style":489},[2437],{"type":434,"value":878},{"type":428,"tag":466,"props":2439,"children":2440},{"style":605},[2441],{"type":434,"value":2216},{"type":428,"tag":466,"props":2443,"children":2444},{"style":489},[2445],{"type":434,"value":524},{"type":428,"tag":466,"props":2447,"children":2448},{"style":605},[2449],{"type":434,"value":2225},{"type":428,"tag":466,"props":2451,"children":2452},{"style":489},[2453],{"type":434,"value":524},{"type":428,"tag":466,"props":2455,"children":2456},{"style":605},[2457],{"type":434,"value":2234},{"type":428,"tag":466,"props":2459,"children":2460},{"style":719},[2461],{"type":434,"value":843},{"type":428,"tag":466,"props":2463,"children":2464},{"style":826},[2465],{"type":434,"value":1414},{"type":428,"tag":466,"props":2467,"children":2468},{"style":489},[2469],{"type":434,"value":492},{"type":428,"tag":466,"props":2471,"children":2472},{"style":483},[2473],{"type":434,"value":2160},{"type":428,"tag":466,"props":2475,"children":2476},{"style":489},[2477],{"type":434,"value":888},{"type":428,"tag":466,"props":2479,"children":2480},{"style":489},[2481],{"type":434,"value":619},{"type":428,"tag":466,"props":2483,"children":2484},{"class":468,"line":622},[2485,2490,2494,2498,2502,2506,2510,2514,2518],{"type":428,"tag":466,"props":2486,"children":2487},{"style":483},[2488],{"type":434,"value":2489},"      console",{"type":428,"tag":466,"props":2491,"children":2492},{"style":489},[2493],{"type":434,"value":492},{"type":428,"tag":466,"props":2495,"children":2496},{"style":495},[2497],{"type":434,"value":637},{"type":428,"tag":466,"props":2499,"children":2500},{"style":532},[2501],{"type":434,"value":503},{"type":428,"tag":466,"props":2503,"children":2504},{"style":483},[2505],{"type":434,"value":1485},{"type":428,"tag":466,"props":2507,"children":2508},{"style":489},[2509],{"type":434,"value":492},{"type":428,"tag":466,"props":2511,"children":2512},{"style":483},[2513],{"type":434,"value":2216},{"type":428,"tag":466,"props":2515,"children":2516},{"style":532},[2517],{"type":434,"value":1639},{"type":428,"tag":466,"props":2519,"children":2520},{"style":473},[2521],{"type":434,"value":2522},"// 使用任意操作触发obj.key的getter, 那么handleDep将自动引用obj.key的dep实例\n",{"type":428,"tag":466,"props":2524,"children":2525},{"class":468,"line":670},[2526,2531,2535,2539,2543,2547],{"type":428,"tag":466,"props":2527,"children":2528},{"style":483},[2529],{"type":434,"value":2530},"      handleDep",{"type":428,"tag":466,"props":2532,"children":2533},{"style":489},[2534],{"type":434,"value":492},{"type":428,"tag":466,"props":2536,"children":2537},{"style":495},[2538],{"type":434,"value":1993},{"type":428,"tag":466,"props":2540,"children":2541},{"style":532},[2542],{"type":434,"value":503},{"type":428,"tag":466,"props":2544,"children":2545},{"style":483},[2546],{"type":434,"value":883},{"type":428,"tag":466,"props":2548,"children":2549},{"style":532},[2550],{"type":434,"value":555},{"type":428,"tag":466,"props":2552,"children":2553},{"class":468,"line":683},[2554],{"type":428,"tag":466,"props":2555,"children":2556},{"style":489},[2557],{"type":434,"value":1719},{"type":428,"tag":466,"props":2559,"children":2560},{"class":468,"line":937},[2561,2565,2569,2573,2577,2581,2585,2589,2593,2597,2601,2605,2609,2613,2617,2621],{"type":428,"tag":466,"props":2562,"children":2563},{"style":870},[2564],{"type":434,"value":1593},{"type":428,"tag":466,"props":2566,"children":2567},{"style":489},[2568],{"type":434,"value":878},{"type":428,"tag":466,"props":2570,"children":2571},{"style":605},[2572],{"type":434,"value":2216},{"type":428,"tag":466,"props":2574,"children":2575},{"style":489},[2576],{"type":434,"value":524},{"type":428,"tag":466,"props":2578,"children":2579},{"style":605},[2580],{"type":434,"value":535},{"type":428,"tag":466,"props":2582,"children":2583},{"style":489},[2584],{"type":434,"value":524},{"type":428,"tag":466,"props":2586,"children":2587},{"style":605},[2588],{"type":434,"value":2291},{"type":428,"tag":466,"props":2590,"children":2591},{"style":719},[2592],{"type":434,"value":843},{"type":428,"tag":466,"props":2594,"children":2595},{"style":489},[2596],{"type":434,"value":1400},{"type":428,"tag":466,"props":2598,"children":2599},{"style":605},[2600],{"type":434,"value":2234},{"type":428,"tag":466,"props":2602,"children":2603},{"style":719},[2604],{"type":434,"value":843},{"type":428,"tag":466,"props":2606,"children":2607},{"style":826},[2608],{"type":434,"value":1414},{"type":428,"tag":466,"props":2610,"children":2611},{"style":489},[2612],{"type":434,"value":492},{"type":428,"tag":466,"props":2614,"children":2615},{"style":483},[2616],{"type":434,"value":2160},{"type":428,"tag":466,"props":2618,"children":2619},{"style":489},[2620],{"type":434,"value":888},{"type":428,"tag":466,"props":2622,"children":2623},{"style":489},[2624],{"type":434,"value":619},{"type":428,"tag":466,"props":2626,"children":2627},{"class":468,"line":946},[2628,2633,2637,2641,2645,2649],{"type":428,"tag":466,"props":2629,"children":2630},{"style":611},[2631],{"type":434,"value":2632},"      const",{"type":428,"tag":466,"props":2634,"children":2635},{"style":1439},[2636],{"type":434,"value":1442},{"type":428,"tag":466,"props":2638,"children":2639},{"style":719},[2640],{"type":434,"value":843},{"type":428,"tag":466,"props":2642,"children":2643},{"style":719},[2644],{"type":434,"value":1451},{"type":428,"tag":466,"props":2646,"children":2647},{"style":495},[2648],{"type":434,"value":799},{"type":428,"tag":466,"props":2650,"children":2651},{"style":532},[2652],{"type":434,"value":1460},{"type":428,"tag":466,"props":2654,"children":2655},{"class":468,"line":981},[2656,2661,2665,2669,2673,2677,2681,2685,2689],{"type":428,"tag":466,"props":2657,"children":2658},{"style":483},[2659],{"type":434,"value":2660},"      Object",{"type":428,"tag":466,"props":2662,"children":2663},{"style":489},[2664],{"type":434,"value":492},{"type":428,"tag":466,"props":2666,"children":2667},{"style":495},[2668],{"type":434,"value":1084},{"type":428,"tag":466,"props":2670,"children":2671},{"style":532},[2672],{"type":434,"value":503},{"type":428,"tag":466,"props":2674,"children":2675},{"style":483},[2676],{"type":434,"value":1485},{"type":428,"tag":466,"props":2678,"children":2679},{"style":489},[2680],{"type":434,"value":524},{"type":428,"tag":466,"props":2682,"children":2683},{"style":483},[2684],{"type":434,"value":1149},{"type":428,"tag":466,"props":2686,"children":2687},{"style":489},[2688],{"type":434,"value":524},{"type":428,"tag":466,"props":2690,"children":2691},{"style":489},[2692],{"type":434,"value":619},{"type":428,"tag":466,"props":2694,"children":2695},{"class":468,"line":1045},[2696,2701,2705,2709],{"type":428,"tag":466,"props":2697,"children":2698},{"style":532},[2699],{"type":434,"value":2700},"        enumerable",{"type":428,"tag":466,"props":2702,"children":2703},{"style":489},[2704],{"type":434,"value":540},{"type":428,"tag":466,"props":2706,"children":2707},{"style":1180},[2708],{"type":434,"value":1183},{"type":428,"tag":466,"props":2710,"children":2711},{"style":489},[2712],{"type":434,"value":1188},{"type":428,"tag":466,"props":2714,"children":2715},{"class":468,"line":1053},[2716,2721,2725,2729],{"type":428,"tag":466,"props":2717,"children":2718},{"style":532},[2719],{"type":434,"value":2720},"        configurable",{"type":428,"tag":466,"props":2722,"children":2723},{"style":489},[2724],{"type":434,"value":540},{"type":428,"tag":466,"props":2726,"children":2727},{"style":1180},[2728],{"type":434,"value":1183},{"type":428,"tag":466,"props":2730,"children":2731},{"style":489},[2732],{"type":434,"value":1188},{"type":428,"tag":466,"props":2734,"children":2735},{"class":468,"line":1281},[2736,2741,2745,2749,2753],{"type":428,"tag":466,"props":2737,"children":2738},{"style":495},[2739],{"type":434,"value":2740},"        get",{"type":428,"tag":466,"props":2742,"children":2743},{"style":489},[2744],{"type":434,"value":540},{"type":428,"tag":466,"props":2746,"children":2747},{"style":489},[2748],{"type":434,"value":816},{"type":428,"tag":466,"props":2750,"children":2751},{"style":611},[2752],{"type":434,"value":614},{"type":428,"tag":466,"props":2754,"children":2755},{"style":489},[2756],{"type":434,"value":619},{"type":428,"tag":466,"props":2758,"children":2759},{"class":468,"line":1306},[2760,2765,2769],{"type":428,"tag":466,"props":2761,"children":2762},{"style":483},[2763],{"type":434,"value":2764},"          handleDep",{"type":428,"tag":466,"props":2766,"children":2767},{"style":719},[2768],{"type":434,"value":843},{"type":428,"tag":466,"props":2770,"children":2771},{"style":483},[2772],{"type":434,"value":1903},{"type":428,"tag":466,"props":2774,"children":2775},{"class":468,"line":1324},[2776,2781],{"type":428,"tag":466,"props":2777,"children":2778},{"style":1254},[2779],{"type":434,"value":2780},"          return",{"type":428,"tag":466,"props":2782,"children":2783},{"style":483},[2784],{"type":434,"value":1262},{"type":428,"tag":466,"props":2786,"children":2787},{"class":468,"line":1332},[2788],{"type":428,"tag":466,"props":2789,"children":2790},{"style":489},[2791],{"type":434,"value":2792},"        },\n",{"type":428,"tag":466,"props":2794,"children":2795},{"class":468,"line":1341},[2796,2801,2805,2809,2813],{"type":428,"tag":466,"props":2797,"children":2798},{"style":495},[2799],{"type":434,"value":2800},"        set",{"type":428,"tag":466,"props":2802,"children":2803},{"style":489},[2804],{"type":434,"value":540},{"type":428,"tag":466,"props":2806,"children":2807},{"style":605},[2808],{"type":434,"value":608},{"type":428,"tag":466,"props":2810,"children":2811},{"style":611},[2812],{"type":434,"value":614},{"type":428,"tag":466,"props":2814,"children":2815},{"style":489},[2816],{"type":434,"value":2259},{"type":428,"tag":466,"props":2818,"children":2820},{"class":468,"line":2819},18,[2821,2826],{"type":428,"tag":466,"props":2822,"children":2823},{"style":489},[2824],{"type":434,"value":2825},"      }",{"type":428,"tag":466,"props":2827,"children":2828},{"style":532},[2829],{"type":434,"value":555},{"type":428,"tag":466,"props":2831,"children":2833},{"class":468,"line":2832},19,[2834],{"type":428,"tag":466,"props":2835,"children":2836},{"style":489},[2837],{"type":434,"value":1719},{"type":428,"tag":466,"props":2839,"children":2841},{"class":468,"line":2840},20,[2842],{"type":428,"tag":466,"props":2843,"children":2844},{"style":489},[2845],{"type":434,"value":856},{"type":428,"tag":1079,"props":2847,"children":2849},{"id":2848},"主动收集依赖",[2850],{"type":434,"value":2848},{"type":428,"tag":436,"props":2852,"children":2853},{},[2854,2856,2862,2864,2870,2872,2878],{"type":434,"value":2855},"我们增加",{"type":428,"tag":442,"props":2857,"children":2859},{"className":2858},[],[2860],{"type":434,"value":2861},"handleDep.addSub(fn)",{"type":434,"value":2863},"添加回调函数的逻辑, 其实可以直接放到 getter 中, 首先在 Dep 类中封装一个'主动'收集依赖的",{"type":428,"tag":442,"props":2865,"children":2867},{"className":2866},[],[2868],{"type":434,"value":2869},"collect",{"type":434,"value":2871},"方法, 他会将全局",{"type":428,"tag":442,"props":2873,"children":2875},{"className":2874},[],[2876],{"type":434,"value":2877},"handleFn",{"type":434,"value":2879},"存放到订阅数组中, 这样一来, 在 watch 函数中, 我们只要触发 obj.key 的 getter, 就可以主动收集依赖了:",{"type":428,"tag":456,"props":2881,"children":2883},{"className":458,"code":2882,"language":460,"meta":421,"style":421},"let handleFn = null\nclass Dep {\n  addSub (fn) {}\n  delSub (fn) {}\n  clear () {}\n  collect (fn = handleFn) {\n    if (fn && !this.subs.find(x => x === fn)) {\n      this.addSub(fn)\n    }\n  }\n  notify (newVal, oldVal) {}\n}\n\nlet handleDep = null\nclass VX {\n  watch (key, fn, obj = this.store) {\n    handleFn = fn\n    console.log(obj.key)\n  }\n  set (key, val, options = {}, obj = this.store) {\n    const dep = new Dep()\n    Object.defineProperty(obj, key, {\n      enumerable: true,\n      configurable: true,\n      get: () => {\n        handleDep = dep\n        handleDep.collect()\n        return val\n      },\n      set: newVal => {}\n    })\n  }\n}\n",[2884],{"type":428,"tag":442,"props":2885,"children":2886},{"__ignoreMap":421},[2887,2908,2923,2946,2969,2985,3018,3101,3129,3136,3143,3174,3181,3189,3208,3223,3278,3295,3331,3338,3405,3434,3475,3496,3517,3542,3559,3579,3592,3601,3626,3639,3647],{"type":428,"tag":466,"props":2888,"children":2889},{"class":468,"line":469},[2890,2895,2900,2904],{"type":428,"tag":466,"props":2891,"children":2892},{"style":611},[2893],{"type":434,"value":2894},"let",{"type":428,"tag":466,"props":2896,"children":2897},{"style":483},[2898],{"type":434,"value":2899}," handleFn ",{"type":428,"tag":466,"props":2901,"children":2902},{"style":719},[2903],{"type":434,"value":722},{"type":428,"tag":466,"props":2905,"children":2906},{"style":2185},[2907],{"type":434,"value":2409},{"type":428,"tag":466,"props":2909,"children":2910},{"class":468,"line":479},[2911,2915,2919],{"type":428,"tag":466,"props":2912,"children":2913},{"style":611},[2914],{"type":434,"value":793},{"type":428,"tag":466,"props":2916,"children":2917},{"style":796},[2918],{"type":434,"value":799},{"type":428,"tag":466,"props":2920,"children":2921},{"style":489},[2922],{"type":434,"value":619},{"type":428,"tag":466,"props":2924,"children":2925},{"class":468,"line":558},[2926,2930,2934,2938,2942],{"type":428,"tag":466,"props":2927,"children":2928},{"style":870},[2929],{"type":434,"value":873},{"type":428,"tag":466,"props":2931,"children":2932},{"style":489},[2933],{"type":434,"value":878},{"type":428,"tag":466,"props":2935,"children":2936},{"style":605},[2937],{"type":434,"value":883},{"type":428,"tag":466,"props":2939,"children":2940},{"style":489},[2941],{"type":434,"value":888},{"type":428,"tag":466,"props":2943,"children":2944},{"style":489},[2945],{"type":434,"value":2259},{"type":428,"tag":466,"props":2947,"children":2948},{"class":468,"line":567},[2949,2953,2957,2961,2965],{"type":428,"tag":466,"props":2950,"children":2951},{"style":870},[2952],{"type":434,"value":910},{"type":428,"tag":466,"props":2954,"children":2955},{"style":489},[2956],{"type":434,"value":878},{"type":428,"tag":466,"props":2958,"children":2959},{"style":605},[2960],{"type":434,"value":883},{"type":428,"tag":466,"props":2962,"children":2963},{"style":489},[2964],{"type":434,"value":888},{"type":428,"tag":466,"props":2966,"children":2967},{"style":489},[2968],{"type":434,"value":2259},{"type":428,"tag":466,"props":2970,"children":2971},{"class":468,"line":622},[2972,2977,2981],{"type":428,"tag":466,"props":2973,"children":2974},{"style":870},[2975],{"type":434,"value":2976},"  clear",{"type":428,"tag":466,"props":2978,"children":2979},{"style":489},[2980],{"type":434,"value":816},{"type":428,"tag":466,"props":2982,"children":2983},{"style":489},[2984],{"type":434,"value":2259},{"type":428,"tag":466,"props":2986,"children":2987},{"class":468,"line":670},[2988,2993,2997,3001,3005,3010,3014],{"type":428,"tag":466,"props":2989,"children":2990},{"style":870},[2991],{"type":434,"value":2992},"  collect",{"type":428,"tag":466,"props":2994,"children":2995},{"style":489},[2996],{"type":434,"value":878},{"type":428,"tag":466,"props":2998,"children":2999},{"style":605},[3000],{"type":434,"value":883},{"type":428,"tag":466,"props":3002,"children":3003},{"style":719},[3004],{"type":434,"value":843},{"type":428,"tag":466,"props":3006,"children":3007},{"style":483},[3008],{"type":434,"value":3009}," handleFn",{"type":428,"tag":466,"props":3011,"children":3012},{"style":489},[3013],{"type":434,"value":888},{"type":428,"tag":466,"props":3015,"children":3016},{"style":489},[3017],{"type":434,"value":619},{"type":428,"tag":466,"props":3019,"children":3020},{"class":468,"line":683},[3021,3026,3030,3034,3039,3044,3049,3053,3057,3061,3066,3070,3075,3079,3084,3088,3092,3097],{"type":428,"tag":466,"props":3022,"children":3023},{"style":1254},[3024],{"type":434,"value":3025},"    if",{"type":428,"tag":466,"props":3027,"children":3028},{"style":532},[3029],{"type":434,"value":878},{"type":428,"tag":466,"props":3031,"children":3032},{"style":483},[3033],{"type":434,"value":883},{"type":428,"tag":466,"props":3035,"children":3036},{"style":719},[3037],{"type":434,"value":3038}," &&",{"type":428,"tag":466,"props":3040,"children":3041},{"style":719},[3042],{"type":434,"value":3043}," !",{"type":428,"tag":466,"props":3045,"children":3046},{"style":826},[3047],{"type":434,"value":3048},"this",{"type":428,"tag":466,"props":3050,"children":3051},{"style":489},[3052],{"type":434,"value":492},{"type":428,"tag":466,"props":3054,"children":3055},{"style":483},[3056],{"type":434,"value":838},{"type":428,"tag":466,"props":3058,"children":3059},{"style":489},[3060],{"type":434,"value":492},{"type":428,"tag":466,"props":3062,"children":3063},{"style":495},[3064],{"type":434,"value":3065},"find",{"type":428,"tag":466,"props":3067,"children":3068},{"style":532},[3069],{"type":434,"value":503},{"type":428,"tag":466,"props":3071,"children":3072},{"style":605},[3073],{"type":434,"value":3074},"x",{"type":428,"tag":466,"props":3076,"children":3077},{"style":611},[3078],{"type":434,"value":614},{"type":428,"tag":466,"props":3080,"children":3081},{"style":483},[3082],{"type":434,"value":3083}," x",{"type":428,"tag":466,"props":3085,"children":3086},{"style":719},[3087],{"type":434,"value":1630},{"type":428,"tag":466,"props":3089,"children":3090},{"style":483},[3091],{"type":434,"value":2225},{"type":428,"tag":466,"props":3093,"children":3094},{"style":532},[3095],{"type":434,"value":3096},")) ",{"type":428,"tag":466,"props":3098,"children":3099},{"style":489},[3100],{"type":434,"value":1428},{"type":428,"tag":466,"props":3102,"children":3103},{"class":468,"line":937},[3104,3109,3113,3117,3121,3125],{"type":428,"tag":466,"props":3105,"children":3106},{"style":826},[3107],{"type":434,"value":3108},"      this",{"type":428,"tag":466,"props":3110,"children":3111},{"style":489},[3112],{"type":434,"value":492},{"type":428,"tag":466,"props":3114,"children":3115},{"style":495},[3116],{"type":434,"value":1993},{"type":428,"tag":466,"props":3118,"children":3119},{"style":532},[3120],{"type":434,"value":503},{"type":428,"tag":466,"props":3122,"children":3123},{"style":483},[3124],{"type":434,"value":883},{"type":428,"tag":466,"props":3126,"children":3127},{"style":532},[3128],{"type":434,"value":555},{"type":428,"tag":466,"props":3130,"children":3131},{"class":468,"line":946},[3132],{"type":428,"tag":466,"props":3133,"children":3134},{"style":489},[3135],{"type":434,"value":1719},{"type":428,"tag":466,"props":3137,"children":3138},{"class":468,"line":981},[3139],{"type":428,"tag":466,"props":3140,"children":3141},{"style":489},[3142],{"type":434,"value":856},{"type":428,"tag":466,"props":3144,"children":3145},{"class":468,"line":1045},[3146,3150,3154,3158,3162,3166,3170],{"type":428,"tag":466,"props":3147,"children":3148},{"style":870},[3149],{"type":434,"value":952},{"type":428,"tag":466,"props":3151,"children":3152},{"style":489},[3153],{"type":434,"value":878},{"type":428,"tag":466,"props":3155,"children":3156},{"style":605},[3157],{"type":434,"value":961},{"type":428,"tag":466,"props":3159,"children":3160},{"style":489},[3161],{"type":434,"value":524},{"type":428,"tag":466,"props":3163,"children":3164},{"style":605},[3165],{"type":434,"value":970},{"type":428,"tag":466,"props":3167,"children":3168},{"style":489},[3169],{"type":434,"value":888},{"type":428,"tag":466,"props":3171,"children":3172},{"style":489},[3173],{"type":434,"value":2259},{"type":428,"tag":466,"props":3175,"children":3176},{"class":468,"line":1053},[3177],{"type":428,"tag":466,"props":3178,"children":3179},{"style":489},[3180],{"type":434,"value":1059},{"type":428,"tag":466,"props":3182,"children":3183},{"class":468,"line":1281},[3184],{"type":428,"tag":466,"props":3185,"children":3186},{"emptyLinePlaceholder":420},[3187],{"type":434,"value":3188},"\n",{"type":428,"tag":466,"props":3190,"children":3191},{"class":468,"line":1306},[3192,3196,3200,3204],{"type":428,"tag":466,"props":3193,"children":3194},{"style":611},[3195],{"type":434,"value":2894},{"type":428,"tag":466,"props":3197,"children":3198},{"style":483},[3199],{"type":434,"value":2400},{"type":428,"tag":466,"props":3201,"children":3202},{"style":719},[3203],{"type":434,"value":722},{"type":428,"tag":466,"props":3205,"children":3206},{"style":2185},[3207],{"type":434,"value":2409},{"type":428,"tag":466,"props":3209,"children":3210},{"class":468,"line":1324},[3211,3215,3219],{"type":428,"tag":466,"props":3212,"children":3213},{"style":611},[3214],{"type":434,"value":793},{"type":428,"tag":466,"props":3216,"children":3217},{"style":796},[3218],{"type":434,"value":2125},{"type":428,"tag":466,"props":3220,"children":3221},{"style":489},[3222],{"type":434,"value":619},{"type":428,"tag":466,"props":3224,"children":3225},{"class":468,"line":1332},[3226,3230,3234,3238,3242,3246,3250,3254,3258,3262,3266,3270,3274],{"type":428,"tag":466,"props":3227,"children":3228},{"style":870},[3229],{"type":434,"value":2207},{"type":428,"tag":466,"props":3231,"children":3232},{"style":489},[3233],{"type":434,"value":878},{"type":428,"tag":466,"props":3235,"children":3236},{"style":605},[3237],{"type":434,"value":2216},{"type":428,"tag":466,"props":3239,"children":3240},{"style":489},[3241],{"type":434,"value":524},{"type":428,"tag":466,"props":3243,"children":3244},{"style":605},[3245],{"type":434,"value":2225},{"type":428,"tag":466,"props":3247,"children":3248},{"style":489},[3249],{"type":434,"value":524},{"type":428,"tag":466,"props":3251,"children":3252},{"style":605},[3253],{"type":434,"value":2234},{"type":428,"tag":466,"props":3255,"children":3256},{"style":719},[3257],{"type":434,"value":843},{"type":428,"tag":466,"props":3259,"children":3260},{"style":826},[3261],{"type":434,"value":1414},{"type":428,"tag":466,"props":3263,"children":3264},{"style":489},[3265],{"type":434,"value":492},{"type":428,"tag":466,"props":3267,"children":3268},{"style":483},[3269],{"type":434,"value":2160},{"type":428,"tag":466,"props":3271,"children":3272},{"style":489},[3273],{"type":434,"value":888},{"type":428,"tag":466,"props":3275,"children":3276},{"style":489},[3277],{"type":434,"value":619},{"type":428,"tag":466,"props":3279,"children":3280},{"class":468,"line":1341},[3281,3286,3290],{"type":428,"tag":466,"props":3282,"children":3283},{"style":483},[3284],{"type":434,"value":3285},"    handleFn",{"type":428,"tag":466,"props":3287,"children":3288},{"style":719},[3289],{"type":434,"value":843},{"type":428,"tag":466,"props":3291,"children":3292},{"style":483},[3293],{"type":434,"value":3294}," fn\n",{"type":428,"tag":466,"props":3296,"children":3297},{"class":468,"line":2819},[3298,3303,3307,3311,3315,3319,3323,3327],{"type":428,"tag":466,"props":3299,"children":3300},{"style":483},[3301],{"type":434,"value":3302},"    console",{"type":428,"tag":466,"props":3304,"children":3305},{"style":489},[3306],{"type":434,"value":492},{"type":428,"tag":466,"props":3308,"children":3309},{"style":495},[3310],{"type":434,"value":637},{"type":428,"tag":466,"props":3312,"children":3313},{"style":532},[3314],{"type":434,"value":503},{"type":428,"tag":466,"props":3316,"children":3317},{"style":483},[3318],{"type":434,"value":1485},{"type":428,"tag":466,"props":3320,"children":3321},{"style":489},[3322],{"type":434,"value":492},{"type":428,"tag":466,"props":3324,"children":3325},{"style":483},[3326],{"type":434,"value":2216},{"type":428,"tag":466,"props":3328,"children":3329},{"style":532},[3330],{"type":434,"value":555},{"type":428,"tag":466,"props":3332,"children":3333},{"class":468,"line":2832},[3334],{"type":428,"tag":466,"props":3335,"children":3336},{"style":489},[3337],{"type":434,"value":856},{"type":428,"tag":466,"props":3339,"children":3340},{"class":468,"line":2840},[3341,3345,3349,3353,3357,3361,3365,3369,3373,3377,3381,3385,3389,3393,3397,3401],{"type":428,"tag":466,"props":3342,"children":3343},{"style":870},[3344],{"type":434,"value":1287},{"type":428,"tag":466,"props":3346,"children":3347},{"style":489},[3348],{"type":434,"value":878},{"type":428,"tag":466,"props":3350,"children":3351},{"style":605},[3352],{"type":434,"value":2216},{"type":428,"tag":466,"props":3354,"children":3355},{"style":489},[3356],{"type":434,"value":524},{"type":428,"tag":466,"props":3358,"children":3359},{"style":605},[3360],{"type":434,"value":535},{"type":428,"tag":466,"props":3362,"children":3363},{"style":489},[3364],{"type":434,"value":524},{"type":428,"tag":466,"props":3366,"children":3367},{"style":605},[3368],{"type":434,"value":2291},{"type":428,"tag":466,"props":3370,"children":3371},{"style":719},[3372],{"type":434,"value":843},{"type":428,"tag":466,"props":3374,"children":3375},{"style":489},[3376],{"type":434,"value":1400},{"type":428,"tag":466,"props":3378,"children":3379},{"style":605},[3380],{"type":434,"value":2234},{"type":428,"tag":466,"props":3382,"children":3383},{"style":719},[3384],{"type":434,"value":843},{"type":428,"tag":466,"props":3386,"children":3387},{"style":826},[3388],{"type":434,"value":1414},{"type":428,"tag":466,"props":3390,"children":3391},{"style":489},[3392],{"type":434,"value":492},{"type":428,"tag":466,"props":3394,"children":3395},{"style":483},[3396],{"type":434,"value":2160},{"type":428,"tag":466,"props":3398,"children":3399},{"style":489},[3400],{"type":434,"value":888},{"type":428,"tag":466,"props":3402,"children":3403},{"style":489},[3404],{"type":434,"value":619},{"type":428,"tag":466,"props":3406,"children":3408},{"class":468,"line":3407},21,[3409,3414,3418,3422,3426,3430],{"type":428,"tag":466,"props":3410,"children":3411},{"style":611},[3412],{"type":434,"value":3413},"    const",{"type":428,"tag":466,"props":3415,"children":3416},{"style":1439},[3417],{"type":434,"value":1442},{"type":428,"tag":466,"props":3419,"children":3420},{"style":719},[3421],{"type":434,"value":843},{"type":428,"tag":466,"props":3423,"children":3424},{"style":719},[3425],{"type":434,"value":1451},{"type":428,"tag":466,"props":3427,"children":3428},{"style":495},[3429],{"type":434,"value":799},{"type":428,"tag":466,"props":3431,"children":3432},{"style":532},[3433],{"type":434,"value":1460},{"type":428,"tag":466,"props":3435,"children":3437},{"class":468,"line":3436},22,[3438,3443,3447,3451,3455,3459,3463,3467,3471],{"type":428,"tag":466,"props":3439,"children":3440},{"style":483},[3441],{"type":434,"value":3442},"    Object",{"type":428,"tag":466,"props":3444,"children":3445},{"style":489},[3446],{"type":434,"value":492},{"type":428,"tag":466,"props":3448,"children":3449},{"style":495},[3450],{"type":434,"value":1084},{"type":428,"tag":466,"props":3452,"children":3453},{"style":532},[3454],{"type":434,"value":503},{"type":428,"tag":466,"props":3456,"children":3457},{"style":483},[3458],{"type":434,"value":1485},{"type":428,"tag":466,"props":3460,"children":3461},{"style":489},[3462],{"type":434,"value":524},{"type":428,"tag":466,"props":3464,"children":3465},{"style":483},[3466],{"type":434,"value":1149},{"type":428,"tag":466,"props":3468,"children":3469},{"style":489},[3470],{"type":434,"value":524},{"type":428,"tag":466,"props":3472,"children":3473},{"style":489},[3474],{"type":434,"value":619},{"type":428,"tag":466,"props":3476,"children":3478},{"class":468,"line":3477},23,[3479,3484,3488,3492],{"type":428,"tag":466,"props":3480,"children":3481},{"style":532},[3482],{"type":434,"value":3483},"      enumerable",{"type":428,"tag":466,"props":3485,"children":3486},{"style":489},[3487],{"type":434,"value":540},{"type":428,"tag":466,"props":3489,"children":3490},{"style":1180},[3491],{"type":434,"value":1183},{"type":428,"tag":466,"props":3493,"children":3494},{"style":489},[3495],{"type":434,"value":1188},{"type":428,"tag":466,"props":3497,"children":3499},{"class":468,"line":3498},24,[3500,3505,3509,3513],{"type":428,"tag":466,"props":3501,"children":3502},{"style":532},[3503],{"type":434,"value":3504},"      configurable",{"type":428,"tag":466,"props":3506,"children":3507},{"style":489},[3508],{"type":434,"value":540},{"type":428,"tag":466,"props":3510,"children":3511},{"style":1180},[3512],{"type":434,"value":1183},{"type":428,"tag":466,"props":3514,"children":3515},{"style":489},[3516],{"type":434,"value":1188},{"type":428,"tag":466,"props":3518,"children":3520},{"class":468,"line":3519},25,[3521,3526,3530,3534,3538],{"type":428,"tag":466,"props":3522,"children":3523},{"style":495},[3524],{"type":434,"value":3525},"      get",{"type":428,"tag":466,"props":3527,"children":3528},{"style":489},[3529],{"type":434,"value":540},{"type":428,"tag":466,"props":3531,"children":3532},{"style":489},[3533],{"type":434,"value":816},{"type":428,"tag":466,"props":3535,"children":3536},{"style":611},[3537],{"type":434,"value":614},{"type":428,"tag":466,"props":3539,"children":3540},{"style":489},[3541],{"type":434,"value":619},{"type":428,"tag":466,"props":3543,"children":3545},{"class":468,"line":3544},26,[3546,3551,3555],{"type":428,"tag":466,"props":3547,"children":3548},{"style":483},[3549],{"type":434,"value":3550},"        handleDep",{"type":428,"tag":466,"props":3552,"children":3553},{"style":719},[3554],{"type":434,"value":843},{"type":428,"tag":466,"props":3556,"children":3557},{"style":483},[3558],{"type":434,"value":1903},{"type":428,"tag":466,"props":3560,"children":3562},{"class":468,"line":3561},27,[3563,3567,3571,3575],{"type":428,"tag":466,"props":3564,"children":3565},{"style":483},[3566],{"type":434,"value":3550},{"type":428,"tag":466,"props":3568,"children":3569},{"style":489},[3570],{"type":434,"value":492},{"type":428,"tag":466,"props":3572,"children":3573},{"style":495},[3574],{"type":434,"value":2869},{"type":428,"tag":466,"props":3576,"children":3577},{"style":532},[3578],{"type":434,"value":1460},{"type":428,"tag":466,"props":3580,"children":3582},{"class":468,"line":3581},28,[3583,3588],{"type":428,"tag":466,"props":3584,"children":3585},{"style":1254},[3586],{"type":434,"value":3587},"        return",{"type":428,"tag":466,"props":3589,"children":3590},{"style":483},[3591],{"type":434,"value":1262},{"type":428,"tag":466,"props":3593,"children":3595},{"class":468,"line":3594},29,[3596],{"type":428,"tag":466,"props":3597,"children":3598},{"style":489},[3599],{"type":434,"value":3600},"      },\n",{"type":428,"tag":466,"props":3602,"children":3604},{"class":468,"line":3603},30,[3605,3610,3614,3618,3622],{"type":428,"tag":466,"props":3606,"children":3607},{"style":495},[3608],{"type":434,"value":3609},"      set",{"type":428,"tag":466,"props":3611,"children":3612},{"style":489},[3613],{"type":434,"value":540},{"type":428,"tag":466,"props":3615,"children":3616},{"style":605},[3617],{"type":434,"value":608},{"type":428,"tag":466,"props":3619,"children":3620},{"style":611},[3621],{"type":434,"value":614},{"type":428,"tag":466,"props":3623,"children":3624},{"style":489},[3625],{"type":434,"value":2259},{"type":428,"tag":466,"props":3627,"children":3629},{"class":468,"line":3628},31,[3630,3635],{"type":428,"tag":466,"props":3631,"children":3632},{"style":489},[3633],{"type":434,"value":3634},"    }",{"type":428,"tag":466,"props":3636,"children":3637},{"style":532},[3638],{"type":434,"value":555},{"type":428,"tag":466,"props":3640,"children":3642},{"class":468,"line":3641},32,[3643],{"type":428,"tag":466,"props":3644,"children":3645},{"style":489},[3646],{"type":434,"value":856},{"type":428,"tag":466,"props":3648,"children":3650},{"class":468,"line":3649},33,[3651],{"type":428,"tag":466,"props":3652,"children":3653},{"style":489},[3654],{"type":434,"value":1059},{"type":428,"tag":429,"props":3656,"children":3658},{"id":3657},"处理-key-值为对象链的情况",[3659],{"type":434,"value":3660},"处理 key 值为对象链的情况",{"type":428,"tag":436,"props":3662,"children":3663},{},[3664,3666,3672],{"type":434,"value":3665},"在先前的 watch 函数中, 我们使用 console.log(obj.key)去触发对应属性的 getter, 如果我们调用方式是",{"type":428,"tag":442,"props":3667,"children":3669},{"className":3668},[],[3670],{"type":434,"value":3671},"watch('a.b.c')",{"type":434,"value":3673},"就无能为力了. 这里我们封装一个通用方法, 用于处理对象链字符串的形式:",{"type":428,"tag":456,"props":3675,"children":3677},{"className":458,"code":3676,"language":460,"meta":421,"style":421},"// 通过将字符串'a.b'分割为['a', 'b'], 再使用一个while循环就可以走完这个对象链\nfunction walkChains (key, obj) {\n  const segments = key.split('.')\n  let deepObj = obj\n  while (segments.length) {\n    deepObj = deepObj[segments.shift()]\n  }\n}\nclass VX {\n  watch (key, fn, obj = this.store) {\n    handleFn = fn\n    walkChains(key, obj)\n  }\n}\n",[3678],{"type":428,"tag":442,"props":3679,"children":3680},{"__ignoreMap":421},[3681,3689,3726,3775,3796,3830,3869,3876,3883,3898,3953,3968,3996,4003],{"type":428,"tag":466,"props":3682,"children":3683},{"class":468,"line":469},[3684],{"type":428,"tag":466,"props":3685,"children":3686},{"style":473},[3687],{"type":434,"value":3688},"// 通过将字符串'a.b'分割为['a', 'b'], 再使用一个while循环就可以走完这个对象链\n",{"type":428,"tag":466,"props":3690,"children":3691},{"class":468,"line":479},[3692,3697,3702,3706,3710,3714,3718,3722],{"type":428,"tag":466,"props":3693,"children":3694},{"style":611},[3695],{"type":434,"value":3696},"function",{"type":428,"tag":466,"props":3698,"children":3699},{"style":495},[3700],{"type":434,"value":3701}," walkChains",{"type":428,"tag":466,"props":3703,"children":3704},{"style":489},[3705],{"type":434,"value":878},{"type":428,"tag":466,"props":3707,"children":3708},{"style":605},[3709],{"type":434,"value":2216},{"type":428,"tag":466,"props":3711,"children":3712},{"style":489},[3713],{"type":434,"value":524},{"type":428,"tag":466,"props":3715,"children":3716},{"style":605},[3717],{"type":434,"value":2234},{"type":428,"tag":466,"props":3719,"children":3720},{"style":489},[3721],{"type":434,"value":888},{"type":428,"tag":466,"props":3723,"children":3724},{"style":489},[3725],{"type":434,"value":619},{"type":428,"tag":466,"props":3727,"children":3728},{"class":468,"line":558},[3729,3733,3738,3742,3746,3750,3755,3759,3763,3767,3771],{"type":428,"tag":466,"props":3730,"children":3731},{"style":611},[3732],{"type":434,"value":1436},{"type":428,"tag":466,"props":3734,"children":3735},{"style":1439},[3736],{"type":434,"value":3737}," segments",{"type":428,"tag":466,"props":3739,"children":3740},{"style":719},[3741],{"type":434,"value":843},{"type":428,"tag":466,"props":3743,"children":3744},{"style":483},[3745],{"type":434,"value":1149},{"type":428,"tag":466,"props":3747,"children":3748},{"style":489},[3749],{"type":434,"value":492},{"type":428,"tag":466,"props":3751,"children":3752},{"style":495},[3753],{"type":434,"value":3754},"split",{"type":428,"tag":466,"props":3756,"children":3757},{"style":532},[3758],{"type":434,"value":503},{"type":428,"tag":466,"props":3760,"children":3761},{"style":506},[3762],{"type":434,"value":509},{"type":428,"tag":466,"props":3764,"children":3765},{"style":512},[3766],{"type":434,"value":492},{"type":428,"tag":466,"props":3768,"children":3769},{"style":506},[3770],{"type":434,"value":509},{"type":428,"tag":466,"props":3772,"children":3773},{"style":532},[3774],{"type":434,"value":555},{"type":428,"tag":466,"props":3776,"children":3777},{"class":468,"line":567},[3778,3782,3787,3791],{"type":428,"tag":466,"props":3779,"children":3780},{"style":611},[3781],{"type":434,"value":2395},{"type":428,"tag":466,"props":3783,"children":3784},{"style":483},[3785],{"type":434,"value":3786}," deepObj",{"type":428,"tag":466,"props":3788,"children":3789},{"style":719},[3790],{"type":434,"value":843},{"type":428,"tag":466,"props":3792,"children":3793},{"style":483},[3794],{"type":434,"value":3795}," obj\n",{"type":428,"tag":466,"props":3797,"children":3798},{"class":468,"line":622},[3799,3804,3808,3813,3817,3822,3826],{"type":428,"tag":466,"props":3800,"children":3801},{"style":1254},[3802],{"type":434,"value":3803},"  while",{"type":428,"tag":466,"props":3805,"children":3806},{"style":532},[3807],{"type":434,"value":878},{"type":428,"tag":466,"props":3809,"children":3810},{"style":483},[3811],{"type":434,"value":3812},"segments",{"type":428,"tag":466,"props":3814,"children":3815},{"style":489},[3816],{"type":434,"value":492},{"type":428,"tag":466,"props":3818,"children":3819},{"style":1439},[3820],{"type":434,"value":3821},"length",{"type":428,"tag":466,"props":3823,"children":3824},{"style":532},[3825],{"type":434,"value":1639},{"type":428,"tag":466,"props":3827,"children":3828},{"style":489},[3829],{"type":434,"value":1428},{"type":428,"tag":466,"props":3831,"children":3832},{"class":468,"line":670},[3833,3838,3842,3846,3851,3855,3859,3864],{"type":428,"tag":466,"props":3834,"children":3835},{"style":483},[3836],{"type":434,"value":3837},"    deepObj",{"type":428,"tag":466,"props":3839,"children":3840},{"style":719},[3841],{"type":434,"value":843},{"type":428,"tag":466,"props":3843,"children":3844},{"style":483},[3845],{"type":434,"value":3786},{"type":428,"tag":466,"props":3847,"children":3848},{"style":532},[3849],{"type":434,"value":3850},"[",{"type":428,"tag":466,"props":3852,"children":3853},{"style":483},[3854],{"type":434,"value":3812},{"type":428,"tag":466,"props":3856,"children":3857},{"style":489},[3858],{"type":434,"value":492},{"type":428,"tag":466,"props":3860,"children":3861},{"style":495},[3862],{"type":434,"value":3863},"shift",{"type":428,"tag":466,"props":3865,"children":3866},{"style":532},[3867],{"type":434,"value":3868},"()]\n",{"type":428,"tag":466,"props":3870,"children":3871},{"class":468,"line":683},[3872],{"type":428,"tag":466,"props":3873,"children":3874},{"style":489},[3875],{"type":434,"value":856},{"type":428,"tag":466,"props":3877,"children":3878},{"class":468,"line":937},[3879],{"type":428,"tag":466,"props":3880,"children":3881},{"style":489},[3882],{"type":434,"value":1059},{"type":428,"tag":466,"props":3884,"children":3885},{"class":468,"line":946},[3886,3890,3894],{"type":428,"tag":466,"props":3887,"children":3888},{"style":611},[3889],{"type":434,"value":793},{"type":428,"tag":466,"props":3891,"children":3892},{"style":796},[3893],{"type":434,"value":2125},{"type":428,"tag":466,"props":3895,"children":3896},{"style":489},[3897],{"type":434,"value":619},{"type":428,"tag":466,"props":3899,"children":3900},{"class":468,"line":981},[3901,3905,3909,3913,3917,3921,3925,3929,3933,3937,3941,3945,3949],{"type":428,"tag":466,"props":3902,"children":3903},{"style":870},[3904],{"type":434,"value":2207},{"type":428,"tag":466,"props":3906,"children":3907},{"style":489},[3908],{"type":434,"value":878},{"type":428,"tag":466,"props":3910,"children":3911},{"style":605},[3912],{"type":434,"value":2216},{"type":428,"tag":466,"props":3914,"children":3915},{"style":489},[3916],{"type":434,"value":524},{"type":428,"tag":466,"props":3918,"children":3919},{"style":605},[3920],{"type":434,"value":2225},{"type":428,"tag":466,"props":3922,"children":3923},{"style":489},[3924],{"type":434,"value":524},{"type":428,"tag":466,"props":3926,"children":3927},{"style":605},[3928],{"type":434,"value":2234},{"type":428,"tag":466,"props":3930,"children":3931},{"style":719},[3932],{"type":434,"value":843},{"type":428,"tag":466,"props":3934,"children":3935},{"style":826},[3936],{"type":434,"value":1414},{"type":428,"tag":466,"props":3938,"children":3939},{"style":489},[3940],{"type":434,"value":492},{"type":428,"tag":466,"props":3942,"children":3943},{"style":483},[3944],{"type":434,"value":2160},{"type":428,"tag":466,"props":3946,"children":3947},{"style":489},[3948],{"type":434,"value":888},{"type":428,"tag":466,"props":3950,"children":3951},{"style":489},[3952],{"type":434,"value":619},{"type":428,"tag":466,"props":3954,"children":3955},{"class":468,"line":1045},[3956,3960,3964],{"type":428,"tag":466,"props":3957,"children":3958},{"style":483},[3959],{"type":434,"value":3285},{"type":428,"tag":466,"props":3961,"children":3962},{"style":719},[3963],{"type":434,"value":843},{"type":428,"tag":466,"props":3965,"children":3966},{"style":483},[3967],{"type":434,"value":3294},{"type":428,"tag":466,"props":3969,"children":3970},{"class":468,"line":1053},[3971,3976,3980,3984,3988,3992],{"type":428,"tag":466,"props":3972,"children":3973},{"style":495},[3974],{"type":434,"value":3975},"    walkChains",{"type":428,"tag":466,"props":3977,"children":3978},{"style":532},[3979],{"type":434,"value":503},{"type":428,"tag":466,"props":3981,"children":3982},{"style":483},[3983],{"type":434,"value":2216},{"type":428,"tag":466,"props":3985,"children":3986},{"style":489},[3987],{"type":434,"value":524},{"type":428,"tag":466,"props":3989,"children":3990},{"style":483},[3991],{"type":434,"value":2234},{"type":428,"tag":466,"props":3993,"children":3994},{"style":532},[3995],{"type":434,"value":555},{"type":428,"tag":466,"props":3997,"children":3998},{"class":468,"line":1281},[3999],{"type":428,"tag":466,"props":4000,"children":4001},{"style":489},[4002],{"type":434,"value":856},{"type":428,"tag":466,"props":4004,"children":4005},{"class":468,"line":1306},[4006],{"type":428,"tag":466,"props":4007,"children":4008},{"style":489},[4009],{"type":434,"value":1059},{"type":428,"tag":436,"props":4011,"children":4012},{},[4013,4015,4021],{"type":434,"value":4014},"在 set 方法中处理对象链字符串稍微有些不同, 因为如果",{"type":428,"tag":442,"props":4016,"children":4018},{"className":4017},[],[4019],{"type":434,"value":4020},"set('a.b')",{"type":434,"value":4022},"时, 没有在我们全局对象中找到 a 属性, 这里应该抛错.",{"type":428,"tag":436,"props":4024,"children":4025},{},[4026,4028,4034],{"type":434,"value":4027},"实际的处理中, 需要推断'obj.a'以及'obj.a.b'是否存在. 假设没有'obj.a', 那么我们应该创建一个新的对象, 并且给新的对象添加属性'b', 所以代码类似",{"type":428,"tag":442,"props":4029,"children":4031},{"className":4030},[],[4032],{"type":434,"value":4033},"walkChains",{"type":434,"value":4035},"函数, 只是稍作一层判断:",{"type":428,"tag":456,"props":4037,"children":4039},{"className":458,"code":4038,"language":460,"meta":421,"style":421},"set (key, val, obj) {\n  const segments = key.split('.')\n  // 这里需要注意, 我们只处理到倒数第二个属性\n  while (segments.length > 1) {\n    const handleKey = segments.shift()\n    const handleVal = obj[handleKey]\n    // 存在'obj.a'的情况\n    if (typeof handleVal === 'object') {\n      obj = handleVal\n    // 不存在'obj.a'则给a属性赋一个非响应式的对象\n    } else if (!handleVal) {\n      obj = (\n        key = handleKey,\n        obj[handleKey] = {},\n        obj[handleKey]\n      )\n    } else {\n      console.trace('already has val')\n    }\n  }\n  // 最后一个属性要手动赋值\n  key = segments[0]\n}\n",[4040],{"type":428,"tag":442,"props":4041,"children":4042},{"__ignoreMap":421},[4043,4075,4122,4130,4171,4203,4237,4245,4291,4308,4316,4355,4371,4391,4421,4440,4448,4463,4500,4507,4514,4522,4551],{"type":428,"tag":466,"props":4044,"children":4045},{"class":468,"line":469},[4046,4050,4054,4058,4062,4066,4071],{"type":428,"tag":466,"props":4047,"children":4048},{"style":495},[4049],{"type":434,"value":498},{"type":428,"tag":466,"props":4051,"children":4052},{"style":483},[4053],{"type":434,"value":1374},{"type":428,"tag":466,"props":4055,"children":4056},{"style":489},[4057],{"type":434,"value":524},{"type":428,"tag":466,"props":4059,"children":4060},{"style":483},[4061],{"type":434,"value":535},{"type":428,"tag":466,"props":4063,"children":4064},{"style":489},[4065],{"type":434,"value":524},{"type":428,"tag":466,"props":4067,"children":4068},{"style":483},[4069],{"type":434,"value":4070}," obj) ",{"type":428,"tag":466,"props":4072,"children":4073},{"style":489},[4074],{"type":434,"value":1428},{"type":428,"tag":466,"props":4076,"children":4077},{"class":468,"line":479},[4078,4082,4086,4090,4094,4098,4102,4106,4110,4114,4118],{"type":428,"tag":466,"props":4079,"children":4080},{"style":611},[4081],{"type":434,"value":1436},{"type":428,"tag":466,"props":4083,"children":4084},{"style":1439},[4085],{"type":434,"value":3737},{"type":428,"tag":466,"props":4087,"children":4088},{"style":719},[4089],{"type":434,"value":843},{"type":428,"tag":466,"props":4091,"children":4092},{"style":483},[4093],{"type":434,"value":1149},{"type":428,"tag":466,"props":4095,"children":4096},{"style":489},[4097],{"type":434,"value":492},{"type":428,"tag":466,"props":4099,"children":4100},{"style":495},[4101],{"type":434,"value":3754},{"type":428,"tag":466,"props":4103,"children":4104},{"style":532},[4105],{"type":434,"value":503},{"type":428,"tag":466,"props":4107,"children":4108},{"style":506},[4109],{"type":434,"value":509},{"type":428,"tag":466,"props":4111,"children":4112},{"style":512},[4113],{"type":434,"value":492},{"type":428,"tag":466,"props":4115,"children":4116},{"style":506},[4117],{"type":434,"value":509},{"type":428,"tag":466,"props":4119,"children":4120},{"style":532},[4121],{"type":434,"value":555},{"type":428,"tag":466,"props":4123,"children":4124},{"class":468,"line":558},[4125],{"type":428,"tag":466,"props":4126,"children":4127},{"style":473},[4128],{"type":434,"value":4129},"  // 这里需要注意, 我们只处理到倒数第二个属性\n",{"type":428,"tag":466,"props":4131,"children":4132},{"class":468,"line":567},[4133,4137,4141,4145,4149,4153,4158,4163,4167],{"type":428,"tag":466,"props":4134,"children":4135},{"style":1254},[4136],{"type":434,"value":3803},{"type":428,"tag":466,"props":4138,"children":4139},{"style":532},[4140],{"type":434,"value":878},{"type":428,"tag":466,"props":4142,"children":4143},{"style":483},[4144],{"type":434,"value":3812},{"type":428,"tag":466,"props":4146,"children":4147},{"style":489},[4148],{"type":434,"value":492},{"type":428,"tag":466,"props":4150,"children":4151},{"style":1439},[4152],{"type":434,"value":3821},{"type":428,"tag":466,"props":4154,"children":4155},{"style":719},[4156],{"type":434,"value":4157}," >",{"type":428,"tag":466,"props":4159,"children":4160},{"style":725},[4161],{"type":434,"value":4162}," 1",{"type":428,"tag":466,"props":4164,"children":4165},{"style":532},[4166],{"type":434,"value":1639},{"type":428,"tag":466,"props":4168,"children":4169},{"style":489},[4170],{"type":434,"value":1428},{"type":428,"tag":466,"props":4172,"children":4173},{"class":468,"line":622},[4174,4178,4183,4187,4191,4195,4199],{"type":428,"tag":466,"props":4175,"children":4176},{"style":611},[4177],{"type":434,"value":3413},{"type":428,"tag":466,"props":4179,"children":4180},{"style":1439},[4181],{"type":434,"value":4182}," handleKey",{"type":428,"tag":466,"props":4184,"children":4185},{"style":719},[4186],{"type":434,"value":843},{"type":428,"tag":466,"props":4188,"children":4189},{"style":483},[4190],{"type":434,"value":3737},{"type":428,"tag":466,"props":4192,"children":4193},{"style":489},[4194],{"type":434,"value":492},{"type":428,"tag":466,"props":4196,"children":4197},{"style":495},[4198],{"type":434,"value":3863},{"type":428,"tag":466,"props":4200,"children":4201},{"style":532},[4202],{"type":434,"value":1460},{"type":428,"tag":466,"props":4204,"children":4205},{"class":468,"line":670},[4206,4210,4215,4219,4223,4227,4232],{"type":428,"tag":466,"props":4207,"children":4208},{"style":611},[4209],{"type":434,"value":3413},{"type":428,"tag":466,"props":4211,"children":4212},{"style":1439},[4213],{"type":434,"value":4214}," handleVal",{"type":428,"tag":466,"props":4216,"children":4217},{"style":719},[4218],{"type":434,"value":843},{"type":428,"tag":466,"props":4220,"children":4221},{"style":483},[4222],{"type":434,"value":2234},{"type":428,"tag":466,"props":4224,"children":4225},{"style":532},[4226],{"type":434,"value":3850},{"type":428,"tag":466,"props":4228,"children":4229},{"style":483},[4230],{"type":434,"value":4231},"handleKey",{"type":428,"tag":466,"props":4233,"children":4234},{"style":532},[4235],{"type":434,"value":4236},"]\n",{"type":428,"tag":466,"props":4238,"children":4239},{"class":468,"line":683},[4240],{"type":428,"tag":466,"props":4241,"children":4242},{"style":473},[4243],{"type":434,"value":4244},"    // 存在'obj.a'的情况\n",{"type":428,"tag":466,"props":4246,"children":4247},{"class":468,"line":937},[4248,4252,4256,4261,4265,4269,4274,4279,4283,4287],{"type":428,"tag":466,"props":4249,"children":4250},{"style":1254},[4251],{"type":434,"value":3025},{"type":428,"tag":466,"props":4253,"children":4254},{"style":532},[4255],{"type":434,"value":878},{"type":428,"tag":466,"props":4257,"children":4258},{"style":719},[4259],{"type":434,"value":4260},"typeof",{"type":428,"tag":466,"props":4262,"children":4263},{"style":483},[4264],{"type":434,"value":4214},{"type":428,"tag":466,"props":4266,"children":4267},{"style":719},[4268],{"type":434,"value":1630},{"type":428,"tag":466,"props":4270,"children":4271},{"style":506},[4272],{"type":434,"value":4273}," '",{"type":428,"tag":466,"props":4275,"children":4276},{"style":512},[4277],{"type":434,"value":4278},"object",{"type":428,"tag":466,"props":4280,"children":4281},{"style":506},[4282],{"type":434,"value":509},{"type":428,"tag":466,"props":4284,"children":4285},{"style":532},[4286],{"type":434,"value":1639},{"type":428,"tag":466,"props":4288,"children":4289},{"style":489},[4290],{"type":434,"value":1428},{"type":428,"tag":466,"props":4292,"children":4293},{"class":468,"line":946},[4294,4299,4303],{"type":428,"tag":466,"props":4295,"children":4296},{"style":483},[4297],{"type":434,"value":4298},"      obj",{"type":428,"tag":466,"props":4300,"children":4301},{"style":719},[4302],{"type":434,"value":843},{"type":428,"tag":466,"props":4304,"children":4305},{"style":483},[4306],{"type":434,"value":4307}," handleVal\n",{"type":428,"tag":466,"props":4309,"children":4310},{"class":468,"line":981},[4311],{"type":428,"tag":466,"props":4312,"children":4313},{"style":473},[4314],{"type":434,"value":4315},"    // 不存在'obj.a'则给a属性赋一个非响应式的对象\n",{"type":428,"tag":466,"props":4317,"children":4318},{"class":468,"line":1045},[4319,4323,4328,4333,4337,4342,4347,4351],{"type":428,"tag":466,"props":4320,"children":4321},{"style":489},[4322],{"type":434,"value":3634},{"type":428,"tag":466,"props":4324,"children":4325},{"style":1254},[4326],{"type":434,"value":4327}," else",{"type":428,"tag":466,"props":4329,"children":4330},{"style":1254},[4331],{"type":434,"value":4332}," if",{"type":428,"tag":466,"props":4334,"children":4335},{"style":532},[4336],{"type":434,"value":878},{"type":428,"tag":466,"props":4338,"children":4339},{"style":719},[4340],{"type":434,"value":4341},"!",{"type":428,"tag":466,"props":4343,"children":4344},{"style":483},[4345],{"type":434,"value":4346},"handleVal",{"type":428,"tag":466,"props":4348,"children":4349},{"style":532},[4350],{"type":434,"value":1639},{"type":428,"tag":466,"props":4352,"children":4353},{"style":489},[4354],{"type":434,"value":1428},{"type":428,"tag":466,"props":4356,"children":4357},{"class":468,"line":1053},[4358,4362,4366],{"type":428,"tag":466,"props":4359,"children":4360},{"style":495},[4361],{"type":434,"value":4298},{"type":428,"tag":466,"props":4363,"children":4364},{"style":719},[4365],{"type":434,"value":843},{"type":428,"tag":466,"props":4367,"children":4368},{"style":532},[4369],{"type":434,"value":4370}," (\n",{"type":428,"tag":466,"props":4372,"children":4373},{"class":468,"line":1281},[4374,4379,4383,4387],{"type":428,"tag":466,"props":4375,"children":4376},{"style":483},[4377],{"type":434,"value":4378},"        key",{"type":428,"tag":466,"props":4380,"children":4381},{"style":719},[4382],{"type":434,"value":843},{"type":428,"tag":466,"props":4384,"children":4385},{"style":605},[4386],{"type":434,"value":4182},{"type":428,"tag":466,"props":4388,"children":4389},{"style":489},[4390],{"type":434,"value":1188},{"type":428,"tag":466,"props":4392,"children":4393},{"class":468,"line":1306},[4394,4399,4403,4407,4412,4416],{"type":428,"tag":466,"props":4395,"children":4396},{"style":483},[4397],{"type":434,"value":4398},"        obj",{"type":428,"tag":466,"props":4400,"children":4401},{"style":532},[4402],{"type":434,"value":3850},{"type":428,"tag":466,"props":4404,"children":4405},{"style":483},[4406],{"type":434,"value":4231},{"type":428,"tag":466,"props":4408,"children":4409},{"style":532},[4410],{"type":434,"value":4411},"] ",{"type":428,"tag":466,"props":4413,"children":4414},{"style":719},[4415],{"type":434,"value":722},{"type":428,"tag":466,"props":4417,"children":4418},{"style":489},[4419],{"type":434,"value":4420}," {},\n",{"type":428,"tag":466,"props":4422,"children":4423},{"class":468,"line":1324},[4424,4428,4432,4436],{"type":428,"tag":466,"props":4425,"children":4426},{"style":483},[4427],{"type":434,"value":4398},{"type":428,"tag":466,"props":4429,"children":4430},{"style":532},[4431],{"type":434,"value":3850},{"type":428,"tag":466,"props":4433,"children":4434},{"style":483},[4435],{"type":434,"value":4231},{"type":428,"tag":466,"props":4437,"children":4438},{"style":532},[4439],{"type":434,"value":4236},{"type":428,"tag":466,"props":4441,"children":4442},{"class":468,"line":1332},[4443],{"type":428,"tag":466,"props":4444,"children":4445},{"style":532},[4446],{"type":434,"value":4447},"      )\n",{"type":428,"tag":466,"props":4449,"children":4450},{"class":468,"line":1341},[4451,4455,4459],{"type":428,"tag":466,"props":4452,"children":4453},{"style":489},[4454],{"type":434,"value":3634},{"type":428,"tag":466,"props":4456,"children":4457},{"style":1254},[4458],{"type":434,"value":4327},{"type":428,"tag":466,"props":4460,"children":4461},{"style":489},[4462],{"type":434,"value":619},{"type":428,"tag":466,"props":4464,"children":4465},{"class":468,"line":2819},[4466,4470,4474,4479,4483,4487,4492,4496],{"type":428,"tag":466,"props":4467,"children":4468},{"style":483},[4469],{"type":434,"value":2489},{"type":428,"tag":466,"props":4471,"children":4472},{"style":489},[4473],{"type":434,"value":492},{"type":428,"tag":466,"props":4475,"children":4476},{"style":495},[4477],{"type":434,"value":4478},"trace",{"type":428,"tag":466,"props":4480,"children":4481},{"style":532},[4482],{"type":434,"value":503},{"type":428,"tag":466,"props":4484,"children":4485},{"style":506},[4486],{"type":434,"value":509},{"type":428,"tag":466,"props":4488,"children":4489},{"style":512},[4490],{"type":434,"value":4491},"already has val",{"type":428,"tag":466,"props":4493,"children":4494},{"style":506},[4495],{"type":434,"value":509},{"type":428,"tag":466,"props":4497,"children":4498},{"style":532},[4499],{"type":434,"value":555},{"type":428,"tag":466,"props":4501,"children":4502},{"class":468,"line":2832},[4503],{"type":428,"tag":466,"props":4504,"children":4505},{"style":489},[4506],{"type":434,"value":1719},{"type":428,"tag":466,"props":4508,"children":4509},{"class":468,"line":2840},[4510],{"type":428,"tag":466,"props":4511,"children":4512},{"style":489},[4513],{"type":434,"value":856},{"type":428,"tag":466,"props":4515,"children":4516},{"class":468,"line":3407},[4517],{"type":428,"tag":466,"props":4518,"children":4519},{"style":473},[4520],{"type":434,"value":4521},"  // 最后一个属性要手动赋值\n",{"type":428,"tag":466,"props":4523,"children":4524},{"class":468,"line":3436},[4525,4530,4534,4538,4542,4547],{"type":428,"tag":466,"props":4526,"children":4527},{"style":483},[4528],{"type":434,"value":4529},"  key",{"type":428,"tag":466,"props":4531,"children":4532},{"style":719},[4533],{"type":434,"value":843},{"type":428,"tag":466,"props":4535,"children":4536},{"style":483},[4537],{"type":434,"value":3737},{"type":428,"tag":466,"props":4539,"children":4540},{"style":532},[4541],{"type":434,"value":3850},{"type":428,"tag":466,"props":4543,"children":4544},{"style":725},[4545],{"type":434,"value":4546},"0",{"type":428,"tag":466,"props":4548,"children":4549},{"style":532},[4550],{"type":434,"value":4236},{"type":428,"tag":466,"props":4552,"children":4553},{"class":468,"line":3477},[4554],{"type":428,"tag":466,"props":4555,"children":4556},{"style":489},[4557],{"type":434,"value":1059},{"type":428,"tag":429,"props":4559,"children":4561},{"id":4560},"业务场景应用",[4562],{"type":434,"value":4560},{"type":428,"tag":1079,"props":4564,"children":4566},{"id":4565},"小程序跨页面刷新数据",[4567],{"type":434,"value":4565},{"type":428,"tag":436,"props":4569,"children":4570},{},[4571],{"type":434,"value":4572},"我们经常碰到在小程序中由 A 页面跳转到 B 页面, 如果 B 页面进行了一些操作, 希望 A 页面自动刷新数据的情况. 但是由于 A 页面跳转到 B 页面不同(也许是 redirect,也许是 navigate), 处理方法也不尽相同.",{"type":428,"tag":436,"props":4574,"children":4575},{},[4576],{"type":434,"value":4577},"使用 navigate 方式跳转后, A 页面不会被注销, 所以我们一般会通过全局对象去贮存 A 页面实例(也就是 A 页面的 this 对象), 然后在 B 页面直接调用相应的方法(如 A.refreshList())进行刷新操作.",{"type":428,"tag":436,"props":4579,"children":4580},{},[4581,4583,4589],{"type":434,"value":4582},"引入 VX 后, 我们可以在",{"type":428,"tag":442,"props":4584,"children":4586},{"className":4585},[],[4587],{"type":434,"value":4588},"onload",{"type":434,"value":4590},"生命周期直接调用 watch 方法添加订阅:",{"type":428,"tag":456,"props":4592,"children":4594},{"className":458,"code":4593,"language":460,"meta":421,"style":421},"// app.js\nimport VX from '@/utils/suites/vx'\nconst vx = new VX()\napp.vx = vx\napp.store = vx.store\napp.vx.set('userType', '商户')\n\n// page a\nonLoad () {\n  app.vx.watch('userType', userType => {\n    if (userType === '商户') {\n      // ...\n    } else if (userType === '管理员') {\n      // ...\n    }\n  }, {\n    immediate: true\n  })\n}\n\n// page b\nswitchUserType () {\n  app.store.userType = '管理员'\n}\n",[4595],{"type":428,"tag":442,"props":4596,"children":4597},{"__ignoreMap":421},[4598,4606,4638,4665,4691,4724,4785,4792,4800,4817,4874,4913,4921,4969,4976,4983,4995,5012,5023,5030,5037,5045,5061,5100],{"type":428,"tag":466,"props":4599,"children":4600},{"class":468,"line":469},[4601],{"type":428,"tag":466,"props":4602,"children":4603},{"style":473},[4604],{"type":434,"value":4605},"// app.js\n",{"type":428,"tag":466,"props":4607,"children":4608},{"class":468,"line":479},[4609,4614,4619,4624,4628,4633],{"type":428,"tag":466,"props":4610,"children":4611},{"style":1254},[4612],{"type":434,"value":4613},"import",{"type":428,"tag":466,"props":4615,"children":4616},{"style":483},[4617],{"type":434,"value":4618}," VX ",{"type":428,"tag":466,"props":4620,"children":4621},{"style":1254},[4622],{"type":434,"value":4623},"from",{"type":428,"tag":466,"props":4625,"children":4626},{"style":506},[4627],{"type":434,"value":4273},{"type":428,"tag":466,"props":4629,"children":4630},{"style":512},[4631],{"type":434,"value":4632},"@/utils/suites/vx",{"type":428,"tag":466,"props":4634,"children":4635},{"style":506},[4636],{"type":434,"value":4637},"'\n",{"type":428,"tag":466,"props":4639,"children":4640},{"class":468,"line":558},[4641,4645,4649,4653,4657,4661],{"type":428,"tag":466,"props":4642,"children":4643},{"style":611},[4644],{"type":434,"value":1925},{"type":428,"tag":466,"props":4646,"children":4647},{"style":1439},[4648],{"type":434,"value":2346},{"type":428,"tag":466,"props":4650,"children":4651},{"style":719},[4652],{"type":434,"value":843},{"type":428,"tag":466,"props":4654,"children":4655},{"style":719},[4656],{"type":434,"value":1451},{"type":428,"tag":466,"props":4658,"children":4659},{"style":495},[4660],{"type":434,"value":2125},{"type":428,"tag":466,"props":4662,"children":4663},{"style":483},[4664],{"type":434,"value":1460},{"type":428,"tag":466,"props":4666,"children":4667},{"class":468,"line":567},[4668,4673,4677,4682,4686],{"type":428,"tag":466,"props":4669,"children":4670},{"style":483},[4671],{"type":434,"value":4672},"app",{"type":428,"tag":466,"props":4674,"children":4675},{"style":489},[4676],{"type":434,"value":492},{"type":428,"tag":466,"props":4678,"children":4679},{"style":483},[4680],{"type":434,"value":4681},"vx ",{"type":428,"tag":466,"props":4683,"children":4684},{"style":719},[4685],{"type":434,"value":722},{"type":428,"tag":466,"props":4687,"children":4688},{"style":483},[4689],{"type":434,"value":4690}," vx\n",{"type":428,"tag":466,"props":4692,"children":4693},{"class":468,"line":622},[4694,4698,4702,4707,4711,4715,4719],{"type":428,"tag":466,"props":4695,"children":4696},{"style":483},[4697],{"type":434,"value":4672},{"type":428,"tag":466,"props":4699,"children":4700},{"style":489},[4701],{"type":434,"value":492},{"type":428,"tag":466,"props":4703,"children":4704},{"style":483},[4705],{"type":434,"value":4706},"store ",{"type":428,"tag":466,"props":4708,"children":4709},{"style":719},[4710],{"type":434,"value":722},{"type":428,"tag":466,"props":4712,"children":4713},{"style":483},[4714],{"type":434,"value":2346},{"type":428,"tag":466,"props":4716,"children":4717},{"style":489},[4718],{"type":434,"value":492},{"type":428,"tag":466,"props":4720,"children":4721},{"style":483},[4722],{"type":434,"value":4723},"store\n",{"type":428,"tag":466,"props":4725,"children":4726},{"class":468,"line":670},[4727,4731,4735,4739,4743,4747,4751,4755,4760,4764,4768,4772,4777,4781],{"type":428,"tag":466,"props":4728,"children":4729},{"style":483},[4730],{"type":434,"value":4672},{"type":428,"tag":466,"props":4732,"children":4733},{"style":489},[4734],{"type":434,"value":492},{"type":428,"tag":466,"props":4736,"children":4737},{"style":483},[4738],{"type":434,"value":486},{"type":428,"tag":466,"props":4740,"children":4741},{"style":489},[4742],{"type":434,"value":492},{"type":428,"tag":466,"props":4744,"children":4745},{"style":495},[4746],{"type":434,"value":498},{"type":428,"tag":466,"props":4748,"children":4749},{"style":483},[4750],{"type":434,"value":503},{"type":428,"tag":466,"props":4752,"children":4753},{"style":506},[4754],{"type":434,"value":509},{"type":428,"tag":466,"props":4756,"children":4757},{"style":512},[4758],{"type":434,"value":4759},"userType",{"type":428,"tag":466,"props":4761,"children":4762},{"style":506},[4763],{"type":434,"value":509},{"type":428,"tag":466,"props":4765,"children":4766},{"style":489},[4767],{"type":434,"value":524},{"type":428,"tag":466,"props":4769,"children":4770},{"style":506},[4771],{"type":434,"value":4273},{"type":428,"tag":466,"props":4773,"children":4774},{"style":512},[4775],{"type":434,"value":4776},"商户",{"type":428,"tag":466,"props":4778,"children":4779},{"style":506},[4780],{"type":434,"value":509},{"type":428,"tag":466,"props":4782,"children":4783},{"style":483},[4784],{"type":434,"value":555},{"type":428,"tag":466,"props":4786,"children":4787},{"class":468,"line":683},[4788],{"type":428,"tag":466,"props":4789,"children":4790},{"emptyLinePlaceholder":420},[4791],{"type":434,"value":3188},{"type":428,"tag":466,"props":4793,"children":4794},{"class":468,"line":937},[4795],{"type":428,"tag":466,"props":4796,"children":4797},{"style":473},[4798],{"type":434,"value":4799},"// page a\n",{"type":428,"tag":466,"props":4801,"children":4802},{"class":468,"line":946},[4803,4808,4813],{"type":428,"tag":466,"props":4804,"children":4805},{"style":495},[4806],{"type":434,"value":4807},"onLoad",{"type":428,"tag":466,"props":4809,"children":4810},{"style":483},[4811],{"type":434,"value":4812}," () ",{"type":428,"tag":466,"props":4814,"children":4815},{"style":489},[4816],{"type":434,"value":1428},{"type":428,"tag":466,"props":4818,"children":4819},{"class":468,"line":981},[4820,4825,4829,4833,4837,4841,4845,4849,4853,4857,4861,4866,4870],{"type":428,"tag":466,"props":4821,"children":4822},{"style":483},[4823],{"type":434,"value":4824},"  app",{"type":428,"tag":466,"props":4826,"children":4827},{"style":489},[4828],{"type":434,"value":492},{"type":428,"tag":466,"props":4830,"children":4831},{"style":483},[4832],{"type":434,"value":486},{"type":428,"tag":466,"props":4834,"children":4835},{"style":489},[4836],{"type":434,"value":492},{"type":428,"tag":466,"props":4838,"children":4839},{"style":495},[4840],{"type":434,"value":581},{"type":428,"tag":466,"props":4842,"children":4843},{"style":532},[4844],{"type":434,"value":503},{"type":428,"tag":466,"props":4846,"children":4847},{"style":506},[4848],{"type":434,"value":509},{"type":428,"tag":466,"props":4850,"children":4851},{"style":512},[4852],{"type":434,"value":4759},{"type":428,"tag":466,"props":4854,"children":4855},{"style":506},[4856],{"type":434,"value":509},{"type":428,"tag":466,"props":4858,"children":4859},{"style":489},[4860],{"type":434,"value":524},{"type":428,"tag":466,"props":4862,"children":4863},{"style":605},[4864],{"type":434,"value":4865}," userType",{"type":428,"tag":466,"props":4867,"children":4868},{"style":611},[4869],{"type":434,"value":614},{"type":428,"tag":466,"props":4871,"children":4872},{"style":489},[4873],{"type":434,"value":619},{"type":428,"tag":466,"props":4875,"children":4876},{"class":468,"line":1045},[4877,4881,4885,4889,4893,4897,4901,4905,4909],{"type":428,"tag":466,"props":4878,"children":4879},{"style":1254},[4880],{"type":434,"value":3025},{"type":428,"tag":466,"props":4882,"children":4883},{"style":532},[4884],{"type":434,"value":878},{"type":428,"tag":466,"props":4886,"children":4887},{"style":483},[4888],{"type":434,"value":4759},{"type":428,"tag":466,"props":4890,"children":4891},{"style":719},[4892],{"type":434,"value":1630},{"type":428,"tag":466,"props":4894,"children":4895},{"style":506},[4896],{"type":434,"value":4273},{"type":428,"tag":466,"props":4898,"children":4899},{"style":512},[4900],{"type":434,"value":4776},{"type":428,"tag":466,"props":4902,"children":4903},{"style":506},[4904],{"type":434,"value":509},{"type":428,"tag":466,"props":4906,"children":4907},{"style":532},[4908],{"type":434,"value":1639},{"type":428,"tag":466,"props":4910,"children":4911},{"style":489},[4912],{"type":434,"value":1428},{"type":428,"tag":466,"props":4914,"children":4915},{"class":468,"line":1053},[4916],{"type":428,"tag":466,"props":4917,"children":4918},{"style":473},[4919],{"type":434,"value":4920},"      // ...\n",{"type":428,"tag":466,"props":4922,"children":4923},{"class":468,"line":1281},[4924,4928,4932,4936,4940,4944,4948,4952,4957,4961,4965],{"type":428,"tag":466,"props":4925,"children":4926},{"style":489},[4927],{"type":434,"value":3634},{"type":428,"tag":466,"props":4929,"children":4930},{"style":1254},[4931],{"type":434,"value":4327},{"type":428,"tag":466,"props":4933,"children":4934},{"style":1254},[4935],{"type":434,"value":4332},{"type":428,"tag":466,"props":4937,"children":4938},{"style":532},[4939],{"type":434,"value":878},{"type":428,"tag":466,"props":4941,"children":4942},{"style":483},[4943],{"type":434,"value":4759},{"type":428,"tag":466,"props":4945,"children":4946},{"style":719},[4947],{"type":434,"value":1630},{"type":428,"tag":466,"props":4949,"children":4950},{"style":506},[4951],{"type":434,"value":4273},{"type":428,"tag":466,"props":4953,"children":4954},{"style":512},[4955],{"type":434,"value":4956},"管理员",{"type":428,"tag":466,"props":4958,"children":4959},{"style":506},[4960],{"type":434,"value":509},{"type":428,"tag":466,"props":4962,"children":4963},{"style":532},[4964],{"type":434,"value":1639},{"type":428,"tag":466,"props":4966,"children":4967},{"style":489},[4968],{"type":434,"value":1428},{"type":428,"tag":466,"props":4970,"children":4971},{"class":468,"line":1306},[4972],{"type":428,"tag":466,"props":4973,"children":4974},{"style":473},[4975],{"type":434,"value":4920},{"type":428,"tag":466,"props":4977,"children":4978},{"class":468,"line":1324},[4979],{"type":428,"tag":466,"props":4980,"children":4981},{"style":489},[4982],{"type":434,"value":1719},{"type":428,"tag":466,"props":4984,"children":4985},{"class":468,"line":1332},[4986,4991],{"type":428,"tag":466,"props":4987,"children":4988},{"style":489},[4989],{"type":434,"value":4990},"  },",{"type":428,"tag":466,"props":4992,"children":4993},{"style":489},[4994],{"type":434,"value":619},{"type":428,"tag":466,"props":4996,"children":4997},{"class":468,"line":1341},[4998,5003,5007],{"type":428,"tag":466,"props":4999,"children":5000},{"style":532},[5001],{"type":434,"value":5002},"    immediate",{"type":428,"tag":466,"props":5004,"children":5005},{"style":489},[5006],{"type":434,"value":540},{"type":428,"tag":466,"props":5008,"children":5009},{"style":1180},[5010],{"type":434,"value":5011}," true\n",{"type":428,"tag":466,"props":5013,"children":5014},{"class":468,"line":2819},[5015,5019],{"type":428,"tag":466,"props":5016,"children":5017},{"style":489},[5018],{"type":434,"value":1727},{"type":428,"tag":466,"props":5020,"children":5021},{"style":532},[5022],{"type":434,"value":555},{"type":428,"tag":466,"props":5024,"children":5025},{"class":468,"line":2832},[5026],{"type":428,"tag":466,"props":5027,"children":5028},{"style":489},[5029],{"type":434,"value":1059},{"type":428,"tag":466,"props":5031,"children":5032},{"class":468,"line":2840},[5033],{"type":428,"tag":466,"props":5034,"children":5035},{"emptyLinePlaceholder":420},[5036],{"type":434,"value":3188},{"type":428,"tag":466,"props":5038,"children":5039},{"class":468,"line":3407},[5040],{"type":428,"tag":466,"props":5041,"children":5042},{"style":473},[5043],{"type":434,"value":5044},"// page b\n",{"type":428,"tag":466,"props":5046,"children":5047},{"class":468,"line":3436},[5048,5053,5057],{"type":428,"tag":466,"props":5049,"children":5050},{"style":495},[5051],{"type":434,"value":5052},"switchUserType",{"type":428,"tag":466,"props":5054,"children":5055},{"style":483},[5056],{"type":434,"value":4812},{"type":428,"tag":466,"props":5058,"children":5059},{"style":489},[5060],{"type":434,"value":1428},{"type":428,"tag":466,"props":5062,"children":5063},{"class":468,"line":3477},[5064,5068,5072,5076,5080,5084,5088,5092,5096],{"type":428,"tag":466,"props":5065,"children":5066},{"style":483},[5067],{"type":434,"value":4824},{"type":428,"tag":466,"props":5069,"children":5070},{"style":489},[5071],{"type":434,"value":492},{"type":428,"tag":466,"props":5073,"children":5074},{"style":483},[5075],{"type":434,"value":2160},{"type":428,"tag":466,"props":5077,"children":5078},{"style":489},[5079],{"type":434,"value":492},{"type":428,"tag":466,"props":5081,"children":5082},{"style":483},[5083],{"type":434,"value":4759},{"type":428,"tag":466,"props":5085,"children":5086},{"style":719},[5087],{"type":434,"value":843},{"type":428,"tag":466,"props":5089,"children":5090},{"style":506},[5091],{"type":434,"value":4273},{"type":428,"tag":466,"props":5093,"children":5094},{"style":512},[5095],{"type":434,"value":4956},{"type":428,"tag":466,"props":5097,"children":5098},{"style":506},[5099],{"type":434,"value":4637},{"type":428,"tag":466,"props":5101,"children":5102},{"class":468,"line":3498},[5103],{"type":428,"tag":466,"props":5104,"children":5105},{"style":489},[5106],{"type":434,"value":1059},{"type":428,"tag":429,"props":5108,"children":5110},{"id":5109},"可能遇到的问题",[5111],{"type":434,"value":5109},{"type":428,"tag":1079,"props":5113,"children":5115},{"id":5114},"给-watch-方法添加的函数设置立即执行",[5116],{"type":434,"value":5117},"给 watch 方法添加的函数设置立即执行",{"type":428,"tag":436,"props":5119,"children":5120},{},[5121],{"type":434,"value":5122},"有的时候我们希望通过 watch 添加函数的同时还立即执行该函数一次, 这个时候我们需要再定义额外的参数传递到 watch 中. 问题是这个函数不一定是同步函数.",{"type":428,"tag":436,"props":5124,"children":5125},{},[5126],{"type":434,"value":5127},"简单处理如下:",{"type":428,"tag":456,"props":5129,"children":5131},{"className":458,"code":5130,"language":460,"meta":421,"style":421},"class VX {\n  async watch (key, fn, options = { immediately: false }, obj = this.store) {\n    handleDep = fn\n    walkChains(key, obj)\n    options.immediately && await fn(options.defaultParams)\n  }\n}\n",[5132],{"type":428,"tag":442,"props":5133,"children":5134},{"__ignoreMap":421},[5135,5150,5243,5259,5286,5338,5345],{"type":428,"tag":466,"props":5136,"children":5137},{"class":468,"line":469},[5138,5142,5146],{"type":428,"tag":466,"props":5139,"children":5140},{"style":611},[5141],{"type":434,"value":793},{"type":428,"tag":466,"props":5143,"children":5144},{"style":796},[5145],{"type":434,"value":2125},{"type":428,"tag":466,"props":5147,"children":5148},{"style":489},[5149],{"type":434,"value":619},{"type":428,"tag":466,"props":5151,"children":5152},{"class":468,"line":479},[5153,5159,5164,5168,5172,5176,5180,5184,5188,5192,5196,5201,5205,5210,5215,5219,5223,5227,5231,5235,5239],{"type":428,"tag":466,"props":5154,"children":5156},{"style":5155},"--shiki-light:#9C3EDA;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[5157],{"type":434,"value":5158},"  async",{"type":428,"tag":466,"props":5160,"children":5161},{"style":870},[5162],{"type":434,"value":5163}," watch",{"type":428,"tag":466,"props":5165,"children":5166},{"style":489},[5167],{"type":434,"value":878},{"type":428,"tag":466,"props":5169,"children":5170},{"style":605},[5171],{"type":434,"value":2216},{"type":428,"tag":466,"props":5173,"children":5174},{"style":489},[5175],{"type":434,"value":524},{"type":428,"tag":466,"props":5177,"children":5178},{"style":605},[5179],{"type":434,"value":2225},{"type":428,"tag":466,"props":5181,"children":5182},{"style":489},[5183],{"type":434,"value":524},{"type":428,"tag":466,"props":5185,"children":5186},{"style":605},[5187],{"type":434,"value":2291},{"type":428,"tag":466,"props":5189,"children":5190},{"style":719},[5191],{"type":434,"value":843},{"type":428,"tag":466,"props":5193,"children":5194},{"style":489},[5195],{"type":434,"value":529},{"type":428,"tag":466,"props":5197,"children":5198},{"style":532},[5199],{"type":434,"value":5200}," immediately",{"type":428,"tag":466,"props":5202,"children":5203},{"style":489},[5204],{"type":434,"value":540},{"type":428,"tag":466,"props":5206,"children":5207},{"style":1180},[5208],{"type":434,"value":5209}," false",{"type":428,"tag":466,"props":5211,"children":5212},{"style":489},[5213],{"type":434,"value":5214}," },",{"type":428,"tag":466,"props":5216,"children":5217},{"style":605},[5218],{"type":434,"value":2234},{"type":428,"tag":466,"props":5220,"children":5221},{"style":719},[5222],{"type":434,"value":843},{"type":428,"tag":466,"props":5224,"children":5225},{"style":826},[5226],{"type":434,"value":1414},{"type":428,"tag":466,"props":5228,"children":5229},{"style":489},[5230],{"type":434,"value":492},{"type":428,"tag":466,"props":5232,"children":5233},{"style":483},[5234],{"type":434,"value":2160},{"type":428,"tag":466,"props":5236,"children":5237},{"style":489},[5238],{"type":434,"value":888},{"type":428,"tag":466,"props":5240,"children":5241},{"style":489},[5242],{"type":434,"value":619},{"type":428,"tag":466,"props":5244,"children":5245},{"class":468,"line":558},[5246,5251,5255],{"type":428,"tag":466,"props":5247,"children":5248},{"style":483},[5249],{"type":434,"value":5250},"    handleDep",{"type":428,"tag":466,"props":5252,"children":5253},{"style":719},[5254],{"type":434,"value":843},{"type":428,"tag":466,"props":5256,"children":5257},{"style":483},[5258],{"type":434,"value":3294},{"type":428,"tag":466,"props":5260,"children":5261},{"class":468,"line":567},[5262,5266,5270,5274,5278,5282],{"type":428,"tag":466,"props":5263,"children":5264},{"style":495},[5265],{"type":434,"value":3975},{"type":428,"tag":466,"props":5267,"children":5268},{"style":532},[5269],{"type":434,"value":503},{"type":428,"tag":466,"props":5271,"children":5272},{"style":483},[5273],{"type":434,"value":2216},{"type":428,"tag":466,"props":5275,"children":5276},{"style":489},[5277],{"type":434,"value":524},{"type":428,"tag":466,"props":5279,"children":5280},{"style":483},[5281],{"type":434,"value":2234},{"type":428,"tag":466,"props":5283,"children":5284},{"style":532},[5285],{"type":434,"value":555},{"type":428,"tag":466,"props":5287,"children":5288},{"class":468,"line":622},[5289,5294,5298,5303,5307,5312,5316,5320,5325,5329,5334],{"type":428,"tag":466,"props":5290,"children":5291},{"style":483},[5292],{"type":434,"value":5293},"    options",{"type":428,"tag":466,"props":5295,"children":5296},{"style":489},[5297],{"type":434,"value":492},{"type":428,"tag":466,"props":5299,"children":5300},{"style":483},[5301],{"type":434,"value":5302},"immediately",{"type":428,"tag":466,"props":5304,"children":5305},{"style":719},[5306],{"type":434,"value":3038},{"type":428,"tag":466,"props":5308,"children":5309},{"style":1254},[5310],{"type":434,"value":5311}," await",{"type":428,"tag":466,"props":5313,"children":5314},{"style":495},[5315],{"type":434,"value":2225},{"type":428,"tag":466,"props":5317,"children":5318},{"style":532},[5319],{"type":434,"value":503},{"type":428,"tag":466,"props":5321,"children":5322},{"style":483},[5323],{"type":434,"value":5324},"options",{"type":428,"tag":466,"props":5326,"children":5327},{"style":489},[5328],{"type":434,"value":492},{"type":428,"tag":466,"props":5330,"children":5331},{"style":483},[5332],{"type":434,"value":5333},"defaultParams",{"type":428,"tag":466,"props":5335,"children":5336},{"style":532},[5337],{"type":434,"value":555},{"type":428,"tag":466,"props":5339,"children":5340},{"class":468,"line":670},[5341],{"type":428,"tag":466,"props":5342,"children":5343},{"style":489},[5344],{"type":434,"value":856},{"type":428,"tag":466,"props":5346,"children":5347},{"class":468,"line":683},[5348],{"type":428,"tag":466,"props":5349,"children":5350},{"style":489},[5351],{"type":434,"value":1059},{"type":428,"tag":1079,"props":5353,"children":5355},{"id":5354},"this-绑定丢失问题",[5356],{"type":434,"value":5357},"this 绑定丢失问题",{"type":428,"tag":436,"props":5359,"children":5360},{},[5361],{"type":434,"value":5362},"在我在对 VX 进行删除属性方法的扩展时, 我往 walkChain 函数中添加了一个执行回调函数的机制, 并且在删除属性这个方法直接调用了 walkChain:",{"type":428,"tag":456,"props":5364,"children":5366},{"className":458,"code":5365,"language":460,"meta":421,"style":421},"  function walkChains (key, obj, fn) {\n    const segments = key.split('.')\n    let deepObj = obj\n    while (segments.length) {\n      deepObj = deepObj[segments.shift()]\n      fn && fn()\n    }\n  }\n",[5367],{"type":428,"tag":442,"props":5368,"children":5369},{"__ignoreMap":421},[5370,5414,5461,5481,5513,5549,5569,5576],{"type":428,"tag":466,"props":5371,"children":5372},{"class":468,"line":469},[5373,5378,5382,5386,5390,5394,5398,5402,5406,5410],{"type":428,"tag":466,"props":5374,"children":5375},{"style":611},[5376],{"type":434,"value":5377},"  function",{"type":428,"tag":466,"props":5379,"children":5380},{"style":495},[5381],{"type":434,"value":3701},{"type":428,"tag":466,"props":5383,"children":5384},{"style":489},[5385],{"type":434,"value":878},{"type":428,"tag":466,"props":5387,"children":5388},{"style":605},[5389],{"type":434,"value":2216},{"type":428,"tag":466,"props":5391,"children":5392},{"style":489},[5393],{"type":434,"value":524},{"type":428,"tag":466,"props":5395,"children":5396},{"style":605},[5397],{"type":434,"value":2234},{"type":428,"tag":466,"props":5399,"children":5400},{"style":489},[5401],{"type":434,"value":524},{"type":428,"tag":466,"props":5403,"children":5404},{"style":605},[5405],{"type":434,"value":2225},{"type":428,"tag":466,"props":5407,"children":5408},{"style":489},[5409],{"type":434,"value":888},{"type":428,"tag":466,"props":5411,"children":5412},{"style":489},[5413],{"type":434,"value":619},{"type":428,"tag":466,"props":5415,"children":5416},{"class":468,"line":479},[5417,5421,5425,5429,5433,5437,5441,5445,5449,5453,5457],{"type":428,"tag":466,"props":5418,"children":5419},{"style":611},[5420],{"type":434,"value":3413},{"type":428,"tag":466,"props":5422,"children":5423},{"style":1439},[5424],{"type":434,"value":3737},{"type":428,"tag":466,"props":5426,"children":5427},{"style":719},[5428],{"type":434,"value":843},{"type":428,"tag":466,"props":5430,"children":5431},{"style":483},[5432],{"type":434,"value":1149},{"type":428,"tag":466,"props":5434,"children":5435},{"style":489},[5436],{"type":434,"value":492},{"type":428,"tag":466,"props":5438,"children":5439},{"style":495},[5440],{"type":434,"value":3754},{"type":428,"tag":466,"props":5442,"children":5443},{"style":532},[5444],{"type":434,"value":503},{"type":428,"tag":466,"props":5446,"children":5447},{"style":506},[5448],{"type":434,"value":509},{"type":428,"tag":466,"props":5450,"children":5451},{"style":512},[5452],{"type":434,"value":492},{"type":428,"tag":466,"props":5454,"children":5455},{"style":506},[5456],{"type":434,"value":509},{"type":428,"tag":466,"props":5458,"children":5459},{"style":532},[5460],{"type":434,"value":555},{"type":428,"tag":466,"props":5462,"children":5463},{"class":468,"line":558},[5464,5469,5473,5477],{"type":428,"tag":466,"props":5465,"children":5466},{"style":611},[5467],{"type":434,"value":5468},"    let",{"type":428,"tag":466,"props":5470,"children":5471},{"style":483},[5472],{"type":434,"value":3786},{"type":428,"tag":466,"props":5474,"children":5475},{"style":719},[5476],{"type":434,"value":843},{"type":428,"tag":466,"props":5478,"children":5479},{"style":483},[5480],{"type":434,"value":3795},{"type":428,"tag":466,"props":5482,"children":5483},{"class":468,"line":567},[5484,5489,5493,5497,5501,5505,5509],{"type":428,"tag":466,"props":5485,"children":5486},{"style":1254},[5487],{"type":434,"value":5488},"    while",{"type":428,"tag":466,"props":5490,"children":5491},{"style":532},[5492],{"type":434,"value":878},{"type":428,"tag":466,"props":5494,"children":5495},{"style":483},[5496],{"type":434,"value":3812},{"type":428,"tag":466,"props":5498,"children":5499},{"style":489},[5500],{"type":434,"value":492},{"type":428,"tag":466,"props":5502,"children":5503},{"style":1439},[5504],{"type":434,"value":3821},{"type":428,"tag":466,"props":5506,"children":5507},{"style":532},[5508],{"type":434,"value":1639},{"type":428,"tag":466,"props":5510,"children":5511},{"style":489},[5512],{"type":434,"value":1428},{"type":428,"tag":466,"props":5514,"children":5515},{"class":468,"line":622},[5516,5521,5525,5529,5533,5537,5541,5545],{"type":428,"tag":466,"props":5517,"children":5518},{"style":483},[5519],{"type":434,"value":5520},"      deepObj",{"type":428,"tag":466,"props":5522,"children":5523},{"style":719},[5524],{"type":434,"value":843},{"type":428,"tag":466,"props":5526,"children":5527},{"style":483},[5528],{"type":434,"value":3786},{"type":428,"tag":466,"props":5530,"children":5531},{"style":532},[5532],{"type":434,"value":3850},{"type":428,"tag":466,"props":5534,"children":5535},{"style":483},[5536],{"type":434,"value":3812},{"type":428,"tag":466,"props":5538,"children":5539},{"style":489},[5540],{"type":434,"value":492},{"type":428,"tag":466,"props":5542,"children":5543},{"style":495},[5544],{"type":434,"value":3863},{"type":428,"tag":466,"props":5546,"children":5547},{"style":532},[5548],{"type":434,"value":3868},{"type":428,"tag":466,"props":5550,"children":5551},{"class":468,"line":670},[5552,5557,5561,5565],{"type":428,"tag":466,"props":5553,"children":5554},{"style":483},[5555],{"type":434,"value":5556},"      fn",{"type":428,"tag":466,"props":5558,"children":5559},{"style":719},[5560],{"type":434,"value":3038},{"type":428,"tag":466,"props":5562,"children":5563},{"style":495},[5564],{"type":434,"value":2225},{"type":428,"tag":466,"props":5566,"children":5567},{"style":532},[5568],{"type":434,"value":1460},{"type":428,"tag":466,"props":5570,"children":5571},{"class":468,"line":683},[5572],{"type":428,"tag":466,"props":5573,"children":5574},{"style":489},[5575],{"type":434,"value":1719},{"type":428,"tag":466,"props":5577,"children":5578},{"class":468,"line":937},[5579],{"type":428,"tag":466,"props":5580,"children":5581},{"style":489},[5582],{"type":434,"value":856},{"type":428,"tag":456,"props":5584,"children":5586},{"className":458,"code":5585,"language":460,"meta":421,"style":421},"del (key, obj = this.store) {\n  walkChains(key, obj, handleDep.clear)\n  delete obj[key]\n}\n",[5587],{"type":428,"tag":442,"props":5588,"children":5589},{"__ignoreMap":421},[5590,5630,5676,5700],{"type":428,"tag":466,"props":5591,"children":5592},{"class":468,"line":469},[5593,5598,5602,5606,5610,5614,5618,5622,5626],{"type":428,"tag":466,"props":5594,"children":5595},{"style":495},[5596],{"type":434,"value":5597},"del",{"type":428,"tag":466,"props":5599,"children":5600},{"style":483},[5601],{"type":434,"value":1374},{"type":428,"tag":466,"props":5603,"children":5604},{"style":489},[5605],{"type":434,"value":524},{"type":428,"tag":466,"props":5607,"children":5608},{"style":483},[5609],{"type":434,"value":1405},{"type":428,"tag":466,"props":5611,"children":5612},{"style":719},[5613],{"type":434,"value":722},{"type":428,"tag":466,"props":5615,"children":5616},{"style":826},[5617],{"type":434,"value":1414},{"type":428,"tag":466,"props":5619,"children":5620},{"style":489},[5621],{"type":434,"value":492},{"type":428,"tag":466,"props":5623,"children":5624},{"style":483},[5625],{"type":434,"value":1423},{"type":428,"tag":466,"props":5627,"children":5628},{"style":489},[5629],{"type":434,"value":1428},{"type":428,"tag":466,"props":5631,"children":5632},{"class":468,"line":479},[5633,5638,5642,5646,5650,5654,5658,5663,5667,5672],{"type":428,"tag":466,"props":5634,"children":5635},{"style":495},[5636],{"type":434,"value":5637},"  walkChains",{"type":428,"tag":466,"props":5639,"children":5640},{"style":532},[5641],{"type":434,"value":503},{"type":428,"tag":466,"props":5643,"children":5644},{"style":483},[5645],{"type":434,"value":2216},{"type":428,"tag":466,"props":5647,"children":5648},{"style":489},[5649],{"type":434,"value":524},{"type":428,"tag":466,"props":5651,"children":5652},{"style":483},[5653],{"type":434,"value":2234},{"type":428,"tag":466,"props":5655,"children":5656},{"style":489},[5657],{"type":434,"value":524},{"type":428,"tag":466,"props":5659,"children":5660},{"style":483},[5661],{"type":434,"value":5662}," handleDep",{"type":428,"tag":466,"props":5664,"children":5665},{"style":489},[5666],{"type":434,"value":492},{"type":428,"tag":466,"props":5668,"children":5669},{"style":483},[5670],{"type":434,"value":5671},"clear",{"type":428,"tag":466,"props":5673,"children":5674},{"style":532},[5675],{"type":434,"value":555},{"type":428,"tag":466,"props":5677,"children":5678},{"class":468,"line":558},[5679,5684,5688,5692,5696],{"type":428,"tag":466,"props":5680,"children":5681},{"style":719},[5682],{"type":434,"value":5683},"  delete",{"type":428,"tag":466,"props":5685,"children":5686},{"style":483},[5687],{"type":434,"value":2234},{"type":428,"tag":466,"props":5689,"children":5690},{"style":532},[5691],{"type":434,"value":3850},{"type":428,"tag":466,"props":5693,"children":5694},{"style":483},[5695],{"type":434,"value":2216},{"type":428,"tag":466,"props":5697,"children":5698},{"style":532},[5699],{"type":434,"value":4236},{"type":428,"tag":466,"props":5701,"children":5702},{"class":468,"line":567},[5703],{"type":428,"tag":466,"props":5704,"children":5705},{"style":489},[5706],{"type":434,"value":1059},{"type":428,"tag":436,"props":5708,"children":5709},{},[5710,5712,5717],{"type":434,"value":5711},"因为 handleDep.clear 当成参数传递进 walkChains 中会",{"type":428,"tag":772,"props":5713,"children":5714},{},[5715],{"type":434,"value":5716},"丢失 this 绑定",{"type":434,"value":5718},", 所以上面那段代码其实是有问题的, 不过稍作修改就好了:",{"type":428,"tag":456,"props":5720,"children":5722},{"className":458,"code":5721,"language":460,"meta":421,"style":421},"  del (key, obj = this.store) {\n    walkChains(key, obj, () => handleDep.clear())\n    delete obj[key]\n  }\n",[5723],{"type":428,"tag":442,"props":5724,"children":5725},{"__ignoreMap":421},[5726,5766,5818,5842],{"type":428,"tag":466,"props":5727,"children":5728},{"class":468,"line":469},[5729,5734,5738,5742,5746,5750,5754,5758,5762],{"type":428,"tag":466,"props":5730,"children":5731},{"style":495},[5732],{"type":434,"value":5733},"  del",{"type":428,"tag":466,"props":5735,"children":5736},{"style":483},[5737],{"type":434,"value":1374},{"type":428,"tag":466,"props":5739,"children":5740},{"style":489},[5741],{"type":434,"value":524},{"type":428,"tag":466,"props":5743,"children":5744},{"style":483},[5745],{"type":434,"value":1405},{"type":428,"tag":466,"props":5747,"children":5748},{"style":719},[5749],{"type":434,"value":722},{"type":428,"tag":466,"props":5751,"children":5752},{"style":826},[5753],{"type":434,"value":1414},{"type":428,"tag":466,"props":5755,"children":5756},{"style":489},[5757],{"type":434,"value":492},{"type":428,"tag":466,"props":5759,"children":5760},{"style":483},[5761],{"type":434,"value":1423},{"type":428,"tag":466,"props":5763,"children":5764},{"style":489},[5765],{"type":434,"value":1428},{"type":428,"tag":466,"props":5767,"children":5768},{"class":468,"line":479},[5769,5773,5777,5781,5785,5789,5793,5797,5801,5805,5809,5813],{"type":428,"tag":466,"props":5770,"children":5771},{"style":495},[5772],{"type":434,"value":3975},{"type":428,"tag":466,"props":5774,"children":5775},{"style":532},[5776],{"type":434,"value":503},{"type":428,"tag":466,"props":5778,"children":5779},{"style":483},[5780],{"type":434,"value":2216},{"type":428,"tag":466,"props":5782,"children":5783},{"style":489},[5784],{"type":434,"value":524},{"type":428,"tag":466,"props":5786,"children":5787},{"style":483},[5788],{"type":434,"value":2234},{"type":428,"tag":466,"props":5790,"children":5791},{"style":489},[5792],{"type":434,"value":524},{"type":428,"tag":466,"props":5794,"children":5795},{"style":489},[5796],{"type":434,"value":816},{"type":428,"tag":466,"props":5798,"children":5799},{"style":611},[5800],{"type":434,"value":614},{"type":428,"tag":466,"props":5802,"children":5803},{"style":483},[5804],{"type":434,"value":5662},{"type":428,"tag":466,"props":5806,"children":5807},{"style":489},[5808],{"type":434,"value":492},{"type":428,"tag":466,"props":5810,"children":5811},{"style":495},[5812],{"type":434,"value":5671},{"type":428,"tag":466,"props":5814,"children":5815},{"style":532},[5816],{"type":434,"value":5817},"())\n",{"type":428,"tag":466,"props":5819,"children":5820},{"class":468,"line":558},[5821,5826,5830,5834,5838],{"type":428,"tag":466,"props":5822,"children":5823},{"style":719},[5824],{"type":434,"value":5825},"    delete",{"type":428,"tag":466,"props":5827,"children":5828},{"style":483},[5829],{"type":434,"value":2234},{"type":428,"tag":466,"props":5831,"children":5832},{"style":532},[5833],{"type":434,"value":3850},{"type":428,"tag":466,"props":5835,"children":5836},{"style":483},[5837],{"type":434,"value":2216},{"type":428,"tag":466,"props":5839,"children":5840},{"style":532},[5841],{"type":434,"value":4236},{"type":428,"tag":466,"props":5843,"children":5844},{"class":468,"line":567},[5845],{"type":428,"tag":466,"props":5846,"children":5847},{"style":489},[5848],{"type":434,"value":856},{"type":428,"tag":429,"props":5850,"children":5852},{"id":5851},"后语",[5853],{"type":434,"value":5851},{"type":428,"tag":436,"props":5855,"children":5856},{},[5857],{"type":434,"value":5858},"在这篇文章中, 我们通过对 defineProperty 进行封装, 实现了一个简单的对象属性侦听器的功能, 以弥补小程序所没有的$watch 能力. 在此基础上, 各位可以再对 VX 进行扩展, 更方便地去书写业务代码.",{"type":428,"tag":436,"props":5860,"children":5861},{},[5862,5864],{"type":434,"value":5863},"完整代码 ",{"type":428,"tag":698,"props":5865,"children":5869},{"href":5866,"rel":5867},"https://github.com/Lionad-Morotar/media-gear/blob/master/src/renderer/utils/suites/vx/index.js",[5868],"nofollow",[5870],{"type":434,"value":5871},"GitHub 直达",{"type":428,"tag":5873,"props":5874,"children":5875},"style",{},[5876],{"type":434,"value":5877},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":421,"searchDepth":479,"depth":479,"links":5879},[5880,5881,5882,5883,5886,5891,5892,5895,5899],{"id":431,"depth":479,"text":431},{"id":753,"depth":479,"text":753},{"id":763,"depth":479,"text":763},{"id":1075,"depth":479,"text":1075,"children":5884},[5885],{"id":1081,"depth":558,"text":1084},{"id":2060,"depth":479,"text":2063,"children":5887},[5888,5889,5890],{"id":2066,"depth":558,"text":2066},{"id":2098,"depth":558,"text":2101},{"id":2848,"depth":558,"text":2848},{"id":3657,"depth":479,"text":3660},{"id":4560,"depth":479,"text":4560,"children":5893},[5894],{"id":4565,"depth":558,"text":4565},{"id":5109,"depth":479,"text":5109,"children":5896},[5897,5898],{"id":5114,"depth":558,"text":5117},{"id":5354,"depth":558,"text":5357},{"id":5851,"depth":479,"text":5851},"markdown","content:_archieved:2019-05:reactive-in-150loc.md","content","_archieved/2019-05/reactive-in-150loc.md","_archieved/2019-05/reactive-in-150loc","md",[5907,5910],{"_path":5908,"title":5909,"description":421},"/_archieved/2018-10/noname","🌆 无题",{"_path":5911,"title":5912,"description":421},"/_archieved/2019-06/messy-in-two-years","💖 聊聊此次离职，毕业，及其它杂乱的事情",1735922155419]