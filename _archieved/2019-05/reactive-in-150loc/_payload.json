[{"data":1,"prerenderedAt":5885},["Reactive",2],{"navigation":3,"/_archieved/2019-05/reactive-in-150loc":389,"/_archieved/2019-05/reactive-in-150loc-surround":5878},[4,32,83,99,126,132,138,372,378,384],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🌃 长夜梦","/flows/long-night-dream",{"title":15,"_path":16},"🌌 万物联结与幸福感","/flows/everything",{"title":18,"_path":19},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":21,"_path":22},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":24,"_path":25},"🌧️ 我的腼腆","/flows/shy",{"title":27,"_path":28},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":30,"_path":31},"📝 心流归档","/flows/fold",{"title":33,"_path":34,"children":35},"技术博客 / Coder","/articles",[36,38,41,44,47,50,53,56,59,62,65,68,71,74,77,80],{"title":37,"_path":34},"🦁 为什么我要写博客",{"title":39,"_path":40},"💻 本地部署 Qwen 翻译网页","/articles/local-translator",{"title":42,"_path":43},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":45,"_path":46},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":48,"_path":49},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":51,"_path":52},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":54,"_path":55},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":57,"_path":58},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":60,"_path":61},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":63,"_path":64},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":66,"_path":67},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":69,"_path":70},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":72,"_path":73},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":75,"_path":76},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":78,"_path":79},"🚝 四十二篇系列","/articles/fourty-two",{"title":81,"_path":82},"📝 技术博客归档","/articles/fold",{"title":84,"_path":85,"children":86},"造物 / Make","/tools",[87,90,93,96],{"title":88,"_path":89},"🌐 AnySort","/tools/anysort",{"title":91,"_path":92},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":94,"_path":95},"👓 Crapto","/tools/crypto-inline",{"title":97,"_path":98},"🖨️ any-to-base64","/tools/any-to-base64",{"title":100,"_path":101,"children":102},"吉他剧场 / Music","/music",[103,105,108,111,114,117,120,123],{"title":104,"_path":101},"🎸 FingerStyle！",{"title":106,"_path":107},"🌬️ 等待的风","/music/wind",{"title":109,"_path":110},"💕 约定的海洋","/music/ocean",{"title":112,"_path":113},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":115,"_path":116},"🌏 残酷天使的行动纲领","/music/eva",{"title":118,"_path":119},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":121,"_path":122},"🍷 Wu Wei","/music/wu-wei",{"title":124,"_path":125},"🌅 无题","/music/untitled",{"title":127,"_path":128,"children":129},"画点什么 / Paint","/paint",[130],{"title":131,"_path":128},"🚧 正在施工",{"title":133,"_path":134,"children":135},"知识地图 / Maps","/maps",[136],{"title":137,"_path":134},"🏁 知识地图",{"title":139,"_path":140,"children":141},"零散的笔记 / Gists","/gists",[142,144,147,150,153,156,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255,258,261,264,267,270,273,276,279,282,285,288,291,294,297,300,303,306,309,312,315,318,321,324,327,330,333,336,339,342,345,348,351,354,357,360,363,366,369],{"title":143,"_path":140},"🧊 Gists",{"title":145,"_path":146},"网站的可访问性","/gists/accessibility",{"title":148,"_path":149},"Bit","/gists/bit",{"title":151,"_path":152},"图片模糊","/gists/blur",{"title":154,"_path":155},"渲染相关笔记","/gists/c4d",{"title":157,"_path":158},"CDN 问题记录","/gists/cdn",{"title":160,"_path":161},"消毒剂","/gists/cleaner",{"title":163,"_path":164},"Windows Command","/gists/cmd",{"title":166,"_path":167},"Command","/gists/command",{"title":169,"_path":170},"复杂科学","/gists/complexity-science",{"title":172,"_path":173},"宇宙","/gists/cosmos",{"title":175,"_path":176},"C++","/gists/cpp",{"title":178,"_path":179},"Data Structure","/gists/data-structure",{"title":181,"_path":182},"DEPRESSION","/gists/depression",{"title":184,"_path":185},"设计模式","/gists/design-patterns",{"title":187,"_path":188},"Developer Experience","/gists/developer-experience",{"title":190,"_path":191},"Device Metrics","/gists/device-metrix",{"title":193,"_path":194},"ECMAScript Language Specification","/gists/ecmascript-specification",{"title":196,"_path":197},"正则表达式","/gists/eegex",{"title":199,"_path":200},"Emoji","/gists/emoji",{"title":202,"_path":203},"工程","/gists/engineering",{"title":205,"_path":206},"熵","/gists/entropy",{"title":208,"_path":209},"Environment","/gists/environment",{"title":211,"_path":212},"Erlang","/gists/erlang",{"title":214,"_path":215},"逃离塔克夫","/gists/escape-from-tarkov",{"title":217,"_path":218},"ESNext (ES6-ES11)","/gists/esnext",{"title":220,"_path":221},"Eval！","/gists/eval",{"title":223,"_path":224},"Flutter","/gists/flutter",{"title":226,"_path":227},"字体","/gists/font",{"title":229,"_path":230},"JS 函数式编程","/gists/functional",{"title":232,"_path":233},"Google C++ Standard","/gists/google-cpp-standard",{"title":235,"_path":236},"双向链接完全体","/gists/graph",{"title":238,"_path":239},"Hardwares","/gists/hardwares",{"title":241,"_path":242},"哈希冲突","/gists/hash-collision",{"title":244,"_path":245},"信息设计","/gists/information-design",{"title":247,"_path":248},"InstantPage","/gists/instant.page",{"title":250,"_path":251},"ISUX 遇见大数据可视化系列","/gists/isux-data-visualization",{"title":253,"_path":254},"KVStore","/gists/key-value-db",{"title":256,"_path":257},"Kubernetes","/gists/kubernetes",{"title":259,"_path":260},"Makefile","/gists/makefile",{"title":262,"_path":263},"Markdown Inline Style","/gists/markdown-nice",{"title":265,"_path":266},"小程序","/gists/miniapp",{"title":268,"_path":269},"减小页面快照体积","/gists/minify-html",{"title":271,"_path":272},"mklink","/gists/mklink",{"title":274,"_path":275},"Mock","/gists/mock",{"title":277,"_path":278},"多端应用","/gists/multy-end-app",{"title":280,"_path":281},"神经科学","/gists/neuroscience",{"title":283,"_path":284},"OO","/gists/oo",{"title":286,"_path":287},"Opinioned Personal Folder","/gists/opinioned-personal-folder",{"title":289,"_path":290},"人物","/gists/person",{"title":292,"_path":293},"PInvoke","/gists/pinvoke",{"title":295,"_path":296},"像素","/gists/pixel",{"title":298,"_path":299},"PowerShell","/gists/powershell",{"title":301,"_path":302},"量子","/gists/quantum",{"title":304,"_path":305},"保持好奇心","/gists/questions",{"title":307,"_path":308},"React Native","/gists/react-native",{"title":310,"_path":311},"博客改版碰到的浏览器平滑滚动问题","/gists/scroll",{"title":313,"_path":314},"SEO","/gists/seo",{"title":316,"_path":317},"Shader","/gists/shader",{"title":319,"_path":320},"Shape Up","/gists/shape-up",{"title":322,"_path":323},"睡觉","/gists/sleep",{"title":325,"_path":326},"States","/gists/states",{"title":328,"_path":329},"Storage","/gists/storage",{"title":331,"_path":332},"音视频流处理","/gists/stream-cli",{"title":334,"_path":335},"Symbol","/gists/symbol",{"title":337,"_path":338},"系统论","/gists/systems-theory",{"title":340,"_path":341},"Taro","/gists/taro",{"title":343,"_path":344},"任务切片","/gists/task-slice",{"title":346,"_path":347},"技术偏好","/gists/tech-dudge",{"title":349,"_path":350},"Untitled","/gists/untitled",{"title":352,"_path":353},"可变字体","/gists/variable-font",{"title":355,"_path":356},"视觉错觉","/gists/visual-illusion",{"title":358,"_path":359},"SS(SSR)","/gists/vpn",{"title":361,"_path":362},"VS Code 插件开发","/gists/vscode-plugin",{"title":364,"_path":365},"Web Components","/gists/web-components",{"title":367,"_path":368},"Windows","/gists/windows",{"title":370,"_path":371},"查缺补漏","/gists/wrong",{"title":373,"_path":374,"children":375},"代码笔记 / Gists","/source-code",[376],{"title":377,"_path":374},"🚄 代码笔记",{"title":379,"_path":380,"children":381},"我 / Abount","/hire",[382],{"title":383,"_path":380},"📬 技术简历",{"title":385,"_path":386,"children":387},"todo","/todo",[388],{"title":385,"_path":386},{"_path":390,"_dir":391,"_draft":392,"_partial":393,"_locale":394,"title":395,"description":396,"body":397,"_type":5873,"_id":5874,"_source":5875,"_file":5876,"_extension":5877},"/_archieved/2019-05/reactive-in-150loc","2019-05",false,true,"","🚀 150 行代码带你实现小程序中的数据侦听","本文介绍了在 150 行代码内使用 defineProperty 实现一个简单的拥有事件发布订阅能力的状态管理库的思路。",{"type":398,"children":399,"toc":5851},"root",[400,408,423,428,707,719,724,729,734,739,752,1033,1046,1051,1058,1070,1324,1329,1712,1717,1722,1727,1884,2026,2031,2037,2042,2047,2056,2061,2069,2075,2080,2336,2341,2346,2819,2824,2853,3628,3634,3647,3983,3996,4009,4531,4536,4541,4546,4551,4564,5080,5085,5091,5096,5101,5325,5331,5336,5556,5680,5692,5822,5827,5832,5845],{"type":401,"tag":402,"props":403,"children":405},"element","h2",{"id":404},"前言",[406],{"type":407,"value":404},"text",{"type":401,"tag":409,"props":410,"children":411},"p",{},[412,414,421],{"type":407,"value":413},"在小程序项目中, 我们的通常会使用到使用到一个全局对象作为各个页面通用的数据存储容器, 将它绑定到 app 对象后, 就能在每一个页面都自由的操纵这个对象. 然而在实践中, 由于这个对象及其属性不具备响应式条件, 它不能直接参与业务逻辑的编写, 能力仅仅局限于数据储存. 若是在 VueJS 项目中, 我们可能经常使用到",{"type":401,"tag":415,"props":416,"children":418},"code",{"className":417},[],[419],{"type":407,"value":420},"Vue.$watch",{"type":407,"value":422},"去侦听某个数据是否发生变化, 小程序却缺乏这种能力.",{"type":401,"tag":409,"props":424,"children":425},{},[426],{"type":407,"value":427},"在这篇文章中, 我将用 150 行代码, 手把手带你打造一个小程序也可以使用的侦听器(下简称 VX):",{"type":401,"tag":429,"props":430,"children":434},"pre",{"className":431,"code":432,"language":433,"meta":394,"style":394},"language-js shiki shiki-themes material-theme-lighter github-light github-dark monokai","// 一个快速赋值的语法糖函数, 可以创建结构为 { value: a { b: { val: ''} } } 的对象\nvx.set('value.a.d', { val: '' })\n// 对某个属性进行侦听, 如果发生改变, 则执行相应函数(可多次watch以执行多个函数)\nvx.watch('value.a.d.val', newVal => {\n  console.log(`val改变为 : `, newVal)\n})\nvalue.a.d.val = 3 // val改编为 : 3\n","js",[435],{"type":401,"tag":415,"props":436,"children":437},{"__ignoreMap":394},[438,450,529,538,593,641,654],{"type":401,"tag":439,"props":440,"children":443},"span",{"class":441,"line":442},"line",1,[444],{"type":401,"tag":439,"props":445,"children":447},{"style":446},"--shiki-light:#90A4AE;--shiki-default:#6A737D;--shiki-dark:#6A737D;--shiki-sepia:#88846F;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:inherit",[448],{"type":407,"value":449},"// 一个快速赋值的语法糖函数, 可以创建结构为 { value: a { b: { val: ''} } } 的对象\n",{"type":401,"tag":439,"props":451,"children":453},{"class":441,"line":452},2,[454,460,466,472,477,483,489,493,498,503,509,514,519,524],{"type":401,"tag":439,"props":455,"children":457},{"style":456},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[458],{"type":407,"value":459},"vx",{"type":401,"tag":439,"props":461,"children":463},{"style":462},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[464],{"type":407,"value":465},".",{"type":401,"tag":439,"props":467,"children":469},{"style":468},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[470],{"type":407,"value":471},"set",{"type":401,"tag":439,"props":473,"children":474},{"style":456},[475],{"type":407,"value":476},"(",{"type":401,"tag":439,"props":478,"children":480},{"style":479},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[481],{"type":407,"value":482},"'",{"type":401,"tag":439,"props":484,"children":486},{"style":485},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[487],{"type":407,"value":488},"value.a.d",{"type":401,"tag":439,"props":490,"children":491},{"style":479},[492],{"type":407,"value":482},{"type":401,"tag":439,"props":494,"children":495},{"style":462},[496],{"type":407,"value":497},",",{"type":401,"tag":439,"props":499,"children":500},{"style":462},[501],{"type":407,"value":502}," {",{"type":401,"tag":439,"props":504,"children":506},{"style":505},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[507],{"type":407,"value":508}," val",{"type":401,"tag":439,"props":510,"children":511},{"style":462},[512],{"type":407,"value":513},":",{"type":401,"tag":439,"props":515,"children":516},{"style":479},[517],{"type":407,"value":518}," ''",{"type":401,"tag":439,"props":520,"children":521},{"style":462},[522],{"type":407,"value":523}," }",{"type":401,"tag":439,"props":525,"children":526},{"style":456},[527],{"type":407,"value":528},")\n",{"type":401,"tag":439,"props":530,"children":532},{"class":441,"line":531},3,[533],{"type":401,"tag":439,"props":534,"children":535},{"style":446},[536],{"type":407,"value":537},"// 对某个属性进行侦听, 如果发生改变, 则执行相应函数(可多次watch以执行多个函数)\n",{"type":401,"tag":439,"props":539,"children":541},{"class":441,"line":540},4,[542,546,550,555,559,563,568,572,576,582,588],{"type":401,"tag":439,"props":543,"children":544},{"style":456},[545],{"type":407,"value":459},{"type":401,"tag":439,"props":547,"children":548},{"style":462},[549],{"type":407,"value":465},{"type":401,"tag":439,"props":551,"children":552},{"style":468},[553],{"type":407,"value":554},"watch",{"type":401,"tag":439,"props":556,"children":557},{"style":456},[558],{"type":407,"value":476},{"type":401,"tag":439,"props":560,"children":561},{"style":479},[562],{"type":407,"value":482},{"type":401,"tag":439,"props":564,"children":565},{"style":485},[566],{"type":407,"value":567},"value.a.d.val",{"type":401,"tag":439,"props":569,"children":570},{"style":479},[571],{"type":407,"value":482},{"type":401,"tag":439,"props":573,"children":574},{"style":462},[575],{"type":407,"value":497},{"type":401,"tag":439,"props":577,"children":579},{"style":578},"--shiki-light:#90A4AE;--shiki-default:#E36209;--shiki-dark:#FFAB70;--shiki-sepia:#FD971F;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[580],{"type":407,"value":581}," newVal",{"type":401,"tag":439,"props":583,"children":585},{"style":584},"--shiki-light:#9C3EDA;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#66D9EF;--shiki-light-font-style:inherit;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[586],{"type":407,"value":587}," =>",{"type":401,"tag":439,"props":589,"children":590},{"style":462},[591],{"type":407,"value":592}," {\n",{"type":401,"tag":439,"props":594,"children":596},{"class":441,"line":595},5,[597,602,606,611,615,620,625,629,633,637],{"type":401,"tag":439,"props":598,"children":599},{"style":456},[600],{"type":407,"value":601},"  console",{"type":401,"tag":439,"props":603,"children":604},{"style":462},[605],{"type":407,"value":465},{"type":401,"tag":439,"props":607,"children":608},{"style":468},[609],{"type":407,"value":610},"log",{"type":401,"tag":439,"props":612,"children":613},{"style":505},[614],{"type":407,"value":476},{"type":401,"tag":439,"props":616,"children":617},{"style":479},[618],{"type":407,"value":619},"`",{"type":401,"tag":439,"props":621,"children":622},{"style":485},[623],{"type":407,"value":624},"val改变为 : ",{"type":401,"tag":439,"props":626,"children":627},{"style":479},[628],{"type":407,"value":619},{"type":401,"tag":439,"props":630,"children":631},{"style":462},[632],{"type":407,"value":497},{"type":401,"tag":439,"props":634,"children":635},{"style":456},[636],{"type":407,"value":581},{"type":401,"tag":439,"props":638,"children":639},{"style":505},[640],{"type":407,"value":528},{"type":401,"tag":439,"props":642,"children":644},{"class":441,"line":643},6,[645,650],{"type":401,"tag":439,"props":646,"children":647},{"style":462},[648],{"type":407,"value":649},"}",{"type":401,"tag":439,"props":651,"children":652},{"style":456},[653],{"type":407,"value":528},{"type":401,"tag":439,"props":655,"children":657},{"class":441,"line":656},7,[658,663,667,672,676,681,685,690,696,702],{"type":401,"tag":439,"props":659,"children":660},{"style":456},[661],{"type":407,"value":662},"value",{"type":401,"tag":439,"props":664,"children":665},{"style":462},[666],{"type":407,"value":465},{"type":401,"tag":439,"props":668,"children":669},{"style":456},[670],{"type":407,"value":671},"a",{"type":401,"tag":439,"props":673,"children":674},{"style":462},[675],{"type":407,"value":465},{"type":401,"tag":439,"props":677,"children":678},{"style":456},[679],{"type":407,"value":680},"d",{"type":401,"tag":439,"props":682,"children":683},{"style":462},[684],{"type":407,"value":465},{"type":401,"tag":439,"props":686,"children":687},{"style":456},[688],{"type":407,"value":689},"val ",{"type":401,"tag":439,"props":691,"children":693},{"style":692},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[694],{"type":407,"value":695},"=",{"type":401,"tag":439,"props":697,"children":699},{"style":698},"--shiki-light:#F76D47;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[700],{"type":407,"value":701}," 3",{"type":401,"tag":439,"props":703,"children":704},{"style":446},[705],{"type":407,"value":706}," // val改编为 : 3\n",{"type":401,"tag":409,"props":708,"children":709},{},[710,712,717],{"type":407,"value":711},"使用 VX 侦听器, 我们可以更加方便的管理各个页面的状态. 同时, 我们凭借",{"type":401,"tag":415,"props":713,"children":715},{"className":714},[],[716],{"type":407,"value":554},{"type":407,"value":718},"语法, 可以更优雅地编写业务逻辑.",{"type":401,"tag":409,"props":720,"children":721},{},[722],{"type":407,"value":723},"坐稳了, 三轮车准备启动了~ 各位评论见~ 😋",{"type":401,"tag":402,"props":725,"children":727},{"id":726},"稍微理一理思路",[728],{"type":407,"value":726},{"type":401,"tag":409,"props":730,"children":731},{},[732],{"type":407,"value":733},"在全局对象中, 我们不一定要对每一个属性都进行侦听, 所以 VX 主要的功能就是通过 set 去设置某个具体属性的 setter/getter, 同时通过 watch 向添加该属性添加需要订阅的回调函数.",{"type":401,"tag":402,"props":735,"children":737},{"id":736},"依赖对象的实现",[738],{"type":407,"value":736},{"type":401,"tag":409,"props":740,"children":741},{},[742,744,750],{"type":407,"value":743},"首先我们需要造一个通用的",{"type":401,"tag":745,"props":746,"children":747},"strong",{},[748],{"type":407,"value":749},"依赖对象",{"type":407,"value":751},", 依赖对象携带一个订阅数组用于存放一组回调函数, 同时它还应该包括一些操作订阅数组能力(如添加订阅, 清空订阅)的函数",{"type":401,"tag":429,"props":753,"children":755},{"className":431,"code":754,"language":433,"meta":394,"style":394},"class Dep {\n  constructor () {\n    this.subs = []\n  }\n  // 将回调添加到数组中\n  addSub (fn) { /*...*/ }\n  delSub (fn) { /*...*/ }\n  // 执行数组中每一项函数\n  notify (newVal, oldVal) {\n    this.subs.forEach(func => func(newVal, oldVal))\n  }\n}\n",[756],{"type":401,"tag":415,"props":757,"children":758},{"__ignoreMap":394},[759,777,794,822,830,838,876,908,917,952,1016,1024],{"type":401,"tag":439,"props":760,"children":761},{"class":441,"line":442},[762,767,773],{"type":401,"tag":439,"props":763,"children":764},{"style":584},[765],{"type":407,"value":766},"class",{"type":401,"tag":439,"props":768,"children":770},{"style":769},"--shiki-light:#E2931D;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E;--shiki-light-text-decoration:inherit;--shiki-default-text-decoration:inherit;--shiki-dark-text-decoration:inherit;--shiki-sepia-text-decoration:underline",[771],{"type":407,"value":772}," Dep",{"type":401,"tag":439,"props":774,"children":775},{"style":462},[776],{"type":407,"value":592},{"type":401,"tag":439,"props":778,"children":779},{"class":441,"line":452},[780,785,790],{"type":401,"tag":439,"props":781,"children":782},{"style":584},[783],{"type":407,"value":784},"  constructor",{"type":401,"tag":439,"props":786,"children":787},{"style":462},[788],{"type":407,"value":789}," ()",{"type":401,"tag":439,"props":791,"children":792},{"style":462},[793],{"type":407,"value":592},{"type":401,"tag":439,"props":795,"children":796},{"class":441,"line":531},[797,803,807,812,817],{"type":401,"tag":439,"props":798,"children":800},{"style":799},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#FD971F",[801],{"type":407,"value":802},"    this",{"type":401,"tag":439,"props":804,"children":805},{"style":462},[806],{"type":407,"value":465},{"type":401,"tag":439,"props":808,"children":809},{"style":456},[810],{"type":407,"value":811},"subs",{"type":401,"tag":439,"props":813,"children":814},{"style":692},[815],{"type":407,"value":816}," =",{"type":401,"tag":439,"props":818,"children":819},{"style":505},[820],{"type":407,"value":821}," []\n",{"type":401,"tag":439,"props":823,"children":824},{"class":441,"line":540},[825],{"type":401,"tag":439,"props":826,"children":827},{"style":462},[828],{"type":407,"value":829},"  }\n",{"type":401,"tag":439,"props":831,"children":832},{"class":441,"line":595},[833],{"type":401,"tag":439,"props":834,"children":835},{"style":446},[836],{"type":407,"value":837},"  // 将回调添加到数组中\n",{"type":401,"tag":439,"props":839,"children":840},{"class":441,"line":643},[841,847,852,857,862,866,871],{"type":401,"tag":439,"props":842,"children":844},{"style":843},"--shiki-light:#E53935;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[845],{"type":407,"value":846},"  addSub",{"type":401,"tag":439,"props":848,"children":849},{"style":462},[850],{"type":407,"value":851}," (",{"type":401,"tag":439,"props":853,"children":854},{"style":578},[855],{"type":407,"value":856},"fn",{"type":401,"tag":439,"props":858,"children":859},{"style":462},[860],{"type":407,"value":861},")",{"type":401,"tag":439,"props":863,"children":864},{"style":462},[865],{"type":407,"value":502},{"type":401,"tag":439,"props":867,"children":868},{"style":446},[869],{"type":407,"value":870}," /*...*/",{"type":401,"tag":439,"props":872,"children":873},{"style":462},[874],{"type":407,"value":875}," }\n",{"type":401,"tag":439,"props":877,"children":878},{"class":441,"line":656},[879,884,888,892,896,900,904],{"type":401,"tag":439,"props":880,"children":881},{"style":843},[882],{"type":407,"value":883},"  delSub",{"type":401,"tag":439,"props":885,"children":886},{"style":462},[887],{"type":407,"value":851},{"type":401,"tag":439,"props":889,"children":890},{"style":578},[891],{"type":407,"value":856},{"type":401,"tag":439,"props":893,"children":894},{"style":462},[895],{"type":407,"value":861},{"type":401,"tag":439,"props":897,"children":898},{"style":462},[899],{"type":407,"value":502},{"type":401,"tag":439,"props":901,"children":902},{"style":446},[903],{"type":407,"value":870},{"type":401,"tag":439,"props":905,"children":906},{"style":462},[907],{"type":407,"value":875},{"type":401,"tag":439,"props":909,"children":911},{"class":441,"line":910},8,[912],{"type":401,"tag":439,"props":913,"children":914},{"style":446},[915],{"type":407,"value":916},"  // 执行数组中每一项函数\n",{"type":401,"tag":439,"props":918,"children":920},{"class":441,"line":919},9,[921,926,930,935,939,944,948],{"type":401,"tag":439,"props":922,"children":923},{"style":843},[924],{"type":407,"value":925},"  notify",{"type":401,"tag":439,"props":927,"children":928},{"style":462},[929],{"type":407,"value":851},{"type":401,"tag":439,"props":931,"children":932},{"style":578},[933],{"type":407,"value":934},"newVal",{"type":401,"tag":439,"props":936,"children":937},{"style":462},[938],{"type":407,"value":497},{"type":401,"tag":439,"props":940,"children":941},{"style":578},[942],{"type":407,"value":943}," oldVal",{"type":401,"tag":439,"props":945,"children":946},{"style":462},[947],{"type":407,"value":861},{"type":401,"tag":439,"props":949,"children":950},{"style":462},[951],{"type":407,"value":592},{"type":401,"tag":439,"props":953,"children":955},{"class":441,"line":954},10,[956,960,964,968,972,977,981,986,990,995,999,1003,1007,1011],{"type":401,"tag":439,"props":957,"children":958},{"style":799},[959],{"type":407,"value":802},{"type":401,"tag":439,"props":961,"children":962},{"style":462},[963],{"type":407,"value":465},{"type":401,"tag":439,"props":965,"children":966},{"style":456},[967],{"type":407,"value":811},{"type":401,"tag":439,"props":969,"children":970},{"style":462},[971],{"type":407,"value":465},{"type":401,"tag":439,"props":973,"children":974},{"style":468},[975],{"type":407,"value":976},"forEach",{"type":401,"tag":439,"props":978,"children":979},{"style":505},[980],{"type":407,"value":476},{"type":401,"tag":439,"props":982,"children":983},{"style":578},[984],{"type":407,"value":985},"func",{"type":401,"tag":439,"props":987,"children":988},{"style":584},[989],{"type":407,"value":587},{"type":401,"tag":439,"props":991,"children":992},{"style":468},[993],{"type":407,"value":994}," func",{"type":401,"tag":439,"props":996,"children":997},{"style":505},[998],{"type":407,"value":476},{"type":401,"tag":439,"props":1000,"children":1001},{"style":456},[1002],{"type":407,"value":934},{"type":401,"tag":439,"props":1004,"children":1005},{"style":462},[1006],{"type":407,"value":497},{"type":401,"tag":439,"props":1008,"children":1009},{"style":456},[1010],{"type":407,"value":943},{"type":401,"tag":439,"props":1012,"children":1013},{"style":505},[1014],{"type":407,"value":1015},"))\n",{"type":401,"tag":439,"props":1017,"children":1019},{"class":441,"line":1018},11,[1020],{"type":401,"tag":439,"props":1021,"children":1022},{"style":462},[1023],{"type":407,"value":829},{"type":401,"tag":439,"props":1025,"children":1027},{"class":441,"line":1026},12,[1028],{"type":401,"tag":439,"props":1029,"children":1030},{"style":462},[1031],{"type":407,"value":1032},"}\n",{"type":401,"tag":409,"props":1034,"children":1035},{},[1036,1038,1044],{"type":407,"value":1037},"全局对象中每一个响应式属性(及其每一个子属性), 都应该和一个新的 Dep 实例保持一一对应的关系, 这样我们进行侦听变化, 执行订阅的回调函数时, 只需要找到对应的实例执行",{"type":401,"tag":415,"props":1039,"children":1041},{"className":1040},[],[1042],{"type":407,"value":1043},"notify",{"type":407,"value":1045},"通知更新即可.",{"type":401,"tag":402,"props":1047,"children":1049},{"id":1048},"设置响应式属性",[1050],{"type":407,"value":1048},{"type":401,"tag":1052,"props":1053,"children":1055},"h3",{"id":1054},"defineproperty",[1056],{"type":407,"value":1057},"defineProperty",{"type":401,"tag":409,"props":1059,"children":1060},{},[1061,1063,1068],{"type":407,"value":1062},"可能是因为接触 DefineProperty 要比接触 Proxy 早一些的缘故, 代码使用了前者进行响应式的实现, Object.defineProperty 方法会直接在一个对象上定义一个新属性, 这里快速过一遍",{"type":401,"tag":415,"props":1064,"children":1066},{"className":1065},[],[1067],{"type":407,"value":1057},{"type":407,"value":1069},"具体配置:",{"type":401,"tag":429,"props":1071,"children":1073},{"className":431,"code":1072,"language":433,"meta":394,"style":394},"// @param obj 要在其上定义属性的对象\n// @param key 要定义或修改的属性的名称\nObject.defineProperty(obj, key, {\n  // 该属性是否能被枚举\n  enumerable: true,\n  // 该属性能否被删除\n  configurable: true,\n  // 访问该属性则会执行此方法\n  get: () => {\n    return val\n  },\n  // 修改该属性时会执行此方法\n  set: newVal => {\n    val = newVal\n  },\n  // value & writeble 不能和 getter/setter 同时出现\n})\n",[1074],{"type":401,"tag":415,"props":1075,"children":1076},{"__ignoreMap":394},[1077,1085,1093,1131,1139,1162,1170,1190,1198,1222,1236,1244,1252,1277,1295,1303,1312],{"type":401,"tag":439,"props":1078,"children":1079},{"class":441,"line":442},[1080],{"type":401,"tag":439,"props":1081,"children":1082},{"style":446},[1083],{"type":407,"value":1084},"// @param obj 要在其上定义属性的对象\n",{"type":401,"tag":439,"props":1086,"children":1087},{"class":441,"line":452},[1088],{"type":401,"tag":439,"props":1089,"children":1090},{"style":446},[1091],{"type":407,"value":1092},"// @param key 要定义或修改的属性的名称\n",{"type":401,"tag":439,"props":1094,"children":1095},{"class":441,"line":531},[1096,1101,1105,1109,1114,1118,1123,1127],{"type":401,"tag":439,"props":1097,"children":1098},{"style":456},[1099],{"type":407,"value":1100},"Object",{"type":401,"tag":439,"props":1102,"children":1103},{"style":462},[1104],{"type":407,"value":465},{"type":401,"tag":439,"props":1106,"children":1107},{"style":468},[1108],{"type":407,"value":1057},{"type":401,"tag":439,"props":1110,"children":1111},{"style":456},[1112],{"type":407,"value":1113},"(obj",{"type":401,"tag":439,"props":1115,"children":1116},{"style":462},[1117],{"type":407,"value":497},{"type":401,"tag":439,"props":1119,"children":1120},{"style":456},[1121],{"type":407,"value":1122}," key",{"type":401,"tag":439,"props":1124,"children":1125},{"style":462},[1126],{"type":407,"value":497},{"type":401,"tag":439,"props":1128,"children":1129},{"style":462},[1130],{"type":407,"value":592},{"type":401,"tag":439,"props":1132,"children":1133},{"class":441,"line":540},[1134],{"type":401,"tag":439,"props":1135,"children":1136},{"style":446},[1137],{"type":407,"value":1138},"  // 该属性是否能被枚举\n",{"type":401,"tag":439,"props":1140,"children":1141},{"class":441,"line":595},[1142,1147,1151,1157],{"type":401,"tag":439,"props":1143,"children":1144},{"style":505},[1145],{"type":407,"value":1146},"  enumerable",{"type":401,"tag":439,"props":1148,"children":1149},{"style":462},[1150],{"type":407,"value":513},{"type":401,"tag":439,"props":1152,"children":1154},{"style":1153},"--shiki-light:#FF5370;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[1155],{"type":407,"value":1156}," true",{"type":401,"tag":439,"props":1158,"children":1159},{"style":462},[1160],{"type":407,"value":1161},",\n",{"type":401,"tag":439,"props":1163,"children":1164},{"class":441,"line":643},[1165],{"type":401,"tag":439,"props":1166,"children":1167},{"style":446},[1168],{"type":407,"value":1169},"  // 该属性能否被删除\n",{"type":401,"tag":439,"props":1171,"children":1172},{"class":441,"line":656},[1173,1178,1182,1186],{"type":401,"tag":439,"props":1174,"children":1175},{"style":505},[1176],{"type":407,"value":1177},"  configurable",{"type":401,"tag":439,"props":1179,"children":1180},{"style":462},[1181],{"type":407,"value":513},{"type":401,"tag":439,"props":1183,"children":1184},{"style":1153},[1185],{"type":407,"value":1156},{"type":401,"tag":439,"props":1187,"children":1188},{"style":462},[1189],{"type":407,"value":1161},{"type":401,"tag":439,"props":1191,"children":1192},{"class":441,"line":910},[1193],{"type":401,"tag":439,"props":1194,"children":1195},{"style":446},[1196],{"type":407,"value":1197},"  // 访问该属性则会执行此方法\n",{"type":401,"tag":439,"props":1199,"children":1200},{"class":441,"line":919},[1201,1206,1210,1214,1218],{"type":401,"tag":439,"props":1202,"children":1203},{"style":468},[1204],{"type":407,"value":1205},"  get",{"type":401,"tag":439,"props":1207,"children":1208},{"style":462},[1209],{"type":407,"value":513},{"type":401,"tag":439,"props":1211,"children":1212},{"style":462},[1213],{"type":407,"value":789},{"type":401,"tag":439,"props":1215,"children":1216},{"style":584},[1217],{"type":407,"value":587},{"type":401,"tag":439,"props":1219,"children":1220},{"style":462},[1221],{"type":407,"value":592},{"type":401,"tag":439,"props":1223,"children":1224},{"class":441,"line":954},[1225,1231],{"type":401,"tag":439,"props":1226,"children":1228},{"style":1227},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:inherit",[1229],{"type":407,"value":1230},"    return",{"type":401,"tag":439,"props":1232,"children":1233},{"style":456},[1234],{"type":407,"value":1235}," val\n",{"type":401,"tag":439,"props":1237,"children":1238},{"class":441,"line":1018},[1239],{"type":401,"tag":439,"props":1240,"children":1241},{"style":462},[1242],{"type":407,"value":1243},"  },\n",{"type":401,"tag":439,"props":1245,"children":1246},{"class":441,"line":1026},[1247],{"type":401,"tag":439,"props":1248,"children":1249},{"style":446},[1250],{"type":407,"value":1251},"  // 修改该属性时会执行此方法\n",{"type":401,"tag":439,"props":1253,"children":1255},{"class":441,"line":1254},13,[1256,1261,1265,1269,1273],{"type":401,"tag":439,"props":1257,"children":1258},{"style":468},[1259],{"type":407,"value":1260},"  set",{"type":401,"tag":439,"props":1262,"children":1263},{"style":462},[1264],{"type":407,"value":513},{"type":401,"tag":439,"props":1266,"children":1267},{"style":578},[1268],{"type":407,"value":581},{"type":401,"tag":439,"props":1270,"children":1271},{"style":584},[1272],{"type":407,"value":587},{"type":401,"tag":439,"props":1274,"children":1275},{"style":462},[1276],{"type":407,"value":592},{"type":401,"tag":439,"props":1278,"children":1280},{"class":441,"line":1279},14,[1281,1286,1290],{"type":401,"tag":439,"props":1282,"children":1283},{"style":456},[1284],{"type":407,"value":1285},"    val",{"type":401,"tag":439,"props":1287,"children":1288},{"style":692},[1289],{"type":407,"value":816},{"type":401,"tag":439,"props":1291,"children":1292},{"style":456},[1293],{"type":407,"value":1294}," newVal\n",{"type":401,"tag":439,"props":1296,"children":1298},{"class":441,"line":1297},15,[1299],{"type":401,"tag":439,"props":1300,"children":1301},{"style":462},[1302],{"type":407,"value":1243},{"type":401,"tag":439,"props":1304,"children":1306},{"class":441,"line":1305},16,[1307],{"type":401,"tag":439,"props":1308,"children":1309},{"style":446},[1310],{"type":407,"value":1311},"  // value & writeble 不能和 getter/setter 同时出现\n",{"type":401,"tag":439,"props":1313,"children":1315},{"class":441,"line":1314},17,[1316,1320],{"type":401,"tag":439,"props":1317,"children":1318},{"style":462},[1319],{"type":407,"value":649},{"type":401,"tag":439,"props":1321,"children":1322},{"style":456},[1323],{"type":407,"value":528},{"type":401,"tag":409,"props":1325,"children":1326},{},[1327],{"type":407,"value":1328},"通过对 defineProperty 进行上层封装, 我们可以轻松的实现在全局对象上设置响应式属性功能, 在此, 我们结合刚才定义的 Dep 对象, 将一个新的 dep 实例绑定到新增属性的 setter 中:",{"type":401,"tag":429,"props":1330,"children":1332},{"className":431,"code":1331,"language":433,"meta":394,"style":394},"set (key, val, options = {}, obj = this.store) {\n  const dep = new Dep()\n  Object.defineProperty(obj, key, {\n    enumerable: true,\n    configurable: true,\n    get: () => {\n      return val\n    },\n    set: newVal => {\n      if (newVal === val) {\n        return\n      }\n      dep.notify(newVal, val)\n      val = newVal\n    }\n  })\n}\n",[1333],{"type":401,"tag":415,"props":1334,"children":1335},{"__ignoreMap":394},[1336,1402,1434,1475,1495,1515,1539,1551,1559,1583,1617,1625,1633,1669,1685,1693,1705],{"type":401,"tag":439,"props":1337,"children":1338},{"class":441,"line":442},[1339,1343,1348,1352,1356,1360,1365,1369,1374,1379,1383,1388,1392,1397],{"type":401,"tag":439,"props":1340,"children":1341},{"style":468},[1342],{"type":407,"value":471},{"type":401,"tag":439,"props":1344,"children":1345},{"style":456},[1346],{"type":407,"value":1347}," (key",{"type":401,"tag":439,"props":1349,"children":1350},{"style":462},[1351],{"type":407,"value":497},{"type":401,"tag":439,"props":1353,"children":1354},{"style":456},[1355],{"type":407,"value":508},{"type":401,"tag":439,"props":1357,"children":1358},{"style":462},[1359],{"type":407,"value":497},{"type":401,"tag":439,"props":1361,"children":1362},{"style":456},[1363],{"type":407,"value":1364}," options ",{"type":401,"tag":439,"props":1366,"children":1367},{"style":692},[1368],{"type":407,"value":695},{"type":401,"tag":439,"props":1370,"children":1371},{"style":462},[1372],{"type":407,"value":1373}," {},",{"type":401,"tag":439,"props":1375,"children":1376},{"style":456},[1377],{"type":407,"value":1378}," obj ",{"type":401,"tag":439,"props":1380,"children":1381},{"style":692},[1382],{"type":407,"value":695},{"type":401,"tag":439,"props":1384,"children":1385},{"style":799},[1386],{"type":407,"value":1387}," this",{"type":401,"tag":439,"props":1389,"children":1390},{"style":462},[1391],{"type":407,"value":465},{"type":401,"tag":439,"props":1393,"children":1394},{"style":456},[1395],{"type":407,"value":1396},"store) ",{"type":401,"tag":439,"props":1398,"children":1399},{"style":462},[1400],{"type":407,"value":1401},"{\n",{"type":401,"tag":439,"props":1403,"children":1404},{"class":441,"line":452},[1405,1410,1416,1420,1425,1429],{"type":401,"tag":439,"props":1406,"children":1407},{"style":584},[1408],{"type":407,"value":1409},"  const",{"type":401,"tag":439,"props":1411,"children":1413},{"style":1412},"--shiki-light:#90A4AE;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#F8F8F2",[1414],{"type":407,"value":1415}," dep",{"type":401,"tag":439,"props":1417,"children":1418},{"style":692},[1419],{"type":407,"value":816},{"type":401,"tag":439,"props":1421,"children":1422},{"style":692},[1423],{"type":407,"value":1424}," new",{"type":401,"tag":439,"props":1426,"children":1427},{"style":468},[1428],{"type":407,"value":772},{"type":401,"tag":439,"props":1430,"children":1431},{"style":505},[1432],{"type":407,"value":1433},"()\n",{"type":401,"tag":439,"props":1435,"children":1436},{"class":441,"line":531},[1437,1442,1446,1450,1454,1459,1463,1467,1471],{"type":401,"tag":439,"props":1438,"children":1439},{"style":456},[1440],{"type":407,"value":1441},"  Object",{"type":401,"tag":439,"props":1443,"children":1444},{"style":462},[1445],{"type":407,"value":465},{"type":401,"tag":439,"props":1447,"children":1448},{"style":468},[1449],{"type":407,"value":1057},{"type":401,"tag":439,"props":1451,"children":1452},{"style":505},[1453],{"type":407,"value":476},{"type":401,"tag":439,"props":1455,"children":1456},{"style":456},[1457],{"type":407,"value":1458},"obj",{"type":401,"tag":439,"props":1460,"children":1461},{"style":462},[1462],{"type":407,"value":497},{"type":401,"tag":439,"props":1464,"children":1465},{"style":456},[1466],{"type":407,"value":1122},{"type":401,"tag":439,"props":1468,"children":1469},{"style":462},[1470],{"type":407,"value":497},{"type":401,"tag":439,"props":1472,"children":1473},{"style":462},[1474],{"type":407,"value":592},{"type":401,"tag":439,"props":1476,"children":1477},{"class":441,"line":540},[1478,1483,1487,1491],{"type":401,"tag":439,"props":1479,"children":1480},{"style":505},[1481],{"type":407,"value":1482},"    enumerable",{"type":401,"tag":439,"props":1484,"children":1485},{"style":462},[1486],{"type":407,"value":513},{"type":401,"tag":439,"props":1488,"children":1489},{"style":1153},[1490],{"type":407,"value":1156},{"type":401,"tag":439,"props":1492,"children":1493},{"style":462},[1494],{"type":407,"value":1161},{"type":401,"tag":439,"props":1496,"children":1497},{"class":441,"line":595},[1498,1503,1507,1511],{"type":401,"tag":439,"props":1499,"children":1500},{"style":505},[1501],{"type":407,"value":1502},"    configurable",{"type":401,"tag":439,"props":1504,"children":1505},{"style":462},[1506],{"type":407,"value":513},{"type":401,"tag":439,"props":1508,"children":1509},{"style":1153},[1510],{"type":407,"value":1156},{"type":401,"tag":439,"props":1512,"children":1513},{"style":462},[1514],{"type":407,"value":1161},{"type":401,"tag":439,"props":1516,"children":1517},{"class":441,"line":643},[1518,1523,1527,1531,1535],{"type":401,"tag":439,"props":1519,"children":1520},{"style":468},[1521],{"type":407,"value":1522},"    get",{"type":401,"tag":439,"props":1524,"children":1525},{"style":462},[1526],{"type":407,"value":513},{"type":401,"tag":439,"props":1528,"children":1529},{"style":462},[1530],{"type":407,"value":789},{"type":401,"tag":439,"props":1532,"children":1533},{"style":584},[1534],{"type":407,"value":587},{"type":401,"tag":439,"props":1536,"children":1537},{"style":462},[1538],{"type":407,"value":592},{"type":401,"tag":439,"props":1540,"children":1541},{"class":441,"line":656},[1542,1547],{"type":401,"tag":439,"props":1543,"children":1544},{"style":1227},[1545],{"type":407,"value":1546},"      return",{"type":401,"tag":439,"props":1548,"children":1549},{"style":456},[1550],{"type":407,"value":1235},{"type":401,"tag":439,"props":1552,"children":1553},{"class":441,"line":910},[1554],{"type":401,"tag":439,"props":1555,"children":1556},{"style":462},[1557],{"type":407,"value":1558},"    },\n",{"type":401,"tag":439,"props":1560,"children":1561},{"class":441,"line":919},[1562,1567,1571,1575,1579],{"type":401,"tag":439,"props":1563,"children":1564},{"style":468},[1565],{"type":407,"value":1566},"    set",{"type":401,"tag":439,"props":1568,"children":1569},{"style":462},[1570],{"type":407,"value":513},{"type":401,"tag":439,"props":1572,"children":1573},{"style":578},[1574],{"type":407,"value":581},{"type":401,"tag":439,"props":1576,"children":1577},{"style":584},[1578],{"type":407,"value":587},{"type":401,"tag":439,"props":1580,"children":1581},{"style":462},[1582],{"type":407,"value":592},{"type":401,"tag":439,"props":1584,"children":1585},{"class":441,"line":954},[1586,1591,1595,1599,1604,1608,1613],{"type":401,"tag":439,"props":1587,"children":1588},{"style":1227},[1589],{"type":407,"value":1590},"      if",{"type":401,"tag":439,"props":1592,"children":1593},{"style":505},[1594],{"type":407,"value":851},{"type":401,"tag":439,"props":1596,"children":1597},{"style":456},[1598],{"type":407,"value":934},{"type":401,"tag":439,"props":1600,"children":1601},{"style":692},[1602],{"type":407,"value":1603}," ===",{"type":401,"tag":439,"props":1605,"children":1606},{"style":456},[1607],{"type":407,"value":508},{"type":401,"tag":439,"props":1609,"children":1610},{"style":505},[1611],{"type":407,"value":1612},") ",{"type":401,"tag":439,"props":1614,"children":1615},{"style":462},[1616],{"type":407,"value":1401},{"type":401,"tag":439,"props":1618,"children":1619},{"class":441,"line":1018},[1620],{"type":401,"tag":439,"props":1621,"children":1622},{"style":1227},[1623],{"type":407,"value":1624},"        return\n",{"type":401,"tag":439,"props":1626,"children":1627},{"class":441,"line":1026},[1628],{"type":401,"tag":439,"props":1629,"children":1630},{"style":462},[1631],{"type":407,"value":1632},"      }\n",{"type":401,"tag":439,"props":1634,"children":1635},{"class":441,"line":1254},[1636,1641,1645,1649,1653,1657,1661,1665],{"type":401,"tag":439,"props":1637,"children":1638},{"style":456},[1639],{"type":407,"value":1640},"      dep",{"type":401,"tag":439,"props":1642,"children":1643},{"style":462},[1644],{"type":407,"value":465},{"type":401,"tag":439,"props":1646,"children":1647},{"style":468},[1648],{"type":407,"value":1043},{"type":401,"tag":439,"props":1650,"children":1651},{"style":505},[1652],{"type":407,"value":476},{"type":401,"tag":439,"props":1654,"children":1655},{"style":456},[1656],{"type":407,"value":934},{"type":401,"tag":439,"props":1658,"children":1659},{"style":462},[1660],{"type":407,"value":497},{"type":401,"tag":439,"props":1662,"children":1663},{"style":456},[1664],{"type":407,"value":508},{"type":401,"tag":439,"props":1666,"children":1667},{"style":505},[1668],{"type":407,"value":528},{"type":401,"tag":439,"props":1670,"children":1671},{"class":441,"line":1279},[1672,1677,1681],{"type":401,"tag":439,"props":1673,"children":1674},{"style":456},[1675],{"type":407,"value":1676},"      val",{"type":401,"tag":439,"props":1678,"children":1679},{"style":692},[1680],{"type":407,"value":816},{"type":401,"tag":439,"props":1682,"children":1683},{"style":456},[1684],{"type":407,"value":1294},{"type":401,"tag":439,"props":1686,"children":1687},{"class":441,"line":1297},[1688],{"type":401,"tag":439,"props":1689,"children":1690},{"style":462},[1691],{"type":407,"value":1692},"    }\n",{"type":401,"tag":439,"props":1694,"children":1695},{"class":441,"line":1305},[1696,1701],{"type":401,"tag":439,"props":1697,"children":1698},{"style":462},[1699],{"type":407,"value":1700},"  }",{"type":401,"tag":439,"props":1702,"children":1703},{"style":505},[1704],{"type":407,"value":528},{"type":401,"tag":439,"props":1706,"children":1707},{"class":441,"line":1314},[1708],{"type":401,"tag":439,"props":1709,"children":1710},{"style":462},[1711],{"type":407,"value":1032},{"type":401,"tag":409,"props":1713,"children":1714},{},[1715],{"type":407,"value":1716},"每当对应属性被赋值, 就会执行依赖数组中的回调函数.",{"type":401,"tag":409,"props":1718,"children":1719},{},[1720],{"type":407,"value":1721},"不过这样还不够, 我们还得想办法获取到这个 dep 实例, 才能给它的依赖数组填充函数.",{"type":401,"tag":409,"props":1723,"children":1724},{},[1725],{"type":407,"value":1726},"这边提供一个很简单的思路, 并不推荐实践中这么做:",{"type":401,"tag":429,"props":1728,"children":1730},{"className":431,"code":1729,"language":433,"meta":394,"style":394},"set (key, val, options = {}, obj = this.store) {\n  const dep = new Dep()\n  Object.defineProperty(obj, key, {})\n  return dep\n}\n",[1731],{"type":401,"tag":415,"props":1732,"children":1733},{"__ignoreMap":394},[1734,1793,1820,1864,1877],{"type":401,"tag":439,"props":1735,"children":1736},{"class":441,"line":442},[1737,1741,1745,1749,1753,1757,1761,1765,1769,1773,1777,1781,1785,1789],{"type":401,"tag":439,"props":1738,"children":1739},{"style":468},[1740],{"type":407,"value":471},{"type":401,"tag":439,"props":1742,"children":1743},{"style":456},[1744],{"type":407,"value":1347},{"type":401,"tag":439,"props":1746,"children":1747},{"style":462},[1748],{"type":407,"value":497},{"type":401,"tag":439,"props":1750,"children":1751},{"style":456},[1752],{"type":407,"value":508},{"type":401,"tag":439,"props":1754,"children":1755},{"style":462},[1756],{"type":407,"value":497},{"type":401,"tag":439,"props":1758,"children":1759},{"style":456},[1760],{"type":407,"value":1364},{"type":401,"tag":439,"props":1762,"children":1763},{"style":692},[1764],{"type":407,"value":695},{"type":401,"tag":439,"props":1766,"children":1767},{"style":462},[1768],{"type":407,"value":1373},{"type":401,"tag":439,"props":1770,"children":1771},{"style":456},[1772],{"type":407,"value":1378},{"type":401,"tag":439,"props":1774,"children":1775},{"style":692},[1776],{"type":407,"value":695},{"type":401,"tag":439,"props":1778,"children":1779},{"style":799},[1780],{"type":407,"value":1387},{"type":401,"tag":439,"props":1782,"children":1783},{"style":462},[1784],{"type":407,"value":465},{"type":401,"tag":439,"props":1786,"children":1787},{"style":456},[1788],{"type":407,"value":1396},{"type":401,"tag":439,"props":1790,"children":1791},{"style":462},[1792],{"type":407,"value":1401},{"type":401,"tag":439,"props":1794,"children":1795},{"class":441,"line":452},[1796,1800,1804,1808,1812,1816],{"type":401,"tag":439,"props":1797,"children":1798},{"style":584},[1799],{"type":407,"value":1409},{"type":401,"tag":439,"props":1801,"children":1802},{"style":1412},[1803],{"type":407,"value":1415},{"type":401,"tag":439,"props":1805,"children":1806},{"style":692},[1807],{"type":407,"value":816},{"type":401,"tag":439,"props":1809,"children":1810},{"style":692},[1811],{"type":407,"value":1424},{"type":401,"tag":439,"props":1813,"children":1814},{"style":468},[1815],{"type":407,"value":772},{"type":401,"tag":439,"props":1817,"children":1818},{"style":505},[1819],{"type":407,"value":1433},{"type":401,"tag":439,"props":1821,"children":1822},{"class":441,"line":531},[1823,1827,1831,1835,1839,1843,1847,1851,1855,1860],{"type":401,"tag":439,"props":1824,"children":1825},{"style":456},[1826],{"type":407,"value":1441},{"type":401,"tag":439,"props":1828,"children":1829},{"style":462},[1830],{"type":407,"value":465},{"type":401,"tag":439,"props":1832,"children":1833},{"style":468},[1834],{"type":407,"value":1057},{"type":401,"tag":439,"props":1836,"children":1837},{"style":505},[1838],{"type":407,"value":476},{"type":401,"tag":439,"props":1840,"children":1841},{"style":456},[1842],{"type":407,"value":1458},{"type":401,"tag":439,"props":1844,"children":1845},{"style":462},[1846],{"type":407,"value":497},{"type":401,"tag":439,"props":1848,"children":1849},{"style":456},[1850],{"type":407,"value":1122},{"type":401,"tag":439,"props":1852,"children":1853},{"style":462},[1854],{"type":407,"value":497},{"type":401,"tag":439,"props":1856,"children":1857},{"style":462},[1858],{"type":407,"value":1859}," {}",{"type":401,"tag":439,"props":1861,"children":1862},{"style":505},[1863],{"type":407,"value":528},{"type":401,"tag":439,"props":1865,"children":1866},{"class":441,"line":540},[1867,1872],{"type":401,"tag":439,"props":1868,"children":1869},{"style":1227},[1870],{"type":407,"value":1871},"  return",{"type":401,"tag":439,"props":1873,"children":1874},{"style":456},[1875],{"type":407,"value":1876}," dep\n",{"type":401,"tag":439,"props":1878,"children":1879},{"class":441,"line":595},[1880],{"type":401,"tag":439,"props":1881,"children":1882},{"style":462},[1883],{"type":407,"value":1032},{"type":401,"tag":429,"props":1885,"children":1887},{"className":431,"code":1886,"language":433,"meta":394,"style":394},"const valueDep = set('value', b, {})\nvalueDep.addSub(() => { console.log('value changed!') })\n",[1888],{"type":401,"tag":415,"props":1889,"children":1890},{"__ignoreMap":394},[1891,1950],{"type":401,"tag":439,"props":1892,"children":1893},{"class":441,"line":442},[1894,1899,1904,1908,1913,1917,1921,1925,1929,1933,1938,1942,1946],{"type":401,"tag":439,"props":1895,"children":1896},{"style":584},[1897],{"type":407,"value":1898},"const",{"type":401,"tag":439,"props":1900,"children":1901},{"style":1412},[1902],{"type":407,"value":1903}," valueDep",{"type":401,"tag":439,"props":1905,"children":1906},{"style":692},[1907],{"type":407,"value":816},{"type":401,"tag":439,"props":1909,"children":1910},{"style":468},[1911],{"type":407,"value":1912}," set",{"type":401,"tag":439,"props":1914,"children":1915},{"style":456},[1916],{"type":407,"value":476},{"type":401,"tag":439,"props":1918,"children":1919},{"style":479},[1920],{"type":407,"value":482},{"type":401,"tag":439,"props":1922,"children":1923},{"style":485},[1924],{"type":407,"value":662},{"type":401,"tag":439,"props":1926,"children":1927},{"style":479},[1928],{"type":407,"value":482},{"type":401,"tag":439,"props":1930,"children":1931},{"style":462},[1932],{"type":407,"value":497},{"type":401,"tag":439,"props":1934,"children":1935},{"style":456},[1936],{"type":407,"value":1937}," b",{"type":401,"tag":439,"props":1939,"children":1940},{"style":462},[1941],{"type":407,"value":497},{"type":401,"tag":439,"props":1943,"children":1944},{"style":462},[1945],{"type":407,"value":1859},{"type":401,"tag":439,"props":1947,"children":1948},{"style":456},[1949],{"type":407,"value":528},{"type":401,"tag":439,"props":1951,"children":1952},{"class":441,"line":452},[1953,1958,1962,1967,1971,1976,1980,1984,1989,1993,1997,2001,2005,2010,2014,2018,2022],{"type":401,"tag":439,"props":1954,"children":1955},{"style":456},[1956],{"type":407,"value":1957},"valueDep",{"type":401,"tag":439,"props":1959,"children":1960},{"style":462},[1961],{"type":407,"value":465},{"type":401,"tag":439,"props":1963,"children":1964},{"style":468},[1965],{"type":407,"value":1966},"addSub",{"type":401,"tag":439,"props":1968,"children":1969},{"style":456},[1970],{"type":407,"value":476},{"type":401,"tag":439,"props":1972,"children":1973},{"style":462},[1974],{"type":407,"value":1975},"()",{"type":401,"tag":439,"props":1977,"children":1978},{"style":584},[1979],{"type":407,"value":587},{"type":401,"tag":439,"props":1981,"children":1982},{"style":462},[1983],{"type":407,"value":502},{"type":401,"tag":439,"props":1985,"children":1986},{"style":456},[1987],{"type":407,"value":1988}," console",{"type":401,"tag":439,"props":1990,"children":1991},{"style":462},[1992],{"type":407,"value":465},{"type":401,"tag":439,"props":1994,"children":1995},{"style":468},[1996],{"type":407,"value":610},{"type":401,"tag":439,"props":1998,"children":1999},{"style":505},[2000],{"type":407,"value":476},{"type":401,"tag":439,"props":2002,"children":2003},{"style":479},[2004],{"type":407,"value":482},{"type":401,"tag":439,"props":2006,"children":2007},{"style":485},[2008],{"type":407,"value":2009},"value changed!",{"type":401,"tag":439,"props":2011,"children":2012},{"style":479},[2013],{"type":407,"value":482},{"type":401,"tag":439,"props":2015,"children":2016},{"style":505},[2017],{"type":407,"value":1612},{"type":401,"tag":439,"props":2019,"children":2020},{"style":462},[2021],{"type":407,"value":649},{"type":401,"tag":439,"props":2023,"children":2024},{"style":456},[2025],{"type":407,"value":528},{"type":401,"tag":409,"props":2027,"children":2028},{},[2029],{"type":407,"value":2030},"虽然代码能使用了, 就是是看起来怪怪的~ 😋 我们的三轮车开进了岔路~",{"type":401,"tag":402,"props":2032,"children":2034},{"id":2033},"通过-watch-添加订阅",[2035],{"type":407,"value":2036},"通过 watch 添加订阅",{"type":401,"tag":1052,"props":2038,"children":2040},{"id":2039},"喝口水我们继续",[2041],{"type":407,"value":2039},{"type":401,"tag":409,"props":2043,"children":2044},{},[2045],{"type":407,"value":2046},"《黑客与画家》中曾经提到这样一个观点, 我深有体会:",{"type":401,"tag":2048,"props":2049,"children":2050},"blockquote",{},[2051],{"type":401,"tag":409,"props":2052,"children":2053},{},[2054],{"type":407,"value":2055},"如果你觉得你的代码奇怪, 那么往往它是错的",{"type":401,"tag":409,"props":2057,"children":2058},{},[2059],{"type":407,"value":2060},"上面的那一串代码仅仅是能跑通的水平, 我们需要加入更多的细节和思考, 有时候只需要坐下来稍微看一下代码, 就会有各种想法蹦出来:",{"type":401,"tag":2048,"props":2062,"children":2063},{},[2064],{"type":401,"tag":409,"props":2065,"children":2066},{},[2067],{"type":407,"value":2068},"构思这种东西有一个特点，那就是它会导致更多的构思。你有没有注意过，坐下来写东西的时候，一半的构思是写作时产生的？",{"type":401,"tag":1052,"props":2070,"children":2072},{"id":2071},"隐藏-dep",[2073],{"type":407,"value":2074},"隐藏 Dep",{"type":401,"tag":409,"props":2076,"children":2077},{},[2078],{"type":407,"value":2079},"这些内容应和外部是解耦的. 首先一点, 我们创建一个侦听器类, 用于封装我们侦听所用到的所有方法, 它包含了我们想要的全局对象以及操作它的方法(如 watch,set):",{"type":401,"tag":429,"props":2081,"children":2083},{"className":431,"code":2082,"language":433,"meta":394,"style":394},"class VX {\n  constructor () {\n    this.store = Object.create(null)\n  }\n  watch (key, fn, obj = this.store) {}\n  set (key, val, options = {}, obj = this.store) {}\n}\nconst vx = new VX()\n",[2084],{"type":401,"tag":415,"props":2085,"children":2086},{"__ignoreMap":394},[2087,2103,2118,2166,2173,2233,2301,2308],{"type":401,"tag":439,"props":2088,"children":2089},{"class":441,"line":442},[2090,2094,2099],{"type":401,"tag":439,"props":2091,"children":2092},{"style":584},[2093],{"type":407,"value":766},{"type":401,"tag":439,"props":2095,"children":2096},{"style":769},[2097],{"type":407,"value":2098}," VX",{"type":401,"tag":439,"props":2100,"children":2101},{"style":462},[2102],{"type":407,"value":592},{"type":401,"tag":439,"props":2104,"children":2105},{"class":441,"line":452},[2106,2110,2114],{"type":401,"tag":439,"props":2107,"children":2108},{"style":584},[2109],{"type":407,"value":784},{"type":401,"tag":439,"props":2111,"children":2112},{"style":462},[2113],{"type":407,"value":789},{"type":401,"tag":439,"props":2115,"children":2116},{"style":462},[2117],{"type":407,"value":592},{"type":401,"tag":439,"props":2119,"children":2120},{"class":441,"line":531},[2121,2125,2129,2134,2138,2143,2147,2152,2156,2162],{"type":401,"tag":439,"props":2122,"children":2123},{"style":799},[2124],{"type":407,"value":802},{"type":401,"tag":439,"props":2126,"children":2127},{"style":462},[2128],{"type":407,"value":465},{"type":401,"tag":439,"props":2130,"children":2131},{"style":456},[2132],{"type":407,"value":2133},"store",{"type":401,"tag":439,"props":2135,"children":2136},{"style":692},[2137],{"type":407,"value":816},{"type":401,"tag":439,"props":2139,"children":2140},{"style":456},[2141],{"type":407,"value":2142}," Object",{"type":401,"tag":439,"props":2144,"children":2145},{"style":462},[2146],{"type":407,"value":465},{"type":401,"tag":439,"props":2148,"children":2149},{"style":468},[2150],{"type":407,"value":2151},"create",{"type":401,"tag":439,"props":2153,"children":2154},{"style":505},[2155],{"type":407,"value":476},{"type":401,"tag":439,"props":2157,"children":2159},{"style":2158},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF",[2160],{"type":407,"value":2161},"null",{"type":401,"tag":439,"props":2163,"children":2164},{"style":505},[2165],{"type":407,"value":528},{"type":401,"tag":439,"props":2167,"children":2168},{"class":441,"line":540},[2169],{"type":401,"tag":439,"props":2170,"children":2171},{"style":462},[2172],{"type":407,"value":829},{"type":401,"tag":439,"props":2174,"children":2175},{"class":441,"line":595},[2176,2181,2185,2190,2194,2199,2203,2208,2212,2216,2220,2224,2228],{"type":401,"tag":439,"props":2177,"children":2178},{"style":843},[2179],{"type":407,"value":2180},"  watch",{"type":401,"tag":439,"props":2182,"children":2183},{"style":462},[2184],{"type":407,"value":851},{"type":401,"tag":439,"props":2186,"children":2187},{"style":578},[2188],{"type":407,"value":2189},"key",{"type":401,"tag":439,"props":2191,"children":2192},{"style":462},[2193],{"type":407,"value":497},{"type":401,"tag":439,"props":2195,"children":2196},{"style":578},[2197],{"type":407,"value":2198}," fn",{"type":401,"tag":439,"props":2200,"children":2201},{"style":462},[2202],{"type":407,"value":497},{"type":401,"tag":439,"props":2204,"children":2205},{"style":578},[2206],{"type":407,"value":2207}," obj",{"type":401,"tag":439,"props":2209,"children":2210},{"style":692},[2211],{"type":407,"value":816},{"type":401,"tag":439,"props":2213,"children":2214},{"style":799},[2215],{"type":407,"value":1387},{"type":401,"tag":439,"props":2217,"children":2218},{"style":462},[2219],{"type":407,"value":465},{"type":401,"tag":439,"props":2221,"children":2222},{"style":456},[2223],{"type":407,"value":2133},{"type":401,"tag":439,"props":2225,"children":2226},{"style":462},[2227],{"type":407,"value":861},{"type":401,"tag":439,"props":2229,"children":2230},{"style":462},[2231],{"type":407,"value":2232}," {}\n",{"type":401,"tag":439,"props":2234,"children":2235},{"class":441,"line":643},[2236,2240,2244,2248,2252,2256,2260,2265,2269,2273,2277,2281,2285,2289,2293,2297],{"type":401,"tag":439,"props":2237,"children":2238},{"style":843},[2239],{"type":407,"value":1260},{"type":401,"tag":439,"props":2241,"children":2242},{"style":462},[2243],{"type":407,"value":851},{"type":401,"tag":439,"props":2245,"children":2246},{"style":578},[2247],{"type":407,"value":2189},{"type":401,"tag":439,"props":2249,"children":2250},{"style":462},[2251],{"type":407,"value":497},{"type":401,"tag":439,"props":2253,"children":2254},{"style":578},[2255],{"type":407,"value":508},{"type":401,"tag":439,"props":2257,"children":2258},{"style":462},[2259],{"type":407,"value":497},{"type":401,"tag":439,"props":2261,"children":2262},{"style":578},[2263],{"type":407,"value":2264}," options",{"type":401,"tag":439,"props":2266,"children":2267},{"style":692},[2268],{"type":407,"value":816},{"type":401,"tag":439,"props":2270,"children":2271},{"style":462},[2272],{"type":407,"value":1373},{"type":401,"tag":439,"props":2274,"children":2275},{"style":578},[2276],{"type":407,"value":2207},{"type":401,"tag":439,"props":2278,"children":2279},{"style":692},[2280],{"type":407,"value":816},{"type":401,"tag":439,"props":2282,"children":2283},{"style":799},[2284],{"type":407,"value":1387},{"type":401,"tag":439,"props":2286,"children":2287},{"style":462},[2288],{"type":407,"value":465},{"type":401,"tag":439,"props":2290,"children":2291},{"style":456},[2292],{"type":407,"value":2133},{"type":401,"tag":439,"props":2294,"children":2295},{"style":462},[2296],{"type":407,"value":861},{"type":401,"tag":439,"props":2298,"children":2299},{"style":462},[2300],{"type":407,"value":2232},{"type":401,"tag":439,"props":2302,"children":2303},{"class":441,"line":656},[2304],{"type":401,"tag":439,"props":2305,"children":2306},{"style":462},[2307],{"type":407,"value":1032},{"type":401,"tag":439,"props":2309,"children":2310},{"class":441,"line":910},[2311,2315,2320,2324,2328,2332],{"type":401,"tag":439,"props":2312,"children":2313},{"style":584},[2314],{"type":407,"value":1898},{"type":401,"tag":439,"props":2316,"children":2317},{"style":1412},[2318],{"type":407,"value":2319}," vx",{"type":401,"tag":439,"props":2321,"children":2322},{"style":692},[2323],{"type":407,"value":816},{"type":401,"tag":439,"props":2325,"children":2326},{"style":692},[2327],{"type":407,"value":1424},{"type":401,"tag":439,"props":2329,"children":2330},{"style":468},[2331],{"type":407,"value":2098},{"type":401,"tag":439,"props":2333,"children":2334},{"style":456},[2335],{"type":407,"value":1433},{"type":401,"tag":409,"props":2337,"children":2338},{},[2339],{"type":407,"value":2340},"我们可以在 watch 中给对象某个属性添加回调, 就不用去直接操作 Dep 依赖数组了. 只是, 我们在业务代码中调用 watch, 要怎么去获取 obj.key 对应的 dep 呢?",{"type":401,"tag":409,"props":2342,"children":2343},{},[2344],{"type":407,"value":2345},"我们设置一个全局的 depHandler, 在 obj.key 的 getter 中主动将 depHandler 设置为当前 obj.key 的 dep 实例, 那么我们在 watch 函数里, 只要用任意操作触发 obj.key 的 getter, 就能通过 depHandler 得到它的 dep 实例了, 代码形如:",{"type":401,"tag":429,"props":2347,"children":2349},{"className":431,"code":2348,"language":433,"meta":394,"style":394},"  // 一开始没有持有dep实例\n  let handleDep = null\n  class VX {\n    watch (key, fn, obj = this.store) {\n      console.log(obj.key) // 使用任意操作触发obj.key的getter, 那么handleDep将自动引用obj.key的dep实例\n      handleDep.addSub(fn)\n    }\n    set (key, val, options = {}, obj = this.store) {\n      const dep = new Dep()\n      Object.defineProperty(obj, key, {\n        enumerable: true,\n        configurable: true,\n        get: () => {\n          handleDep = dep\n          return val\n        },\n        set: newVal => {}\n      })\n    }\n  }\n",[2350],{"type":401,"tag":415,"props":2351,"children":2352},{"__ignoreMap":394},[2353,2361,2383,2399,2455,2496,2524,2531,2598,2626,2666,2686,2706,2730,2746,2758,2766,2790,2803,2811],{"type":401,"tag":439,"props":2354,"children":2355},{"class":441,"line":442},[2356],{"type":401,"tag":439,"props":2357,"children":2358},{"style":446},[2359],{"type":407,"value":2360},"  // 一开始没有持有dep实例\n",{"type":401,"tag":439,"props":2362,"children":2363},{"class":441,"line":452},[2364,2369,2374,2378],{"type":401,"tag":439,"props":2365,"children":2366},{"style":584},[2367],{"type":407,"value":2368},"  let",{"type":401,"tag":439,"props":2370,"children":2371},{"style":456},[2372],{"type":407,"value":2373}," handleDep ",{"type":401,"tag":439,"props":2375,"children":2376},{"style":692},[2377],{"type":407,"value":695},{"type":401,"tag":439,"props":2379,"children":2380},{"style":2158},[2381],{"type":407,"value":2382}," null\n",{"type":401,"tag":439,"props":2384,"children":2385},{"class":441,"line":531},[2386,2391,2395],{"type":401,"tag":439,"props":2387,"children":2388},{"style":584},[2389],{"type":407,"value":2390},"  class",{"type":401,"tag":439,"props":2392,"children":2393},{"style":769},[2394],{"type":407,"value":2098},{"type":401,"tag":439,"props":2396,"children":2397},{"style":462},[2398],{"type":407,"value":592},{"type":401,"tag":439,"props":2400,"children":2401},{"class":441,"line":540},[2402,2407,2411,2415,2419,2423,2427,2431,2435,2439,2443,2447,2451],{"type":401,"tag":439,"props":2403,"children":2404},{"style":843},[2405],{"type":407,"value":2406},"    watch",{"type":401,"tag":439,"props":2408,"children":2409},{"style":462},[2410],{"type":407,"value":851},{"type":401,"tag":439,"props":2412,"children":2413},{"style":578},[2414],{"type":407,"value":2189},{"type":401,"tag":439,"props":2416,"children":2417},{"style":462},[2418],{"type":407,"value":497},{"type":401,"tag":439,"props":2420,"children":2421},{"style":578},[2422],{"type":407,"value":2198},{"type":401,"tag":439,"props":2424,"children":2425},{"style":462},[2426],{"type":407,"value":497},{"type":401,"tag":439,"props":2428,"children":2429},{"style":578},[2430],{"type":407,"value":2207},{"type":401,"tag":439,"props":2432,"children":2433},{"style":692},[2434],{"type":407,"value":816},{"type":401,"tag":439,"props":2436,"children":2437},{"style":799},[2438],{"type":407,"value":1387},{"type":401,"tag":439,"props":2440,"children":2441},{"style":462},[2442],{"type":407,"value":465},{"type":401,"tag":439,"props":2444,"children":2445},{"style":456},[2446],{"type":407,"value":2133},{"type":401,"tag":439,"props":2448,"children":2449},{"style":462},[2450],{"type":407,"value":861},{"type":401,"tag":439,"props":2452,"children":2453},{"style":462},[2454],{"type":407,"value":592},{"type":401,"tag":439,"props":2456,"children":2457},{"class":441,"line":595},[2458,2463,2467,2471,2475,2479,2483,2487,2491],{"type":401,"tag":439,"props":2459,"children":2460},{"style":456},[2461],{"type":407,"value":2462},"      console",{"type":401,"tag":439,"props":2464,"children":2465},{"style":462},[2466],{"type":407,"value":465},{"type":401,"tag":439,"props":2468,"children":2469},{"style":468},[2470],{"type":407,"value":610},{"type":401,"tag":439,"props":2472,"children":2473},{"style":505},[2474],{"type":407,"value":476},{"type":401,"tag":439,"props":2476,"children":2477},{"style":456},[2478],{"type":407,"value":1458},{"type":401,"tag":439,"props":2480,"children":2481},{"style":462},[2482],{"type":407,"value":465},{"type":401,"tag":439,"props":2484,"children":2485},{"style":456},[2486],{"type":407,"value":2189},{"type":401,"tag":439,"props":2488,"children":2489},{"style":505},[2490],{"type":407,"value":1612},{"type":401,"tag":439,"props":2492,"children":2493},{"style":446},[2494],{"type":407,"value":2495},"// 使用任意操作触发obj.key的getter, 那么handleDep将自动引用obj.key的dep实例\n",{"type":401,"tag":439,"props":2497,"children":2498},{"class":441,"line":643},[2499,2504,2508,2512,2516,2520],{"type":401,"tag":439,"props":2500,"children":2501},{"style":456},[2502],{"type":407,"value":2503},"      handleDep",{"type":401,"tag":439,"props":2505,"children":2506},{"style":462},[2507],{"type":407,"value":465},{"type":401,"tag":439,"props":2509,"children":2510},{"style":468},[2511],{"type":407,"value":1966},{"type":401,"tag":439,"props":2513,"children":2514},{"style":505},[2515],{"type":407,"value":476},{"type":401,"tag":439,"props":2517,"children":2518},{"style":456},[2519],{"type":407,"value":856},{"type":401,"tag":439,"props":2521,"children":2522},{"style":505},[2523],{"type":407,"value":528},{"type":401,"tag":439,"props":2525,"children":2526},{"class":441,"line":656},[2527],{"type":401,"tag":439,"props":2528,"children":2529},{"style":462},[2530],{"type":407,"value":1692},{"type":401,"tag":439,"props":2532,"children":2533},{"class":441,"line":910},[2534,2538,2542,2546,2550,2554,2558,2562,2566,2570,2574,2578,2582,2586,2590,2594],{"type":401,"tag":439,"props":2535,"children":2536},{"style":843},[2537],{"type":407,"value":1566},{"type":401,"tag":439,"props":2539,"children":2540},{"style":462},[2541],{"type":407,"value":851},{"type":401,"tag":439,"props":2543,"children":2544},{"style":578},[2545],{"type":407,"value":2189},{"type":401,"tag":439,"props":2547,"children":2548},{"style":462},[2549],{"type":407,"value":497},{"type":401,"tag":439,"props":2551,"children":2552},{"style":578},[2553],{"type":407,"value":508},{"type":401,"tag":439,"props":2555,"children":2556},{"style":462},[2557],{"type":407,"value":497},{"type":401,"tag":439,"props":2559,"children":2560},{"style":578},[2561],{"type":407,"value":2264},{"type":401,"tag":439,"props":2563,"children":2564},{"style":692},[2565],{"type":407,"value":816},{"type":401,"tag":439,"props":2567,"children":2568},{"style":462},[2569],{"type":407,"value":1373},{"type":401,"tag":439,"props":2571,"children":2572},{"style":578},[2573],{"type":407,"value":2207},{"type":401,"tag":439,"props":2575,"children":2576},{"style":692},[2577],{"type":407,"value":816},{"type":401,"tag":439,"props":2579,"children":2580},{"style":799},[2581],{"type":407,"value":1387},{"type":401,"tag":439,"props":2583,"children":2584},{"style":462},[2585],{"type":407,"value":465},{"type":401,"tag":439,"props":2587,"children":2588},{"style":456},[2589],{"type":407,"value":2133},{"type":401,"tag":439,"props":2591,"children":2592},{"style":462},[2593],{"type":407,"value":861},{"type":401,"tag":439,"props":2595,"children":2596},{"style":462},[2597],{"type":407,"value":592},{"type":401,"tag":439,"props":2599,"children":2600},{"class":441,"line":919},[2601,2606,2610,2614,2618,2622],{"type":401,"tag":439,"props":2602,"children":2603},{"style":584},[2604],{"type":407,"value":2605},"      const",{"type":401,"tag":439,"props":2607,"children":2608},{"style":1412},[2609],{"type":407,"value":1415},{"type":401,"tag":439,"props":2611,"children":2612},{"style":692},[2613],{"type":407,"value":816},{"type":401,"tag":439,"props":2615,"children":2616},{"style":692},[2617],{"type":407,"value":1424},{"type":401,"tag":439,"props":2619,"children":2620},{"style":468},[2621],{"type":407,"value":772},{"type":401,"tag":439,"props":2623,"children":2624},{"style":505},[2625],{"type":407,"value":1433},{"type":401,"tag":439,"props":2627,"children":2628},{"class":441,"line":954},[2629,2634,2638,2642,2646,2650,2654,2658,2662],{"type":401,"tag":439,"props":2630,"children":2631},{"style":456},[2632],{"type":407,"value":2633},"      Object",{"type":401,"tag":439,"props":2635,"children":2636},{"style":462},[2637],{"type":407,"value":465},{"type":401,"tag":439,"props":2639,"children":2640},{"style":468},[2641],{"type":407,"value":1057},{"type":401,"tag":439,"props":2643,"children":2644},{"style":505},[2645],{"type":407,"value":476},{"type":401,"tag":439,"props":2647,"children":2648},{"style":456},[2649],{"type":407,"value":1458},{"type":401,"tag":439,"props":2651,"children":2652},{"style":462},[2653],{"type":407,"value":497},{"type":401,"tag":439,"props":2655,"children":2656},{"style":456},[2657],{"type":407,"value":1122},{"type":401,"tag":439,"props":2659,"children":2660},{"style":462},[2661],{"type":407,"value":497},{"type":401,"tag":439,"props":2663,"children":2664},{"style":462},[2665],{"type":407,"value":592},{"type":401,"tag":439,"props":2667,"children":2668},{"class":441,"line":1018},[2669,2674,2678,2682],{"type":401,"tag":439,"props":2670,"children":2671},{"style":505},[2672],{"type":407,"value":2673},"        enumerable",{"type":401,"tag":439,"props":2675,"children":2676},{"style":462},[2677],{"type":407,"value":513},{"type":401,"tag":439,"props":2679,"children":2680},{"style":1153},[2681],{"type":407,"value":1156},{"type":401,"tag":439,"props":2683,"children":2684},{"style":462},[2685],{"type":407,"value":1161},{"type":401,"tag":439,"props":2687,"children":2688},{"class":441,"line":1026},[2689,2694,2698,2702],{"type":401,"tag":439,"props":2690,"children":2691},{"style":505},[2692],{"type":407,"value":2693},"        configurable",{"type":401,"tag":439,"props":2695,"children":2696},{"style":462},[2697],{"type":407,"value":513},{"type":401,"tag":439,"props":2699,"children":2700},{"style":1153},[2701],{"type":407,"value":1156},{"type":401,"tag":439,"props":2703,"children":2704},{"style":462},[2705],{"type":407,"value":1161},{"type":401,"tag":439,"props":2707,"children":2708},{"class":441,"line":1254},[2709,2714,2718,2722,2726],{"type":401,"tag":439,"props":2710,"children":2711},{"style":468},[2712],{"type":407,"value":2713},"        get",{"type":401,"tag":439,"props":2715,"children":2716},{"style":462},[2717],{"type":407,"value":513},{"type":401,"tag":439,"props":2719,"children":2720},{"style":462},[2721],{"type":407,"value":789},{"type":401,"tag":439,"props":2723,"children":2724},{"style":584},[2725],{"type":407,"value":587},{"type":401,"tag":439,"props":2727,"children":2728},{"style":462},[2729],{"type":407,"value":592},{"type":401,"tag":439,"props":2731,"children":2732},{"class":441,"line":1279},[2733,2738,2742],{"type":401,"tag":439,"props":2734,"children":2735},{"style":456},[2736],{"type":407,"value":2737},"          handleDep",{"type":401,"tag":439,"props":2739,"children":2740},{"style":692},[2741],{"type":407,"value":816},{"type":401,"tag":439,"props":2743,"children":2744},{"style":456},[2745],{"type":407,"value":1876},{"type":401,"tag":439,"props":2747,"children":2748},{"class":441,"line":1297},[2749,2754],{"type":401,"tag":439,"props":2750,"children":2751},{"style":1227},[2752],{"type":407,"value":2753},"          return",{"type":401,"tag":439,"props":2755,"children":2756},{"style":456},[2757],{"type":407,"value":1235},{"type":401,"tag":439,"props":2759,"children":2760},{"class":441,"line":1305},[2761],{"type":401,"tag":439,"props":2762,"children":2763},{"style":462},[2764],{"type":407,"value":2765},"        },\n",{"type":401,"tag":439,"props":2767,"children":2768},{"class":441,"line":1314},[2769,2774,2778,2782,2786],{"type":401,"tag":439,"props":2770,"children":2771},{"style":468},[2772],{"type":407,"value":2773},"        set",{"type":401,"tag":439,"props":2775,"children":2776},{"style":462},[2777],{"type":407,"value":513},{"type":401,"tag":439,"props":2779,"children":2780},{"style":578},[2781],{"type":407,"value":581},{"type":401,"tag":439,"props":2783,"children":2784},{"style":584},[2785],{"type":407,"value":587},{"type":401,"tag":439,"props":2787,"children":2788},{"style":462},[2789],{"type":407,"value":2232},{"type":401,"tag":439,"props":2791,"children":2793},{"class":441,"line":2792},18,[2794,2799],{"type":401,"tag":439,"props":2795,"children":2796},{"style":462},[2797],{"type":407,"value":2798},"      }",{"type":401,"tag":439,"props":2800,"children":2801},{"style":505},[2802],{"type":407,"value":528},{"type":401,"tag":439,"props":2804,"children":2806},{"class":441,"line":2805},19,[2807],{"type":401,"tag":439,"props":2808,"children":2809},{"style":462},[2810],{"type":407,"value":1692},{"type":401,"tag":439,"props":2812,"children":2814},{"class":441,"line":2813},20,[2815],{"type":401,"tag":439,"props":2816,"children":2817},{"style":462},[2818],{"type":407,"value":829},{"type":401,"tag":1052,"props":2820,"children":2822},{"id":2821},"主动收集依赖",[2823],{"type":407,"value":2821},{"type":401,"tag":409,"props":2825,"children":2826},{},[2827,2829,2835,2837,2843,2845,2851],{"type":407,"value":2828},"我们增加",{"type":401,"tag":415,"props":2830,"children":2832},{"className":2831},[],[2833],{"type":407,"value":2834},"handleDep.addSub(fn)",{"type":407,"value":2836},"添加回调函数的逻辑, 其实可以直接放到 getter 中, 首先在 Dep 类中封装一个'主动'收集依赖的",{"type":401,"tag":415,"props":2838,"children":2840},{"className":2839},[],[2841],{"type":407,"value":2842},"collect",{"type":407,"value":2844},"方法, 他会将全局",{"type":401,"tag":415,"props":2846,"children":2848},{"className":2847},[],[2849],{"type":407,"value":2850},"handleFn",{"type":407,"value":2852},"存放到订阅数组中, 这样一来, 在 watch 函数中, 我们只要触发 obj.key 的 getter, 就可以主动收集依赖了:",{"type":401,"tag":429,"props":2854,"children":2856},{"className":431,"code":2855,"language":433,"meta":394,"style":394},"let handleFn = null\nclass Dep {\n  addSub (fn) {}\n  delSub (fn) {}\n  clear () {}\n  collect (fn = handleFn) {\n    if (fn && !this.subs.find(x => x === fn)) {\n      this.addSub(fn)\n    }\n  }\n  notify (newVal, oldVal) {}\n}\n\nlet handleDep = null\nclass VX {\n  watch (key, fn, obj = this.store) {\n    handleFn = fn\n    console.log(obj.key)\n  }\n  set (key, val, options = {}, obj = this.store) {\n    const dep = new Dep()\n    Object.defineProperty(obj, key, {\n      enumerable: true,\n      configurable: true,\n      get: () => {\n        handleDep = dep\n        handleDep.collect()\n        return val\n      },\n      set: newVal => {}\n    })\n  }\n}\n",[2857],{"type":401,"tag":415,"props":2858,"children":2859},{"__ignoreMap":394},[2860,2881,2896,2919,2942,2958,2991,3074,3102,3109,3116,3147,3154,3162,3181,3196,3251,3268,3304,3311,3378,3407,3448,3469,3490,3515,3532,3552,3565,3574,3599,3612,3620],{"type":401,"tag":439,"props":2861,"children":2862},{"class":441,"line":442},[2863,2868,2873,2877],{"type":401,"tag":439,"props":2864,"children":2865},{"style":584},[2866],{"type":407,"value":2867},"let",{"type":401,"tag":439,"props":2869,"children":2870},{"style":456},[2871],{"type":407,"value":2872}," handleFn ",{"type":401,"tag":439,"props":2874,"children":2875},{"style":692},[2876],{"type":407,"value":695},{"type":401,"tag":439,"props":2878,"children":2879},{"style":2158},[2880],{"type":407,"value":2382},{"type":401,"tag":439,"props":2882,"children":2883},{"class":441,"line":452},[2884,2888,2892],{"type":401,"tag":439,"props":2885,"children":2886},{"style":584},[2887],{"type":407,"value":766},{"type":401,"tag":439,"props":2889,"children":2890},{"style":769},[2891],{"type":407,"value":772},{"type":401,"tag":439,"props":2893,"children":2894},{"style":462},[2895],{"type":407,"value":592},{"type":401,"tag":439,"props":2897,"children":2898},{"class":441,"line":531},[2899,2903,2907,2911,2915],{"type":401,"tag":439,"props":2900,"children":2901},{"style":843},[2902],{"type":407,"value":846},{"type":401,"tag":439,"props":2904,"children":2905},{"style":462},[2906],{"type":407,"value":851},{"type":401,"tag":439,"props":2908,"children":2909},{"style":578},[2910],{"type":407,"value":856},{"type":401,"tag":439,"props":2912,"children":2913},{"style":462},[2914],{"type":407,"value":861},{"type":401,"tag":439,"props":2916,"children":2917},{"style":462},[2918],{"type":407,"value":2232},{"type":401,"tag":439,"props":2920,"children":2921},{"class":441,"line":540},[2922,2926,2930,2934,2938],{"type":401,"tag":439,"props":2923,"children":2924},{"style":843},[2925],{"type":407,"value":883},{"type":401,"tag":439,"props":2927,"children":2928},{"style":462},[2929],{"type":407,"value":851},{"type":401,"tag":439,"props":2931,"children":2932},{"style":578},[2933],{"type":407,"value":856},{"type":401,"tag":439,"props":2935,"children":2936},{"style":462},[2937],{"type":407,"value":861},{"type":401,"tag":439,"props":2939,"children":2940},{"style":462},[2941],{"type":407,"value":2232},{"type":401,"tag":439,"props":2943,"children":2944},{"class":441,"line":595},[2945,2950,2954],{"type":401,"tag":439,"props":2946,"children":2947},{"style":843},[2948],{"type":407,"value":2949},"  clear",{"type":401,"tag":439,"props":2951,"children":2952},{"style":462},[2953],{"type":407,"value":789},{"type":401,"tag":439,"props":2955,"children":2956},{"style":462},[2957],{"type":407,"value":2232},{"type":401,"tag":439,"props":2959,"children":2960},{"class":441,"line":643},[2961,2966,2970,2974,2978,2983,2987],{"type":401,"tag":439,"props":2962,"children":2963},{"style":843},[2964],{"type":407,"value":2965},"  collect",{"type":401,"tag":439,"props":2967,"children":2968},{"style":462},[2969],{"type":407,"value":851},{"type":401,"tag":439,"props":2971,"children":2972},{"style":578},[2973],{"type":407,"value":856},{"type":401,"tag":439,"props":2975,"children":2976},{"style":692},[2977],{"type":407,"value":816},{"type":401,"tag":439,"props":2979,"children":2980},{"style":456},[2981],{"type":407,"value":2982}," handleFn",{"type":401,"tag":439,"props":2984,"children":2985},{"style":462},[2986],{"type":407,"value":861},{"type":401,"tag":439,"props":2988,"children":2989},{"style":462},[2990],{"type":407,"value":592},{"type":401,"tag":439,"props":2992,"children":2993},{"class":441,"line":656},[2994,2999,3003,3007,3012,3017,3022,3026,3030,3034,3039,3043,3048,3052,3057,3061,3065,3070],{"type":401,"tag":439,"props":2995,"children":2996},{"style":1227},[2997],{"type":407,"value":2998},"    if",{"type":401,"tag":439,"props":3000,"children":3001},{"style":505},[3002],{"type":407,"value":851},{"type":401,"tag":439,"props":3004,"children":3005},{"style":456},[3006],{"type":407,"value":856},{"type":401,"tag":439,"props":3008,"children":3009},{"style":692},[3010],{"type":407,"value":3011}," &&",{"type":401,"tag":439,"props":3013,"children":3014},{"style":692},[3015],{"type":407,"value":3016}," !",{"type":401,"tag":439,"props":3018,"children":3019},{"style":799},[3020],{"type":407,"value":3021},"this",{"type":401,"tag":439,"props":3023,"children":3024},{"style":462},[3025],{"type":407,"value":465},{"type":401,"tag":439,"props":3027,"children":3028},{"style":456},[3029],{"type":407,"value":811},{"type":401,"tag":439,"props":3031,"children":3032},{"style":462},[3033],{"type":407,"value":465},{"type":401,"tag":439,"props":3035,"children":3036},{"style":468},[3037],{"type":407,"value":3038},"find",{"type":401,"tag":439,"props":3040,"children":3041},{"style":505},[3042],{"type":407,"value":476},{"type":401,"tag":439,"props":3044,"children":3045},{"style":578},[3046],{"type":407,"value":3047},"x",{"type":401,"tag":439,"props":3049,"children":3050},{"style":584},[3051],{"type":407,"value":587},{"type":401,"tag":439,"props":3053,"children":3054},{"style":456},[3055],{"type":407,"value":3056}," x",{"type":401,"tag":439,"props":3058,"children":3059},{"style":692},[3060],{"type":407,"value":1603},{"type":401,"tag":439,"props":3062,"children":3063},{"style":456},[3064],{"type":407,"value":2198},{"type":401,"tag":439,"props":3066,"children":3067},{"style":505},[3068],{"type":407,"value":3069},")) ",{"type":401,"tag":439,"props":3071,"children":3072},{"style":462},[3073],{"type":407,"value":1401},{"type":401,"tag":439,"props":3075,"children":3076},{"class":441,"line":910},[3077,3082,3086,3090,3094,3098],{"type":401,"tag":439,"props":3078,"children":3079},{"style":799},[3080],{"type":407,"value":3081},"      this",{"type":401,"tag":439,"props":3083,"children":3084},{"style":462},[3085],{"type":407,"value":465},{"type":401,"tag":439,"props":3087,"children":3088},{"style":468},[3089],{"type":407,"value":1966},{"type":401,"tag":439,"props":3091,"children":3092},{"style":505},[3093],{"type":407,"value":476},{"type":401,"tag":439,"props":3095,"children":3096},{"style":456},[3097],{"type":407,"value":856},{"type":401,"tag":439,"props":3099,"children":3100},{"style":505},[3101],{"type":407,"value":528},{"type":401,"tag":439,"props":3103,"children":3104},{"class":441,"line":919},[3105],{"type":401,"tag":439,"props":3106,"children":3107},{"style":462},[3108],{"type":407,"value":1692},{"type":401,"tag":439,"props":3110,"children":3111},{"class":441,"line":954},[3112],{"type":401,"tag":439,"props":3113,"children":3114},{"style":462},[3115],{"type":407,"value":829},{"type":401,"tag":439,"props":3117,"children":3118},{"class":441,"line":1018},[3119,3123,3127,3131,3135,3139,3143],{"type":401,"tag":439,"props":3120,"children":3121},{"style":843},[3122],{"type":407,"value":925},{"type":401,"tag":439,"props":3124,"children":3125},{"style":462},[3126],{"type":407,"value":851},{"type":401,"tag":439,"props":3128,"children":3129},{"style":578},[3130],{"type":407,"value":934},{"type":401,"tag":439,"props":3132,"children":3133},{"style":462},[3134],{"type":407,"value":497},{"type":401,"tag":439,"props":3136,"children":3137},{"style":578},[3138],{"type":407,"value":943},{"type":401,"tag":439,"props":3140,"children":3141},{"style":462},[3142],{"type":407,"value":861},{"type":401,"tag":439,"props":3144,"children":3145},{"style":462},[3146],{"type":407,"value":2232},{"type":401,"tag":439,"props":3148,"children":3149},{"class":441,"line":1026},[3150],{"type":401,"tag":439,"props":3151,"children":3152},{"style":462},[3153],{"type":407,"value":1032},{"type":401,"tag":439,"props":3155,"children":3156},{"class":441,"line":1254},[3157],{"type":401,"tag":439,"props":3158,"children":3159},{"emptyLinePlaceholder":393},[3160],{"type":407,"value":3161},"\n",{"type":401,"tag":439,"props":3163,"children":3164},{"class":441,"line":1279},[3165,3169,3173,3177],{"type":401,"tag":439,"props":3166,"children":3167},{"style":584},[3168],{"type":407,"value":2867},{"type":401,"tag":439,"props":3170,"children":3171},{"style":456},[3172],{"type":407,"value":2373},{"type":401,"tag":439,"props":3174,"children":3175},{"style":692},[3176],{"type":407,"value":695},{"type":401,"tag":439,"props":3178,"children":3179},{"style":2158},[3180],{"type":407,"value":2382},{"type":401,"tag":439,"props":3182,"children":3183},{"class":441,"line":1297},[3184,3188,3192],{"type":401,"tag":439,"props":3185,"children":3186},{"style":584},[3187],{"type":407,"value":766},{"type":401,"tag":439,"props":3189,"children":3190},{"style":769},[3191],{"type":407,"value":2098},{"type":401,"tag":439,"props":3193,"children":3194},{"style":462},[3195],{"type":407,"value":592},{"type":401,"tag":439,"props":3197,"children":3198},{"class":441,"line":1305},[3199,3203,3207,3211,3215,3219,3223,3227,3231,3235,3239,3243,3247],{"type":401,"tag":439,"props":3200,"children":3201},{"style":843},[3202],{"type":407,"value":2180},{"type":401,"tag":439,"props":3204,"children":3205},{"style":462},[3206],{"type":407,"value":851},{"type":401,"tag":439,"props":3208,"children":3209},{"style":578},[3210],{"type":407,"value":2189},{"type":401,"tag":439,"props":3212,"children":3213},{"style":462},[3214],{"type":407,"value":497},{"type":401,"tag":439,"props":3216,"children":3217},{"style":578},[3218],{"type":407,"value":2198},{"type":401,"tag":439,"props":3220,"children":3221},{"style":462},[3222],{"type":407,"value":497},{"type":401,"tag":439,"props":3224,"children":3225},{"style":578},[3226],{"type":407,"value":2207},{"type":401,"tag":439,"props":3228,"children":3229},{"style":692},[3230],{"type":407,"value":816},{"type":401,"tag":439,"props":3232,"children":3233},{"style":799},[3234],{"type":407,"value":1387},{"type":401,"tag":439,"props":3236,"children":3237},{"style":462},[3238],{"type":407,"value":465},{"type":401,"tag":439,"props":3240,"children":3241},{"style":456},[3242],{"type":407,"value":2133},{"type":401,"tag":439,"props":3244,"children":3245},{"style":462},[3246],{"type":407,"value":861},{"type":401,"tag":439,"props":3248,"children":3249},{"style":462},[3250],{"type":407,"value":592},{"type":401,"tag":439,"props":3252,"children":3253},{"class":441,"line":1314},[3254,3259,3263],{"type":401,"tag":439,"props":3255,"children":3256},{"style":456},[3257],{"type":407,"value":3258},"    handleFn",{"type":401,"tag":439,"props":3260,"children":3261},{"style":692},[3262],{"type":407,"value":816},{"type":401,"tag":439,"props":3264,"children":3265},{"style":456},[3266],{"type":407,"value":3267}," fn\n",{"type":401,"tag":439,"props":3269,"children":3270},{"class":441,"line":2792},[3271,3276,3280,3284,3288,3292,3296,3300],{"type":401,"tag":439,"props":3272,"children":3273},{"style":456},[3274],{"type":407,"value":3275},"    console",{"type":401,"tag":439,"props":3277,"children":3278},{"style":462},[3279],{"type":407,"value":465},{"type":401,"tag":439,"props":3281,"children":3282},{"style":468},[3283],{"type":407,"value":610},{"type":401,"tag":439,"props":3285,"children":3286},{"style":505},[3287],{"type":407,"value":476},{"type":401,"tag":439,"props":3289,"children":3290},{"style":456},[3291],{"type":407,"value":1458},{"type":401,"tag":439,"props":3293,"children":3294},{"style":462},[3295],{"type":407,"value":465},{"type":401,"tag":439,"props":3297,"children":3298},{"style":456},[3299],{"type":407,"value":2189},{"type":401,"tag":439,"props":3301,"children":3302},{"style":505},[3303],{"type":407,"value":528},{"type":401,"tag":439,"props":3305,"children":3306},{"class":441,"line":2805},[3307],{"type":401,"tag":439,"props":3308,"children":3309},{"style":462},[3310],{"type":407,"value":829},{"type":401,"tag":439,"props":3312,"children":3313},{"class":441,"line":2813},[3314,3318,3322,3326,3330,3334,3338,3342,3346,3350,3354,3358,3362,3366,3370,3374],{"type":401,"tag":439,"props":3315,"children":3316},{"style":843},[3317],{"type":407,"value":1260},{"type":401,"tag":439,"props":3319,"children":3320},{"style":462},[3321],{"type":407,"value":851},{"type":401,"tag":439,"props":3323,"children":3324},{"style":578},[3325],{"type":407,"value":2189},{"type":401,"tag":439,"props":3327,"children":3328},{"style":462},[3329],{"type":407,"value":497},{"type":401,"tag":439,"props":3331,"children":3332},{"style":578},[3333],{"type":407,"value":508},{"type":401,"tag":439,"props":3335,"children":3336},{"style":462},[3337],{"type":407,"value":497},{"type":401,"tag":439,"props":3339,"children":3340},{"style":578},[3341],{"type":407,"value":2264},{"type":401,"tag":439,"props":3343,"children":3344},{"style":692},[3345],{"type":407,"value":816},{"type":401,"tag":439,"props":3347,"children":3348},{"style":462},[3349],{"type":407,"value":1373},{"type":401,"tag":439,"props":3351,"children":3352},{"style":578},[3353],{"type":407,"value":2207},{"type":401,"tag":439,"props":3355,"children":3356},{"style":692},[3357],{"type":407,"value":816},{"type":401,"tag":439,"props":3359,"children":3360},{"style":799},[3361],{"type":407,"value":1387},{"type":401,"tag":439,"props":3363,"children":3364},{"style":462},[3365],{"type":407,"value":465},{"type":401,"tag":439,"props":3367,"children":3368},{"style":456},[3369],{"type":407,"value":2133},{"type":401,"tag":439,"props":3371,"children":3372},{"style":462},[3373],{"type":407,"value":861},{"type":401,"tag":439,"props":3375,"children":3376},{"style":462},[3377],{"type":407,"value":592},{"type":401,"tag":439,"props":3379,"children":3381},{"class":441,"line":3380},21,[3382,3387,3391,3395,3399,3403],{"type":401,"tag":439,"props":3383,"children":3384},{"style":584},[3385],{"type":407,"value":3386},"    const",{"type":401,"tag":439,"props":3388,"children":3389},{"style":1412},[3390],{"type":407,"value":1415},{"type":401,"tag":439,"props":3392,"children":3393},{"style":692},[3394],{"type":407,"value":816},{"type":401,"tag":439,"props":3396,"children":3397},{"style":692},[3398],{"type":407,"value":1424},{"type":401,"tag":439,"props":3400,"children":3401},{"style":468},[3402],{"type":407,"value":772},{"type":401,"tag":439,"props":3404,"children":3405},{"style":505},[3406],{"type":407,"value":1433},{"type":401,"tag":439,"props":3408,"children":3410},{"class":441,"line":3409},22,[3411,3416,3420,3424,3428,3432,3436,3440,3444],{"type":401,"tag":439,"props":3412,"children":3413},{"style":456},[3414],{"type":407,"value":3415},"    Object",{"type":401,"tag":439,"props":3417,"children":3418},{"style":462},[3419],{"type":407,"value":465},{"type":401,"tag":439,"props":3421,"children":3422},{"style":468},[3423],{"type":407,"value":1057},{"type":401,"tag":439,"props":3425,"children":3426},{"style":505},[3427],{"type":407,"value":476},{"type":401,"tag":439,"props":3429,"children":3430},{"style":456},[3431],{"type":407,"value":1458},{"type":401,"tag":439,"props":3433,"children":3434},{"style":462},[3435],{"type":407,"value":497},{"type":401,"tag":439,"props":3437,"children":3438},{"style":456},[3439],{"type":407,"value":1122},{"type":401,"tag":439,"props":3441,"children":3442},{"style":462},[3443],{"type":407,"value":497},{"type":401,"tag":439,"props":3445,"children":3446},{"style":462},[3447],{"type":407,"value":592},{"type":401,"tag":439,"props":3449,"children":3451},{"class":441,"line":3450},23,[3452,3457,3461,3465],{"type":401,"tag":439,"props":3453,"children":3454},{"style":505},[3455],{"type":407,"value":3456},"      enumerable",{"type":401,"tag":439,"props":3458,"children":3459},{"style":462},[3460],{"type":407,"value":513},{"type":401,"tag":439,"props":3462,"children":3463},{"style":1153},[3464],{"type":407,"value":1156},{"type":401,"tag":439,"props":3466,"children":3467},{"style":462},[3468],{"type":407,"value":1161},{"type":401,"tag":439,"props":3470,"children":3472},{"class":441,"line":3471},24,[3473,3478,3482,3486],{"type":401,"tag":439,"props":3474,"children":3475},{"style":505},[3476],{"type":407,"value":3477},"      configurable",{"type":401,"tag":439,"props":3479,"children":3480},{"style":462},[3481],{"type":407,"value":513},{"type":401,"tag":439,"props":3483,"children":3484},{"style":1153},[3485],{"type":407,"value":1156},{"type":401,"tag":439,"props":3487,"children":3488},{"style":462},[3489],{"type":407,"value":1161},{"type":401,"tag":439,"props":3491,"children":3493},{"class":441,"line":3492},25,[3494,3499,3503,3507,3511],{"type":401,"tag":439,"props":3495,"children":3496},{"style":468},[3497],{"type":407,"value":3498},"      get",{"type":401,"tag":439,"props":3500,"children":3501},{"style":462},[3502],{"type":407,"value":513},{"type":401,"tag":439,"props":3504,"children":3505},{"style":462},[3506],{"type":407,"value":789},{"type":401,"tag":439,"props":3508,"children":3509},{"style":584},[3510],{"type":407,"value":587},{"type":401,"tag":439,"props":3512,"children":3513},{"style":462},[3514],{"type":407,"value":592},{"type":401,"tag":439,"props":3516,"children":3518},{"class":441,"line":3517},26,[3519,3524,3528],{"type":401,"tag":439,"props":3520,"children":3521},{"style":456},[3522],{"type":407,"value":3523},"        handleDep",{"type":401,"tag":439,"props":3525,"children":3526},{"style":692},[3527],{"type":407,"value":816},{"type":401,"tag":439,"props":3529,"children":3530},{"style":456},[3531],{"type":407,"value":1876},{"type":401,"tag":439,"props":3533,"children":3535},{"class":441,"line":3534},27,[3536,3540,3544,3548],{"type":401,"tag":439,"props":3537,"children":3538},{"style":456},[3539],{"type":407,"value":3523},{"type":401,"tag":439,"props":3541,"children":3542},{"style":462},[3543],{"type":407,"value":465},{"type":401,"tag":439,"props":3545,"children":3546},{"style":468},[3547],{"type":407,"value":2842},{"type":401,"tag":439,"props":3549,"children":3550},{"style":505},[3551],{"type":407,"value":1433},{"type":401,"tag":439,"props":3553,"children":3555},{"class":441,"line":3554},28,[3556,3561],{"type":401,"tag":439,"props":3557,"children":3558},{"style":1227},[3559],{"type":407,"value":3560},"        return",{"type":401,"tag":439,"props":3562,"children":3563},{"style":456},[3564],{"type":407,"value":1235},{"type":401,"tag":439,"props":3566,"children":3568},{"class":441,"line":3567},29,[3569],{"type":401,"tag":439,"props":3570,"children":3571},{"style":462},[3572],{"type":407,"value":3573},"      },\n",{"type":401,"tag":439,"props":3575,"children":3577},{"class":441,"line":3576},30,[3578,3583,3587,3591,3595],{"type":401,"tag":439,"props":3579,"children":3580},{"style":468},[3581],{"type":407,"value":3582},"      set",{"type":401,"tag":439,"props":3584,"children":3585},{"style":462},[3586],{"type":407,"value":513},{"type":401,"tag":439,"props":3588,"children":3589},{"style":578},[3590],{"type":407,"value":581},{"type":401,"tag":439,"props":3592,"children":3593},{"style":584},[3594],{"type":407,"value":587},{"type":401,"tag":439,"props":3596,"children":3597},{"style":462},[3598],{"type":407,"value":2232},{"type":401,"tag":439,"props":3600,"children":3602},{"class":441,"line":3601},31,[3603,3608],{"type":401,"tag":439,"props":3604,"children":3605},{"style":462},[3606],{"type":407,"value":3607},"    }",{"type":401,"tag":439,"props":3609,"children":3610},{"style":505},[3611],{"type":407,"value":528},{"type":401,"tag":439,"props":3613,"children":3615},{"class":441,"line":3614},32,[3616],{"type":401,"tag":439,"props":3617,"children":3618},{"style":462},[3619],{"type":407,"value":829},{"type":401,"tag":439,"props":3621,"children":3623},{"class":441,"line":3622},33,[3624],{"type":401,"tag":439,"props":3625,"children":3626},{"style":462},[3627],{"type":407,"value":1032},{"type":401,"tag":402,"props":3629,"children":3631},{"id":3630},"处理-key-值为对象链的情况",[3632],{"type":407,"value":3633},"处理 key 值为对象链的情况",{"type":401,"tag":409,"props":3635,"children":3636},{},[3637,3639,3645],{"type":407,"value":3638},"在先前的 watch 函数中, 我们使用 console.log(obj.key)去触发对应属性的 getter, 如果我们调用方式是",{"type":401,"tag":415,"props":3640,"children":3642},{"className":3641},[],[3643],{"type":407,"value":3644},"watch('a.b.c')",{"type":407,"value":3646},"就无能为力了. 这里我们封装一个通用方法, 用于处理对象链字符串的形式:",{"type":401,"tag":429,"props":3648,"children":3650},{"className":431,"code":3649,"language":433,"meta":394,"style":394},"// 通过将字符串'a.b'分割为['a', 'b'], 再使用一个while循环就可以走完这个对象链\nfunction walkChains (key, obj) {\n  const segments = key.split('.')\n  let deepObj = obj\n  while (segments.length) {\n    deepObj = deepObj[segments.shift()]\n  }\n}\nclass VX {\n  watch (key, fn, obj = this.store) {\n    handleFn = fn\n    walkChains(key, obj)\n  }\n}\n",[3651],{"type":401,"tag":415,"props":3652,"children":3653},{"__ignoreMap":394},[3654,3662,3699,3748,3769,3803,3842,3849,3856,3871,3926,3941,3969,3976],{"type":401,"tag":439,"props":3655,"children":3656},{"class":441,"line":442},[3657],{"type":401,"tag":439,"props":3658,"children":3659},{"style":446},[3660],{"type":407,"value":3661},"// 通过将字符串'a.b'分割为['a', 'b'], 再使用一个while循环就可以走完这个对象链\n",{"type":401,"tag":439,"props":3663,"children":3664},{"class":441,"line":452},[3665,3670,3675,3679,3683,3687,3691,3695],{"type":401,"tag":439,"props":3666,"children":3667},{"style":584},[3668],{"type":407,"value":3669},"function",{"type":401,"tag":439,"props":3671,"children":3672},{"style":468},[3673],{"type":407,"value":3674}," walkChains",{"type":401,"tag":439,"props":3676,"children":3677},{"style":462},[3678],{"type":407,"value":851},{"type":401,"tag":439,"props":3680,"children":3681},{"style":578},[3682],{"type":407,"value":2189},{"type":401,"tag":439,"props":3684,"children":3685},{"style":462},[3686],{"type":407,"value":497},{"type":401,"tag":439,"props":3688,"children":3689},{"style":578},[3690],{"type":407,"value":2207},{"type":401,"tag":439,"props":3692,"children":3693},{"style":462},[3694],{"type":407,"value":861},{"type":401,"tag":439,"props":3696,"children":3697},{"style":462},[3698],{"type":407,"value":592},{"type":401,"tag":439,"props":3700,"children":3701},{"class":441,"line":531},[3702,3706,3711,3715,3719,3723,3728,3732,3736,3740,3744],{"type":401,"tag":439,"props":3703,"children":3704},{"style":584},[3705],{"type":407,"value":1409},{"type":401,"tag":439,"props":3707,"children":3708},{"style":1412},[3709],{"type":407,"value":3710}," segments",{"type":401,"tag":439,"props":3712,"children":3713},{"style":692},[3714],{"type":407,"value":816},{"type":401,"tag":439,"props":3716,"children":3717},{"style":456},[3718],{"type":407,"value":1122},{"type":401,"tag":439,"props":3720,"children":3721},{"style":462},[3722],{"type":407,"value":465},{"type":401,"tag":439,"props":3724,"children":3725},{"style":468},[3726],{"type":407,"value":3727},"split",{"type":401,"tag":439,"props":3729,"children":3730},{"style":505},[3731],{"type":407,"value":476},{"type":401,"tag":439,"props":3733,"children":3734},{"style":479},[3735],{"type":407,"value":482},{"type":401,"tag":439,"props":3737,"children":3738},{"style":485},[3739],{"type":407,"value":465},{"type":401,"tag":439,"props":3741,"children":3742},{"style":479},[3743],{"type":407,"value":482},{"type":401,"tag":439,"props":3745,"children":3746},{"style":505},[3747],{"type":407,"value":528},{"type":401,"tag":439,"props":3749,"children":3750},{"class":441,"line":540},[3751,3755,3760,3764],{"type":401,"tag":439,"props":3752,"children":3753},{"style":584},[3754],{"type":407,"value":2368},{"type":401,"tag":439,"props":3756,"children":3757},{"style":456},[3758],{"type":407,"value":3759}," deepObj",{"type":401,"tag":439,"props":3761,"children":3762},{"style":692},[3763],{"type":407,"value":816},{"type":401,"tag":439,"props":3765,"children":3766},{"style":456},[3767],{"type":407,"value":3768}," obj\n",{"type":401,"tag":439,"props":3770,"children":3771},{"class":441,"line":595},[3772,3777,3781,3786,3790,3795,3799],{"type":401,"tag":439,"props":3773,"children":3774},{"style":1227},[3775],{"type":407,"value":3776},"  while",{"type":401,"tag":439,"props":3778,"children":3779},{"style":505},[3780],{"type":407,"value":851},{"type":401,"tag":439,"props":3782,"children":3783},{"style":456},[3784],{"type":407,"value":3785},"segments",{"type":401,"tag":439,"props":3787,"children":3788},{"style":462},[3789],{"type":407,"value":465},{"type":401,"tag":439,"props":3791,"children":3792},{"style":1412},[3793],{"type":407,"value":3794},"length",{"type":401,"tag":439,"props":3796,"children":3797},{"style":505},[3798],{"type":407,"value":1612},{"type":401,"tag":439,"props":3800,"children":3801},{"style":462},[3802],{"type":407,"value":1401},{"type":401,"tag":439,"props":3804,"children":3805},{"class":441,"line":643},[3806,3811,3815,3819,3824,3828,3832,3837],{"type":401,"tag":439,"props":3807,"children":3808},{"style":456},[3809],{"type":407,"value":3810},"    deepObj",{"type":401,"tag":439,"props":3812,"children":3813},{"style":692},[3814],{"type":407,"value":816},{"type":401,"tag":439,"props":3816,"children":3817},{"style":456},[3818],{"type":407,"value":3759},{"type":401,"tag":439,"props":3820,"children":3821},{"style":505},[3822],{"type":407,"value":3823},"[",{"type":401,"tag":439,"props":3825,"children":3826},{"style":456},[3827],{"type":407,"value":3785},{"type":401,"tag":439,"props":3829,"children":3830},{"style":462},[3831],{"type":407,"value":465},{"type":401,"tag":439,"props":3833,"children":3834},{"style":468},[3835],{"type":407,"value":3836},"shift",{"type":401,"tag":439,"props":3838,"children":3839},{"style":505},[3840],{"type":407,"value":3841},"()]\n",{"type":401,"tag":439,"props":3843,"children":3844},{"class":441,"line":656},[3845],{"type":401,"tag":439,"props":3846,"children":3847},{"style":462},[3848],{"type":407,"value":829},{"type":401,"tag":439,"props":3850,"children":3851},{"class":441,"line":910},[3852],{"type":401,"tag":439,"props":3853,"children":3854},{"style":462},[3855],{"type":407,"value":1032},{"type":401,"tag":439,"props":3857,"children":3858},{"class":441,"line":919},[3859,3863,3867],{"type":401,"tag":439,"props":3860,"children":3861},{"style":584},[3862],{"type":407,"value":766},{"type":401,"tag":439,"props":3864,"children":3865},{"style":769},[3866],{"type":407,"value":2098},{"type":401,"tag":439,"props":3868,"children":3869},{"style":462},[3870],{"type":407,"value":592},{"type":401,"tag":439,"props":3872,"children":3873},{"class":441,"line":954},[3874,3878,3882,3886,3890,3894,3898,3902,3906,3910,3914,3918,3922],{"type":401,"tag":439,"props":3875,"children":3876},{"style":843},[3877],{"type":407,"value":2180},{"type":401,"tag":439,"props":3879,"children":3880},{"style":462},[3881],{"type":407,"value":851},{"type":401,"tag":439,"props":3883,"children":3884},{"style":578},[3885],{"type":407,"value":2189},{"type":401,"tag":439,"props":3887,"children":3888},{"style":462},[3889],{"type":407,"value":497},{"type":401,"tag":439,"props":3891,"children":3892},{"style":578},[3893],{"type":407,"value":2198},{"type":401,"tag":439,"props":3895,"children":3896},{"style":462},[3897],{"type":407,"value":497},{"type":401,"tag":439,"props":3899,"children":3900},{"style":578},[3901],{"type":407,"value":2207},{"type":401,"tag":439,"props":3903,"children":3904},{"style":692},[3905],{"type":407,"value":816},{"type":401,"tag":439,"props":3907,"children":3908},{"style":799},[3909],{"type":407,"value":1387},{"type":401,"tag":439,"props":3911,"children":3912},{"style":462},[3913],{"type":407,"value":465},{"type":401,"tag":439,"props":3915,"children":3916},{"style":456},[3917],{"type":407,"value":2133},{"type":401,"tag":439,"props":3919,"children":3920},{"style":462},[3921],{"type":407,"value":861},{"type":401,"tag":439,"props":3923,"children":3924},{"style":462},[3925],{"type":407,"value":592},{"type":401,"tag":439,"props":3927,"children":3928},{"class":441,"line":1018},[3929,3933,3937],{"type":401,"tag":439,"props":3930,"children":3931},{"style":456},[3932],{"type":407,"value":3258},{"type":401,"tag":439,"props":3934,"children":3935},{"style":692},[3936],{"type":407,"value":816},{"type":401,"tag":439,"props":3938,"children":3939},{"style":456},[3940],{"type":407,"value":3267},{"type":401,"tag":439,"props":3942,"children":3943},{"class":441,"line":1026},[3944,3949,3953,3957,3961,3965],{"type":401,"tag":439,"props":3945,"children":3946},{"style":468},[3947],{"type":407,"value":3948},"    walkChains",{"type":401,"tag":439,"props":3950,"children":3951},{"style":505},[3952],{"type":407,"value":476},{"type":401,"tag":439,"props":3954,"children":3955},{"style":456},[3956],{"type":407,"value":2189},{"type":401,"tag":439,"props":3958,"children":3959},{"style":462},[3960],{"type":407,"value":497},{"type":401,"tag":439,"props":3962,"children":3963},{"style":456},[3964],{"type":407,"value":2207},{"type":401,"tag":439,"props":3966,"children":3967},{"style":505},[3968],{"type":407,"value":528},{"type":401,"tag":439,"props":3970,"children":3971},{"class":441,"line":1254},[3972],{"type":401,"tag":439,"props":3973,"children":3974},{"style":462},[3975],{"type":407,"value":829},{"type":401,"tag":439,"props":3977,"children":3978},{"class":441,"line":1279},[3979],{"type":401,"tag":439,"props":3980,"children":3981},{"style":462},[3982],{"type":407,"value":1032},{"type":401,"tag":409,"props":3984,"children":3985},{},[3986,3988,3994],{"type":407,"value":3987},"在 set 方法中处理对象链字符串稍微有些不同, 因为如果",{"type":401,"tag":415,"props":3989,"children":3991},{"className":3990},[],[3992],{"type":407,"value":3993},"set('a.b')",{"type":407,"value":3995},"时, 没有在我们全局对象中找到 a 属性, 这里应该抛错.",{"type":401,"tag":409,"props":3997,"children":3998},{},[3999,4001,4007],{"type":407,"value":4000},"实际的处理中, 需要推断'obj.a'以及'obj.a.b'是否存在. 假设没有'obj.a', 那么我们应该创建一个新的对象, 并且给新的对象添加属性'b', 所以代码类似",{"type":401,"tag":415,"props":4002,"children":4004},{"className":4003},[],[4005],{"type":407,"value":4006},"walkChains",{"type":407,"value":4008},"函数, 只是稍作一层判断:",{"type":401,"tag":429,"props":4010,"children":4012},{"className":431,"code":4011,"language":433,"meta":394,"style":394},"set (key, val, obj) {\n  const segments = key.split('.')\n  // 这里需要注意, 我们只处理到倒数第二个属性\n  while (segments.length > 1) {\n    const handleKey = segments.shift()\n    const handleVal = obj[handleKey]\n    // 存在'obj.a'的情况\n    if (typeof handleVal === 'object') {\n      obj = handleVal\n    // 不存在'obj.a'则给a属性赋一个非响应式的对象\n    } else if (!handleVal) {\n      obj = (\n        key = handleKey,\n        obj[handleKey] = {},\n        obj[handleKey]\n      )\n    } else {\n      console.trace('already has val')\n    }\n  }\n  // 最后一个属性要手动赋值\n  key = segments[0]\n}\n",[4013],{"type":401,"tag":415,"props":4014,"children":4015},{"__ignoreMap":394},[4016,4048,4095,4103,4144,4176,4210,4218,4264,4281,4289,4328,4344,4364,4394,4413,4421,4436,4473,4480,4487,4495,4524],{"type":401,"tag":439,"props":4017,"children":4018},{"class":441,"line":442},[4019,4023,4027,4031,4035,4039,4044],{"type":401,"tag":439,"props":4020,"children":4021},{"style":468},[4022],{"type":407,"value":471},{"type":401,"tag":439,"props":4024,"children":4025},{"style":456},[4026],{"type":407,"value":1347},{"type":401,"tag":439,"props":4028,"children":4029},{"style":462},[4030],{"type":407,"value":497},{"type":401,"tag":439,"props":4032,"children":4033},{"style":456},[4034],{"type":407,"value":508},{"type":401,"tag":439,"props":4036,"children":4037},{"style":462},[4038],{"type":407,"value":497},{"type":401,"tag":439,"props":4040,"children":4041},{"style":456},[4042],{"type":407,"value":4043}," obj) ",{"type":401,"tag":439,"props":4045,"children":4046},{"style":462},[4047],{"type":407,"value":1401},{"type":401,"tag":439,"props":4049,"children":4050},{"class":441,"line":452},[4051,4055,4059,4063,4067,4071,4075,4079,4083,4087,4091],{"type":401,"tag":439,"props":4052,"children":4053},{"style":584},[4054],{"type":407,"value":1409},{"type":401,"tag":439,"props":4056,"children":4057},{"style":1412},[4058],{"type":407,"value":3710},{"type":401,"tag":439,"props":4060,"children":4061},{"style":692},[4062],{"type":407,"value":816},{"type":401,"tag":439,"props":4064,"children":4065},{"style":456},[4066],{"type":407,"value":1122},{"type":401,"tag":439,"props":4068,"children":4069},{"style":462},[4070],{"type":407,"value":465},{"type":401,"tag":439,"props":4072,"children":4073},{"style":468},[4074],{"type":407,"value":3727},{"type":401,"tag":439,"props":4076,"children":4077},{"style":505},[4078],{"type":407,"value":476},{"type":401,"tag":439,"props":4080,"children":4081},{"style":479},[4082],{"type":407,"value":482},{"type":401,"tag":439,"props":4084,"children":4085},{"style":485},[4086],{"type":407,"value":465},{"type":401,"tag":439,"props":4088,"children":4089},{"style":479},[4090],{"type":407,"value":482},{"type":401,"tag":439,"props":4092,"children":4093},{"style":505},[4094],{"type":407,"value":528},{"type":401,"tag":439,"props":4096,"children":4097},{"class":441,"line":531},[4098],{"type":401,"tag":439,"props":4099,"children":4100},{"style":446},[4101],{"type":407,"value":4102},"  // 这里需要注意, 我们只处理到倒数第二个属性\n",{"type":401,"tag":439,"props":4104,"children":4105},{"class":441,"line":540},[4106,4110,4114,4118,4122,4126,4131,4136,4140],{"type":401,"tag":439,"props":4107,"children":4108},{"style":1227},[4109],{"type":407,"value":3776},{"type":401,"tag":439,"props":4111,"children":4112},{"style":505},[4113],{"type":407,"value":851},{"type":401,"tag":439,"props":4115,"children":4116},{"style":456},[4117],{"type":407,"value":3785},{"type":401,"tag":439,"props":4119,"children":4120},{"style":462},[4121],{"type":407,"value":465},{"type":401,"tag":439,"props":4123,"children":4124},{"style":1412},[4125],{"type":407,"value":3794},{"type":401,"tag":439,"props":4127,"children":4128},{"style":692},[4129],{"type":407,"value":4130}," >",{"type":401,"tag":439,"props":4132,"children":4133},{"style":698},[4134],{"type":407,"value":4135}," 1",{"type":401,"tag":439,"props":4137,"children":4138},{"style":505},[4139],{"type":407,"value":1612},{"type":401,"tag":439,"props":4141,"children":4142},{"style":462},[4143],{"type":407,"value":1401},{"type":401,"tag":439,"props":4145,"children":4146},{"class":441,"line":595},[4147,4151,4156,4160,4164,4168,4172],{"type":401,"tag":439,"props":4148,"children":4149},{"style":584},[4150],{"type":407,"value":3386},{"type":401,"tag":439,"props":4152,"children":4153},{"style":1412},[4154],{"type":407,"value":4155}," handleKey",{"type":401,"tag":439,"props":4157,"children":4158},{"style":692},[4159],{"type":407,"value":816},{"type":401,"tag":439,"props":4161,"children":4162},{"style":456},[4163],{"type":407,"value":3710},{"type":401,"tag":439,"props":4165,"children":4166},{"style":462},[4167],{"type":407,"value":465},{"type":401,"tag":439,"props":4169,"children":4170},{"style":468},[4171],{"type":407,"value":3836},{"type":401,"tag":439,"props":4173,"children":4174},{"style":505},[4175],{"type":407,"value":1433},{"type":401,"tag":439,"props":4177,"children":4178},{"class":441,"line":643},[4179,4183,4188,4192,4196,4200,4205],{"type":401,"tag":439,"props":4180,"children":4181},{"style":584},[4182],{"type":407,"value":3386},{"type":401,"tag":439,"props":4184,"children":4185},{"style":1412},[4186],{"type":407,"value":4187}," handleVal",{"type":401,"tag":439,"props":4189,"children":4190},{"style":692},[4191],{"type":407,"value":816},{"type":401,"tag":439,"props":4193,"children":4194},{"style":456},[4195],{"type":407,"value":2207},{"type":401,"tag":439,"props":4197,"children":4198},{"style":505},[4199],{"type":407,"value":3823},{"type":401,"tag":439,"props":4201,"children":4202},{"style":456},[4203],{"type":407,"value":4204},"handleKey",{"type":401,"tag":439,"props":4206,"children":4207},{"style":505},[4208],{"type":407,"value":4209},"]\n",{"type":401,"tag":439,"props":4211,"children":4212},{"class":441,"line":656},[4213],{"type":401,"tag":439,"props":4214,"children":4215},{"style":446},[4216],{"type":407,"value":4217},"    // 存在'obj.a'的情况\n",{"type":401,"tag":439,"props":4219,"children":4220},{"class":441,"line":910},[4221,4225,4229,4234,4238,4242,4247,4252,4256,4260],{"type":401,"tag":439,"props":4222,"children":4223},{"style":1227},[4224],{"type":407,"value":2998},{"type":401,"tag":439,"props":4226,"children":4227},{"style":505},[4228],{"type":407,"value":851},{"type":401,"tag":439,"props":4230,"children":4231},{"style":692},[4232],{"type":407,"value":4233},"typeof",{"type":401,"tag":439,"props":4235,"children":4236},{"style":456},[4237],{"type":407,"value":4187},{"type":401,"tag":439,"props":4239,"children":4240},{"style":692},[4241],{"type":407,"value":1603},{"type":401,"tag":439,"props":4243,"children":4244},{"style":479},[4245],{"type":407,"value":4246}," '",{"type":401,"tag":439,"props":4248,"children":4249},{"style":485},[4250],{"type":407,"value":4251},"object",{"type":401,"tag":439,"props":4253,"children":4254},{"style":479},[4255],{"type":407,"value":482},{"type":401,"tag":439,"props":4257,"children":4258},{"style":505},[4259],{"type":407,"value":1612},{"type":401,"tag":439,"props":4261,"children":4262},{"style":462},[4263],{"type":407,"value":1401},{"type":401,"tag":439,"props":4265,"children":4266},{"class":441,"line":919},[4267,4272,4276],{"type":401,"tag":439,"props":4268,"children":4269},{"style":456},[4270],{"type":407,"value":4271},"      obj",{"type":401,"tag":439,"props":4273,"children":4274},{"style":692},[4275],{"type":407,"value":816},{"type":401,"tag":439,"props":4277,"children":4278},{"style":456},[4279],{"type":407,"value":4280}," handleVal\n",{"type":401,"tag":439,"props":4282,"children":4283},{"class":441,"line":954},[4284],{"type":401,"tag":439,"props":4285,"children":4286},{"style":446},[4287],{"type":407,"value":4288},"    // 不存在'obj.a'则给a属性赋一个非响应式的对象\n",{"type":401,"tag":439,"props":4290,"children":4291},{"class":441,"line":1018},[4292,4296,4301,4306,4310,4315,4320,4324],{"type":401,"tag":439,"props":4293,"children":4294},{"style":462},[4295],{"type":407,"value":3607},{"type":401,"tag":439,"props":4297,"children":4298},{"style":1227},[4299],{"type":407,"value":4300}," else",{"type":401,"tag":439,"props":4302,"children":4303},{"style":1227},[4304],{"type":407,"value":4305}," if",{"type":401,"tag":439,"props":4307,"children":4308},{"style":505},[4309],{"type":407,"value":851},{"type":401,"tag":439,"props":4311,"children":4312},{"style":692},[4313],{"type":407,"value":4314},"!",{"type":401,"tag":439,"props":4316,"children":4317},{"style":456},[4318],{"type":407,"value":4319},"handleVal",{"type":401,"tag":439,"props":4321,"children":4322},{"style":505},[4323],{"type":407,"value":1612},{"type":401,"tag":439,"props":4325,"children":4326},{"style":462},[4327],{"type":407,"value":1401},{"type":401,"tag":439,"props":4329,"children":4330},{"class":441,"line":1026},[4331,4335,4339],{"type":401,"tag":439,"props":4332,"children":4333},{"style":468},[4334],{"type":407,"value":4271},{"type":401,"tag":439,"props":4336,"children":4337},{"style":692},[4338],{"type":407,"value":816},{"type":401,"tag":439,"props":4340,"children":4341},{"style":505},[4342],{"type":407,"value":4343}," (\n",{"type":401,"tag":439,"props":4345,"children":4346},{"class":441,"line":1254},[4347,4352,4356,4360],{"type":401,"tag":439,"props":4348,"children":4349},{"style":456},[4350],{"type":407,"value":4351},"        key",{"type":401,"tag":439,"props":4353,"children":4354},{"style":692},[4355],{"type":407,"value":816},{"type":401,"tag":439,"props":4357,"children":4358},{"style":578},[4359],{"type":407,"value":4155},{"type":401,"tag":439,"props":4361,"children":4362},{"style":462},[4363],{"type":407,"value":1161},{"type":401,"tag":439,"props":4365,"children":4366},{"class":441,"line":1279},[4367,4372,4376,4380,4385,4389],{"type":401,"tag":439,"props":4368,"children":4369},{"style":456},[4370],{"type":407,"value":4371},"        obj",{"type":401,"tag":439,"props":4373,"children":4374},{"style":505},[4375],{"type":407,"value":3823},{"type":401,"tag":439,"props":4377,"children":4378},{"style":456},[4379],{"type":407,"value":4204},{"type":401,"tag":439,"props":4381,"children":4382},{"style":505},[4383],{"type":407,"value":4384},"] ",{"type":401,"tag":439,"props":4386,"children":4387},{"style":692},[4388],{"type":407,"value":695},{"type":401,"tag":439,"props":4390,"children":4391},{"style":462},[4392],{"type":407,"value":4393}," {},\n",{"type":401,"tag":439,"props":4395,"children":4396},{"class":441,"line":1297},[4397,4401,4405,4409],{"type":401,"tag":439,"props":4398,"children":4399},{"style":456},[4400],{"type":407,"value":4371},{"type":401,"tag":439,"props":4402,"children":4403},{"style":505},[4404],{"type":407,"value":3823},{"type":401,"tag":439,"props":4406,"children":4407},{"style":456},[4408],{"type":407,"value":4204},{"type":401,"tag":439,"props":4410,"children":4411},{"style":505},[4412],{"type":407,"value":4209},{"type":401,"tag":439,"props":4414,"children":4415},{"class":441,"line":1305},[4416],{"type":401,"tag":439,"props":4417,"children":4418},{"style":505},[4419],{"type":407,"value":4420},"      )\n",{"type":401,"tag":439,"props":4422,"children":4423},{"class":441,"line":1314},[4424,4428,4432],{"type":401,"tag":439,"props":4425,"children":4426},{"style":462},[4427],{"type":407,"value":3607},{"type":401,"tag":439,"props":4429,"children":4430},{"style":1227},[4431],{"type":407,"value":4300},{"type":401,"tag":439,"props":4433,"children":4434},{"style":462},[4435],{"type":407,"value":592},{"type":401,"tag":439,"props":4437,"children":4438},{"class":441,"line":2792},[4439,4443,4447,4452,4456,4460,4465,4469],{"type":401,"tag":439,"props":4440,"children":4441},{"style":456},[4442],{"type":407,"value":2462},{"type":401,"tag":439,"props":4444,"children":4445},{"style":462},[4446],{"type":407,"value":465},{"type":401,"tag":439,"props":4448,"children":4449},{"style":468},[4450],{"type":407,"value":4451},"trace",{"type":401,"tag":439,"props":4453,"children":4454},{"style":505},[4455],{"type":407,"value":476},{"type":401,"tag":439,"props":4457,"children":4458},{"style":479},[4459],{"type":407,"value":482},{"type":401,"tag":439,"props":4461,"children":4462},{"style":485},[4463],{"type":407,"value":4464},"already has val",{"type":401,"tag":439,"props":4466,"children":4467},{"style":479},[4468],{"type":407,"value":482},{"type":401,"tag":439,"props":4470,"children":4471},{"style":505},[4472],{"type":407,"value":528},{"type":401,"tag":439,"props":4474,"children":4475},{"class":441,"line":2805},[4476],{"type":401,"tag":439,"props":4477,"children":4478},{"style":462},[4479],{"type":407,"value":1692},{"type":401,"tag":439,"props":4481,"children":4482},{"class":441,"line":2813},[4483],{"type":401,"tag":439,"props":4484,"children":4485},{"style":462},[4486],{"type":407,"value":829},{"type":401,"tag":439,"props":4488,"children":4489},{"class":441,"line":3380},[4490],{"type":401,"tag":439,"props":4491,"children":4492},{"style":446},[4493],{"type":407,"value":4494},"  // 最后一个属性要手动赋值\n",{"type":401,"tag":439,"props":4496,"children":4497},{"class":441,"line":3409},[4498,4503,4507,4511,4515,4520],{"type":401,"tag":439,"props":4499,"children":4500},{"style":456},[4501],{"type":407,"value":4502},"  key",{"type":401,"tag":439,"props":4504,"children":4505},{"style":692},[4506],{"type":407,"value":816},{"type":401,"tag":439,"props":4508,"children":4509},{"style":456},[4510],{"type":407,"value":3710},{"type":401,"tag":439,"props":4512,"children":4513},{"style":505},[4514],{"type":407,"value":3823},{"type":401,"tag":439,"props":4516,"children":4517},{"style":698},[4518],{"type":407,"value":4519},"0",{"type":401,"tag":439,"props":4521,"children":4522},{"style":505},[4523],{"type":407,"value":4209},{"type":401,"tag":439,"props":4525,"children":4526},{"class":441,"line":3450},[4527],{"type":401,"tag":439,"props":4528,"children":4529},{"style":462},[4530],{"type":407,"value":1032},{"type":401,"tag":402,"props":4532,"children":4534},{"id":4533},"业务场景应用",[4535],{"type":407,"value":4533},{"type":401,"tag":1052,"props":4537,"children":4539},{"id":4538},"小程序跨页面刷新数据",[4540],{"type":407,"value":4538},{"type":401,"tag":409,"props":4542,"children":4543},{},[4544],{"type":407,"value":4545},"我们经常碰到在小程序中由 A 页面跳转到 B 页面, 如果 B 页面进行了一些操作, 希望 A 页面自动刷新数据的情况. 但是由于 A 页面跳转到 B 页面不同(也许是 redirect,也许是 navigate), 处理方法也不尽相同.",{"type":401,"tag":409,"props":4547,"children":4548},{},[4549],{"type":407,"value":4550},"使用 navigate 方式跳转后, A 页面不会被注销, 所以我们一般会通过全局对象去贮存 A 页面实例(也就是 A 页面的 this 对象), 然后在 B 页面直接调用相应的方法(如 A.refreshList())进行刷新操作.",{"type":401,"tag":409,"props":4552,"children":4553},{},[4554,4556,4562],{"type":407,"value":4555},"引入 VX 后, 我们可以在",{"type":401,"tag":415,"props":4557,"children":4559},{"className":4558},[],[4560],{"type":407,"value":4561},"onload",{"type":407,"value":4563},"生命周期直接调用 watch 方法添加订阅:",{"type":401,"tag":429,"props":4565,"children":4567},{"className":431,"code":4566,"language":433,"meta":394,"style":394},"// app.js\nimport VX from '@/utils/suites/vx'\nconst vx = new VX()\napp.vx = vx\napp.store = vx.store\napp.vx.set('userType', '商户')\n\n// page a\nonLoad () {\n  app.vx.watch('userType', userType => {\n    if (userType === '商户') {\n      // ...\n    } else if (userType === '管理员') {\n      // ...\n    }\n  }, {\n    immediate: true\n  })\n}\n\n// page b\nswitchUserType () {\n  app.store.userType = '管理员'\n}\n",[4568],{"type":401,"tag":415,"props":4569,"children":4570},{"__ignoreMap":394},[4571,4579,4611,4638,4664,4697,4758,4765,4773,4790,4847,4886,4894,4942,4949,4956,4968,4985,4996,5003,5010,5018,5034,5073],{"type":401,"tag":439,"props":4572,"children":4573},{"class":441,"line":442},[4574],{"type":401,"tag":439,"props":4575,"children":4576},{"style":446},[4577],{"type":407,"value":4578},"// app.js\n",{"type":401,"tag":439,"props":4580,"children":4581},{"class":441,"line":452},[4582,4587,4592,4597,4601,4606],{"type":401,"tag":439,"props":4583,"children":4584},{"style":1227},[4585],{"type":407,"value":4586},"import",{"type":401,"tag":439,"props":4588,"children":4589},{"style":456},[4590],{"type":407,"value":4591}," VX ",{"type":401,"tag":439,"props":4593,"children":4594},{"style":1227},[4595],{"type":407,"value":4596},"from",{"type":401,"tag":439,"props":4598,"children":4599},{"style":479},[4600],{"type":407,"value":4246},{"type":401,"tag":439,"props":4602,"children":4603},{"style":485},[4604],{"type":407,"value":4605},"@/utils/suites/vx",{"type":401,"tag":439,"props":4607,"children":4608},{"style":479},[4609],{"type":407,"value":4610},"'\n",{"type":401,"tag":439,"props":4612,"children":4613},{"class":441,"line":531},[4614,4618,4622,4626,4630,4634],{"type":401,"tag":439,"props":4615,"children":4616},{"style":584},[4617],{"type":407,"value":1898},{"type":401,"tag":439,"props":4619,"children":4620},{"style":1412},[4621],{"type":407,"value":2319},{"type":401,"tag":439,"props":4623,"children":4624},{"style":692},[4625],{"type":407,"value":816},{"type":401,"tag":439,"props":4627,"children":4628},{"style":692},[4629],{"type":407,"value":1424},{"type":401,"tag":439,"props":4631,"children":4632},{"style":468},[4633],{"type":407,"value":2098},{"type":401,"tag":439,"props":4635,"children":4636},{"style":456},[4637],{"type":407,"value":1433},{"type":401,"tag":439,"props":4639,"children":4640},{"class":441,"line":540},[4641,4646,4650,4655,4659],{"type":401,"tag":439,"props":4642,"children":4643},{"style":456},[4644],{"type":407,"value":4645},"app",{"type":401,"tag":439,"props":4647,"children":4648},{"style":462},[4649],{"type":407,"value":465},{"type":401,"tag":439,"props":4651,"children":4652},{"style":456},[4653],{"type":407,"value":4654},"vx ",{"type":401,"tag":439,"props":4656,"children":4657},{"style":692},[4658],{"type":407,"value":695},{"type":401,"tag":439,"props":4660,"children":4661},{"style":456},[4662],{"type":407,"value":4663}," vx\n",{"type":401,"tag":439,"props":4665,"children":4666},{"class":441,"line":595},[4667,4671,4675,4680,4684,4688,4692],{"type":401,"tag":439,"props":4668,"children":4669},{"style":456},[4670],{"type":407,"value":4645},{"type":401,"tag":439,"props":4672,"children":4673},{"style":462},[4674],{"type":407,"value":465},{"type":401,"tag":439,"props":4676,"children":4677},{"style":456},[4678],{"type":407,"value":4679},"store ",{"type":401,"tag":439,"props":4681,"children":4682},{"style":692},[4683],{"type":407,"value":695},{"type":401,"tag":439,"props":4685,"children":4686},{"style":456},[4687],{"type":407,"value":2319},{"type":401,"tag":439,"props":4689,"children":4690},{"style":462},[4691],{"type":407,"value":465},{"type":401,"tag":439,"props":4693,"children":4694},{"style":456},[4695],{"type":407,"value":4696},"store\n",{"type":401,"tag":439,"props":4698,"children":4699},{"class":441,"line":643},[4700,4704,4708,4712,4716,4720,4724,4728,4733,4737,4741,4745,4750,4754],{"type":401,"tag":439,"props":4701,"children":4702},{"style":456},[4703],{"type":407,"value":4645},{"type":401,"tag":439,"props":4705,"children":4706},{"style":462},[4707],{"type":407,"value":465},{"type":401,"tag":439,"props":4709,"children":4710},{"style":456},[4711],{"type":407,"value":459},{"type":401,"tag":439,"props":4713,"children":4714},{"style":462},[4715],{"type":407,"value":465},{"type":401,"tag":439,"props":4717,"children":4718},{"style":468},[4719],{"type":407,"value":471},{"type":401,"tag":439,"props":4721,"children":4722},{"style":456},[4723],{"type":407,"value":476},{"type":401,"tag":439,"props":4725,"children":4726},{"style":479},[4727],{"type":407,"value":482},{"type":401,"tag":439,"props":4729,"children":4730},{"style":485},[4731],{"type":407,"value":4732},"userType",{"type":401,"tag":439,"props":4734,"children":4735},{"style":479},[4736],{"type":407,"value":482},{"type":401,"tag":439,"props":4738,"children":4739},{"style":462},[4740],{"type":407,"value":497},{"type":401,"tag":439,"props":4742,"children":4743},{"style":479},[4744],{"type":407,"value":4246},{"type":401,"tag":439,"props":4746,"children":4747},{"style":485},[4748],{"type":407,"value":4749},"商户",{"type":401,"tag":439,"props":4751,"children":4752},{"style":479},[4753],{"type":407,"value":482},{"type":401,"tag":439,"props":4755,"children":4756},{"style":456},[4757],{"type":407,"value":528},{"type":401,"tag":439,"props":4759,"children":4760},{"class":441,"line":656},[4761],{"type":401,"tag":439,"props":4762,"children":4763},{"emptyLinePlaceholder":393},[4764],{"type":407,"value":3161},{"type":401,"tag":439,"props":4766,"children":4767},{"class":441,"line":910},[4768],{"type":401,"tag":439,"props":4769,"children":4770},{"style":446},[4771],{"type":407,"value":4772},"// page a\n",{"type":401,"tag":439,"props":4774,"children":4775},{"class":441,"line":919},[4776,4781,4786],{"type":401,"tag":439,"props":4777,"children":4778},{"style":468},[4779],{"type":407,"value":4780},"onLoad",{"type":401,"tag":439,"props":4782,"children":4783},{"style":456},[4784],{"type":407,"value":4785}," () ",{"type":401,"tag":439,"props":4787,"children":4788},{"style":462},[4789],{"type":407,"value":1401},{"type":401,"tag":439,"props":4791,"children":4792},{"class":441,"line":954},[4793,4798,4802,4806,4810,4814,4818,4822,4826,4830,4834,4839,4843],{"type":401,"tag":439,"props":4794,"children":4795},{"style":456},[4796],{"type":407,"value":4797},"  app",{"type":401,"tag":439,"props":4799,"children":4800},{"style":462},[4801],{"type":407,"value":465},{"type":401,"tag":439,"props":4803,"children":4804},{"style":456},[4805],{"type":407,"value":459},{"type":401,"tag":439,"props":4807,"children":4808},{"style":462},[4809],{"type":407,"value":465},{"type":401,"tag":439,"props":4811,"children":4812},{"style":468},[4813],{"type":407,"value":554},{"type":401,"tag":439,"props":4815,"children":4816},{"style":505},[4817],{"type":407,"value":476},{"type":401,"tag":439,"props":4819,"children":4820},{"style":479},[4821],{"type":407,"value":482},{"type":401,"tag":439,"props":4823,"children":4824},{"style":485},[4825],{"type":407,"value":4732},{"type":401,"tag":439,"props":4827,"children":4828},{"style":479},[4829],{"type":407,"value":482},{"type":401,"tag":439,"props":4831,"children":4832},{"style":462},[4833],{"type":407,"value":497},{"type":401,"tag":439,"props":4835,"children":4836},{"style":578},[4837],{"type":407,"value":4838}," userType",{"type":401,"tag":439,"props":4840,"children":4841},{"style":584},[4842],{"type":407,"value":587},{"type":401,"tag":439,"props":4844,"children":4845},{"style":462},[4846],{"type":407,"value":592},{"type":401,"tag":439,"props":4848,"children":4849},{"class":441,"line":1018},[4850,4854,4858,4862,4866,4870,4874,4878,4882],{"type":401,"tag":439,"props":4851,"children":4852},{"style":1227},[4853],{"type":407,"value":2998},{"type":401,"tag":439,"props":4855,"children":4856},{"style":505},[4857],{"type":407,"value":851},{"type":401,"tag":439,"props":4859,"children":4860},{"style":456},[4861],{"type":407,"value":4732},{"type":401,"tag":439,"props":4863,"children":4864},{"style":692},[4865],{"type":407,"value":1603},{"type":401,"tag":439,"props":4867,"children":4868},{"style":479},[4869],{"type":407,"value":4246},{"type":401,"tag":439,"props":4871,"children":4872},{"style":485},[4873],{"type":407,"value":4749},{"type":401,"tag":439,"props":4875,"children":4876},{"style":479},[4877],{"type":407,"value":482},{"type":401,"tag":439,"props":4879,"children":4880},{"style":505},[4881],{"type":407,"value":1612},{"type":401,"tag":439,"props":4883,"children":4884},{"style":462},[4885],{"type":407,"value":1401},{"type":401,"tag":439,"props":4887,"children":4888},{"class":441,"line":1026},[4889],{"type":401,"tag":439,"props":4890,"children":4891},{"style":446},[4892],{"type":407,"value":4893},"      // ...\n",{"type":401,"tag":439,"props":4895,"children":4896},{"class":441,"line":1254},[4897,4901,4905,4909,4913,4917,4921,4925,4930,4934,4938],{"type":401,"tag":439,"props":4898,"children":4899},{"style":462},[4900],{"type":407,"value":3607},{"type":401,"tag":439,"props":4902,"children":4903},{"style":1227},[4904],{"type":407,"value":4300},{"type":401,"tag":439,"props":4906,"children":4907},{"style":1227},[4908],{"type":407,"value":4305},{"type":401,"tag":439,"props":4910,"children":4911},{"style":505},[4912],{"type":407,"value":851},{"type":401,"tag":439,"props":4914,"children":4915},{"style":456},[4916],{"type":407,"value":4732},{"type":401,"tag":439,"props":4918,"children":4919},{"style":692},[4920],{"type":407,"value":1603},{"type":401,"tag":439,"props":4922,"children":4923},{"style":479},[4924],{"type":407,"value":4246},{"type":401,"tag":439,"props":4926,"children":4927},{"style":485},[4928],{"type":407,"value":4929},"管理员",{"type":401,"tag":439,"props":4931,"children":4932},{"style":479},[4933],{"type":407,"value":482},{"type":401,"tag":439,"props":4935,"children":4936},{"style":505},[4937],{"type":407,"value":1612},{"type":401,"tag":439,"props":4939,"children":4940},{"style":462},[4941],{"type":407,"value":1401},{"type":401,"tag":439,"props":4943,"children":4944},{"class":441,"line":1279},[4945],{"type":401,"tag":439,"props":4946,"children":4947},{"style":446},[4948],{"type":407,"value":4893},{"type":401,"tag":439,"props":4950,"children":4951},{"class":441,"line":1297},[4952],{"type":401,"tag":439,"props":4953,"children":4954},{"style":462},[4955],{"type":407,"value":1692},{"type":401,"tag":439,"props":4957,"children":4958},{"class":441,"line":1305},[4959,4964],{"type":401,"tag":439,"props":4960,"children":4961},{"style":462},[4962],{"type":407,"value":4963},"  },",{"type":401,"tag":439,"props":4965,"children":4966},{"style":462},[4967],{"type":407,"value":592},{"type":401,"tag":439,"props":4969,"children":4970},{"class":441,"line":1314},[4971,4976,4980],{"type":401,"tag":439,"props":4972,"children":4973},{"style":505},[4974],{"type":407,"value":4975},"    immediate",{"type":401,"tag":439,"props":4977,"children":4978},{"style":462},[4979],{"type":407,"value":513},{"type":401,"tag":439,"props":4981,"children":4982},{"style":1153},[4983],{"type":407,"value":4984}," true\n",{"type":401,"tag":439,"props":4986,"children":4987},{"class":441,"line":2792},[4988,4992],{"type":401,"tag":439,"props":4989,"children":4990},{"style":462},[4991],{"type":407,"value":1700},{"type":401,"tag":439,"props":4993,"children":4994},{"style":505},[4995],{"type":407,"value":528},{"type":401,"tag":439,"props":4997,"children":4998},{"class":441,"line":2805},[4999],{"type":401,"tag":439,"props":5000,"children":5001},{"style":462},[5002],{"type":407,"value":1032},{"type":401,"tag":439,"props":5004,"children":5005},{"class":441,"line":2813},[5006],{"type":401,"tag":439,"props":5007,"children":5008},{"emptyLinePlaceholder":393},[5009],{"type":407,"value":3161},{"type":401,"tag":439,"props":5011,"children":5012},{"class":441,"line":3380},[5013],{"type":401,"tag":439,"props":5014,"children":5015},{"style":446},[5016],{"type":407,"value":5017},"// page b\n",{"type":401,"tag":439,"props":5019,"children":5020},{"class":441,"line":3409},[5021,5026,5030],{"type":401,"tag":439,"props":5022,"children":5023},{"style":468},[5024],{"type":407,"value":5025},"switchUserType",{"type":401,"tag":439,"props":5027,"children":5028},{"style":456},[5029],{"type":407,"value":4785},{"type":401,"tag":439,"props":5031,"children":5032},{"style":462},[5033],{"type":407,"value":1401},{"type":401,"tag":439,"props":5035,"children":5036},{"class":441,"line":3450},[5037,5041,5045,5049,5053,5057,5061,5065,5069],{"type":401,"tag":439,"props":5038,"children":5039},{"style":456},[5040],{"type":407,"value":4797},{"type":401,"tag":439,"props":5042,"children":5043},{"style":462},[5044],{"type":407,"value":465},{"type":401,"tag":439,"props":5046,"children":5047},{"style":456},[5048],{"type":407,"value":2133},{"type":401,"tag":439,"props":5050,"children":5051},{"style":462},[5052],{"type":407,"value":465},{"type":401,"tag":439,"props":5054,"children":5055},{"style":456},[5056],{"type":407,"value":4732},{"type":401,"tag":439,"props":5058,"children":5059},{"style":692},[5060],{"type":407,"value":816},{"type":401,"tag":439,"props":5062,"children":5063},{"style":479},[5064],{"type":407,"value":4246},{"type":401,"tag":439,"props":5066,"children":5067},{"style":485},[5068],{"type":407,"value":4929},{"type":401,"tag":439,"props":5070,"children":5071},{"style":479},[5072],{"type":407,"value":4610},{"type":401,"tag":439,"props":5074,"children":5075},{"class":441,"line":3471},[5076],{"type":401,"tag":439,"props":5077,"children":5078},{"style":462},[5079],{"type":407,"value":1032},{"type":401,"tag":402,"props":5081,"children":5083},{"id":5082},"可能遇到的问题",[5084],{"type":407,"value":5082},{"type":401,"tag":1052,"props":5086,"children":5088},{"id":5087},"给-watch-方法添加的函数设置立即执行",[5089],{"type":407,"value":5090},"给 watch 方法添加的函数设置立即执行",{"type":401,"tag":409,"props":5092,"children":5093},{},[5094],{"type":407,"value":5095},"有的时候我们希望通过 watch 添加函数的同时还立即执行该函数一次, 这个时候我们需要再定义额外的参数传递到 watch 中. 问题是这个函数不一定是同步函数.",{"type":401,"tag":409,"props":5097,"children":5098},{},[5099],{"type":407,"value":5100},"简单处理如下:",{"type":401,"tag":429,"props":5102,"children":5104},{"className":431,"code":5103,"language":433,"meta":394,"style":394},"class VX {\n  async watch (key, fn, options = { immediately: false }, obj = this.store) {\n    handleDep = fn\n    walkChains(key, obj)\n    options.immediately && await fn(options.defaultParams)\n  }\n}\n",[5105],{"type":401,"tag":415,"props":5106,"children":5107},{"__ignoreMap":394},[5108,5123,5216,5232,5259,5311,5318],{"type":401,"tag":439,"props":5109,"children":5110},{"class":441,"line":442},[5111,5115,5119],{"type":401,"tag":439,"props":5112,"children":5113},{"style":584},[5114],{"type":407,"value":766},{"type":401,"tag":439,"props":5116,"children":5117},{"style":769},[5118],{"type":407,"value":2098},{"type":401,"tag":439,"props":5120,"children":5121},{"style":462},[5122],{"type":407,"value":592},{"type":401,"tag":439,"props":5124,"children":5125},{"class":441,"line":452},[5126,5132,5137,5141,5145,5149,5153,5157,5161,5165,5169,5174,5178,5183,5188,5192,5196,5200,5204,5208,5212],{"type":401,"tag":439,"props":5127,"children":5129},{"style":5128},"--shiki-light:#9C3EDA;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[5130],{"type":407,"value":5131},"  async",{"type":401,"tag":439,"props":5133,"children":5134},{"style":843},[5135],{"type":407,"value":5136}," watch",{"type":401,"tag":439,"props":5138,"children":5139},{"style":462},[5140],{"type":407,"value":851},{"type":401,"tag":439,"props":5142,"children":5143},{"style":578},[5144],{"type":407,"value":2189},{"type":401,"tag":439,"props":5146,"children":5147},{"style":462},[5148],{"type":407,"value":497},{"type":401,"tag":439,"props":5150,"children":5151},{"style":578},[5152],{"type":407,"value":2198},{"type":401,"tag":439,"props":5154,"children":5155},{"style":462},[5156],{"type":407,"value":497},{"type":401,"tag":439,"props":5158,"children":5159},{"style":578},[5160],{"type":407,"value":2264},{"type":401,"tag":439,"props":5162,"children":5163},{"style":692},[5164],{"type":407,"value":816},{"type":401,"tag":439,"props":5166,"children":5167},{"style":462},[5168],{"type":407,"value":502},{"type":401,"tag":439,"props":5170,"children":5171},{"style":505},[5172],{"type":407,"value":5173}," immediately",{"type":401,"tag":439,"props":5175,"children":5176},{"style":462},[5177],{"type":407,"value":513},{"type":401,"tag":439,"props":5179,"children":5180},{"style":1153},[5181],{"type":407,"value":5182}," false",{"type":401,"tag":439,"props":5184,"children":5185},{"style":462},[5186],{"type":407,"value":5187}," },",{"type":401,"tag":439,"props":5189,"children":5190},{"style":578},[5191],{"type":407,"value":2207},{"type":401,"tag":439,"props":5193,"children":5194},{"style":692},[5195],{"type":407,"value":816},{"type":401,"tag":439,"props":5197,"children":5198},{"style":799},[5199],{"type":407,"value":1387},{"type":401,"tag":439,"props":5201,"children":5202},{"style":462},[5203],{"type":407,"value":465},{"type":401,"tag":439,"props":5205,"children":5206},{"style":456},[5207],{"type":407,"value":2133},{"type":401,"tag":439,"props":5209,"children":5210},{"style":462},[5211],{"type":407,"value":861},{"type":401,"tag":439,"props":5213,"children":5214},{"style":462},[5215],{"type":407,"value":592},{"type":401,"tag":439,"props":5217,"children":5218},{"class":441,"line":531},[5219,5224,5228],{"type":401,"tag":439,"props":5220,"children":5221},{"style":456},[5222],{"type":407,"value":5223},"    handleDep",{"type":401,"tag":439,"props":5225,"children":5226},{"style":692},[5227],{"type":407,"value":816},{"type":401,"tag":439,"props":5229,"children":5230},{"style":456},[5231],{"type":407,"value":3267},{"type":401,"tag":439,"props":5233,"children":5234},{"class":441,"line":540},[5235,5239,5243,5247,5251,5255],{"type":401,"tag":439,"props":5236,"children":5237},{"style":468},[5238],{"type":407,"value":3948},{"type":401,"tag":439,"props":5240,"children":5241},{"style":505},[5242],{"type":407,"value":476},{"type":401,"tag":439,"props":5244,"children":5245},{"style":456},[5246],{"type":407,"value":2189},{"type":401,"tag":439,"props":5248,"children":5249},{"style":462},[5250],{"type":407,"value":497},{"type":401,"tag":439,"props":5252,"children":5253},{"style":456},[5254],{"type":407,"value":2207},{"type":401,"tag":439,"props":5256,"children":5257},{"style":505},[5258],{"type":407,"value":528},{"type":401,"tag":439,"props":5260,"children":5261},{"class":441,"line":595},[5262,5267,5271,5276,5280,5285,5289,5293,5298,5302,5307],{"type":401,"tag":439,"props":5263,"children":5264},{"style":456},[5265],{"type":407,"value":5266},"    options",{"type":401,"tag":439,"props":5268,"children":5269},{"style":462},[5270],{"type":407,"value":465},{"type":401,"tag":439,"props":5272,"children":5273},{"style":456},[5274],{"type":407,"value":5275},"immediately",{"type":401,"tag":439,"props":5277,"children":5278},{"style":692},[5279],{"type":407,"value":3011},{"type":401,"tag":439,"props":5281,"children":5282},{"style":1227},[5283],{"type":407,"value":5284}," await",{"type":401,"tag":439,"props":5286,"children":5287},{"style":468},[5288],{"type":407,"value":2198},{"type":401,"tag":439,"props":5290,"children":5291},{"style":505},[5292],{"type":407,"value":476},{"type":401,"tag":439,"props":5294,"children":5295},{"style":456},[5296],{"type":407,"value":5297},"options",{"type":401,"tag":439,"props":5299,"children":5300},{"style":462},[5301],{"type":407,"value":465},{"type":401,"tag":439,"props":5303,"children":5304},{"style":456},[5305],{"type":407,"value":5306},"defaultParams",{"type":401,"tag":439,"props":5308,"children":5309},{"style":505},[5310],{"type":407,"value":528},{"type":401,"tag":439,"props":5312,"children":5313},{"class":441,"line":643},[5314],{"type":401,"tag":439,"props":5315,"children":5316},{"style":462},[5317],{"type":407,"value":829},{"type":401,"tag":439,"props":5319,"children":5320},{"class":441,"line":656},[5321],{"type":401,"tag":439,"props":5322,"children":5323},{"style":462},[5324],{"type":407,"value":1032},{"type":401,"tag":1052,"props":5326,"children":5328},{"id":5327},"this-绑定丢失问题",[5329],{"type":407,"value":5330},"this 绑定丢失问题",{"type":401,"tag":409,"props":5332,"children":5333},{},[5334],{"type":407,"value":5335},"在我在对 VX 进行删除属性方法的扩展时, 我往 walkChain 函数中添加了一个执行回调函数的机制, 并且在删除属性这个方法直接调用了 walkChain:",{"type":401,"tag":429,"props":5337,"children":5339},{"className":431,"code":5338,"language":433,"meta":394,"style":394},"  function walkChains (key, obj, fn) {\n    const segments = key.split('.')\n    let deepObj = obj\n    while (segments.length) {\n      deepObj = deepObj[segments.shift()]\n      fn && fn()\n    }\n  }\n",[5340],{"type":401,"tag":415,"props":5341,"children":5342},{"__ignoreMap":394},[5343,5387,5434,5454,5486,5522,5542,5549],{"type":401,"tag":439,"props":5344,"children":5345},{"class":441,"line":442},[5346,5351,5355,5359,5363,5367,5371,5375,5379,5383],{"type":401,"tag":439,"props":5347,"children":5348},{"style":584},[5349],{"type":407,"value":5350},"  function",{"type":401,"tag":439,"props":5352,"children":5353},{"style":468},[5354],{"type":407,"value":3674},{"type":401,"tag":439,"props":5356,"children":5357},{"style":462},[5358],{"type":407,"value":851},{"type":401,"tag":439,"props":5360,"children":5361},{"style":578},[5362],{"type":407,"value":2189},{"type":401,"tag":439,"props":5364,"children":5365},{"style":462},[5366],{"type":407,"value":497},{"type":401,"tag":439,"props":5368,"children":5369},{"style":578},[5370],{"type":407,"value":2207},{"type":401,"tag":439,"props":5372,"children":5373},{"style":462},[5374],{"type":407,"value":497},{"type":401,"tag":439,"props":5376,"children":5377},{"style":578},[5378],{"type":407,"value":2198},{"type":401,"tag":439,"props":5380,"children":5381},{"style":462},[5382],{"type":407,"value":861},{"type":401,"tag":439,"props":5384,"children":5385},{"style":462},[5386],{"type":407,"value":592},{"type":401,"tag":439,"props":5388,"children":5389},{"class":441,"line":452},[5390,5394,5398,5402,5406,5410,5414,5418,5422,5426,5430],{"type":401,"tag":439,"props":5391,"children":5392},{"style":584},[5393],{"type":407,"value":3386},{"type":401,"tag":439,"props":5395,"children":5396},{"style":1412},[5397],{"type":407,"value":3710},{"type":401,"tag":439,"props":5399,"children":5400},{"style":692},[5401],{"type":407,"value":816},{"type":401,"tag":439,"props":5403,"children":5404},{"style":456},[5405],{"type":407,"value":1122},{"type":401,"tag":439,"props":5407,"children":5408},{"style":462},[5409],{"type":407,"value":465},{"type":401,"tag":439,"props":5411,"children":5412},{"style":468},[5413],{"type":407,"value":3727},{"type":401,"tag":439,"props":5415,"children":5416},{"style":505},[5417],{"type":407,"value":476},{"type":401,"tag":439,"props":5419,"children":5420},{"style":479},[5421],{"type":407,"value":482},{"type":401,"tag":439,"props":5423,"children":5424},{"style":485},[5425],{"type":407,"value":465},{"type":401,"tag":439,"props":5427,"children":5428},{"style":479},[5429],{"type":407,"value":482},{"type":401,"tag":439,"props":5431,"children":5432},{"style":505},[5433],{"type":407,"value":528},{"type":401,"tag":439,"props":5435,"children":5436},{"class":441,"line":531},[5437,5442,5446,5450],{"type":401,"tag":439,"props":5438,"children":5439},{"style":584},[5440],{"type":407,"value":5441},"    let",{"type":401,"tag":439,"props":5443,"children":5444},{"style":456},[5445],{"type":407,"value":3759},{"type":401,"tag":439,"props":5447,"children":5448},{"style":692},[5449],{"type":407,"value":816},{"type":401,"tag":439,"props":5451,"children":5452},{"style":456},[5453],{"type":407,"value":3768},{"type":401,"tag":439,"props":5455,"children":5456},{"class":441,"line":540},[5457,5462,5466,5470,5474,5478,5482],{"type":401,"tag":439,"props":5458,"children":5459},{"style":1227},[5460],{"type":407,"value":5461},"    while",{"type":401,"tag":439,"props":5463,"children":5464},{"style":505},[5465],{"type":407,"value":851},{"type":401,"tag":439,"props":5467,"children":5468},{"style":456},[5469],{"type":407,"value":3785},{"type":401,"tag":439,"props":5471,"children":5472},{"style":462},[5473],{"type":407,"value":465},{"type":401,"tag":439,"props":5475,"children":5476},{"style":1412},[5477],{"type":407,"value":3794},{"type":401,"tag":439,"props":5479,"children":5480},{"style":505},[5481],{"type":407,"value":1612},{"type":401,"tag":439,"props":5483,"children":5484},{"style":462},[5485],{"type":407,"value":1401},{"type":401,"tag":439,"props":5487,"children":5488},{"class":441,"line":595},[5489,5494,5498,5502,5506,5510,5514,5518],{"type":401,"tag":439,"props":5490,"children":5491},{"style":456},[5492],{"type":407,"value":5493},"      deepObj",{"type":401,"tag":439,"props":5495,"children":5496},{"style":692},[5497],{"type":407,"value":816},{"type":401,"tag":439,"props":5499,"children":5500},{"style":456},[5501],{"type":407,"value":3759},{"type":401,"tag":439,"props":5503,"children":5504},{"style":505},[5505],{"type":407,"value":3823},{"type":401,"tag":439,"props":5507,"children":5508},{"style":456},[5509],{"type":407,"value":3785},{"type":401,"tag":439,"props":5511,"children":5512},{"style":462},[5513],{"type":407,"value":465},{"type":401,"tag":439,"props":5515,"children":5516},{"style":468},[5517],{"type":407,"value":3836},{"type":401,"tag":439,"props":5519,"children":5520},{"style":505},[5521],{"type":407,"value":3841},{"type":401,"tag":439,"props":5523,"children":5524},{"class":441,"line":643},[5525,5530,5534,5538],{"type":401,"tag":439,"props":5526,"children":5527},{"style":456},[5528],{"type":407,"value":5529},"      fn",{"type":401,"tag":439,"props":5531,"children":5532},{"style":692},[5533],{"type":407,"value":3011},{"type":401,"tag":439,"props":5535,"children":5536},{"style":468},[5537],{"type":407,"value":2198},{"type":401,"tag":439,"props":5539,"children":5540},{"style":505},[5541],{"type":407,"value":1433},{"type":401,"tag":439,"props":5543,"children":5544},{"class":441,"line":656},[5545],{"type":401,"tag":439,"props":5546,"children":5547},{"style":462},[5548],{"type":407,"value":1692},{"type":401,"tag":439,"props":5550,"children":5551},{"class":441,"line":910},[5552],{"type":401,"tag":439,"props":5553,"children":5554},{"style":462},[5555],{"type":407,"value":829},{"type":401,"tag":429,"props":5557,"children":5559},{"className":431,"code":5558,"language":433,"meta":394,"style":394},"del (key, obj = this.store) {\n  walkChains(key, obj, handleDep.clear)\n  delete obj[key]\n}\n",[5560],{"type":401,"tag":415,"props":5561,"children":5562},{"__ignoreMap":394},[5563,5603,5649,5673],{"type":401,"tag":439,"props":5564,"children":5565},{"class":441,"line":442},[5566,5571,5575,5579,5583,5587,5591,5595,5599],{"type":401,"tag":439,"props":5567,"children":5568},{"style":468},[5569],{"type":407,"value":5570},"del",{"type":401,"tag":439,"props":5572,"children":5573},{"style":456},[5574],{"type":407,"value":1347},{"type":401,"tag":439,"props":5576,"children":5577},{"style":462},[5578],{"type":407,"value":497},{"type":401,"tag":439,"props":5580,"children":5581},{"style":456},[5582],{"type":407,"value":1378},{"type":401,"tag":439,"props":5584,"children":5585},{"style":692},[5586],{"type":407,"value":695},{"type":401,"tag":439,"props":5588,"children":5589},{"style":799},[5590],{"type":407,"value":1387},{"type":401,"tag":439,"props":5592,"children":5593},{"style":462},[5594],{"type":407,"value":465},{"type":401,"tag":439,"props":5596,"children":5597},{"style":456},[5598],{"type":407,"value":1396},{"type":401,"tag":439,"props":5600,"children":5601},{"style":462},[5602],{"type":407,"value":1401},{"type":401,"tag":439,"props":5604,"children":5605},{"class":441,"line":452},[5606,5611,5615,5619,5623,5627,5631,5636,5640,5645],{"type":401,"tag":439,"props":5607,"children":5608},{"style":468},[5609],{"type":407,"value":5610},"  walkChains",{"type":401,"tag":439,"props":5612,"children":5613},{"style":505},[5614],{"type":407,"value":476},{"type":401,"tag":439,"props":5616,"children":5617},{"style":456},[5618],{"type":407,"value":2189},{"type":401,"tag":439,"props":5620,"children":5621},{"style":462},[5622],{"type":407,"value":497},{"type":401,"tag":439,"props":5624,"children":5625},{"style":456},[5626],{"type":407,"value":2207},{"type":401,"tag":439,"props":5628,"children":5629},{"style":462},[5630],{"type":407,"value":497},{"type":401,"tag":439,"props":5632,"children":5633},{"style":456},[5634],{"type":407,"value":5635}," handleDep",{"type":401,"tag":439,"props":5637,"children":5638},{"style":462},[5639],{"type":407,"value":465},{"type":401,"tag":439,"props":5641,"children":5642},{"style":456},[5643],{"type":407,"value":5644},"clear",{"type":401,"tag":439,"props":5646,"children":5647},{"style":505},[5648],{"type":407,"value":528},{"type":401,"tag":439,"props":5650,"children":5651},{"class":441,"line":531},[5652,5657,5661,5665,5669],{"type":401,"tag":439,"props":5653,"children":5654},{"style":692},[5655],{"type":407,"value":5656},"  delete",{"type":401,"tag":439,"props":5658,"children":5659},{"style":456},[5660],{"type":407,"value":2207},{"type":401,"tag":439,"props":5662,"children":5663},{"style":505},[5664],{"type":407,"value":3823},{"type":401,"tag":439,"props":5666,"children":5667},{"style":456},[5668],{"type":407,"value":2189},{"type":401,"tag":439,"props":5670,"children":5671},{"style":505},[5672],{"type":407,"value":4209},{"type":401,"tag":439,"props":5674,"children":5675},{"class":441,"line":540},[5676],{"type":401,"tag":439,"props":5677,"children":5678},{"style":462},[5679],{"type":407,"value":1032},{"type":401,"tag":409,"props":5681,"children":5682},{},[5683,5685,5690],{"type":407,"value":5684},"因为 handleDep.clear 当成参数传递进 walkChains 中会",{"type":401,"tag":745,"props":5686,"children":5687},{},[5688],{"type":407,"value":5689},"丢失 this 绑定",{"type":407,"value":5691},", 所以上面那段代码其实是有问题的, 不过稍作修改就好了:",{"type":401,"tag":429,"props":5693,"children":5695},{"className":431,"code":5694,"language":433,"meta":394,"style":394},"  del (key, obj = this.store) {\n    walkChains(key, obj, () => handleDep.clear())\n    delete obj[key]\n  }\n",[5696],{"type":401,"tag":415,"props":5697,"children":5698},{"__ignoreMap":394},[5699,5739,5791,5815],{"type":401,"tag":439,"props":5700,"children":5701},{"class":441,"line":442},[5702,5707,5711,5715,5719,5723,5727,5731,5735],{"type":401,"tag":439,"props":5703,"children":5704},{"style":468},[5705],{"type":407,"value":5706},"  del",{"type":401,"tag":439,"props":5708,"children":5709},{"style":456},[5710],{"type":407,"value":1347},{"type":401,"tag":439,"props":5712,"children":5713},{"style":462},[5714],{"type":407,"value":497},{"type":401,"tag":439,"props":5716,"children":5717},{"style":456},[5718],{"type":407,"value":1378},{"type":401,"tag":439,"props":5720,"children":5721},{"style":692},[5722],{"type":407,"value":695},{"type":401,"tag":439,"props":5724,"children":5725},{"style":799},[5726],{"type":407,"value":1387},{"type":401,"tag":439,"props":5728,"children":5729},{"style":462},[5730],{"type":407,"value":465},{"type":401,"tag":439,"props":5732,"children":5733},{"style":456},[5734],{"type":407,"value":1396},{"type":401,"tag":439,"props":5736,"children":5737},{"style":462},[5738],{"type":407,"value":1401},{"type":401,"tag":439,"props":5740,"children":5741},{"class":441,"line":452},[5742,5746,5750,5754,5758,5762,5766,5770,5774,5778,5782,5786],{"type":401,"tag":439,"props":5743,"children":5744},{"style":468},[5745],{"type":407,"value":3948},{"type":401,"tag":439,"props":5747,"children":5748},{"style":505},[5749],{"type":407,"value":476},{"type":401,"tag":439,"props":5751,"children":5752},{"style":456},[5753],{"type":407,"value":2189},{"type":401,"tag":439,"props":5755,"children":5756},{"style":462},[5757],{"type":407,"value":497},{"type":401,"tag":439,"props":5759,"children":5760},{"style":456},[5761],{"type":407,"value":2207},{"type":401,"tag":439,"props":5763,"children":5764},{"style":462},[5765],{"type":407,"value":497},{"type":401,"tag":439,"props":5767,"children":5768},{"style":462},[5769],{"type":407,"value":789},{"type":401,"tag":439,"props":5771,"children":5772},{"style":584},[5773],{"type":407,"value":587},{"type":401,"tag":439,"props":5775,"children":5776},{"style":456},[5777],{"type":407,"value":5635},{"type":401,"tag":439,"props":5779,"children":5780},{"style":462},[5781],{"type":407,"value":465},{"type":401,"tag":439,"props":5783,"children":5784},{"style":468},[5785],{"type":407,"value":5644},{"type":401,"tag":439,"props":5787,"children":5788},{"style":505},[5789],{"type":407,"value":5790},"())\n",{"type":401,"tag":439,"props":5792,"children":5793},{"class":441,"line":531},[5794,5799,5803,5807,5811],{"type":401,"tag":439,"props":5795,"children":5796},{"style":692},[5797],{"type":407,"value":5798},"    delete",{"type":401,"tag":439,"props":5800,"children":5801},{"style":456},[5802],{"type":407,"value":2207},{"type":401,"tag":439,"props":5804,"children":5805},{"style":505},[5806],{"type":407,"value":3823},{"type":401,"tag":439,"props":5808,"children":5809},{"style":456},[5810],{"type":407,"value":2189},{"type":401,"tag":439,"props":5812,"children":5813},{"style":505},[5814],{"type":407,"value":4209},{"type":401,"tag":439,"props":5816,"children":5817},{"class":441,"line":540},[5818],{"type":401,"tag":439,"props":5819,"children":5820},{"style":462},[5821],{"type":407,"value":829},{"type":401,"tag":402,"props":5823,"children":5825},{"id":5824},"后语",[5826],{"type":407,"value":5824},{"type":401,"tag":409,"props":5828,"children":5829},{},[5830],{"type":407,"value":5831},"在这篇文章中, 我们通过对 defineProperty 进行封装, 实现了一个简单的对象属性侦听器的功能, 以弥补小程序所没有的$watch 能力. 在此基础上, 各位可以再对 VX 进行扩展, 更方便地去书写业务代码.",{"type":401,"tag":409,"props":5833,"children":5834},{},[5835,5837],{"type":407,"value":5836},"完整代码 ",{"type":401,"tag":671,"props":5838,"children":5842},{"href":5839,"rel":5840},"https://github.com/Lionad-Morotar/media-gear/blob/master/src/renderer/utils/suites/vx/index.js",[5841],"nofollow",[5843],{"type":407,"value":5844},"GitHub 直达",{"type":401,"tag":5846,"props":5847,"children":5848},"style",{},[5849],{"type":407,"value":5850},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":394,"searchDepth":452,"depth":452,"links":5852},[5853,5854,5855,5856,5859,5864,5865,5868,5872],{"id":404,"depth":452,"text":404},{"id":726,"depth":452,"text":726},{"id":736,"depth":452,"text":736},{"id":1048,"depth":452,"text":1048,"children":5857},[5858],{"id":1054,"depth":531,"text":1057},{"id":2033,"depth":452,"text":2036,"children":5860},[5861,5862,5863],{"id":2039,"depth":531,"text":2039},{"id":2071,"depth":531,"text":2074},{"id":2821,"depth":531,"text":2821},{"id":3630,"depth":452,"text":3633},{"id":4533,"depth":452,"text":4533,"children":5866},[5867],{"id":4538,"depth":531,"text":4538},{"id":5082,"depth":452,"text":5082,"children":5869},[5870,5871],{"id":5087,"depth":531,"text":5090},{"id":5327,"depth":531,"text":5330},{"id":5824,"depth":452,"text":5824},"markdown","content:_archieved:2019-05:reactive-in-150loc.md","content","_archieved/2019-05/reactive-in-150loc.md","md",[5879,5882],{"_path":5880,"title":5881,"description":394},"/_archieved/2018-10/noname","🌆 无题",{"_path":5883,"title":5884,"description":394},"/_archieved/2019-06/messy-in-two-years","💖 聊聊此次离职，毕业，及其它杂乱的事情",1711806186657]