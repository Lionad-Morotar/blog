[{"data":1,"prerenderedAt":2155},["Reactive",2],{"navigation":3,"/maps/_workflow/package-manager/pnpm":386,"/maps/_workflow/package-manager/pnpm-surround":2148},[4,32,80,96,123,129,135,369,375,381],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🌃 长夜梦","/flows/long-night-dream",{"title":15,"_path":16},"🌌 万物联结与幸福感","/flows/everything",{"title":18,"_path":19},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":21,"_path":22},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":24,"_path":25},"🌧️ 我的腼腆","/flows/shy",{"title":27,"_path":28},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":30,"_path":31},"📝 心流归档","/flows/fold",{"title":33,"_path":34,"children":35},"技术博客 / Coder","/articles",[36,38,41,44,47,50,53,56,59,62,65,68,71,74,77],{"title":37,"_path":34},"🦁 为什么我要写博客",{"title":39,"_path":40},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":42,"_path":43},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":45,"_path":46},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":48,"_path":49},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":51,"_path":52},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":54,"_path":55},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":57,"_path":58},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":60,"_path":61},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":63,"_path":64},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":66,"_path":67},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":69,"_path":70},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":72,"_path":73},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":75,"_path":76},"🚝 四十二篇系列","/articles/fourty-two",{"title":78,"_path":79},"📝 技术博客归档","/articles/fold",{"title":81,"_path":82,"children":83},"造物 / Make","/tools",[84,87,90,93],{"title":85,"_path":86},"🌐 AnySort","/tools/anysort",{"title":88,"_path":89},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":91,"_path":92},"👓 Crapto","/tools/crypto-inline",{"title":94,"_path":95},"🖨️ any-to-base64","/tools/any-to-base64",{"title":97,"_path":98,"children":99},"吉他剧场 / Music","/music",[100,102,105,108,111,114,117,120],{"title":101,"_path":98},"🎸 FingerStyle！",{"title":103,"_path":104},"🌬️ 等待的风","/music/wind",{"title":106,"_path":107},"💕 约定的海洋","/music/ocean",{"title":109,"_path":110},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":112,"_path":113},"🌏 残酷天使的行动纲领","/music/eva",{"title":115,"_path":116},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":118,"_path":119},"🍷 Wu Wei","/music/wu-wei",{"title":121,"_path":122},"🌅 无题","/music/untitled",{"title":124,"_path":125,"children":126},"画点什么 / Paint","/paint",[127],{"title":128,"_path":125},"🚧 正在施工",{"title":130,"_path":131,"children":132},"知识地图 / Maps","/maps",[133],{"title":134,"_path":131},"🏁 知识地图",{"title":136,"_path":137,"children":138},"零散的笔记 / Gists","/gists",[139,141,144,147,150,153,156,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255,258,261,264,267,270,273,276,279,282,285,288,291,294,297,300,303,306,309,312,315,318,321,324,327,330,333,336,339,342,345,348,351,354,357,360,363,366],{"title":140,"_path":137},"🧊 Gists",{"title":142,"_path":143},"网站的可访问性","/gists/accessibility",{"title":145,"_path":146},"Bit","/gists/bit",{"title":148,"_path":149},"图片模糊","/gists/blur",{"title":151,"_path":152},"渲染相关笔记","/gists/c4d",{"title":154,"_path":155},"CDN 问题记录","/gists/cdn",{"title":157,"_path":158},"消毒剂","/gists/cleaner",{"title":160,"_path":161},"Windows Command","/gists/cmd",{"title":163,"_path":164},"Command","/gists/command",{"title":166,"_path":167},"复杂科学","/gists/complexity-science",{"title":169,"_path":170},"宇宙","/gists/cosmos",{"title":172,"_path":173},"C++","/gists/cpp",{"title":175,"_path":176},"Data Structure","/gists/data-structure",{"title":178,"_path":179},"DEPRESSION","/gists/depression",{"title":181,"_path":182},"设计模式","/gists/design-patterns",{"title":184,"_path":185},"Developer Experience","/gists/developer-experience",{"title":187,"_path":188},"Device Metrics","/gists/device-metrix",{"title":190,"_path":191},"ECMAScript Language Specification","/gists/ecmascript-specification",{"title":193,"_path":194},"正则表达式","/gists/eegex",{"title":196,"_path":197},"Emoji","/gists/emoji",{"title":199,"_path":200},"工程","/gists/engineering",{"title":202,"_path":203},"熵","/gists/entropy",{"title":205,"_path":206},"Environment","/gists/environment",{"title":208,"_path":209},"Erlang","/gists/erlang",{"title":211,"_path":212},"逃离塔克夫","/gists/escape-from-tarkov",{"title":214,"_path":215},"ESNext (ES6-ES11)","/gists/esnext",{"title":217,"_path":218},"Eval！","/gists/eval",{"title":220,"_path":221},"Flutter","/gists/flutter",{"title":223,"_path":224},"字体","/gists/font",{"title":226,"_path":227},"JS 函数式编程","/gists/functional",{"title":229,"_path":230},"Google C++ Standard","/gists/google-cpp-standard",{"title":232,"_path":233},"双向链接完全体","/gists/graph",{"title":235,"_path":236},"Hardwares","/gists/hardwares",{"title":238,"_path":239},"哈希冲突","/gists/hash-collision",{"title":241,"_path":242},"信息设计","/gists/information-design",{"title":244,"_path":245},"InstantPage","/gists/instant.page",{"title":247,"_path":248},"ISUX 遇见大数据可视化系列","/gists/isux-data-visualization",{"title":250,"_path":251},"KVStore","/gists/key-value-db",{"title":253,"_path":254},"Kubernetes","/gists/kubernetes",{"title":256,"_path":257},"Makefile","/gists/makefile",{"title":259,"_path":260},"Markdown Inline Style","/gists/markdown-nice",{"title":262,"_path":263},"小程序","/gists/miniapp",{"title":265,"_path":266},"减小页面快照体积","/gists/minify-html",{"title":268,"_path":269},"mklink","/gists/mklink",{"title":271,"_path":272},"Mock","/gists/mock",{"title":274,"_path":275},"多端应用","/gists/multy-end-app",{"title":277,"_path":278},"神经科学","/gists/neuroscience",{"title":280,"_path":281},"OO","/gists/oo",{"title":283,"_path":284},"Opinioned Personal Folder","/gists/opinioned-personal-folder",{"title":286,"_path":287},"人物","/gists/person",{"title":289,"_path":290},"PInvoke","/gists/pinvoke",{"title":292,"_path":293},"像素","/gists/pixel",{"title":295,"_path":296},"PowerShell","/gists/powershell",{"title":298,"_path":299},"量子","/gists/quantum",{"title":301,"_path":302},"保持好奇心","/gists/questions",{"title":304,"_path":305},"React Native","/gists/react-native",{"title":307,"_path":308},"博客改版碰到的浏览器平滑滚动问题","/gists/scroll",{"title":310,"_path":311},"SEO","/gists/seo",{"title":313,"_path":314},"Shader","/gists/shader",{"title":316,"_path":317},"Shape Up","/gists/shape-up",{"title":319,"_path":320},"睡觉","/gists/sleep",{"title":322,"_path":323},"States","/gists/states",{"title":325,"_path":326},"Storage","/gists/storage",{"title":328,"_path":329},"音视频流处理","/gists/stream-cli",{"title":331,"_path":332},"Symbol","/gists/symbol",{"title":334,"_path":335},"系统论","/gists/systems-theory",{"title":337,"_path":338},"Taro","/gists/taro",{"title":340,"_path":341},"任务切片","/gists/task-slice",{"title":343,"_path":344},"技术偏好","/gists/tech-dudge",{"title":346,"_path":347},"Untitled","/gists/untitled",{"title":349,"_path":350},"可变字体","/gists/variable-font",{"title":352,"_path":353},"视觉错觉","/gists/visual-illusion",{"title":355,"_path":356},"SS(SSR)","/gists/vpn",{"title":358,"_path":359},"VS Code 插件开发","/gists/vscode-plugin",{"title":361,"_path":362},"Web Components","/gists/web-components",{"title":364,"_path":365},"Windows","/gists/windows",{"title":367,"_path":368},"查缺补漏","/gists/wrong",{"title":370,"_path":371,"children":372},"代码笔记 / Gists","/source-code",[373],{"title":374,"_path":371},"🚄 代码笔记",{"title":376,"_path":377,"children":378},"我 / Abount","/hire",[379],{"title":380,"_path":377},"📬 技术简历",{"title":382,"_path":383,"children":384},"todo","/todo",[385],{"title":382,"_path":383},{"_path":387,"_dir":388,"_draft":389,"_partial":390,"_locale":391,"title":392,"description":393,"body":394,"_type":2143,"_id":2144,"_source":2145,"_file":2146,"_extension":2147},"/maps/_workflow/package-manager/pnpm","package-manager",false,true,"","pnpm","pnpm 是一个快速、省空间的包管理器",{"type":395,"children":396,"toc":2138},"root",[397,406,413,427,433,443,448,454,465,530,536,541,595,601,606,611,616,634,640,651,1192,1206,1211,1217,1248,1254,1335,1368,1377,1397,1403,1455,1497,1659,1670,1676,1681,1704,1755,1761,1766,1772,1800,1806,1830,1841,1846,1852,1857,1918,1924,1929,1937,1949,1955,1960,1973,1978,1989,1995,2072,2078,2091,2099,2110,2116,2121,2132],{"type":398,"tag":399,"props":400,"children":402},"element","h2",{"id":401},"api-细节和配置项",[403],{"type":404,"value":405},"text","API 细节和配置项",{"type":398,"tag":407,"props":408,"children":410},"h4",{"id":409},"pnpm-import",[411],{"type":404,"value":412},"pnpm import",{"type":398,"tag":414,"props":415,"children":416},"p",{},[417,419,425],{"type":404,"value":418},"使用 ",{"type":398,"tag":420,"props":421,"children":423},"code",{"className":422},[],[424],{"type":404,"value":412},{"type":404,"value":426}," 可以将 package-lock、npm-shrinkwrap 和 yarn.lock 转换为 pnpm-lock 文件。",{"type":398,"tag":407,"props":428,"children":430},{"id":429},"pnpm-fetch",[431],{"type":404,"value":432},"pnpm fetch",{"type":398,"tag":414,"props":434,"children":435},{},[436,441],{"type":398,"tag":420,"props":437,"children":439},{"className":438},[],[440],{"type":404,"value":432},{"type":404,"value":442}," 它跳过了 package.json 文件，允许项目在只有 pnpm-lock 文件的情况下创建 .pnpm 虚拟仓库。这有利于 docker 构建，因为 package.json 经常因为非依赖变化的改动而改动，导致 docker layer 失效。",{"type":398,"tag":414,"props":444,"children":445},{},[446],{"type":404,"value":447},"相比 yarn 和 npm，在脱离 package.json 的情况下，单靠 package-lock（或 yarn-lock），yarn 和 npm 没有办法确定依赖版本，因为其 package-lock 中，依赖的版本号不是固定版本号。",{"type":398,"tag":407,"props":449,"children":451},{"id":450},"pnpm-why",[452],{"type":404,"value":453},"pnpm why",{"type":398,"tag":414,"props":455,"children":456},{},[457,458,463],{"type":404,"value":418},{"type":398,"tag":420,"props":459,"children":461},{"className":460},[],[462],{"type":404,"value":453},{"type":404,"value":464}," 可以列出项目内依赖了某个依赖的依赖，比如说找到项目内使用了 lodash 的包。",{"type":398,"tag":466,"props":467,"children":470},"pre",{"code":468,"language":404,"meta":391,"className":469,"style":391},"dependencies:\nelement-plus 2.2.20\n├── lodash 4.17.21\n└─┬ lodash-unified 1.0.3\n  └── lodash 4.17.21 peer\n...\n","language-text shiki shiki-themes material-theme-lighter github-light github-dark monokai",[471],{"type":398,"tag":420,"props":472,"children":473},{"__ignoreMap":391},[474,485,494,503,512,521],{"type":398,"tag":475,"props":476,"children":479},"span",{"class":477,"line":478},"line",1,[480],{"type":398,"tag":475,"props":481,"children":482},{},[483],{"type":404,"value":484},"dependencies:\n",{"type":398,"tag":475,"props":486,"children":488},{"class":477,"line":487},2,[489],{"type":398,"tag":475,"props":490,"children":491},{},[492],{"type":404,"value":493},"element-plus 2.2.20\n",{"type":398,"tag":475,"props":495,"children":497},{"class":477,"line":496},3,[498],{"type":398,"tag":475,"props":499,"children":500},{},[501],{"type":404,"value":502},"├── lodash 4.17.21\n",{"type":398,"tag":475,"props":504,"children":506},{"class":477,"line":505},4,[507],{"type":398,"tag":475,"props":508,"children":509},{},[510],{"type":404,"value":511},"└─┬ lodash-unified 1.0.3\n",{"type":398,"tag":475,"props":513,"children":515},{"class":477,"line":514},5,[516],{"type":398,"tag":475,"props":517,"children":518},{},[519],{"type":404,"value":520},"  └── lodash 4.17.21 peer\n",{"type":398,"tag":475,"props":522,"children":524},{"class":477,"line":523},6,[525],{"type":398,"tag":475,"props":526,"children":527},{},[528],{"type":404,"value":529},"...\n",{"type":398,"tag":407,"props":531,"children":533},{"id":532},"pnpm-run",[534],{"type":404,"value":535},"pnpm run",{"type":398,"tag":414,"props":537,"children":538},{},[539],{"type":404,"value":540},"与其它包管理器的一些区别：",{"type":398,"tag":542,"props":543,"children":544},"ol",{},[545,571,576],{"type":398,"tag":546,"props":547,"children":548},"li",{},[549,555,557,563,565],{"type":398,"tag":420,"props":550,"children":552},{"className":551},[],[553],{"type":404,"value":554},"pnpm run script-name",{"type":404,"value":556},"，如果 ",{"type":398,"tag":420,"props":558,"children":560},{"className":559},[],[561],{"type":404,"value":562},"script-name",{"type":404,"value":564}," 没有和 pnpm 内置指令冲突，则可以省略 ",{"type":398,"tag":420,"props":566,"children":568},{"className":567},[],[569],{"type":404,"value":570},"run",{"type":398,"tag":546,"props":572,"children":573},{},[574],{"type":404,"value":575},"run 指令默认不会执行 pre 和 post 钩子函数，因为 pnpm 认为这使任务流更难理解",{"type":398,"tag":546,"props":577,"children":578},{},[579,585,587,593],{"type":398,"tag":420,"props":580,"children":582},{"className":581},[],[583],{"type":404,"value":584},"shell-emulator",{"type":404,"value":586}," 选项启用后，将使用 JS 解析指令，这使得在不兼容 POSIX 的环境执行类似 ",{"type":398,"tag":420,"props":588,"children":590},{"className":589},[],[591],{"type":404,"value":592},"NODE_ENV=test node ./index",{"type":404,"value":594}," 的指令会报错的系统也能正常运行这种指令",{"type":398,"tag":407,"props":596,"children":598},{"id":597},"pnpm-pack",[599],{"type":404,"value":600},"pnpm pack",{"type":398,"tag":414,"props":602,"children":603},{},[604],{"type":404,"value":605},"将项目打包为 tarball 压缩包（.tgz）。打包的文件范围和 pnpm publish 一样。",{"type":398,"tag":407,"props":607,"children":609},{"id":608},"shared-workspace-lockfile",[610],{"type":404,"value":608},{"type":398,"tag":414,"props":612,"children":613},{},[614],{"type":404,"value":615},"在 workspace 间共享一份 package-lock 文件。这个配置开启后，所有子包的依赖都会被提升到 workspace 根目录，这带来了几个好处：",{"type":398,"tag":542,"props":617,"children":618},{},[619,624,629],{"type":398,"tag":546,"props":620,"children":621},{},[622],{"type":404,"value":623},"所有依赖都是单例的",{"type":398,"tag":546,"props":625,"children":626},{},[627],{"type":404,"value":628},"更快的安装速度（相比 pnpm install -r）",{"type":398,"tag":546,"props":630,"children":631},{},[632],{"type":404,"value":633},"修改的文件总数更少，利于 Code Review",{"type":398,"tag":407,"props":635,"children":637},{"id":636},"pnpmfilecjs",[638],{"type":404,"value":639},".pnpmfile.cjs",{"type":398,"tag":414,"props":641,"children":642},{},[643,644,649],{"type":404,"value":418},{"type":398,"tag":420,"props":645,"children":647},{"className":646},[],[648],{"type":404,"value":639},{"type":404,"value":650}," 文件提供的 readPackage 和 afterAllResolved 钩子函数可以分别介入依赖元信息解析（minifest）和依赖安装完准备输出 lock 文件的过程。",{"type":398,"tag":466,"props":652,"children":656},{"code":653,"language":654,"meta":391,"className":655,"style":391},"function readPackage(pkg, context) {\n  // Override the manifest of foo@1.x after downloading it from the registry\n  if (pkg.name === 'foo' && pkg.version.startsWith('1.')) {\n    // Replace bar@x.x.x with bar@2.0.0\n    pkg.dependencies = {\n      ...pkg.dependencies,\n      bar: '^2.0.0'\n    }\n    context.log('bar@1 => bar@2 in dependencies of foo')\n  }\n  \n  // This will change any packages using baz@x.x.x to use baz@1.2.3\n  if (pkg.dependencies.baz) {\n    pkg.dependencies.baz = '1.2.3';\n  }\n  \n  return pkg\n}\n\nmodule.exports = {\n  hooks: {\n    readPackage\n  }\n}\n","js","language-js shiki shiki-themes material-theme-lighter github-light github-dark monokai",[657],{"type":398,"tag":420,"props":658,"children":659},{"__ignoreMap":391},[660,707,716,824,832,858,883,911,920,960,969,978,987,1029,1075,1083,1091,1105,1114,1123,1150,1167,1176,1184],{"type":398,"tag":475,"props":661,"children":662},{"class":477,"line":478},[663,669,675,681,687,692,697,702],{"type":398,"tag":475,"props":664,"children":666},{"style":665},"--shiki-light:#9C3EDA;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#66D9EF;--shiki-light-font-style:inherit;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[667],{"type":404,"value":668},"function",{"type":398,"tag":475,"props":670,"children":672},{"style":671},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[673],{"type":404,"value":674}," readPackage",{"type":398,"tag":475,"props":676,"children":678},{"style":677},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[679],{"type":404,"value":680},"(",{"type":398,"tag":475,"props":682,"children":684},{"style":683},"--shiki-light:#90A4AE;--shiki-default:#E36209;--shiki-dark:#FFAB70;--shiki-sepia:#FD971F;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[685],{"type":404,"value":686},"pkg",{"type":398,"tag":475,"props":688,"children":689},{"style":677},[690],{"type":404,"value":691},",",{"type":398,"tag":475,"props":693,"children":694},{"style":683},[695],{"type":404,"value":696}," context",{"type":398,"tag":475,"props":698,"children":699},{"style":677},[700],{"type":404,"value":701},")",{"type":398,"tag":475,"props":703,"children":704},{"style":677},[705],{"type":404,"value":706}," {\n",{"type":398,"tag":475,"props":708,"children":709},{"class":477,"line":487},[710],{"type":398,"tag":475,"props":711,"children":713},{"style":712},"--shiki-light:#90A4AE;--shiki-default:#6A737D;--shiki-dark:#6A737D;--shiki-sepia:#88846F;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:inherit",[714],{"type":404,"value":715},"  // Override the manifest of foo@1.x after downloading it from the registry\n",{"type":398,"tag":475,"props":717,"children":718},{"class":477,"line":496},[719,725,731,736,741,746,752,758,764,769,774,779,783,788,792,797,801,805,810,814,819],{"type":398,"tag":475,"props":720,"children":722},{"style":721},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:inherit",[723],{"type":404,"value":724},"  if",{"type":398,"tag":475,"props":726,"children":728},{"style":727},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[729],{"type":404,"value":730}," (",{"type":398,"tag":475,"props":732,"children":734},{"style":733},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[735],{"type":404,"value":686},{"type":398,"tag":475,"props":737,"children":738},{"style":677},[739],{"type":404,"value":740},".",{"type":398,"tag":475,"props":742,"children":743},{"style":733},[744],{"type":404,"value":745},"name",{"type":398,"tag":475,"props":747,"children":749},{"style":748},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[750],{"type":404,"value":751}," ===",{"type":398,"tag":475,"props":753,"children":755},{"style":754},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[756],{"type":404,"value":757}," '",{"type":398,"tag":475,"props":759,"children":761},{"style":760},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[762],{"type":404,"value":763},"foo",{"type":398,"tag":475,"props":765,"children":766},{"style":754},[767],{"type":404,"value":768},"'",{"type":398,"tag":475,"props":770,"children":771},{"style":748},[772],{"type":404,"value":773}," &&",{"type":398,"tag":475,"props":775,"children":776},{"style":733},[777],{"type":404,"value":778}," pkg",{"type":398,"tag":475,"props":780,"children":781},{"style":677},[782],{"type":404,"value":740},{"type":398,"tag":475,"props":784,"children":785},{"style":733},[786],{"type":404,"value":787},"version",{"type":398,"tag":475,"props":789,"children":790},{"style":677},[791],{"type":404,"value":740},{"type":398,"tag":475,"props":793,"children":794},{"style":671},[795],{"type":404,"value":796},"startsWith",{"type":398,"tag":475,"props":798,"children":799},{"style":727},[800],{"type":404,"value":680},{"type":398,"tag":475,"props":802,"children":803},{"style":754},[804],{"type":404,"value":768},{"type":398,"tag":475,"props":806,"children":807},{"style":760},[808],{"type":404,"value":809},"1.",{"type":398,"tag":475,"props":811,"children":812},{"style":754},[813],{"type":404,"value":768},{"type":398,"tag":475,"props":815,"children":816},{"style":727},[817],{"type":404,"value":818},")) ",{"type":398,"tag":475,"props":820,"children":821},{"style":677},[822],{"type":404,"value":823},"{\n",{"type":398,"tag":475,"props":825,"children":826},{"class":477,"line":505},[827],{"type":398,"tag":475,"props":828,"children":829},{"style":712},[830],{"type":404,"value":831},"    // Replace bar@x.x.x with bar@2.0.0\n",{"type":398,"tag":475,"props":833,"children":834},{"class":477,"line":514},[835,840,844,849,854],{"type":398,"tag":475,"props":836,"children":837},{"style":733},[838],{"type":404,"value":839},"    pkg",{"type":398,"tag":475,"props":841,"children":842},{"style":677},[843],{"type":404,"value":740},{"type":398,"tag":475,"props":845,"children":846},{"style":733},[847],{"type":404,"value":848},"dependencies",{"type":398,"tag":475,"props":850,"children":851},{"style":748},[852],{"type":404,"value":853}," =",{"type":398,"tag":475,"props":855,"children":856},{"style":677},[857],{"type":404,"value":706},{"type":398,"tag":475,"props":859,"children":860},{"class":477,"line":523},[861,866,870,874,878],{"type":398,"tag":475,"props":862,"children":863},{"style":748},[864],{"type":404,"value":865},"      ...",{"type":398,"tag":475,"props":867,"children":868},{"style":733},[869],{"type":404,"value":686},{"type":398,"tag":475,"props":871,"children":872},{"style":677},[873],{"type":404,"value":740},{"type":398,"tag":475,"props":875,"children":876},{"style":733},[877],{"type":404,"value":848},{"type":398,"tag":475,"props":879,"children":880},{"style":677},[881],{"type":404,"value":882},",\n",{"type":398,"tag":475,"props":884,"children":886},{"class":477,"line":885},7,[887,892,897,901,906],{"type":398,"tag":475,"props":888,"children":889},{"style":727},[890],{"type":404,"value":891},"      bar",{"type":398,"tag":475,"props":893,"children":894},{"style":677},[895],{"type":404,"value":896},":",{"type":398,"tag":475,"props":898,"children":899},{"style":754},[900],{"type":404,"value":757},{"type":398,"tag":475,"props":902,"children":903},{"style":760},[904],{"type":404,"value":905},"^2.0.0",{"type":398,"tag":475,"props":907,"children":908},{"style":754},[909],{"type":404,"value":910},"'\n",{"type":398,"tag":475,"props":912,"children":914},{"class":477,"line":913},8,[915],{"type":398,"tag":475,"props":916,"children":917},{"style":677},[918],{"type":404,"value":919},"    }\n",{"type":398,"tag":475,"props":921,"children":923},{"class":477,"line":922},9,[924,929,933,938,942,946,951,955],{"type":398,"tag":475,"props":925,"children":926},{"style":733},[927],{"type":404,"value":928},"    context",{"type":398,"tag":475,"props":930,"children":931},{"style":677},[932],{"type":404,"value":740},{"type":398,"tag":475,"props":934,"children":935},{"style":671},[936],{"type":404,"value":937},"log",{"type":398,"tag":475,"props":939,"children":940},{"style":727},[941],{"type":404,"value":680},{"type":398,"tag":475,"props":943,"children":944},{"style":754},[945],{"type":404,"value":768},{"type":398,"tag":475,"props":947,"children":948},{"style":760},[949],{"type":404,"value":950},"bar@1 => bar@2 in dependencies of foo",{"type":398,"tag":475,"props":952,"children":953},{"style":754},[954],{"type":404,"value":768},{"type":398,"tag":475,"props":956,"children":957},{"style":727},[958],{"type":404,"value":959},")\n",{"type":398,"tag":475,"props":961,"children":963},{"class":477,"line":962},10,[964],{"type":398,"tag":475,"props":965,"children":966},{"style":677},[967],{"type":404,"value":968},"  }\n",{"type":398,"tag":475,"props":970,"children":972},{"class":477,"line":971},11,[973],{"type":398,"tag":475,"props":974,"children":975},{"style":727},[976],{"type":404,"value":977},"  \n",{"type":398,"tag":475,"props":979,"children":981},{"class":477,"line":980},12,[982],{"type":398,"tag":475,"props":983,"children":984},{"style":712},[985],{"type":404,"value":986},"  // This will change any packages using baz@x.x.x to use baz@1.2.3\n",{"type":398,"tag":475,"props":988,"children":990},{"class":477,"line":989},13,[991,995,999,1003,1007,1011,1015,1020,1025],{"type":398,"tag":475,"props":992,"children":993},{"style":721},[994],{"type":404,"value":724},{"type":398,"tag":475,"props":996,"children":997},{"style":727},[998],{"type":404,"value":730},{"type":398,"tag":475,"props":1000,"children":1001},{"style":733},[1002],{"type":404,"value":686},{"type":398,"tag":475,"props":1004,"children":1005},{"style":677},[1006],{"type":404,"value":740},{"type":398,"tag":475,"props":1008,"children":1009},{"style":733},[1010],{"type":404,"value":848},{"type":398,"tag":475,"props":1012,"children":1013},{"style":677},[1014],{"type":404,"value":740},{"type":398,"tag":475,"props":1016,"children":1017},{"style":733},[1018],{"type":404,"value":1019},"baz",{"type":398,"tag":475,"props":1021,"children":1022},{"style":727},[1023],{"type":404,"value":1024},") ",{"type":398,"tag":475,"props":1026,"children":1027},{"style":677},[1028],{"type":404,"value":823},{"type":398,"tag":475,"props":1030,"children":1032},{"class":477,"line":1031},14,[1033,1037,1041,1045,1049,1053,1057,1061,1066,1070],{"type":398,"tag":475,"props":1034,"children":1035},{"style":733},[1036],{"type":404,"value":839},{"type":398,"tag":475,"props":1038,"children":1039},{"style":677},[1040],{"type":404,"value":740},{"type":398,"tag":475,"props":1042,"children":1043},{"style":733},[1044],{"type":404,"value":848},{"type":398,"tag":475,"props":1046,"children":1047},{"style":677},[1048],{"type":404,"value":740},{"type":398,"tag":475,"props":1050,"children":1051},{"style":733},[1052],{"type":404,"value":1019},{"type":398,"tag":475,"props":1054,"children":1055},{"style":748},[1056],{"type":404,"value":853},{"type":398,"tag":475,"props":1058,"children":1059},{"style":754},[1060],{"type":404,"value":757},{"type":398,"tag":475,"props":1062,"children":1063},{"style":760},[1064],{"type":404,"value":1065},"1.2.3",{"type":398,"tag":475,"props":1067,"children":1068},{"style":754},[1069],{"type":404,"value":768},{"type":398,"tag":475,"props":1071,"children":1072},{"style":677},[1073],{"type":404,"value":1074},";\n",{"type":398,"tag":475,"props":1076,"children":1078},{"class":477,"line":1077},15,[1079],{"type":398,"tag":475,"props":1080,"children":1081},{"style":677},[1082],{"type":404,"value":968},{"type":398,"tag":475,"props":1084,"children":1086},{"class":477,"line":1085},16,[1087],{"type":398,"tag":475,"props":1088,"children":1089},{"style":727},[1090],{"type":404,"value":977},{"type":398,"tag":475,"props":1092,"children":1094},{"class":477,"line":1093},17,[1095,1100],{"type":398,"tag":475,"props":1096,"children":1097},{"style":721},[1098],{"type":404,"value":1099},"  return",{"type":398,"tag":475,"props":1101,"children":1102},{"style":733},[1103],{"type":404,"value":1104}," pkg\n",{"type":398,"tag":475,"props":1106,"children":1108},{"class":477,"line":1107},18,[1109],{"type":398,"tag":475,"props":1110,"children":1111},{"style":677},[1112],{"type":404,"value":1113},"}\n",{"type":398,"tag":475,"props":1115,"children":1117},{"class":477,"line":1116},19,[1118],{"type":398,"tag":475,"props":1119,"children":1120},{"emptyLinePlaceholder":390},[1121],{"type":404,"value":1122},"\n",{"type":398,"tag":475,"props":1124,"children":1126},{"class":477,"line":1125},20,[1127,1133,1137,1142,1146],{"type":398,"tag":475,"props":1128,"children":1130},{"style":1129},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#66D9EF;--shiki-light-font-style:inherit;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[1131],{"type":404,"value":1132},"module",{"type":398,"tag":475,"props":1134,"children":1135},{"style":677},[1136],{"type":404,"value":740},{"type":398,"tag":475,"props":1138,"children":1139},{"style":1129},[1140],{"type":404,"value":1141},"exports",{"type":398,"tag":475,"props":1143,"children":1144},{"style":748},[1145],{"type":404,"value":853},{"type":398,"tag":475,"props":1147,"children":1148},{"style":677},[1149],{"type":404,"value":706},{"type":398,"tag":475,"props":1151,"children":1153},{"class":477,"line":1152},21,[1154,1159,1163],{"type":398,"tag":475,"props":1155,"children":1156},{"style":727},[1157],{"type":404,"value":1158},"  hooks",{"type":398,"tag":475,"props":1160,"children":1161},{"style":677},[1162],{"type":404,"value":896},{"type":398,"tag":475,"props":1164,"children":1165},{"style":677},[1166],{"type":404,"value":706},{"type":398,"tag":475,"props":1168,"children":1170},{"class":477,"line":1169},22,[1171],{"type":398,"tag":475,"props":1172,"children":1173},{"style":733},[1174],{"type":404,"value":1175},"    readPackage\n",{"type":398,"tag":475,"props":1177,"children":1179},{"class":477,"line":1178},23,[1180],{"type":398,"tag":475,"props":1181,"children":1182},{"style":677},[1183],{"type":404,"value":968},{"type":398,"tag":475,"props":1185,"children":1187},{"class":477,"line":1186},24,[1188],{"type":398,"tag":475,"props":1189,"children":1190},{"style":677},[1191],{"type":404,"value":1113},{"type":398,"tag":414,"props":1193,"children":1194},{},[1195,1197],{"type":404,"value":1196},"见：",{"type":398,"tag":1198,"props":1199,"children":1203},"a",{"href":1200,"rel":1201},"https://pnpm.io/pnpmfile",[1202],"nofollow",[1204],{"type":404,"value":1205},"pnpmfile",{"type":398,"tag":399,"props":1207,"children":1209},{"id":1208},"原理",[1210],{"type":404,"value":1208},{"type":398,"tag":407,"props":1212,"children":1214},{"id":1213},"显著的优点",[1215],{"type":404,"value":1216},"显著的优点？",{"type":398,"tag":542,"props":1218,"children":1219},{},[1220,1225,1230,1243],{"type":398,"tag":546,"props":1221,"children":1222},{},[1223],{"type":404,"value":1224},"省磁盘空间，使用软硬链接和符号链接节约空间。",{"type":398,"tag":546,"props":1226,"children":1227},{},[1228],{"type":404,"value":1229},"安装依赖快，因为处理链接要比处理文件快，并且每个包的解析、下载和写入磁盘这三个阶段是分离的。",{"type":398,"tag":546,"props":1231,"children":1232},{},[1233,1235,1241],{"type":404,"value":1234},"内建支持 monorepo，所有命令支持 ",{"type":398,"tag":420,"props":1236,"children":1238},{"className":1237},[],[1239],{"type":404,"value":1240},"--filter",{"type":404,"value":1242}," 过滤包。",{"type":398,"tag":546,"props":1244,"children":1245},{},[1246],{"type":404,"value":1247},"依赖严格，避免幽灵依赖和依赖分身问题。",{"type":398,"tag":407,"props":1249,"children":1251},{"id":1250},"依赖的层次结构是怎样的",[1252],{"type":404,"value":1253},"依赖的层次结构是怎样的？",{"type":398,"tag":414,"props":1255,"children":1256},{},[1257,1259,1265,1267,1273,1275,1281,1283,1289,1291,1296,1298,1303,1305,1310,1312,1318,1320,1325,1327,1333],{"type":404,"value":1258},"当项目文件读取 ",{"type":398,"tag":420,"props":1260,"children":1262},{"className":1261},[],[1263],{"type":404,"value":1264},"bar",{"type":404,"value":1266}," 时，直接读取 ",{"type":398,"tag":420,"props":1268,"children":1270},{"className":1269},[],[1271],{"type":404,"value":1272},"node_modules/bar",{"type":404,"value":1274},"，但它其实是 ",{"type":398,"tag":420,"props":1276,"children":1278},{"className":1277},[],[1279],{"type":404,"value":1280},".pnpm",{"type":404,"value":1282}," 文件夹下 ",{"type":398,"tag":420,"props":1284,"children":1286},{"className":1285},[],[1287],{"type":404,"value":1288},"bar/node_modules/bar",{"type":404,"value":1290}," 的一个符号链接。也就是说，他的真实的地址在 ",{"type":398,"tag":420,"props":1292,"children":1294},{"className":1293},[],[1295],{"type":404,"value":1280},{"type":404,"value":1297}," 文件夹下。这样一来，当 ",{"type":398,"tag":420,"props":1299,"children":1301},{"className":1300},[],[1302],{"type":404,"value":1264},{"type":404,"value":1304}," 读取它的依赖的时候（项目的依赖的依赖），会在 ",{"type":398,"tag":420,"props":1306,"children":1308},{"className":1307},[],[1309],{"type":404,"value":1264},{"type":404,"value":1311}," 的上层目录即 ",{"type":398,"tag":420,"props":1313,"children":1315},{"className":1314},[],[1316],{"type":404,"value":1317},"bar/node_modules",{"type":404,"value":1319}," 找到 ",{"type":398,"tag":420,"props":1321,"children":1323},{"className":1322},[],[1324],{"type":404,"value":763},{"type":404,"value":1326}," 这个依赖。项目文件没法读取 ",{"type":398,"tag":420,"props":1328,"children":1330},{"className":1329},[],[1331],{"type":404,"value":1332},"bar/node_modules/foo",{"type":404,"value":1334}," 所以避免了幽灵依赖问题。",{"type":398,"tag":414,"props":1336,"children":1337},{},[1338,1343,1345,1351,1353,1358,1360,1366],{"type":398,"tag":420,"props":1339,"children":1341},{"className":1340},[],[1342],{"type":404,"value":1332},{"type":404,"value":1344}," 要怎么找到它的依赖呢？它的真实地址在项目 ·（和官网的图有出入），所以 foo 也只能读取它自己的子依赖，即 ",{"type":398,"tag":420,"props":1346,"children":1348},{"className":1347},[],[1349],{"type":404,"value":1350},"node_modules/.pnpm/foo/node_modules",{"type":404,"value":1352},"。如果有依赖依赖了同一份（同一版本）的 ",{"type":398,"tag":420,"props":1354,"children":1356},{"className":1355},[],[1357],{"type":404,"value":763},{"type":404,"value":1359},"，那么它们的真实地址都是一样的 ",{"type":398,"tag":420,"props":1361,"children":1363},{"className":1362},[],[1364],{"type":404,"value":1365},"node_modules/.pnpm/foo/node_modules/foo",{"type":404,"value":1367},"，这样就避免依赖分身问题。",{"type":398,"tag":414,"props":1369,"children":1370},{},[1371],{"type":398,"tag":1372,"props":1373,"children":1376},"img",{"alt":1374,"src":1375},"Modules Mapping in pnpm","https://mgear-image.oss-cn-shanghai.aliyuncs.com/image/other/20220317192927.png",[],{"type":398,"tag":414,"props":1378,"children":1379},{},[1380,1381,1388,1390],{"type":404,"value":1196},{"type":398,"tag":1198,"props":1382,"children":1385},{"href":1383,"rel":1384},"https://pnpm.io/blog/2020/05/27/flat-node-modules-is-not-the-only-way",[1202],[1386],{"type":404,"value":1387},"Flat node_modules is not the only way | @pnpm",{"type":404,"value":1389},"、",{"type":398,"tag":1198,"props":1391,"children":1394},{"href":1392,"rel":1393},"https://pnpm.io/symlinked-node-modules-structure",[1202],[1395],{"type":404,"value":1396},"Symlinked node_modules structure | @pnpm",{"type":398,"tag":407,"props":1398,"children":1400},{"id":1399},"如何处理同级依赖",[1401],{"type":404,"value":1402},"如何处理同级依赖？",{"type":398,"tag":414,"props":1404,"children":1405},{},[1406,1408,1414,1416,1422,1424,1430,1432,1438,1440,1446,1447,1453],{"type":404,"value":1407},"当项目的两个包 A、B 依赖依赖了同一版本的 C，但是却安装了不同版本的 C 的同级依赖 D@1.0 和 D@1.1，这时，A 依赖的 C 的真实地址是 ",{"type":398,"tag":420,"props":1409,"children":1411},{"className":1410},[],[1412],{"type":404,"value":1413},".pnpm/C_D@1.0/node_modules/C",{"type":404,"value":1415},"，B 依赖的 C 的真实地址是 ",{"type":398,"tag":420,"props":1417,"children":1419},{"className":1418},[],[1420],{"type":404,"value":1421},".pnpm/C_D@1.1/node_modules/C",{"type":404,"value":1423},"。这样一来，两个 C 在读取其同级依赖时，分别读取了 ",{"type":398,"tag":420,"props":1425,"children":1427},{"className":1426},[],[1428],{"type":404,"value":1429},".pnpm/C_D@1.0/node_modules/D",{"type":404,"value":1431}," 和 ",{"type":398,"tag":420,"props":1433,"children":1435},{"className":1434},[],[1436],{"type":404,"value":1437},".pnpm/C_D@1.1/node_modules/D@1.0",{"type":404,"value":1439},"，分别对应真实地址 ",{"type":398,"tag":420,"props":1441,"children":1443},{"className":1442},[],[1444],{"type":404,"value":1445},".pnpm/D@1.0/node_modules/D",{"type":404,"value":1431},{"type":398,"tag":420,"props":1448,"children":1450},{"className":1449},[],[1451],{"type":404,"value":1452},".pnpm/D@1.1/node_modules/D",{"type":404,"value":1454},"。",{"type":398,"tag":414,"props":1456,"children":1457},{},[1458,1460,1466,1467,1473,1475,1481,1482,1487,1489,1495],{"type":404,"value":1459},"当同级依赖的深度增加时，层级结构也随之变得复杂。如果某个依赖 A 依赖了同一个 B，但是 B 子依赖 C 的版本不同（C@1.0 和 C@1.1），这样就创造出了指数级增长的软链数量。为了保证 B 能分别访问两个 C，B 的符号链接的被链接地址会有 ",{"type":398,"tag":420,"props":1461,"children":1463},{"className":1462},[],[1464],{"type":404,"value":1465},".pnpm/B_C@1.0/node_modules/B",{"type":404,"value":1431},{"type":398,"tag":420,"props":1468,"children":1470},{"className":1469},[],[1471],{"type":404,"value":1472},".pnpm/B_C@1.1/node_modules/B",{"type":404,"value":1474},"，而为此，A 的被链接地址也会有两个，",{"type":398,"tag":420,"props":1476,"children":1478},{"className":1477},[],[1479],{"type":404,"value":1480},".pnpm/A_C@1.0/node_modules/A",{"type":404,"value":1431},{"type":398,"tag":420,"props":1483,"children":1485},{"className":1484},[],[1486],{"type":404,"value":1480},{"type":404,"value":1488},"。从不同的 A 的被链接地址的上级目录 ",{"type":398,"tag":420,"props":1490,"children":1492},{"className":1491},[],[1493],{"type":404,"value":1494},"node_modules",{"type":404,"value":1496}," 可以读取到不同的 B 的被链目录，从不同的 B 可以读取到不同的 C。",{"type":398,"tag":466,"props":1498,"children":1500},{"code":1499,"language":404,"meta":391,"className":469,"style":391},"node_modules\n└── .pnpm\n    ├── a@1.0.0_c@1.0.0\n    │   └── node_modules\n    │       ├── a\n    │       └── b -> ../../b@1.0.0_c@1.0.0/node_modules/b\n    ├── a@1.0.0_c@1.1.0\n    │   └── node_modules\n    │       ├── a\n    │       └── b -> ../../b@1.0.0_c@1.1.0/node_modules/b\n    ├── b@1.0.0_c@1.0.0\n    │   └── node_modules\n    │       ├── b\n    │       └── c -> ../../c@1.0.0/node_modules/c\n    ├── b@1.0.0_c@1.1.0\n    │   └── node_modules\n    │       ├── b\n    │       └── c -> ../../c@1.1.0/node_modules/c\n    ├── c@1.0.0\n    ├── c@1.1.0\n",[1501],{"type":398,"tag":420,"props":1502,"children":1503},{"__ignoreMap":391},[1504,1512,1520,1528,1536,1544,1552,1560,1567,1574,1582,1590,1597,1605,1613,1621,1628,1635,1643,1651],{"type":398,"tag":475,"props":1505,"children":1506},{"class":477,"line":478},[1507],{"type":398,"tag":475,"props":1508,"children":1509},{},[1510],{"type":404,"value":1511},"node_modules\n",{"type":398,"tag":475,"props":1513,"children":1514},{"class":477,"line":487},[1515],{"type":398,"tag":475,"props":1516,"children":1517},{},[1518],{"type":404,"value":1519},"└── .pnpm\n",{"type":398,"tag":475,"props":1521,"children":1522},{"class":477,"line":496},[1523],{"type":398,"tag":475,"props":1524,"children":1525},{},[1526],{"type":404,"value":1527},"    ├── a@1.0.0_c@1.0.0\n",{"type":398,"tag":475,"props":1529,"children":1530},{"class":477,"line":505},[1531],{"type":398,"tag":475,"props":1532,"children":1533},{},[1534],{"type":404,"value":1535},"    │   └── node_modules\n",{"type":398,"tag":475,"props":1537,"children":1538},{"class":477,"line":514},[1539],{"type":398,"tag":475,"props":1540,"children":1541},{},[1542],{"type":404,"value":1543},"    │       ├── a\n",{"type":398,"tag":475,"props":1545,"children":1546},{"class":477,"line":523},[1547],{"type":398,"tag":475,"props":1548,"children":1549},{},[1550],{"type":404,"value":1551},"    │       └── b -> ../../b@1.0.0_c@1.0.0/node_modules/b\n",{"type":398,"tag":475,"props":1553,"children":1554},{"class":477,"line":885},[1555],{"type":398,"tag":475,"props":1556,"children":1557},{},[1558],{"type":404,"value":1559},"    ├── a@1.0.0_c@1.1.0\n",{"type":398,"tag":475,"props":1561,"children":1562},{"class":477,"line":913},[1563],{"type":398,"tag":475,"props":1564,"children":1565},{},[1566],{"type":404,"value":1535},{"type":398,"tag":475,"props":1568,"children":1569},{"class":477,"line":922},[1570],{"type":398,"tag":475,"props":1571,"children":1572},{},[1573],{"type":404,"value":1543},{"type":398,"tag":475,"props":1575,"children":1576},{"class":477,"line":962},[1577],{"type":398,"tag":475,"props":1578,"children":1579},{},[1580],{"type":404,"value":1581},"    │       └── b -> ../../b@1.0.0_c@1.1.0/node_modules/b\n",{"type":398,"tag":475,"props":1583,"children":1584},{"class":477,"line":971},[1585],{"type":398,"tag":475,"props":1586,"children":1587},{},[1588],{"type":404,"value":1589},"    ├── b@1.0.0_c@1.0.0\n",{"type":398,"tag":475,"props":1591,"children":1592},{"class":477,"line":980},[1593],{"type":398,"tag":475,"props":1594,"children":1595},{},[1596],{"type":404,"value":1535},{"type":398,"tag":475,"props":1598,"children":1599},{"class":477,"line":989},[1600],{"type":398,"tag":475,"props":1601,"children":1602},{},[1603],{"type":404,"value":1604},"    │       ├── b\n",{"type":398,"tag":475,"props":1606,"children":1607},{"class":477,"line":1031},[1608],{"type":398,"tag":475,"props":1609,"children":1610},{},[1611],{"type":404,"value":1612},"    │       └── c -> ../../c@1.0.0/node_modules/c\n",{"type":398,"tag":475,"props":1614,"children":1615},{"class":477,"line":1077},[1616],{"type":398,"tag":475,"props":1617,"children":1618},{},[1619],{"type":404,"value":1620},"    ├── b@1.0.0_c@1.1.0\n",{"type":398,"tag":475,"props":1622,"children":1623},{"class":477,"line":1085},[1624],{"type":398,"tag":475,"props":1625,"children":1626},{},[1627],{"type":404,"value":1535},{"type":398,"tag":475,"props":1629,"children":1630},{"class":477,"line":1093},[1631],{"type":398,"tag":475,"props":1632,"children":1633},{},[1634],{"type":404,"value":1604},{"type":398,"tag":475,"props":1636,"children":1637},{"class":477,"line":1107},[1638],{"type":398,"tag":475,"props":1639,"children":1640},{},[1641],{"type":404,"value":1642},"    │       └── c -> ../../c@1.1.0/node_modules/c\n",{"type":398,"tag":475,"props":1644,"children":1645},{"class":477,"line":1116},[1646],{"type":398,"tag":475,"props":1647,"children":1648},{},[1649],{"type":404,"value":1650},"    ├── c@1.0.0\n",{"type":398,"tag":475,"props":1652,"children":1653},{"class":477,"line":1125},[1654],{"type":398,"tag":475,"props":1655,"children":1656},{},[1657],{"type":404,"value":1658},"    ├── c@1.1.0\n",{"type":398,"tag":414,"props":1660,"children":1661},{},[1662,1663],{"type":404,"value":1196},{"type":398,"tag":1198,"props":1664,"children":1667},{"href":1665,"rel":1666},"https://pnpm.io/how-peers-are-resolved",[1202],[1668],{"type":404,"value":1669},"How peers are resolved | @pnpm",{"type":398,"tag":407,"props":1671,"children":1673},{"id":1672},"怎样兼容-nodejs-模块加载顺序",[1674],{"type":404,"value":1675},"怎样兼容 NodeJS 模块加载顺序？",{"type":398,"tag":414,"props":1677,"children":1678},{},[1679],{"type":404,"value":1680},"不论系统自带的模块，NodeJS 加载模块的顺序是这样的：",{"type":398,"tag":542,"props":1682,"children":1683},{},[1684,1689,1694,1699],{"type":398,"tag":546,"props":1685,"children":1686},{},[1687],{"type":404,"value":1688},"读取本文件夹中 node_modules 中对应名字的文件夹的 package.json，并寻找 main 字段对应的路径",{"type":398,"tag":546,"props":1690,"children":1691},{},[1692],{"type":404,"value":1693},"读取本文件夹中 node_modules 中对应名字的 js 文件",{"type":398,"tag":546,"props":1695,"children":1696},{},[1697],{"type":404,"value":1698},"读取本文件夹中 node_modules 中对应名字文件夹中的 index.js 文件",{"type":398,"tag":546,"props":1700,"children":1701},{},[1702],{"type":404,"value":1703},"跳出本文件夹，继续前三个步骤",{"type":398,"tag":414,"props":1705,"children":1706},{},[1707,1709,1714,1716,1722,1724,1730,1732,1737,1739,1745,1747,1753],{"type":404,"value":1708},"因为项目 ",{"type":398,"tag":420,"props":1710,"children":1712},{"className":1711},[],[1713],{"type":404,"value":1272},{"type":404,"value":1715}," 是 ",{"type":398,"tag":420,"props":1717,"children":1719},{"className":1718},[],[1720],{"type":404,"value":1721},".pnpm/bar/node_modules/bar",{"type":404,"value":1723}," 的符号链接，所以项目文件可以直接读取 ",{"type":398,"tag":420,"props":1725,"children":1727},{"className":1726},[],[1728],{"type":404,"value":1729},"node_modules/bar/x.js",{"type":404,"value":1731},"。同时，如果 ",{"type":398,"tag":420,"props":1733,"children":1735},{"className":1734},[],[1736],{"type":404,"value":1729},{"type":404,"value":1738}," 需要加载 ",{"type":398,"tag":420,"props":1740,"children":1742},{"className":1741},[],[1743],{"type":404,"value":1744},"foo/x.js",{"type":404,"value":1746},"，那么在上述步骤的第 4 步，就能找到 ",{"type":398,"tag":420,"props":1748,"children":1750},{"className":1749},[],[1751],{"type":404,"value":1752},".pnpm/bar/node_modules/foo/x.js",{"type":404,"value":1754}," 文件。",{"type":398,"tag":407,"props":1756,"children":1758},{"id":1757},"为什么其模块层次只是比较严格的semistrict",[1759],{"type":404,"value":1760},"为什么其模块层次只是“比较严格的”（semistrict）？",{"type":398,"tag":414,"props":1762,"children":1763},{},[1764],{"type":404,"value":1765},"由 NodeJS 模块加载规则可知，在 pnpm 创造的依赖层次下，一个依赖的子依赖间仍有相互访问的能力。",{"type":398,"tag":407,"props":1767,"children":1769},{"id":1768},"为什么能节约磁盘空间",[1770],{"type":404,"value":1771},"为什么能节约磁盘空间？",{"type":398,"tag":414,"props":1773,"children":1774},{},[1775,1777,1783,1785,1791,1793,1799],{"type":404,"value":1776},"由 pnpm 创造的 node_modules 层级结构可以知道，所有依赖的符号链接的真实地址都在 ",{"type":398,"tag":420,"props":1778,"children":1780},{"className":1779},[],[1781],{"type":404,"value":1782},".pnpm/package-name/node_modules/package-name",{"type":404,"value":1784}," 这个文件夹中。这种文件夹会通过硬链接的形式链接到 ",{"type":398,"tag":420,"props":1786,"children":1788},{"className":1787},[],[1789],{"type":404,"value":1790},"user-document/.pnpm-store",{"type":404,"value":1792}," 中，所以相同的包只会存一份，也就是 ",{"type":398,"tag":420,"props":1794,"children":1796},{"className":1795},[],[1797],{"type":404,"value":1798},".pnpm-store/package-name",{"type":404,"value":1454},{"type":398,"tag":407,"props":1801,"children":1803},{"id":1802},"软硬链接有什么问题",[1804],{"type":404,"value":1805},"软硬链接有什么问题？",{"type":398,"tag":1807,"props":1808,"children":1809},"ul",{},[1810,1815,1820,1825],{"type":398,"tag":546,"props":1811,"children":1812},{},[1813],{"type":404,"value":1814},"特定的软链结构会导致某些应用出现死循环",{"type":398,"tag":546,"props":1816,"children":1817},{},[1818],{"type":404,"value":1819},"硬链接是同一份文件，不便调试",{"type":398,"tag":546,"props":1821,"children":1822},{},[1823],{"type":404,"value":1824},"软链接在非 SSD 上的读写会有性能损耗",{"type":398,"tag":546,"props":1826,"children":1827},{},[1828],{"type":404,"value":1829},"pnpm 创造的 node_modules 层级结构会破坏某些依赖依赖了相对路径的依赖的逻辑",{"type":398,"tag":414,"props":1831,"children":1832},{},[1833,1834],{"type":404,"value":1196},{"type":398,"tag":1198,"props":1835,"children":1838},{"href":1836,"rel":1837},"https://zhuanlan.zhihu.com/p/553804414",[1202],[1839],{"type":404,"value":1840},"精读 pnpm",{"type":398,"tag":399,"props":1842,"children":1844},{"id":1843},"常见问题",[1845],{"type":404,"value":1843},{"type":398,"tag":407,"props":1847,"children":1849},{"id":1848},"pnpm-找不到全局路径的解决方法",[1850],{"type":404,"value":1851},"PNPM 找不到全局路径的解决方法？",{"type":398,"tag":414,"props":1853,"children":1854},{},[1855],{"type":404,"value":1856},"尽管设置了全局变量，也重新安装了最新版本 PNPM，也执行了 pnpm setup，却仍然报错找不到全局路径的临时解决方案：",{"type":398,"tag":466,"props":1858,"children":1862},{"code":1859,"language":1860,"meta":391,"className":1861,"style":391},"$PNPM_HOME=\"\u003Cpath>\" | pnpm install -g xxx\n","powershell","language-powershell shiki shiki-themes material-theme-lighter github-light github-dark monokai",[1863],{"type":398,"tag":420,"props":1864,"children":1865},{"__ignoreMap":391},[1866],{"type":398,"tag":475,"props":1867,"children":1868},{"class":477,"line":478},[1869,1874,1879,1884,1889,1894,1898,1903,1908,1913],{"type":398,"tag":475,"props":1870,"children":1871},{"style":677},[1872],{"type":404,"value":1873},"$",{"type":398,"tag":475,"props":1875,"children":1876},{"style":733},[1877],{"type":404,"value":1878},"PNPM_HOME",{"type":398,"tag":475,"props":1880,"children":1881},{"style":748},[1882],{"type":404,"value":1883},"=",{"type":398,"tag":475,"props":1885,"children":1886},{"style":754},[1887],{"type":404,"value":1888},"\"",{"type":398,"tag":475,"props":1890,"children":1891},{"style":760},[1892],{"type":404,"value":1893},"\u003Cpath>",{"type":398,"tag":475,"props":1895,"children":1896},{"style":754},[1897],{"type":404,"value":1888},{"type":398,"tag":475,"props":1899,"children":1900},{"style":748},[1901],{"type":404,"value":1902}," |",{"type":398,"tag":475,"props":1904,"children":1905},{"style":733},[1906],{"type":404,"value":1907}," pnpm install ",{"type":398,"tag":475,"props":1909,"children":1910},{"style":748},[1911],{"type":404,"value":1912},"-",{"type":398,"tag":475,"props":1914,"children":1915},{"style":733},[1916],{"type":404,"value":1917},"g xxx\n",{"type":398,"tag":407,"props":1919,"children":1921},{"id":1920},"pnpm-速度变慢了",[1922],{"type":404,"value":1923},"PNPM 速度变慢了？",{"type":398,"tag":414,"props":1925,"children":1926},{},[1927],{"type":404,"value":1928},"今天逛官网时，偶然发现 Readme 中的 benchmark 过时了。它说“要比 Yarn Classic 和 npm “快两倍以上，但是从 benchmark 来看，他要比 Yarn 和 npm 慢了不少。以后启用 NodeJS 20 以上时，如果问题得不到改善，我应该会重新选择 npm 而不是 pnpm，鉴于幽灵依赖和依赖分身带来的问题是可排查可解决的，而速度是解决不了的问题。",{"type":398,"tag":414,"props":1930,"children":1931},{},[1932],{"type":398,"tag":1372,"props":1933,"children":1936},{"alt":1934,"src":1935},"pnpm vs npm vs yarn benchmark","https://mgear-image.oss-cn-shanghai.aliyuncs.com/image/other/20230605235736.png",[],{"type":398,"tag":414,"props":1938,"children":1939},{},[1940,1942],{"type":404,"value":1941},"相关见：",{"type":398,"tag":1198,"props":1943,"children":1946},{"href":1944,"rel":1945},"https://github.com/pnpm/pnpm/issues/6447",[1202],[1947],{"type":404,"value":1948},"pnpm seems to be consistently slower than yarn (classic)",{"type":398,"tag":407,"props":1950,"children":1952},{"id":1951},"和-bun-在安装速度上的对比",[1953],{"type":404,"value":1954},"和 Bun 在安装速度上的对比？",{"type":398,"tag":414,"props":1956,"children":1957},{},[1958],{"type":404,"value":1959},"有锁文件、本地缓存，无 node_modules 的情况下，bun 要比 pnpm 安装至少快 3 倍。",{"type":398,"tag":1807,"props":1961,"children":1962},{},[1963,1968],{"type":398,"tag":546,"props":1964,"children":1965},{},[1966],{"type":404,"value":1967},"一个原因是 pnpm、yarn 等工具会在安装时请求最新的 metadata，而 bun 使用的 metadata 源于本地缓存的 metadata。",{"type":398,"tag":546,"props":1969,"children":1970},{},[1971],{"type":404,"value":1972},"另一个原因是 pnpm 在创建 node_modules 层次结构是使用了大量的 symlink，相比其他包管理工具仅使用复制或 hardlink 有更多系统调用。",{"type":398,"tag":414,"props":1974,"children":1975},{},[1976],{"type":404,"value":1977},"所以如果想使 pnpm 更快的安装，可以使用 prefer-offline 选项，以及，node-linker=hoisted 也许有用。",{"type":398,"tag":414,"props":1979,"children":1980},{},[1981,1982],{"type":404,"value":1196},{"type":398,"tag":1198,"props":1983,"children":1986},{"href":1984,"rel":1985},"https://github.com/pnpm/pnpm/issues/7391",[1202],[1987],{"type":404,"value":1988},"Bun.sh-like Module Resolution",{"type":398,"tag":407,"props":1990,"children":1992},{"id":1991},"关于-v8-版本的变化",[1993],{"type":404,"value":1994},"关于 V8 版本的变化？",{"type":398,"tag":1807,"props":1996,"children":1997},{},[1998,2017,2033,2044,2049,2054,2059],{"type":398,"tag":546,"props":1999,"children":2000},{},[2001,2007,2009,2015],{"type":398,"tag":420,"props":2002,"children":2004},{"className":2003},[],[2005],{"type":404,"value":2006},"resolve-peers-from-workspace-root",{"type":404,"value":2008}," is ",{"type":398,"tag":420,"props":2010,"children":2012},{"className":2011},[],[2013],{"type":404,"value":2014},"true",{"type":404,"value":2016}," by default",{"type":398,"tag":546,"props":2018,"children":2019},{},[2020,2026,2027,2032],{"type":398,"tag":420,"props":2021,"children":2023},{"className":2022},[],[2024],{"type":404,"value":2025},"auto-install-peers",{"type":404,"value":2008},{"type":398,"tag":420,"props":2028,"children":2030},{"className":2029},[],[2031],{"type":404,"value":2014},{"type":404,"value":2016},{"type":398,"tag":546,"props":2034,"children":2035},{},[2036,2042],{"type":398,"tag":420,"props":2037,"children":2039},{"className":2038},[],[2040],{"type":404,"value":2041},"dedupe-peer-dependents",{"type":404,"value":2043}," set to true by default",{"type":398,"tag":546,"props":2045,"children":2046},{},[2047],{"type":404,"value":2048},"停止 NodeJS 14 的支持",{"type":398,"tag":546,"props":2050,"children":2051},{},[2052],{"type":404,"value":2053},"lockfile v6 by default",{"type":398,"tag":546,"props":2055,"children":2056},{},[2057],{"type":404,"value":2058},"resolution mode（prebundle、time-based、lowest-direct）default set to lowest-based，需要注意手动升级，尤其是在没有锁文件的情况",{"type":398,"tag":546,"props":2060,"children":2061},{},[2062,2064,2070],{"type":404,"value":2063},"only deply ",{"type":398,"tag":420,"props":2065,"children":2067},{"className":2066},[],[2068],{"type":404,"value":2069},"files",{"type":404,"value":2071}," field when the field exist",{"type":398,"tag":407,"props":2073,"children":2075},{"id":2074},"pnp-模式下的依赖提升设置",[2076],{"type":404,"value":2077},"PnP 模式下的依赖提升设置？",{"type":398,"tag":414,"props":2079,"children":2080},{},[2081,2083,2089],{"type":404,"value":2082},"默认的 node_modules 依赖的层级处于严格和不严格之间的水平（semi-strict）。使用最严格的设置需要打开 PnP 模式，因为在 monorepo 中 PnP 模式中，就算开启了 ",{"type":398,"tag":420,"props":2084,"children":2086},{"className":2085},[],[2087],{"type":404,"value":2088},"hoist=false",{"type":404,"value":2090}," 也不会禁用 workspace root 的依赖",{"type":398,"tag":466,"props":2092,"children":2094},{"code":2093},"node-linker=pnp\nsymlink=false\n",[2095],{"type":398,"tag":420,"props":2096,"children":2097},{"__ignoreMap":391},[2098],{"type":404,"value":2093},{"type":398,"tag":414,"props":2100,"children":2101},{},[2102,2103],{"type":404,"value":1196},{"type":398,"tag":1198,"props":2104,"children":2107},{"href":2105,"rel":2106},"https://pnpm.io/blog/2020/10/17/node-modules-configuration-options-with-pnpm",[1202],[2108],{"type":404,"value":2109},"Node-Modules configuration options with pnpm",{"type":398,"tag":407,"props":2111,"children":2113},{"id":2112},"在-windows-dev-driver-上可能会碰到的问题",[2114],{"type":404,"value":2115},"在 Windows Dev Driver 上可能会碰到的问题？",{"type":398,"tag":414,"props":2117,"children":2118},{},[2119],{"type":404,"value":2120},"2024 年初 pnpm 实现了 Dev Driver 上的 Copy on Write 功能，但可能会碰到变慢的问题。",{"type":398,"tag":414,"props":2122,"children":2123},{},[2124,2125],{"type":404,"value":1196},{"type":398,"tag":1198,"props":2126,"children":2129},{"href":2127,"rel":2128},"https://github.com/pnpm/pnpm/issues/7547",[1202],[2130],{"type":404,"value":2131},"pnpm lately slow and pnpx stuck at installing deps using executable package",{"type":398,"tag":2133,"props":2134,"children":2135},"style",{},[2136],{"type":404,"value":2137},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":391,"searchDepth":487,"depth":487,"links":2139},[2140,2141,2142],{"id":401,"depth":487,"text":405},{"id":1208,"depth":487,"text":1208},{"id":1843,"depth":487,"text":1843},"markdown","content:6.maps:_workflow:package-manager:pnpm.md","content","6.maps/_workflow/package-manager/pnpm.md","md",[2149,2152],{"_path":2150,"title":2151,"description":391},"/maps/_workflow/package-manager/npm","NPM",{"_path":2153,"title":2154,"description":391},"/maps/_workflow/packer","打包工具",1710257744838]