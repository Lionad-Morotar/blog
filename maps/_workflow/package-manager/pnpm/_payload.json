[{"data":1,"prerenderedAt":2180},["ShallowReactive",2],{"navigation":3,"/maps/_workflow/package-manager/pnpm":410,"/maps/_workflow/package-manager/pnpm-surround":2173},[4,32,83,102,129,135,141,147,393,399,405],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🌃 长夜梦","/flows/long-night-dream",{"title":15,"_path":16},"🌌 万物联结与幸福感","/flows/everything",{"title":18,"_path":19},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":21,"_path":22},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":24,"_path":25},"🌧️ 我的腼腆","/flows/shy",{"title":27,"_path":28},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":30,"_path":31},"📝 心流归档","/flows/fold",{"title":33,"_path":34,"children":35},"技术博客 / Coder","/articles",[36,38,41,44,47,50,53,56,59,62,65,68,71,74,77,80],{"title":37,"_path":34},"🦁 为什么我要写博客",{"title":39,"_path":40},"💻 本地部署 Qwen 翻译网页","/articles/local-translator",{"title":42,"_path":43},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":45,"_path":46},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":48,"_path":49},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":51,"_path":52},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":54,"_path":55},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":57,"_path":58},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":60,"_path":61},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":63,"_path":64},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":66,"_path":67},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":69,"_path":70},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":72,"_path":73},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":75,"_path":76},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":78,"_path":79},"🚝 四十二篇系列","/articles/fourty-two",{"title":81,"_path":82},"📝 技术博客归档","/articles/fold",{"title":84,"_path":85,"children":86},"造物 / Make","/tools",[87,90,93,96,99],{"title":88,"_path":89},"🧶 网易云音乐歌单排序","/tools/netease-sorter",{"title":91,"_path":92},"🌐 AnySort","/tools/anysort",{"title":94,"_path":95},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":97,"_path":98},"👓 Crapto","/tools/crypto-inline",{"title":100,"_path":101},"🖨️ any-to-base64","/tools/any-to-base64",{"title":103,"_path":104,"children":105},"吉他剧场 / Music","/music",[106,108,111,114,117,120,123,126],{"title":107,"_path":104},"🎸 FingerStyle！",{"title":109,"_path":110},"🌬️ 等待的风","/music/wind",{"title":112,"_path":113},"💕 约定的海洋","/music/ocean",{"title":115,"_path":116},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":118,"_path":119},"🌏 残酷天使的行动纲领","/music/eva",{"title":121,"_path":122},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":124,"_path":125},"🍷 Wu Wei","/music/wu-wei",{"title":127,"_path":128},"🌅 无题","/music/untitled",{"title":130,"_path":131,"children":132},"画点什么 / Paint","/paint",[133],{"title":134,"_path":131},"🚧 正在施工",{"title":136,"_path":137,"children":138},"读书笔记 / Notes","/books",[139],{"title":140,"_path":137},"📕 读书笔记",{"title":142,"_path":143,"children":144},"知识地图 / Maps","/maps",[145],{"title":146,"_path":143},"🏁 知识地图",{"title":148,"_path":149,"children":150},"零散的笔记 / Gists","/gists",[151,153,156,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255,258,261,264,267,270,273,276,279,282,285,288,291,294,297,300,303,306,309,312,315,318,321,324,327,330,333,336,339,342,345,348,351,354,357,360,363,366,369,372,375,378,381,384,387,390],{"title":152,"_path":149},"🧊 Gists",{"title":154,"_path":155},"网站的可访问性","/gists/accessibility",{"title":157,"_path":158},"Bit","/gists/bit",{"title":160,"_path":161},"图片模糊","/gists/blur",{"title":163,"_path":164},"渲染相关笔记","/gists/c4d",{"title":166,"_path":167},"CDN 问题记录","/gists/cdn",{"title":169,"_path":170},"消毒剂","/gists/cleaner",{"title":172,"_path":173},"Windows Command","/gists/cmd",{"title":175,"_path":176},"Command","/gists/command",{"title":178,"_path":179},"复杂科学","/gists/complexity-science",{"title":181,"_path":182},"GitHub Copilot","/gists/copilot",{"title":184,"_path":185},"宇宙","/gists/cosmos",{"title":187,"_path":188},"C++","/gists/cpp",{"title":190,"_path":191},"Data Structure","/gists/data-structure",{"title":193,"_path":194},"DEPRESSION","/gists/depression",{"title":196,"_path":197},"设计模式","/gists/design-patterns",{"title":199,"_path":200},"Developer Experience","/gists/developer-experience",{"title":202,"_path":203},"Device Metrics","/gists/device-metrix",{"title":205,"_path":206},"数字化转型","/gists/digital-transformation",{"title":208,"_path":209},"ECMAScript Language Specification","/gists/ecmascript-specification",{"title":211,"_path":212},"正则表达式","/gists/eegex",{"title":214,"_path":215},"Emoji","/gists/emoji",{"title":217,"_path":218},"工程","/gists/engineering",{"title":220,"_path":221},"熵","/gists/entropy",{"title":223,"_path":224},"Environment","/gists/environment",{"title":226,"_path":227},"Erlang","/gists/erlang",{"title":229,"_path":230},"逃离塔克夫","/gists/escape-from-tarkov",{"title":232,"_path":233},"ESNext (ES6-ES11)","/gists/esnext",{"title":235,"_path":236},"Eval！","/gists/eval",{"title":238,"_path":239},"Flutter","/gists/flutter",{"title":241,"_path":242},"字体","/gists/font",{"title":244,"_path":245},"JS 函数式编程","/gists/functional",{"title":247,"_path":248},"游戏化","/gists/gamification",{"title":250,"_path":251},"Google C++ Standard","/gists/google-cpp-standard",{"title":253,"_path":254},"双向链接完全体","/gists/graph",{"title":256,"_path":257},"Hardwares","/gists/hardwares",{"title":259,"_path":260},"哈希冲突","/gists/hash-collision",{"title":262,"_path":263},"信息设计","/gists/information-design",{"title":265,"_path":266},"InstantPage","/gists/instant.page",{"title":268,"_path":269},"ISUX 遇见大数据可视化系列","/gists/isux-data-visualization",{"title":271,"_path":272},"KVStore","/gists/key-value-db",{"title":274,"_path":275},"Kubernetes","/gists/kubernetes",{"title":277,"_path":278},"Makefile","/gists/makefile",{"title":280,"_path":281},"Markdown Inline Style","/gists/markdown-nice",{"title":283,"_path":284},"小程序","/gists/miniapp",{"title":286,"_path":287},"减小页面快照体积","/gists/minify-html",{"title":289,"_path":290},"mklink","/gists/mklink",{"title":292,"_path":293},"Mock","/gists/mock",{"title":295,"_path":296},"多人协作系统","/gists/multiplayer",{"title":298,"_path":299},"多端应用","/gists/multy-end-app",{"title":301,"_path":302},"神经科学","/gists/neuroscience",{"title":304,"_path":305},"OO","/gists/oo",{"title":307,"_path":308},"Opinioned Personal Folder","/gists/opinioned-personal-folder",{"title":310,"_path":311},"PInvoke","/gists/pinvoke",{"title":313,"_path":314},"像素","/gists/pixel",{"title":316,"_path":317},"PowerShell","/gists/powershell",{"title":319,"_path":320},"量子","/gists/quantum",{"title":322,"_path":323},"保持好奇心","/gists/questions",{"title":325,"_path":326},"React Native","/gists/react-native",{"title":328,"_path":329},"博客改版碰到的浏览器平滑滚动问题","/gists/scroll",{"title":331,"_path":332},"SEO","/gists/seo",{"title":334,"_path":335},"Shader","/gists/shader",{"title":337,"_path":338},"Shape Up","/gists/shape-up",{"title":340,"_path":341},"睡觉","/gists/sleep",{"title":343,"_path":344},"记录奇怪的问题","/gists/solved",{"title":346,"_path":347},"States","/gists/states",{"title":349,"_path":350},"Storage","/gists/storage",{"title":352,"_path":353},"音视频流处理","/gists/stream-cli",{"title":355,"_path":356},"Symbol","/gists/symbol",{"title":358,"_path":359},"系统论","/gists/systems-theory",{"title":361,"_path":362},"Taro","/gists/taro",{"title":364,"_path":365},"任务切片","/gists/task-slice",{"title":367,"_path":368},"技术偏好","/gists/tech-dudge",{"title":370,"_path":371},"Untitled","/gists/untitled",{"title":373,"_path":374},"可变字体","/gists/variable-font",{"title":376,"_path":377},"视觉错觉","/gists/visual-illusion",{"title":379,"_path":380},"SS(SSR)","/gists/vpn",{"title":382,"_path":383},"VS Code 插件开发","/gists/vscode-plugin",{"title":385,"_path":386},"Web Components","/gists/web-components",{"title":388,"_path":389},"Windows","/gists/windows",{"title":391,"_path":392},"查缺补漏","/gists/wrong",{"title":394,"_path":395,"children":396},"代码笔记 / Gists","/source-code",[397],{"title":398,"_path":395},"🚄 代码笔记",{"title":400,"_path":401,"children":402},"我 / Abount","/hire",[403],{"title":404,"_path":401},"📬 技术简历",{"title":406,"_path":407,"children":408},"todo","/todo",[409],{"title":406,"_path":407},{"_path":411,"_dir":412,"_draft":413,"_partial":414,"_locale":415,"title":416,"description":417,"body":418,"_type":2167,"_id":2168,"_source":2169,"_file":2170,"_stem":2171,"_extension":2172},"/maps/_workflow/package-manager/pnpm","package-manager",false,true,"","pnpm","pnpm 是一个快速、省空间的包管理器",{"type":419,"children":420,"toc":2162},"root",[421,430,437,451,457,467,472,478,489,554,560,565,619,625,630,635,640,658,664,675,1216,1230,1235,1241,1272,1278,1359,1392,1401,1421,1427,1479,1521,1683,1694,1700,1705,1728,1779,1785,1790,1796,1824,1830,1854,1865,1870,1876,1881,1942,1948,1953,1961,1973,1979,1984,1997,2002,2013,2019,2096,2102,2115,2123,2134,2140,2145,2156],{"type":422,"tag":423,"props":424,"children":426},"element","h2",{"id":425},"api-细节和配置项",[427],{"type":428,"value":429},"text","API 细节和配置项",{"type":422,"tag":431,"props":432,"children":434},"h4",{"id":433},"pnpm-import",[435],{"type":428,"value":436},"pnpm import",{"type":422,"tag":438,"props":439,"children":440},"p",{},[441,443,449],{"type":428,"value":442},"使用 ",{"type":422,"tag":444,"props":445,"children":447},"code",{"className":446},[],[448],{"type":428,"value":436},{"type":428,"value":450}," 可以将 package-lock、npm-shrinkwrap 和 yarn.lock 转换为 pnpm-lock 文件。",{"type":422,"tag":431,"props":452,"children":454},{"id":453},"pnpm-fetch",[455],{"type":428,"value":456},"pnpm fetch",{"type":422,"tag":438,"props":458,"children":459},{},[460,465],{"type":422,"tag":444,"props":461,"children":463},{"className":462},[],[464],{"type":428,"value":456},{"type":428,"value":466}," 它跳过了 package.json 文件，允许项目在只有 pnpm-lock 文件的情况下创建 .pnpm 虚拟仓库。这有利于 docker 构建，因为 package.json 经常因为非依赖变化的改动而改动，导致 docker layer 失效。",{"type":422,"tag":438,"props":468,"children":469},{},[470],{"type":428,"value":471},"相比 yarn 和 npm，在脱离 package.json 的情况下，单靠 package-lock（或 yarn-lock），yarn 和 npm 没有办法确定依赖版本，因为其 package-lock 中，依赖的版本号不是固定版本号。",{"type":422,"tag":431,"props":473,"children":475},{"id":474},"pnpm-why",[476],{"type":428,"value":477},"pnpm why",{"type":422,"tag":438,"props":479,"children":480},{},[481,482,487],{"type":428,"value":442},{"type":422,"tag":444,"props":483,"children":485},{"className":484},[],[486],{"type":428,"value":477},{"type":428,"value":488}," 可以列出项目内依赖了某个依赖的依赖，比如说找到项目内使用了 lodash 的包。",{"type":422,"tag":490,"props":491,"children":494},"pre",{"code":492,"language":428,"meta":415,"className":493,"style":415},"dependencies:\nelement-plus 2.2.20\n├── lodash 4.17.21\n└─┬ lodash-unified 1.0.3\n  └── lodash 4.17.21 peer\n...\n","language-text shiki shiki-themes material-theme-lighter github-light github-dark monokai",[495],{"type":422,"tag":444,"props":496,"children":497},{"__ignoreMap":415},[498,509,518,527,536,545],{"type":422,"tag":499,"props":500,"children":503},"span",{"class":501,"line":502},"line",1,[504],{"type":422,"tag":499,"props":505,"children":506},{},[507],{"type":428,"value":508},"dependencies:\n",{"type":422,"tag":499,"props":510,"children":512},{"class":501,"line":511},2,[513],{"type":422,"tag":499,"props":514,"children":515},{},[516],{"type":428,"value":517},"element-plus 2.2.20\n",{"type":422,"tag":499,"props":519,"children":521},{"class":501,"line":520},3,[522],{"type":422,"tag":499,"props":523,"children":524},{},[525],{"type":428,"value":526},"├── lodash 4.17.21\n",{"type":422,"tag":499,"props":528,"children":530},{"class":501,"line":529},4,[531],{"type":422,"tag":499,"props":532,"children":533},{},[534],{"type":428,"value":535},"└─┬ lodash-unified 1.0.3\n",{"type":422,"tag":499,"props":537,"children":539},{"class":501,"line":538},5,[540],{"type":422,"tag":499,"props":541,"children":542},{},[543],{"type":428,"value":544},"  └── lodash 4.17.21 peer\n",{"type":422,"tag":499,"props":546,"children":548},{"class":501,"line":547},6,[549],{"type":422,"tag":499,"props":550,"children":551},{},[552],{"type":428,"value":553},"...\n",{"type":422,"tag":431,"props":555,"children":557},{"id":556},"pnpm-run",[558],{"type":428,"value":559},"pnpm run",{"type":422,"tag":438,"props":561,"children":562},{},[563],{"type":428,"value":564},"与其它包管理器的一些区别：",{"type":422,"tag":566,"props":567,"children":568},"ol",{},[569,595,600],{"type":422,"tag":570,"props":571,"children":572},"li",{},[573,579,581,587,589],{"type":422,"tag":444,"props":574,"children":576},{"className":575},[],[577],{"type":428,"value":578},"pnpm run script-name",{"type":428,"value":580},"，如果 ",{"type":422,"tag":444,"props":582,"children":584},{"className":583},[],[585],{"type":428,"value":586},"script-name",{"type":428,"value":588}," 没有和 pnpm 内置指令冲突，则可以省略 ",{"type":422,"tag":444,"props":590,"children":592},{"className":591},[],[593],{"type":428,"value":594},"run",{"type":422,"tag":570,"props":596,"children":597},{},[598],{"type":428,"value":599},"run 指令默认不会执行 pre 和 post 钩子函数，因为 pnpm 认为这使任务流更难理解",{"type":422,"tag":570,"props":601,"children":602},{},[603,609,611,617],{"type":422,"tag":444,"props":604,"children":606},{"className":605},[],[607],{"type":428,"value":608},"shell-emulator",{"type":428,"value":610}," 选项启用后，将使用 JS 解析指令，这使得在不兼容 POSIX 的环境执行类似 ",{"type":422,"tag":444,"props":612,"children":614},{"className":613},[],[615],{"type":428,"value":616},"NODE_ENV=test node ./index",{"type":428,"value":618}," 的指令会报错的系统也能正常运行这种指令",{"type":422,"tag":431,"props":620,"children":622},{"id":621},"pnpm-pack",[623],{"type":428,"value":624},"pnpm pack",{"type":422,"tag":438,"props":626,"children":627},{},[628],{"type":428,"value":629},"将项目打包为 tarball 压缩包（.tgz）。打包的文件范围和 pnpm publish 一样。",{"type":422,"tag":431,"props":631,"children":633},{"id":632},"shared-workspace-lockfile",[634],{"type":428,"value":632},{"type":422,"tag":438,"props":636,"children":637},{},[638],{"type":428,"value":639},"在 workspace 间共享一份 package-lock 文件。这个配置开启后，所有子包的依赖都会被提升到 workspace 根目录，这带来了几个好处：",{"type":422,"tag":566,"props":641,"children":642},{},[643,648,653],{"type":422,"tag":570,"props":644,"children":645},{},[646],{"type":428,"value":647},"所有依赖都是单例的",{"type":422,"tag":570,"props":649,"children":650},{},[651],{"type":428,"value":652},"更快的安装速度（相比 pnpm install -r）",{"type":422,"tag":570,"props":654,"children":655},{},[656],{"type":428,"value":657},"修改的文件总数更少，利于 Code Review",{"type":422,"tag":431,"props":659,"children":661},{"id":660},"pnpmfilecjs",[662],{"type":428,"value":663},".pnpmfile.cjs",{"type":422,"tag":438,"props":665,"children":666},{},[667,668,673],{"type":428,"value":442},{"type":422,"tag":444,"props":669,"children":671},{"className":670},[],[672],{"type":428,"value":663},{"type":428,"value":674}," 文件提供的 readPackage 和 afterAllResolved 钩子函数可以分别介入依赖元信息解析（minifest）和依赖安装完准备输出 lock 文件的过程。",{"type":422,"tag":490,"props":676,"children":680},{"code":677,"language":678,"meta":415,"className":679,"style":415},"function readPackage(pkg, context) {\n  // Override the manifest of foo@1.x after downloading it from the registry\n  if (pkg.name === 'foo' && pkg.version.startsWith('1.')) {\n    // Replace bar@x.x.x with bar@2.0.0\n    pkg.dependencies = {\n      ...pkg.dependencies,\n      bar: '^2.0.0'\n    }\n    context.log('bar@1 => bar@2 in dependencies of foo')\n  }\n  \n  // This will change any packages using baz@x.x.x to use baz@1.2.3\n  if (pkg.dependencies.baz) {\n    pkg.dependencies.baz = '1.2.3';\n  }\n  \n  return pkg\n}\n\nmodule.exports = {\n  hooks: {\n    readPackage\n  }\n}\n","js","language-js shiki shiki-themes material-theme-lighter github-light github-dark monokai",[681],{"type":422,"tag":444,"props":682,"children":683},{"__ignoreMap":415},[684,731,740,848,856,882,907,935,944,984,993,1002,1011,1053,1099,1107,1115,1129,1138,1147,1174,1191,1200,1208],{"type":422,"tag":499,"props":685,"children":686},{"class":501,"line":502},[687,693,699,705,711,716,721,726],{"type":422,"tag":499,"props":688,"children":690},{"style":689},"--shiki-light:#9C3EDA;--shiki-light-font-style:inherit;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic",[691],{"type":428,"value":692},"function",{"type":422,"tag":499,"props":694,"children":696},{"style":695},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[697],{"type":428,"value":698}," readPackage",{"type":422,"tag":499,"props":700,"children":702},{"style":701},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[703],{"type":428,"value":704},"(",{"type":422,"tag":499,"props":706,"children":708},{"style":707},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#E36209;--shiki-default-font-style:inherit;--shiki-dark:#FFAB70;--shiki-dark-font-style:inherit;--shiki-sepia:#FD971F;--shiki-sepia-font-style:italic",[709],{"type":428,"value":710},"pkg",{"type":422,"tag":499,"props":712,"children":713},{"style":701},[714],{"type":428,"value":715},",",{"type":422,"tag":499,"props":717,"children":718},{"style":707},[719],{"type":428,"value":720}," context",{"type":422,"tag":499,"props":722,"children":723},{"style":701},[724],{"type":428,"value":725},")",{"type":422,"tag":499,"props":727,"children":728},{"style":701},[729],{"type":428,"value":730}," {\n",{"type":422,"tag":499,"props":732,"children":733},{"class":501,"line":511},[734],{"type":422,"tag":499,"props":735,"children":737},{"style":736},"--shiki-light:#90A4AE;--shiki-light-font-style:italic;--shiki-default:#6A737D;--shiki-default-font-style:inherit;--shiki-dark:#6A737D;--shiki-dark-font-style:inherit;--shiki-sepia:#88846F;--shiki-sepia-font-style:inherit",[738],{"type":428,"value":739},"  // Override the manifest of foo@1.x after downloading it from the registry\n",{"type":422,"tag":499,"props":741,"children":742},{"class":501,"line":520},[743,749,755,760,765,770,776,782,788,793,798,803,807,812,816,821,825,829,834,838,843],{"type":422,"tag":499,"props":744,"children":746},{"style":745},"--shiki-light:#39ADB5;--shiki-light-font-style:italic;--shiki-default:#D73A49;--shiki-default-font-style:inherit;--shiki-dark:#F97583;--shiki-dark-font-style:inherit;--shiki-sepia:#F92672;--shiki-sepia-font-style:inherit",[747],{"type":428,"value":748},"  if",{"type":422,"tag":499,"props":750,"children":752},{"style":751},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[753],{"type":428,"value":754}," (",{"type":422,"tag":499,"props":756,"children":758},{"style":757},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[759],{"type":428,"value":710},{"type":422,"tag":499,"props":761,"children":762},{"style":701},[763],{"type":428,"value":764},".",{"type":422,"tag":499,"props":766,"children":767},{"style":757},[768],{"type":428,"value":769},"name",{"type":422,"tag":499,"props":771,"children":773},{"style":772},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[774],{"type":428,"value":775}," ===",{"type":422,"tag":499,"props":777,"children":779},{"style":778},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[780],{"type":428,"value":781}," '",{"type":422,"tag":499,"props":783,"children":785},{"style":784},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[786],{"type":428,"value":787},"foo",{"type":422,"tag":499,"props":789,"children":790},{"style":778},[791],{"type":428,"value":792},"'",{"type":422,"tag":499,"props":794,"children":795},{"style":772},[796],{"type":428,"value":797}," &&",{"type":422,"tag":499,"props":799,"children":800},{"style":757},[801],{"type":428,"value":802}," pkg",{"type":422,"tag":499,"props":804,"children":805},{"style":701},[806],{"type":428,"value":764},{"type":422,"tag":499,"props":808,"children":809},{"style":757},[810],{"type":428,"value":811},"version",{"type":422,"tag":499,"props":813,"children":814},{"style":701},[815],{"type":428,"value":764},{"type":422,"tag":499,"props":817,"children":818},{"style":695},[819],{"type":428,"value":820},"startsWith",{"type":422,"tag":499,"props":822,"children":823},{"style":751},[824],{"type":428,"value":704},{"type":422,"tag":499,"props":826,"children":827},{"style":778},[828],{"type":428,"value":792},{"type":422,"tag":499,"props":830,"children":831},{"style":784},[832],{"type":428,"value":833},"1.",{"type":422,"tag":499,"props":835,"children":836},{"style":778},[837],{"type":428,"value":792},{"type":422,"tag":499,"props":839,"children":840},{"style":751},[841],{"type":428,"value":842},")) ",{"type":422,"tag":499,"props":844,"children":845},{"style":701},[846],{"type":428,"value":847},"{\n",{"type":422,"tag":499,"props":849,"children":850},{"class":501,"line":529},[851],{"type":422,"tag":499,"props":852,"children":853},{"style":736},[854],{"type":428,"value":855},"    // Replace bar@x.x.x with bar@2.0.0\n",{"type":422,"tag":499,"props":857,"children":858},{"class":501,"line":538},[859,864,868,873,878],{"type":422,"tag":499,"props":860,"children":861},{"style":757},[862],{"type":428,"value":863},"    pkg",{"type":422,"tag":499,"props":865,"children":866},{"style":701},[867],{"type":428,"value":764},{"type":422,"tag":499,"props":869,"children":870},{"style":757},[871],{"type":428,"value":872},"dependencies",{"type":422,"tag":499,"props":874,"children":875},{"style":772},[876],{"type":428,"value":877}," =",{"type":422,"tag":499,"props":879,"children":880},{"style":701},[881],{"type":428,"value":730},{"type":422,"tag":499,"props":883,"children":884},{"class":501,"line":547},[885,890,894,898,902],{"type":422,"tag":499,"props":886,"children":887},{"style":772},[888],{"type":428,"value":889},"      ...",{"type":422,"tag":499,"props":891,"children":892},{"style":757},[893],{"type":428,"value":710},{"type":422,"tag":499,"props":895,"children":896},{"style":701},[897],{"type":428,"value":764},{"type":422,"tag":499,"props":899,"children":900},{"style":757},[901],{"type":428,"value":872},{"type":422,"tag":499,"props":903,"children":904},{"style":701},[905],{"type":428,"value":906},",\n",{"type":422,"tag":499,"props":908,"children":910},{"class":501,"line":909},7,[911,916,921,925,930],{"type":422,"tag":499,"props":912,"children":913},{"style":751},[914],{"type":428,"value":915},"      bar",{"type":422,"tag":499,"props":917,"children":918},{"style":701},[919],{"type":428,"value":920},":",{"type":422,"tag":499,"props":922,"children":923},{"style":778},[924],{"type":428,"value":781},{"type":422,"tag":499,"props":926,"children":927},{"style":784},[928],{"type":428,"value":929},"^2.0.0",{"type":422,"tag":499,"props":931,"children":932},{"style":778},[933],{"type":428,"value":934},"'\n",{"type":422,"tag":499,"props":936,"children":938},{"class":501,"line":937},8,[939],{"type":422,"tag":499,"props":940,"children":941},{"style":701},[942],{"type":428,"value":943},"    }\n",{"type":422,"tag":499,"props":945,"children":947},{"class":501,"line":946},9,[948,953,957,962,966,970,975,979],{"type":422,"tag":499,"props":949,"children":950},{"style":757},[951],{"type":428,"value":952},"    context",{"type":422,"tag":499,"props":954,"children":955},{"style":701},[956],{"type":428,"value":764},{"type":422,"tag":499,"props":958,"children":959},{"style":695},[960],{"type":428,"value":961},"log",{"type":422,"tag":499,"props":963,"children":964},{"style":751},[965],{"type":428,"value":704},{"type":422,"tag":499,"props":967,"children":968},{"style":778},[969],{"type":428,"value":792},{"type":422,"tag":499,"props":971,"children":972},{"style":784},[973],{"type":428,"value":974},"bar@1 => bar@2 in dependencies of foo",{"type":422,"tag":499,"props":976,"children":977},{"style":778},[978],{"type":428,"value":792},{"type":422,"tag":499,"props":980,"children":981},{"style":751},[982],{"type":428,"value":983},")\n",{"type":422,"tag":499,"props":985,"children":987},{"class":501,"line":986},10,[988],{"type":422,"tag":499,"props":989,"children":990},{"style":701},[991],{"type":428,"value":992},"  }\n",{"type":422,"tag":499,"props":994,"children":996},{"class":501,"line":995},11,[997],{"type":422,"tag":499,"props":998,"children":999},{"style":751},[1000],{"type":428,"value":1001},"  \n",{"type":422,"tag":499,"props":1003,"children":1005},{"class":501,"line":1004},12,[1006],{"type":422,"tag":499,"props":1007,"children":1008},{"style":736},[1009],{"type":428,"value":1010},"  // This will change any packages using baz@x.x.x to use baz@1.2.3\n",{"type":422,"tag":499,"props":1012,"children":1014},{"class":501,"line":1013},13,[1015,1019,1023,1027,1031,1035,1039,1044,1049],{"type":422,"tag":499,"props":1016,"children":1017},{"style":745},[1018],{"type":428,"value":748},{"type":422,"tag":499,"props":1020,"children":1021},{"style":751},[1022],{"type":428,"value":754},{"type":422,"tag":499,"props":1024,"children":1025},{"style":757},[1026],{"type":428,"value":710},{"type":422,"tag":499,"props":1028,"children":1029},{"style":701},[1030],{"type":428,"value":764},{"type":422,"tag":499,"props":1032,"children":1033},{"style":757},[1034],{"type":428,"value":872},{"type":422,"tag":499,"props":1036,"children":1037},{"style":701},[1038],{"type":428,"value":764},{"type":422,"tag":499,"props":1040,"children":1041},{"style":757},[1042],{"type":428,"value":1043},"baz",{"type":422,"tag":499,"props":1045,"children":1046},{"style":751},[1047],{"type":428,"value":1048},") ",{"type":422,"tag":499,"props":1050,"children":1051},{"style":701},[1052],{"type":428,"value":847},{"type":422,"tag":499,"props":1054,"children":1056},{"class":501,"line":1055},14,[1057,1061,1065,1069,1073,1077,1081,1085,1090,1094],{"type":422,"tag":499,"props":1058,"children":1059},{"style":757},[1060],{"type":428,"value":863},{"type":422,"tag":499,"props":1062,"children":1063},{"style":701},[1064],{"type":428,"value":764},{"type":422,"tag":499,"props":1066,"children":1067},{"style":757},[1068],{"type":428,"value":872},{"type":422,"tag":499,"props":1070,"children":1071},{"style":701},[1072],{"type":428,"value":764},{"type":422,"tag":499,"props":1074,"children":1075},{"style":757},[1076],{"type":428,"value":1043},{"type":422,"tag":499,"props":1078,"children":1079},{"style":772},[1080],{"type":428,"value":877},{"type":422,"tag":499,"props":1082,"children":1083},{"style":778},[1084],{"type":428,"value":781},{"type":422,"tag":499,"props":1086,"children":1087},{"style":784},[1088],{"type":428,"value":1089},"1.2.3",{"type":422,"tag":499,"props":1091,"children":1092},{"style":778},[1093],{"type":428,"value":792},{"type":422,"tag":499,"props":1095,"children":1096},{"style":701},[1097],{"type":428,"value":1098},";\n",{"type":422,"tag":499,"props":1100,"children":1102},{"class":501,"line":1101},15,[1103],{"type":422,"tag":499,"props":1104,"children":1105},{"style":701},[1106],{"type":428,"value":992},{"type":422,"tag":499,"props":1108,"children":1110},{"class":501,"line":1109},16,[1111],{"type":422,"tag":499,"props":1112,"children":1113},{"style":751},[1114],{"type":428,"value":1001},{"type":422,"tag":499,"props":1116,"children":1118},{"class":501,"line":1117},17,[1119,1124],{"type":422,"tag":499,"props":1120,"children":1121},{"style":745},[1122],{"type":428,"value":1123},"  return",{"type":422,"tag":499,"props":1125,"children":1126},{"style":757},[1127],{"type":428,"value":1128}," pkg\n",{"type":422,"tag":499,"props":1130,"children":1132},{"class":501,"line":1131},18,[1133],{"type":422,"tag":499,"props":1134,"children":1135},{"style":701},[1136],{"type":428,"value":1137},"}\n",{"type":422,"tag":499,"props":1139,"children":1141},{"class":501,"line":1140},19,[1142],{"type":422,"tag":499,"props":1143,"children":1144},{"emptyLinePlaceholder":414},[1145],{"type":428,"value":1146},"\n",{"type":422,"tag":499,"props":1148,"children":1150},{"class":501,"line":1149},20,[1151,1157,1161,1166,1170],{"type":422,"tag":499,"props":1152,"children":1154},{"style":1153},"--shiki-light:#39ADB5;--shiki-light-font-style:inherit;--shiki-default:#005CC5;--shiki-default-font-style:inherit;--shiki-dark:#79B8FF;--shiki-dark-font-style:inherit;--shiki-sepia:#66D9EF;--shiki-sepia-font-style:italic",[1155],{"type":428,"value":1156},"module",{"type":422,"tag":499,"props":1158,"children":1159},{"style":701},[1160],{"type":428,"value":764},{"type":422,"tag":499,"props":1162,"children":1163},{"style":1153},[1164],{"type":428,"value":1165},"exports",{"type":422,"tag":499,"props":1167,"children":1168},{"style":772},[1169],{"type":428,"value":877},{"type":422,"tag":499,"props":1171,"children":1172},{"style":701},[1173],{"type":428,"value":730},{"type":422,"tag":499,"props":1175,"children":1177},{"class":501,"line":1176},21,[1178,1183,1187],{"type":422,"tag":499,"props":1179,"children":1180},{"style":751},[1181],{"type":428,"value":1182},"  hooks",{"type":422,"tag":499,"props":1184,"children":1185},{"style":701},[1186],{"type":428,"value":920},{"type":422,"tag":499,"props":1188,"children":1189},{"style":701},[1190],{"type":428,"value":730},{"type":422,"tag":499,"props":1192,"children":1194},{"class":501,"line":1193},22,[1195],{"type":422,"tag":499,"props":1196,"children":1197},{"style":757},[1198],{"type":428,"value":1199},"    readPackage\n",{"type":422,"tag":499,"props":1201,"children":1203},{"class":501,"line":1202},23,[1204],{"type":422,"tag":499,"props":1205,"children":1206},{"style":701},[1207],{"type":428,"value":992},{"type":422,"tag":499,"props":1209,"children":1211},{"class":501,"line":1210},24,[1212],{"type":422,"tag":499,"props":1213,"children":1214},{"style":701},[1215],{"type":428,"value":1137},{"type":422,"tag":438,"props":1217,"children":1218},{},[1219,1221],{"type":428,"value":1220},"见：",{"type":422,"tag":1222,"props":1223,"children":1227},"a",{"href":1224,"rel":1225},"https://pnpm.io/pnpmfile",[1226],"nofollow",[1228],{"type":428,"value":1229},"pnpmfile",{"type":422,"tag":423,"props":1231,"children":1233},{"id":1232},"原理",[1234],{"type":428,"value":1232},{"type":422,"tag":431,"props":1236,"children":1238},{"id":1237},"显著的优点",[1239],{"type":428,"value":1240},"显著的优点？",{"type":422,"tag":566,"props":1242,"children":1243},{},[1244,1249,1254,1267],{"type":422,"tag":570,"props":1245,"children":1246},{},[1247],{"type":428,"value":1248},"省磁盘空间，使用软硬链接和符号链接节约空间。",{"type":422,"tag":570,"props":1250,"children":1251},{},[1252],{"type":428,"value":1253},"安装依赖快，因为处理链接要比处理文件快，并且每个包的解析、下载和写入磁盘这三个阶段是分离的。",{"type":422,"tag":570,"props":1255,"children":1256},{},[1257,1259,1265],{"type":428,"value":1258},"内建支持 monorepo，所有命令支持 ",{"type":422,"tag":444,"props":1260,"children":1262},{"className":1261},[],[1263],{"type":428,"value":1264},"--filter",{"type":428,"value":1266}," 过滤包。",{"type":422,"tag":570,"props":1268,"children":1269},{},[1270],{"type":428,"value":1271},"依赖严格，避免幽灵依赖和依赖分身问题。",{"type":422,"tag":431,"props":1273,"children":1275},{"id":1274},"依赖的层次结构是怎样的",[1276],{"type":428,"value":1277},"依赖的层次结构是怎样的？",{"type":422,"tag":438,"props":1279,"children":1280},{},[1281,1283,1289,1291,1297,1299,1305,1307,1313,1315,1320,1322,1327,1329,1334,1336,1342,1344,1349,1351,1357],{"type":428,"value":1282},"当项目文件读取 ",{"type":422,"tag":444,"props":1284,"children":1286},{"className":1285},[],[1287],{"type":428,"value":1288},"bar",{"type":428,"value":1290}," 时，直接读取 ",{"type":422,"tag":444,"props":1292,"children":1294},{"className":1293},[],[1295],{"type":428,"value":1296},"node_modules/bar",{"type":428,"value":1298},"，但它其实是 ",{"type":422,"tag":444,"props":1300,"children":1302},{"className":1301},[],[1303],{"type":428,"value":1304},".pnpm",{"type":428,"value":1306}," 文件夹下 ",{"type":422,"tag":444,"props":1308,"children":1310},{"className":1309},[],[1311],{"type":428,"value":1312},"bar/node_modules/bar",{"type":428,"value":1314}," 的一个符号链接。也就是说，他的真实的地址在 ",{"type":422,"tag":444,"props":1316,"children":1318},{"className":1317},[],[1319],{"type":428,"value":1304},{"type":428,"value":1321}," 文件夹下。这样一来，当 ",{"type":422,"tag":444,"props":1323,"children":1325},{"className":1324},[],[1326],{"type":428,"value":1288},{"type":428,"value":1328}," 读取它的依赖的时候（项目的依赖的依赖），会在 ",{"type":422,"tag":444,"props":1330,"children":1332},{"className":1331},[],[1333],{"type":428,"value":1288},{"type":428,"value":1335}," 的上层目录即 ",{"type":422,"tag":444,"props":1337,"children":1339},{"className":1338},[],[1340],{"type":428,"value":1341},"bar/node_modules",{"type":428,"value":1343}," 找到 ",{"type":422,"tag":444,"props":1345,"children":1347},{"className":1346},[],[1348],{"type":428,"value":787},{"type":428,"value":1350}," 这个依赖。项目文件没法读取 ",{"type":422,"tag":444,"props":1352,"children":1354},{"className":1353},[],[1355],{"type":428,"value":1356},"bar/node_modules/foo",{"type":428,"value":1358}," 所以避免了幽灵依赖问题。",{"type":422,"tag":438,"props":1360,"children":1361},{},[1362,1367,1369,1375,1377,1382,1384,1390],{"type":422,"tag":444,"props":1363,"children":1365},{"className":1364},[],[1366],{"type":428,"value":1356},{"type":428,"value":1368}," 要怎么找到它的依赖呢？它的真实地址在项目 ·（和官网的图有出入），所以 foo 也只能读取它自己的子依赖，即 ",{"type":422,"tag":444,"props":1370,"children":1372},{"className":1371},[],[1373],{"type":428,"value":1374},"node_modules/.pnpm/foo/node_modules",{"type":428,"value":1376},"。如果有依赖依赖了同一份（同一版本）的 ",{"type":422,"tag":444,"props":1378,"children":1380},{"className":1379},[],[1381],{"type":428,"value":787},{"type":428,"value":1383},"，那么它们的真实地址都是一样的 ",{"type":422,"tag":444,"props":1385,"children":1387},{"className":1386},[],[1388],{"type":428,"value":1389},"node_modules/.pnpm/foo/node_modules/foo",{"type":428,"value":1391},"，这样就避免依赖分身问题。",{"type":422,"tag":438,"props":1393,"children":1394},{},[1395],{"type":422,"tag":1396,"props":1397,"children":1400},"img",{"alt":1398,"src":1399},"Modules Mapping in pnpm","https://mgear-image.oss-cn-shanghai.aliyuncs.com/image/other/20220317192927.png",[],{"type":422,"tag":438,"props":1402,"children":1403},{},[1404,1405,1412,1414],{"type":428,"value":1220},{"type":422,"tag":1222,"props":1406,"children":1409},{"href":1407,"rel":1408},"https://pnpm.io/blog/2020/05/27/flat-node-modules-is-not-the-only-way",[1226],[1410],{"type":428,"value":1411},"Flat node_modules is not the only way | @pnpm",{"type":428,"value":1413},"、",{"type":422,"tag":1222,"props":1415,"children":1418},{"href":1416,"rel":1417},"https://pnpm.io/symlinked-node-modules-structure",[1226],[1419],{"type":428,"value":1420},"Symlinked node_modules structure | @pnpm",{"type":422,"tag":431,"props":1422,"children":1424},{"id":1423},"如何处理同级依赖",[1425],{"type":428,"value":1426},"如何处理同级依赖？",{"type":422,"tag":438,"props":1428,"children":1429},{},[1430,1432,1438,1440,1446,1448,1454,1456,1462,1464,1470,1471,1477],{"type":428,"value":1431},"当项目的两个包 A、B 依赖依赖了同一版本的 C，但是却安装了不同版本的 C 的同级依赖 D@1.0 和 D@1.1，这时，A 依赖的 C 的真实地址是 ",{"type":422,"tag":444,"props":1433,"children":1435},{"className":1434},[],[1436],{"type":428,"value":1437},".pnpm/C_D@1.0/node_modules/C",{"type":428,"value":1439},"，B 依赖的 C 的真实地址是 ",{"type":422,"tag":444,"props":1441,"children":1443},{"className":1442},[],[1444],{"type":428,"value":1445},".pnpm/C_D@1.1/node_modules/C",{"type":428,"value":1447},"。这样一来，两个 C 在读取其同级依赖时，分别读取了 ",{"type":422,"tag":444,"props":1449,"children":1451},{"className":1450},[],[1452],{"type":428,"value":1453},".pnpm/C_D@1.0/node_modules/D",{"type":428,"value":1455}," 和 ",{"type":422,"tag":444,"props":1457,"children":1459},{"className":1458},[],[1460],{"type":428,"value":1461},".pnpm/C_D@1.1/node_modules/D@1.0",{"type":428,"value":1463},"，分别对应真实地址 ",{"type":422,"tag":444,"props":1465,"children":1467},{"className":1466},[],[1468],{"type":428,"value":1469},".pnpm/D@1.0/node_modules/D",{"type":428,"value":1455},{"type":422,"tag":444,"props":1472,"children":1474},{"className":1473},[],[1475],{"type":428,"value":1476},".pnpm/D@1.1/node_modules/D",{"type":428,"value":1478},"。",{"type":422,"tag":438,"props":1480,"children":1481},{},[1482,1484,1490,1491,1497,1499,1505,1506,1511,1513,1519],{"type":428,"value":1483},"当同级依赖的深度增加时，层级结构也随之变得复杂。如果某个依赖 A 依赖了同一个 B，但是 B 子依赖 C 的版本不同（C@1.0 和 C@1.1），这样就创造出了指数级增长的软链数量。为了保证 B 能分别访问两个 C，B 的符号链接的被链接地址会有 ",{"type":422,"tag":444,"props":1485,"children":1487},{"className":1486},[],[1488],{"type":428,"value":1489},".pnpm/B_C@1.0/node_modules/B",{"type":428,"value":1455},{"type":422,"tag":444,"props":1492,"children":1494},{"className":1493},[],[1495],{"type":428,"value":1496},".pnpm/B_C@1.1/node_modules/B",{"type":428,"value":1498},"，而为此，A 的被链接地址也会有两个，",{"type":422,"tag":444,"props":1500,"children":1502},{"className":1501},[],[1503],{"type":428,"value":1504},".pnpm/A_C@1.0/node_modules/A",{"type":428,"value":1455},{"type":422,"tag":444,"props":1507,"children":1509},{"className":1508},[],[1510],{"type":428,"value":1504},{"type":428,"value":1512},"。从不同的 A 的被链接地址的上级目录 ",{"type":422,"tag":444,"props":1514,"children":1516},{"className":1515},[],[1517],{"type":428,"value":1518},"node_modules",{"type":428,"value":1520}," 可以读取到不同的 B 的被链目录，从不同的 B 可以读取到不同的 C。",{"type":422,"tag":490,"props":1522,"children":1524},{"code":1523,"language":428,"meta":415,"className":493,"style":415},"node_modules\n└── .pnpm\n    ├── a@1.0.0_c@1.0.0\n    │   └── node_modules\n    │       ├── a\n    │       └── b -> ../../b@1.0.0_c@1.0.0/node_modules/b\n    ├── a@1.0.0_c@1.1.0\n    │   └── node_modules\n    │       ├── a\n    │       └── b -> ../../b@1.0.0_c@1.1.0/node_modules/b\n    ├── b@1.0.0_c@1.0.0\n    │   └── node_modules\n    │       ├── b\n    │       └── c -> ../../c@1.0.0/node_modules/c\n    ├── b@1.0.0_c@1.1.0\n    │   └── node_modules\n    │       ├── b\n    │       └── c -> ../../c@1.1.0/node_modules/c\n    ├── c@1.0.0\n    ├── c@1.1.0\n",[1525],{"type":422,"tag":444,"props":1526,"children":1527},{"__ignoreMap":415},[1528,1536,1544,1552,1560,1568,1576,1584,1591,1598,1606,1614,1621,1629,1637,1645,1652,1659,1667,1675],{"type":422,"tag":499,"props":1529,"children":1530},{"class":501,"line":502},[1531],{"type":422,"tag":499,"props":1532,"children":1533},{},[1534],{"type":428,"value":1535},"node_modules\n",{"type":422,"tag":499,"props":1537,"children":1538},{"class":501,"line":511},[1539],{"type":422,"tag":499,"props":1540,"children":1541},{},[1542],{"type":428,"value":1543},"└── .pnpm\n",{"type":422,"tag":499,"props":1545,"children":1546},{"class":501,"line":520},[1547],{"type":422,"tag":499,"props":1548,"children":1549},{},[1550],{"type":428,"value":1551},"    ├── a@1.0.0_c@1.0.0\n",{"type":422,"tag":499,"props":1553,"children":1554},{"class":501,"line":529},[1555],{"type":422,"tag":499,"props":1556,"children":1557},{},[1558],{"type":428,"value":1559},"    │   └── node_modules\n",{"type":422,"tag":499,"props":1561,"children":1562},{"class":501,"line":538},[1563],{"type":422,"tag":499,"props":1564,"children":1565},{},[1566],{"type":428,"value":1567},"    │       ├── a\n",{"type":422,"tag":499,"props":1569,"children":1570},{"class":501,"line":547},[1571],{"type":422,"tag":499,"props":1572,"children":1573},{},[1574],{"type":428,"value":1575},"    │       └── b -> ../../b@1.0.0_c@1.0.0/node_modules/b\n",{"type":422,"tag":499,"props":1577,"children":1578},{"class":501,"line":909},[1579],{"type":422,"tag":499,"props":1580,"children":1581},{},[1582],{"type":428,"value":1583},"    ├── a@1.0.0_c@1.1.0\n",{"type":422,"tag":499,"props":1585,"children":1586},{"class":501,"line":937},[1587],{"type":422,"tag":499,"props":1588,"children":1589},{},[1590],{"type":428,"value":1559},{"type":422,"tag":499,"props":1592,"children":1593},{"class":501,"line":946},[1594],{"type":422,"tag":499,"props":1595,"children":1596},{},[1597],{"type":428,"value":1567},{"type":422,"tag":499,"props":1599,"children":1600},{"class":501,"line":986},[1601],{"type":422,"tag":499,"props":1602,"children":1603},{},[1604],{"type":428,"value":1605},"    │       └── b -> ../../b@1.0.0_c@1.1.0/node_modules/b\n",{"type":422,"tag":499,"props":1607,"children":1608},{"class":501,"line":995},[1609],{"type":422,"tag":499,"props":1610,"children":1611},{},[1612],{"type":428,"value":1613},"    ├── b@1.0.0_c@1.0.0\n",{"type":422,"tag":499,"props":1615,"children":1616},{"class":501,"line":1004},[1617],{"type":422,"tag":499,"props":1618,"children":1619},{},[1620],{"type":428,"value":1559},{"type":422,"tag":499,"props":1622,"children":1623},{"class":501,"line":1013},[1624],{"type":422,"tag":499,"props":1625,"children":1626},{},[1627],{"type":428,"value":1628},"    │       ├── b\n",{"type":422,"tag":499,"props":1630,"children":1631},{"class":501,"line":1055},[1632],{"type":422,"tag":499,"props":1633,"children":1634},{},[1635],{"type":428,"value":1636},"    │       └── c -> ../../c@1.0.0/node_modules/c\n",{"type":422,"tag":499,"props":1638,"children":1639},{"class":501,"line":1101},[1640],{"type":422,"tag":499,"props":1641,"children":1642},{},[1643],{"type":428,"value":1644},"    ├── b@1.0.0_c@1.1.0\n",{"type":422,"tag":499,"props":1646,"children":1647},{"class":501,"line":1109},[1648],{"type":422,"tag":499,"props":1649,"children":1650},{},[1651],{"type":428,"value":1559},{"type":422,"tag":499,"props":1653,"children":1654},{"class":501,"line":1117},[1655],{"type":422,"tag":499,"props":1656,"children":1657},{},[1658],{"type":428,"value":1628},{"type":422,"tag":499,"props":1660,"children":1661},{"class":501,"line":1131},[1662],{"type":422,"tag":499,"props":1663,"children":1664},{},[1665],{"type":428,"value":1666},"    │       └── c -> ../../c@1.1.0/node_modules/c\n",{"type":422,"tag":499,"props":1668,"children":1669},{"class":501,"line":1140},[1670],{"type":422,"tag":499,"props":1671,"children":1672},{},[1673],{"type":428,"value":1674},"    ├── c@1.0.0\n",{"type":422,"tag":499,"props":1676,"children":1677},{"class":501,"line":1149},[1678],{"type":422,"tag":499,"props":1679,"children":1680},{},[1681],{"type":428,"value":1682},"    ├── c@1.1.0\n",{"type":422,"tag":438,"props":1684,"children":1685},{},[1686,1687],{"type":428,"value":1220},{"type":422,"tag":1222,"props":1688,"children":1691},{"href":1689,"rel":1690},"https://pnpm.io/how-peers-are-resolved",[1226],[1692],{"type":428,"value":1693},"How peers are resolved | @pnpm",{"type":422,"tag":431,"props":1695,"children":1697},{"id":1696},"怎样兼容-nodejs-模块加载顺序",[1698],{"type":428,"value":1699},"怎样兼容 NodeJS 模块加载顺序？",{"type":422,"tag":438,"props":1701,"children":1702},{},[1703],{"type":428,"value":1704},"不论系统自带的模块，NodeJS 加载模块的顺序是这样的：",{"type":422,"tag":566,"props":1706,"children":1707},{},[1708,1713,1718,1723],{"type":422,"tag":570,"props":1709,"children":1710},{},[1711],{"type":428,"value":1712},"读取本文件夹中 node_modules 中对应名字的文件夹的 package.json，并寻找 main 字段对应的路径",{"type":422,"tag":570,"props":1714,"children":1715},{},[1716],{"type":428,"value":1717},"读取本文件夹中 node_modules 中对应名字的 js 文件",{"type":422,"tag":570,"props":1719,"children":1720},{},[1721],{"type":428,"value":1722},"读取本文件夹中 node_modules 中对应名字文件夹中的 index.js 文件",{"type":422,"tag":570,"props":1724,"children":1725},{},[1726],{"type":428,"value":1727},"跳出本文件夹，继续前三个步骤",{"type":422,"tag":438,"props":1729,"children":1730},{},[1731,1733,1738,1740,1746,1748,1754,1756,1761,1763,1769,1771,1777],{"type":428,"value":1732},"因为项目 ",{"type":422,"tag":444,"props":1734,"children":1736},{"className":1735},[],[1737],{"type":428,"value":1296},{"type":428,"value":1739}," 是 ",{"type":422,"tag":444,"props":1741,"children":1743},{"className":1742},[],[1744],{"type":428,"value":1745},".pnpm/bar/node_modules/bar",{"type":428,"value":1747}," 的符号链接，所以项目文件可以直接读取 ",{"type":422,"tag":444,"props":1749,"children":1751},{"className":1750},[],[1752],{"type":428,"value":1753},"node_modules/bar/x.js",{"type":428,"value":1755},"。同时，如果 ",{"type":422,"tag":444,"props":1757,"children":1759},{"className":1758},[],[1760],{"type":428,"value":1753},{"type":428,"value":1762}," 需要加载 ",{"type":422,"tag":444,"props":1764,"children":1766},{"className":1765},[],[1767],{"type":428,"value":1768},"foo/x.js",{"type":428,"value":1770},"，那么在上述步骤的第 4 步，就能找到 ",{"type":422,"tag":444,"props":1772,"children":1774},{"className":1773},[],[1775],{"type":428,"value":1776},".pnpm/bar/node_modules/foo/x.js",{"type":428,"value":1778}," 文件。",{"type":422,"tag":431,"props":1780,"children":1782},{"id":1781},"为什么其模块层次只是比较严格的semistrict",[1783],{"type":428,"value":1784},"为什么其模块层次只是“比较严格的”（semistrict）？",{"type":422,"tag":438,"props":1786,"children":1787},{},[1788],{"type":428,"value":1789},"由 NodeJS 模块加载规则可知，在 pnpm 创造的依赖层次下，一个依赖的子依赖间仍有相互访问的能力。",{"type":422,"tag":431,"props":1791,"children":1793},{"id":1792},"为什么能节约磁盘空间",[1794],{"type":428,"value":1795},"为什么能节约磁盘空间？",{"type":422,"tag":438,"props":1797,"children":1798},{},[1799,1801,1807,1809,1815,1817,1823],{"type":428,"value":1800},"由 pnpm 创造的 node_modules 层级结构可以知道，所有依赖的符号链接的真实地址都在 ",{"type":422,"tag":444,"props":1802,"children":1804},{"className":1803},[],[1805],{"type":428,"value":1806},".pnpm/package-name/node_modules/package-name",{"type":428,"value":1808}," 这个文件夹中。这种文件夹会通过硬链接的形式链接到 ",{"type":422,"tag":444,"props":1810,"children":1812},{"className":1811},[],[1813],{"type":428,"value":1814},"user-document/.pnpm-store",{"type":428,"value":1816}," 中，所以相同的包只会存一份，也就是 ",{"type":422,"tag":444,"props":1818,"children":1820},{"className":1819},[],[1821],{"type":428,"value":1822},".pnpm-store/package-name",{"type":428,"value":1478},{"type":422,"tag":431,"props":1825,"children":1827},{"id":1826},"软硬链接有什么问题",[1828],{"type":428,"value":1829},"软硬链接有什么问题？",{"type":422,"tag":1831,"props":1832,"children":1833},"ul",{},[1834,1839,1844,1849],{"type":422,"tag":570,"props":1835,"children":1836},{},[1837],{"type":428,"value":1838},"特定的软链结构会导致某些应用出现死循环",{"type":422,"tag":570,"props":1840,"children":1841},{},[1842],{"type":428,"value":1843},"硬链接是同一份文件，不便调试",{"type":422,"tag":570,"props":1845,"children":1846},{},[1847],{"type":428,"value":1848},"软链接在非 SSD 上的读写会有性能损耗",{"type":422,"tag":570,"props":1850,"children":1851},{},[1852],{"type":428,"value":1853},"pnpm 创造的 node_modules 层级结构会破坏某些依赖依赖了相对路径的依赖的逻辑",{"type":422,"tag":438,"props":1855,"children":1856},{},[1857,1858],{"type":428,"value":1220},{"type":422,"tag":1222,"props":1859,"children":1862},{"href":1860,"rel":1861},"https://zhuanlan.zhihu.com/p/553804414",[1226],[1863],{"type":428,"value":1864},"精读 pnpm",{"type":422,"tag":423,"props":1866,"children":1868},{"id":1867},"常见问题",[1869],{"type":428,"value":1867},{"type":422,"tag":431,"props":1871,"children":1873},{"id":1872},"pnpm-找不到全局路径的解决方法",[1874],{"type":428,"value":1875},"PNPM 找不到全局路径的解决方法？",{"type":422,"tag":438,"props":1877,"children":1878},{},[1879],{"type":428,"value":1880},"尽管设置了全局变量，也重新安装了最新版本 PNPM，也执行了 pnpm setup，却仍然报错找不到全局路径的临时解决方案：",{"type":422,"tag":490,"props":1882,"children":1886},{"code":1883,"language":1884,"meta":415,"className":1885,"style":415},"$PNPM_HOME=\"\u003Cpath>\" | pnpm install -g xxx\n","powershell","language-powershell shiki shiki-themes material-theme-lighter github-light github-dark monokai",[1887],{"type":422,"tag":444,"props":1888,"children":1889},{"__ignoreMap":415},[1890],{"type":422,"tag":499,"props":1891,"children":1892},{"class":501,"line":502},[1893,1898,1903,1908,1913,1918,1922,1927,1932,1937],{"type":422,"tag":499,"props":1894,"children":1895},{"style":701},[1896],{"type":428,"value":1897},"$",{"type":422,"tag":499,"props":1899,"children":1900},{"style":757},[1901],{"type":428,"value":1902},"PNPM_HOME",{"type":422,"tag":499,"props":1904,"children":1905},{"style":772},[1906],{"type":428,"value":1907},"=",{"type":422,"tag":499,"props":1909,"children":1910},{"style":778},[1911],{"type":428,"value":1912},"\"",{"type":422,"tag":499,"props":1914,"children":1915},{"style":784},[1916],{"type":428,"value":1917},"\u003Cpath>",{"type":422,"tag":499,"props":1919,"children":1920},{"style":778},[1921],{"type":428,"value":1912},{"type":422,"tag":499,"props":1923,"children":1924},{"style":772},[1925],{"type":428,"value":1926}," |",{"type":422,"tag":499,"props":1928,"children":1929},{"style":757},[1930],{"type":428,"value":1931}," pnpm install ",{"type":422,"tag":499,"props":1933,"children":1934},{"style":772},[1935],{"type":428,"value":1936},"-",{"type":422,"tag":499,"props":1938,"children":1939},{"style":757},[1940],{"type":428,"value":1941},"g xxx\n",{"type":422,"tag":431,"props":1943,"children":1945},{"id":1944},"pnpm-速度变慢了",[1946],{"type":428,"value":1947},"PNPM 速度变慢了？",{"type":422,"tag":438,"props":1949,"children":1950},{},[1951],{"type":428,"value":1952},"今天逛官网时，偶然发现 Readme 中的 benchmark 过时了。它说“要比 Yarn Classic 和 npm “快两倍以上，但是从 benchmark 来看，他要比 Yarn 和 npm 慢了不少。以后启用 NodeJS 20 以上时，如果问题得不到改善，我应该会重新选择 npm 而不是 pnpm，鉴于幽灵依赖和依赖分身带来的问题是可排查可解决的，而速度是解决不了的问题。",{"type":422,"tag":438,"props":1954,"children":1955},{},[1956],{"type":422,"tag":1396,"props":1957,"children":1960},{"alt":1958,"src":1959},"pnpm vs npm vs yarn benchmark","https://mgear-image.oss-cn-shanghai.aliyuncs.com/image/other/20230605235736.png",[],{"type":422,"tag":438,"props":1962,"children":1963},{},[1964,1966],{"type":428,"value":1965},"相关见：",{"type":422,"tag":1222,"props":1967,"children":1970},{"href":1968,"rel":1969},"https://github.com/pnpm/pnpm/issues/6447",[1226],[1971],{"type":428,"value":1972},"pnpm seems to be consistently slower than yarn (classic)",{"type":422,"tag":431,"props":1974,"children":1976},{"id":1975},"和-bun-在安装速度上的对比",[1977],{"type":428,"value":1978},"和 Bun 在安装速度上的对比？",{"type":422,"tag":438,"props":1980,"children":1981},{},[1982],{"type":428,"value":1983},"有锁文件、本地缓存，无 node_modules 的情况下，bun 要比 pnpm 安装至少快 3 倍。",{"type":422,"tag":1831,"props":1985,"children":1986},{},[1987,1992],{"type":422,"tag":570,"props":1988,"children":1989},{},[1990],{"type":428,"value":1991},"一个原因是 pnpm、yarn 等工具会在安装时请求最新的 metadata，而 bun 使用的 metadata 源于本地缓存的 metadata。",{"type":422,"tag":570,"props":1993,"children":1994},{},[1995],{"type":428,"value":1996},"另一个原因是 pnpm 在创建 node_modules 层次结构是使用了大量的 symlink，相比其他包管理工具仅使用复制或 hardlink 有更多系统调用。",{"type":422,"tag":438,"props":1998,"children":1999},{},[2000],{"type":428,"value":2001},"所以如果想使 pnpm 更快的安装，可以使用 prefer-offline 选项，以及，node-linker=hoisted 也许有用。",{"type":422,"tag":438,"props":2003,"children":2004},{},[2005,2006],{"type":428,"value":1220},{"type":422,"tag":1222,"props":2007,"children":2010},{"href":2008,"rel":2009},"https://github.com/pnpm/pnpm/issues/7391",[1226],[2011],{"type":428,"value":2012},"Bun.sh-like Module Resolution",{"type":422,"tag":431,"props":2014,"children":2016},{"id":2015},"关于-v8-版本的变化",[2017],{"type":428,"value":2018},"关于 V8 版本的变化？",{"type":422,"tag":1831,"props":2020,"children":2021},{},[2022,2041,2057,2068,2073,2078,2083],{"type":422,"tag":570,"props":2023,"children":2024},{},[2025,2031,2033,2039],{"type":422,"tag":444,"props":2026,"children":2028},{"className":2027},[],[2029],{"type":428,"value":2030},"resolve-peers-from-workspace-root",{"type":428,"value":2032}," is ",{"type":422,"tag":444,"props":2034,"children":2036},{"className":2035},[],[2037],{"type":428,"value":2038},"true",{"type":428,"value":2040}," by default",{"type":422,"tag":570,"props":2042,"children":2043},{},[2044,2050,2051,2056],{"type":422,"tag":444,"props":2045,"children":2047},{"className":2046},[],[2048],{"type":428,"value":2049},"auto-install-peers",{"type":428,"value":2032},{"type":422,"tag":444,"props":2052,"children":2054},{"className":2053},[],[2055],{"type":428,"value":2038},{"type":428,"value":2040},{"type":422,"tag":570,"props":2058,"children":2059},{},[2060,2066],{"type":422,"tag":444,"props":2061,"children":2063},{"className":2062},[],[2064],{"type":428,"value":2065},"dedupe-peer-dependents",{"type":428,"value":2067}," set to true by default",{"type":422,"tag":570,"props":2069,"children":2070},{},[2071],{"type":428,"value":2072},"停止 NodeJS 14 的支持",{"type":422,"tag":570,"props":2074,"children":2075},{},[2076],{"type":428,"value":2077},"lockfile v6 by default",{"type":422,"tag":570,"props":2079,"children":2080},{},[2081],{"type":428,"value":2082},"resolution mode（prebundle、time-based、lowest-direct）default set to lowest-based，需要注意手动升级，尤其是在没有锁文件的情况",{"type":422,"tag":570,"props":2084,"children":2085},{},[2086,2088,2094],{"type":428,"value":2087},"only deply ",{"type":422,"tag":444,"props":2089,"children":2091},{"className":2090},[],[2092],{"type":428,"value":2093},"files",{"type":428,"value":2095}," field when the field exist",{"type":422,"tag":431,"props":2097,"children":2099},{"id":2098},"pnp-模式下的依赖提升设置",[2100],{"type":428,"value":2101},"PnP 模式下的依赖提升设置？",{"type":422,"tag":438,"props":2103,"children":2104},{},[2105,2107,2113],{"type":428,"value":2106},"默认的 node_modules 依赖的层级处于严格和不严格之间的水平（semi-strict）。使用最严格的设置需要打开 PnP 模式，因为在 monorepo 中 PnP 模式中，就算开启了 ",{"type":422,"tag":444,"props":2108,"children":2110},{"className":2109},[],[2111],{"type":428,"value":2112},"hoist=false",{"type":428,"value":2114}," 也不会禁用 workspace root 的依赖",{"type":422,"tag":490,"props":2116,"children":2118},{"code":2117},"node-linker=pnp\nsymlink=false\n",[2119],{"type":422,"tag":444,"props":2120,"children":2121},{"__ignoreMap":415},[2122],{"type":428,"value":2117},{"type":422,"tag":438,"props":2124,"children":2125},{},[2126,2127],{"type":428,"value":1220},{"type":422,"tag":1222,"props":2128,"children":2131},{"href":2129,"rel":2130},"https://pnpm.io/blog/2020/10/17/node-modules-configuration-options-with-pnpm",[1226],[2132],{"type":428,"value":2133},"Node-Modules configuration options with pnpm",{"type":422,"tag":431,"props":2135,"children":2137},{"id":2136},"在-windows-dev-driver-上可能会碰到的问题",[2138],{"type":428,"value":2139},"在 Windows Dev Driver 上可能会碰到的问题？",{"type":422,"tag":438,"props":2141,"children":2142},{},[2143],{"type":428,"value":2144},"2024 年初 pnpm 实现了 Dev Driver 上的 Copy on Write 功能，但可能会碰到变慢的问题。",{"type":422,"tag":438,"props":2146,"children":2147},{},[2148,2149],{"type":428,"value":1220},{"type":422,"tag":1222,"props":2150,"children":2153},{"href":2151,"rel":2152},"https://github.com/pnpm/pnpm/issues/7547",[1226],[2154],{"type":428,"value":2155},"pnpm lately slow and pnpx stuck at installing deps using executable package",{"type":422,"tag":2157,"props":2158,"children":2159},"style",{},[2160],{"type":428,"value":2161},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":415,"searchDepth":511,"depth":511,"links":2163},[2164,2165,2166],{"id":425,"depth":511,"text":429},{"id":1232,"depth":511,"text":1232},{"id":1867,"depth":511,"text":1867},"markdown","content:6.maps:_workflow:package-manager:pnpm.md","content","6.maps/_workflow/package-manager/pnpm.md","6.maps/_workflow/package-manager/pnpm","md",[2174,2177],{"_path":2175,"title":2176,"description":415},"/maps/_workflow/package-manager/npm","NPM",{"_path":2178,"title":2179,"description":415},"/maps/_workflow/packer","打包工具",1732808137752]