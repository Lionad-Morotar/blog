[{"data":1,"prerenderedAt":2158},["ShallowReactive",2],{"navigation":3,"/maps/_workflow/package-manager/pnpm":389,"/maps/_workflow/package-manager/pnpm-surround":2151},[4,32,83,99,126,132,138,372,378,384],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🌃 长夜梦","/flows/long-night-dream",{"title":15,"_path":16},"🌌 万物联结与幸福感","/flows/everything",{"title":18,"_path":19},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":21,"_path":22},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":24,"_path":25},"🌧️ 我的腼腆","/flows/shy",{"title":27,"_path":28},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":30,"_path":31},"📝 心流归档","/flows/fold",{"title":33,"_path":34,"children":35},"技术博客 / Coder","/articles",[36,38,41,44,47,50,53,56,59,62,65,68,71,74,77,80],{"title":37,"_path":34},"🦁 为什么我要写博客",{"title":39,"_path":40},"💻 本地部署 Qwen 翻译网页","/articles/local-translator",{"title":42,"_path":43},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":45,"_path":46},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":48,"_path":49},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":51,"_path":52},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":54,"_path":55},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":57,"_path":58},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":60,"_path":61},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":63,"_path":64},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":66,"_path":67},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":69,"_path":70},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":72,"_path":73},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":75,"_path":76},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":78,"_path":79},"🚝 四十二篇系列","/articles/fourty-two",{"title":81,"_path":82},"📝 技术博客归档","/articles/fold",{"title":84,"_path":85,"children":86},"造物 / Make","/tools",[87,90,93,96],{"title":88,"_path":89},"🌐 AnySort","/tools/anysort",{"title":91,"_path":92},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":94,"_path":95},"👓 Crapto","/tools/crypto-inline",{"title":97,"_path":98},"🖨️ any-to-base64","/tools/any-to-base64",{"title":100,"_path":101,"children":102},"吉他剧场 / Music","/music",[103,105,108,111,114,117,120,123],{"title":104,"_path":101},"🎸 FingerStyle！",{"title":106,"_path":107},"🌬️ 等待的风","/music/wind",{"title":109,"_path":110},"💕 约定的海洋","/music/ocean",{"title":112,"_path":113},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":115,"_path":116},"🌏 残酷天使的行动纲领","/music/eva",{"title":118,"_path":119},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":121,"_path":122},"🍷 Wu Wei","/music/wu-wei",{"title":124,"_path":125},"🌅 无题","/music/untitled",{"title":127,"_path":128,"children":129},"画点什么 / Paint","/paint",[130],{"title":131,"_path":128},"🚧 正在施工",{"title":133,"_path":134,"children":135},"知识地图 / Maps","/maps",[136],{"title":137,"_path":134},"🏁 知识地图",{"title":139,"_path":140,"children":141},"零散的笔记 / Gists","/gists",[142,144,147,150,153,156,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255,258,261,264,267,270,273,276,279,282,285,288,291,294,297,300,303,306,309,312,315,318,321,324,327,330,333,336,339,342,345,348,351,354,357,360,363,366,369],{"title":143,"_path":140},"🧊 Gists",{"title":145,"_path":146},"网站的可访问性","/gists/accessibility",{"title":148,"_path":149},"Bit","/gists/bit",{"title":151,"_path":152},"图片模糊","/gists/blur",{"title":154,"_path":155},"渲染相关笔记","/gists/c4d",{"title":157,"_path":158},"CDN 问题记录","/gists/cdn",{"title":160,"_path":161},"消毒剂","/gists/cleaner",{"title":163,"_path":164},"Windows Command","/gists/cmd",{"title":166,"_path":167},"Command","/gists/command",{"title":169,"_path":170},"复杂科学","/gists/complexity-science",{"title":172,"_path":173},"宇宙","/gists/cosmos",{"title":175,"_path":176},"C++","/gists/cpp",{"title":178,"_path":179},"Data Structure","/gists/data-structure",{"title":181,"_path":182},"DEPRESSION","/gists/depression",{"title":184,"_path":185},"设计模式","/gists/design-patterns",{"title":187,"_path":188},"Developer Experience","/gists/developer-experience",{"title":190,"_path":191},"Device Metrics","/gists/device-metrix",{"title":193,"_path":194},"ECMAScript Language Specification","/gists/ecmascript-specification",{"title":196,"_path":197},"正则表达式","/gists/eegex",{"title":199,"_path":200},"Emoji","/gists/emoji",{"title":202,"_path":203},"工程","/gists/engineering",{"title":205,"_path":206},"熵","/gists/entropy",{"title":208,"_path":209},"Environment","/gists/environment",{"title":211,"_path":212},"Erlang","/gists/erlang",{"title":214,"_path":215},"逃离塔克夫","/gists/escape-from-tarkov",{"title":217,"_path":218},"ESNext (ES6-ES11)","/gists/esnext",{"title":220,"_path":221},"Eval！","/gists/eval",{"title":223,"_path":224},"Flutter","/gists/flutter",{"title":226,"_path":227},"字体","/gists/font",{"title":229,"_path":230},"JS 函数式编程","/gists/functional",{"title":232,"_path":233},"Google C++ Standard","/gists/google-cpp-standard",{"title":235,"_path":236},"双向链接完全体","/gists/graph",{"title":238,"_path":239},"Hardwares","/gists/hardwares",{"title":241,"_path":242},"哈希冲突","/gists/hash-collision",{"title":244,"_path":245},"信息设计","/gists/information-design",{"title":247,"_path":248},"InstantPage","/gists/instant.page",{"title":250,"_path":251},"ISUX 遇见大数据可视化系列","/gists/isux-data-visualization",{"title":253,"_path":254},"KVStore","/gists/key-value-db",{"title":256,"_path":257},"Kubernetes","/gists/kubernetes",{"title":259,"_path":260},"Makefile","/gists/makefile",{"title":262,"_path":263},"Markdown Inline Style","/gists/markdown-nice",{"title":265,"_path":266},"小程序","/gists/miniapp",{"title":268,"_path":269},"减小页面快照体积","/gists/minify-html",{"title":271,"_path":272},"mklink","/gists/mklink",{"title":274,"_path":275},"Mock","/gists/mock",{"title":277,"_path":278},"多端应用","/gists/multy-end-app",{"title":280,"_path":281},"神经科学","/gists/neuroscience",{"title":283,"_path":284},"OO","/gists/oo",{"title":286,"_path":287},"Opinioned Personal Folder","/gists/opinioned-personal-folder",{"title":289,"_path":290},"人物","/gists/person",{"title":292,"_path":293},"PInvoke","/gists/pinvoke",{"title":295,"_path":296},"像素","/gists/pixel",{"title":298,"_path":299},"PowerShell","/gists/powershell",{"title":301,"_path":302},"量子","/gists/quantum",{"title":304,"_path":305},"保持好奇心","/gists/questions",{"title":307,"_path":308},"React Native","/gists/react-native",{"title":310,"_path":311},"博客改版碰到的浏览器平滑滚动问题","/gists/scroll",{"title":313,"_path":314},"SEO","/gists/seo",{"title":316,"_path":317},"Shader","/gists/shader",{"title":319,"_path":320},"Shape Up","/gists/shape-up",{"title":322,"_path":323},"睡觉","/gists/sleep",{"title":325,"_path":326},"States","/gists/states",{"title":328,"_path":329},"Storage","/gists/storage",{"title":331,"_path":332},"音视频流处理","/gists/stream-cli",{"title":334,"_path":335},"Symbol","/gists/symbol",{"title":337,"_path":338},"系统论","/gists/systems-theory",{"title":340,"_path":341},"Taro","/gists/taro",{"title":343,"_path":344},"任务切片","/gists/task-slice",{"title":346,"_path":347},"技术偏好","/gists/tech-dudge",{"title":349,"_path":350},"Untitled","/gists/untitled",{"title":352,"_path":353},"可变字体","/gists/variable-font",{"title":355,"_path":356},"视觉错觉","/gists/visual-illusion",{"title":358,"_path":359},"SS(SSR)","/gists/vpn",{"title":361,"_path":362},"VS Code 插件开发","/gists/vscode-plugin",{"title":364,"_path":365},"Web Components","/gists/web-components",{"title":367,"_path":368},"Windows","/gists/windows",{"title":370,"_path":371},"查缺补漏","/gists/wrong",{"title":373,"_path":374,"children":375},"代码笔记 / Gists","/source-code",[376],{"title":377,"_path":374},"🚄 代码笔记",{"title":379,"_path":380,"children":381},"我 / Abount","/hire",[382],{"title":383,"_path":380},"📬 技术简历",{"title":385,"_path":386,"children":387},"todo","/todo",[388],{"title":385,"_path":386},{"_path":390,"_dir":391,"_draft":392,"_partial":393,"_locale":394,"title":395,"description":396,"body":397,"_type":2146,"_id":2147,"_source":2148,"_file":2149,"_extension":2150},"/maps/_workflow/package-manager/pnpm","package-manager",false,true,"","pnpm","pnpm 是一个快速、省空间的包管理器",{"type":398,"children":399,"toc":2141},"root",[400,409,416,430,436,446,451,457,468,533,539,544,598,604,609,614,619,637,643,654,1195,1209,1214,1220,1251,1257,1338,1371,1380,1400,1406,1458,1500,1662,1673,1679,1684,1707,1758,1764,1769,1775,1803,1809,1833,1844,1849,1855,1860,1921,1927,1932,1940,1952,1958,1963,1976,1981,1992,1998,2075,2081,2094,2102,2113,2119,2124,2135],{"type":401,"tag":402,"props":403,"children":405},"element","h2",{"id":404},"api-细节和配置项",[406],{"type":407,"value":408},"text","API 细节和配置项",{"type":401,"tag":410,"props":411,"children":413},"h4",{"id":412},"pnpm-import",[414],{"type":407,"value":415},"pnpm import",{"type":401,"tag":417,"props":418,"children":419},"p",{},[420,422,428],{"type":407,"value":421},"使用 ",{"type":401,"tag":423,"props":424,"children":426},"code",{"className":425},[],[427],{"type":407,"value":415},{"type":407,"value":429}," 可以将 package-lock、npm-shrinkwrap 和 yarn.lock 转换为 pnpm-lock 文件。",{"type":401,"tag":410,"props":431,"children":433},{"id":432},"pnpm-fetch",[434],{"type":407,"value":435},"pnpm fetch",{"type":401,"tag":417,"props":437,"children":438},{},[439,444],{"type":401,"tag":423,"props":440,"children":442},{"className":441},[],[443],{"type":407,"value":435},{"type":407,"value":445}," 它跳过了 package.json 文件，允许项目在只有 pnpm-lock 文件的情况下创建 .pnpm 虚拟仓库。这有利于 docker 构建，因为 package.json 经常因为非依赖变化的改动而改动，导致 docker layer 失效。",{"type":401,"tag":417,"props":447,"children":448},{},[449],{"type":407,"value":450},"相比 yarn 和 npm，在脱离 package.json 的情况下，单靠 package-lock（或 yarn-lock），yarn 和 npm 没有办法确定依赖版本，因为其 package-lock 中，依赖的版本号不是固定版本号。",{"type":401,"tag":410,"props":452,"children":454},{"id":453},"pnpm-why",[455],{"type":407,"value":456},"pnpm why",{"type":401,"tag":417,"props":458,"children":459},{},[460,461,466],{"type":407,"value":421},{"type":401,"tag":423,"props":462,"children":464},{"className":463},[],[465],{"type":407,"value":456},{"type":407,"value":467}," 可以列出项目内依赖了某个依赖的依赖，比如说找到项目内使用了 lodash 的包。",{"type":401,"tag":469,"props":470,"children":473},"pre",{"code":471,"language":407,"meta":394,"className":472,"style":394},"dependencies:\nelement-plus 2.2.20\n├── lodash 4.17.21\n└─┬ lodash-unified 1.0.3\n  └── lodash 4.17.21 peer\n...\n","language-text shiki shiki-themes material-theme-lighter github-light github-dark monokai",[474],{"type":401,"tag":423,"props":475,"children":476},{"__ignoreMap":394},[477,488,497,506,515,524],{"type":401,"tag":478,"props":479,"children":482},"span",{"class":480,"line":481},"line",1,[483],{"type":401,"tag":478,"props":484,"children":485},{},[486],{"type":407,"value":487},"dependencies:\n",{"type":401,"tag":478,"props":489,"children":491},{"class":480,"line":490},2,[492],{"type":401,"tag":478,"props":493,"children":494},{},[495],{"type":407,"value":496},"element-plus 2.2.20\n",{"type":401,"tag":478,"props":498,"children":500},{"class":480,"line":499},3,[501],{"type":401,"tag":478,"props":502,"children":503},{},[504],{"type":407,"value":505},"├── lodash 4.17.21\n",{"type":401,"tag":478,"props":507,"children":509},{"class":480,"line":508},4,[510],{"type":401,"tag":478,"props":511,"children":512},{},[513],{"type":407,"value":514},"└─┬ lodash-unified 1.0.3\n",{"type":401,"tag":478,"props":516,"children":518},{"class":480,"line":517},5,[519],{"type":401,"tag":478,"props":520,"children":521},{},[522],{"type":407,"value":523},"  └── lodash 4.17.21 peer\n",{"type":401,"tag":478,"props":525,"children":527},{"class":480,"line":526},6,[528],{"type":401,"tag":478,"props":529,"children":530},{},[531],{"type":407,"value":532},"...\n",{"type":401,"tag":410,"props":534,"children":536},{"id":535},"pnpm-run",[537],{"type":407,"value":538},"pnpm run",{"type":401,"tag":417,"props":540,"children":541},{},[542],{"type":407,"value":543},"与其它包管理器的一些区别：",{"type":401,"tag":545,"props":546,"children":547},"ol",{},[548,574,579],{"type":401,"tag":549,"props":550,"children":551},"li",{},[552,558,560,566,568],{"type":401,"tag":423,"props":553,"children":555},{"className":554},[],[556],{"type":407,"value":557},"pnpm run script-name",{"type":407,"value":559},"，如果 ",{"type":401,"tag":423,"props":561,"children":563},{"className":562},[],[564],{"type":407,"value":565},"script-name",{"type":407,"value":567}," 没有和 pnpm 内置指令冲突，则可以省略 ",{"type":401,"tag":423,"props":569,"children":571},{"className":570},[],[572],{"type":407,"value":573},"run",{"type":401,"tag":549,"props":575,"children":576},{},[577],{"type":407,"value":578},"run 指令默认不会执行 pre 和 post 钩子函数，因为 pnpm 认为这使任务流更难理解",{"type":401,"tag":549,"props":580,"children":581},{},[582,588,590,596],{"type":401,"tag":423,"props":583,"children":585},{"className":584},[],[586],{"type":407,"value":587},"shell-emulator",{"type":407,"value":589}," 选项启用后，将使用 JS 解析指令，这使得在不兼容 POSIX 的环境执行类似 ",{"type":401,"tag":423,"props":591,"children":593},{"className":592},[],[594],{"type":407,"value":595},"NODE_ENV=test node ./index",{"type":407,"value":597}," 的指令会报错的系统也能正常运行这种指令",{"type":401,"tag":410,"props":599,"children":601},{"id":600},"pnpm-pack",[602],{"type":407,"value":603},"pnpm pack",{"type":401,"tag":417,"props":605,"children":606},{},[607],{"type":407,"value":608},"将项目打包为 tarball 压缩包（.tgz）。打包的文件范围和 pnpm publish 一样。",{"type":401,"tag":410,"props":610,"children":612},{"id":611},"shared-workspace-lockfile",[613],{"type":407,"value":611},{"type":401,"tag":417,"props":615,"children":616},{},[617],{"type":407,"value":618},"在 workspace 间共享一份 package-lock 文件。这个配置开启后，所有子包的依赖都会被提升到 workspace 根目录，这带来了几个好处：",{"type":401,"tag":545,"props":620,"children":621},{},[622,627,632],{"type":401,"tag":549,"props":623,"children":624},{},[625],{"type":407,"value":626},"所有依赖都是单例的",{"type":401,"tag":549,"props":628,"children":629},{},[630],{"type":407,"value":631},"更快的安装速度（相比 pnpm install -r）",{"type":401,"tag":549,"props":633,"children":634},{},[635],{"type":407,"value":636},"修改的文件总数更少，利于 Code Review",{"type":401,"tag":410,"props":638,"children":640},{"id":639},"pnpmfilecjs",[641],{"type":407,"value":642},".pnpmfile.cjs",{"type":401,"tag":417,"props":644,"children":645},{},[646,647,652],{"type":407,"value":421},{"type":401,"tag":423,"props":648,"children":650},{"className":649},[],[651],{"type":407,"value":642},{"type":407,"value":653}," 文件提供的 readPackage 和 afterAllResolved 钩子函数可以分别介入依赖元信息解析（minifest）和依赖安装完准备输出 lock 文件的过程。",{"type":401,"tag":469,"props":655,"children":659},{"code":656,"language":657,"meta":394,"className":658,"style":394},"function readPackage(pkg, context) {\n  // Override the manifest of foo@1.x after downloading it from the registry\n  if (pkg.name === 'foo' && pkg.version.startsWith('1.')) {\n    // Replace bar@x.x.x with bar@2.0.0\n    pkg.dependencies = {\n      ...pkg.dependencies,\n      bar: '^2.0.0'\n    }\n    context.log('bar@1 => bar@2 in dependencies of foo')\n  }\n  \n  // This will change any packages using baz@x.x.x to use baz@1.2.3\n  if (pkg.dependencies.baz) {\n    pkg.dependencies.baz = '1.2.3';\n  }\n  \n  return pkg\n}\n\nmodule.exports = {\n  hooks: {\n    readPackage\n  }\n}\n","js","language-js shiki shiki-themes material-theme-lighter github-light github-dark monokai",[660],{"type":401,"tag":423,"props":661,"children":662},{"__ignoreMap":394},[663,710,719,827,835,861,886,914,923,963,972,981,990,1032,1078,1086,1094,1108,1117,1126,1153,1170,1179,1187],{"type":401,"tag":478,"props":664,"children":665},{"class":480,"line":481},[666,672,678,684,690,695,700,705],{"type":401,"tag":478,"props":667,"children":669},{"style":668},"--shiki-light:#9C3EDA;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#66D9EF;--shiki-light-font-style:inherit;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[670],{"type":407,"value":671},"function",{"type":401,"tag":478,"props":673,"children":675},{"style":674},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[676],{"type":407,"value":677}," readPackage",{"type":401,"tag":478,"props":679,"children":681},{"style":680},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[682],{"type":407,"value":683},"(",{"type":401,"tag":478,"props":685,"children":687},{"style":686},"--shiki-light:#90A4AE;--shiki-default:#E36209;--shiki-dark:#FFAB70;--shiki-sepia:#FD971F;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[688],{"type":407,"value":689},"pkg",{"type":401,"tag":478,"props":691,"children":692},{"style":680},[693],{"type":407,"value":694},",",{"type":401,"tag":478,"props":696,"children":697},{"style":686},[698],{"type":407,"value":699}," context",{"type":401,"tag":478,"props":701,"children":702},{"style":680},[703],{"type":407,"value":704},")",{"type":401,"tag":478,"props":706,"children":707},{"style":680},[708],{"type":407,"value":709}," {\n",{"type":401,"tag":478,"props":711,"children":712},{"class":480,"line":490},[713],{"type":401,"tag":478,"props":714,"children":716},{"style":715},"--shiki-light:#90A4AE;--shiki-default:#6A737D;--shiki-dark:#6A737D;--shiki-sepia:#88846F;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:inherit",[717],{"type":407,"value":718},"  // Override the manifest of foo@1.x after downloading it from the registry\n",{"type":401,"tag":478,"props":720,"children":721},{"class":480,"line":499},[722,728,734,739,744,749,755,761,767,772,777,782,786,791,795,800,804,808,813,817,822],{"type":401,"tag":478,"props":723,"children":725},{"style":724},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:inherit",[726],{"type":407,"value":727},"  if",{"type":401,"tag":478,"props":729,"children":731},{"style":730},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[732],{"type":407,"value":733}," (",{"type":401,"tag":478,"props":735,"children":737},{"style":736},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[738],{"type":407,"value":689},{"type":401,"tag":478,"props":740,"children":741},{"style":680},[742],{"type":407,"value":743},".",{"type":401,"tag":478,"props":745,"children":746},{"style":736},[747],{"type":407,"value":748},"name",{"type":401,"tag":478,"props":750,"children":752},{"style":751},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[753],{"type":407,"value":754}," ===",{"type":401,"tag":478,"props":756,"children":758},{"style":757},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[759],{"type":407,"value":760}," '",{"type":401,"tag":478,"props":762,"children":764},{"style":763},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[765],{"type":407,"value":766},"foo",{"type":401,"tag":478,"props":768,"children":769},{"style":757},[770],{"type":407,"value":771},"'",{"type":401,"tag":478,"props":773,"children":774},{"style":751},[775],{"type":407,"value":776}," &&",{"type":401,"tag":478,"props":778,"children":779},{"style":736},[780],{"type":407,"value":781}," pkg",{"type":401,"tag":478,"props":783,"children":784},{"style":680},[785],{"type":407,"value":743},{"type":401,"tag":478,"props":787,"children":788},{"style":736},[789],{"type":407,"value":790},"version",{"type":401,"tag":478,"props":792,"children":793},{"style":680},[794],{"type":407,"value":743},{"type":401,"tag":478,"props":796,"children":797},{"style":674},[798],{"type":407,"value":799},"startsWith",{"type":401,"tag":478,"props":801,"children":802},{"style":730},[803],{"type":407,"value":683},{"type":401,"tag":478,"props":805,"children":806},{"style":757},[807],{"type":407,"value":771},{"type":401,"tag":478,"props":809,"children":810},{"style":763},[811],{"type":407,"value":812},"1.",{"type":401,"tag":478,"props":814,"children":815},{"style":757},[816],{"type":407,"value":771},{"type":401,"tag":478,"props":818,"children":819},{"style":730},[820],{"type":407,"value":821},")) ",{"type":401,"tag":478,"props":823,"children":824},{"style":680},[825],{"type":407,"value":826},"{\n",{"type":401,"tag":478,"props":828,"children":829},{"class":480,"line":508},[830],{"type":401,"tag":478,"props":831,"children":832},{"style":715},[833],{"type":407,"value":834},"    // Replace bar@x.x.x with bar@2.0.0\n",{"type":401,"tag":478,"props":836,"children":837},{"class":480,"line":517},[838,843,847,852,857],{"type":401,"tag":478,"props":839,"children":840},{"style":736},[841],{"type":407,"value":842},"    pkg",{"type":401,"tag":478,"props":844,"children":845},{"style":680},[846],{"type":407,"value":743},{"type":401,"tag":478,"props":848,"children":849},{"style":736},[850],{"type":407,"value":851},"dependencies",{"type":401,"tag":478,"props":853,"children":854},{"style":751},[855],{"type":407,"value":856}," =",{"type":401,"tag":478,"props":858,"children":859},{"style":680},[860],{"type":407,"value":709},{"type":401,"tag":478,"props":862,"children":863},{"class":480,"line":526},[864,869,873,877,881],{"type":401,"tag":478,"props":865,"children":866},{"style":751},[867],{"type":407,"value":868},"      ...",{"type":401,"tag":478,"props":870,"children":871},{"style":736},[872],{"type":407,"value":689},{"type":401,"tag":478,"props":874,"children":875},{"style":680},[876],{"type":407,"value":743},{"type":401,"tag":478,"props":878,"children":879},{"style":736},[880],{"type":407,"value":851},{"type":401,"tag":478,"props":882,"children":883},{"style":680},[884],{"type":407,"value":885},",\n",{"type":401,"tag":478,"props":887,"children":889},{"class":480,"line":888},7,[890,895,900,904,909],{"type":401,"tag":478,"props":891,"children":892},{"style":730},[893],{"type":407,"value":894},"      bar",{"type":401,"tag":478,"props":896,"children":897},{"style":680},[898],{"type":407,"value":899},":",{"type":401,"tag":478,"props":901,"children":902},{"style":757},[903],{"type":407,"value":760},{"type":401,"tag":478,"props":905,"children":906},{"style":763},[907],{"type":407,"value":908},"^2.0.0",{"type":401,"tag":478,"props":910,"children":911},{"style":757},[912],{"type":407,"value":913},"'\n",{"type":401,"tag":478,"props":915,"children":917},{"class":480,"line":916},8,[918],{"type":401,"tag":478,"props":919,"children":920},{"style":680},[921],{"type":407,"value":922},"    }\n",{"type":401,"tag":478,"props":924,"children":926},{"class":480,"line":925},9,[927,932,936,941,945,949,954,958],{"type":401,"tag":478,"props":928,"children":929},{"style":736},[930],{"type":407,"value":931},"    context",{"type":401,"tag":478,"props":933,"children":934},{"style":680},[935],{"type":407,"value":743},{"type":401,"tag":478,"props":937,"children":938},{"style":674},[939],{"type":407,"value":940},"log",{"type":401,"tag":478,"props":942,"children":943},{"style":730},[944],{"type":407,"value":683},{"type":401,"tag":478,"props":946,"children":947},{"style":757},[948],{"type":407,"value":771},{"type":401,"tag":478,"props":950,"children":951},{"style":763},[952],{"type":407,"value":953},"bar@1 => bar@2 in dependencies of foo",{"type":401,"tag":478,"props":955,"children":956},{"style":757},[957],{"type":407,"value":771},{"type":401,"tag":478,"props":959,"children":960},{"style":730},[961],{"type":407,"value":962},")\n",{"type":401,"tag":478,"props":964,"children":966},{"class":480,"line":965},10,[967],{"type":401,"tag":478,"props":968,"children":969},{"style":680},[970],{"type":407,"value":971},"  }\n",{"type":401,"tag":478,"props":973,"children":975},{"class":480,"line":974},11,[976],{"type":401,"tag":478,"props":977,"children":978},{"style":730},[979],{"type":407,"value":980},"  \n",{"type":401,"tag":478,"props":982,"children":984},{"class":480,"line":983},12,[985],{"type":401,"tag":478,"props":986,"children":987},{"style":715},[988],{"type":407,"value":989},"  // This will change any packages using baz@x.x.x to use baz@1.2.3\n",{"type":401,"tag":478,"props":991,"children":993},{"class":480,"line":992},13,[994,998,1002,1006,1010,1014,1018,1023,1028],{"type":401,"tag":478,"props":995,"children":996},{"style":724},[997],{"type":407,"value":727},{"type":401,"tag":478,"props":999,"children":1000},{"style":730},[1001],{"type":407,"value":733},{"type":401,"tag":478,"props":1003,"children":1004},{"style":736},[1005],{"type":407,"value":689},{"type":401,"tag":478,"props":1007,"children":1008},{"style":680},[1009],{"type":407,"value":743},{"type":401,"tag":478,"props":1011,"children":1012},{"style":736},[1013],{"type":407,"value":851},{"type":401,"tag":478,"props":1015,"children":1016},{"style":680},[1017],{"type":407,"value":743},{"type":401,"tag":478,"props":1019,"children":1020},{"style":736},[1021],{"type":407,"value":1022},"baz",{"type":401,"tag":478,"props":1024,"children":1025},{"style":730},[1026],{"type":407,"value":1027},") ",{"type":401,"tag":478,"props":1029,"children":1030},{"style":680},[1031],{"type":407,"value":826},{"type":401,"tag":478,"props":1033,"children":1035},{"class":480,"line":1034},14,[1036,1040,1044,1048,1052,1056,1060,1064,1069,1073],{"type":401,"tag":478,"props":1037,"children":1038},{"style":736},[1039],{"type":407,"value":842},{"type":401,"tag":478,"props":1041,"children":1042},{"style":680},[1043],{"type":407,"value":743},{"type":401,"tag":478,"props":1045,"children":1046},{"style":736},[1047],{"type":407,"value":851},{"type":401,"tag":478,"props":1049,"children":1050},{"style":680},[1051],{"type":407,"value":743},{"type":401,"tag":478,"props":1053,"children":1054},{"style":736},[1055],{"type":407,"value":1022},{"type":401,"tag":478,"props":1057,"children":1058},{"style":751},[1059],{"type":407,"value":856},{"type":401,"tag":478,"props":1061,"children":1062},{"style":757},[1063],{"type":407,"value":760},{"type":401,"tag":478,"props":1065,"children":1066},{"style":763},[1067],{"type":407,"value":1068},"1.2.3",{"type":401,"tag":478,"props":1070,"children":1071},{"style":757},[1072],{"type":407,"value":771},{"type":401,"tag":478,"props":1074,"children":1075},{"style":680},[1076],{"type":407,"value":1077},";\n",{"type":401,"tag":478,"props":1079,"children":1081},{"class":480,"line":1080},15,[1082],{"type":401,"tag":478,"props":1083,"children":1084},{"style":680},[1085],{"type":407,"value":971},{"type":401,"tag":478,"props":1087,"children":1089},{"class":480,"line":1088},16,[1090],{"type":401,"tag":478,"props":1091,"children":1092},{"style":730},[1093],{"type":407,"value":980},{"type":401,"tag":478,"props":1095,"children":1097},{"class":480,"line":1096},17,[1098,1103],{"type":401,"tag":478,"props":1099,"children":1100},{"style":724},[1101],{"type":407,"value":1102},"  return",{"type":401,"tag":478,"props":1104,"children":1105},{"style":736},[1106],{"type":407,"value":1107}," pkg\n",{"type":401,"tag":478,"props":1109,"children":1111},{"class":480,"line":1110},18,[1112],{"type":401,"tag":478,"props":1113,"children":1114},{"style":680},[1115],{"type":407,"value":1116},"}\n",{"type":401,"tag":478,"props":1118,"children":1120},{"class":480,"line":1119},19,[1121],{"type":401,"tag":478,"props":1122,"children":1123},{"emptyLinePlaceholder":393},[1124],{"type":407,"value":1125},"\n",{"type":401,"tag":478,"props":1127,"children":1129},{"class":480,"line":1128},20,[1130,1136,1140,1145,1149],{"type":401,"tag":478,"props":1131,"children":1133},{"style":1132},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#66D9EF;--shiki-light-font-style:inherit;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[1134],{"type":407,"value":1135},"module",{"type":401,"tag":478,"props":1137,"children":1138},{"style":680},[1139],{"type":407,"value":743},{"type":401,"tag":478,"props":1141,"children":1142},{"style":1132},[1143],{"type":407,"value":1144},"exports",{"type":401,"tag":478,"props":1146,"children":1147},{"style":751},[1148],{"type":407,"value":856},{"type":401,"tag":478,"props":1150,"children":1151},{"style":680},[1152],{"type":407,"value":709},{"type":401,"tag":478,"props":1154,"children":1156},{"class":480,"line":1155},21,[1157,1162,1166],{"type":401,"tag":478,"props":1158,"children":1159},{"style":730},[1160],{"type":407,"value":1161},"  hooks",{"type":401,"tag":478,"props":1163,"children":1164},{"style":680},[1165],{"type":407,"value":899},{"type":401,"tag":478,"props":1167,"children":1168},{"style":680},[1169],{"type":407,"value":709},{"type":401,"tag":478,"props":1171,"children":1173},{"class":480,"line":1172},22,[1174],{"type":401,"tag":478,"props":1175,"children":1176},{"style":736},[1177],{"type":407,"value":1178},"    readPackage\n",{"type":401,"tag":478,"props":1180,"children":1182},{"class":480,"line":1181},23,[1183],{"type":401,"tag":478,"props":1184,"children":1185},{"style":680},[1186],{"type":407,"value":971},{"type":401,"tag":478,"props":1188,"children":1190},{"class":480,"line":1189},24,[1191],{"type":401,"tag":478,"props":1192,"children":1193},{"style":680},[1194],{"type":407,"value":1116},{"type":401,"tag":417,"props":1196,"children":1197},{},[1198,1200],{"type":407,"value":1199},"见：",{"type":401,"tag":1201,"props":1202,"children":1206},"a",{"href":1203,"rel":1204},"https://pnpm.io/pnpmfile",[1205],"nofollow",[1207],{"type":407,"value":1208},"pnpmfile",{"type":401,"tag":402,"props":1210,"children":1212},{"id":1211},"原理",[1213],{"type":407,"value":1211},{"type":401,"tag":410,"props":1215,"children":1217},{"id":1216},"显著的优点",[1218],{"type":407,"value":1219},"显著的优点？",{"type":401,"tag":545,"props":1221,"children":1222},{},[1223,1228,1233,1246],{"type":401,"tag":549,"props":1224,"children":1225},{},[1226],{"type":407,"value":1227},"省磁盘空间，使用软硬链接和符号链接节约空间。",{"type":401,"tag":549,"props":1229,"children":1230},{},[1231],{"type":407,"value":1232},"安装依赖快，因为处理链接要比处理文件快，并且每个包的解析、下载和写入磁盘这三个阶段是分离的。",{"type":401,"tag":549,"props":1234,"children":1235},{},[1236,1238,1244],{"type":407,"value":1237},"内建支持 monorepo，所有命令支持 ",{"type":401,"tag":423,"props":1239,"children":1241},{"className":1240},[],[1242],{"type":407,"value":1243},"--filter",{"type":407,"value":1245}," 过滤包。",{"type":401,"tag":549,"props":1247,"children":1248},{},[1249],{"type":407,"value":1250},"依赖严格，避免幽灵依赖和依赖分身问题。",{"type":401,"tag":410,"props":1252,"children":1254},{"id":1253},"依赖的层次结构是怎样的",[1255],{"type":407,"value":1256},"依赖的层次结构是怎样的？",{"type":401,"tag":417,"props":1258,"children":1259},{},[1260,1262,1268,1270,1276,1278,1284,1286,1292,1294,1299,1301,1306,1308,1313,1315,1321,1323,1328,1330,1336],{"type":407,"value":1261},"当项目文件读取 ",{"type":401,"tag":423,"props":1263,"children":1265},{"className":1264},[],[1266],{"type":407,"value":1267},"bar",{"type":407,"value":1269}," 时，直接读取 ",{"type":401,"tag":423,"props":1271,"children":1273},{"className":1272},[],[1274],{"type":407,"value":1275},"node_modules/bar",{"type":407,"value":1277},"，但它其实是 ",{"type":401,"tag":423,"props":1279,"children":1281},{"className":1280},[],[1282],{"type":407,"value":1283},".pnpm",{"type":407,"value":1285}," 文件夹下 ",{"type":401,"tag":423,"props":1287,"children":1289},{"className":1288},[],[1290],{"type":407,"value":1291},"bar/node_modules/bar",{"type":407,"value":1293}," 的一个符号链接。也就是说，他的真实的地址在 ",{"type":401,"tag":423,"props":1295,"children":1297},{"className":1296},[],[1298],{"type":407,"value":1283},{"type":407,"value":1300}," 文件夹下。这样一来，当 ",{"type":401,"tag":423,"props":1302,"children":1304},{"className":1303},[],[1305],{"type":407,"value":1267},{"type":407,"value":1307}," 读取它的依赖的时候（项目的依赖的依赖），会在 ",{"type":401,"tag":423,"props":1309,"children":1311},{"className":1310},[],[1312],{"type":407,"value":1267},{"type":407,"value":1314}," 的上层目录即 ",{"type":401,"tag":423,"props":1316,"children":1318},{"className":1317},[],[1319],{"type":407,"value":1320},"bar/node_modules",{"type":407,"value":1322}," 找到 ",{"type":401,"tag":423,"props":1324,"children":1326},{"className":1325},[],[1327],{"type":407,"value":766},{"type":407,"value":1329}," 这个依赖。项目文件没法读取 ",{"type":401,"tag":423,"props":1331,"children":1333},{"className":1332},[],[1334],{"type":407,"value":1335},"bar/node_modules/foo",{"type":407,"value":1337}," 所以避免了幽灵依赖问题。",{"type":401,"tag":417,"props":1339,"children":1340},{},[1341,1346,1348,1354,1356,1361,1363,1369],{"type":401,"tag":423,"props":1342,"children":1344},{"className":1343},[],[1345],{"type":407,"value":1335},{"type":407,"value":1347}," 要怎么找到它的依赖呢？它的真实地址在项目 ·（和官网的图有出入），所以 foo 也只能读取它自己的子依赖，即 ",{"type":401,"tag":423,"props":1349,"children":1351},{"className":1350},[],[1352],{"type":407,"value":1353},"node_modules/.pnpm/foo/node_modules",{"type":407,"value":1355},"。如果有依赖依赖了同一份（同一版本）的 ",{"type":401,"tag":423,"props":1357,"children":1359},{"className":1358},[],[1360],{"type":407,"value":766},{"type":407,"value":1362},"，那么它们的真实地址都是一样的 ",{"type":401,"tag":423,"props":1364,"children":1366},{"className":1365},[],[1367],{"type":407,"value":1368},"node_modules/.pnpm/foo/node_modules/foo",{"type":407,"value":1370},"，这样就避免依赖分身问题。",{"type":401,"tag":417,"props":1372,"children":1373},{},[1374],{"type":401,"tag":1375,"props":1376,"children":1379},"img",{"alt":1377,"src":1378},"Modules Mapping in pnpm","https://mgear-image.oss-cn-shanghai.aliyuncs.com/image/other/20220317192927.png",[],{"type":401,"tag":417,"props":1381,"children":1382},{},[1383,1384,1391,1393],{"type":407,"value":1199},{"type":401,"tag":1201,"props":1385,"children":1388},{"href":1386,"rel":1387},"https://pnpm.io/blog/2020/05/27/flat-node-modules-is-not-the-only-way",[1205],[1389],{"type":407,"value":1390},"Flat node_modules is not the only way | @pnpm",{"type":407,"value":1392},"、",{"type":401,"tag":1201,"props":1394,"children":1397},{"href":1395,"rel":1396},"https://pnpm.io/symlinked-node-modules-structure",[1205],[1398],{"type":407,"value":1399},"Symlinked node_modules structure | @pnpm",{"type":401,"tag":410,"props":1401,"children":1403},{"id":1402},"如何处理同级依赖",[1404],{"type":407,"value":1405},"如何处理同级依赖？",{"type":401,"tag":417,"props":1407,"children":1408},{},[1409,1411,1417,1419,1425,1427,1433,1435,1441,1443,1449,1450,1456],{"type":407,"value":1410},"当项目的两个包 A、B 依赖依赖了同一版本的 C，但是却安装了不同版本的 C 的同级依赖 D@1.0 和 D@1.1，这时，A 依赖的 C 的真实地址是 ",{"type":401,"tag":423,"props":1412,"children":1414},{"className":1413},[],[1415],{"type":407,"value":1416},".pnpm/C_D@1.0/node_modules/C",{"type":407,"value":1418},"，B 依赖的 C 的真实地址是 ",{"type":401,"tag":423,"props":1420,"children":1422},{"className":1421},[],[1423],{"type":407,"value":1424},".pnpm/C_D@1.1/node_modules/C",{"type":407,"value":1426},"。这样一来，两个 C 在读取其同级依赖时，分别读取了 ",{"type":401,"tag":423,"props":1428,"children":1430},{"className":1429},[],[1431],{"type":407,"value":1432},".pnpm/C_D@1.0/node_modules/D",{"type":407,"value":1434}," 和 ",{"type":401,"tag":423,"props":1436,"children":1438},{"className":1437},[],[1439],{"type":407,"value":1440},".pnpm/C_D@1.1/node_modules/D@1.0",{"type":407,"value":1442},"，分别对应真实地址 ",{"type":401,"tag":423,"props":1444,"children":1446},{"className":1445},[],[1447],{"type":407,"value":1448},".pnpm/D@1.0/node_modules/D",{"type":407,"value":1434},{"type":401,"tag":423,"props":1451,"children":1453},{"className":1452},[],[1454],{"type":407,"value":1455},".pnpm/D@1.1/node_modules/D",{"type":407,"value":1457},"。",{"type":401,"tag":417,"props":1459,"children":1460},{},[1461,1463,1469,1470,1476,1478,1484,1485,1490,1492,1498],{"type":407,"value":1462},"当同级依赖的深度增加时，层级结构也随之变得复杂。如果某个依赖 A 依赖了同一个 B，但是 B 子依赖 C 的版本不同（C@1.0 和 C@1.1），这样就创造出了指数级增长的软链数量。为了保证 B 能分别访问两个 C，B 的符号链接的被链接地址会有 ",{"type":401,"tag":423,"props":1464,"children":1466},{"className":1465},[],[1467],{"type":407,"value":1468},".pnpm/B_C@1.0/node_modules/B",{"type":407,"value":1434},{"type":401,"tag":423,"props":1471,"children":1473},{"className":1472},[],[1474],{"type":407,"value":1475},".pnpm/B_C@1.1/node_modules/B",{"type":407,"value":1477},"，而为此，A 的被链接地址也会有两个，",{"type":401,"tag":423,"props":1479,"children":1481},{"className":1480},[],[1482],{"type":407,"value":1483},".pnpm/A_C@1.0/node_modules/A",{"type":407,"value":1434},{"type":401,"tag":423,"props":1486,"children":1488},{"className":1487},[],[1489],{"type":407,"value":1483},{"type":407,"value":1491},"。从不同的 A 的被链接地址的上级目录 ",{"type":401,"tag":423,"props":1493,"children":1495},{"className":1494},[],[1496],{"type":407,"value":1497},"node_modules",{"type":407,"value":1499}," 可以读取到不同的 B 的被链目录，从不同的 B 可以读取到不同的 C。",{"type":401,"tag":469,"props":1501,"children":1503},{"code":1502,"language":407,"meta":394,"className":472,"style":394},"node_modules\n└── .pnpm\n    ├── a@1.0.0_c@1.0.0\n    │   └── node_modules\n    │       ├── a\n    │       └── b -> ../../b@1.0.0_c@1.0.0/node_modules/b\n    ├── a@1.0.0_c@1.1.0\n    │   └── node_modules\n    │       ├── a\n    │       └── b -> ../../b@1.0.0_c@1.1.0/node_modules/b\n    ├── b@1.0.0_c@1.0.0\n    │   └── node_modules\n    │       ├── b\n    │       └── c -> ../../c@1.0.0/node_modules/c\n    ├── b@1.0.0_c@1.1.0\n    │   └── node_modules\n    │       ├── b\n    │       └── c -> ../../c@1.1.0/node_modules/c\n    ├── c@1.0.0\n    ├── c@1.1.0\n",[1504],{"type":401,"tag":423,"props":1505,"children":1506},{"__ignoreMap":394},[1507,1515,1523,1531,1539,1547,1555,1563,1570,1577,1585,1593,1600,1608,1616,1624,1631,1638,1646,1654],{"type":401,"tag":478,"props":1508,"children":1509},{"class":480,"line":481},[1510],{"type":401,"tag":478,"props":1511,"children":1512},{},[1513],{"type":407,"value":1514},"node_modules\n",{"type":401,"tag":478,"props":1516,"children":1517},{"class":480,"line":490},[1518],{"type":401,"tag":478,"props":1519,"children":1520},{},[1521],{"type":407,"value":1522},"└── .pnpm\n",{"type":401,"tag":478,"props":1524,"children":1525},{"class":480,"line":499},[1526],{"type":401,"tag":478,"props":1527,"children":1528},{},[1529],{"type":407,"value":1530},"    ├── a@1.0.0_c@1.0.0\n",{"type":401,"tag":478,"props":1532,"children":1533},{"class":480,"line":508},[1534],{"type":401,"tag":478,"props":1535,"children":1536},{},[1537],{"type":407,"value":1538},"    │   └── node_modules\n",{"type":401,"tag":478,"props":1540,"children":1541},{"class":480,"line":517},[1542],{"type":401,"tag":478,"props":1543,"children":1544},{},[1545],{"type":407,"value":1546},"    │       ├── a\n",{"type":401,"tag":478,"props":1548,"children":1549},{"class":480,"line":526},[1550],{"type":401,"tag":478,"props":1551,"children":1552},{},[1553],{"type":407,"value":1554},"    │       └── b -> ../../b@1.0.0_c@1.0.0/node_modules/b\n",{"type":401,"tag":478,"props":1556,"children":1557},{"class":480,"line":888},[1558],{"type":401,"tag":478,"props":1559,"children":1560},{},[1561],{"type":407,"value":1562},"    ├── a@1.0.0_c@1.1.0\n",{"type":401,"tag":478,"props":1564,"children":1565},{"class":480,"line":916},[1566],{"type":401,"tag":478,"props":1567,"children":1568},{},[1569],{"type":407,"value":1538},{"type":401,"tag":478,"props":1571,"children":1572},{"class":480,"line":925},[1573],{"type":401,"tag":478,"props":1574,"children":1575},{},[1576],{"type":407,"value":1546},{"type":401,"tag":478,"props":1578,"children":1579},{"class":480,"line":965},[1580],{"type":401,"tag":478,"props":1581,"children":1582},{},[1583],{"type":407,"value":1584},"    │       └── b -> ../../b@1.0.0_c@1.1.0/node_modules/b\n",{"type":401,"tag":478,"props":1586,"children":1587},{"class":480,"line":974},[1588],{"type":401,"tag":478,"props":1589,"children":1590},{},[1591],{"type":407,"value":1592},"    ├── b@1.0.0_c@1.0.0\n",{"type":401,"tag":478,"props":1594,"children":1595},{"class":480,"line":983},[1596],{"type":401,"tag":478,"props":1597,"children":1598},{},[1599],{"type":407,"value":1538},{"type":401,"tag":478,"props":1601,"children":1602},{"class":480,"line":992},[1603],{"type":401,"tag":478,"props":1604,"children":1605},{},[1606],{"type":407,"value":1607},"    │       ├── b\n",{"type":401,"tag":478,"props":1609,"children":1610},{"class":480,"line":1034},[1611],{"type":401,"tag":478,"props":1612,"children":1613},{},[1614],{"type":407,"value":1615},"    │       └── c -> ../../c@1.0.0/node_modules/c\n",{"type":401,"tag":478,"props":1617,"children":1618},{"class":480,"line":1080},[1619],{"type":401,"tag":478,"props":1620,"children":1621},{},[1622],{"type":407,"value":1623},"    ├── b@1.0.0_c@1.1.0\n",{"type":401,"tag":478,"props":1625,"children":1626},{"class":480,"line":1088},[1627],{"type":401,"tag":478,"props":1628,"children":1629},{},[1630],{"type":407,"value":1538},{"type":401,"tag":478,"props":1632,"children":1633},{"class":480,"line":1096},[1634],{"type":401,"tag":478,"props":1635,"children":1636},{},[1637],{"type":407,"value":1607},{"type":401,"tag":478,"props":1639,"children":1640},{"class":480,"line":1110},[1641],{"type":401,"tag":478,"props":1642,"children":1643},{},[1644],{"type":407,"value":1645},"    │       └── c -> ../../c@1.1.0/node_modules/c\n",{"type":401,"tag":478,"props":1647,"children":1648},{"class":480,"line":1119},[1649],{"type":401,"tag":478,"props":1650,"children":1651},{},[1652],{"type":407,"value":1653},"    ├── c@1.0.0\n",{"type":401,"tag":478,"props":1655,"children":1656},{"class":480,"line":1128},[1657],{"type":401,"tag":478,"props":1658,"children":1659},{},[1660],{"type":407,"value":1661},"    ├── c@1.1.0\n",{"type":401,"tag":417,"props":1663,"children":1664},{},[1665,1666],{"type":407,"value":1199},{"type":401,"tag":1201,"props":1667,"children":1670},{"href":1668,"rel":1669},"https://pnpm.io/how-peers-are-resolved",[1205],[1671],{"type":407,"value":1672},"How peers are resolved | @pnpm",{"type":401,"tag":410,"props":1674,"children":1676},{"id":1675},"怎样兼容-nodejs-模块加载顺序",[1677],{"type":407,"value":1678},"怎样兼容 NodeJS 模块加载顺序？",{"type":401,"tag":417,"props":1680,"children":1681},{},[1682],{"type":407,"value":1683},"不论系统自带的模块，NodeJS 加载模块的顺序是这样的：",{"type":401,"tag":545,"props":1685,"children":1686},{},[1687,1692,1697,1702],{"type":401,"tag":549,"props":1688,"children":1689},{},[1690],{"type":407,"value":1691},"读取本文件夹中 node_modules 中对应名字的文件夹的 package.json，并寻找 main 字段对应的路径",{"type":401,"tag":549,"props":1693,"children":1694},{},[1695],{"type":407,"value":1696},"读取本文件夹中 node_modules 中对应名字的 js 文件",{"type":401,"tag":549,"props":1698,"children":1699},{},[1700],{"type":407,"value":1701},"读取本文件夹中 node_modules 中对应名字文件夹中的 index.js 文件",{"type":401,"tag":549,"props":1703,"children":1704},{},[1705],{"type":407,"value":1706},"跳出本文件夹，继续前三个步骤",{"type":401,"tag":417,"props":1708,"children":1709},{},[1710,1712,1717,1719,1725,1727,1733,1735,1740,1742,1748,1750,1756],{"type":407,"value":1711},"因为项目 ",{"type":401,"tag":423,"props":1713,"children":1715},{"className":1714},[],[1716],{"type":407,"value":1275},{"type":407,"value":1718}," 是 ",{"type":401,"tag":423,"props":1720,"children":1722},{"className":1721},[],[1723],{"type":407,"value":1724},".pnpm/bar/node_modules/bar",{"type":407,"value":1726}," 的符号链接，所以项目文件可以直接读取 ",{"type":401,"tag":423,"props":1728,"children":1730},{"className":1729},[],[1731],{"type":407,"value":1732},"node_modules/bar/x.js",{"type":407,"value":1734},"。同时，如果 ",{"type":401,"tag":423,"props":1736,"children":1738},{"className":1737},[],[1739],{"type":407,"value":1732},{"type":407,"value":1741}," 需要加载 ",{"type":401,"tag":423,"props":1743,"children":1745},{"className":1744},[],[1746],{"type":407,"value":1747},"foo/x.js",{"type":407,"value":1749},"，那么在上述步骤的第 4 步，就能找到 ",{"type":401,"tag":423,"props":1751,"children":1753},{"className":1752},[],[1754],{"type":407,"value":1755},".pnpm/bar/node_modules/foo/x.js",{"type":407,"value":1757}," 文件。",{"type":401,"tag":410,"props":1759,"children":1761},{"id":1760},"为什么其模块层次只是比较严格的semistrict",[1762],{"type":407,"value":1763},"为什么其模块层次只是“比较严格的”（semistrict）？",{"type":401,"tag":417,"props":1765,"children":1766},{},[1767],{"type":407,"value":1768},"由 NodeJS 模块加载规则可知，在 pnpm 创造的依赖层次下，一个依赖的子依赖间仍有相互访问的能力。",{"type":401,"tag":410,"props":1770,"children":1772},{"id":1771},"为什么能节约磁盘空间",[1773],{"type":407,"value":1774},"为什么能节约磁盘空间？",{"type":401,"tag":417,"props":1776,"children":1777},{},[1778,1780,1786,1788,1794,1796,1802],{"type":407,"value":1779},"由 pnpm 创造的 node_modules 层级结构可以知道，所有依赖的符号链接的真实地址都在 ",{"type":401,"tag":423,"props":1781,"children":1783},{"className":1782},[],[1784],{"type":407,"value":1785},".pnpm/package-name/node_modules/package-name",{"type":407,"value":1787}," 这个文件夹中。这种文件夹会通过硬链接的形式链接到 ",{"type":401,"tag":423,"props":1789,"children":1791},{"className":1790},[],[1792],{"type":407,"value":1793},"user-document/.pnpm-store",{"type":407,"value":1795}," 中，所以相同的包只会存一份，也就是 ",{"type":401,"tag":423,"props":1797,"children":1799},{"className":1798},[],[1800],{"type":407,"value":1801},".pnpm-store/package-name",{"type":407,"value":1457},{"type":401,"tag":410,"props":1804,"children":1806},{"id":1805},"软硬链接有什么问题",[1807],{"type":407,"value":1808},"软硬链接有什么问题？",{"type":401,"tag":1810,"props":1811,"children":1812},"ul",{},[1813,1818,1823,1828],{"type":401,"tag":549,"props":1814,"children":1815},{},[1816],{"type":407,"value":1817},"特定的软链结构会导致某些应用出现死循环",{"type":401,"tag":549,"props":1819,"children":1820},{},[1821],{"type":407,"value":1822},"硬链接是同一份文件，不便调试",{"type":401,"tag":549,"props":1824,"children":1825},{},[1826],{"type":407,"value":1827},"软链接在非 SSD 上的读写会有性能损耗",{"type":401,"tag":549,"props":1829,"children":1830},{},[1831],{"type":407,"value":1832},"pnpm 创造的 node_modules 层级结构会破坏某些依赖依赖了相对路径的依赖的逻辑",{"type":401,"tag":417,"props":1834,"children":1835},{},[1836,1837],{"type":407,"value":1199},{"type":401,"tag":1201,"props":1838,"children":1841},{"href":1839,"rel":1840},"https://zhuanlan.zhihu.com/p/553804414",[1205],[1842],{"type":407,"value":1843},"精读 pnpm",{"type":401,"tag":402,"props":1845,"children":1847},{"id":1846},"常见问题",[1848],{"type":407,"value":1846},{"type":401,"tag":410,"props":1850,"children":1852},{"id":1851},"pnpm-找不到全局路径的解决方法",[1853],{"type":407,"value":1854},"PNPM 找不到全局路径的解决方法？",{"type":401,"tag":417,"props":1856,"children":1857},{},[1858],{"type":407,"value":1859},"尽管设置了全局变量，也重新安装了最新版本 PNPM，也执行了 pnpm setup，却仍然报错找不到全局路径的临时解决方案：",{"type":401,"tag":469,"props":1861,"children":1865},{"code":1862,"language":1863,"meta":394,"className":1864,"style":394},"$PNPM_HOME=\"\u003Cpath>\" | pnpm install -g xxx\n","powershell","language-powershell shiki shiki-themes material-theme-lighter github-light github-dark monokai",[1866],{"type":401,"tag":423,"props":1867,"children":1868},{"__ignoreMap":394},[1869],{"type":401,"tag":478,"props":1870,"children":1871},{"class":480,"line":481},[1872,1877,1882,1887,1892,1897,1901,1906,1911,1916],{"type":401,"tag":478,"props":1873,"children":1874},{"style":680},[1875],{"type":407,"value":1876},"$",{"type":401,"tag":478,"props":1878,"children":1879},{"style":736},[1880],{"type":407,"value":1881},"PNPM_HOME",{"type":401,"tag":478,"props":1883,"children":1884},{"style":751},[1885],{"type":407,"value":1886},"=",{"type":401,"tag":478,"props":1888,"children":1889},{"style":757},[1890],{"type":407,"value":1891},"\"",{"type":401,"tag":478,"props":1893,"children":1894},{"style":763},[1895],{"type":407,"value":1896},"\u003Cpath>",{"type":401,"tag":478,"props":1898,"children":1899},{"style":757},[1900],{"type":407,"value":1891},{"type":401,"tag":478,"props":1902,"children":1903},{"style":751},[1904],{"type":407,"value":1905}," |",{"type":401,"tag":478,"props":1907,"children":1908},{"style":736},[1909],{"type":407,"value":1910}," pnpm install ",{"type":401,"tag":478,"props":1912,"children":1913},{"style":751},[1914],{"type":407,"value":1915},"-",{"type":401,"tag":478,"props":1917,"children":1918},{"style":736},[1919],{"type":407,"value":1920},"g xxx\n",{"type":401,"tag":410,"props":1922,"children":1924},{"id":1923},"pnpm-速度变慢了",[1925],{"type":407,"value":1926},"PNPM 速度变慢了？",{"type":401,"tag":417,"props":1928,"children":1929},{},[1930],{"type":407,"value":1931},"今天逛官网时，偶然发现 Readme 中的 benchmark 过时了。它说“要比 Yarn Classic 和 npm “快两倍以上，但是从 benchmark 来看，他要比 Yarn 和 npm 慢了不少。以后启用 NodeJS 20 以上时，如果问题得不到改善，我应该会重新选择 npm 而不是 pnpm，鉴于幽灵依赖和依赖分身带来的问题是可排查可解决的，而速度是解决不了的问题。",{"type":401,"tag":417,"props":1933,"children":1934},{},[1935],{"type":401,"tag":1375,"props":1936,"children":1939},{"alt":1937,"src":1938},"pnpm vs npm vs yarn benchmark","https://mgear-image.oss-cn-shanghai.aliyuncs.com/image/other/20230605235736.png",[],{"type":401,"tag":417,"props":1941,"children":1942},{},[1943,1945],{"type":407,"value":1944},"相关见：",{"type":401,"tag":1201,"props":1946,"children":1949},{"href":1947,"rel":1948},"https://github.com/pnpm/pnpm/issues/6447",[1205],[1950],{"type":407,"value":1951},"pnpm seems to be consistently slower than yarn (classic)",{"type":401,"tag":410,"props":1953,"children":1955},{"id":1954},"和-bun-在安装速度上的对比",[1956],{"type":407,"value":1957},"和 Bun 在安装速度上的对比？",{"type":401,"tag":417,"props":1959,"children":1960},{},[1961],{"type":407,"value":1962},"有锁文件、本地缓存，无 node_modules 的情况下，bun 要比 pnpm 安装至少快 3 倍。",{"type":401,"tag":1810,"props":1964,"children":1965},{},[1966,1971],{"type":401,"tag":549,"props":1967,"children":1968},{},[1969],{"type":407,"value":1970},"一个原因是 pnpm、yarn 等工具会在安装时请求最新的 metadata，而 bun 使用的 metadata 源于本地缓存的 metadata。",{"type":401,"tag":549,"props":1972,"children":1973},{},[1974],{"type":407,"value":1975},"另一个原因是 pnpm 在创建 node_modules 层次结构是使用了大量的 symlink，相比其他包管理工具仅使用复制或 hardlink 有更多系统调用。",{"type":401,"tag":417,"props":1977,"children":1978},{},[1979],{"type":407,"value":1980},"所以如果想使 pnpm 更快的安装，可以使用 prefer-offline 选项，以及，node-linker=hoisted 也许有用。",{"type":401,"tag":417,"props":1982,"children":1983},{},[1984,1985],{"type":407,"value":1199},{"type":401,"tag":1201,"props":1986,"children":1989},{"href":1987,"rel":1988},"https://github.com/pnpm/pnpm/issues/7391",[1205],[1990],{"type":407,"value":1991},"Bun.sh-like Module Resolution",{"type":401,"tag":410,"props":1993,"children":1995},{"id":1994},"关于-v8-版本的变化",[1996],{"type":407,"value":1997},"关于 V8 版本的变化？",{"type":401,"tag":1810,"props":1999,"children":2000},{},[2001,2020,2036,2047,2052,2057,2062],{"type":401,"tag":549,"props":2002,"children":2003},{},[2004,2010,2012,2018],{"type":401,"tag":423,"props":2005,"children":2007},{"className":2006},[],[2008],{"type":407,"value":2009},"resolve-peers-from-workspace-root",{"type":407,"value":2011}," is ",{"type":401,"tag":423,"props":2013,"children":2015},{"className":2014},[],[2016],{"type":407,"value":2017},"true",{"type":407,"value":2019}," by default",{"type":401,"tag":549,"props":2021,"children":2022},{},[2023,2029,2030,2035],{"type":401,"tag":423,"props":2024,"children":2026},{"className":2025},[],[2027],{"type":407,"value":2028},"auto-install-peers",{"type":407,"value":2011},{"type":401,"tag":423,"props":2031,"children":2033},{"className":2032},[],[2034],{"type":407,"value":2017},{"type":407,"value":2019},{"type":401,"tag":549,"props":2037,"children":2038},{},[2039,2045],{"type":401,"tag":423,"props":2040,"children":2042},{"className":2041},[],[2043],{"type":407,"value":2044},"dedupe-peer-dependents",{"type":407,"value":2046}," set to true by default",{"type":401,"tag":549,"props":2048,"children":2049},{},[2050],{"type":407,"value":2051},"停止 NodeJS 14 的支持",{"type":401,"tag":549,"props":2053,"children":2054},{},[2055],{"type":407,"value":2056},"lockfile v6 by default",{"type":401,"tag":549,"props":2058,"children":2059},{},[2060],{"type":407,"value":2061},"resolution mode（prebundle、time-based、lowest-direct）default set to lowest-based，需要注意手动升级，尤其是在没有锁文件的情况",{"type":401,"tag":549,"props":2063,"children":2064},{},[2065,2067,2073],{"type":407,"value":2066},"only deply ",{"type":401,"tag":423,"props":2068,"children":2070},{"className":2069},[],[2071],{"type":407,"value":2072},"files",{"type":407,"value":2074}," field when the field exist",{"type":401,"tag":410,"props":2076,"children":2078},{"id":2077},"pnp-模式下的依赖提升设置",[2079],{"type":407,"value":2080},"PnP 模式下的依赖提升设置？",{"type":401,"tag":417,"props":2082,"children":2083},{},[2084,2086,2092],{"type":407,"value":2085},"默认的 node_modules 依赖的层级处于严格和不严格之间的水平（semi-strict）。使用最严格的设置需要打开 PnP 模式，因为在 monorepo 中 PnP 模式中，就算开启了 ",{"type":401,"tag":423,"props":2087,"children":2089},{"className":2088},[],[2090],{"type":407,"value":2091},"hoist=false",{"type":407,"value":2093}," 也不会禁用 workspace root 的依赖",{"type":401,"tag":469,"props":2095,"children":2097},{"code":2096},"node-linker=pnp\nsymlink=false\n",[2098],{"type":401,"tag":423,"props":2099,"children":2100},{"__ignoreMap":394},[2101],{"type":407,"value":2096},{"type":401,"tag":417,"props":2103,"children":2104},{},[2105,2106],{"type":407,"value":1199},{"type":401,"tag":1201,"props":2107,"children":2110},{"href":2108,"rel":2109},"https://pnpm.io/blog/2020/10/17/node-modules-configuration-options-with-pnpm",[1205],[2111],{"type":407,"value":2112},"Node-Modules configuration options with pnpm",{"type":401,"tag":410,"props":2114,"children":2116},{"id":2115},"在-windows-dev-driver-上可能会碰到的问题",[2117],{"type":407,"value":2118},"在 Windows Dev Driver 上可能会碰到的问题？",{"type":401,"tag":417,"props":2120,"children":2121},{},[2122],{"type":407,"value":2123},"2024 年初 pnpm 实现了 Dev Driver 上的 Copy on Write 功能，但可能会碰到变慢的问题。",{"type":401,"tag":417,"props":2125,"children":2126},{},[2127,2128],{"type":407,"value":1199},{"type":401,"tag":1201,"props":2129,"children":2132},{"href":2130,"rel":2131},"https://github.com/pnpm/pnpm/issues/7547",[1205],[2133],{"type":407,"value":2134},"pnpm lately slow and pnpx stuck at installing deps using executable package",{"type":401,"tag":2136,"props":2137,"children":2138},"style",{},[2139],{"type":407,"value":2140},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":394,"searchDepth":490,"depth":490,"links":2142},[2143,2144,2145],{"id":404,"depth":490,"text":408},{"id":1211,"depth":490,"text":1211},{"id":1846,"depth":490,"text":1846},"markdown","content:6.maps:_workflow:package-manager:pnpm.md","content","6.maps/_workflow/package-manager/pnpm.md","md",[2152,2155],{"_path":2153,"title":2154,"description":394},"/maps/_workflow/package-manager/npm","NPM",{"_path":2156,"title":2157,"description":394},"/maps/_workflow/packer","打包工具",1718301106543]