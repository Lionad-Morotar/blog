[{"data":1,"prerenderedAt":2097},["Reactive",2],{"navigation":3,"/maps/_workflow/package-manager/pnpm":383,"/maps/_workflow/package-manager/pnpm-surround":2090},[4,32,80,96,123,129,135,366,372,378],{"title":5,"_path":6,"children":7},"心流思绪 / Heart Flows","/flows",[8,11,14,17,20,23,26,29],{"title":9,"_path":10},"📕 狮子的书单推荐","/flows/books",{"title":12,"_path":13},"🌃 长夜梦","/flows/long-night-dream",{"title":15,"_path":16},"🌌 万物联结与幸福感","/flows/everything",{"title":18,"_path":19},"⌛ 偷取时间","/flows/stealing-time-from-god",{"title":21,"_path":22},"🌆 表达和孤独","/flows/expression-and-loneliness",{"title":24,"_path":25},"🌧️ 我的腼腆","/flows/shy",{"title":27,"_path":28},"🥛 新工作，喝新饮料","/flows/drinking-while-thinking",{"title":30,"_path":31},"📝 心流归档","/flows/fold",{"title":33,"_path":34,"children":35},"技术博客 / Coder","/articles",[36,38,41,44,47,50,53,56,59,62,65,68,71,74,77],{"title":37,"_path":34},"🦁 为什么我要写博客",{"title":39,"_path":40},"🧊 模板解析器轻考古","/articles/micro-templating",{"title":42,"_path":43},"Ⓜ️ Mini CSS Parser","/articles/mini-css-parser",{"title":45,"_path":46},"🚩 向AI咨询前端问题","/articles/use-gpt-learn-complex-frontend",{"title":48,"_path":49},"⛸️ 怎样定制复杂组件的自定义滚动条？","/articles/use-scrollbars",{"title":51,"_path":52},"⚖️ 统一多组件库的层叠顺序","/articles/zindex-manager",{"title":54,"_path":55},"🕷️ 滑动验证码破解思路","/articles/crack-the-slider",{"title":57,"_path":58},"🌟 探秘 CSS 光影效果","/articles/css-light-travel",{"title":60,"_path":61},"🍲 设计模式与 JS 魔法锅","/articles/design-patterns-and-js-magic-pot",{"title":63,"_path":64},"🌐 Anysort：灵活、优雅的多属性排序","/articles/anysort-2th",{"title":66,"_path":67},"💫 CSS 幻术 | 抗锯齿","/articles/css-poaa",{"title":69,"_path":70},"❓ 用纯CSS判断鼠标进入的方向","/articles/css-judge-direction",{"title":72,"_path":73},"📝 你本可以少写些 if-else","/articles/no-more-if-else",{"title":75,"_path":76},"🚝 四十二篇系列","/articles/fourty-two",{"title":78,"_path":79},"📝 技术博客归档","/articles/fold",{"title":81,"_path":82,"children":83},"造物 / Make","/tools",[84,87,90,93],{"title":85,"_path":86},"🌐 AnySort","/tools/anysort",{"title":88,"_path":89},"⛸️ UseScrollbar","/tools/use-scrollbar",{"title":91,"_path":92},"👓 Crapto","/tools/crypto-inline",{"title":94,"_path":95},"🖨️ any-to-base64","/tools/any-to-base64",{"title":97,"_path":98,"children":99},"吉他剧场 / Music","/music",[100,102,105,108,111,114,117,120],{"title":101,"_path":98},"🎸 FingerStyle！",{"title":103,"_path":104},"🌬️ 等待的风","/music/wind",{"title":106,"_path":107},"💕 约定的海洋","/music/ocean",{"title":109,"_path":110},"🎼 Wings~You are the Hero！","/music/wings-you-are-the-hero",{"title":112,"_path":113},"🌏 残酷天使的行动纲领","/music/eva",{"title":115,"_path":116},"🏔️ 奇跡の山","/music/miracle-mountain",{"title":118,"_path":119},"🍷 Wu Wei","/music/wu-wei",{"title":121,"_path":122},"🌅 无题","/music/untitled",{"title":124,"_path":125,"children":126},"画点什么 / Paint","/paint",[127],{"title":128,"_path":125},"🚧 正在施工",{"title":130,"_path":131,"children":132},"知识地图 / Maps","/maps",[133],{"title":134,"_path":131},"🏁 知识地图",{"title":136,"_path":137,"children":138},"零散的笔记 / Gists","/gists",[139,141,144,147,150,153,156,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255,258,261,264,267,270,273,276,279,282,285,288,291,294,297,300,303,306,309,312,315,318,321,324,327,330,333,336,339,342,345,348,351,354,357,360,363],{"title":140,"_path":137},"🧊 Gists",{"title":142,"_path":143},"网站的可访问性","/gists/accessibility",{"title":145,"_path":146},"图片模糊","/gists/blur",{"title":148,"_path":149},"渲染相关笔记","/gists/c4d",{"title":151,"_path":152},"CDN 问题记录","/gists/cdn",{"title":154,"_path":155},"消毒剂","/gists/cleaner",{"title":157,"_path":158},"Windows Command","/gists/cmd",{"title":160,"_path":161},"Command","/gists/command",{"title":163,"_path":164},"复杂科学","/gists/complexity-science",{"title":166,"_path":167},"宇宙","/gists/cosmos",{"title":169,"_path":170},"C++","/gists/cpp",{"title":172,"_path":173},"Data Structure","/gists/data-structure",{"title":175,"_path":176},"DEPRESSION","/gists/depression",{"title":178,"_path":179},"设计模式","/gists/design-patterns",{"title":181,"_path":182},"Developer Experience","/gists/developer-experience",{"title":184,"_path":185},"Device Metrics","/gists/device-metrix",{"title":187,"_path":188},"ECMAScript Language Specification","/gists/ecmascript-specification",{"title":190,"_path":191},"正则表达式","/gists/eegex",{"title":193,"_path":194},"Emoji","/gists/emoji",{"title":196,"_path":197},"工程","/gists/engineering",{"title":199,"_path":200},"熵","/gists/entropy",{"title":202,"_path":203},"Environment","/gists/environment",{"title":205,"_path":206},"Erlang","/gists/erlang",{"title":208,"_path":209},"逃离塔克夫","/gists/escape-from-tarkov",{"title":211,"_path":212},"ESNext (ES6-ES11)","/gists/esnext",{"title":214,"_path":215},"Eval！","/gists/eval",{"title":217,"_path":218},"Flutter","/gists/flutter",{"title":220,"_path":221},"字体","/gists/font",{"title":223,"_path":224},"JS 函数式编程","/gists/functional",{"title":226,"_path":227},"Google C++ Standard","/gists/google-cpp-standard",{"title":229,"_path":230},"双向链接完全体","/gists/graph",{"title":232,"_path":233},"Hardwares","/gists/hardwares",{"title":235,"_path":236},"哈希冲突","/gists/hash-collision",{"title":238,"_path":239},"信息设计","/gists/information-design",{"title":241,"_path":242},"InstantPage","/gists/instant.page",{"title":244,"_path":245},"ISUX 遇见大数据可视化系列","/gists/isux-data-visualization",{"title":247,"_path":248},"KVStore","/gists/key-value-db",{"title":250,"_path":251},"Kubernetes","/gists/kubernetes",{"title":253,"_path":254},"Makefile","/gists/makefile",{"title":256,"_path":257},"Markdown Inline Style","/gists/markdown-nice",{"title":259,"_path":260},"小程序","/gists/miniapp",{"title":262,"_path":263},"减小页面快照体积","/gists/minify-html",{"title":265,"_path":266},"mklink","/gists/mklink",{"title":268,"_path":269},"Mock","/gists/mock",{"title":271,"_path":272},"多端应用","/gists/multy-end-app",{"title":274,"_path":275},"神经科学","/gists/neuroscience",{"title":277,"_path":278},"OO","/gists/oo",{"title":280,"_path":281},"Opinioned Personal Folder","/gists/opinioned-personal-folder",{"title":283,"_path":284},"人物","/gists/person",{"title":286,"_path":287},"PInvoke","/gists/pinvoke",{"title":289,"_path":290},"像素","/gists/pixel",{"title":292,"_path":293},"PowerShell","/gists/powershell",{"title":295,"_path":296},"量子","/gists/quantum",{"title":298,"_path":299},"保持好奇心","/gists/questions",{"title":301,"_path":302},"React Native","/gists/react-native",{"title":304,"_path":305},"博客改版碰到的浏览器平滑滚动问题","/gists/scroll",{"title":307,"_path":308},"SEO","/gists/seo",{"title":310,"_path":311},"Shader","/gists/shader",{"title":313,"_path":314},"Shape Up","/gists/shape-up",{"title":316,"_path":317},"睡觉","/gists/sleep",{"title":319,"_path":320},"States","/gists/states",{"title":322,"_path":323},"Storage","/gists/storage",{"title":325,"_path":326},"音视频流处理","/gists/stream-cli",{"title":328,"_path":329},"Symbol","/gists/symbol",{"title":331,"_path":332},"系统论","/gists/systems-theory",{"title":334,"_path":335},"Taro","/gists/taro",{"title":337,"_path":338},"任务切片","/gists/task-slice",{"title":340,"_path":341},"技术偏好","/gists/tech-dudge",{"title":343,"_path":344},"Untitled","/gists/untitled",{"title":346,"_path":347},"可变字体","/gists/variable-font",{"title":349,"_path":350},"视觉错觉","/gists/visual-illusion",{"title":352,"_path":353},"SS(SSR)","/gists/vpn",{"title":355,"_path":356},"VS Code 插件开发","/gists/vscode-plugin",{"title":358,"_path":359},"Web Components","/gists/web-components",{"title":361,"_path":362},"Windows","/gists/windows",{"title":364,"_path":365},"查缺补漏","/gists/wrong",{"title":367,"_path":368,"children":369},"代码笔记 / Gists","/source-code",[370],{"title":371,"_path":368},"🚄 代码笔记",{"title":373,"_path":374,"children":375},"我 / Abount","/hire",[376],{"title":377,"_path":374},"📬 技术简历",{"title":379,"_path":380,"children":381},"todo","/todo",[382],{"title":379,"_path":380},{"_path":384,"_dir":385,"_draft":386,"_partial":387,"_locale":388,"title":389,"description":388,"body":390,"_type":2085,"_id":2086,"_source":2087,"_file":2088,"_extension":2089},"/maps/_workflow/package-manager/pnpm","package-manager",false,true,"","Pnpm",{"type":391,"children":392,"toc":2080},"root",[393,402,409,423,429,439,444,450,461,526,532,537,591,597,602,607,612,630,636,647,1188,1202,1207,1213,1244,1250,1331,1364,1373,1393,1399,1451,1493,1655,1666,1672,1677,1700,1751,1757,1762,1768,1796,1802,1826,1837,1842,1848,1853,1914,1920,1925,1933,1945,1951,2028,2034,2039,2055,2063,2074],{"type":394,"tag":395,"props":396,"children":398},"element","h2",{"id":397},"api-细节和配置项",[399],{"type":400,"value":401},"text","API 细节和配置项",{"type":394,"tag":403,"props":404,"children":406},"h4",{"id":405},"pnpm-import",[407],{"type":400,"value":408},"pnpm import",{"type":394,"tag":410,"props":411,"children":412},"p",{},[413,415,421],{"type":400,"value":414},"使用 ",{"type":394,"tag":416,"props":417,"children":419},"code",{"className":418},[],[420],{"type":400,"value":408},{"type":400,"value":422}," 可以将 package-lock、npm-shrinkwrap 和 yarn.lock 转换为 pnpm-lock 文件。",{"type":394,"tag":403,"props":424,"children":426},{"id":425},"pnpm-fetch",[427],{"type":400,"value":428},"pnpm fetch",{"type":394,"tag":410,"props":430,"children":431},{},[432,437],{"type":394,"tag":416,"props":433,"children":435},{"className":434},[],[436],{"type":400,"value":428},{"type":400,"value":438}," 它跳过了 package.json 文件，允许项目在只有 pnpm-lock 文件的情况下创建 .pnpm 虚拟仓库。这有利于 docker 构建，因为 package.json 经常因为非依赖变化的改动而改动，导致 docker layer 失效。",{"type":394,"tag":410,"props":440,"children":441},{},[442],{"type":400,"value":443},"相比 yarn 和 npm，在脱离 package.json 的情况下，单靠 package-lock（或 yarn-lock），yarn 和 npm 没有办法确定依赖版本，因为其 package-lock 中，依赖的版本号不是固定版本号。",{"type":394,"tag":403,"props":445,"children":447},{"id":446},"pnpm-why",[448],{"type":400,"value":449},"pnpm why",{"type":394,"tag":410,"props":451,"children":452},{},[453,454,459],{"type":400,"value":414},{"type":394,"tag":416,"props":455,"children":457},{"className":456},[],[458],{"type":400,"value":449},{"type":400,"value":460}," 可以列出项目内依赖了某个依赖的依赖，比如说找到项目内使用了 lodash 的包。",{"type":394,"tag":462,"props":463,"children":466},"pre",{"code":464,"language":400,"meta":388,"className":465,"style":388},"dependencies:\nelement-plus 2.2.20\n├── lodash 4.17.21\n└─┬ lodash-unified 1.0.3\n  └── lodash 4.17.21 peer\n...\n","language-text shiki shiki-themes material-theme-lighter github-light github-dark monokai",[467],{"type":394,"tag":416,"props":468,"children":469},{"__ignoreMap":388},[470,481,490,499,508,517],{"type":394,"tag":471,"props":472,"children":475},"span",{"class":473,"line":474},"line",1,[476],{"type":394,"tag":471,"props":477,"children":478},{},[479],{"type":400,"value":480},"dependencies:\n",{"type":394,"tag":471,"props":482,"children":484},{"class":473,"line":483},2,[485],{"type":394,"tag":471,"props":486,"children":487},{},[488],{"type":400,"value":489},"element-plus 2.2.20\n",{"type":394,"tag":471,"props":491,"children":493},{"class":473,"line":492},3,[494],{"type":394,"tag":471,"props":495,"children":496},{},[497],{"type":400,"value":498},"├── lodash 4.17.21\n",{"type":394,"tag":471,"props":500,"children":502},{"class":473,"line":501},4,[503],{"type":394,"tag":471,"props":504,"children":505},{},[506],{"type":400,"value":507},"└─┬ lodash-unified 1.0.3\n",{"type":394,"tag":471,"props":509,"children":511},{"class":473,"line":510},5,[512],{"type":394,"tag":471,"props":513,"children":514},{},[515],{"type":400,"value":516},"  └── lodash 4.17.21 peer\n",{"type":394,"tag":471,"props":518,"children":520},{"class":473,"line":519},6,[521],{"type":394,"tag":471,"props":522,"children":523},{},[524],{"type":400,"value":525},"...\n",{"type":394,"tag":403,"props":527,"children":529},{"id":528},"pnpm-run",[530],{"type":400,"value":531},"pnpm run",{"type":394,"tag":410,"props":533,"children":534},{},[535],{"type":400,"value":536},"与其它包管理器的一些区别：",{"type":394,"tag":538,"props":539,"children":540},"ol",{},[541,567,572],{"type":394,"tag":542,"props":543,"children":544},"li",{},[545,551,553,559,561],{"type":394,"tag":416,"props":546,"children":548},{"className":547},[],[549],{"type":400,"value":550},"pnpm run script-name",{"type":400,"value":552},"，如果 ",{"type":394,"tag":416,"props":554,"children":556},{"className":555},[],[557],{"type":400,"value":558},"script-name",{"type":400,"value":560}," 没有和 pnpm 内置指令冲突，则可以省略 ",{"type":394,"tag":416,"props":562,"children":564},{"className":563},[],[565],{"type":400,"value":566},"run",{"type":394,"tag":542,"props":568,"children":569},{},[570],{"type":400,"value":571},"run 指令默认不会执行 pre 和 post 钩子函数，因为 pnpm 认为这使任务流更难理解",{"type":394,"tag":542,"props":573,"children":574},{},[575,581,583,589],{"type":394,"tag":416,"props":576,"children":578},{"className":577},[],[579],{"type":400,"value":580},"shell-emulator",{"type":400,"value":582}," 选项启用后，将使用 JS 解析指令，这使得在不兼容 POSIX 的环境执行类似 ",{"type":394,"tag":416,"props":584,"children":586},{"className":585},[],[587],{"type":400,"value":588},"NODE_ENV=test node ./index",{"type":400,"value":590}," 的指令会报错的系统也能正常运行这种指令",{"type":394,"tag":403,"props":592,"children":594},{"id":593},"pnpm-pack",[595],{"type":400,"value":596},"pnpm pack",{"type":394,"tag":410,"props":598,"children":599},{},[600],{"type":400,"value":601},"将项目打包为 tarball 压缩包（.tgz）。打包的文件范围和 pnpm publish 一样。",{"type":394,"tag":403,"props":603,"children":605},{"id":604},"shared-workspace-lockfile",[606],{"type":400,"value":604},{"type":394,"tag":410,"props":608,"children":609},{},[610],{"type":400,"value":611},"在 workspace 间共享一份 package-lock 文件。这个配置开启后，所有子包的依赖都会被提升到 workspace 根目录，这带来了几个好处：",{"type":394,"tag":538,"props":613,"children":614},{},[615,620,625],{"type":394,"tag":542,"props":616,"children":617},{},[618],{"type":400,"value":619},"所有依赖都是单例的",{"type":394,"tag":542,"props":621,"children":622},{},[623],{"type":400,"value":624},"更快的安装速度（相比 pnpm install -r）",{"type":394,"tag":542,"props":626,"children":627},{},[628],{"type":400,"value":629},"修改的文件总数更少，利于 Code Review",{"type":394,"tag":403,"props":631,"children":633},{"id":632},"pnpmfilecjs",[634],{"type":400,"value":635},".pnpmfile.cjs",{"type":394,"tag":410,"props":637,"children":638},{},[639,640,645],{"type":400,"value":414},{"type":394,"tag":416,"props":641,"children":643},{"className":642},[],[644],{"type":400,"value":635},{"type":400,"value":646}," 文件提供的 readPackage 和 afterAllResolved 钩子函数可以分别介入依赖元信息解析（minifest）和依赖安装完准备输出 lock 文件的过程。",{"type":394,"tag":462,"props":648,"children":652},{"code":649,"language":650,"meta":388,"className":651,"style":388},"function readPackage(pkg, context) {\n  // Override the manifest of foo@1.x after downloading it from the registry\n  if (pkg.name === 'foo' && pkg.version.startsWith('1.')) {\n    // Replace bar@x.x.x with bar@2.0.0\n    pkg.dependencies = {\n      ...pkg.dependencies,\n      bar: '^2.0.0'\n    }\n    context.log('bar@1 => bar@2 in dependencies of foo')\n  }\n  \n  // This will change any packages using baz@x.x.x to use baz@1.2.3\n  if (pkg.dependencies.baz) {\n    pkg.dependencies.baz = '1.2.3';\n  }\n  \n  return pkg\n}\n\nmodule.exports = {\n  hooks: {\n    readPackage\n  }\n}\n","js","language-js shiki shiki-themes material-theme-lighter github-light github-dark monokai",[653],{"type":394,"tag":416,"props":654,"children":655},{"__ignoreMap":388},[656,703,712,820,828,854,879,907,916,956,965,974,983,1025,1071,1079,1087,1101,1110,1119,1146,1163,1172,1180],{"type":394,"tag":471,"props":657,"children":658},{"class":473,"line":474},[659,665,671,677,683,688,693,698],{"type":394,"tag":471,"props":660,"children":662},{"style":661},"--shiki-light:#9C3EDA;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#66D9EF;--shiki-light-font-style:inherit;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[663],{"type":400,"value":664},"function",{"type":394,"tag":471,"props":666,"children":668},{"style":667},"--shiki-light:#6182B8;--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E",[669],{"type":400,"value":670}," readPackage",{"type":394,"tag":471,"props":672,"children":674},{"style":673},"--shiki-light:#39ADB5;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[675],{"type":400,"value":676},"(",{"type":394,"tag":471,"props":678,"children":680},{"style":679},"--shiki-light:#90A4AE;--shiki-default:#E36209;--shiki-dark:#FFAB70;--shiki-sepia:#FD971F;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[681],{"type":400,"value":682},"pkg",{"type":394,"tag":471,"props":684,"children":685},{"style":673},[686],{"type":400,"value":687},",",{"type":394,"tag":471,"props":689,"children":690},{"style":679},[691],{"type":400,"value":692}," context",{"type":394,"tag":471,"props":694,"children":695},{"style":673},[696],{"type":400,"value":697},")",{"type":394,"tag":471,"props":699,"children":700},{"style":673},[701],{"type":400,"value":702}," {\n",{"type":394,"tag":471,"props":704,"children":705},{"class":473,"line":483},[706],{"type":394,"tag":471,"props":707,"children":709},{"style":708},"--shiki-light:#90A4AE;--shiki-default:#6A737D;--shiki-dark:#6A737D;--shiki-sepia:#88846F;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:inherit",[710],{"type":400,"value":711},"  // Override the manifest of foo@1.x after downloading it from the registry\n",{"type":394,"tag":471,"props":713,"children":714},{"class":473,"line":492},[715,721,727,732,737,742,748,754,760,765,770,775,779,784,788,793,797,801,806,810,815],{"type":394,"tag":471,"props":716,"children":718},{"style":717},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672;--shiki-light-font-style:italic;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:inherit",[719],{"type":400,"value":720},"  if",{"type":394,"tag":471,"props":722,"children":724},{"style":723},"--shiki-light:#E53935;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[725],{"type":400,"value":726}," (",{"type":394,"tag":471,"props":728,"children":730},{"style":729},"--shiki-light:#90A4AE;--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2",[731],{"type":400,"value":682},{"type":394,"tag":471,"props":733,"children":734},{"style":673},[735],{"type":400,"value":736},".",{"type":394,"tag":471,"props":738,"children":739},{"style":729},[740],{"type":400,"value":741},"name",{"type":394,"tag":471,"props":743,"children":745},{"style":744},"--shiki-light:#39ADB5;--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672",[746],{"type":400,"value":747}," ===",{"type":394,"tag":471,"props":749,"children":751},{"style":750},"--shiki-light:#39ADB5;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[752],{"type":400,"value":753}," '",{"type":394,"tag":471,"props":755,"children":757},{"style":756},"--shiki-light:#91B859;--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74",[758],{"type":400,"value":759},"foo",{"type":394,"tag":471,"props":761,"children":762},{"style":750},[763],{"type":400,"value":764},"'",{"type":394,"tag":471,"props":766,"children":767},{"style":744},[768],{"type":400,"value":769}," &&",{"type":394,"tag":471,"props":771,"children":772},{"style":729},[773],{"type":400,"value":774}," pkg",{"type":394,"tag":471,"props":776,"children":777},{"style":673},[778],{"type":400,"value":736},{"type":394,"tag":471,"props":780,"children":781},{"style":729},[782],{"type":400,"value":783},"version",{"type":394,"tag":471,"props":785,"children":786},{"style":673},[787],{"type":400,"value":736},{"type":394,"tag":471,"props":789,"children":790},{"style":667},[791],{"type":400,"value":792},"startsWith",{"type":394,"tag":471,"props":794,"children":795},{"style":723},[796],{"type":400,"value":676},{"type":394,"tag":471,"props":798,"children":799},{"style":750},[800],{"type":400,"value":764},{"type":394,"tag":471,"props":802,"children":803},{"style":756},[804],{"type":400,"value":805},"1.",{"type":394,"tag":471,"props":807,"children":808},{"style":750},[809],{"type":400,"value":764},{"type":394,"tag":471,"props":811,"children":812},{"style":723},[813],{"type":400,"value":814},")) ",{"type":394,"tag":471,"props":816,"children":817},{"style":673},[818],{"type":400,"value":819},"{\n",{"type":394,"tag":471,"props":821,"children":822},{"class":473,"line":501},[823],{"type":394,"tag":471,"props":824,"children":825},{"style":708},[826],{"type":400,"value":827},"    // Replace bar@x.x.x with bar@2.0.0\n",{"type":394,"tag":471,"props":829,"children":830},{"class":473,"line":510},[831,836,840,845,850],{"type":394,"tag":471,"props":832,"children":833},{"style":729},[834],{"type":400,"value":835},"    pkg",{"type":394,"tag":471,"props":837,"children":838},{"style":673},[839],{"type":400,"value":736},{"type":394,"tag":471,"props":841,"children":842},{"style":729},[843],{"type":400,"value":844},"dependencies",{"type":394,"tag":471,"props":846,"children":847},{"style":744},[848],{"type":400,"value":849}," =",{"type":394,"tag":471,"props":851,"children":852},{"style":673},[853],{"type":400,"value":702},{"type":394,"tag":471,"props":855,"children":856},{"class":473,"line":519},[857,862,866,870,874],{"type":394,"tag":471,"props":858,"children":859},{"style":744},[860],{"type":400,"value":861},"      ...",{"type":394,"tag":471,"props":863,"children":864},{"style":729},[865],{"type":400,"value":682},{"type":394,"tag":471,"props":867,"children":868},{"style":673},[869],{"type":400,"value":736},{"type":394,"tag":471,"props":871,"children":872},{"style":729},[873],{"type":400,"value":844},{"type":394,"tag":471,"props":875,"children":876},{"style":673},[877],{"type":400,"value":878},",\n",{"type":394,"tag":471,"props":880,"children":882},{"class":473,"line":881},7,[883,888,893,897,902],{"type":394,"tag":471,"props":884,"children":885},{"style":723},[886],{"type":400,"value":887},"      bar",{"type":394,"tag":471,"props":889,"children":890},{"style":673},[891],{"type":400,"value":892},":",{"type":394,"tag":471,"props":894,"children":895},{"style":750},[896],{"type":400,"value":753},{"type":394,"tag":471,"props":898,"children":899},{"style":756},[900],{"type":400,"value":901},"^2.0.0",{"type":394,"tag":471,"props":903,"children":904},{"style":750},[905],{"type":400,"value":906},"'\n",{"type":394,"tag":471,"props":908,"children":910},{"class":473,"line":909},8,[911],{"type":394,"tag":471,"props":912,"children":913},{"style":673},[914],{"type":400,"value":915},"    }\n",{"type":394,"tag":471,"props":917,"children":919},{"class":473,"line":918},9,[920,925,929,934,938,942,947,951],{"type":394,"tag":471,"props":921,"children":922},{"style":729},[923],{"type":400,"value":924},"    context",{"type":394,"tag":471,"props":926,"children":927},{"style":673},[928],{"type":400,"value":736},{"type":394,"tag":471,"props":930,"children":931},{"style":667},[932],{"type":400,"value":933},"log",{"type":394,"tag":471,"props":935,"children":936},{"style":723},[937],{"type":400,"value":676},{"type":394,"tag":471,"props":939,"children":940},{"style":750},[941],{"type":400,"value":764},{"type":394,"tag":471,"props":943,"children":944},{"style":756},[945],{"type":400,"value":946},"bar@1 => bar@2 in dependencies of foo",{"type":394,"tag":471,"props":948,"children":949},{"style":750},[950],{"type":400,"value":764},{"type":394,"tag":471,"props":952,"children":953},{"style":723},[954],{"type":400,"value":955},")\n",{"type":394,"tag":471,"props":957,"children":959},{"class":473,"line":958},10,[960],{"type":394,"tag":471,"props":961,"children":962},{"style":673},[963],{"type":400,"value":964},"  }\n",{"type":394,"tag":471,"props":966,"children":968},{"class":473,"line":967},11,[969],{"type":394,"tag":471,"props":970,"children":971},{"style":723},[972],{"type":400,"value":973},"  \n",{"type":394,"tag":471,"props":975,"children":977},{"class":473,"line":976},12,[978],{"type":394,"tag":471,"props":979,"children":980},{"style":708},[981],{"type":400,"value":982},"  // This will change any packages using baz@x.x.x to use baz@1.2.3\n",{"type":394,"tag":471,"props":984,"children":986},{"class":473,"line":985},13,[987,991,995,999,1003,1007,1011,1016,1021],{"type":394,"tag":471,"props":988,"children":989},{"style":717},[990],{"type":400,"value":720},{"type":394,"tag":471,"props":992,"children":993},{"style":723},[994],{"type":400,"value":726},{"type":394,"tag":471,"props":996,"children":997},{"style":729},[998],{"type":400,"value":682},{"type":394,"tag":471,"props":1000,"children":1001},{"style":673},[1002],{"type":400,"value":736},{"type":394,"tag":471,"props":1004,"children":1005},{"style":729},[1006],{"type":400,"value":844},{"type":394,"tag":471,"props":1008,"children":1009},{"style":673},[1010],{"type":400,"value":736},{"type":394,"tag":471,"props":1012,"children":1013},{"style":729},[1014],{"type":400,"value":1015},"baz",{"type":394,"tag":471,"props":1017,"children":1018},{"style":723},[1019],{"type":400,"value":1020},") ",{"type":394,"tag":471,"props":1022,"children":1023},{"style":673},[1024],{"type":400,"value":819},{"type":394,"tag":471,"props":1026,"children":1028},{"class":473,"line":1027},14,[1029,1033,1037,1041,1045,1049,1053,1057,1062,1066],{"type":394,"tag":471,"props":1030,"children":1031},{"style":729},[1032],{"type":400,"value":835},{"type":394,"tag":471,"props":1034,"children":1035},{"style":673},[1036],{"type":400,"value":736},{"type":394,"tag":471,"props":1038,"children":1039},{"style":729},[1040],{"type":400,"value":844},{"type":394,"tag":471,"props":1042,"children":1043},{"style":673},[1044],{"type":400,"value":736},{"type":394,"tag":471,"props":1046,"children":1047},{"style":729},[1048],{"type":400,"value":1015},{"type":394,"tag":471,"props":1050,"children":1051},{"style":744},[1052],{"type":400,"value":849},{"type":394,"tag":471,"props":1054,"children":1055},{"style":750},[1056],{"type":400,"value":753},{"type":394,"tag":471,"props":1058,"children":1059},{"style":756},[1060],{"type":400,"value":1061},"1.2.3",{"type":394,"tag":471,"props":1063,"children":1064},{"style":750},[1065],{"type":400,"value":764},{"type":394,"tag":471,"props":1067,"children":1068},{"style":673},[1069],{"type":400,"value":1070},";\n",{"type":394,"tag":471,"props":1072,"children":1074},{"class":473,"line":1073},15,[1075],{"type":394,"tag":471,"props":1076,"children":1077},{"style":673},[1078],{"type":400,"value":964},{"type":394,"tag":471,"props":1080,"children":1082},{"class":473,"line":1081},16,[1083],{"type":394,"tag":471,"props":1084,"children":1085},{"style":723},[1086],{"type":400,"value":973},{"type":394,"tag":471,"props":1088,"children":1090},{"class":473,"line":1089},17,[1091,1096],{"type":394,"tag":471,"props":1092,"children":1093},{"style":717},[1094],{"type":400,"value":1095},"  return",{"type":394,"tag":471,"props":1097,"children":1098},{"style":729},[1099],{"type":400,"value":1100}," pkg\n",{"type":394,"tag":471,"props":1102,"children":1104},{"class":473,"line":1103},18,[1105],{"type":394,"tag":471,"props":1106,"children":1107},{"style":673},[1108],{"type":400,"value":1109},"}\n",{"type":394,"tag":471,"props":1111,"children":1113},{"class":473,"line":1112},19,[1114],{"type":394,"tag":471,"props":1115,"children":1116},{"emptyLinePlaceholder":387},[1117],{"type":400,"value":1118},"\n",{"type":394,"tag":471,"props":1120,"children":1122},{"class":473,"line":1121},20,[1123,1129,1133,1138,1142],{"type":394,"tag":471,"props":1124,"children":1126},{"style":1125},"--shiki-light:#39ADB5;--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#66D9EF;--shiki-light-font-style:inherit;--shiki-default-font-style:inherit;--shiki-dark-font-style:inherit;--shiki-sepia-font-style:italic",[1127],{"type":400,"value":1128},"module",{"type":394,"tag":471,"props":1130,"children":1131},{"style":673},[1132],{"type":400,"value":736},{"type":394,"tag":471,"props":1134,"children":1135},{"style":1125},[1136],{"type":400,"value":1137},"exports",{"type":394,"tag":471,"props":1139,"children":1140},{"style":744},[1141],{"type":400,"value":849},{"type":394,"tag":471,"props":1143,"children":1144},{"style":673},[1145],{"type":400,"value":702},{"type":394,"tag":471,"props":1147,"children":1149},{"class":473,"line":1148},21,[1150,1155,1159],{"type":394,"tag":471,"props":1151,"children":1152},{"style":723},[1153],{"type":400,"value":1154},"  hooks",{"type":394,"tag":471,"props":1156,"children":1157},{"style":673},[1158],{"type":400,"value":892},{"type":394,"tag":471,"props":1160,"children":1161},{"style":673},[1162],{"type":400,"value":702},{"type":394,"tag":471,"props":1164,"children":1166},{"class":473,"line":1165},22,[1167],{"type":394,"tag":471,"props":1168,"children":1169},{"style":729},[1170],{"type":400,"value":1171},"    readPackage\n",{"type":394,"tag":471,"props":1173,"children":1175},{"class":473,"line":1174},23,[1176],{"type":394,"tag":471,"props":1177,"children":1178},{"style":673},[1179],{"type":400,"value":964},{"type":394,"tag":471,"props":1181,"children":1183},{"class":473,"line":1182},24,[1184],{"type":394,"tag":471,"props":1185,"children":1186},{"style":673},[1187],{"type":400,"value":1109},{"type":394,"tag":410,"props":1189,"children":1190},{},[1191,1193],{"type":400,"value":1192},"见：",{"type":394,"tag":1194,"props":1195,"children":1199},"a",{"href":1196,"rel":1197},"https://pnpm.io/pnpmfile",[1198],"nofollow",[1200],{"type":400,"value":1201},"pnpmfile",{"type":394,"tag":395,"props":1203,"children":1205},{"id":1204},"原理",[1206],{"type":400,"value":1204},{"type":394,"tag":403,"props":1208,"children":1210},{"id":1209},"显著的优点",[1211],{"type":400,"value":1212},"显著的优点？",{"type":394,"tag":538,"props":1214,"children":1215},{},[1216,1221,1226,1239],{"type":394,"tag":542,"props":1217,"children":1218},{},[1219],{"type":400,"value":1220},"省磁盘空间，使用软硬链接和符号链接节约空间。",{"type":394,"tag":542,"props":1222,"children":1223},{},[1224],{"type":400,"value":1225},"安装依赖快，因为处理链接要比处理文件快，并且每个包的解析、下载和写入磁盘这三个阶段是分离的。",{"type":394,"tag":542,"props":1227,"children":1228},{},[1229,1231,1237],{"type":400,"value":1230},"内建支持 monorepo，所有命令支持 ",{"type":394,"tag":416,"props":1232,"children":1234},{"className":1233},[],[1235],{"type":400,"value":1236},"--filter",{"type":400,"value":1238}," 过滤包。",{"type":394,"tag":542,"props":1240,"children":1241},{},[1242],{"type":400,"value":1243},"依赖严格，避免幽灵依赖和依赖分身问题。",{"type":394,"tag":403,"props":1245,"children":1247},{"id":1246},"依赖的层次结构是怎样的",[1248],{"type":400,"value":1249},"依赖的层次结构是怎样的？",{"type":394,"tag":410,"props":1251,"children":1252},{},[1253,1255,1261,1263,1269,1271,1277,1279,1285,1287,1292,1294,1299,1301,1306,1308,1314,1316,1321,1323,1329],{"type":400,"value":1254},"当项目文件读取 ",{"type":394,"tag":416,"props":1256,"children":1258},{"className":1257},[],[1259],{"type":400,"value":1260},"bar",{"type":400,"value":1262}," 时，直接读取 ",{"type":394,"tag":416,"props":1264,"children":1266},{"className":1265},[],[1267],{"type":400,"value":1268},"node_modules/bar",{"type":400,"value":1270},"，但它其实是 ",{"type":394,"tag":416,"props":1272,"children":1274},{"className":1273},[],[1275],{"type":400,"value":1276},".pnpm",{"type":400,"value":1278}," 文件夹下 ",{"type":394,"tag":416,"props":1280,"children":1282},{"className":1281},[],[1283],{"type":400,"value":1284},"bar/node_modules/bar",{"type":400,"value":1286}," 的一个符号链接。也就是说，他的真实的地址在 ",{"type":394,"tag":416,"props":1288,"children":1290},{"className":1289},[],[1291],{"type":400,"value":1276},{"type":400,"value":1293}," 文件夹下。这样一来，当 ",{"type":394,"tag":416,"props":1295,"children":1297},{"className":1296},[],[1298],{"type":400,"value":1260},{"type":400,"value":1300}," 读取它的依赖的时候（项目的依赖的依赖），会在 ",{"type":394,"tag":416,"props":1302,"children":1304},{"className":1303},[],[1305],{"type":400,"value":1260},{"type":400,"value":1307}," 的上层目录即 ",{"type":394,"tag":416,"props":1309,"children":1311},{"className":1310},[],[1312],{"type":400,"value":1313},"bar/node_modules",{"type":400,"value":1315}," 找到 ",{"type":394,"tag":416,"props":1317,"children":1319},{"className":1318},[],[1320],{"type":400,"value":759},{"type":400,"value":1322}," 这个依赖。项目文件没法读取 ",{"type":394,"tag":416,"props":1324,"children":1326},{"className":1325},[],[1327],{"type":400,"value":1328},"bar/node_modules/foo",{"type":400,"value":1330}," 所以避免了幽灵依赖问题。",{"type":394,"tag":410,"props":1332,"children":1333},{},[1334,1339,1341,1347,1349,1354,1356,1362],{"type":394,"tag":416,"props":1335,"children":1337},{"className":1336},[],[1338],{"type":400,"value":1328},{"type":400,"value":1340}," 要怎么找到它的依赖呢？它的真实地址在项目 ·（和官网的图有出入），所以 foo 也只能读取它自己的子依赖，即 ",{"type":394,"tag":416,"props":1342,"children":1344},{"className":1343},[],[1345],{"type":400,"value":1346},"node_modules/.pnpm/foo/node_modules",{"type":400,"value":1348},"。如果有依赖依赖了同一份（同一版本）的 ",{"type":394,"tag":416,"props":1350,"children":1352},{"className":1351},[],[1353],{"type":400,"value":759},{"type":400,"value":1355},"，那么它们的真实地址都是一样的 ",{"type":394,"tag":416,"props":1357,"children":1359},{"className":1358},[],[1360],{"type":400,"value":1361},"node_modules/.pnpm/foo/node_modules/foo",{"type":400,"value":1363},"，这样就避免依赖分身问题。",{"type":394,"tag":410,"props":1365,"children":1366},{},[1367],{"type":394,"tag":1368,"props":1369,"children":1372},"img",{"alt":1370,"src":1371},"Modules Mapping in pnpm","https://mgear-image.oss-cn-shanghai.aliyuncs.com/image/other/20220317192927.png",[],{"type":394,"tag":410,"props":1374,"children":1375},{},[1376,1377,1384,1386],{"type":400,"value":1192},{"type":394,"tag":1194,"props":1378,"children":1381},{"href":1379,"rel":1380},"https://pnpm.io/blog/2020/05/27/flat-node-modules-is-not-the-only-way",[1198],[1382],{"type":400,"value":1383},"Flat node_modules is not the only way | @pnpm",{"type":400,"value":1385},"、",{"type":394,"tag":1194,"props":1387,"children":1390},{"href":1388,"rel":1389},"https://pnpm.io/symlinked-node-modules-structure",[1198],[1391],{"type":400,"value":1392},"Symlinked node_modules structure | @pnpm",{"type":394,"tag":403,"props":1394,"children":1396},{"id":1395},"如何处理同级依赖",[1397],{"type":400,"value":1398},"如何处理同级依赖？",{"type":394,"tag":410,"props":1400,"children":1401},{},[1402,1404,1410,1412,1418,1420,1426,1428,1434,1436,1442,1443,1449],{"type":400,"value":1403},"当项目的两个包 A、B 依赖依赖了同一版本的 C，但是却安装了不同版本的 C 的同级依赖 D@1.0 和 D@1.1，这时，A 依赖的 C 的真实地址是 ",{"type":394,"tag":416,"props":1405,"children":1407},{"className":1406},[],[1408],{"type":400,"value":1409},".pnpm/C_D@1.0/node_modules/C",{"type":400,"value":1411},"，B 依赖的 C 的真实地址是 ",{"type":394,"tag":416,"props":1413,"children":1415},{"className":1414},[],[1416],{"type":400,"value":1417},".pnpm/C_D@1.1/node_modules/C",{"type":400,"value":1419},"。这样一来，两个 C 在读取其同级依赖时，分别读取了 ",{"type":394,"tag":416,"props":1421,"children":1423},{"className":1422},[],[1424],{"type":400,"value":1425},".pnpm/C_D@1.0/node_modules/D",{"type":400,"value":1427}," 和 ",{"type":394,"tag":416,"props":1429,"children":1431},{"className":1430},[],[1432],{"type":400,"value":1433},".pnpm/C_D@1.1/node_modules/D@1.0",{"type":400,"value":1435},"，分别对应真实地址 ",{"type":394,"tag":416,"props":1437,"children":1439},{"className":1438},[],[1440],{"type":400,"value":1441},".pnpm/D@1.0/node_modules/D",{"type":400,"value":1427},{"type":394,"tag":416,"props":1444,"children":1446},{"className":1445},[],[1447],{"type":400,"value":1448},".pnpm/D@1.1/node_modules/D",{"type":400,"value":1450},"。",{"type":394,"tag":410,"props":1452,"children":1453},{},[1454,1456,1462,1463,1469,1471,1477,1478,1483,1485,1491],{"type":400,"value":1455},"当同级依赖的深度增加时，层级结构也随之变得复杂。如果某个依赖 A 依赖了同一个 B，但是 B 子依赖 C 的版本不同（C@1.0 和 C@1.1），这样就创造出了指数级增长的软链数量。为了保证 B 能分别访问两个 C，B 的符号链接的被链接地址会有 ",{"type":394,"tag":416,"props":1457,"children":1459},{"className":1458},[],[1460],{"type":400,"value":1461},".pnpm/B_C@1.0/node_modules/B",{"type":400,"value":1427},{"type":394,"tag":416,"props":1464,"children":1466},{"className":1465},[],[1467],{"type":400,"value":1468},".pnpm/B_C@1.1/node_modules/B",{"type":400,"value":1470},"，而为此，A 的被链接地址也会有两个，",{"type":394,"tag":416,"props":1472,"children":1474},{"className":1473},[],[1475],{"type":400,"value":1476},".pnpm/A_C@1.0/node_modules/A",{"type":400,"value":1427},{"type":394,"tag":416,"props":1479,"children":1481},{"className":1480},[],[1482],{"type":400,"value":1476},{"type":400,"value":1484},"。从不同的 A 的被链接地址的上级目录 ",{"type":394,"tag":416,"props":1486,"children":1488},{"className":1487},[],[1489],{"type":400,"value":1490},"node_modules",{"type":400,"value":1492}," 可以读取到不同的 B 的被链目录，从不同的 B 可以读取到不同的 C。",{"type":394,"tag":462,"props":1494,"children":1496},{"code":1495,"language":400,"meta":388,"className":465,"style":388},"node_modules\n└── .pnpm\n    ├── a@1.0.0_c@1.0.0\n    │   └── node_modules\n    │       ├── a\n    │       └── b -> ../../b@1.0.0_c@1.0.0/node_modules/b\n    ├── a@1.0.0_c@1.1.0\n    │   └── node_modules\n    │       ├── a\n    │       └── b -> ../../b@1.0.0_c@1.1.0/node_modules/b\n    ├── b@1.0.0_c@1.0.0\n    │   └── node_modules\n    │       ├── b\n    │       └── c -> ../../c@1.0.0/node_modules/c\n    ├── b@1.0.0_c@1.1.0\n    │   └── node_modules\n    │       ├── b\n    │       └── c -> ../../c@1.1.0/node_modules/c\n    ├── c@1.0.0\n    ├── c@1.1.0\n",[1497],{"type":394,"tag":416,"props":1498,"children":1499},{"__ignoreMap":388},[1500,1508,1516,1524,1532,1540,1548,1556,1563,1570,1578,1586,1593,1601,1609,1617,1624,1631,1639,1647],{"type":394,"tag":471,"props":1501,"children":1502},{"class":473,"line":474},[1503],{"type":394,"tag":471,"props":1504,"children":1505},{},[1506],{"type":400,"value":1507},"node_modules\n",{"type":394,"tag":471,"props":1509,"children":1510},{"class":473,"line":483},[1511],{"type":394,"tag":471,"props":1512,"children":1513},{},[1514],{"type":400,"value":1515},"└── .pnpm\n",{"type":394,"tag":471,"props":1517,"children":1518},{"class":473,"line":492},[1519],{"type":394,"tag":471,"props":1520,"children":1521},{},[1522],{"type":400,"value":1523},"    ├── a@1.0.0_c@1.0.0\n",{"type":394,"tag":471,"props":1525,"children":1526},{"class":473,"line":501},[1527],{"type":394,"tag":471,"props":1528,"children":1529},{},[1530],{"type":400,"value":1531},"    │   └── node_modules\n",{"type":394,"tag":471,"props":1533,"children":1534},{"class":473,"line":510},[1535],{"type":394,"tag":471,"props":1536,"children":1537},{},[1538],{"type":400,"value":1539},"    │       ├── a\n",{"type":394,"tag":471,"props":1541,"children":1542},{"class":473,"line":519},[1543],{"type":394,"tag":471,"props":1544,"children":1545},{},[1546],{"type":400,"value":1547},"    │       └── b -> ../../b@1.0.0_c@1.0.0/node_modules/b\n",{"type":394,"tag":471,"props":1549,"children":1550},{"class":473,"line":881},[1551],{"type":394,"tag":471,"props":1552,"children":1553},{},[1554],{"type":400,"value":1555},"    ├── a@1.0.0_c@1.1.0\n",{"type":394,"tag":471,"props":1557,"children":1558},{"class":473,"line":909},[1559],{"type":394,"tag":471,"props":1560,"children":1561},{},[1562],{"type":400,"value":1531},{"type":394,"tag":471,"props":1564,"children":1565},{"class":473,"line":918},[1566],{"type":394,"tag":471,"props":1567,"children":1568},{},[1569],{"type":400,"value":1539},{"type":394,"tag":471,"props":1571,"children":1572},{"class":473,"line":958},[1573],{"type":394,"tag":471,"props":1574,"children":1575},{},[1576],{"type":400,"value":1577},"    │       └── b -> ../../b@1.0.0_c@1.1.0/node_modules/b\n",{"type":394,"tag":471,"props":1579,"children":1580},{"class":473,"line":967},[1581],{"type":394,"tag":471,"props":1582,"children":1583},{},[1584],{"type":400,"value":1585},"    ├── b@1.0.0_c@1.0.0\n",{"type":394,"tag":471,"props":1587,"children":1588},{"class":473,"line":976},[1589],{"type":394,"tag":471,"props":1590,"children":1591},{},[1592],{"type":400,"value":1531},{"type":394,"tag":471,"props":1594,"children":1595},{"class":473,"line":985},[1596],{"type":394,"tag":471,"props":1597,"children":1598},{},[1599],{"type":400,"value":1600},"    │       ├── b\n",{"type":394,"tag":471,"props":1602,"children":1603},{"class":473,"line":1027},[1604],{"type":394,"tag":471,"props":1605,"children":1606},{},[1607],{"type":400,"value":1608},"    │       └── c -> ../../c@1.0.0/node_modules/c\n",{"type":394,"tag":471,"props":1610,"children":1611},{"class":473,"line":1073},[1612],{"type":394,"tag":471,"props":1613,"children":1614},{},[1615],{"type":400,"value":1616},"    ├── b@1.0.0_c@1.1.0\n",{"type":394,"tag":471,"props":1618,"children":1619},{"class":473,"line":1081},[1620],{"type":394,"tag":471,"props":1621,"children":1622},{},[1623],{"type":400,"value":1531},{"type":394,"tag":471,"props":1625,"children":1626},{"class":473,"line":1089},[1627],{"type":394,"tag":471,"props":1628,"children":1629},{},[1630],{"type":400,"value":1600},{"type":394,"tag":471,"props":1632,"children":1633},{"class":473,"line":1103},[1634],{"type":394,"tag":471,"props":1635,"children":1636},{},[1637],{"type":400,"value":1638},"    │       └── c -> ../../c@1.1.0/node_modules/c\n",{"type":394,"tag":471,"props":1640,"children":1641},{"class":473,"line":1112},[1642],{"type":394,"tag":471,"props":1643,"children":1644},{},[1645],{"type":400,"value":1646},"    ├── c@1.0.0\n",{"type":394,"tag":471,"props":1648,"children":1649},{"class":473,"line":1121},[1650],{"type":394,"tag":471,"props":1651,"children":1652},{},[1653],{"type":400,"value":1654},"    ├── c@1.1.0\n",{"type":394,"tag":410,"props":1656,"children":1657},{},[1658,1659],{"type":400,"value":1192},{"type":394,"tag":1194,"props":1660,"children":1663},{"href":1661,"rel":1662},"https://pnpm.io/how-peers-are-resolved",[1198],[1664],{"type":400,"value":1665},"How peers are resolved | @pnpm",{"type":394,"tag":403,"props":1667,"children":1669},{"id":1668},"怎样兼容-nodejs-模块加载顺序",[1670],{"type":400,"value":1671},"怎样兼容 NodeJS 模块加载顺序？",{"type":394,"tag":410,"props":1673,"children":1674},{},[1675],{"type":400,"value":1676},"不论系统自带的模块，NodeJS 加载模块的顺序是这样的：",{"type":394,"tag":538,"props":1678,"children":1679},{},[1680,1685,1690,1695],{"type":394,"tag":542,"props":1681,"children":1682},{},[1683],{"type":400,"value":1684},"读取本文件夹中 node_modules 中对应名字的文件夹的 package.json，并寻找 main 字段对应的路径",{"type":394,"tag":542,"props":1686,"children":1687},{},[1688],{"type":400,"value":1689},"读取本文件夹中 node_modules 中对应名字的 js 文件",{"type":394,"tag":542,"props":1691,"children":1692},{},[1693],{"type":400,"value":1694},"读取本文件夹中 node_modules 中对应名字文件夹中的 index.js 文件",{"type":394,"tag":542,"props":1696,"children":1697},{},[1698],{"type":400,"value":1699},"跳出本文件夹，继续前三个步骤",{"type":394,"tag":410,"props":1701,"children":1702},{},[1703,1705,1710,1712,1718,1720,1726,1728,1733,1735,1741,1743,1749],{"type":400,"value":1704},"因为项目 ",{"type":394,"tag":416,"props":1706,"children":1708},{"className":1707},[],[1709],{"type":400,"value":1268},{"type":400,"value":1711}," 是 ",{"type":394,"tag":416,"props":1713,"children":1715},{"className":1714},[],[1716],{"type":400,"value":1717},".pnpm/bar/node_modules/bar",{"type":400,"value":1719}," 的符号链接，所以项目文件可以直接读取 ",{"type":394,"tag":416,"props":1721,"children":1723},{"className":1722},[],[1724],{"type":400,"value":1725},"node_modules/bar/x.js",{"type":400,"value":1727},"。同时，如果 ",{"type":394,"tag":416,"props":1729,"children":1731},{"className":1730},[],[1732],{"type":400,"value":1725},{"type":400,"value":1734}," 需要加载 ",{"type":394,"tag":416,"props":1736,"children":1738},{"className":1737},[],[1739],{"type":400,"value":1740},"foo/x.js",{"type":400,"value":1742},"，那么在上述步骤的第 4 步，就能找到 ",{"type":394,"tag":416,"props":1744,"children":1746},{"className":1745},[],[1747],{"type":400,"value":1748},".pnpm/bar/node_modules/foo/x.js",{"type":400,"value":1750}," 文件。",{"type":394,"tag":403,"props":1752,"children":1754},{"id":1753},"为什么其模块层次只是比较严格的semistrict",[1755],{"type":400,"value":1756},"为什么其模块层次只是“比较严格的”（semistrict）？",{"type":394,"tag":410,"props":1758,"children":1759},{},[1760],{"type":400,"value":1761},"由 NodeJS 模块加载规则可知，在 pnpm 创造的依赖层次下，一个依赖的子依赖间仍有相互访问的能力。",{"type":394,"tag":403,"props":1763,"children":1765},{"id":1764},"为什么能节约磁盘空间",[1766],{"type":400,"value":1767},"为什么能节约磁盘空间？",{"type":394,"tag":410,"props":1769,"children":1770},{},[1771,1773,1779,1781,1787,1789,1795],{"type":400,"value":1772},"由 pnpm 创造的 node_modules 层级结构可以知道，所有依赖的符号链接的真实地址都在 ",{"type":394,"tag":416,"props":1774,"children":1776},{"className":1775},[],[1777],{"type":400,"value":1778},".pnpm/package-name/node_modules/package-name",{"type":400,"value":1780}," 这个文件夹中。这种文件夹会通过硬链接的形式链接到 ",{"type":394,"tag":416,"props":1782,"children":1784},{"className":1783},[],[1785],{"type":400,"value":1786},"user-document/.pnpm-store",{"type":400,"value":1788}," 中，所以相同的包只会存一份，也就是 ",{"type":394,"tag":416,"props":1790,"children":1792},{"className":1791},[],[1793],{"type":400,"value":1794},".pnpm-store/package-name",{"type":400,"value":1450},{"type":394,"tag":403,"props":1797,"children":1799},{"id":1798},"软硬链接有什么问题",[1800],{"type":400,"value":1801},"软硬链接有什么问题？",{"type":394,"tag":1803,"props":1804,"children":1805},"ul",{},[1806,1811,1816,1821],{"type":394,"tag":542,"props":1807,"children":1808},{},[1809],{"type":400,"value":1810},"特定的软链结构会导致某些应用出现死循环",{"type":394,"tag":542,"props":1812,"children":1813},{},[1814],{"type":400,"value":1815},"硬链接是同一份文件，不便调试",{"type":394,"tag":542,"props":1817,"children":1818},{},[1819],{"type":400,"value":1820},"软链接在非 SSD 上的读写会有性能损耗",{"type":394,"tag":542,"props":1822,"children":1823},{},[1824],{"type":400,"value":1825},"pnpm 创造的 node_modules 层级结构会破坏某些依赖依赖了相对路径的依赖的逻辑",{"type":394,"tag":410,"props":1827,"children":1828},{},[1829,1830],{"type":400,"value":1192},{"type":394,"tag":1194,"props":1831,"children":1834},{"href":1832,"rel":1833},"https://zhuanlan.zhihu.com/p/553804414",[1198],[1835],{"type":400,"value":1836},"精读 pnpm",{"type":394,"tag":395,"props":1838,"children":1840},{"id":1839},"常见问题",[1841],{"type":400,"value":1839},{"type":394,"tag":403,"props":1843,"children":1845},{"id":1844},"pnpm-找不到全局路径的解决方法",[1846],{"type":400,"value":1847},"PNPM 找不到全局路径的解决方法？",{"type":394,"tag":410,"props":1849,"children":1850},{},[1851],{"type":400,"value":1852},"尽管设置了全局变量，也重新安装了最新版本 PNPM，也执行了 pnpm setup，却仍然报错找不到全局路径的临时解决方案：",{"type":394,"tag":462,"props":1854,"children":1858},{"code":1855,"language":1856,"meta":388,"className":1857,"style":388},"$PNPM_HOME=\"\u003Cpath>\" | pnpm install -g xxx\n","powershell","language-powershell shiki shiki-themes material-theme-lighter github-light github-dark monokai",[1859],{"type":394,"tag":416,"props":1860,"children":1861},{"__ignoreMap":388},[1862],{"type":394,"tag":471,"props":1863,"children":1864},{"class":473,"line":474},[1865,1870,1875,1880,1885,1890,1894,1899,1904,1909],{"type":394,"tag":471,"props":1866,"children":1867},{"style":673},[1868],{"type":400,"value":1869},"$",{"type":394,"tag":471,"props":1871,"children":1872},{"style":729},[1873],{"type":400,"value":1874},"PNPM_HOME",{"type":394,"tag":471,"props":1876,"children":1877},{"style":744},[1878],{"type":400,"value":1879},"=",{"type":394,"tag":471,"props":1881,"children":1882},{"style":750},[1883],{"type":400,"value":1884},"\"",{"type":394,"tag":471,"props":1886,"children":1887},{"style":756},[1888],{"type":400,"value":1889},"\u003Cpath>",{"type":394,"tag":471,"props":1891,"children":1892},{"style":750},[1893],{"type":400,"value":1884},{"type":394,"tag":471,"props":1895,"children":1896},{"style":744},[1897],{"type":400,"value":1898}," |",{"type":394,"tag":471,"props":1900,"children":1901},{"style":729},[1902],{"type":400,"value":1903}," pnpm install ",{"type":394,"tag":471,"props":1905,"children":1906},{"style":744},[1907],{"type":400,"value":1908},"-",{"type":394,"tag":471,"props":1910,"children":1911},{"style":729},[1912],{"type":400,"value":1913},"g xxx\n",{"type":394,"tag":403,"props":1915,"children":1917},{"id":1916},"pnpm-速度变慢了",[1918],{"type":400,"value":1919},"PNPM 速度变慢了？",{"type":394,"tag":410,"props":1921,"children":1922},{},[1923],{"type":400,"value":1924},"今天逛官网时，偶然发现 Readme 中的 benchmark 过时了。它说“要比 Yarn Classic 和 npm “快两倍以上，但是从 benchmark 来看，他要比 Yarn 和 npm 慢了不少。以后启用 NodeJS 20 以上时，如果问题得不到改善，我应该会重新选择 npm 而不是 pnpm，鉴于幽灵依赖和依赖分身带来的问题是可排查可解决的，而速度是解决不了的问题。",{"type":394,"tag":410,"props":1926,"children":1927},{},[1928],{"type":394,"tag":1368,"props":1929,"children":1932},{"alt":1930,"src":1931},"pnpm vs npm vs yarn benchmark","https://mgear-image.oss-cn-shanghai.aliyuncs.com/image/other/20230605235736.png",[],{"type":394,"tag":410,"props":1934,"children":1935},{},[1936,1938],{"type":400,"value":1937},"相关见：",{"type":394,"tag":1194,"props":1939,"children":1942},{"href":1940,"rel":1941},"https://github.com/pnpm/pnpm/issues/6447",[1198],[1943],{"type":400,"value":1944},"pnpm seems to be consistently slower than yarn (classic)",{"type":394,"tag":403,"props":1946,"children":1948},{"id":1947},"关于-v8-版本的变化",[1949],{"type":400,"value":1950},"关于 V8 版本的变化？",{"type":394,"tag":1803,"props":1952,"children":1953},{},[1954,1973,1989,2000,2005,2010,2015],{"type":394,"tag":542,"props":1955,"children":1956},{},[1957,1963,1965,1971],{"type":394,"tag":416,"props":1958,"children":1960},{"className":1959},[],[1961],{"type":400,"value":1962},"resolve-peers-from-workspace-root",{"type":400,"value":1964}," is ",{"type":394,"tag":416,"props":1966,"children":1968},{"className":1967},[],[1969],{"type":400,"value":1970},"true",{"type":400,"value":1972}," by default",{"type":394,"tag":542,"props":1974,"children":1975},{},[1976,1982,1983,1988],{"type":394,"tag":416,"props":1977,"children":1979},{"className":1978},[],[1980],{"type":400,"value":1981},"auto-install-peers",{"type":400,"value":1964},{"type":394,"tag":416,"props":1984,"children":1986},{"className":1985},[],[1987],{"type":400,"value":1970},{"type":400,"value":1972},{"type":394,"tag":542,"props":1990,"children":1991},{},[1992,1998],{"type":394,"tag":416,"props":1993,"children":1995},{"className":1994},[],[1996],{"type":400,"value":1997},"dedupe-peer-dependents",{"type":400,"value":1999}," set to true by default",{"type":394,"tag":542,"props":2001,"children":2002},{},[2003],{"type":400,"value":2004},"停止 NodeJS 14 的支持",{"type":394,"tag":542,"props":2006,"children":2007},{},[2008],{"type":400,"value":2009},"lockfile v6 by default",{"type":394,"tag":542,"props":2011,"children":2012},{},[2013],{"type":400,"value":2014},"resolution mode（prebundle、time-based、lowest-direct）default set to lowest-based，需要注意手动升级，尤其是在没有锁文件的情况",{"type":394,"tag":542,"props":2016,"children":2017},{},[2018,2020,2026],{"type":400,"value":2019},"only deply ",{"type":394,"tag":416,"props":2021,"children":2023},{"className":2022},[],[2024],{"type":400,"value":2025},"files",{"type":400,"value":2027}," field when the field exist",{"type":394,"tag":403,"props":2029,"children":2031},{"id":2030},"pnp-模式下的依赖提升设置",[2032],{"type":400,"value":2033},"PnP 模式下的依赖提升设置？",{"type":394,"tag":410,"props":2035,"children":2036},{},[2037],{"type":400,"value":2038},"默认的 node_modules 依赖的层级处于严格和不严格之间的水平，",{"type":394,"tag":1803,"props":2040,"children":2041},{},[2042],{"type":394,"tag":542,"props":2043,"children":2044},{},[2045,2047,2053],{"type":400,"value":2046},"最严格的设置：在 PnP 模式中 node_modules 的配置最为严格，因为在 monorepo 中 PnP 模式中，就算开启了 ",{"type":394,"tag":416,"props":2048,"children":2050},{"className":2049},[],[2051],{"type":400,"value":2052},"hoist=false",{"type":400,"value":2054}," 也不会禁用 workspace root 的依赖",{"type":394,"tag":462,"props":2056,"children":2058},{"code":2057},"node-linker=pnp\nsymlink=false\n",[2059],{"type":394,"tag":416,"props":2060,"children":2061},{"__ignoreMap":388},[2062],{"type":400,"value":2057},{"type":394,"tag":410,"props":2064,"children":2065},{},[2066,2067],{"type":400,"value":1192},{"type":394,"tag":1194,"props":2068,"children":2071},{"href":2069,"rel":2070},"https://pnpm.io/blog/2020/10/17/node-modules-configuration-options-with-pnpm",[1198],[2072],{"type":400,"value":2073},"Node-Modules configuration options with pnpm",{"type":394,"tag":2075,"props":2076,"children":2077},"style",{},[2078],{"type":400,"value":2079},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}",{"title":388,"searchDepth":483,"depth":483,"links":2081},[2082,2083,2084],{"id":397,"depth":483,"text":401},{"id":1204,"depth":483,"text":1204},{"id":1839,"depth":483,"text":1839},"markdown","content:6.maps:_workflow:package-manager:pnpm.md","content","6.maps/_workflow/package-manager/pnpm.md","md",[2091,2094],{"_path":2092,"title":2093,"description":388},"/maps/_workflow/package-manager/npm","NPM",{"_path":2095,"title":2096,"description":388},"/maps/_workflow/packer","打包工具",1708107595378]