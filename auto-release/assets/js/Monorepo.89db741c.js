(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{986:function(t,r,a){"use strict";a.r(r);var n=a(0),e=Object(n.a)({},(function(){var t=this,r=t._self._c;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h1",{attrs:{id:"monorepo"}},[t._v("Monorepo")]),t._v(" "),r("nav",{staticClass:"table-of-contents"},[r("ol",[r("li",[r("a",{attrs:{href:"#monorepo"}},[t._v("Monorepo")]),r("ol",[r("li",[r("a",{attrs:{href:"#todo"}},[t._v("TODO")])]),r("li",[r("a",{attrs:{href:"#简介"}},[t._v("简介")]),r("ol",[r("li",[r("a",{attrs:{href:"#monorepo-是什么"}},[t._v("monorepo 是什么？")])]),r("li",[r("a",{attrs:{href:"#使用-monorepo-能解决什么问题"}},[t._v("使用 monorepo 能解决什么问题？")])]),r("li",[r("a",{attrs:{href:"#使用-monorepo-带来了什么问题"}},[t._v("使用 monorepo 带来了什么问题？")])])])]),r("li",[r("a",{attrs:{href:"#lerna"}},[t._v("Lerna")]),r("ol",[r("li",[r("a",{attrs:{href:"#lerna-如何管理项目间的依赖"}},[t._v("lerna 如何管理项目间的依赖？")])]),r("li",[r("a",{attrs:{href:"#lerna-如何管理并行任务的依赖关系"}},[t._v("lerna 如何管理并行任务的依赖关系？")])]),r("li",[r("a",{attrs:{href:"#lerna-的任务缓存哈希来源"}},[t._v("lerna 的任务缓存哈希来源？")])])])])])])])]),r("h2",{attrs:{id:"todo"}},[t._v("TODO")]),t._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://juejin.cn/post/7102452341210611720",target:"_blank",rel:"noopener noreferrer"}},[t._v("现代 Monorepo 工程技术选型，聊聊我的思考")])]),t._v(" "),r("li",[r("a",{attrs:{href:"https://monorepo.tools/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Monorepo Tools")])]),t._v(" "),r("li",[r("a",{attrs:{href:"https://juejin.cn/post/6972139870231724045",target:"_blank",rel:"noopener noreferrer"}},[t._v("Monorepo 的这些坑，我们帮你踩过了")])])]),t._v(" "),r("h2",{attrs:{id:"简介"}},[t._v("简介")]),t._v(" "),r("h4",{attrs:{id:"monorepo-是什么"}},[t._v("monorepo 是什么？")]),t._v(" "),r("p",[t._v("monorepo 对应 multirepo，是“把多个仓库放到一个仓库中来管理”这种技术的统称，它可以给不同项目带来一致的工作流，使团队协作更加容易，减小项目的开发和维护成本。")]),t._v(" "),r("h4",{attrs:{id:"使用-monorepo-能解决什么问题"}},[t._v("使用 monorepo 能解决什么问题？")]),t._v(" "),r("ul",[r("li",[t._v("重复编码：不同项目需要维护多套基础建设（Husky、Linter、Test、CI、Sentry、Sonar）")]),t._v(" "),r("li",[t._v("简化调试：多仓共享及调试代码成本高昂")]),t._v(" "),r("li",[t._v("版本管理：公共部分代码一定是最新版本，所以便于调试和发版")])]),t._v(" "),r("h4",{attrs:{id:"使用-monorepo-带来了什么问题"}},[t._v("使用 monorepo 带来了什么问题？")]),t._v(" "),r("ul",[r("li",[t._v("幽灵依赖：除非使用 pnpm 严格限制依赖，不然很容易碰到幽灵依赖的问题")]),t._v(" "),r("li",[t._v("按需构建：需要手动使用 yarn lerna:changed 找出变化的项目进行按需构建")]),t._v(" "),r("li",[t._v("提交记录混乱：需要使用更规范的分支管理及提交信息管理")])]),t._v(" "),r("h2",{attrs:{id:"lerna"}},[t._v("Lerna")]),t._v(" "),r("p",[t._v("见："),r("a",{attrs:{href:"https://lerna.js.org/docs/introduction",target:"_blank",rel:"noopener noreferrer"}},[t._v("Lerna Documention")])]),t._v(" "),r("h4",{attrs:{id:"lerna-如何管理项目间的依赖"}},[t._v("lerna 如何管理项目间的依赖？")]),t._v(" "),r("p",[t._v("使用 lerna bootstrap --use-workspaces 指令将会使 lerna 代理包管理器的依赖 linking 过程（类似 yarn 的 pnp 模式）；如果不带 --use-workspaces 指令，将会使用传统的符号链接进行依赖管理。")]),t._v(" "),r("h4",{attrs:{id:"lerna-如何管理并行任务的依赖关系"}},[t._v("lerna 如何管理并行任务的依赖关系？")]),t._v(" "),r("p",[t._v("可以在 nx.json 中启用 targetDefaults 配置指定任务间的依赖关系。")]),t._v(" "),r("div",{staticClass:"language-js extra-class"},[r("pre",{pre:!0,attrs:{class:"language-js"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"targetDefaults"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"build"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),r("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"dependsOn"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^build"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"prebuild"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"test"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),r("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"dependsOn"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"build"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),r("figure",{attrs:{"data-type":"image"}},[r("img",{attrs:{src:"https://mgear-image.oss-cn-shanghai.aliyuncs.com/image/other/20221005225436.png",alt:"",loading:"lazy"}}),r("figcaption",[r("a",{attrs:{href:"https://lerna.js.org/docs/concepts/task-pipeline-configuration",target:"_blank",rel:"noopener noreferrer"}},[t._v("Command Execution")])])]),t._v(" "),r("h4",{attrs:{id:"lerna-的任务缓存哈希来源"}},[t._v("lerna 的任务缓存哈希来源？")]),t._v(" "),r("p",[t._v("可以在任务中启用任务的缓存，如果项目源文件、项目依赖、全局配置、执行环境（NodeJS Version）、命令行参数等条件都没有改变，则这个项目的任务就会命中上一次缓存。")])])}),[],!1,null,null,null);r.default=e.exports}}]);